var Pee=Object.defineProperty;var Lee=(o,i,a)=>i in o?Pee(o,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[i]=a;var kL=(o,i,a)=>Lee(o,typeof i!="symbol"?i+"":i,a);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))d(f);new MutationObserver(f=>{for(const y of f)if(y.type==="childList")for(const R of y.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&d(R)}).observe(document,{childList:!0,subtree:!0});function a(f){const y={};return f.integrity&&(y.integrity=f.integrity),f.referrerPolicy&&(y.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?y.credentials="include":f.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function d(f){if(f.ep)return;f.ep=!0;const y=a(f);fetch(f.href,y)}})();var xL=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function TR(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var ML={exports:{}},UT={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q6;function kee(){if(Q6)return UT;Q6=1;var o=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function a(d,f,y){var R=null;if(y!==void 0&&(R=""+y),f.key!==void 0&&(R=""+f.key),"key"in f){y={};for(var w in f)w!=="key"&&(y[w]=f[w])}else y=f;return f=y.ref,{$$typeof:o,type:d,key:R,ref:f!==void 0?f:null,props:y}}return UT.Fragment=i,UT.jsx=a,UT.jsxs=a,UT}var $6;function xee(){return $6||($6=1,ML.exports=kee()),ML.exports}var E=xee(),UL={exports:{}},jn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z6;function Mee(){if(Z6)return jn;Z6=1;var o=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),y=Symbol.for("react.consumer"),R=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),O=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),G=Symbol.iterator;function W(ge){return ge===null||typeof ge!="object"?null:(ge=G&&ge[G]||ge["@@iterator"],typeof ge=="function"?ge:null)}var ne={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Q=Object.assign,se={};function te(ge,qe,Oe){this.props=ge,this.context=qe,this.refs=se,this.updater=Oe||ne}te.prototype.isReactComponent={},te.prototype.setState=function(ge,qe){if(typeof ge!="object"&&typeof ge!="function"&&ge!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ge,qe,"setState")},te.prototype.forceUpdate=function(ge){this.updater.enqueueForceUpdate(this,ge,"forceUpdate")};function le(){}le.prototype=te.prototype;function ce(ge,qe,Oe){this.props=ge,this.context=qe,this.refs=se,this.updater=Oe||ne}var me=ce.prototype=new le;me.constructor=ce,Q(me,te.prototype),me.isPureReactComponent=!0;var Ce=Array.isArray,_e={H:null,A:null,T:null,S:null,V:null},ze=Object.prototype.hasOwnProperty;function Z(ge,qe,Oe,Be,rt,Nt){return Oe=Nt.ref,{$$typeof:o,type:ge,key:qe,ref:Oe!==void 0?Oe:null,props:Nt}}function J(ge,qe){return Z(ge.type,qe,void 0,void 0,void 0,ge.props)}function $(ge){return typeof ge=="object"&&ge!==null&&ge.$$typeof===o}function fe(ge){var qe={"=":"=0",":":"=2"};return"$"+ge.replace(/[=:]/g,function(Oe){return qe[Oe]})}var ve=/\/+/g;function pe(ge,qe){return typeof ge=="object"&&ge!==null&&ge.key!=null?fe(""+ge.key):qe.toString(36)}function he(){}function Fe(ge){switch(ge.status){case"fulfilled":return ge.value;case"rejected":throw ge.reason;default:switch(typeof ge.status=="string"?ge.then(he,he):(ge.status="pending",ge.then(function(qe){ge.status==="pending"&&(ge.status="fulfilled",ge.value=qe)},function(qe){ge.status==="pending"&&(ge.status="rejected",ge.reason=qe)})),ge.status){case"fulfilled":return ge.value;case"rejected":throw ge.reason}}throw ge}function st(ge,qe,Oe,Be,rt){var Nt=typeof ge;(Nt==="undefined"||Nt==="boolean")&&(ge=null);var $e=!1;if(ge===null)$e=!0;else switch(Nt){case"bigint":case"string":case"number":$e=!0;break;case"object":switch(ge.$$typeof){case o:case i:$e=!0;break;case x:return $e=ge._init,st($e(ge._payload),qe,Oe,Be,rt)}}if($e)return rt=rt(ge),$e=Be===""?"."+pe(ge,0):Be,Ce(rt)?(Oe="",$e!=null&&(Oe=$e.replace(ve,"$&/")+"/"),st(rt,qe,Oe,"",function(Bt){return Bt})):rt!=null&&($(rt)&&(rt=J(rt,Oe+(rt.key==null||ge&&ge.key===rt.key?"":(""+rt.key).replace(ve,"$&/")+"/")+$e)),qe.push(rt)),1;$e=0;var mt=Be===""?".":Be+":";if(Ce(ge))for(var bt=0;bt<ge.length;bt++)Be=ge[bt],Nt=mt+pe(Be,bt),$e+=st(Be,qe,Oe,Nt,rt);else if(bt=W(ge),typeof bt=="function")for(ge=bt.call(ge),bt=0;!(Be=ge.next()).done;)Be=Be.value,Nt=mt+pe(Be,bt++),$e+=st(Be,qe,Oe,Nt,rt);else if(Nt==="object"){if(typeof ge.then=="function")return st(Fe(ge),qe,Oe,Be,rt);throw qe=String(ge),Error("Objects are not valid as a React child (found: "+(qe==="[object Object]"?"object with keys {"+Object.keys(ge).join(", ")+"}":qe)+"). If you meant to render a collection of children, use an array instead.")}return $e}function we(ge,qe,Oe){if(ge==null)return ge;var Be=[],rt=0;return st(ge,Be,"","",function(Nt){return qe.call(Oe,Nt,rt++)}),Be}function je(ge){if(ge._status===-1){var qe=ge._result;qe=qe(),qe.then(function(Oe){(ge._status===0||ge._status===-1)&&(ge._status=1,ge._result=Oe)},function(Oe){(ge._status===0||ge._status===-1)&&(ge._status=2,ge._result=Oe)}),ge._status===-1&&(ge._status=0,ge._result=qe)}if(ge._status===1)return ge._result.default;throw ge._result}var nt=typeof reportError=="function"?reportError:function(ge){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var qe=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ge=="object"&&ge!==null&&typeof ge.message=="string"?String(ge.message):String(ge),error:ge});if(!window.dispatchEvent(qe))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",ge);return}console.error(ge)};function Et(){}return jn.Children={map:we,forEach:function(ge,qe,Oe){we(ge,function(){qe.apply(this,arguments)},Oe)},count:function(ge){var qe=0;return we(ge,function(){qe++}),qe},toArray:function(ge){return we(ge,function(qe){return qe})||[]},only:function(ge){if(!$(ge))throw Error("React.Children.only expected to receive a single React element child.");return ge}},jn.Component=te,jn.Fragment=a,jn.Profiler=f,jn.PureComponent=ce,jn.StrictMode=d,jn.Suspense=N,jn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=_e,jn.__COMPILER_RUNTIME={__proto__:null,c:function(ge){return _e.H.useMemoCache(ge)}},jn.cache=function(ge){return function(){return ge.apply(null,arguments)}},jn.cloneElement=function(ge,qe,Oe){if(ge==null)throw Error("The argument must be a React element, but you passed "+ge+".");var Be=Q({},ge.props),rt=ge.key,Nt=void 0;if(qe!=null)for($e in qe.ref!==void 0&&(Nt=void 0),qe.key!==void 0&&(rt=""+qe.key),qe)!ze.call(qe,$e)||$e==="key"||$e==="__self"||$e==="__source"||$e==="ref"&&qe.ref===void 0||(Be[$e]=qe[$e]);var $e=arguments.length-2;if($e===1)Be.children=Oe;else if(1<$e){for(var mt=Array($e),bt=0;bt<$e;bt++)mt[bt]=arguments[bt+2];Be.children=mt}return Z(ge.type,rt,void 0,void 0,Nt,Be)},jn.createContext=function(ge){return ge={$$typeof:R,_currentValue:ge,_currentValue2:ge,_threadCount:0,Provider:null,Consumer:null},ge.Provider=ge,ge.Consumer={$$typeof:y,_context:ge},ge},jn.createElement=function(ge,qe,Oe){var Be,rt={},Nt=null;if(qe!=null)for(Be in qe.key!==void 0&&(Nt=""+qe.key),qe)ze.call(qe,Be)&&Be!=="key"&&Be!=="__self"&&Be!=="__source"&&(rt[Be]=qe[Be]);var $e=arguments.length-2;if($e===1)rt.children=Oe;else if(1<$e){for(var mt=Array($e),bt=0;bt<$e;bt++)mt[bt]=arguments[bt+2];rt.children=mt}if(ge&&ge.defaultProps)for(Be in $e=ge.defaultProps,$e)rt[Be]===void 0&&(rt[Be]=$e[Be]);return Z(ge,Nt,void 0,void 0,null,rt)},jn.createRef=function(){return{current:null}},jn.forwardRef=function(ge){return{$$typeof:w,render:ge}},jn.isValidElement=$,jn.lazy=function(ge){return{$$typeof:x,_payload:{_status:-1,_result:ge},_init:je}},jn.memo=function(ge,qe){return{$$typeof:O,type:ge,compare:qe===void 0?null:qe}},jn.startTransition=function(ge){var qe=_e.T,Oe={};_e.T=Oe;try{var Be=ge(),rt=_e.S;rt!==null&&rt(Oe,Be),typeof Be=="object"&&Be!==null&&typeof Be.then=="function"&&Be.then(Et,nt)}catch(Nt){nt(Nt)}finally{_e.T=qe}},jn.unstable_useCacheRefresh=function(){return _e.H.useCacheRefresh()},jn.use=function(ge){return _e.H.use(ge)},jn.useActionState=function(ge,qe,Oe){return _e.H.useActionState(ge,qe,Oe)},jn.useCallback=function(ge,qe){return _e.H.useCallback(ge,qe)},jn.useContext=function(ge){return _e.H.useContext(ge)},jn.useDebugValue=function(){},jn.useDeferredValue=function(ge,qe){return _e.H.useDeferredValue(ge,qe)},jn.useEffect=function(ge,qe,Oe){var Be=_e.H;if(typeof Oe=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Be.useEffect(ge,qe)},jn.useId=function(){return _e.H.useId()},jn.useImperativeHandle=function(ge,qe,Oe){return _e.H.useImperativeHandle(ge,qe,Oe)},jn.useInsertionEffect=function(ge,qe){return _e.H.useInsertionEffect(ge,qe)},jn.useLayoutEffect=function(ge,qe){return _e.H.useLayoutEffect(ge,qe)},jn.useMemo=function(ge,qe){return _e.H.useMemo(ge,qe)},jn.useOptimistic=function(ge,qe){return _e.H.useOptimistic(ge,qe)},jn.useReducer=function(ge,qe,Oe){return _e.H.useReducer(ge,qe,Oe)},jn.useRef=function(ge){return _e.H.useRef(ge)},jn.useState=function(ge){return _e.H.useState(ge)},jn.useSyncExternalStore=function(ge,qe,Oe){return _e.H.useSyncExternalStore(ge,qe,Oe)},jn.useTransition=function(){return _e.H.useTransition()},jn.version="19.1.0",jn}var eG;function RI(){return eG||(eG=1,UL.exports=Mee()),UL.exports}var K=RI();const Hn=TR(K);var jL={exports:{}},jT={},VL={exports:{}},FL={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tG;function Uee(){return tG||(tG=1,function(o){function i(we,je){var nt=we.length;we.push(je);e:for(;0<nt;){var Et=nt-1>>>1,ge=we[Et];if(0<f(ge,je))we[Et]=je,we[nt]=ge,nt=Et;else break e}}function a(we){return we.length===0?null:we[0]}function d(we){if(we.length===0)return null;var je=we[0],nt=we.pop();if(nt!==je){we[0]=nt;e:for(var Et=0,ge=we.length,qe=ge>>>1;Et<qe;){var Oe=2*(Et+1)-1,Be=we[Oe],rt=Oe+1,Nt=we[rt];if(0>f(Be,nt))rt<ge&&0>f(Nt,Be)?(we[Et]=Nt,we[rt]=nt,Et=rt):(we[Et]=Be,we[Oe]=nt,Et=Oe);else if(rt<ge&&0>f(Nt,nt))we[Et]=Nt,we[rt]=nt,Et=rt;else break e}}return je}function f(we,je){var nt=we.sortIndex-je.sortIndex;return nt!==0?nt:we.id-je.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var y=performance;o.unstable_now=function(){return y.now()}}else{var R=Date,w=R.now();o.unstable_now=function(){return R.now()-w}}var N=[],O=[],x=1,G=null,W=3,ne=!1,Q=!1,se=!1,te=!1,le=typeof setTimeout=="function"?setTimeout:null,ce=typeof clearTimeout=="function"?clearTimeout:null,me=typeof setImmediate<"u"?setImmediate:null;function Ce(we){for(var je=a(O);je!==null;){if(je.callback===null)d(O);else if(je.startTime<=we)d(O),je.sortIndex=je.expirationTime,i(N,je);else break;je=a(O)}}function _e(we){if(se=!1,Ce(we),!Q)if(a(N)!==null)Q=!0,ze||(ze=!0,pe());else{var je=a(O);je!==null&&st(_e,je.startTime-we)}}var ze=!1,Z=-1,J=5,$=-1;function fe(){return te?!0:!(o.unstable_now()-$<J)}function ve(){if(te=!1,ze){var we=o.unstable_now();$=we;var je=!0;try{e:{Q=!1,se&&(se=!1,ce(Z),Z=-1),ne=!0;var nt=W;try{t:{for(Ce(we),G=a(N);G!==null&&!(G.expirationTime>we&&fe());){var Et=G.callback;if(typeof Et=="function"){G.callback=null,W=G.priorityLevel;var ge=Et(G.expirationTime<=we);if(we=o.unstable_now(),typeof ge=="function"){G.callback=ge,Ce(we),je=!0;break t}G===a(N)&&d(N),Ce(we)}else d(N);G=a(N)}if(G!==null)je=!0;else{var qe=a(O);qe!==null&&st(_e,qe.startTime-we),je=!1}}break e}finally{G=null,W=nt,ne=!1}je=void 0}}finally{je?pe():ze=!1}}}var pe;if(typeof me=="function")pe=function(){me(ve)};else if(typeof MessageChannel<"u"){var he=new MessageChannel,Fe=he.port2;he.port1.onmessage=ve,pe=function(){Fe.postMessage(null)}}else pe=function(){le(ve,0)};function st(we,je){Z=le(function(){we(o.unstable_now())},je)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(we){we.callback=null},o.unstable_forceFrameRate=function(we){0>we||125<we?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):J=0<we?Math.floor(1e3/we):5},o.unstable_getCurrentPriorityLevel=function(){return W},o.unstable_next=function(we){switch(W){case 1:case 2:case 3:var je=3;break;default:je=W}var nt=W;W=je;try{return we()}finally{W=nt}},o.unstable_requestPaint=function(){te=!0},o.unstable_runWithPriority=function(we,je){switch(we){case 1:case 2:case 3:case 4:case 5:break;default:we=3}var nt=W;W=we;try{return je()}finally{W=nt}},o.unstable_scheduleCallback=function(we,je,nt){var Et=o.unstable_now();switch(typeof nt=="object"&&nt!==null?(nt=nt.delay,nt=typeof nt=="number"&&0<nt?Et+nt:Et):nt=Et,we){case 1:var ge=-1;break;case 2:ge=250;break;case 5:ge=1073741823;break;case 4:ge=1e4;break;default:ge=5e3}return ge=nt+ge,we={id:x++,callback:je,priorityLevel:we,startTime:nt,expirationTime:ge,sortIndex:-1},nt>Et?(we.sortIndex=nt,i(O,we),a(N)===null&&we===a(O)&&(se?(ce(Z),Z=-1):se=!0,st(_e,nt-Et))):(we.sortIndex=ge,i(N,we),Q||ne||(Q=!0,ze||(ze=!0,pe()))),we},o.unstable_shouldYield=fe,o.unstable_wrapCallback=function(we){var je=W;return function(){var nt=W;W=je;try{return we.apply(this,arguments)}finally{W=nt}}}}(FL)),FL}var nG;function jee(){return nG||(nG=1,VL.exports=Uee()),VL.exports}var BL={exports:{}},pa={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iG;function Vee(){if(iG)return pa;iG=1;var o=RI();function i(N){var O="https://react.dev/errors/"+N;if(1<arguments.length){O+="?args[]="+encodeURIComponent(arguments[1]);for(var x=2;x<arguments.length;x++)O+="&args[]="+encodeURIComponent(arguments[x])}return"Minified React error #"+N+"; visit "+O+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var d={d:{f:a,r:function(){throw Error(i(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},f=Symbol.for("react.portal");function y(N,O,x){var G=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:f,key:G==null?null:""+G,children:N,containerInfo:O,implementation:x}}var R=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function w(N,O){if(N==="font")return"";if(typeof O=="string")return O==="use-credentials"?O:""}return pa.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=d,pa.createPortal=function(N,O){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!O||O.nodeType!==1&&O.nodeType!==9&&O.nodeType!==11)throw Error(i(299));return y(N,O,null,x)},pa.flushSync=function(N){var O=R.T,x=d.p;try{if(R.T=null,d.p=2,N)return N()}finally{R.T=O,d.p=x,d.d.f()}},pa.preconnect=function(N,O){typeof N=="string"&&(O?(O=O.crossOrigin,O=typeof O=="string"?O==="use-credentials"?O:"":void 0):O=null,d.d.C(N,O))},pa.prefetchDNS=function(N){typeof N=="string"&&d.d.D(N)},pa.preinit=function(N,O){if(typeof N=="string"&&O&&typeof O.as=="string"){var x=O.as,G=w(x,O.crossOrigin),W=typeof O.integrity=="string"?O.integrity:void 0,ne=typeof O.fetchPriority=="string"?O.fetchPriority:void 0;x==="style"?d.d.S(N,typeof O.precedence=="string"?O.precedence:void 0,{crossOrigin:G,integrity:W,fetchPriority:ne}):x==="script"&&d.d.X(N,{crossOrigin:G,integrity:W,fetchPriority:ne,nonce:typeof O.nonce=="string"?O.nonce:void 0})}},pa.preinitModule=function(N,O){if(typeof N=="string")if(typeof O=="object"&&O!==null){if(O.as==null||O.as==="script"){var x=w(O.as,O.crossOrigin);d.d.M(N,{crossOrigin:x,integrity:typeof O.integrity=="string"?O.integrity:void 0,nonce:typeof O.nonce=="string"?O.nonce:void 0})}}else O==null&&d.d.M(N)},pa.preload=function(N,O){if(typeof N=="string"&&typeof O=="object"&&O!==null&&typeof O.as=="string"){var x=O.as,G=w(x,O.crossOrigin);d.d.L(N,x,{crossOrigin:G,integrity:typeof O.integrity=="string"?O.integrity:void 0,nonce:typeof O.nonce=="string"?O.nonce:void 0,type:typeof O.type=="string"?O.type:void 0,fetchPriority:typeof O.fetchPriority=="string"?O.fetchPriority:void 0,referrerPolicy:typeof O.referrerPolicy=="string"?O.referrerPolicy:void 0,imageSrcSet:typeof O.imageSrcSet=="string"?O.imageSrcSet:void 0,imageSizes:typeof O.imageSizes=="string"?O.imageSizes:void 0,media:typeof O.media=="string"?O.media:void 0})}},pa.preloadModule=function(N,O){if(typeof N=="string")if(O){var x=w(O.as,O.crossOrigin);d.d.m(N,{as:typeof O.as=="string"&&O.as!=="script"?O.as:void 0,crossOrigin:x,integrity:typeof O.integrity=="string"?O.integrity:void 0})}else d.d.m(N)},pa.requestFormReset=function(N){d.d.r(N)},pa.unstable_batchedUpdates=function(N,O){return N(O)},pa.useFormState=function(N,O,x){return R.H.useFormState(N,O,x)},pa.useFormStatus=function(){return R.H.useHostTransitionStatus()},pa.version="19.1.0",pa}var rG;function v9(){if(rG)return BL.exports;rG=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(i){console.error(i)}}return o(),BL.exports=Vee(),BL.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sG;function Fee(){if(sG)return jT;sG=1;var o=jee(),i=RI(),a=v9();function d(c){var u="https://react.dev/errors/"+c;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var _=2;_<arguments.length;_++)u+="&args[]="+encodeURIComponent(arguments[_])}return"Minified React error #"+c+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function f(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function y(c){var u=c,_=c;if(c.alternate)for(;u.return;)u=u.return;else{c=u;do u=c,(u.flags&4098)!==0&&(_=u.return),c=u.return;while(c)}return u.tag===3?_:null}function R(c){if(c.tag===13){var u=c.memoizedState;if(u===null&&(c=c.alternate,c!==null&&(u=c.memoizedState)),u!==null)return u.dehydrated}return null}function w(c){if(y(c)!==c)throw Error(d(188))}function N(c){var u=c.alternate;if(!u){if(u=y(c),u===null)throw Error(d(188));return u!==c?null:c}for(var _=c,S=u;;){var A=_.return;if(A===null)break;var P=A.alternate;if(P===null){if(S=A.return,S!==null){_=S;continue}break}if(A.child===P.child){for(P=A.child;P;){if(P===_)return w(A),c;if(P===S)return w(A),u;P=P.sibling}throw Error(d(188))}if(_.return!==S.return)_=A,S=P;else{for(var q=!1,ie=A.child;ie;){if(ie===_){q=!0,_=A,S=P;break}if(ie===S){q=!0,S=A,_=P;break}ie=ie.sibling}if(!q){for(ie=P.child;ie;){if(ie===_){q=!0,_=P,S=A;break}if(ie===S){q=!0,S=P,_=A;break}ie=ie.sibling}if(!q)throw Error(d(189))}}if(_.alternate!==S)throw Error(d(190))}if(_.tag!==3)throw Error(d(188));return _.stateNode.current===_?c:u}function O(c){var u=c.tag;if(u===5||u===26||u===27||u===6)return c;for(c=c.child;c!==null;){if(u=O(c),u!==null)return u;c=c.sibling}return null}var x=Object.assign,G=Symbol.for("react.element"),W=Symbol.for("react.transitional.element"),ne=Symbol.for("react.portal"),Q=Symbol.for("react.fragment"),se=Symbol.for("react.strict_mode"),te=Symbol.for("react.profiler"),le=Symbol.for("react.provider"),ce=Symbol.for("react.consumer"),me=Symbol.for("react.context"),Ce=Symbol.for("react.forward_ref"),_e=Symbol.for("react.suspense"),ze=Symbol.for("react.suspense_list"),Z=Symbol.for("react.memo"),J=Symbol.for("react.lazy"),$=Symbol.for("react.activity"),fe=Symbol.for("react.memo_cache_sentinel"),ve=Symbol.iterator;function pe(c){return c===null||typeof c!="object"?null:(c=ve&&c[ve]||c["@@iterator"],typeof c=="function"?c:null)}var he=Symbol.for("react.client.reference");function Fe(c){if(c==null)return null;if(typeof c=="function")return c.$$typeof===he?null:c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case Q:return"Fragment";case te:return"Profiler";case se:return"StrictMode";case _e:return"Suspense";case ze:return"SuspenseList";case $:return"Activity"}if(typeof c=="object")switch(c.$$typeof){case ne:return"Portal";case me:return(c.displayName||"Context")+".Provider";case ce:return(c._context.displayName||"Context")+".Consumer";case Ce:var u=c.render;return c=c.displayName,c||(c=u.displayName||u.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case Z:return u=c.displayName||null,u!==null?u:Fe(c.type)||"Memo";case J:u=c._payload,c=c._init;try{return Fe(c(u))}catch{}}return null}var st=Array.isArray,we=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,je=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,nt={pending:!1,data:null,method:null,action:null},Et=[],ge=-1;function qe(c){return{current:c}}function Oe(c){0>ge||(c.current=Et[ge],Et[ge]=null,ge--)}function Be(c,u){ge++,Et[ge]=c.current,c.current=u}var rt=qe(null),Nt=qe(null),$e=qe(null),mt=qe(null);function bt(c,u){switch(Be($e,u),Be(Nt,c),Be(rt,null),u.nodeType){case 9:case 11:c=(c=u.documentElement)&&(c=c.namespaceURI)?oC(c):0;break;default:if(c=u.tagName,u=u.namespaceURI)u=oC(u),c=cC(u,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}Oe(rt),Be(rt,c)}function Bt(){Oe(rt),Oe(Nt),Oe($e)}function fn(c){c.memoizedState!==null&&Be(mt,c);var u=rt.current,_=cC(u,c.type);u!==_&&(Be(Nt,c),Be(rt,_))}function vn(c){Nt.current===c&&(Oe(rt),Oe(Nt)),mt.current===c&&(Oe(mt),rm._currentValue=nt)}var qi=Object.prototype.hasOwnProperty,yt=o.unstable_scheduleCallback,Vt=o.unstable_cancelCallback,gt=o.unstable_shouldYield,Zt=o.unstable_requestPaint,rn=o.unstable_now,kn=o.unstable_getCurrentPriorityLevel,ui=o.unstable_ImmediatePriority,Zr=o.unstable_UserBlockingPriority,_r=o.unstable_NormalPriority,Ko=o.unstable_LowPriority,Qs=o.unstable_IdlePriority,Ti=o.log,Fa=o.unstable_setDisableYieldValue,Gt=null,Me=null;function un(c){if(typeof Ti=="function"&&Fa(c),Me&&typeof Me.setStrictMode=="function")try{Me.setStrictMode(Gt,c)}catch{}}var gn=Math.clz32?Math.clz32:Ki,Ai=Math.log,Ea=Math.LN2;function Ki(c){return c>>>=0,c===0?32:31-(Ai(c)/Ea|0)|0}var gr=256,cr=4194304;function Ts(c){var u=c&42;if(u!==0)return u;switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return c&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return c}}function Yo(c,u,_){var S=c.pendingLanes;if(S===0)return 0;var A=0,P=c.suspendedLanes,q=c.pingedLanes;c=c.warmLanes;var ie=S&134217727;return ie!==0?(S=ie&~P,S!==0?A=Ts(S):(q&=ie,q!==0?A=Ts(q):_||(_=ie&~c,_!==0&&(A=Ts(_))))):(ie=S&~P,ie!==0?A=Ts(ie):q!==0?A=Ts(q):_||(_=S&~c,_!==0&&(A=Ts(_)))),A===0?0:u!==0&&u!==A&&(u&P)===0&&(P=A&-A,_=u&-u,P>=_||P===32&&(_&4194048)!==0)?u:A}function Xo(c,u){return(c.pendingLanes&~(c.suspendedLanes&~c.pingedLanes)&u)===0}function ya(c,u){switch(c){case 1:case 2:case 4:case 8:case 64:return u+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Vc(){var c=gr;return gr<<=1,(gr&4194048)===0&&(gr=256),c}function xl(){var c=cr;return cr<<=1,(cr&62914560)===0&&(cr=4194304),c}function Ba(c){for(var u=[],_=0;31>_;_++)u.push(c);return u}function Fc(c,u){c.pendingLanes|=u,u!==268435456&&(c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0)}function Kp(c,u,_,S,A,P){var q=c.pendingLanes;c.pendingLanes=_,c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0,c.expiredLanes&=_,c.entangledLanes&=_,c.errorRecoveryDisabledLanes&=_,c.shellSuspendCounter=0;var ie=c.entanglements,Se=c.expirationTimes,ke=c.hiddenUpdates;for(_=q&~_;0<_;){var Ze=31-gn(_),dt=1<<Ze;ie[Ze]=0,Se[Ze]=-1;var Ge=ke[Ze];if(Ge!==null)for(ke[Ze]=null,Ze=0;Ze<Ge.length;Ze++){var He=Ge[Ze];He!==null&&(He.lane&=-536870913)}_&=~dt}S!==0&&$s(c,S,0),P!==0&&A===0&&c.tag!==0&&(c.suspendedLanes|=P&~(q&~u))}function $s(c,u,_){c.pendingLanes|=u,c.suspendedLanes&=~u;var S=31-gn(u);c.entangledLanes|=u,c.entanglements[S]=c.entanglements[S]|1073741824|_&4194090}function Yp(c,u){var _=c.entangledLanes|=u;for(c=c.entanglements;_;){var S=31-gn(_),A=1<<S;A&u|c[S]&u&&(c[S]|=u),_&=~A}}function va(c){switch(c){case 2:c=1;break;case 8:c=4;break;case 32:c=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:c=128;break;case 268435456:c=134217728;break;default:c=0}return c}function ch(c){return c&=-c,2<c?8<c?(c&134217727)!==0?32:268435456:8:2}function Ml(){var c=je.p;return c!==0?c:(c=window.event,c===void 0?32:wC(c.type))}function p_(c,u){var _=je.p;try{return je.p=c,u()}finally{je.p=_}}var zn=Math.random().toString(36).slice(2),Ur="__reactFiber$"+zn,Ar="__reactProps$"+zn,ks="__reactContainer$"+zn,lh="__reactEvents$"+zn,f_="__reactListeners$"+zn,Bc="__reactHandles$"+zn,m_="__reactResources$"+zn,Ul="__reactMarker$"+zn;function Gc(c){delete c[Ur],delete c[Ar],delete c[lh],delete c[f_],delete c[Bc]}function Hc(c){var u=c[Ur];if(u)return u;for(var _=c.parentNode;_;){if(u=_[ks]||_[Ur]){if(_=u.alternate,u.child!==null||_!==null&&_.child!==null)for(c=hC(c);c!==null;){if(_=c[Ur])return _;c=hC(c)}return u}c=_,_=c.parentNode}return null}function Jo(c){if(c=c[Ur]||c[ks]){var u=c.tag;if(u===5||u===6||u===13||u===26||u===27||u===3)return c}return null}function Qo(c){var u=c.tag;if(u===5||u===26||u===27||u===6)return c.stateNode;throw Error(d(33))}function Rs(c){var u=c[m_];return u||(u=c[m_]={hoistableStyles:new Map,hoistableScripts:new Map}),u}function lr(c){c[Ul]=!0}var Hd=new Set,zd={};function bs(c,u){zc(c,u),zc(c+"Capture",u)}function zc(c,u){for(zd[c]=u,c=0;c<u.length;c++)Hd.add(u[c])}var __=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Sa={},Wd={};function g_(c){return qi.call(Wd,c)?!0:qi.call(Sa,c)?!1:__.test(c)?Wd[c]=!0:(Sa[c]=!0,!1)}function ki(c,u,_){if(g_(u))if(_===null)c.removeAttribute(u);else{switch(typeof _){case"undefined":case"function":case"symbol":c.removeAttribute(u);return;case"boolean":var S=u.toLowerCase().slice(0,5);if(S!=="data-"&&S!=="aria-"){c.removeAttribute(u);return}}c.setAttribute(u,""+_)}}function $o(c,u,_){if(_===null)c.removeAttribute(u);else{switch(typeof _){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(u);return}c.setAttribute(u,""+_)}}function hs(c,u,_,S){if(S===null)c.removeAttribute(_);else{switch(typeof S){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(_);return}c.setAttributeNS(u,_,""+S)}}var qd,E_;function Eo(c){if(qd===void 0)try{throw Error()}catch(_){var u=_.stack.trim().match(/\n( *(at )?)/);qd=u&&u[1]||"",E_=-1<_.stack.indexOf(`
    at`)?" (<anonymous>)":-1<_.stack.indexOf("@")?"@unknown:0:0":""}return`
`+qd+c+E_}var dh=!1;function Kd(c,u){if(!c||dh)return"";dh=!0;var _=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var S={DetermineComponentFrameRoot:function(){try{if(u){var dt=function(){throw Error()};if(Object.defineProperty(dt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(dt,[])}catch(He){var Ge=He}Reflect.construct(c,[],dt)}else{try{dt.call()}catch(He){Ge=He}c.call(dt.prototype)}}else{try{throw Error()}catch(He){Ge=He}(dt=c())&&typeof dt.catch=="function"&&dt.catch(function(){})}}catch(He){if(He&&Ge&&typeof He.stack=="string")return[He.stack,Ge.stack]}return[null,null]}};S.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var A=Object.getOwnPropertyDescriptor(S.DetermineComponentFrameRoot,"name");A&&A.configurable&&Object.defineProperty(S.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var P=S.DetermineComponentFrameRoot(),q=P[0],ie=P[1];if(q&&ie){var Se=q.split(`
`),ke=ie.split(`
`);for(A=S=0;S<Se.length&&!Se[S].includes("DetermineComponentFrameRoot");)S++;for(;A<ke.length&&!ke[A].includes("DetermineComponentFrameRoot");)A++;if(S===Se.length||A===ke.length)for(S=Se.length-1,A=ke.length-1;1<=S&&0<=A&&Se[S]!==ke[A];)A--;for(;1<=S&&0<=A;S--,A--)if(Se[S]!==ke[A]){if(S!==1||A!==1)do if(S--,A--,0>A||Se[S]!==ke[A]){var Ze=`
`+Se[S].replace(" at new "," at ");return c.displayName&&Ze.includes("<anonymous>")&&(Ze=Ze.replace("<anonymous>",c.displayName)),Ze}while(1<=S&&0<=A);break}}}finally{dh=!1,Error.prepareStackTrace=_}return(_=c?c.displayName||c.name:"")?Eo(_):""}function Xp(c){switch(c.tag){case 26:case 27:case 5:return Eo(c.type);case 16:return Eo("Lazy");case 13:return Eo("Suspense");case 19:return Eo("SuspenseList");case 0:case 15:return Kd(c.type,!1);case 11:return Kd(c.type.render,!1);case 1:return Kd(c.type,!0);case 31:return Eo("Activity");default:return""}}function uh(c){try{var u="";do u+=Xp(c),c=c.return;while(c);return u}catch(_){return`
Error generating stack: `+_.message+`
`+_.stack}}function xs(c){switch(typeof c){case"bigint":case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function Zo(c){var u=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(u==="checkbox"||u==="radio")}function Jp(c){var u=Zo(c)?"checked":"value",_=Object.getOwnPropertyDescriptor(c.constructor.prototype,u),S=""+c[u];if(!c.hasOwnProperty(u)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var A=_.get,P=_.set;return Object.defineProperty(c,u,{configurable:!0,get:function(){return A.call(this)},set:function(q){S=""+q,P.call(this,q)}}),Object.defineProperty(c,u,{enumerable:_.enumerable}),{getValue:function(){return S},setValue:function(q){S=""+q},stopTracking:function(){c._valueTracker=null,delete c[u]}}}}function hh(c){c._valueTracker||(c._valueTracker=Jp(c))}function hi(c){if(!c)return!1;var u=c._valueTracker;if(!u)return!0;var _=u.getValue(),S="";return c&&(S=Zo(c)?c.checked?"true":"false":c.value),c=S,c!==_?(u.setValue(c),!0):!1}function Yd(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}var y_=/[\n"\\]/g;function Er(c){return c.replace(y_,function(u){return"\\"+u.charCodeAt(0).toString(16)+" "})}function Ta(c,u,_,S,A,P,q,ie){c.name="",q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"?c.type=q:c.removeAttribute("type"),u!=null?q==="number"?(u===0&&c.value===""||c.value!=u)&&(c.value=""+xs(u)):c.value!==""+xs(u)&&(c.value=""+xs(u)):q!=="submit"&&q!=="reset"||c.removeAttribute("value"),u!=null?jl(c,q,xs(u)):_!=null?jl(c,q,xs(_)):S!=null&&c.removeAttribute("value"),A==null&&P!=null&&(c.defaultChecked=!!P),A!=null&&(c.checked=A&&typeof A!="function"&&typeof A!="symbol"),ie!=null&&typeof ie!="function"&&typeof ie!="symbol"&&typeof ie!="boolean"?c.name=""+xs(ie):c.removeAttribute("name")}function Xd(c,u,_,S,A,P,q,ie){if(P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(c.type=P),u!=null||_!=null){if(!(P!=="submit"&&P!=="reset"||u!=null))return;_=_!=null?""+xs(_):"",u=u!=null?""+xs(u):_,ie||u===c.value||(c.value=u),c.defaultValue=u}S=S??A,S=typeof S!="function"&&typeof S!="symbol"&&!!S,c.checked=ie?c.checked:!!S,c.defaultChecked=!!S,q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"&&(c.name=q)}function jl(c,u,_){u==="number"&&Yd(c.ownerDocument)===c||c.defaultValue===""+_||(c.defaultValue=""+_)}function Wc(c,u,_,S){if(c=c.options,u){u={};for(var A=0;A<_.length;A++)u["$"+_[A]]=!0;for(_=0;_<c.length;_++)A=u.hasOwnProperty("$"+c[_].value),c[_].selected!==A&&(c[_].selected=A),A&&S&&(c[_].defaultSelected=!0)}else{for(_=""+xs(_),u=null,A=0;A<c.length;A++){if(c[A].value===_){c[A].selected=!0,S&&(c[A].defaultSelected=!0);return}u!==null||c[A].disabled||(u=c[A])}u!==null&&(u.selected=!0)}}function Ii(c,u,_){if(u!=null&&(u=""+xs(u),u!==c.value&&(c.value=u),_==null)){c.defaultValue!==u&&(c.defaultValue=u);return}c.defaultValue=_!=null?""+xs(_):""}function Jd(c,u,_,S){if(u==null){if(S!=null){if(_!=null)throw Error(d(92));if(st(S)){if(1<S.length)throw Error(d(93));S=S[0]}_=S}_==null&&(_=""),u=_}_=xs(u),c.defaultValue=_,S=c.textContent,S===_&&S!==""&&S!==null&&(c.value=S)}function Zs(c,u){if(u){var _=c.firstChild;if(_&&_===c.lastChild&&_.nodeType===3){_.nodeValue=u;return}}c.textContent=u}var Vl=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ph(c,u,_){var S=u.indexOf("--")===0;_==null||typeof _=="boolean"||_===""?S?c.setProperty(u,""):u==="float"?c.cssFloat="":c[u]="":S?c.setProperty(u,_):typeof _!="number"||_===0||Vl.has(u)?u==="float"?c.cssFloat=_:c[u]=(""+_).trim():c[u]=_+"px"}function Qp(c,u,_){if(u!=null&&typeof u!="object")throw Error(d(62));if(c=c.style,_!=null){for(var S in _)!_.hasOwnProperty(S)||u!=null&&u.hasOwnProperty(S)||(S.indexOf("--")===0?c.setProperty(S,""):S==="float"?c.cssFloat="":c[S]="");for(var A in u)S=u[A],u.hasOwnProperty(A)&&_[A]!==S&&ph(c,A,S)}else for(var P in u)u.hasOwnProperty(P)&&ph(c,P,u[P])}function Qd(c){if(c.indexOf("-")===-1)return!1;switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ny=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),v_=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function fh(c){return v_.test(""+c)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":c}var qc=null;function Ga(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var Kc=null,Yc=null;function $p(c){var u=Jo(c);if(u&&(c=u.stateNode)){var _=c[Ar]||null;e:switch(c=u.stateNode,u.type){case"input":if(Ta(c,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name),u=_.name,_.type==="radio"&&u!=null){for(_=c;_.parentNode;)_=_.parentNode;for(_=_.querySelectorAll('input[name="'+Er(""+u)+'"][type="radio"]'),u=0;u<_.length;u++){var S=_[u];if(S!==c&&S.form===c.form){var A=S[Ar]||null;if(!A)throw Error(d(90));Ta(S,A.value,A.defaultValue,A.defaultValue,A.checked,A.defaultChecked,A.type,A.name)}}for(u=0;u<_.length;u++)S=_[u],S.form===c.form&&hi(S)}break e;case"textarea":Ii(c,_.value,_.defaultValue);break e;case"select":u=_.value,u!=null&&Wc(c,!!_.multiple,u,!1)}}}var ec=!1;function S_(c,u,_){if(ec)return c(u,_);ec=!0;try{var S=c(u);return S}finally{if(ec=!1,(Kc!==null||Yc!==null)&&(Cu(),Kc&&(u=Kc,c=Yc,Yc=Kc=null,$p(u),c)))for(u=0;u<c.length;u++)$p(c[u])}}function Fl(c,u){var _=c.stateNode;if(_===null)return null;var S=_[Ar]||null;if(S===null)return null;_=S[u];e:switch(u){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(c=c.type,S=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!S;break e;default:c=!1}if(c)return null;if(_&&typeof _!="function")throw Error(d(231,u,typeof _));return _}var yo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ha=!1;if(yo)try{var $d={};Object.defineProperty($d,"passive",{get:function(){Ha=!0}}),window.addEventListener("test",$d,$d),window.removeEventListener("test",$d,$d)}catch{Ha=!1}var ea=null,Bl=null,Xc=null;function Zp(){if(Xc)return Xc;var c,u=Bl,_=u.length,S,A="value"in ea?ea.value:ea.textContent,P=A.length;for(c=0;c<_&&u[c]===A[c];c++);var q=_-c;for(S=1;S<=q&&u[_-S]===A[P-S];S++);return Xc=A.slice(c,1<S?1-S:void 0)}function tc(c){var u=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&u===13&&(c=13)):c=u,c===10&&(c=13),32<=c||c===13?c:0}function vo(){return!0}function ef(){return!1}function es(c){function u(_,S,A,P,q){this._reactName=_,this._targetInst=A,this.type=S,this.nativeEvent=P,this.target=q,this.currentTarget=null;for(var ie in c)c.hasOwnProperty(ie)&&(_=c[ie],this[ie]=_?_(P):P[ie]);return this.isDefaultPrevented=(P.defaultPrevented!=null?P.defaultPrevented:P.returnValue===!1)?vo:ef,this.isPropagationStopped=ef,this}return x(u.prototype,{preventDefault:function(){this.defaultPrevented=!0;var _=this.nativeEvent;_&&(_.preventDefault?_.preventDefault():typeof _.returnValue!="unknown"&&(_.returnValue=!1),this.isDefaultPrevented=vo)},stopPropagation:function(){var _=this.nativeEvent;_&&(_.stopPropagation?_.stopPropagation():typeof _.cancelBubble!="unknown"&&(_.cancelBubble=!0),this.isPropagationStopped=vo)},persist:function(){},isPersistent:vo}),u}var vi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ra=es(vi),ts=x({},vi,{view:0,detail:0}),tf=es(ts),mh,_h,nc,yr=x({},ts,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nu,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==nc&&(nc&&c.type==="mousemove"?(mh=c.screenX-nc.screenX,_h=c.screenY-nc.screenY):_h=mh=0,nc=c),mh)},movementY:function(c){return"movementY"in c?c.movementY:_h}}),za=es(yr),T_=x({},yr,{dataTransfer:0}),Oy=es(T_),ic=x({},ts,{relatedTarget:0}),Zd=es(ic),nf=x({},vi,{animationName:0,elapsedTime:0,pseudoElement:0}),Gl=es(nf),R_=x({},vi,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),Hl=es(R_),rf=x({},vi,{data:0}),eu=es(rf),tu={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},b_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Jc(c){var u=this.nativeEvent;return u.getModifierState?u.getModifierState(c):(c=rc[c])?!!u[c]:!1}function nu(){return Jc}var C_=x({},ts,{key:function(c){if(c.key){var u=tu[c.key]||c.key;if(u!=="Unidentified")return u}return c.type==="keypress"?(c=tc(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?b_[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nu,charCode:function(c){return c.type==="keypress"?tc(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?tc(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),gh=es(C_),w_=x({},yr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sf=es(w_),ta=x({},ts,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nu}),A_=es(ta),Qc=x({},vi,{propertyName:0,elapsedTime:0,pseudoElement:0}),af=es(Qc),I_=x({},yr,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),dn=es(I_),Ms=x({},vi,{newState:0,oldState:0}),N_=es(Ms),O_=[9,13,27,32],sc=yo&&"CompositionEvent"in window,b=null;yo&&"documentMode"in document&&(b=document.documentMode);var j=yo&&"TextEvent"in window&&!b,z=yo&&(!sc||b&&8<b&&11>=b),oe=" ",Pe=!1;function Ke(c,u){switch(c){case"keyup":return O_.indexOf(u.keyCode)!==-1;case"keydown":return u.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Tt(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var $n=!1;function jr(c,u){switch(c){case"compositionend":return Tt(u);case"keypress":return u.which!==32?null:(Pe=!0,oe);case"textInput":return c=u.data,c===oe&&Pe?null:c;default:return null}}function Cn(c,u){if($n)return c==="compositionend"||!sc&&Ke(c,u)?(c=Zp(),Xc=Bl=ea=null,$n=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(u.ctrlKey||u.altKey||u.metaKey)||u.ctrlKey&&u.altKey){if(u.char&&1<u.char.length)return u.char;if(u.which)return String.fromCharCode(u.which)}return null;case"compositionend":return z&&u.locale!=="ko"?null:u.data;default:return null}}var ns={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vr(c){var u=c&&c.nodeName&&c.nodeName.toLowerCase();return u==="input"?!!ns[c.type]:u==="textarea"}function $c(c,u,_,S){Kc?Yc?Yc.push(S):Yc=[S]:Kc=S,u=Qf(u,"onChange"),0<u.length&&(_=new Ra("onChange","change",null,_,S),c.push({event:_,listeners:u}))}var is=null,Wa=null;function of(c){Ag(c,0)}function D_(c){var u=Qo(c);if(hi(u))return c}function xR(c,u){if(c==="change")return u}var ba=!1;if(yo){var Dy;if(yo){var Py="oninput"in document;if(!Py){var MR=document.createElement("div");MR.setAttribute("oninput","return;"),Py=typeof MR.oninput=="function"}Dy=Py}else Dy=!1;ba=Dy&&(!document.documentMode||9<document.documentMode)}function UR(){is&&(is.detachEvent("onpropertychange",Ly),Wa=is=null)}function Ly(c){if(c.propertyName==="value"&&D_(Wa)){var u=[];$c(u,Wa,c,Ga(c)),S_(of,u)}}function aN(c,u,_){c==="focusin"?(UR(),is=u,Wa=_,is.attachEvent("onpropertychange",Ly)):c==="focusout"&&UR()}function oN(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return D_(Wa)}function jR(c,u){if(c==="click")return D_(u)}function ky(c,u){if(c==="input"||c==="change")return D_(u)}function cN(c,u){return c===u&&(c!==0||1/c===1/u)||c!==c&&u!==u}var Ca=typeof Object.is=="function"?Object.is:cN;function zl(c,u){if(Ca(c,u))return!0;if(typeof c!="object"||c===null||typeof u!="object"||u===null)return!1;var _=Object.keys(c),S=Object.keys(u);if(_.length!==S.length)return!1;for(S=0;S<_.length;S++){var A=_[S];if(!qi.call(u,A)||!Ca(c[A],u[A]))return!1}return!0}function VR(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function FR(c,u){var _=VR(c);c=0;for(var S;_;){if(_.nodeType===3){if(S=c+_.textContent.length,c<=u&&S>=u)return{node:_,offset:u-c};c=S}e:{for(;_;){if(_.nextSibling){_=_.nextSibling;break e}_=_.parentNode}_=void 0}_=VR(_)}}function BR(c,u){return c&&u?c===u?!0:c&&c.nodeType===3?!1:u&&u.nodeType===3?BR(c,u.parentNode):"contains"in c?c.contains(u):c.compareDocumentPosition?!!(c.compareDocumentPosition(u)&16):!1:!1}function Zc(c){c=c!=null&&c.ownerDocument!=null&&c.ownerDocument.defaultView!=null?c.ownerDocument.defaultView:window;for(var u=Yd(c.document);u instanceof c.HTMLIFrameElement;){try{var _=typeof u.contentWindow.location.href=="string"}catch{_=!1}if(_)c=u.contentWindow;else break;u=Yd(c.document)}return u}function xy(c){var u=c&&c.nodeName&&c.nodeName.toLowerCase();return u&&(u==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||u==="textarea"||c.contentEditable==="true")}var lN=yo&&"documentMode"in document&&11>=document.documentMode,Fr=null,My=null,cf=null,Uy=!1;function GR(c,u,_){var S=_.window===_?_.document:_.nodeType===9?_:_.ownerDocument;Uy||Fr==null||Fr!==Yd(S)||(S=Fr,"selectionStart"in S&&xy(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),cf&&zl(cf,S)||(cf=S,S=Qf(My,"onSelect"),0<S.length&&(u=new Ra("onSelect","select",null,u,_),c.push({event:u,listeners:S}),u.target=Fr)))}function Wl(c,u){var _={};return _[c.toLowerCase()]=u.toLowerCase(),_["Webkit"+c]="webkit"+u,_["Moz"+c]="moz"+u,_}var Eh={animationend:Wl("Animation","AnimationEnd"),animationiteration:Wl("Animation","AnimationIteration"),animationstart:Wl("Animation","AnimationStart"),transitionrun:Wl("Transition","TransitionRun"),transitionstart:Wl("Transition","TransitionStart"),transitioncancel:Wl("Transition","TransitionCancel"),transitionend:Wl("Transition","TransitionEnd")},jy={},HR={};yo&&(HR=document.createElement("div").style,"AnimationEvent"in window||(delete Eh.animationend.animation,delete Eh.animationiteration.animation,delete Eh.animationstart.animation),"TransitionEvent"in window||delete Eh.transitionend.transition);function ql(c){if(jy[c])return jy[c];if(!Eh[c])return c;var u=Eh[c],_;for(_ in u)if(u.hasOwnProperty(_)&&_ in HR)return jy[c]=u[_];return c}var zR=ql("animationend"),WR=ql("animationiteration"),P_=ql("animationstart"),Vy=ql("transitionrun"),dN=ql("transitionstart"),Ye=ql("transitioncancel"),qR=ql("transitionend"),KR=new Map,Fy="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Fy.push("scrollEnd");function So(c,u){KR.set(c,u),bs(u,[c])}var By=new WeakMap;function wa(c,u){if(typeof c=="object"&&c!==null){var _=By.get(c);return _!==void 0?_:(u={value:c,source:u,stack:uh(u)},By.set(c,u),u)}return{value:c,source:u,stack:uh(u)}}var qa=[],yh=0,Gy=0;function iu(){for(var c=yh,u=Gy=yh=0;u<c;){var _=qa[u];qa[u++]=null;var S=qa[u];qa[u++]=null;var A=qa[u];qa[u++]=null;var P=qa[u];if(qa[u++]=null,S!==null&&A!==null){var q=S.pending;q===null?A.next=A:(A.next=q.next,q.next=A),S.pending=A}P!==0&&lf(_,A,P)}}function Kl(c,u,_,S){qa[yh++]=c,qa[yh++]=u,qa[yh++]=_,qa[yh++]=S,Gy|=S,c.lanes|=S,c=c.alternate,c!==null&&(c.lanes|=S)}function Hy(c,u,_,S){return Kl(c,u,_,S),Sh(c)}function vh(c,u){return Kl(c,null,null,u),Sh(c)}function lf(c,u,_){c.lanes|=_;var S=c.alternate;S!==null&&(S.lanes|=_);for(var A=!1,P=c.return;P!==null;)P.childLanes|=_,S=P.alternate,S!==null&&(S.childLanes|=_),P.tag===22&&(c=P.stateNode,c===null||c._visibility&1||(A=!0)),c=P,P=P.return;return c.tag===3?(P=c.stateNode,A&&u!==null&&(A=31-gn(_),c=P.hiddenUpdates,S=c[A],S===null?c[A]=[u]:S.push(u),u.lane=_|536870912),P):null}function Sh(c){if(50<Yf)throw Yf=0,Fv=null,Error(d(185));for(var u=c.return;u!==null;)c=u,u=c.return;return c.tag===3?c.stateNode:null}var el={};function uN(c,u,_,S){this.tag=c,this.key=_,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=u,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Aa(c,u,_,S){return new uN(c,u,_,S)}function zy(c){return c=c.prototype,!(!c||!c.isReactComponent)}function tl(c,u){var _=c.alternate;return _===null?(_=Aa(c.tag,u,c.key,c.mode),_.elementType=c.elementType,_.type=c.type,_.stateNode=c.stateNode,_.alternate=c,c.alternate=_):(_.pendingProps=u,_.type=c.type,_.flags=0,_.subtreeFlags=0,_.deletions=null),_.flags=c.flags&65011712,_.childLanes=c.childLanes,_.lanes=c.lanes,_.child=c.child,_.memoizedProps=c.memoizedProps,_.memoizedState=c.memoizedState,_.updateQueue=c.updateQueue,u=c.dependencies,_.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext},_.sibling=c.sibling,_.index=c.index,_.ref=c.ref,_.refCleanup=c.refCleanup,_}function L_(c,u){c.flags&=65011714;var _=c.alternate;return _===null?(c.childLanes=0,c.lanes=u,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=_.childLanes,c.lanes=_.lanes,c.child=_.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=_.memoizedProps,c.memoizedState=_.memoizedState,c.updateQueue=_.updateQueue,c.type=_.type,u=_.dependencies,c.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext}),c}function k_(c,u,_,S,A,P){var q=0;if(S=c,typeof c=="function")zy(c)&&(q=1);else if(typeof c=="string")q=_S(c,_,rt.current)?26:c==="html"||c==="head"||c==="body"?27:5;else e:switch(c){case $:return c=Aa(31,_,u,A),c.elementType=$,c.lanes=P,c;case Q:return Yl(_.children,A,P,u);case se:q=8,A|=24;break;case te:return c=Aa(12,_,u,A|2),c.elementType=te,c.lanes=P,c;case _e:return c=Aa(13,_,u,A),c.elementType=_e,c.lanes=P,c;case ze:return c=Aa(19,_,u,A),c.elementType=ze,c.lanes=P,c;default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case le:case me:q=10;break e;case ce:q=9;break e;case Ce:q=11;break e;case Z:q=14;break e;case J:q=16,S=null;break e}q=29,_=Error(d(130,c===null?"null":typeof c,"")),S=null}return u=Aa(q,_,u,A),u.elementType=c,u.type=S,u.lanes=P,u}function Yl(c,u,_,S){return c=Aa(7,c,S,u),c.lanes=_,c}function na(c,u,_){return c=Aa(6,c,null,u),c.lanes=_,c}function Wy(c,u,_){return u=Aa(4,c.children!==null?c.children:[],c.key,u),u.lanes=_,u.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},u}var ac=[],Th=0,x_=null,M_=0,Ia=[],Ka=0,ru=null,nl=1,To="";function su(c,u){ac[Th++]=M_,ac[Th++]=x_,x_=c,M_=u}function qy(c,u,_){Ia[Ka++]=nl,Ia[Ka++]=To,Ia[Ka++]=ru,ru=c;var S=nl;c=To;var A=32-gn(S)-1;S&=~(1<<A),_+=1;var P=32-gn(u)+A;if(30<P){var q=A-A%5;P=(S&(1<<q)-1).toString(32),S>>=q,A-=q,nl=1<<32-gn(u)+A|_<<A|S,To=P+c}else nl=1<<P|_<<A|S,To=c}function U_(c){c.return!==null&&(su(c,1),qy(c,1,0))}function Ky(c){for(;c===x_;)x_=ac[--Th],ac[Th]=null,M_=ac[--Th],ac[Th]=null;for(;c===ru;)ru=Ia[--Ka],Ia[Ka]=null,To=Ia[--Ka],Ia[Ka]=null,nl=Ia[--Ka],Ia[Ka]=null}var Cs=null,Yi=null,pi=!1,au=null,oc=!1,Yy=Error(d(519));function ou(c){var u=Error(d(418,""));throw uf(wa(u,c)),Yy}function Xy(c){var u=c.stateNode,_=c.type,S=c.memoizedProps;switch(u[Ur]=c,u[Ar]=S,_){case"dialog":xn("cancel",u),xn("close",u);break;case"iframe":case"object":case"embed":xn("load",u);break;case"video":case"audio":for(_=0;_<Jh.length;_++)xn(Jh[_],u);break;case"source":xn("error",u);break;case"img":case"image":case"link":xn("error",u),xn("load",u);break;case"details":xn("toggle",u);break;case"input":xn("invalid",u),Xd(u,S.value,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name,!0),hh(u);break;case"select":xn("invalid",u);break;case"textarea":xn("invalid",u),Jd(u,S.value,S.defaultValue,S.children),hh(u)}_=S.children,typeof _!="string"&&typeof _!="number"&&typeof _!="bigint"||u.textContent===""+_||S.suppressHydrationWarning===!0||Dg(u.textContent,_)?(S.popover!=null&&(xn("beforetoggle",u),xn("toggle",u)),S.onScroll!=null&&xn("scroll",u),S.onScrollEnd!=null&&xn("scrollend",u),S.onClick!=null&&(u.onclick=$f),u=!0):u=!1,u||ou(c)}function j_(c){for(Cs=c.return;Cs;)switch(Cs.tag){case 5:case 13:oc=!1;return;case 27:case 3:oc=!0;return;default:Cs=Cs.return}}function df(c){if(c!==Cs)return!1;if(!pi)return j_(c),pi=!0,!1;var u=c.tag,_;if((_=u!==3&&u!==27)&&((_=u===5)&&(_=c.type,_=!(_!=="form"&&_!=="button")||lS(c.type,c.memoizedProps)),_=!_),_&&Yi&&ou(c),j_(c),u===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(d(317));e:{for(c=c.nextSibling,u=0;c;){if(c.nodeType===8)if(_=c.data,_==="/$"){if(u===0){Yi=Do(c.nextSibling);break e}u--}else _!=="$"&&_!=="$!"&&_!=="$?"||u++;c=c.nextSibling}Yi=null}}else u===27?(u=Yi,hd(c.type)?(c=hS,hS=null,Yi=c):Yi=u):Yi=Cs?Do(c.stateNode.nextSibling):null;return!0}function cu(){Yi=Cs=null,pi=!1}function YR(){var c=au;return c!==null&&(zr===null?zr=c:zr.push.apply(zr,c),au=null),c}function uf(c){au===null?au=[c]:au.push(c)}var Jy=qe(null),lu=null,il=null;function Xl(c,u,_){Be(Jy,u._currentValue),u._currentValue=_}function rl(c){c._currentValue=Jy.current,Oe(Jy)}function Qy(c,u,_){for(;c!==null;){var S=c.alternate;if((c.childLanes&u)!==u?(c.childLanes|=u,S!==null&&(S.childLanes|=u)):S!==null&&(S.childLanes&u)!==u&&(S.childLanes|=u),c===_)break;c=c.return}}function $y(c,u,_,S){var A=c.child;for(A!==null&&(A.return=c);A!==null;){var P=A.dependencies;if(P!==null){var q=A.child;P=P.firstContext;e:for(;P!==null;){var ie=P;P=A;for(var Se=0;Se<u.length;Se++)if(ie.context===u[Se]){P.lanes|=_,ie=P.alternate,ie!==null&&(ie.lanes|=_),Qy(P.return,_,c),S||(q=null);break e}P=ie.next}}else if(A.tag===18){if(q=A.return,q===null)throw Error(d(341));q.lanes|=_,P=q.alternate,P!==null&&(P.lanes|=_),Qy(q,_,c),q=null}else q=A.child;if(q!==null)q.return=A;else for(q=A;q!==null;){if(q===c){q=null;break}if(A=q.sibling,A!==null){A.return=q.return,q=A;break}q=q.return}A=q}}function hf(c,u,_,S){c=null;for(var A=u,P=!1;A!==null;){if(!P){if((A.flags&524288)!==0)P=!0;else if((A.flags&262144)!==0)break}if(A.tag===10){var q=A.alternate;if(q===null)throw Error(d(387));if(q=q.memoizedProps,q!==null){var ie=A.type;Ca(A.pendingProps.value,q.value)||(c!==null?c.push(ie):c=[ie])}}else if(A===mt.current){if(q=A.alternate,q===null)throw Error(d(387));q.memoizedState.memoizedState!==A.memoizedState.memoizedState&&(c!==null?c.push(rm):c=[rm])}A=A.return}c!==null&&$y(u,c,_,S),u.flags|=262144}function V_(c){for(c=c.firstContext;c!==null;){if(!Ca(c.context._currentValue,c.memoizedValue))return!0;c=c.next}return!1}function cc(c){lu=c,il=null,c=c.dependencies,c!==null&&(c.firstContext=null)}function Br(c){return XR(lu,c)}function Rh(c,u){return lu===null&&cc(c),XR(c,u)}function XR(c,u){var _=u._currentValue;if(u={context:u,memoizedValue:_,next:null},il===null){if(c===null)throw Error(d(308));il=u,c.dependencies={lanes:0,firstContext:u},c.flags|=524288}else il=il.next=u;return _}var hN=typeof AbortController<"u"?AbortController:function(){var c=[],u=this.signal={aborted:!1,addEventListener:function(_,S){c.push(S)}};this.abort=function(){u.aborted=!0,c.forEach(function(_){return _()})}},pN=o.unstable_scheduleCallback,JR=o.unstable_NormalPriority,Ir={$$typeof:me,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function pf(){return{controller:new hN,data:new Map,refCount:0}}function ff(c){c.refCount--,c.refCount===0&&pN(JR,function(){c.controller.abort()})}var mf=null,du=0,bh=0,Ch=null;function fN(c,u){if(mf===null){var _=mf=[];du=0,bh=Xh(),Ch={status:"pending",value:void 0,then:function(S){_.push(S)}}}return du++,u.then(QR,QR),u}function QR(){if(--du===0&&mf!==null){Ch!==null&&(Ch.status="fulfilled");var c=mf;mf=null,bh=0,Ch=null;for(var u=0;u<c.length;u++)(0,c[u])()}}function mN(c,u){var _=[],S={status:"pending",value:null,reason:null,then:function(A){_.push(A)}};return c.then(function(){S.status="fulfilled",S.value=u;for(var A=0;A<_.length;A++)(0,_[A])(u)},function(A){for(S.status="rejected",S.reason=A,A=0;A<_.length;A++)(0,_[A])(void 0)}),S}var $R=we.S;we.S=function(c,u){typeof u=="object"&&u!==null&&typeof u.then=="function"&&fN(c,u),$R!==null&&$R(c,u)};var Jl=qe(null);function Zy(){var c=Jl.current;return c!==null?c:Bi.pooledCache}function F_(c,u){u===null?Be(Jl,Jl.current):Be(Jl,u.pool)}function ZR(){var c=Zy();return c===null?null:{parent:Ir._currentValue,pool:c}}var uu=Error(d(460)),eb=Error(d(474)),B_=Error(d(542)),wh={then:function(){}};function tb(c){return c=c.status,c==="fulfilled"||c==="rejected"}function G_(){}function nb(c,u,_){switch(_=c[_],_===void 0?c.push(u):_!==u&&(u.then(G_,G_),u=_),u.status){case"fulfilled":return u.value;case"rejected":throw c=u.reason,rb(c),c;default:if(typeof u.status=="string")u.then(G_,G_);else{if(c=Bi,c!==null&&100<c.shellSuspendCounter)throw Error(d(482));c=u,c.status="pending",c.then(function(S){if(u.status==="pending"){var A=u;A.status="fulfilled",A.value=S}},function(S){if(u.status==="pending"){var A=u;A.status="rejected",A.reason=S}})}switch(u.status){case"fulfilled":return u.value;case"rejected":throw c=u.reason,rb(c),c}throw _f=u,uu}}var _f=null;function ib(){if(_f===null)throw Error(d(459));var c=_f;return _f=null,c}function rb(c){if(c===uu||c===B_)throw Error(d(483))}var Ro=!1;function H_(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ev(c,u){c=c.updateQueue,u.updateQueue===c&&(u.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,callbacks:null})}function Ql(c){return{lane:c,tag:0,payload:null,callback:null,next:null}}function sl(c,u,_){var S=c.updateQueue;if(S===null)return null;if(S=S.shared,(fi&2)!==0){var A=S.pending;return A===null?u.next=u:(u.next=A.next,A.next=u),S.pending=u,u=Sh(c),lf(c,null,_),u}return Kl(c,S,u,_),Sh(c)}function gf(c,u,_){if(u=u.updateQueue,u!==null&&(u=u.shared,(_&4194048)!==0)){var S=u.lanes;S&=c.pendingLanes,_|=S,u.lanes=_,Yp(c,_)}}function tv(c,u){var _=c.updateQueue,S=c.alternate;if(S!==null&&(S=S.updateQueue,_===S)){var A=null,P=null;if(_=_.firstBaseUpdate,_!==null){do{var q={lane:_.lane,tag:_.tag,payload:_.payload,callback:null,next:null};P===null?A=P=q:P=P.next=q,_=_.next}while(_!==null);P===null?A=P=u:P=P.next=u}else A=P=u;_={baseState:S.baseState,firstBaseUpdate:A,lastBaseUpdate:P,shared:S.shared,callbacks:S.callbacks},c.updateQueue=_;return}c=_.lastBaseUpdate,c===null?_.firstBaseUpdate=u:c.next=u,_.lastBaseUpdate=u}var nv=!1;function hu(){if(nv){var c=Ch;if(c!==null)throw c}}function pu(c,u,_,S){nv=!1;var A=c.updateQueue;Ro=!1;var P=A.firstBaseUpdate,q=A.lastBaseUpdate,ie=A.shared.pending;if(ie!==null){A.shared.pending=null;var Se=ie,ke=Se.next;Se.next=null,q===null?P=ke:q.next=ke,q=Se;var Ze=c.alternate;Ze!==null&&(Ze=Ze.updateQueue,ie=Ze.lastBaseUpdate,ie!==q&&(ie===null?Ze.firstBaseUpdate=ke:ie.next=ke,Ze.lastBaseUpdate=Se))}if(P!==null){var dt=A.baseState;q=0,Ze=ke=Se=null,ie=P;do{var Ge=ie.lane&-536870913,He=Ge!==ie.lane;if(He?(ei&Ge)===Ge:(S&Ge)===Ge){Ge!==0&&Ge===bh&&(nv=!0),Ze!==null&&(Ze=Ze.next={lane:0,tag:ie.tag,payload:ie.payload,callback:null,next:null});e:{var hn=c,Xt=ie;Ge=u;var Oi=_;switch(Xt.tag){case 1:if(hn=Xt.payload,typeof hn=="function"){dt=hn.call(Oi,dt,Ge);break e}dt=hn;break e;case 3:hn.flags=hn.flags&-65537|128;case 0:if(hn=Xt.payload,Ge=typeof hn=="function"?hn.call(Oi,dt,Ge):hn,Ge==null)break e;dt=x({},dt,Ge);break e;case 2:Ro=!0}}Ge=ie.callback,Ge!==null&&(c.flags|=64,He&&(c.flags|=8192),He=A.callbacks,He===null?A.callbacks=[Ge]:He.push(Ge))}else He={lane:Ge,tag:ie.tag,payload:ie.payload,callback:ie.callback,next:null},Ze===null?(ke=Ze=He,Se=dt):Ze=Ze.next=He,q|=Ge;if(ie=ie.next,ie===null){if(ie=A.shared.pending,ie===null)break;He=ie,ie=He.next,He.next=null,A.lastBaseUpdate=He,A.shared.pending=null}}while(!0);Ze===null&&(Se=dt),A.baseState=Se,A.firstBaseUpdate=ke,A.lastBaseUpdate=Ze,P===null&&(A.shared.lanes=0),Io|=q,c.lanes=q,c.memoizedState=dt}}function iv(c,u){if(typeof c!="function")throw Error(d(191,c));c.call(u)}function z_(c,u){var _=c.callbacks;if(_!==null)for(c.callbacks=null,c=0;c<_.length;c++)iv(_[c],u)}var fu=qe(null),Ef=qe(0);function yf(c,u){c=mc,Be(Ef,c),Be(fu,u),mc=c|u.baseLanes}function mu(){Be(Ef,mc),Be(fu,fu.current)}function rv(){mc=Ef.current,Oe(fu),Oe(Ef)}var $l=0,In=null,Ni=null,Nr=null,vf=!1,Ah=!1,_u=!1,W_=0,Sf=0,Ih=null,_N=0;function dr(){throw Error(d(321))}function Zl(c,u){if(u===null)return!1;for(var _=0;_<u.length&&_<c.length;_++)if(!Ca(c[_],u[_]))return!1;return!0}function sv(c,u,_,S,A,P){return $l=P,In=u,u.memoizedState=null,u.updateQueue=null,u.lanes=0,we.H=c===null||c.memoizedState===null?gu:td,_u=!1,P=_(S,A),_u=!1,Ah&&(P=ab(u,_,S,A)),sb(c),P}function sb(c){we.H=Na;var u=Ni!==null&&Ni.next!==null;if($l=0,Nr=Ni=In=null,vf=!1,Sf=0,Ih=null,u)throw Error(d(300));c===null||rs||(c=c.dependencies,c!==null&&V_(c)&&(rs=!0))}function ab(c,u,_,S){In=c;var A=0;do{if(Ah&&(Ih=null),Sf=0,Ah=!1,25<=A)throw Error(d(301));if(A+=1,Nr=Ni=null,c.updateQueue!=null){var P=c.updateQueue;P.lastEffect=null,P.events=null,P.stores=null,P.memoCache!=null&&(P.memoCache.index=0)}we.H=Cb,P=u(_,S)}while(Ah);return P}function ob(){var c=we.H,u=c.useState()[0];return u=typeof u.then=="function"?Tf(u):u,c=c.useState()[0],(Ni!==null?Ni.memoizedState:null)!==c&&(In.flags|=1024),u}function av(){var c=W_!==0;return W_=0,c}function q_(c,u,_){u.updateQueue=c.updateQueue,u.flags&=-2053,c.lanes&=~_}function ov(c){if(vf){for(c=c.memoizedState;c!==null;){var u=c.queue;u!==null&&(u.pending=null),c=c.next}vf=!1}$l=0,Nr=Ni=In=null,Ah=!1,Sf=W_=0,Ih=null}function ia(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Nr===null?In.memoizedState=Nr=c:Nr=Nr.next=c,Nr}function Or(){if(Ni===null){var c=In.alternate;c=c!==null?c.memoizedState:null}else c=Ni.next;var u=Nr===null?In.memoizedState:Nr.next;if(u!==null)Nr=u,Ni=c;else{if(c===null)throw In.alternate===null?Error(d(467)):Error(d(310));Ni=c,c={memoizedState:Ni.memoizedState,baseState:Ni.baseState,baseQueue:Ni.baseQueue,queue:Ni.queue,next:null},Nr===null?In.memoizedState=Nr=c:Nr=Nr.next=c}return Nr}function Nh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Tf(c){var u=Sf;return Sf+=1,Ih===null&&(Ih=[]),c=nb(Ih,c,u),u=In,(Nr===null?u.memoizedState:Nr.next)===null&&(u=u.alternate,we.H=u===null||u.memoizedState===null?gu:td),c}function K_(c){if(c!==null&&typeof c=="object"){if(typeof c.then=="function")return Tf(c);if(c.$$typeof===me)return Br(c)}throw Error(d(438,String(c)))}function cv(c){var u=null,_=In.updateQueue;if(_!==null&&(u=_.memoCache),u==null){var S=In.alternate;S!==null&&(S=S.updateQueue,S!==null&&(S=S.memoCache,S!=null&&(u={data:S.data.map(function(A){return A.slice()}),index:0})))}if(u==null&&(u={data:[],index:0}),_===null&&(_=Nh(),In.updateQueue=_),_.memoCache=u,_=u.data[u.index],_===void 0)for(_=u.data[u.index]=Array(c),S=0;S<c;S++)_[S]=fe;return u.index++,_}function al(c,u){return typeof u=="function"?u(c):u}function Y_(c){var u=Or();return lv(u,Ni,c)}function lv(c,u,_){var S=c.queue;if(S===null)throw Error(d(311));S.lastRenderedReducer=_;var A=c.baseQueue,P=S.pending;if(P!==null){if(A!==null){var q=A.next;A.next=P.next,P.next=q}u.baseQueue=A=P,S.pending=null}if(P=c.baseState,A===null)c.memoizedState=P;else{u=A.next;var ie=q=null,Se=null,ke=u,Ze=!1;do{var dt=ke.lane&-536870913;if(dt!==ke.lane?(ei&dt)===dt:($l&dt)===dt){var Ge=ke.revertLane;if(Ge===0)Se!==null&&(Se=Se.next={lane:0,revertLane:0,action:ke.action,hasEagerState:ke.hasEagerState,eagerState:ke.eagerState,next:null}),dt===bh&&(Ze=!0);else if(($l&Ge)===Ge){ke=ke.next,Ge===bh&&(Ze=!0);continue}else dt={lane:0,revertLane:ke.revertLane,action:ke.action,hasEagerState:ke.hasEagerState,eagerState:ke.eagerState,next:null},Se===null?(ie=Se=dt,q=P):Se=Se.next=dt,In.lanes|=Ge,Io|=Ge;dt=ke.action,_u&&_(P,dt),P=ke.hasEagerState?ke.eagerState:_(P,dt)}else Ge={lane:dt,revertLane:ke.revertLane,action:ke.action,hasEagerState:ke.hasEagerState,eagerState:ke.eagerState,next:null},Se===null?(ie=Se=Ge,q=P):Se=Se.next=Ge,In.lanes|=dt,Io|=dt;ke=ke.next}while(ke!==null&&ke!==u);if(Se===null?q=P:Se.next=ie,!Ca(P,c.memoizedState)&&(rs=!0,Ze&&(_=Ch,_!==null)))throw _;c.memoizedState=P,c.baseState=q,c.baseQueue=Se,S.lastRenderedState=P}return A===null&&(S.lanes=0),[c.memoizedState,S.dispatch]}function Rf(c){var u=Or(),_=u.queue;if(_===null)throw Error(d(311));_.lastRenderedReducer=c;var S=_.dispatch,A=_.pending,P=u.memoizedState;if(A!==null){_.pending=null;var q=A=A.next;do P=c(P,q.action),q=q.next;while(q!==A);Ca(P,u.memoizedState)||(rs=!0),u.memoizedState=P,u.baseQueue===null&&(u.baseState=P),_.lastRenderedState=P}return[P,S]}function cb(c,u,_){var S=In,A=Or(),P=pi;if(P){if(_===void 0)throw Error(d(407));_=_()}else _=u();var q=!Ca((Ni||A).memoizedState,_);q&&(A.memoizedState=_,rs=!0),A=A.queue;var ie=uv.bind(null,S,A,c);if(Ph(2048,8,ie,[c]),A.getSnapshot!==u||q||Nr!==null&&Nr.memoizedState.tag&1){if(S.flags|=2048,Dh(9,X_(),lb.bind(null,S,A,_,u),null),Bi===null)throw Error(d(349));P||($l&124)!==0||dv(S,u,_)}return _}function dv(c,u,_){c.flags|=16384,c={getSnapshot:u,value:_},u=In.updateQueue,u===null?(u=Nh(),In.updateQueue=u,u.stores=[c]):(_=u.stores,_===null?u.stores=[c]:_.push(c))}function lb(c,u,_,S){u.value=_,u.getSnapshot=S,db(u)&&ub(c)}function uv(c,u,_){return _(function(){db(u)&&ub(c)})}function db(c){var u=c.getSnapshot;c=c.value;try{var _=u();return!Ca(c,_)}catch{return!0}}function ub(c){var u=vh(c,2);u!==null&&aa(u,c,2)}function hv(c){var u=ia();if(typeof c=="function"){var _=c;if(c=_(),_u){un(!0);try{_()}finally{un(!1)}}}return u.memoizedState=u.baseState=c,u.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:al,lastRenderedState:c},u}function hb(c,u,_,S){return c.baseState=_,lv(c,Ni,typeof S=="function"?S:al)}function gN(c,u,_,S,A){if(Of(c))throw Error(d(485));if(c=u.action,c!==null){var P={payload:A,action:c,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(q){P.listeners.push(q)}};we.T!==null?_(!0):P.isTransition=!1,S(P),_=u.pending,_===null?(P.next=u.pending=P,pb(u,P)):(P.next=_.next,u.pending=_.next=P)}}function pb(c,u){var _=u.action,S=u.payload,A=c.state;if(u.isTransition){var P=we.T,q={};we.T=q;try{var ie=_(A,S),Se=we.S;Se!==null&&Se(q,ie),pv(c,u,ie)}catch(ke){fv(c,u,ke)}finally{we.T=P}}else try{P=_(A,S),pv(c,u,P)}catch(ke){fv(c,u,ke)}}function pv(c,u,_){_!==null&&typeof _=="object"&&typeof _.then=="function"?_.then(function(S){fb(c,u,S)},function(S){return fv(c,u,S)}):fb(c,u,_)}function fb(c,u,_){u.status="fulfilled",u.value=_,mv(u),c.state=_,u=c.pending,u!==null&&(_=u.next,_===u?c.pending=null:(_=_.next,u.next=_,pb(c,_)))}function fv(c,u,_){var S=c.pending;if(c.pending=null,S!==null){S=S.next;do u.status="rejected",u.reason=_,mv(u),u=u.next;while(u!==S)}c.action=null}function mv(c){c=c.listeners;for(var u=0;u<c.length;u++)(0,c[u])()}function mb(c,u){return u}function bf(c,u){if(pi){var _=Bi.formState;if(_!==null){e:{var S=In;if(pi){if(Yi){t:{for(var A=Yi,P=oc;A.nodeType!==8;){if(!P){A=null;break t}if(A=Do(A.nextSibling),A===null){A=null;break t}}P=A.data,A=P==="F!"||P==="F"?A:null}if(A){Yi=Do(A.nextSibling),S=A.data==="F!";break e}}ou(S)}S=!1}S&&(u=_[0])}}return _=ia(),_.memoizedState=_.baseState=u,S={pending:null,lanes:0,dispatch:null,lastRenderedReducer:mb,lastRenderedState:u},_.queue=S,_=eg.bind(null,In,S),S.dispatch=_,S=hv(!1),P=Tv.bind(null,In,!1,S.queue),S=ia(),A={state:u,dispatch:null,action:c,pending:null},S.queue=A,_=gN.bind(null,In,A,P,_),A.dispatch=_,S.memoizedState=c,[u,_,!1]}function _v(c){var u=Or();return Oh(u,Ni,c)}function Oh(c,u,_){if(u=lv(c,u,mb)[0],c=Y_(al)[0],typeof u=="object"&&u!==null&&typeof u.then=="function")try{var S=Tf(u)}catch(q){throw q===uu?B_:q}else S=u;u=Or();var A=u.queue,P=A.dispatch;return _!==u.memoizedState&&(In.flags|=2048,Dh(9,X_(),EN.bind(null,A,_),null)),[S,P,c]}function EN(c,u){c.action=u}function _b(c){var u=Or(),_=Ni;if(_!==null)return Oh(u,_,c);Or(),u=u.memoizedState,_=Or();var S=_.queue.dispatch;return _.memoizedState=c,[u,S,!1]}function Dh(c,u,_,S){return c={tag:c,create:_,deps:S,inst:u,next:null},u=In.updateQueue,u===null&&(u=Nh(),In.updateQueue=u),_=u.lastEffect,_===null?u.lastEffect=c.next=c:(S=_.next,_.next=c,c.next=S,u.lastEffect=c),c}function X_(){return{destroy:void 0,resource:void 0}}function Cf(){return Or().memoizedState}function J_(c,u,_,S){var A=ia();S=S===void 0?null:S,In.flags|=c,A.memoizedState=Dh(1|u,X_(),_,S)}function Ph(c,u,_,S){var A=Or();S=S===void 0?null:S;var P=A.memoizedState.inst;Ni!==null&&S!==null&&Zl(S,Ni.memoizedState.deps)?A.memoizedState=Dh(u,P,_,S):(In.flags|=c,A.memoizedState=Dh(1|u,P,_,S))}function Q_(c,u){J_(8390656,8,c,u)}function $_(c,u){Ph(2048,8,c,u)}function gb(c,u){return Ph(4,2,c,u)}function Eb(c,u){return Ph(4,4,c,u)}function yb(c,u){if(typeof u=="function"){c=c();var _=u(c);return function(){typeof _=="function"?_():u(null)}}if(u!=null)return c=c(),u.current=c,function(){u.current=null}}function vb(c,u,_){_=_!=null?_.concat([c]):null,Ph(4,4,yb.bind(null,u,c),_)}function gv(){}function wf(c,u){var _=Or();u=u===void 0?null:u;var S=_.memoizedState;return u!==null&&Zl(u,S[1])?S[0]:(_.memoizedState=[c,u],c)}function Sb(c,u){var _=Or();u=u===void 0?null:u;var S=_.memoizedState;if(u!==null&&Zl(u,S[1]))return S[0];if(S=c(),_u){un(!0);try{c()}finally{un(!1)}}return _.memoizedState=[S,u],S}function ed(c,u,_){return _===void 0||($l&1073741824)!==0?c.memoizedState=u:(c.memoizedState=_,c=Eg(),In.lanes|=c,Io|=c,_)}function Z_(c,u,_,S){return Ca(_,u)?_:fu.current!==null?(c=ed(c,_,S),Ca(c,u)||(rs=!0),c):($l&42)===0?(rs=!0,c.memoizedState=_):(c=Eg(),In.lanes|=c,Io|=c,u)}function Af(c,u,_,S,A){var P=je.p;je.p=P!==0&&8>P?P:8;var q=we.T,ie={};we.T=ie,Tv(c,!1,u,_);try{var Se=A(),ke=we.S;if(ke!==null&&ke(ie,Se),Se!==null&&typeof Se=="object"&&typeof Se.then=="function"){var Ze=mN(Se,S);Nf(c,u,Ze,Da(c))}else Nf(c,u,S,Da(c))}catch(dt){Nf(c,u,{then:function(){},status:"rejected",reason:dt},Da())}finally{je.p=P,we.T=q}}function If(){}function Lh(c,u,_,S){if(c.tag!==5)throw Error(d(476));var A=Tb(c).queue;Af(c,A,u,nt,_===null?If:function(){return Ev(c),_(S)})}function Tb(c){var u=c.memoizedState;if(u!==null)return u;u={memoizedState:nt,baseState:nt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:al,lastRenderedState:nt},next:null};var _={};return u.next={memoizedState:_,baseState:_,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:al,lastRenderedState:_},next:null},c.memoizedState=u,c=c.alternate,c!==null&&(c.memoizedState=u),u}function Ev(c){var u=Tb(c).next.queue;Nf(c,u,{},Da())}function yv(){return Br(rm)}function vv(){return Or().memoizedState}function Rb(){return Or().memoizedState}function yN(c){for(var u=c.return;u!==null;){switch(u.tag){case 24:case 3:var _=Da();c=Ql(_);var S=sl(u,c,_);S!==null&&(aa(S,u,_),gf(S,u,_)),u={cache:pf()},c.payload=u;return}u=u.return}}function Sv(c,u,_){var S=Da();_={lane:S,revertLane:0,action:_,hasEagerState:!1,eagerState:null,next:null},Of(c)?tg(u,_):(_=Hy(c,u,_,S),_!==null&&(aa(_,c,S),bb(_,u,S)))}function eg(c,u,_){var S=Da();Nf(c,u,_,S)}function Nf(c,u,_,S){var A={lane:S,revertLane:0,action:_,hasEagerState:!1,eagerState:null,next:null};if(Of(c))tg(u,A);else{var P=c.alternate;if(c.lanes===0&&(P===null||P.lanes===0)&&(P=u.lastRenderedReducer,P!==null))try{var q=u.lastRenderedState,ie=P(q,_);if(A.hasEagerState=!0,A.eagerState=ie,Ca(ie,q))return Kl(c,u,A,0),Bi===null&&iu(),!1}catch{}finally{}if(_=Hy(c,u,A,S),_!==null)return aa(_,c,S),bb(_,u,S),!0}return!1}function Tv(c,u,_,S){if(S={lane:2,revertLane:Xh(),action:S,hasEagerState:!1,eagerState:null,next:null},Of(c)){if(u)throw Error(d(479))}else u=Hy(c,_,S,2),u!==null&&aa(u,c,2)}function Of(c){var u=c.alternate;return c===In||u!==null&&u===In}function tg(c,u){Ah=vf=!0;var _=c.pending;_===null?u.next=u:(u.next=_.next,_.next=u),c.pending=u}function bb(c,u,_){if((_&4194048)!==0){var S=u.lanes;S&=c.pendingLanes,_|=S,u.lanes=_,Yp(c,_)}}var Na={readContext:Br,use:K_,useCallback:dr,useContext:dr,useEffect:dr,useImperativeHandle:dr,useLayoutEffect:dr,useInsertionEffect:dr,useMemo:dr,useReducer:dr,useRef:dr,useState:dr,useDebugValue:dr,useDeferredValue:dr,useTransition:dr,useSyncExternalStore:dr,useId:dr,useHostTransitionStatus:dr,useFormState:dr,useActionState:dr,useOptimistic:dr,useMemoCache:dr,useCacheRefresh:dr},gu={readContext:Br,use:K_,useCallback:function(c,u){return ia().memoizedState=[c,u===void 0?null:u],c},useContext:Br,useEffect:Q_,useImperativeHandle:function(c,u,_){_=_!=null?_.concat([c]):null,J_(4194308,4,yb.bind(null,u,c),_)},useLayoutEffect:function(c,u){return J_(4194308,4,c,u)},useInsertionEffect:function(c,u){J_(4,2,c,u)},useMemo:function(c,u){var _=ia();u=u===void 0?null:u;var S=c();if(_u){un(!0);try{c()}finally{un(!1)}}return _.memoizedState=[S,u],S},useReducer:function(c,u,_){var S=ia();if(_!==void 0){var A=_(u);if(_u){un(!0);try{_(u)}finally{un(!1)}}}else A=u;return S.memoizedState=S.baseState=A,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:A},S.queue=c,c=c.dispatch=Sv.bind(null,In,c),[S.memoizedState,c]},useRef:function(c){var u=ia();return c={current:c},u.memoizedState=c},useState:function(c){c=hv(c);var u=c.queue,_=eg.bind(null,In,u);return u.dispatch=_,[c.memoizedState,_]},useDebugValue:gv,useDeferredValue:function(c,u){var _=ia();return ed(_,c,u)},useTransition:function(){var c=hv(!1);return c=Af.bind(null,In,c.queue,!0,!1),ia().memoizedState=c,[!1,c]},useSyncExternalStore:function(c,u,_){var S=In,A=ia();if(pi){if(_===void 0)throw Error(d(407));_=_()}else{if(_=u(),Bi===null)throw Error(d(349));(ei&124)!==0||dv(S,u,_)}A.memoizedState=_;var P={value:_,getSnapshot:u};return A.queue=P,Q_(uv.bind(null,S,P,c),[c]),S.flags|=2048,Dh(9,X_(),lb.bind(null,S,P,_,u),null),_},useId:function(){var c=ia(),u=Bi.identifierPrefix;if(pi){var _=To,S=nl;_=(S&~(1<<32-gn(S)-1)).toString(32)+_,u=""+u+"R"+_,_=W_++,0<_&&(u+="H"+_.toString(32)),u+=""}else _=_N++,u=""+u+"r"+_.toString(32)+"";return c.memoizedState=u},useHostTransitionStatus:yv,useFormState:bf,useActionState:bf,useOptimistic:function(c){var u=ia();u.memoizedState=u.baseState=c;var _={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return u.queue=_,u=Tv.bind(null,In,!0,_),_.dispatch=u,[c,u]},useMemoCache:cv,useCacheRefresh:function(){return ia().memoizedState=yN.bind(null,In)}},td={readContext:Br,use:K_,useCallback:wf,useContext:Br,useEffect:$_,useImperativeHandle:vb,useInsertionEffect:gb,useLayoutEffect:Eb,useMemo:Sb,useReducer:Y_,useRef:Cf,useState:function(){return Y_(al)},useDebugValue:gv,useDeferredValue:function(c,u){var _=Or();return Z_(_,Ni.memoizedState,c,u)},useTransition:function(){var c=Y_(al)[0],u=Or().memoizedState;return[typeof c=="boolean"?c:Tf(c),u]},useSyncExternalStore:cb,useId:vv,useHostTransitionStatus:yv,useFormState:_v,useActionState:_v,useOptimistic:function(c,u){var _=Or();return hb(_,Ni,c,u)},useMemoCache:cv,useCacheRefresh:Rb},Cb={readContext:Br,use:K_,useCallback:wf,useContext:Br,useEffect:$_,useImperativeHandle:vb,useInsertionEffect:gb,useLayoutEffect:Eb,useMemo:Sb,useReducer:Rf,useRef:Cf,useState:function(){return Rf(al)},useDebugValue:gv,useDeferredValue:function(c,u){var _=Or();return Ni===null?ed(_,c,u):Z_(_,Ni.memoizedState,c,u)},useTransition:function(){var c=Rf(al)[0],u=Or().memoizedState;return[typeof c=="boolean"?c:Tf(c),u]},useSyncExternalStore:cb,useId:vv,useHostTransitionStatus:yv,useFormState:_b,useActionState:_b,useOptimistic:function(c,u){var _=Or();return Ni!==null?hb(_,Ni,c,u):(_.baseState=c,[c,_.queue.dispatch])},useMemoCache:cv,useCacheRefresh:Rb},Eu=null,bo=0;function kh(c){var u=bo;return bo+=1,Eu===null&&(Eu=[]),nb(Eu,c,u)}function Df(c,u){u=u.props.ref,c.ref=u!==void 0?u:null}function Pf(c,u){throw u.$$typeof===G?Error(d(525)):(c=Object.prototype.toString.call(u),Error(d(31,c==="[object Object]"?"object with keys {"+Object.keys(u).join(", ")+"}":c)))}function wb(c){var u=c._init;return u(c._payload)}function Rv(c){function u(De,be){if(c){var xe=De.deletions;xe===null?(De.deletions=[be],De.flags|=16):xe.push(be)}}function _(De,be){if(!c)return null;for(;be!==null;)u(De,be),be=be.sibling;return null}function S(De){for(var be=new Map;De!==null;)De.key!==null?be.set(De.key,De):be.set(De.index,De),De=De.sibling;return be}function A(De,be){return De=tl(De,be),De.index=0,De.sibling=null,De}function P(De,be,xe){return De.index=xe,c?(xe=De.alternate,xe!==null?(xe=xe.index,xe<be?(De.flags|=67108866,be):xe):(De.flags|=67108866,be)):(De.flags|=1048576,be)}function q(De){return c&&De.alternate===null&&(De.flags|=67108866),De}function ie(De,be,xe,ot){return be===null||be.tag!==6?(be=na(xe,De.mode,ot),be.return=De,be):(be=A(be,xe),be.return=De,be)}function Se(De,be,xe,ot){var Pt=xe.type;return Pt===Q?Ze(De,be,xe.props.children,ot,xe.key):be!==null&&(be.elementType===Pt||typeof Pt=="object"&&Pt!==null&&Pt.$$typeof===J&&wb(Pt)===be.type)?(be=A(be,xe.props),Df(be,xe),be.return=De,be):(be=k_(xe.type,xe.key,xe.props,null,De.mode,ot),Df(be,xe),be.return=De,be)}function ke(De,be,xe,ot){return be===null||be.tag!==4||be.stateNode.containerInfo!==xe.containerInfo||be.stateNode.implementation!==xe.implementation?(be=Wy(xe,De.mode,ot),be.return=De,be):(be=A(be,xe.children||[]),be.return=De,be)}function Ze(De,be,xe,ot,Pt){return be===null||be.tag!==7?(be=Yl(xe,De.mode,ot,Pt),be.return=De,be):(be=A(be,xe),be.return=De,be)}function dt(De,be,xe){if(typeof be=="string"&&be!==""||typeof be=="number"||typeof be=="bigint")return be=na(""+be,De.mode,xe),be.return=De,be;if(typeof be=="object"&&be!==null){switch(be.$$typeof){case W:return xe=k_(be.type,be.key,be.props,null,De.mode,xe),Df(xe,be),xe.return=De,xe;case ne:return be=Wy(be,De.mode,xe),be.return=De,be;case J:var ot=be._init;return be=ot(be._payload),dt(De,be,xe)}if(st(be)||pe(be))return be=Yl(be,De.mode,xe,null),be.return=De,be;if(typeof be.then=="function")return dt(De,kh(be),xe);if(be.$$typeof===me)return dt(De,Rh(De,be),xe);Pf(De,be)}return null}function Ge(De,be,xe,ot){var Pt=be!==null?be.key:null;if(typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint")return Pt!==null?null:ie(De,be,""+xe,ot);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case W:return xe.key===Pt?Se(De,be,xe,ot):null;case ne:return xe.key===Pt?ke(De,be,xe,ot):null;case J:return Pt=xe._init,xe=Pt(xe._payload),Ge(De,be,xe,ot)}if(st(xe)||pe(xe))return Pt!==null?null:Ze(De,be,xe,ot,null);if(typeof xe.then=="function")return Ge(De,be,kh(xe),ot);if(xe.$$typeof===me)return Ge(De,be,Rh(De,xe),ot);Pf(De,xe)}return null}function He(De,be,xe,ot,Pt){if(typeof ot=="string"&&ot!==""||typeof ot=="number"||typeof ot=="bigint")return De=De.get(xe)||null,ie(be,De,""+ot,Pt);if(typeof ot=="object"&&ot!==null){switch(ot.$$typeof){case W:return De=De.get(ot.key===null?xe:ot.key)||null,Se(be,De,ot,Pt);case ne:return De=De.get(ot.key===null?xe:ot.key)||null,ke(be,De,ot,Pt);case J:var Fn=ot._init;return ot=Fn(ot._payload),He(De,be,xe,ot,Pt)}if(st(ot)||pe(ot))return De=De.get(xe)||null,Ze(be,De,ot,Pt,null);if(typeof ot.then=="function")return He(De,be,xe,kh(ot),Pt);if(ot.$$typeof===me)return He(De,be,xe,Rh(be,ot),Pt);Pf(be,ot)}return null}function hn(De,be,xe,ot){for(var Pt=null,Fn=null,Ht=be,sn=be=0,os=null;Ht!==null&&sn<xe.length;sn++){Ht.index>sn?(os=Ht,Ht=null):os=Ht.sibling;var ni=Ge(De,Ht,xe[sn],ot);if(ni===null){Ht===null&&(Ht=os);break}c&&Ht&&ni.alternate===null&&u(De,Ht),be=P(ni,be,sn),Fn===null?Pt=ni:Fn.sibling=ni,Fn=ni,Ht=os}if(sn===xe.length)return _(De,Ht),pi&&su(De,sn),Pt;if(Ht===null){for(;sn<xe.length;sn++)Ht=dt(De,xe[sn],ot),Ht!==null&&(be=P(Ht,be,sn),Fn===null?Pt=Ht:Fn.sibling=Ht,Fn=Ht);return pi&&su(De,sn),Pt}for(Ht=S(Ht);sn<xe.length;sn++)os=He(Ht,De,sn,xe[sn],ot),os!==null&&(c&&os.alternate!==null&&Ht.delete(os.key===null?sn:os.key),be=P(os,be,sn),Fn===null?Pt=os:Fn.sibling=os,Fn=os);return c&&Ht.forEach(function(dl){return u(De,dl)}),pi&&su(De,sn),Pt}function Xt(De,be,xe,ot){if(xe==null)throw Error(d(151));for(var Pt=null,Fn=null,Ht=be,sn=be=0,os=null,ni=xe.next();Ht!==null&&!ni.done;sn++,ni=xe.next()){Ht.index>sn?(os=Ht,Ht=null):os=Ht.sibling;var dl=Ge(De,Ht,ni.value,ot);if(dl===null){Ht===null&&(Ht=os);break}c&&Ht&&dl.alternate===null&&u(De,Ht),be=P(dl,be,sn),Fn===null?Pt=dl:Fn.sibling=dl,Fn=dl,Ht=os}if(ni.done)return _(De,Ht),pi&&su(De,sn),Pt;if(Ht===null){for(;!ni.done;sn++,ni=xe.next())ni=dt(De,ni.value,ot),ni!==null&&(be=P(ni,be,sn),Fn===null?Pt=ni:Fn.sibling=ni,Fn=ni);return pi&&su(De,sn),Pt}for(Ht=S(Ht);!ni.done;sn++,ni=xe.next())ni=He(Ht,De,sn,ni.value,ot),ni!==null&&(c&&ni.alternate!==null&&Ht.delete(ni.key===null?sn:ni.key),be=P(ni,be,sn),Fn===null?Pt=ni:Fn.sibling=ni,Fn=ni);return c&&Ht.forEach(function(nO){return u(De,nO)}),pi&&su(De,sn),Pt}function Oi(De,be,xe,ot){if(typeof xe=="object"&&xe!==null&&xe.type===Q&&xe.key===null&&(xe=xe.props.children),typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case W:e:{for(var Pt=xe.key;be!==null;){if(be.key===Pt){if(Pt=xe.type,Pt===Q){if(be.tag===7){_(De,be.sibling),ot=A(be,xe.props.children),ot.return=De,De=ot;break e}}else if(be.elementType===Pt||typeof Pt=="object"&&Pt!==null&&Pt.$$typeof===J&&wb(Pt)===be.type){_(De,be.sibling),ot=A(be,xe.props),Df(ot,xe),ot.return=De,De=ot;break e}_(De,be);break}else u(De,be);be=be.sibling}xe.type===Q?(ot=Yl(xe.props.children,De.mode,ot,xe.key),ot.return=De,De=ot):(ot=k_(xe.type,xe.key,xe.props,null,De.mode,ot),Df(ot,xe),ot.return=De,De=ot)}return q(De);case ne:e:{for(Pt=xe.key;be!==null;){if(be.key===Pt)if(be.tag===4&&be.stateNode.containerInfo===xe.containerInfo&&be.stateNode.implementation===xe.implementation){_(De,be.sibling),ot=A(be,xe.children||[]),ot.return=De,De=ot;break e}else{_(De,be);break}else u(De,be);be=be.sibling}ot=Wy(xe,De.mode,ot),ot.return=De,De=ot}return q(De);case J:return Pt=xe._init,xe=Pt(xe._payload),Oi(De,be,xe,ot)}if(st(xe))return hn(De,be,xe,ot);if(pe(xe)){if(Pt=pe(xe),typeof Pt!="function")throw Error(d(150));return xe=Pt.call(xe),Xt(De,be,xe,ot)}if(typeof xe.then=="function")return Oi(De,be,kh(xe),ot);if(xe.$$typeof===me)return Oi(De,be,Rh(De,xe),ot);Pf(De,xe)}return typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint"?(xe=""+xe,be!==null&&be.tag===6?(_(De,be.sibling),ot=A(be,xe),ot.return=De,De=ot):(_(De,be),ot=na(xe,De.mode,ot),ot.return=De,De=ot),q(De)):_(De,be)}return function(De,be,xe,ot){try{bo=0;var Pt=Oi(De,be,xe,ot);return Eu=null,Pt}catch(Ht){if(Ht===uu||Ht===B_)throw Ht;var Fn=Aa(29,Ht,null,De.mode);return Fn.lanes=ot,Fn.return=De,Fn}finally{}}}var yu=Rv(!0),Ab=Rv(!1),Gr=qe(null),lc=null;function nd(c){var u=c.alternate;Be(Hr,Hr.current&1),Be(Gr,c),lc===null&&(u===null||fu.current!==null||u.memoizedState!==null)&&(lc=c)}function Ib(c){if(c.tag===22){if(Be(Hr,Hr.current),Be(Gr,c),lc===null){var u=c.alternate;u!==null&&u.memoizedState!==null&&(lc=c)}}else id()}function id(){Be(Hr,Hr.current),Be(Gr,Gr.current)}function dc(c){Oe(Gr),lc===c&&(lc=null),Oe(Hr)}var Hr=qe(0);function xh(c){for(var u=c;u!==null;){if(u.tag===13){var _=u.memoizedState;if(_!==null&&(_=_.dehydrated,_===null||_.data==="$?"||Lg(_)))return u}else if(u.tag===19&&u.memoizedProps.revealOrder!==void 0){if((u.flags&128)!==0)return u}else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===c)break;for(;u.sibling===null;){if(u.return===null||u.return===c)return null;u=u.return}u.sibling.return=u.return,u=u.sibling}return null}function ng(c,u,_,S){u=c.memoizedState,_=_(S,u),_=_==null?u:x({},u,_),c.memoizedState=_,c.lanes===0&&(c.updateQueue.baseState=_)}var bv={enqueueSetState:function(c,u,_){c=c._reactInternals;var S=Da(),A=Ql(S);A.payload=u,_!=null&&(A.callback=_),u=sl(c,A,S),u!==null&&(aa(u,c,S),gf(u,c,S))},enqueueReplaceState:function(c,u,_){c=c._reactInternals;var S=Da(),A=Ql(S);A.tag=1,A.payload=u,_!=null&&(A.callback=_),u=sl(c,A,S),u!==null&&(aa(u,c,S),gf(u,c,S))},enqueueForceUpdate:function(c,u){c=c._reactInternals;var _=Da(),S=Ql(_);S.tag=2,u!=null&&(S.callback=u),u=sl(c,S,_),u!==null&&(aa(u,c,_),gf(u,c,_))}};function Cv(c,u,_,S,A,P,q){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(S,P,q):u.prototype&&u.prototype.isPureReactComponent?!zl(_,S)||!zl(A,P):!0}function Nb(c,u,_,S){c=u.state,typeof u.componentWillReceiveProps=="function"&&u.componentWillReceiveProps(_,S),typeof u.UNSAFE_componentWillReceiveProps=="function"&&u.UNSAFE_componentWillReceiveProps(_,S),u.state!==c&&bv.enqueueReplaceState(u,u.state,null)}function vu(c,u){var _=u;if("ref"in u){_={};for(var S in u)S!=="ref"&&(_[S]=u[S])}if(c=c.defaultProps){_===u&&(_=x({},_));for(var A in c)_[A]===void 0&&(_[A]=c[A])}return _}var ig=typeof reportError=="function"?reportError:function(c){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var u=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof c=="object"&&c!==null&&typeof c.message=="string"?String(c.message):String(c),error:c});if(!window.dispatchEvent(u))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",c);return}console.error(c)};function Ob(c){ig(c)}function Db(c){console.error(c)}function Pb(c){ig(c)}function rg(c,u){try{var _=c.onUncaughtError;_(u.value,{componentStack:u.stack})}catch(S){setTimeout(function(){throw S})}}function wv(c,u,_){try{var S=c.onCaughtError;S(_.value,{componentStack:_.stack,errorBoundary:u.tag===1?u.stateNode:null})}catch(A){setTimeout(function(){throw A})}}function Co(c,u,_){return _=Ql(_),_.tag=3,_.payload={element:null},_.callback=function(){rg(c,u)},_}function Lb(c){return c=Ql(c),c.tag=3,c}function kb(c,u,_,S){var A=_.type.getDerivedStateFromError;if(typeof A=="function"){var P=S.value;c.payload=function(){return A(P)},c.callback=function(){wv(u,_,S)}}var q=_.stateNode;q!==null&&typeof q.componentDidCatch=="function"&&(c.callback=function(){wv(u,_,S),typeof A!="function"&&(cl===null?cl=new Set([this]):cl.add(this));var ie=S.stack;this.componentDidCatch(S.value,{componentStack:ie!==null?ie:""})})}function vN(c,u,_,S,A){if(_.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){if(u=_.alternate,u!==null&&hf(u,_,A,!0),_=Gr.current,_!==null){switch(_.tag){case 13:return lc===null?Iu():_.alternate===null&&nr===0&&(nr=3),_.flags&=-257,_.flags|=65536,_.lanes=A,S===wh?_.flags|=16384:(u=_.updateQueue,u===null?_.updateQueue=new Set([S]):u.add(S),Kh(c,S,A)),!1;case 22:return _.flags|=65536,S===wh?_.flags|=16384:(u=_.updateQueue,u===null?(u={transitions:null,markerInstances:null,retryQueue:new Set([S])},_.updateQueue=u):(_=u.retryQueue,_===null?u.retryQueue=new Set([S]):_.add(S)),Kh(c,S,A)),!1}throw Error(d(435,_.tag))}return Kh(c,S,A),Iu(),!1}if(pi)return u=Gr.current,u!==null?((u.flags&65536)===0&&(u.flags|=256),u.flags|=65536,u.lanes=A,S!==Yy&&(c=Error(d(422),{cause:S}),uf(wa(c,_)))):(S!==Yy&&(u=Error(d(423),{cause:S}),uf(wa(u,_))),c=c.current.alternate,c.flags|=65536,A&=-A,c.lanes|=A,S=wa(S,_),A=Co(c.stateNode,S,A),tv(c,A),nr!==4&&(nr=2)),!1;var P=Error(d(520),{cause:S});if(P=wa(P,_),Gh===null?Gh=[P]:Gh.push(P),nr!==4&&(nr=2),u===null)return!0;S=wa(S,_),_=u;do{switch(_.tag){case 3:return _.flags|=65536,c=A&-A,_.lanes|=c,c=Co(_.stateNode,S,c),tv(_,c),!1;case 1:if(u=_.type,P=_.stateNode,(_.flags&128)===0&&(typeof u.getDerivedStateFromError=="function"||P!==null&&typeof P.componentDidCatch=="function"&&(cl===null||!cl.has(P))))return _.flags|=65536,A&=-A,_.lanes|=A,A=Lb(A),kb(A,c,_,S),tv(_,A),!1}_=_.return}while(_!==null);return!1}var xb=Error(d(461)),rs=!1;function ps(c,u,_,S){u.child=c===null?Ab(u,null,_,S):yu(u,c.child,_,S)}function sg(c,u,_,S,A){_=_.render;var P=u.ref;if("ref"in S){var q={};for(var ie in S)ie!=="ref"&&(q[ie]=S[ie])}else q=S;return cc(u),S=sv(c,u,_,q,P,A),ie=av(),c!==null&&!rs?(q_(c,u,A),uc(c,u,A)):(pi&&ie&&U_(u),u.flags|=1,ps(c,u,S,A),u.child)}function Mb(c,u,_,S,A){if(c===null){var P=_.type;return typeof P=="function"&&!zy(P)&&P.defaultProps===void 0&&_.compare===null?(u.tag=15,u.type=P,Ub(c,u,P,S,A)):(c=k_(_.type,null,S,u,u.mode,A),c.ref=u.ref,c.return=u,u.child=c)}if(P=c.child,!og(c,A)){var q=P.memoizedProps;if(_=_.compare,_=_!==null?_:zl,_(q,S)&&c.ref===u.ref)return uc(c,u,A)}return u.flags|=1,c=tl(P,S),c.ref=u.ref,c.return=u,u.child=c}function Ub(c,u,_,S,A){if(c!==null){var P=c.memoizedProps;if(zl(P,S)&&c.ref===u.ref)if(rs=!1,u.pendingProps=S=P,og(c,A))(c.flags&131072)!==0&&(rs=!0);else return u.lanes=c.lanes,uc(c,u,A)}return Av(c,u,_,S,A)}function jb(c,u,_){var S=u.pendingProps,A=S.children,P=c!==null?c.memoizedState:null;if(S.mode==="hidden"){if((u.flags&128)!==0){if(S=P!==null?P.baseLanes|_:_,c!==null){for(A=u.child=c.child,P=0;A!==null;)P=P|A.lanes|A.childLanes,A=A.sibling;u.childLanes=P&~S}else u.childLanes=0,u.child=null;return Vb(c,u,S,_)}if((_&536870912)!==0)u.memoizedState={baseLanes:0,cachePool:null},c!==null&&F_(u,P!==null?P.cachePool:null),P!==null?yf(u,P):mu(),Ib(u);else return u.lanes=u.childLanes=536870912,Vb(c,u,P!==null?P.baseLanes|_:_,_)}else P!==null?(F_(u,P.cachePool),yf(u,P),id(),u.memoizedState=null):(c!==null&&F_(u,null),mu(),id());return ps(c,u,A,_),u.child}function Vb(c,u,_,S){var A=Zy();return A=A===null?null:{parent:Ir._currentValue,pool:A},u.memoizedState={baseLanes:_,cachePool:A},c!==null&&F_(u,null),mu(),Ib(u),c!==null&&hf(c,u,S,!0),null}function ag(c,u){var _=u.ref;if(_===null)c!==null&&c.ref!==null&&(u.flags|=4194816);else{if(typeof _!="function"&&typeof _!="object")throw Error(d(284));(c===null||c.ref!==_)&&(u.flags|=4194816)}}function Av(c,u,_,S,A){return cc(u),_=sv(c,u,_,S,void 0,A),S=av(),c!==null&&!rs?(q_(c,u,A),uc(c,u,A)):(pi&&S&&U_(u),u.flags|=1,ps(c,u,_,A),u.child)}function Iv(c,u,_,S,A,P){return cc(u),u.updateQueue=null,_=ab(u,S,_,A),sb(c),S=av(),c!==null&&!rs?(q_(c,u,P),uc(c,u,P)):(pi&&S&&U_(u),u.flags|=1,ps(c,u,_,P),u.child)}function Nv(c,u,_,S,A){if(cc(u),u.stateNode===null){var P=el,q=_.contextType;typeof q=="object"&&q!==null&&(P=Br(q)),P=new _(S,P),u.memoizedState=P.state!==null&&P.state!==void 0?P.state:null,P.updater=bv,u.stateNode=P,P._reactInternals=u,P=u.stateNode,P.props=S,P.state=u.memoizedState,P.refs={},H_(u),q=_.contextType,P.context=typeof q=="object"&&q!==null?Br(q):el,P.state=u.memoizedState,q=_.getDerivedStateFromProps,typeof q=="function"&&(ng(u,_,q,S),P.state=u.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof P.getSnapshotBeforeUpdate=="function"||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(q=P.state,typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount(),q!==P.state&&bv.enqueueReplaceState(P,P.state,null),pu(u,S,P,A),hu(),P.state=u.memoizedState),typeof P.componentDidMount=="function"&&(u.flags|=4194308),S=!0}else if(c===null){P=u.stateNode;var ie=u.memoizedProps,Se=vu(_,ie);P.props=Se;var ke=P.context,Ze=_.contextType;q=el,typeof Ze=="object"&&Ze!==null&&(q=Br(Ze));var dt=_.getDerivedStateFromProps;Ze=typeof dt=="function"||typeof P.getSnapshotBeforeUpdate=="function",ie=u.pendingProps!==ie,Ze||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(ie||ke!==q)&&Nb(u,P,S,q),Ro=!1;var Ge=u.memoizedState;P.state=Ge,pu(u,S,P,A),hu(),ke=u.memoizedState,ie||Ge!==ke||Ro?(typeof dt=="function"&&(ng(u,_,dt,S),ke=u.memoizedState),(Se=Ro||Cv(u,_,Se,S,Ge,ke,q))?(Ze||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount()),typeof P.componentDidMount=="function"&&(u.flags|=4194308)):(typeof P.componentDidMount=="function"&&(u.flags|=4194308),u.memoizedProps=S,u.memoizedState=ke),P.props=S,P.state=ke,P.context=q,S=Se):(typeof P.componentDidMount=="function"&&(u.flags|=4194308),S=!1)}else{P=u.stateNode,ev(c,u),q=u.memoizedProps,Ze=vu(_,q),P.props=Ze,dt=u.pendingProps,Ge=P.context,ke=_.contextType,Se=el,typeof ke=="object"&&ke!==null&&(Se=Br(ke)),ie=_.getDerivedStateFromProps,(ke=typeof ie=="function"||typeof P.getSnapshotBeforeUpdate=="function")||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(q!==dt||Ge!==Se)&&Nb(u,P,S,Se),Ro=!1,Ge=u.memoizedState,P.state=Ge,pu(u,S,P,A),hu();var He=u.memoizedState;q!==dt||Ge!==He||Ro||c!==null&&c.dependencies!==null&&V_(c.dependencies)?(typeof ie=="function"&&(ng(u,_,ie,S),He=u.memoizedState),(Ze=Ro||Cv(u,_,Ze,S,Ge,He,Se)||c!==null&&c.dependencies!==null&&V_(c.dependencies))?(ke||typeof P.UNSAFE_componentWillUpdate!="function"&&typeof P.componentWillUpdate!="function"||(typeof P.componentWillUpdate=="function"&&P.componentWillUpdate(S,He,Se),typeof P.UNSAFE_componentWillUpdate=="function"&&P.UNSAFE_componentWillUpdate(S,He,Se)),typeof P.componentDidUpdate=="function"&&(u.flags|=4),typeof P.getSnapshotBeforeUpdate=="function"&&(u.flags|=1024)):(typeof P.componentDidUpdate!="function"||q===c.memoizedProps&&Ge===c.memoizedState||(u.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||q===c.memoizedProps&&Ge===c.memoizedState||(u.flags|=1024),u.memoizedProps=S,u.memoizedState=He),P.props=S,P.state=He,P.context=Se,S=Ze):(typeof P.componentDidUpdate!="function"||q===c.memoizedProps&&Ge===c.memoizedState||(u.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||q===c.memoizedProps&&Ge===c.memoizedState||(u.flags|=1024),S=!1)}return P=S,ag(c,u),S=(u.flags&128)!==0,P||S?(P=u.stateNode,_=S&&typeof _.getDerivedStateFromError!="function"?null:P.render(),u.flags|=1,c!==null&&S?(u.child=yu(u,c.child,null,A),u.child=yu(u,null,_,A)):ps(c,u,_,A),u.memoizedState=P.state,c=u.child):c=uc(c,u,A),c}function Fb(c,u,_,S){return cu(),u.flags|=256,ps(c,u,_,S),u.child}var Ov={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Mh(c){return{baseLanes:c,cachePool:ZR()}}function Lf(c,u,_){return c=c!==null?c.childLanes&~_:0,u&&(c|=Xa),c}function Dv(c,u,_){var S=u.pendingProps,A=!1,P=(u.flags&128)!==0,q;if((q=P)||(q=c!==null&&c.memoizedState===null?!1:(Hr.current&2)!==0),q&&(A=!0,u.flags&=-129),q=(u.flags&32)!==0,u.flags&=-33,c===null){if(pi){if(A?nd(u):id(),pi){var ie=Yi,Se;if(Se=ie){e:{for(Se=ie,ie=oc;Se.nodeType!==8;){if(!ie){ie=null;break e}if(Se=Do(Se.nextSibling),Se===null){ie=null;break e}}ie=Se}ie!==null?(u.memoizedState={dehydrated:ie,treeContext:ru!==null?{id:nl,overflow:To}:null,retryLane:536870912,hydrationErrors:null},Se=Aa(18,null,null,0),Se.stateNode=ie,Se.return=u,u.child=Se,Cs=u,Yi=null,Se=!0):Se=!1}Se||ou(u)}if(ie=u.memoizedState,ie!==null&&(ie=ie.dehydrated,ie!==null))return Lg(ie)?u.lanes=32:u.lanes=536870912,null;dc(u)}return ie=S.children,S=S.fallback,A?(id(),A=u.mode,ie=kf({mode:"hidden",children:ie},A),S=Yl(S,A,_,null),ie.return=u,S.return=u,ie.sibling=S,u.child=ie,A=u.child,A.memoizedState=Mh(_),A.childLanes=Lf(c,q,_),u.memoizedState=Ov,S):(nd(u),Uh(u,ie))}if(Se=c.memoizedState,Se!==null&&(ie=Se.dehydrated,ie!==null)){if(P)u.flags&256?(nd(u),u.flags&=-257,u=Pv(c,u,_)):u.memoizedState!==null?(id(),u.child=c.child,u.flags|=128,u=null):(id(),A=S.fallback,ie=u.mode,S=kf({mode:"visible",children:S.children},ie),A=Yl(A,ie,_,null),A.flags|=2,S.return=u,A.return=u,S.sibling=A,u.child=S,yu(u,c.child,null,_),S=u.child,S.memoizedState=Mh(_),S.childLanes=Lf(c,q,_),u.memoizedState=Ov,u=A);else if(nd(u),Lg(ie)){if(q=ie.nextSibling&&ie.nextSibling.dataset,q)var ke=q.dgst;q=ke,S=Error(d(419)),S.stack="",S.digest=q,uf({value:S,source:null,stack:null}),u=Pv(c,u,_)}else if(rs||hf(c,u,_,!1),q=(_&c.childLanes)!==0,rs||q){if(q=Bi,q!==null&&(S=_&-_,S=(S&42)!==0?1:va(S),S=(S&(q.suspendedLanes|_))!==0?0:S,S!==0&&S!==Se.retryLane))throw Se.retryLane=S,vh(c,S),aa(q,c,S),xb;ie.data==="$?"||Iu(),u=Pv(c,u,_)}else ie.data==="$?"?(u.flags|=192,u.child=c.child,u=null):(c=Se.treeContext,Yi=Do(ie.nextSibling),Cs=u,pi=!0,au=null,oc=!1,c!==null&&(Ia[Ka++]=nl,Ia[Ka++]=To,Ia[Ka++]=ru,nl=c.id,To=c.overflow,ru=u),u=Uh(u,S.children),u.flags|=4096);return u}return A?(id(),A=S.fallback,ie=u.mode,Se=c.child,ke=Se.sibling,S=tl(Se,{mode:"hidden",children:S.children}),S.subtreeFlags=Se.subtreeFlags&65011712,ke!==null?A=tl(ke,A):(A=Yl(A,ie,_,null),A.flags|=2),A.return=u,S.return=u,S.sibling=A,u.child=S,S=A,A=u.child,ie=c.child.memoizedState,ie===null?ie=Mh(_):(Se=ie.cachePool,Se!==null?(ke=Ir._currentValue,Se=Se.parent!==ke?{parent:ke,pool:ke}:Se):Se=ZR(),ie={baseLanes:ie.baseLanes|_,cachePool:Se}),A.memoizedState=ie,A.childLanes=Lf(c,q,_),u.memoizedState=Ov,S):(nd(u),_=c.child,c=_.sibling,_=tl(_,{mode:"visible",children:S.children}),_.return=u,_.sibling=null,c!==null&&(q=u.deletions,q===null?(u.deletions=[c],u.flags|=16):q.push(c)),u.child=_,u.memoizedState=null,_)}function Uh(c,u){return u=kf({mode:"visible",children:u},c.mode),u.return=c,c.child=u}function kf(c,u){return c=Aa(22,c,null,u),c.lanes=0,c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},c}function Pv(c,u,_){return yu(u,c.child,null,_),c=Uh(u,u.pendingProps.children),c.flags|=2,u.memoizedState=null,c}function Lv(c,u,_){c.lanes|=u;var S=c.alternate;S!==null&&(S.lanes|=u),Qy(c.return,u,_)}function jh(c,u,_,S,A){var P=c.memoizedState;P===null?c.memoizedState={isBackwards:u,rendering:null,renderingStartTime:0,last:S,tail:_,tailMode:A}:(P.isBackwards=u,P.rendering=null,P.renderingStartTime=0,P.last=S,P.tail=_,P.tailMode=A)}function Bb(c,u,_){var S=u.pendingProps,A=S.revealOrder,P=S.tail;if(ps(c,u,S.children,_),S=Hr.current,(S&2)!==0)S=S&1|2,u.flags|=128;else{if(c!==null&&(c.flags&128)!==0)e:for(c=u.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&Lv(c,_,u);else if(c.tag===19)Lv(c,_,u);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===u)break e;for(;c.sibling===null;){if(c.return===null||c.return===u)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}S&=1}switch(Be(Hr,S),A){case"forwards":for(_=u.child,A=null;_!==null;)c=_.alternate,c!==null&&xh(c)===null&&(A=_),_=_.sibling;_=A,_===null?(A=u.child,u.child=null):(A=_.sibling,_.sibling=null),jh(u,!1,A,_,P);break;case"backwards":for(_=null,A=u.child,u.child=null;A!==null;){if(c=A.alternate,c!==null&&xh(c)===null){u.child=A;break}c=A.sibling,A.sibling=_,_=A,A=c}jh(u,!0,_,null,P);break;case"together":jh(u,!1,null,null,void 0);break;default:u.memoizedState=null}return u.child}function uc(c,u,_){if(c!==null&&(u.dependencies=c.dependencies),Io|=u.lanes,(_&u.childLanes)===0)if(c!==null){if(hf(c,u,_,!1),(_&u.childLanes)===0)return null}else return null;if(c!==null&&u.child!==c.child)throw Error(d(153));if(u.child!==null){for(c=u.child,_=tl(c,c.pendingProps),u.child=_,_.return=u;c.sibling!==null;)c=c.sibling,_=_.sibling=tl(c,c.pendingProps),_.return=u;_.sibling=null}return u.child}function og(c,u){return(c.lanes&u)!==0?!0:(c=c.dependencies,!!(c!==null&&V_(c)))}function SN(c,u,_){switch(u.tag){case 3:bt(u,u.stateNode.containerInfo),Xl(u,Ir,c.memoizedState.cache),cu();break;case 27:case 5:fn(u);break;case 4:bt(u,u.stateNode.containerInfo);break;case 10:Xl(u,u.type,u.memoizedProps.value);break;case 13:var S=u.memoizedState;if(S!==null)return S.dehydrated!==null?(nd(u),u.flags|=128,null):(_&u.child.childLanes)!==0?Dv(c,u,_):(nd(u),c=uc(c,u,_),c!==null?c.sibling:null);nd(u);break;case 19:var A=(c.flags&128)!==0;if(S=(_&u.childLanes)!==0,S||(hf(c,u,_,!1),S=(_&u.childLanes)!==0),A){if(S)return Bb(c,u,_);u.flags|=128}if(A=u.memoizedState,A!==null&&(A.rendering=null,A.tail=null,A.lastEffect=null),Be(Hr,Hr.current),S)break;return null;case 22:case 23:return u.lanes=0,jb(c,u,_);case 24:Xl(u,Ir,c.memoizedState.cache)}return uc(c,u,_)}function xf(c,u,_){if(c!==null)if(c.memoizedProps!==u.pendingProps)rs=!0;else{if(!og(c,_)&&(u.flags&128)===0)return rs=!1,SN(c,u,_);rs=(c.flags&131072)!==0}else rs=!1,pi&&(u.flags&1048576)!==0&&qy(u,M_,u.index);switch(u.lanes=0,u.tag){case 16:e:{c=u.pendingProps;var S=u.elementType,A=S._init;if(S=A(S._payload),u.type=S,typeof S=="function")zy(S)?(c=vu(S,c),u.tag=1,u=Nv(null,u,S,c,_)):(u.tag=0,u=Av(null,u,S,c,_));else{if(S!=null){if(A=S.$$typeof,A===Ce){u.tag=11,u=sg(null,u,S,c,_);break e}else if(A===Z){u.tag=14,u=Mb(null,u,S,c,_);break e}}throw u=Fe(S)||S,Error(d(306,u,""))}}return u;case 0:return Av(c,u,u.type,u.pendingProps,_);case 1:return S=u.type,A=vu(S,u.pendingProps),Nv(c,u,S,A,_);case 3:e:{if(bt(u,u.stateNode.containerInfo),c===null)throw Error(d(387));S=u.pendingProps;var P=u.memoizedState;A=P.element,ev(c,u),pu(u,S,null,_);var q=u.memoizedState;if(S=q.cache,Xl(u,Ir,S),S!==P.cache&&$y(u,[Ir],_,!0),hu(),S=q.element,P.isDehydrated)if(P={element:S,isDehydrated:!1,cache:q.cache},u.updateQueue.baseState=P,u.memoizedState=P,u.flags&256){u=Fb(c,u,S,_);break e}else if(S!==A){A=wa(Error(d(424)),u),uf(A),u=Fb(c,u,S,_);break e}else{switch(c=u.stateNode.containerInfo,c.nodeType){case 9:c=c.body;break;default:c=c.nodeName==="HTML"?c.ownerDocument.body:c}for(Yi=Do(c.firstChild),Cs=u,pi=!0,au=null,oc=!0,_=Ab(u,null,S,_),u.child=_;_;)_.flags=_.flags&-3|4096,_=_.sibling}else{if(cu(),S===A){u=uc(c,u,_);break e}ps(c,u,S,_)}u=u.child}return u;case 26:return ag(c,u),c===null?(_=gC(u.type,null,u.pendingProps,null))?u.memoizedState=_:pi||(_=u.type,c=u.pendingProps,S=Pg($e.current).createElement(_),S[Ur]=u,S[Ar]=c,as(S,_,c),lr(S),u.stateNode=S):u.memoizedState=gC(u.type,c.memoizedProps,u.pendingProps,c.memoizedState),null;case 27:return fn(u),c===null&&pi&&(S=u.stateNode=pC(u.type,u.pendingProps,$e.current),Cs=u,oc=!0,A=Yi,hd(u.type)?(hS=A,Yi=Do(S.firstChild)):Yi=A),ps(c,u,u.pendingProps.children,_),ag(c,u),c===null&&(u.flags|=4194304),u.child;case 5:return c===null&&pi&&((A=S=Yi)&&(S=VN(S,u.type,u.pendingProps,oc),S!==null?(u.stateNode=S,Cs=u,Yi=Do(S.firstChild),oc=!1,A=!0):A=!1),A||ou(u)),fn(u),A=u.type,P=u.pendingProps,q=c!==null?c.memoizedProps:null,S=P.children,lS(A,P)?S=null:q!==null&&lS(A,q)&&(u.flags|=32),u.memoizedState!==null&&(A=sv(c,u,ob,null,null,_),rm._currentValue=A),ag(c,u),ps(c,u,S,_),u.child;case 6:return c===null&&pi&&((c=_=Yi)&&(_=FN(_,u.pendingProps,oc),_!==null?(u.stateNode=_,Cs=u,Yi=null,c=!0):c=!1),c||ou(u)),null;case 13:return Dv(c,u,_);case 4:return bt(u,u.stateNode.containerInfo),S=u.pendingProps,c===null?u.child=yu(u,null,S,_):ps(c,u,S,_),u.child;case 11:return sg(c,u,u.type,u.pendingProps,_);case 7:return ps(c,u,u.pendingProps,_),u.child;case 8:return ps(c,u,u.pendingProps.children,_),u.child;case 12:return ps(c,u,u.pendingProps.children,_),u.child;case 10:return S=u.pendingProps,Xl(u,u.type,S.value),ps(c,u,S.children,_),u.child;case 9:return A=u.type._context,S=u.pendingProps.children,cc(u),A=Br(A),S=S(A),u.flags|=1,ps(c,u,S,_),u.child;case 14:return Mb(c,u,u.type,u.pendingProps,_);case 15:return Ub(c,u,u.type,u.pendingProps,_);case 19:return Bb(c,u,_);case 31:return S=u.pendingProps,_=u.mode,S={mode:S.mode,children:S.children},c===null?(_=kf(S,_),_.ref=u.ref,u.child=_,_.return=u,u=_):(_=tl(c.child,S),_.ref=u.ref,u.child=_,_.return=u,u=_),u;case 22:return jb(c,u,_);case 24:return cc(u),S=Br(Ir),c===null?(A=Zy(),A===null&&(A=Bi,P=pf(),A.pooledCache=P,P.refCount++,P!==null&&(A.pooledCacheLanes|=_),A=P),u.memoizedState={parent:S,cache:A},H_(u),Xl(u,Ir,A)):((c.lanes&_)!==0&&(ev(c,u),pu(u,null,null,_),hu()),A=c.memoizedState,P=u.memoizedState,A.parent!==S?(A={parent:S,cache:S},u.memoizedState=A,u.lanes===0&&(u.memoizedState=u.updateQueue.baseState=A),Xl(u,Ir,S)):(S=P.cache,Xl(u,Ir,S),S!==A.cache&&$y(u,[Ir],_,!0))),ps(c,u,u.pendingProps.children,_),u.child;case 29:throw u.pendingProps}throw Error(d(156,u.tag))}function hc(c){c.flags|=4}function Gb(c,u){if(u.type!=="stylesheet"||(u.state.loading&4)!==0)c.flags&=-16777217;else if(c.flags|=16777216,!vC(u)){if(u=Gr.current,u!==null&&((ei&4194048)===ei?lc!==null:(ei&62914560)!==ei&&(ei&536870912)===0||u!==lc))throw _f=wh,eb;c.flags|=8192}}function cg(c,u){u!==null&&(c.flags|=4),c.flags&16384&&(u=c.tag!==22?xl():536870912,c.lanes|=u,bu|=u)}function Mf(c,u){if(!pi)switch(c.tailMode){case"hidden":u=c.tail;for(var _=null;u!==null;)u.alternate!==null&&(_=u),u=u.sibling;_===null?c.tail=null:_.sibling=null;break;case"collapsed":_=c.tail;for(var S=null;_!==null;)_.alternate!==null&&(S=_),_=_.sibling;S===null?u||c.tail===null?c.tail=null:c.tail.sibling=null:S.sibling=null}}function Fi(c){var u=c.alternate!==null&&c.alternate.child===c.child,_=0,S=0;if(u)for(var A=c.child;A!==null;)_|=A.lanes|A.childLanes,S|=A.subtreeFlags&65011712,S|=A.flags&65011712,A.return=c,A=A.sibling;else for(A=c.child;A!==null;)_|=A.lanes|A.childLanes,S|=A.subtreeFlags,S|=A.flags,A.return=c,A=A.sibling;return c.subtreeFlags|=S,c.childLanes=_,u}function TN(c,u,_){var S=u.pendingProps;switch(Ky(u),u.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fi(u),null;case 1:return Fi(u),null;case 3:return _=u.stateNode,S=null,c!==null&&(S=c.memoizedState.cache),u.memoizedState.cache!==S&&(u.flags|=2048),rl(Ir),Bt(),_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(c===null||c.child===null)&&(df(u)?hc(u):c===null||c.memoizedState.isDehydrated&&(u.flags&256)===0||(u.flags|=1024,YR())),Fi(u),null;case 26:return _=u.memoizedState,c===null?(hc(u),_!==null?(Fi(u),Gb(u,_)):(Fi(u),u.flags&=-16777217)):_?_!==c.memoizedState?(hc(u),Fi(u),Gb(u,_)):(Fi(u),u.flags&=-16777217):(c.memoizedProps!==S&&hc(u),Fi(u),u.flags&=-16777217),null;case 27:vn(u),_=$e.current;var A=u.type;if(c!==null&&u.stateNode!=null)c.memoizedProps!==S&&hc(u);else{if(!S){if(u.stateNode===null)throw Error(d(166));return Fi(u),null}c=rt.current,df(u)?Xy(u):(c=pC(A,S,_),u.stateNode=c,hc(u))}return Fi(u),null;case 5:if(vn(u),_=u.type,c!==null&&u.stateNode!=null)c.memoizedProps!==S&&hc(u);else{if(!S){if(u.stateNode===null)throw Error(d(166));return Fi(u),null}if(c=rt.current,df(u))Xy(u);else{switch(A=Pg($e.current),c){case 1:c=A.createElementNS("http://www.w3.org/2000/svg",_);break;case 2:c=A.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;default:switch(_){case"svg":c=A.createElementNS("http://www.w3.org/2000/svg",_);break;case"math":c=A.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;case"script":c=A.createElement("div"),c.innerHTML="<script><\/script>",c=c.removeChild(c.firstChild);break;case"select":c=typeof S.is=="string"?A.createElement("select",{is:S.is}):A.createElement("select"),S.multiple?c.multiple=!0:S.size&&(c.size=S.size);break;default:c=typeof S.is=="string"?A.createElement(_,{is:S.is}):A.createElement(_)}}c[Ur]=u,c[Ar]=S;e:for(A=u.child;A!==null;){if(A.tag===5||A.tag===6)c.appendChild(A.stateNode);else if(A.tag!==4&&A.tag!==27&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===u)break e;for(;A.sibling===null;){if(A.return===null||A.return===u)break e;A=A.return}A.sibling.return=A.return,A=A.sibling}u.stateNode=c;e:switch(as(c,_,S),_){case"button":case"input":case"select":case"textarea":c=!!S.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&hc(u)}}return Fi(u),u.flags&=-16777217,null;case 6:if(c&&u.stateNode!=null)c.memoizedProps!==S&&hc(u);else{if(typeof S!="string"&&u.stateNode===null)throw Error(d(166));if(c=$e.current,df(u)){if(c=u.stateNode,_=u.memoizedProps,S=null,A=Cs,A!==null)switch(A.tag){case 27:case 5:S=A.memoizedProps}c[Ur]=u,c=!!(c.nodeValue===_||S!==null&&S.suppressHydrationWarning===!0||Dg(c.nodeValue,_)),c||ou(u)}else c=Pg(c).createTextNode(S),c[Ur]=u,u.stateNode=c}return Fi(u),null;case 13:if(S=u.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(A=df(u),S!==null&&S.dehydrated!==null){if(c===null){if(!A)throw Error(d(318));if(A=u.memoizedState,A=A!==null?A.dehydrated:null,!A)throw Error(d(317));A[Ur]=u}else cu(),(u.flags&128)===0&&(u.memoizedState=null),u.flags|=4;Fi(u),A=!1}else A=YR(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=A),A=!0;if(!A)return u.flags&256?(dc(u),u):(dc(u),null)}if(dc(u),(u.flags&128)!==0)return u.lanes=_,u;if(_=S!==null,c=c!==null&&c.memoizedState!==null,_){S=u.child,A=null,S.alternate!==null&&S.alternate.memoizedState!==null&&S.alternate.memoizedState.cachePool!==null&&(A=S.alternate.memoizedState.cachePool.pool);var P=null;S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(P=S.memoizedState.cachePool.pool),P!==A&&(S.flags|=2048)}return _!==c&&_&&(u.child.flags|=8192),cg(u,u.updateQueue),Fi(u),null;case 4:return Bt(),c===null&&Ng(u.stateNode.containerInfo),Fi(u),null;case 10:return rl(u.type),Fi(u),null;case 19:if(Oe(Hr),A=u.memoizedState,A===null)return Fi(u),null;if(S=(u.flags&128)!==0,P=A.rendering,P===null)if(S)Mf(A,!1);else{if(nr!==0||c!==null&&(c.flags&128)!==0)for(c=u.child;c!==null;){if(P=xh(c),P!==null){for(u.flags|=128,Mf(A,!1),c=P.updateQueue,u.updateQueue=c,cg(u,c),u.subtreeFlags=0,c=_,_=u.child;_!==null;)L_(_,c),_=_.sibling;return Be(Hr,Hr.current&1|2),u.child}c=c.sibling}A.tail!==null&&rn()>Hh&&(u.flags|=128,S=!0,Mf(A,!1),u.lanes=4194304)}else{if(!S)if(c=xh(P),c!==null){if(u.flags|=128,S=!0,c=c.updateQueue,u.updateQueue=c,cg(u,c),Mf(A,!0),A.tail===null&&A.tailMode==="hidden"&&!P.alternate&&!pi)return Fi(u),null}else 2*rn()-A.renderingStartTime>Hh&&_!==536870912&&(u.flags|=128,S=!0,Mf(A,!1),u.lanes=4194304);A.isBackwards?(P.sibling=u.child,u.child=P):(c=A.last,c!==null?c.sibling=P:u.child=P,A.last=P)}return A.tail!==null?(u=A.tail,A.rendering=u,A.tail=u.sibling,A.renderingStartTime=rn(),u.sibling=null,c=Hr.current,Be(Hr,S?c&1|2:c&1),u):(Fi(u),null);case 22:case 23:return dc(u),rv(),S=u.memoizedState!==null,c!==null?c.memoizedState!==null!==S&&(u.flags|=8192):S&&(u.flags|=8192),S?(_&536870912)!==0&&(u.flags&128)===0&&(Fi(u),u.subtreeFlags&6&&(u.flags|=8192)):Fi(u),_=u.updateQueue,_!==null&&cg(u,_.retryQueue),_=null,c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(_=c.memoizedState.cachePool.pool),S=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(S=u.memoizedState.cachePool.pool),S!==_&&(u.flags|=2048),c!==null&&Oe(Jl),null;case 24:return _=null,c!==null&&(_=c.memoizedState.cache),u.memoizedState.cache!==_&&(u.flags|=2048),rl(Ir),Fi(u),null;case 25:return null;case 30:return null}throw Error(d(156,u.tag))}function RN(c,u){switch(Ky(u),u.tag){case 1:return c=u.flags,c&65536?(u.flags=c&-65537|128,u):null;case 3:return rl(Ir),Bt(),c=u.flags,(c&65536)!==0&&(c&128)===0?(u.flags=c&-65537|128,u):null;case 26:case 27:case 5:return vn(u),null;case 13:if(dc(u),c=u.memoizedState,c!==null&&c.dehydrated!==null){if(u.alternate===null)throw Error(d(340));cu()}return c=u.flags,c&65536?(u.flags=c&-65537|128,u):null;case 19:return Oe(Hr),null;case 4:return Bt(),null;case 10:return rl(u.type),null;case 22:case 23:return dc(u),rv(),c!==null&&Oe(Jl),c=u.flags,c&65536?(u.flags=c&-65537|128,u):null;case 24:return rl(Ir),null;case 25:return null;default:return null}}function Hb(c,u){switch(Ky(u),u.tag){case 3:rl(Ir),Bt();break;case 26:case 27:case 5:vn(u);break;case 4:Bt();break;case 13:dc(u);break;case 19:Oe(Hr);break;case 10:rl(u.type);break;case 22:case 23:dc(u),rv(),c!==null&&Oe(Jl);break;case 24:rl(Ir)}}function Vh(c,u){try{var _=u.updateQueue,S=_!==null?_.lastEffect:null;if(S!==null){var A=S.next;_=A;do{if((_.tag&c)===c){S=void 0;var P=_.create,q=_.inst;S=P(),q.destroy=S}_=_.next}while(_!==A)}}catch(ie){xi(u,u.return,ie)}}function rd(c,u,_){try{var S=u.updateQueue,A=S!==null?S.lastEffect:null;if(A!==null){var P=A.next;S=P;do{if((S.tag&c)===c){var q=S.inst,ie=q.destroy;if(ie!==void 0){q.destroy=void 0,A=u;var Se=_,ke=ie;try{ke()}catch(Ze){xi(A,Se,Ze)}}}S=S.next}while(S!==P)}}catch(Ze){xi(u,u.return,Ze)}}function zb(c){var u=c.updateQueue;if(u!==null){var _=c.stateNode;try{z_(u,_)}catch(S){xi(c,c.return,S)}}}function lg(c,u,_){_.props=vu(c.type,c.memoizedProps),_.state=c.memoizedState;try{_.componentWillUnmount()}catch(S){xi(c,u,S)}}function Uf(c,u){try{var _=c.ref;if(_!==null){switch(c.tag){case 26:case 27:case 5:var S=c.stateNode;break;case 30:S=c.stateNode;break;default:S=c.stateNode}typeof _=="function"?c.refCleanup=_(S):_.current=S}}catch(A){xi(c,u,A)}}function Ya(c,u){var _=c.ref,S=c.refCleanup;if(_!==null)if(typeof S=="function")try{S()}catch(A){xi(c,u,A)}finally{c.refCleanup=null,c=c.alternate,c!=null&&(c.refCleanup=null)}else if(typeof _=="function")try{_(null)}catch(A){xi(c,u,A)}else _.current=null}function Wb(c){var u=c.type,_=c.memoizedProps,S=c.stateNode;try{e:switch(u){case"button":case"input":case"select":case"textarea":_.autoFocus&&S.focus();break e;case"img":_.src?S.src=_.src:_.srcSet&&(S.srcset=_.srcSet)}}catch(A){xi(c,c.return,A)}}function dg(c,u,_){try{var S=c.stateNode;kN(S,c.type,_,u),S[Ar]=u}catch(A){xi(c,c.return,A)}}function qb(c){return c.tag===5||c.tag===3||c.tag===26||c.tag===27&&hd(c.type)||c.tag===4}function kv(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||qb(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.tag===27&&hd(c.type)||c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function ug(c,u,_){var S=c.tag;if(S===5||S===6)c=c.stateNode,u?(_.nodeType===9?_.body:_.nodeName==="HTML"?_.ownerDocument.body:_).insertBefore(c,u):(u=_.nodeType===9?_.body:_.nodeName==="HTML"?_.ownerDocument.body:_,u.appendChild(c),_=_._reactRootContainer,_!=null||u.onclick!==null||(u.onclick=$f));else if(S!==4&&(S===27&&hd(c.type)&&(_=c.stateNode,u=null),c=c.child,c!==null))for(ug(c,u,_),c=c.sibling;c!==null;)ug(c,u,_),c=c.sibling}function hg(c,u,_){var S=c.tag;if(S===5||S===6)c=c.stateNode,u?_.insertBefore(c,u):_.appendChild(c);else if(S!==4&&(S===27&&hd(c.type)&&(_=c.stateNode),c=c.child,c!==null))for(hg(c,u,_),c=c.sibling;c!==null;)hg(c,u,_),c=c.sibling}function Kb(c){var u=c.stateNode,_=c.memoizedProps;try{for(var S=c.type,A=u.attributes;A.length;)u.removeAttributeNode(A[0]);as(u,S,_),u[Ur]=c,u[Ar]=_}catch(P){xi(c,c.return,P)}}var pc=!1,ur=!1,jf=!1,Yb=typeof WeakSet=="function"?WeakSet:Set,ss=null;function Vf(c,u){if(c=c.containerInfo,cS=Fg,c=Zc(c),xy(c)){if("selectionStart"in c)var _={start:c.selectionStart,end:c.selectionEnd};else e:{_=(_=c.ownerDocument)&&_.defaultView||window;var S=_.getSelection&&_.getSelection();if(S&&S.rangeCount!==0){_=S.anchorNode;var A=S.anchorOffset,P=S.focusNode;S=S.focusOffset;try{_.nodeType,P.nodeType}catch{_=null;break e}var q=0,ie=-1,Se=-1,ke=0,Ze=0,dt=c,Ge=null;t:for(;;){for(var He;dt!==_||A!==0&&dt.nodeType!==3||(ie=q+A),dt!==P||S!==0&&dt.nodeType!==3||(Se=q+S),dt.nodeType===3&&(q+=dt.nodeValue.length),(He=dt.firstChild)!==null;)Ge=dt,dt=He;for(;;){if(dt===c)break t;if(Ge===_&&++ke===A&&(ie=q),Ge===P&&++Ze===S&&(Se=q),(He=dt.nextSibling)!==null)break;dt=Ge,Ge=dt.parentNode}dt=He}_=ie===-1||Se===-1?null:{start:ie,end:Se}}else _=null}_=_||{start:0,end:0}}else _=null;for(ep={focusedElem:c,selectionRange:_},Fg=!1,ss=u;ss!==null;)if(u=ss,c=u.child,(u.subtreeFlags&1024)!==0&&c!==null)c.return=u,ss=c;else for(;ss!==null;){switch(u=ss,P=u.alternate,c=u.flags,u.tag){case 0:break;case 11:case 15:break;case 1:if((c&1024)!==0&&P!==null){c=void 0,_=u,A=P.memoizedProps,P=P.memoizedState,S=_.stateNode;try{var hn=vu(_.type,A,_.elementType===_.type);c=S.getSnapshotBeforeUpdate(hn,P),S.__reactInternalSnapshotBeforeUpdate=c}catch(Xt){xi(_,_.return,Xt)}}break;case 3:if((c&1024)!==0){if(c=u.stateNode.containerInfo,_=c.nodeType,_===9)uS(c);else if(_===1)switch(c.nodeName){case"HEAD":case"HTML":case"BODY":uS(c);break;default:c.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((c&1024)!==0)throw Error(d(163))}if(c=u.sibling,c!==null){c.return=u.return,ss=c;break}ss=u.return}}function xv(c,u,_){var S=_.flags;switch(_.tag){case 0:case 11:case 15:js(c,_),S&4&&Vh(5,_);break;case 1:if(js(c,_),S&4)if(c=_.stateNode,u===null)try{c.componentDidMount()}catch(q){xi(_,_.return,q)}else{var A=vu(_.type,u.memoizedProps);u=u.memoizedState;try{c.componentDidUpdate(A,u,c.__reactInternalSnapshotBeforeUpdate)}catch(q){xi(_,_.return,q)}}S&64&&zb(_),S&512&&Uf(_,_.return);break;case 3:if(js(c,_),S&64&&(c=_.updateQueue,c!==null)){if(u=null,_.child!==null)switch(_.child.tag){case 27:case 5:u=_.child.stateNode;break;case 1:u=_.child.stateNode}try{z_(c,u)}catch(q){xi(_,_.return,q)}}break;case 27:u===null&&S&4&&Kb(_);case 26:case 5:js(c,_),u===null&&S&4&&Wb(_),S&512&&Uf(_,_.return);break;case 12:js(c,_);break;case 13:js(c,_),S&4&&Xb(c,_),S&64&&(c=_.memoizedState,c!==null&&(c=c.dehydrated,c!==null&&(_=NN.bind(null,_),BN(c,_))));break;case 22:if(S=_.memoizedState!==null||pc,!S){u=u!==null&&u.memoizedState!==null||ur,A=pc;var P=ur;pc=S,(ur=u)&&!P?sa(c,_,(_.subtreeFlags&8772)!==0):js(c,_),pc=A,ur=P}break;case 30:break;default:js(c,_)}}function Fh(c){var u=c.alternate;u!==null&&(c.alternate=null,Fh(u)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(u=c.stateNode,u!==null&&Gc(u)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}var Ri=null,Us=!1;function wo(c,u,_){for(_=_.child;_!==null;)Ff(c,u,_),_=_.sibling}function Ff(c,u,_){if(Me&&typeof Me.onCommitFiberUnmount=="function")try{Me.onCommitFiberUnmount(Gt,_)}catch{}switch(_.tag){case 26:ur||Ya(_,u),wo(c,u,_),_.memoizedState?_.memoizedState.count--:_.stateNode&&(_=_.stateNode,_.parentNode.removeChild(_));break;case 27:ur||Ya(_,u);var S=Ri,A=Us;hd(_.type)&&(Ri=_.stateNode,Us=!1),wo(c,u,_),Zf(_.stateNode),Ri=S,Us=A;break;case 5:ur||Ya(_,u);case 6:if(S=Ri,A=Us,Ri=null,wo(c,u,_),Ri=S,Us=A,Ri!==null)if(Us)try{(Ri.nodeType===9?Ri.body:Ri.nodeName==="HTML"?Ri.ownerDocument.body:Ri).removeChild(_.stateNode)}catch(P){xi(_,u,P)}else try{Ri.removeChild(_.stateNode)}catch(P){xi(_,u,P)}break;case 18:Ri!==null&&(Us?(c=Ri,uC(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,_.stateNode),lm(c)):uC(Ri,_.stateNode));break;case 4:S=Ri,A=Us,Ri=_.stateNode.containerInfo,Us=!0,wo(c,u,_),Ri=S,Us=A;break;case 0:case 11:case 14:case 15:ur||rd(2,_,u),ur||rd(4,_,u),wo(c,u,_);break;case 1:ur||(Ya(_,u),S=_.stateNode,typeof S.componentWillUnmount=="function"&&lg(_,u,S)),wo(c,u,_);break;case 21:wo(c,u,_);break;case 22:ur=(S=ur)||_.memoizedState!==null,wo(c,u,_),ur=S;break;default:wo(c,u,_)}}function Xb(c,u){if(u.memoizedState===null&&(c=u.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null))))try{lm(c)}catch(_){xi(u,u.return,_)}}function bN(c){switch(c.tag){case 13:case 19:var u=c.stateNode;return u===null&&(u=c.stateNode=new Yb),u;case 22:return c=c.stateNode,u=c._retryCache,u===null&&(u=c._retryCache=new Yb),u;default:throw Error(d(435,c.tag))}}function Mv(c,u){var _=bN(c);u.forEach(function(S){var A=ON.bind(null,c,S);_.has(S)||(_.add(S),S.then(A,A))})}function ra(c,u){var _=u.deletions;if(_!==null)for(var S=0;S<_.length;S++){var A=_[S],P=c,q=u,ie=q;e:for(;ie!==null;){switch(ie.tag){case 27:if(hd(ie.type)){Ri=ie.stateNode,Us=!1;break e}break;case 5:Ri=ie.stateNode,Us=!1;break e;case 3:case 4:Ri=ie.stateNode.containerInfo,Us=!0;break e}ie=ie.return}if(Ri===null)throw Error(d(160));Ff(P,q,A),Ri=null,Us=!1,P=A.alternate,P!==null&&(P.return=null),A.return=null}if(u.subtreeFlags&13878)for(u=u.child;u!==null;)Jb(u,c),u=u.sibling}var Ao=null;function Jb(c,u){var _=c.alternate,S=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:ra(u,c),Oa(c),S&4&&(rd(3,c,c.return),Vh(3,c),rd(5,c,c.return));break;case 1:ra(u,c),Oa(c),S&512&&(ur||_===null||Ya(_,_.return)),S&64&&pc&&(c=c.updateQueue,c!==null&&(S=c.callbacks,S!==null&&(_=c.shared.hiddenCallbacks,c.shared.hiddenCallbacks=_===null?S:_.concat(S))));break;case 26:var A=Ao;if(ra(u,c),Oa(c),S&512&&(ur||_===null||Ya(_,_.return)),S&4){var P=_!==null?_.memoizedState:null;if(S=c.memoizedState,_===null)if(S===null)if(c.stateNode===null){e:{S=c.type,_=c.memoizedProps,A=A.ownerDocument||A;t:switch(S){case"title":P=A.getElementsByTagName("title")[0],(!P||P[Ul]||P[Ur]||P.namespaceURI==="http://www.w3.org/2000/svg"||P.hasAttribute("itemprop"))&&(P=A.createElement(S),A.head.insertBefore(P,A.querySelector("head > title"))),as(P,S,_),P[Ur]=c,lr(P),S=P;break e;case"link":var q=mS("link","href",A).get(S+(_.href||""));if(q){for(var ie=0;ie<q.length;ie++)if(P=q[ie],P.getAttribute("href")===(_.href==null||_.href===""?null:_.href)&&P.getAttribute("rel")===(_.rel==null?null:_.rel)&&P.getAttribute("title")===(_.title==null?null:_.title)&&P.getAttribute("crossorigin")===(_.crossOrigin==null?null:_.crossOrigin)){q.splice(ie,1);break t}}P=A.createElement(S),as(P,S,_),A.head.appendChild(P);break;case"meta":if(q=mS("meta","content",A).get(S+(_.content||""))){for(ie=0;ie<q.length;ie++)if(P=q[ie],P.getAttribute("content")===(_.content==null?null:""+_.content)&&P.getAttribute("name")===(_.name==null?null:_.name)&&P.getAttribute("property")===(_.property==null?null:_.property)&&P.getAttribute("http-equiv")===(_.httpEquiv==null?null:_.httpEquiv)&&P.getAttribute("charset")===(_.charSet==null?null:_.charSet)){q.splice(ie,1);break t}}P=A.createElement(S),as(P,S,_),A.head.appendChild(P);break;default:throw Error(d(468,S))}P[Ur]=c,lr(P),S=P}c.stateNode=S}else yC(A,c.type,c.stateNode);else c.stateNode=Mg(A,S,c.memoizedProps);else P!==S?(P===null?_.stateNode!==null&&(_=_.stateNode,_.parentNode.removeChild(_)):P.count--,S===null?yC(A,c.type,c.stateNode):Mg(A,S,c.memoizedProps)):S===null&&c.stateNode!==null&&dg(c,c.memoizedProps,_.memoizedProps)}break;case 27:ra(u,c),Oa(c),S&512&&(ur||_===null||Ya(_,_.return)),_!==null&&S&4&&dg(c,c.memoizedProps,_.memoizedProps);break;case 5:if(ra(u,c),Oa(c),S&512&&(ur||_===null||Ya(_,_.return)),c.flags&32){A=c.stateNode;try{Zs(A,"")}catch(He){xi(c,c.return,He)}}S&4&&c.stateNode!=null&&(A=c.memoizedProps,dg(c,A,_!==null?_.memoizedProps:A)),S&1024&&(jf=!0);break;case 6:if(ra(u,c),Oa(c),S&4){if(c.stateNode===null)throw Error(d(162));S=c.memoizedProps,_=c.stateNode;try{_.nodeValue=S}catch(He){xi(c,c.return,He)}}break;case 3:if(jg=null,A=Ao,Ao=kg(u.containerInfo),ra(u,c),Ao=A,Oa(c),S&4&&_!==null&&_.memoizedState.isDehydrated)try{lm(u.containerInfo)}catch(He){xi(c,c.return,He)}jf&&(jf=!1,pg(c));break;case 4:S=Ao,Ao=kg(c.stateNode.containerInfo),ra(u,c),Oa(c),Ao=S;break;case 12:ra(u,c),Oa(c);break;case 13:ra(u,c),Oa(c),c.child.flags&8192&&c.memoizedState!==null!=(_!==null&&_.memoizedState!==null)&&(Wf=rn()),S&4&&(S=c.updateQueue,S!==null&&(c.updateQueue=null,Mv(c,S)));break;case 22:A=c.memoizedState!==null;var Se=_!==null&&_.memoizedState!==null,ke=pc,Ze=ur;if(pc=ke||A,ur=Ze||Se,ra(u,c),ur=Ze,pc=ke,Oa(c),S&8192)e:for(u=c.stateNode,u._visibility=A?u._visibility&-2:u._visibility|1,A&&(_===null||Se||pc||ur||Su(c)),_=null,u=c;;){if(u.tag===5||u.tag===26){if(_===null){Se=_=u;try{if(P=Se.stateNode,A)q=P.style,typeof q.setProperty=="function"?q.setProperty("display","none","important"):q.display="none";else{ie=Se.stateNode;var dt=Se.memoizedProps.style,Ge=dt!=null&&dt.hasOwnProperty("display")?dt.display:null;ie.style.display=Ge==null||typeof Ge=="boolean"?"":(""+Ge).trim()}}catch(He){xi(Se,Se.return,He)}}}else if(u.tag===6){if(_===null){Se=u;try{Se.stateNode.nodeValue=A?"":Se.memoizedProps}catch(He){xi(Se,Se.return,He)}}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===c)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===c)break e;for(;u.sibling===null;){if(u.return===null||u.return===c)break e;_===u&&(_=null),u=u.return}_===u&&(_=null),u.sibling.return=u.return,u=u.sibling}S&4&&(S=c.updateQueue,S!==null&&(_=S.retryQueue,_!==null&&(S.retryQueue=null,Mv(c,_))));break;case 19:ra(u,c),Oa(c),S&4&&(S=c.updateQueue,S!==null&&(c.updateQueue=null,Mv(c,S)));break;case 30:break;case 21:break;default:ra(u,c),Oa(c)}}function Oa(c){var u=c.flags;if(u&2){try{for(var _,S=c.return;S!==null;){if(qb(S)){_=S;break}S=S.return}if(_==null)throw Error(d(160));switch(_.tag){case 27:var A=_.stateNode,P=kv(c);hg(c,P,A);break;case 5:var q=_.stateNode;_.flags&32&&(Zs(q,""),_.flags&=-33);var ie=kv(c);hg(c,ie,q);break;case 3:case 4:var Se=_.stateNode.containerInfo,ke=kv(c);ug(c,ke,Se);break;default:throw Error(d(161))}}catch(Ze){xi(c,c.return,Ze)}c.flags&=-3}u&4096&&(c.flags&=-4097)}function pg(c){if(c.subtreeFlags&1024)for(c=c.child;c!==null;){var u=c;pg(u),u.tag===5&&u.flags&1024&&u.stateNode.reset(),c=c.sibling}}function js(c,u){if(u.subtreeFlags&8772)for(u=u.child;u!==null;)xv(c,u.alternate,u),u=u.sibling}function Su(c){for(c=c.child;c!==null;){var u=c;switch(u.tag){case 0:case 11:case 14:case 15:rd(4,u,u.return),Su(u);break;case 1:Ya(u,u.return);var _=u.stateNode;typeof _.componentWillUnmount=="function"&&lg(u,u.return,_),Su(u);break;case 27:Zf(u.stateNode);case 26:case 5:Ya(u,u.return),Su(u);break;case 22:u.memoizedState===null&&Su(u);break;case 30:Su(u);break;default:Su(u)}c=c.sibling}}function sa(c,u,_){for(_=_&&(u.subtreeFlags&8772)!==0,u=u.child;u!==null;){var S=u.alternate,A=c,P=u,q=P.flags;switch(P.tag){case 0:case 11:case 15:sa(A,P,_),Vh(4,P);break;case 1:if(sa(A,P,_),S=P,A=S.stateNode,typeof A.componentDidMount=="function")try{A.componentDidMount()}catch(ke){xi(S,S.return,ke)}if(S=P,A=S.updateQueue,A!==null){var ie=S.stateNode;try{var Se=A.shared.hiddenCallbacks;if(Se!==null)for(A.shared.hiddenCallbacks=null,A=0;A<Se.length;A++)iv(Se[A],ie)}catch(ke){xi(S,S.return,ke)}}_&&q&64&&zb(P),Uf(P,P.return);break;case 27:Kb(P);case 26:case 5:sa(A,P,_),_&&S===null&&q&4&&Wb(P),Uf(P,P.return);break;case 12:sa(A,P,_);break;case 13:sa(A,P,_),_&&q&4&&Xb(A,P);break;case 22:P.memoizedState===null&&sa(A,P,_),Uf(P,P.return);break;case 30:break;default:sa(A,P,_)}u=u.sibling}}function fg(c,u){var _=null;c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(_=c.memoizedState.cachePool.pool),c=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(c=u.memoizedState.cachePool.pool),c!==_&&(c!=null&&c.refCount++,_!=null&&ff(_))}function Vs(c,u){c=null,u.alternate!==null&&(c=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==c&&(u.refCount++,c!=null&&ff(c))}function fc(c,u,_,S){if(u.subtreeFlags&10256)for(u=u.child;u!==null;)Qb(c,u,_,S),u=u.sibling}function Qb(c,u,_,S){var A=u.flags;switch(u.tag){case 0:case 11:case 15:fc(c,u,_,S),A&2048&&Vh(9,u);break;case 1:fc(c,u,_,S);break;case 3:fc(c,u,_,S),A&2048&&(c=null,u.alternate!==null&&(c=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==c&&(u.refCount++,c!=null&&ff(c)));break;case 12:if(A&2048){fc(c,u,_,S),c=u.stateNode;try{var P=u.memoizedProps,q=P.id,ie=P.onPostCommit;typeof ie=="function"&&ie(q,u.alternate===null?"mount":"update",c.passiveEffectDuration,-0)}catch(Se){xi(u,u.return,Se)}}else fc(c,u,_,S);break;case 13:fc(c,u,_,S);break;case 23:break;case 22:P=u.stateNode,q=u.alternate,u.memoizedState!==null?P._visibility&2?fc(c,u,_,S):Bf(c,u):P._visibility&2?fc(c,u,_,S):(P._visibility|=2,Tu(c,u,_,S,(u.subtreeFlags&10256)!==0)),A&2048&&fg(q,u);break;case 24:fc(c,u,_,S),A&2048&&Vs(u.alternate,u);break;default:fc(c,u,_,S)}}function Tu(c,u,_,S,A){for(A=A&&(u.subtreeFlags&10256)!==0,u=u.child;u!==null;){var P=c,q=u,ie=_,Se=S,ke=q.flags;switch(q.tag){case 0:case 11:case 15:Tu(P,q,ie,Se,A),Vh(8,q);break;case 23:break;case 22:var Ze=q.stateNode;q.memoizedState!==null?Ze._visibility&2?Tu(P,q,ie,Se,A):Bf(P,q):(Ze._visibility|=2,Tu(P,q,ie,Se,A)),A&&ke&2048&&fg(q.alternate,q);break;case 24:Tu(P,q,ie,Se,A),A&&ke&2048&&Vs(q.alternate,q);break;default:Tu(P,q,ie,Se,A)}u=u.sibling}}function Bf(c,u){if(u.subtreeFlags&10256)for(u=u.child;u!==null;){var _=c,S=u,A=S.flags;switch(S.tag){case 22:Bf(_,S),A&2048&&fg(S.alternate,S);break;case 24:Bf(_,S),A&2048&&Vs(S.alternate,S);break;default:Bf(_,S)}u=u.sibling}}var Bh=8192;function Ru(c){if(c.subtreeFlags&Bh)for(c=c.child;c!==null;)$b(c),c=c.sibling}function $b(c){switch(c.tag){case 26:Ru(c),c.flags&Bh&&c.memoizedState!==null&&QN(Ao,c.memoizedState,c.memoizedProps);break;case 5:Ru(c);break;case 3:case 4:var u=Ao;Ao=kg(c.stateNode.containerInfo),Ru(c),Ao=u;break;case 22:c.memoizedState===null&&(u=c.alternate,u!==null&&u.memoizedState!==null?(u=Bh,Bh=16777216,Ru(c),Bh=u):Ru(c));break;default:Ru(c)}}function Uv(c){var u=c.alternate;if(u!==null&&(c=u.child,c!==null)){u.child=null;do u=c.sibling,c.sibling=null,c=u;while(c!==null)}}function Gf(c){var u=c.deletions;if((c.flags&16)!==0){if(u!==null)for(var _=0;_<u.length;_++){var S=u[_];ss=S,_g(S,c)}Uv(c)}if(c.subtreeFlags&10256)for(c=c.child;c!==null;)Zb(c),c=c.sibling}function Zb(c){switch(c.tag){case 0:case 11:case 15:Gf(c),c.flags&2048&&rd(9,c,c.return);break;case 3:Gf(c);break;case 12:Gf(c);break;case 22:var u=c.stateNode;c.memoizedState!==null&&u._visibility&2&&(c.return===null||c.return.tag!==13)?(u._visibility&=-3,mg(c)):Gf(c);break;default:Gf(c)}}function mg(c){var u=c.deletions;if((c.flags&16)!==0){if(u!==null)for(var _=0;_<u.length;_++){var S=u[_];ss=S,_g(S,c)}Uv(c)}for(c=c.child;c!==null;){switch(u=c,u.tag){case 0:case 11:case 15:rd(8,u,u.return),mg(u);break;case 22:_=u.stateNode,_._visibility&2&&(_._visibility&=-3,mg(u));break;default:mg(u)}c=c.sibling}}function _g(c,u){for(;ss!==null;){var _=ss;switch(_.tag){case 0:case 11:case 15:rd(8,_,u);break;case 23:case 22:if(_.memoizedState!==null&&_.memoizedState.cachePool!==null){var S=_.memoizedState.cachePool.pool;S!=null&&S.refCount++}break;case 24:ff(_.memoizedState.cache)}if(S=_.child,S!==null)S.return=_,ss=S;else e:for(_=c;ss!==null;){S=ss;var A=S.sibling,P=S.return;if(Fh(S),S===_){ss=null;break e}if(A!==null){A.return=P,ss=A;break e}ss=P}}}var jv={getCacheForType:function(c){var u=Br(Ir),_=u.data.get(c);return _===void 0&&(_=c(),u.data.set(c,_)),_}},CN=typeof WeakMap=="function"?WeakMap:Map,fi=0,Bi=null,Vn=null,ei=0,mi=0,fs=null,ol=!1,sd=!1,Hf=!1,mc=0,nr=0,Io=0,ad=0,Vv=0,Xa=0,bu=0,Gh=null,zr=null,zf=!1,Wf=0,Hh=1/0,qf=null,cl=null,ms=0,od=null,No=null,zh=0,gg=0,Kf=null,eC=null,Yf=0,Fv=null;function Da(){if((fi&2)!==0&&ei!==0)return ei&-ei;if(we.T!==null){var c=bh;return c!==0?c:Xh()}return Ml()}function Eg(){Xa===0&&(Xa=(ei&536870912)===0||pi?Vc():536870912);var c=Gr.current;return c!==null&&(c.flags|=32),Xa}function aa(c,u,_){(c===Bi&&(mi===2||mi===9)||c.cancelPendingCommit!==null)&&(wu(c,0),_c(c,ei,Xa,!1)),Fc(c,_),((fi&2)===0||c!==Bi)&&(c===Bi&&((fi&2)===0&&(ad|=_),nr===4&&_c(c,ei,Xa,!1)),Ja(c))}function Bv(c,u,_){if((fi&6)!==0)throw Error(d(327));var S=!_&&(u&124)===0&&(u&c.expiredLanes)===0||Xo(c,u),A=S?AN(c,u):Hv(c,u,!0),P=S;do{if(A===0){sd&&!S&&_c(c,u,0,!1);break}else{if(_=c.current.alternate,P&&!yg(_)){A=Hv(c,u,!1),P=!1;continue}if(A===2){if(P=u,c.errorRecoveryDisabledLanes&P)var q=0;else q=c.pendingLanes&-536870913,q=q!==0?q:q&536870912?536870912:0;if(q!==0){u=q;e:{var ie=c;A=Gh;var Se=ie.current.memoizedState.isDehydrated;if(Se&&(wu(ie,q).flags|=256),q=Hv(ie,q,!1),q!==2){if(Hf&&!Se){ie.errorRecoveryDisabledLanes|=P,ad|=P,A=4;break e}P=zr,zr=A,P!==null&&(zr===null?zr=P:zr.push.apply(zr,P))}A=q}if(P=!1,A!==2)continue}}if(A===1){wu(c,0),_c(c,u,0,!0);break}e:{switch(S=c,P=A,P){case 0:case 1:throw Error(d(345));case 4:if((u&4194048)!==u)break;case 6:_c(S,u,Xa,!ol);break e;case 2:zr=null;break;case 3:case 5:break;default:throw Error(d(329))}if((u&62914560)===u&&(A=Wf+300-rn(),10<A)){if(_c(S,u,Xa,!ol),Yo(S,0,!0)!==0)break e;S.timeoutHandle=lC(Gv.bind(null,S,_,zr,qf,zf,u,Xa,ad,bu,ol,P,2,-0,0),A);break e}Gv(S,_,zr,qf,zf,u,Xa,ad,bu,ol,P,0,-0,0)}}break}while(!0);Ja(c)}function Gv(c,u,_,S,A,P,q,ie,Se,ke,Ze,dt,Ge,He){if(c.timeoutHandle=-1,dt=u.subtreeFlags,(dt&8192||(dt&16785408)===16785408)&&(tm={stylesheets:null,count:0,unsuspend:JN},$b(u),dt=SC(),dt!==null)){c.cancelPendingCommit=dt(nC.bind(null,c,u,P,_,S,A,q,ie,Se,Ze,1,Ge,He)),_c(c,P,q,!ke);return}nC(c,u,P,_,S,A,q,ie,Se)}function yg(c){for(var u=c;;){var _=u.tag;if((_===0||_===11||_===15)&&u.flags&16384&&(_=u.updateQueue,_!==null&&(_=_.stores,_!==null)))for(var S=0;S<_.length;S++){var A=_[S],P=A.getSnapshot;A=A.value;try{if(!Ca(P(),A))return!1}catch{return!1}}if(_=u.child,u.subtreeFlags&16384&&_!==null)_.return=u,u=_;else{if(u===c)break;for(;u.sibling===null;){if(u.return===null||u.return===c)return!0;u=u.return}u.sibling.return=u.return,u=u.sibling}}return!0}function _c(c,u,_,S){u&=~Vv,u&=~ad,c.suspendedLanes|=u,c.pingedLanes&=~u,S&&(c.warmLanes|=u),S=c.expirationTimes;for(var A=u;0<A;){var P=31-gn(A),q=1<<P;S[P]=-1,A&=~q}_!==0&&$s(c,_,u)}function Cu(){return(fi&6)===0?(Xf(0),!1):!0}function Wh(){if(Vn!==null){if(mi===0)var c=Vn.return;else c=Vn,il=lu=null,ov(c),Eu=null,bo=0,c=Vn;for(;c!==null;)Hb(c.alternate,c),c=c.return;Vn=null}}function wu(c,u){var _=c.timeoutHandle;_!==-1&&(c.timeoutHandle=-1,MN(_)),_=c.cancelPendingCommit,_!==null&&(c.cancelPendingCommit=null,_()),Wh(),Bi=c,Vn=_=tl(c.current,null),ei=u,mi=0,fs=null,ol=!1,sd=Xo(c,u),Hf=!1,bu=Xa=Vv=ad=Io=nr=0,zr=Gh=null,zf=!1,(u&8)!==0&&(u|=u&32);var S=c.entangledLanes;if(S!==0)for(c=c.entanglements,S&=u;0<S;){var A=31-gn(S),P=1<<A;u|=c[A],S&=~P}return mc=u,iu(),_}function Au(c,u){In=null,we.H=Na,u===uu||u===B_?(u=ib(),mi=3):u===eb?(u=ib(),mi=4):mi=u===xb?8:u!==null&&typeof u=="object"&&typeof u.then=="function"?6:1,fs=u,Vn===null&&(nr=1,rg(c,wa(u,c.current)))}function cd(){var c=we.H;return we.H=Na,c===null?Na:c}function tC(){var c=we.A;return we.A=jv,c}function Iu(){nr=4,ol||(ei&4194048)!==ei&&Gr.current!==null||(sd=!0),(Io&134217727)===0&&(ad&134217727)===0||Bi===null||_c(Bi,ei,Xa,!1)}function Hv(c,u,_){var S=fi;fi|=2;var A=cd(),P=tC();(Bi!==c||ei!==u)&&(qf=null,wu(c,u)),u=!1;var q=nr;e:do try{if(mi!==0&&Vn!==null){var ie=Vn,Se=fs;switch(mi){case 8:Wh(),q=6;break e;case 3:case 2:case 9:case 6:Gr.current===null&&(u=!0);var ke=mi;if(mi=0,fs=null,Nu(c,ie,Se,ke),_&&sd){q=0;break e}break;default:ke=mi,mi=0,fs=null,Nu(c,ie,Se,ke)}}wN(),q=nr;break}catch(Ze){Au(c,Ze)}while(!0);return u&&c.shellSuspendCounter++,il=lu=null,fi=S,we.H=A,we.A=P,Vn===null&&(Bi=null,ei=0,iu()),q}function wN(){for(;Vn!==null;)zv(Vn)}function AN(c,u){var _=fi;fi|=2;var S=cd(),A=tC();Bi!==c||ei!==u?(qf=null,Hh=rn()+500,wu(c,u)):sd=Xo(c,u);e:do try{if(mi!==0&&Vn!==null){u=Vn;var P=fs;t:switch(mi){case 1:mi=0,fs=null,Nu(c,u,P,1);break;case 2:case 9:if(tb(P)){mi=0,fs=null,vg(u);break}u=function(){mi!==2&&mi!==9||Bi!==c||(mi=7),Ja(c)},P.then(u,u);break e;case 3:mi=7;break e;case 4:mi=5;break e;case 7:tb(P)?(mi=0,fs=null,vg(u)):(mi=0,fs=null,Nu(c,u,P,7));break;case 5:var q=null;switch(Vn.tag){case 26:q=Vn.memoizedState;case 5:case 27:var ie=Vn;if(!q||vC(q)){mi=0,fs=null;var Se=ie.sibling;if(Se!==null)Vn=Se;else{var ke=ie.return;ke!==null?(Vn=ke,Sg(ke)):Vn=null}break t}}mi=0,fs=null,Nu(c,u,P,5);break;case 6:mi=0,fs=null,Nu(c,u,P,6);break;case 8:Wh(),nr=6;break e;default:throw Error(d(462))}}IN();break}catch(Ze){Au(c,Ze)}while(!0);return il=lu=null,we.H=S,we.A=A,fi=_,Vn!==null?0:(Bi=null,ei=0,iu(),nr)}function IN(){for(;Vn!==null&&!gt();)zv(Vn)}function zv(c){var u=xf(c.alternate,c,mc);c.memoizedProps=c.pendingProps,u===null?Sg(c):Vn=u}function vg(c){var u=c,_=u.alternate;switch(u.tag){case 15:case 0:u=Iv(_,u,u.pendingProps,u.type,void 0,ei);break;case 11:u=Iv(_,u,u.pendingProps,u.type.render,u.ref,ei);break;case 5:ov(u);default:Hb(_,u),u=Vn=L_(u,mc),u=xf(_,u,mc)}c.memoizedProps=c.pendingProps,u===null?Sg(c):Vn=u}function Nu(c,u,_,S){il=lu=null,ov(u),Eu=null,bo=0;var A=u.return;try{if(vN(c,A,u,_,ei)){nr=1,rg(c,wa(_,c.current)),Vn=null;return}}catch(P){if(A!==null)throw Vn=A,P;nr=1,rg(c,wa(_,c.current)),Vn=null;return}u.flags&32768?(pi||S===1?c=!0:sd||(ei&536870912)!==0?c=!1:(ol=c=!0,(S===2||S===9||S===3||S===6)&&(S=Gr.current,S!==null&&S.tag===13&&(S.flags|=16384))),Wv(u,c)):Sg(u)}function Sg(c){var u=c;do{if((u.flags&32768)!==0){Wv(u,ol);return}c=u.return;var _=TN(u.alternate,u,mc);if(_!==null){Vn=_;return}if(u=u.sibling,u!==null){Vn=u;return}Vn=u=c}while(u!==null);nr===0&&(nr=5)}function Wv(c,u){do{var _=RN(c.alternate,c);if(_!==null){_.flags&=32767,Vn=_;return}if(_=c.return,_!==null&&(_.flags|=32768,_.subtreeFlags=0,_.deletions=null),!u&&(c=c.sibling,c!==null)){Vn=c;return}Vn=c=_}while(c!==null);nr=6,Vn=null}function nC(c,u,_,S,A,P,q,ie,Se){c.cancelPendingCommit=null;do Tg();while(ms!==0);if((fi&6)!==0)throw Error(d(327));if(u!==null){if(u===c.current)throw Error(d(177));if(P=u.lanes|u.childLanes,P|=Gy,Kp(c,_,P,q,ie,Se),c===Bi&&(Vn=Bi=null,ei=0),No=u,od=c,zh=_,gg=P,Kf=A,eC=S,(u.subtreeFlags&10256)!==0||(u.flags&10256)!==0?(c.callbackNode=null,c.callbackPriority=0,DN(_r,function(){return Rg(),null})):(c.callbackNode=null,c.callbackPriority=0),S=(u.flags&13878)!==0,(u.subtreeFlags&13878)!==0||S){S=we.T,we.T=null,A=je.p,je.p=2,q=fi,fi|=4;try{Vf(c,u,_)}finally{fi=q,je.p=A,we.T=S}}ms=1,qh(),Oo(),qv()}}function qh(){if(ms===1){ms=0;var c=od,u=No,_=(u.flags&13878)!==0;if((u.subtreeFlags&13878)!==0||_){_=we.T,we.T=null;var S=je.p;je.p=2;var A=fi;fi|=4;try{Jb(u,c);var P=ep,q=Zc(c.containerInfo),ie=P.focusedElem,Se=P.selectionRange;if(q!==ie&&ie&&ie.ownerDocument&&BR(ie.ownerDocument.documentElement,ie)){if(Se!==null&&xy(ie)){var ke=Se.start,Ze=Se.end;if(Ze===void 0&&(Ze=ke),"selectionStart"in ie)ie.selectionStart=ke,ie.selectionEnd=Math.min(Ze,ie.value.length);else{var dt=ie.ownerDocument||document,Ge=dt&&dt.defaultView||window;if(Ge.getSelection){var He=Ge.getSelection(),hn=ie.textContent.length,Xt=Math.min(Se.start,hn),Oi=Se.end===void 0?Xt:Math.min(Se.end,hn);!He.extend&&Xt>Oi&&(q=Oi,Oi=Xt,Xt=q);var De=FR(ie,Xt),be=FR(ie,Oi);if(De&&be&&(He.rangeCount!==1||He.anchorNode!==De.node||He.anchorOffset!==De.offset||He.focusNode!==be.node||He.focusOffset!==be.offset)){var xe=dt.createRange();xe.setStart(De.node,De.offset),He.removeAllRanges(),Xt>Oi?(He.addRange(xe),He.extend(be.node,be.offset)):(xe.setEnd(be.node,be.offset),He.addRange(xe))}}}}for(dt=[],He=ie;He=He.parentNode;)He.nodeType===1&&dt.push({element:He,left:He.scrollLeft,top:He.scrollTop});for(typeof ie.focus=="function"&&ie.focus(),ie=0;ie<dt.length;ie++){var ot=dt[ie];ot.element.scrollLeft=ot.left,ot.element.scrollTop=ot.top}}Fg=!!cS,ep=cS=null}finally{fi=A,je.p=S,we.T=_}}c.current=u,ms=2}}function Oo(){if(ms===2){ms=0;var c=od,u=No,_=(u.flags&8772)!==0;if((u.subtreeFlags&8772)!==0||_){_=we.T,we.T=null;var S=je.p;je.p=2;var A=fi;fi|=4;try{xv(c,u.alternate,u)}finally{fi=A,je.p=S,we.T=_}}ms=3}}function qv(){if(ms===4||ms===3){ms=0,Zt();var c=od,u=No,_=zh,S=eC;(u.subtreeFlags&10256)!==0||(u.flags&10256)!==0?ms=5:(ms=0,No=od=null,iC(c,c.pendingLanes));var A=c.pendingLanes;if(A===0&&(cl=null),ch(_),u=u.stateNode,Me&&typeof Me.onCommitFiberRoot=="function")try{Me.onCommitFiberRoot(Gt,u,void 0,(u.current.flags&128)===128)}catch{}if(S!==null){u=we.T,A=je.p,je.p=2,we.T=null;try{for(var P=c.onRecoverableError,q=0;q<S.length;q++){var ie=S[q];P(ie.value,{componentStack:ie.stack})}}finally{we.T=u,je.p=A}}(zh&3)!==0&&Tg(),Ja(c),A=c.pendingLanes,(_&4194090)!==0&&(A&42)!==0?c===Fv?Yf++:(Yf=0,Fv=c):Yf=0,Xf(0)}}function iC(c,u){(c.pooledCacheLanes&=u)===0&&(u=c.pooledCache,u!=null&&(c.pooledCache=null,ff(u)))}function Tg(c){return qh(),Oo(),qv(),Rg()}function Rg(){if(ms!==5)return!1;var c=od,u=gg;gg=0;var _=ch(zh),S=we.T,A=je.p;try{je.p=32>_?32:_,we.T=null,_=Kf,Kf=null;var P=od,q=zh;if(ms=0,No=od=null,zh=0,(fi&6)!==0)throw Error(d(331));var ie=fi;if(fi|=4,Zb(P.current),Qb(P,P.current,q,_),fi=ie,Xf(0,!1),Me&&typeof Me.onPostCommitFiberRoot=="function")try{Me.onPostCommitFiberRoot(Gt,P)}catch{}return!0}finally{je.p=A,we.T=S,iC(c,u)}}function Kv(c,u,_){u=wa(_,u),u=Co(c.stateNode,u,2),c=sl(c,u,2),c!==null&&(Fc(c,2),Ja(c))}function xi(c,u,_){if(c.tag===3)Kv(c,c,_);else for(;u!==null;){if(u.tag===3){Kv(u,c,_);break}else if(u.tag===1){var S=u.stateNode;if(typeof u.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(cl===null||!cl.has(S))){c=wa(_,c),_=Lb(2),S=sl(u,_,2),S!==null&&(kb(_,S,u,c),Fc(S,2),Ja(S));break}}u=u.return}}function Kh(c,u,_){var S=c.pingCache;if(S===null){S=c.pingCache=new CN;var A=new Set;S.set(u,A)}else A=S.get(u),A===void 0&&(A=new Set,S.set(u,A));A.has(_)||(Hf=!0,A.add(_),c=ld.bind(null,c,u,_),u.then(c,c))}function ld(c,u,_){var S=c.pingCache;S!==null&&S.delete(u),c.pingedLanes|=c.suspendedLanes&_,c.warmLanes&=~_,Bi===c&&(ei&_)===_&&(nr===4||nr===3&&(ei&62914560)===ei&&300>rn()-Wf?(fi&2)===0&&wu(c,0):Vv|=_,bu===ei&&(bu=0)),Ja(c)}function Yh(c,u){u===0&&(u=xl()),c=vh(c,u),c!==null&&(Fc(c,u),Ja(c))}function NN(c){var u=c.memoizedState,_=0;u!==null&&(_=u.retryLane),Yh(c,_)}function ON(c,u){var _=0;switch(c.tag){case 13:var S=c.stateNode,A=c.memoizedState;A!==null&&(_=A.retryLane);break;case 19:S=c.stateNode;break;case 22:S=c.stateNode._retryCache;break;default:throw Error(d(314))}S!==null&&S.delete(u),Yh(c,_)}function DN(c,u){return yt(c,u)}var bg=null,dd=null,Yv=!1,Cg=!1,Xv=!1,ud=0;function Ja(c){c!==dd&&c.next===null&&(dd===null?bg=dd=c:dd=dd.next=c),Cg=!0,Yv||(Yv=!0,sC())}function Xf(c,u){if(!Xv&&Cg){Xv=!0;do for(var _=!1,S=bg;S!==null;){if(c!==0){var A=S.pendingLanes;if(A===0)var P=0;else{var q=S.suspendedLanes,ie=S.pingedLanes;P=(1<<31-gn(42|c)+1)-1,P&=A&~(q&~ie),P=P&201326741?P&201326741|1:P?P|2:0}P!==0&&(_=!0,Qv(S,P))}else P=ei,P=Yo(S,S===Bi?P:0,S.cancelPendingCommit!==null||S.timeoutHandle!==-1),(P&3)===0||Xo(S,P)||(_=!0,Qv(S,P));S=S.next}while(_);Xv=!1}}function PN(){rC()}function rC(){Cg=Yv=!1;var c=0;ud!==0&&(xN()&&(c=ud),ud=0);for(var u=rn(),_=null,S=bg;S!==null;){var A=S.next,P=Jv(S,u);P===0?(S.next=null,_===null?bg=A:_.next=A,A===null&&(dd=_)):(_=S,(c!==0||(P&3)!==0)&&(Cg=!0)),S=A}Xf(c)}function Jv(c,u){for(var _=c.suspendedLanes,S=c.pingedLanes,A=c.expirationTimes,P=c.pendingLanes&-62914561;0<P;){var q=31-gn(P),ie=1<<q,Se=A[q];Se===-1?((ie&_)===0||(ie&S)!==0)&&(A[q]=ya(ie,u)):Se<=u&&(c.expiredLanes|=ie),P&=~ie}if(u=Bi,_=ei,_=Yo(c,c===u?_:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),S=c.callbackNode,_===0||c===u&&(mi===2||mi===9)||c.cancelPendingCommit!==null)return S!==null&&S!==null&&Vt(S),c.callbackNode=null,c.callbackPriority=0;if((_&3)===0||Xo(c,_)){if(u=_&-_,u===c.callbackPriority)return u;switch(S!==null&&Vt(S),ch(_)){case 2:case 8:_=Zr;break;case 32:_=_r;break;case 268435456:_=Qs;break;default:_=_r}return S=wg.bind(null,c),_=yt(_,S),c.callbackPriority=u,c.callbackNode=_,u}return S!==null&&S!==null&&Vt(S),c.callbackPriority=2,c.callbackNode=null,2}function wg(c,u){if(ms!==0&&ms!==5)return c.callbackNode=null,c.callbackPriority=0,null;var _=c.callbackNode;if(Tg()&&c.callbackNode!==_)return null;var S=ei;return S=Yo(c,c===Bi?S:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),S===0?null:(Bv(c,S,u),Jv(c,rn()),c.callbackNode!=null&&c.callbackNode===_?wg.bind(null,c):null)}function Qv(c,u){if(Tg())return null;Bv(c,u,!0)}function sC(){UN(function(){(fi&6)!==0?yt(ui,PN):rC()})}function Xh(){return ud===0&&(ud=Vc()),ud}function $v(c){return c==null||typeof c=="symbol"||typeof c=="boolean"?null:typeof c=="function"?c:fh(""+c)}function aC(c,u){var _=u.ownerDocument.createElement("input");return _.name=u.name,_.value=u.value,c.id&&_.setAttribute("form",c.id),u.parentNode.insertBefore(_,u),c=new FormData(c),_.parentNode.removeChild(_),c}function Zv(c,u,_,S,A){if(u==="submit"&&_&&_.stateNode===A){var P=$v((A[Ar]||null).action),q=S.submitter;q&&(u=(u=q[Ar]||null)?$v(u.formAction):q.getAttribute("formAction"),u!==null&&(P=u,q=null));var ie=new Ra("action","action",null,S,A);c.push({event:ie,listeners:[{instance:null,listener:function(){if(S.defaultPrevented){if(ud!==0){var Se=q?aC(A,q):new FormData(A);Lh(_,{pending:!0,data:Se,method:A.method,action:P},null,Se)}}else typeof P=="function"&&(ie.preventDefault(),Se=q?aC(A,q):new FormData(A),Lh(_,{pending:!0,data:Se,method:A.method,action:P},P,Se))},currentTarget:A}]})}}for(var eS=0;eS<Fy.length;eS++){var tS=Fy[eS],Jf=tS.toLowerCase(),nS=tS[0].toUpperCase()+tS.slice(1);So(Jf,"on"+nS)}So(zR,"onAnimationEnd"),So(WR,"onAnimationIteration"),So(P_,"onAnimationStart"),So("dblclick","onDoubleClick"),So("focusin","onFocus"),So("focusout","onBlur"),So(Vy,"onTransitionRun"),So(dN,"onTransitionStart"),So(Ye,"onTransitionCancel"),So(qR,"onTransitionEnd"),zc("onMouseEnter",["mouseout","mouseover"]),zc("onMouseLeave",["mouseout","mouseover"]),zc("onPointerEnter",["pointerout","pointerover"]),zc("onPointerLeave",["pointerout","pointerover"]),bs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),bs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),bs("onBeforeInput",["compositionend","keypress","textInput","paste"]),bs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),bs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),bs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Jh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),iS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Jh));function Ag(c,u){u=(u&4)!==0;for(var _=0;_<c.length;_++){var S=c[_],A=S.event;S=S.listeners;e:{var P=void 0;if(u)for(var q=S.length-1;0<=q;q--){var ie=S[q],Se=ie.instance,ke=ie.currentTarget;if(ie=ie.listener,Se!==P&&A.isPropagationStopped())break e;P=ie,A.currentTarget=ke;try{P(A)}catch(Ze){ig(Ze)}A.currentTarget=null,P=Se}else for(q=0;q<S.length;q++){if(ie=S[q],Se=ie.instance,ke=ie.currentTarget,ie=ie.listener,Se!==P&&A.isPropagationStopped())break e;P=ie,A.currentTarget=ke;try{P(A)}catch(Ze){ig(Ze)}A.currentTarget=null,P=Se}}}}function xn(c,u){var _=u[lh];_===void 0&&(_=u[lh]=new Set);var S=c+"__bubble";_.has(S)||(sS(u,c,2,!1),_.add(S))}function rS(c,u,_){var S=0;u&&(S|=4),sS(_,c,S,u)}var Ig="_reactListening"+Math.random().toString(36).slice(2);function Ng(c){if(!c[Ig]){c[Ig]=!0,Hd.forEach(function(_){_!=="selectionchange"&&(iS.has(_)||rS(_,!1,c),rS(_,!0,c))});var u=c.nodeType===9?c:c.ownerDocument;u===null||u[Ig]||(u[Ig]=!0,rS("selectionchange",!1,u))}}function sS(c,u,_,S){switch(wC(u)){case 2:var A=ZN;break;case 8:A=eO;break;default:A=Bg}_=A.bind(null,u,_,c),A=void 0,!Ha||u!=="touchstart"&&u!=="touchmove"&&u!=="wheel"||(A=!0),S?A!==void 0?c.addEventListener(u,_,{capture:!0,passive:A}):c.addEventListener(u,_,!0):A!==void 0?c.addEventListener(u,_,{passive:A}):c.addEventListener(u,_,!1)}function Og(c,u,_,S,A){var P=S;if((u&1)===0&&(u&2)===0&&S!==null)e:for(;;){if(S===null)return;var q=S.tag;if(q===3||q===4){var ie=S.stateNode.containerInfo;if(ie===A)break;if(q===4)for(q=S.return;q!==null;){var Se=q.tag;if((Se===3||Se===4)&&q.stateNode.containerInfo===A)return;q=q.return}for(;ie!==null;){if(q=Hc(ie),q===null)return;if(Se=q.tag,Se===5||Se===6||Se===26||Se===27){S=P=q;continue e}ie=ie.parentNode}}S=S.return}S_(function(){var ke=P,Ze=Ga(_),dt=[];e:{var Ge=KR.get(c);if(Ge!==void 0){var He=Ra,hn=c;switch(c){case"keypress":if(tc(_)===0)break e;case"keydown":case"keyup":He=gh;break;case"focusin":hn="focus",He=Zd;break;case"focusout":hn="blur",He=Zd;break;case"beforeblur":case"afterblur":He=Zd;break;case"click":if(_.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":He=za;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":He=Oy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":He=A_;break;case zR:case WR:case P_:He=Gl;break;case qR:He=af;break;case"scroll":case"scrollend":He=tf;break;case"wheel":He=dn;break;case"copy":case"cut":case"paste":He=Hl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":He=sf;break;case"toggle":case"beforetoggle":He=N_}var Xt=(u&4)!==0,Oi=!Xt&&(c==="scroll"||c==="scrollend"),De=Xt?Ge!==null?Ge+"Capture":null:Ge;Xt=[];for(var be=ke,xe;be!==null;){var ot=be;if(xe=ot.stateNode,ot=ot.tag,ot!==5&&ot!==26&&ot!==27||xe===null||De===null||(ot=Fl(be,De),ot!=null&&Xt.push(Qh(be,ot,xe))),Oi)break;be=be.return}0<Xt.length&&(Ge=new He(Ge,hn,null,_,Ze),dt.push({event:Ge,listeners:Xt}))}}if((u&7)===0){e:{if(Ge=c==="mouseover"||c==="pointerover",He=c==="mouseout"||c==="pointerout",Ge&&_!==qc&&(hn=_.relatedTarget||_.fromElement)&&(Hc(hn)||hn[ks]))break e;if((He||Ge)&&(Ge=Ze.window===Ze?Ze:(Ge=Ze.ownerDocument)?Ge.defaultView||Ge.parentWindow:window,He?(hn=_.relatedTarget||_.toElement,He=ke,hn=hn?Hc(hn):null,hn!==null&&(Oi=y(hn),Xt=hn.tag,hn!==Oi||Xt!==5&&Xt!==27&&Xt!==6)&&(hn=null)):(He=null,hn=ke),He!==hn)){if(Xt=za,ot="onMouseLeave",De="onMouseEnter",be="mouse",(c==="pointerout"||c==="pointerover")&&(Xt=sf,ot="onPointerLeave",De="onPointerEnter",be="pointer"),Oi=He==null?Ge:Qo(He),xe=hn==null?Ge:Qo(hn),Ge=new Xt(ot,be+"leave",He,_,Ze),Ge.target=Oi,Ge.relatedTarget=xe,ot=null,Hc(Ze)===ke&&(Xt=new Xt(De,be+"enter",hn,_,Ze),Xt.target=xe,Xt.relatedTarget=Oi,ot=Xt),Oi=ot,He&&hn)t:{for(Xt=He,De=hn,be=0,xe=Xt;xe;xe=$h(xe))be++;for(xe=0,ot=De;ot;ot=$h(ot))xe++;for(;0<be-xe;)Xt=$h(Xt),be--;for(;0<xe-be;)De=$h(De),xe--;for(;be--;){if(Xt===De||De!==null&&Xt===De.alternate)break t;Xt=$h(Xt),De=$h(De)}Xt=null}else Xt=null;He!==null&&aS(dt,Ge,He,Xt,!1),hn!==null&&Oi!==null&&aS(dt,Oi,hn,Xt,!0)}}e:{if(Ge=ke?Qo(ke):window,He=Ge.nodeName&&Ge.nodeName.toLowerCase(),He==="select"||He==="input"&&Ge.type==="file")var Pt=xR;else if(Vr(Ge))if(ba)Pt=ky;else{Pt=oN;var Fn=aN}else He=Ge.nodeName,!He||He.toLowerCase()!=="input"||Ge.type!=="checkbox"&&Ge.type!=="radio"?ke&&Qd(ke.elementType)&&(Pt=xR):Pt=jR;if(Pt&&(Pt=Pt(c,ke))){$c(dt,Pt,_,Ze);break e}Fn&&Fn(c,Ge,ke),c==="focusout"&&ke&&Ge.type==="number"&&ke.memoizedProps.value!=null&&jl(Ge,"number",Ge.value)}switch(Fn=ke?Qo(ke):window,c){case"focusin":(Vr(Fn)||Fn.contentEditable==="true")&&(Fr=Fn,My=ke,cf=null);break;case"focusout":cf=My=Fr=null;break;case"mousedown":Uy=!0;break;case"contextmenu":case"mouseup":case"dragend":Uy=!1,GR(dt,_,Ze);break;case"selectionchange":if(lN)break;case"keydown":case"keyup":GR(dt,_,Ze)}var Ht;if(sc)e:{switch(c){case"compositionstart":var sn="onCompositionStart";break e;case"compositionend":sn="onCompositionEnd";break e;case"compositionupdate":sn="onCompositionUpdate";break e}sn=void 0}else $n?Ke(c,_)&&(sn="onCompositionEnd"):c==="keydown"&&_.keyCode===229&&(sn="onCompositionStart");sn&&(z&&_.locale!=="ko"&&($n||sn!=="onCompositionStart"?sn==="onCompositionEnd"&&$n&&(Ht=Zp()):(ea=Ze,Bl="value"in ea?ea.value:ea.textContent,$n=!0)),Fn=Qf(ke,sn),0<Fn.length&&(sn=new eu(sn,c,null,_,Ze),dt.push({event:sn,listeners:Fn}),Ht?sn.data=Ht:(Ht=Tt(_),Ht!==null&&(sn.data=Ht)))),(Ht=j?jr(c,_):Cn(c,_))&&(sn=Qf(ke,"onBeforeInput"),0<sn.length&&(Fn=new eu("onBeforeInput","beforeinput",null,_,Ze),dt.push({event:Fn,listeners:sn}),Fn.data=Ht)),Zv(dt,c,ke,_,Ze)}Ag(dt,u)})}function Qh(c,u,_){return{instance:c,listener:u,currentTarget:_}}function Qf(c,u){for(var _=u+"Capture",S=[];c!==null;){var A=c,P=A.stateNode;if(A=A.tag,A!==5&&A!==26&&A!==27||P===null||(A=Fl(c,_),A!=null&&S.unshift(Qh(c,A,P)),A=Fl(c,u),A!=null&&S.push(Qh(c,A,P))),c.tag===3)return S;c=c.return}return[]}function $h(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5&&c.tag!==27);return c||null}function aS(c,u,_,S,A){for(var P=u._reactName,q=[];_!==null&&_!==S;){var ie=_,Se=ie.alternate,ke=ie.stateNode;if(ie=ie.tag,Se!==null&&Se===S)break;ie!==5&&ie!==26&&ie!==27||ke===null||(Se=ke,A?(ke=Fl(_,P),ke!=null&&q.unshift(Qh(_,ke,Se))):A||(ke=Fl(_,P),ke!=null&&q.push(Qh(_,ke,Se)))),_=_.return}q.length!==0&&c.push({event:u,listeners:q})}var LN=/\r\n?/g,Zh=/\u0000|\uFFFD/g;function Ou(c){return(typeof c=="string"?c:""+c).replace(LN,`
`).replace(Zh,"")}function Dg(c,u){return u=Ou(u),Ou(c)===u}function $f(){}function bi(c,u,_,S,A,P){switch(_){case"children":typeof S=="string"?u==="body"||u==="textarea"&&S===""||Zs(c,S):(typeof S=="number"||typeof S=="bigint")&&u!=="body"&&Zs(c,""+S);break;case"className":$o(c,"class",S);break;case"tabIndex":$o(c,"tabindex",S);break;case"dir":case"role":case"viewBox":case"width":case"height":$o(c,_,S);break;case"style":Qp(c,S,P);break;case"data":if(u!=="object"){$o(c,"data",S);break}case"src":case"href":if(S===""&&(u!=="a"||_!=="href")){c.removeAttribute(_);break}if(S==null||typeof S=="function"||typeof S=="symbol"||typeof S=="boolean"){c.removeAttribute(_);break}S=fh(""+S),c.setAttribute(_,S);break;case"action":case"formAction":if(typeof S=="function"){c.setAttribute(_,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof P=="function"&&(_==="formAction"?(u!=="input"&&bi(c,u,"name",A.name,A,null),bi(c,u,"formEncType",A.formEncType,A,null),bi(c,u,"formMethod",A.formMethod,A,null),bi(c,u,"formTarget",A.formTarget,A,null)):(bi(c,u,"encType",A.encType,A,null),bi(c,u,"method",A.method,A,null),bi(c,u,"target",A.target,A,null)));if(S==null||typeof S=="symbol"||typeof S=="boolean"){c.removeAttribute(_);break}S=fh(""+S),c.setAttribute(_,S);break;case"onClick":S!=null&&(c.onclick=$f);break;case"onScroll":S!=null&&xn("scroll",c);break;case"onScrollEnd":S!=null&&xn("scrollend",c);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(d(61));if(_=S.__html,_!=null){if(A.children!=null)throw Error(d(60));c.innerHTML=_}}break;case"multiple":c.multiple=S&&typeof S!="function"&&typeof S!="symbol";break;case"muted":c.muted=S&&typeof S!="function"&&typeof S!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(S==null||typeof S=="function"||typeof S=="boolean"||typeof S=="symbol"){c.removeAttribute("xlink:href");break}_=fh(""+S),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",_);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":S!=null&&typeof S!="function"&&typeof S!="symbol"?c.setAttribute(_,""+S):c.removeAttribute(_);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":S&&typeof S!="function"&&typeof S!="symbol"?c.setAttribute(_,""):c.removeAttribute(_);break;case"capture":case"download":S===!0?c.setAttribute(_,""):S!==!1&&S!=null&&typeof S!="function"&&typeof S!="symbol"?c.setAttribute(_,S):c.removeAttribute(_);break;case"cols":case"rows":case"size":case"span":S!=null&&typeof S!="function"&&typeof S!="symbol"&&!isNaN(S)&&1<=S?c.setAttribute(_,S):c.removeAttribute(_);break;case"rowSpan":case"start":S==null||typeof S=="function"||typeof S=="symbol"||isNaN(S)?c.removeAttribute(_):c.setAttribute(_,S);break;case"popover":xn("beforetoggle",c),xn("toggle",c),ki(c,"popover",S);break;case"xlinkActuate":hs(c,"http://www.w3.org/1999/xlink","xlink:actuate",S);break;case"xlinkArcrole":hs(c,"http://www.w3.org/1999/xlink","xlink:arcrole",S);break;case"xlinkRole":hs(c,"http://www.w3.org/1999/xlink","xlink:role",S);break;case"xlinkShow":hs(c,"http://www.w3.org/1999/xlink","xlink:show",S);break;case"xlinkTitle":hs(c,"http://www.w3.org/1999/xlink","xlink:title",S);break;case"xlinkType":hs(c,"http://www.w3.org/1999/xlink","xlink:type",S);break;case"xmlBase":hs(c,"http://www.w3.org/XML/1998/namespace","xml:base",S);break;case"xmlLang":hs(c,"http://www.w3.org/XML/1998/namespace","xml:lang",S);break;case"xmlSpace":hs(c,"http://www.w3.org/XML/1998/namespace","xml:space",S);break;case"is":ki(c,"is",S);break;case"innerText":case"textContent":break;default:(!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(_=Ny.get(_)||_,ki(c,_,S))}}function oS(c,u,_,S,A,P){switch(_){case"style":Qp(c,S,P);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(d(61));if(_=S.__html,_!=null){if(A.children!=null)throw Error(d(60));c.innerHTML=_}}break;case"children":typeof S=="string"?Zs(c,S):(typeof S=="number"||typeof S=="bigint")&&Zs(c,""+S);break;case"onScroll":S!=null&&xn("scroll",c);break;case"onScrollEnd":S!=null&&xn("scrollend",c);break;case"onClick":S!=null&&(c.onclick=$f);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!zd.hasOwnProperty(_))e:{if(_[0]==="o"&&_[1]==="n"&&(A=_.endsWith("Capture"),u=_.slice(2,A?_.length-7:void 0),P=c[Ar]||null,P=P!=null?P[_]:null,typeof P=="function"&&c.removeEventListener(u,P,A),typeof S=="function")){typeof P!="function"&&P!==null&&(_ in c?c[_]=null:c.hasAttribute(_)&&c.removeAttribute(_)),c.addEventListener(u,S,A);break e}_ in c?c[_]=S:S===!0?c.setAttribute(_,""):ki(c,_,S)}}}function as(c,u,_){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":xn("error",c),xn("load",c);var S=!1,A=!1,P;for(P in _)if(_.hasOwnProperty(P)){var q=_[P];if(q!=null)switch(P){case"src":S=!0;break;case"srcSet":A=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(d(137,u));default:bi(c,u,P,q,_,null)}}A&&bi(c,u,"srcSet",_.srcSet,_,null),S&&bi(c,u,"src",_.src,_,null);return;case"input":xn("invalid",c);var ie=P=q=A=null,Se=null,ke=null;for(S in _)if(_.hasOwnProperty(S)){var Ze=_[S];if(Ze!=null)switch(S){case"name":A=Ze;break;case"type":q=Ze;break;case"checked":Se=Ze;break;case"defaultChecked":ke=Ze;break;case"value":P=Ze;break;case"defaultValue":ie=Ze;break;case"children":case"dangerouslySetInnerHTML":if(Ze!=null)throw Error(d(137,u));break;default:bi(c,u,S,Ze,_,null)}}Xd(c,P,ie,Se,ke,q,A,!1),hh(c);return;case"select":xn("invalid",c),S=q=P=null;for(A in _)if(_.hasOwnProperty(A)&&(ie=_[A],ie!=null))switch(A){case"value":P=ie;break;case"defaultValue":q=ie;break;case"multiple":S=ie;default:bi(c,u,A,ie,_,null)}u=P,_=q,c.multiple=!!S,u!=null?Wc(c,!!S,u,!1):_!=null&&Wc(c,!!S,_,!0);return;case"textarea":xn("invalid",c),P=A=S=null;for(q in _)if(_.hasOwnProperty(q)&&(ie=_[q],ie!=null))switch(q){case"value":S=ie;break;case"defaultValue":A=ie;break;case"children":P=ie;break;case"dangerouslySetInnerHTML":if(ie!=null)throw Error(d(91));break;default:bi(c,u,q,ie,_,null)}Jd(c,S,A,P),hh(c);return;case"option":for(Se in _)if(_.hasOwnProperty(Se)&&(S=_[Se],S!=null))switch(Se){case"selected":c.selected=S&&typeof S!="function"&&typeof S!="symbol";break;default:bi(c,u,Se,S,_,null)}return;case"dialog":xn("beforetoggle",c),xn("toggle",c),xn("cancel",c),xn("close",c);break;case"iframe":case"object":xn("load",c);break;case"video":case"audio":for(S=0;S<Jh.length;S++)xn(Jh[S],c);break;case"image":xn("error",c),xn("load",c);break;case"details":xn("toggle",c);break;case"embed":case"source":case"link":xn("error",c),xn("load",c);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ke in _)if(_.hasOwnProperty(ke)&&(S=_[ke],S!=null))switch(ke){case"children":case"dangerouslySetInnerHTML":throw Error(d(137,u));default:bi(c,u,ke,S,_,null)}return;default:if(Qd(u)){for(Ze in _)_.hasOwnProperty(Ze)&&(S=_[Ze],S!==void 0&&oS(c,u,Ze,S,_,void 0));return}}for(ie in _)_.hasOwnProperty(ie)&&(S=_[ie],S!=null&&bi(c,u,ie,S,_,null))}function kN(c,u,_,S){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var A=null,P=null,q=null,ie=null,Se=null,ke=null,Ze=null;for(He in _){var dt=_[He];if(_.hasOwnProperty(He)&&dt!=null)switch(He){case"checked":break;case"value":break;case"defaultValue":Se=dt;default:S.hasOwnProperty(He)||bi(c,u,He,null,S,dt)}}for(var Ge in S){var He=S[Ge];if(dt=_[Ge],S.hasOwnProperty(Ge)&&(He!=null||dt!=null))switch(Ge){case"type":P=He;break;case"name":A=He;break;case"checked":ke=He;break;case"defaultChecked":Ze=He;break;case"value":q=He;break;case"defaultValue":ie=He;break;case"children":case"dangerouslySetInnerHTML":if(He!=null)throw Error(d(137,u));break;default:He!==dt&&bi(c,u,Ge,He,S,dt)}}Ta(c,q,ie,Se,ke,Ze,P,A);return;case"select":He=q=ie=Ge=null;for(P in _)if(Se=_[P],_.hasOwnProperty(P)&&Se!=null)switch(P){case"value":break;case"multiple":He=Se;default:S.hasOwnProperty(P)||bi(c,u,P,null,S,Se)}for(A in S)if(P=S[A],Se=_[A],S.hasOwnProperty(A)&&(P!=null||Se!=null))switch(A){case"value":Ge=P;break;case"defaultValue":ie=P;break;case"multiple":q=P;default:P!==Se&&bi(c,u,A,P,S,Se)}u=ie,_=q,S=He,Ge!=null?Wc(c,!!_,Ge,!1):!!S!=!!_&&(u!=null?Wc(c,!!_,u,!0):Wc(c,!!_,_?[]:"",!1));return;case"textarea":He=Ge=null;for(ie in _)if(A=_[ie],_.hasOwnProperty(ie)&&A!=null&&!S.hasOwnProperty(ie))switch(ie){case"value":break;case"children":break;default:bi(c,u,ie,null,S,A)}for(q in S)if(A=S[q],P=_[q],S.hasOwnProperty(q)&&(A!=null||P!=null))switch(q){case"value":Ge=A;break;case"defaultValue":He=A;break;case"children":break;case"dangerouslySetInnerHTML":if(A!=null)throw Error(d(91));break;default:A!==P&&bi(c,u,q,A,S,P)}Ii(c,Ge,He);return;case"option":for(var hn in _)if(Ge=_[hn],_.hasOwnProperty(hn)&&Ge!=null&&!S.hasOwnProperty(hn))switch(hn){case"selected":c.selected=!1;break;default:bi(c,u,hn,null,S,Ge)}for(Se in S)if(Ge=S[Se],He=_[Se],S.hasOwnProperty(Se)&&Ge!==He&&(Ge!=null||He!=null))switch(Se){case"selected":c.selected=Ge&&typeof Ge!="function"&&typeof Ge!="symbol";break;default:bi(c,u,Se,Ge,S,He)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Xt in _)Ge=_[Xt],_.hasOwnProperty(Xt)&&Ge!=null&&!S.hasOwnProperty(Xt)&&bi(c,u,Xt,null,S,Ge);for(ke in S)if(Ge=S[ke],He=_[ke],S.hasOwnProperty(ke)&&Ge!==He&&(Ge!=null||He!=null))switch(ke){case"children":case"dangerouslySetInnerHTML":if(Ge!=null)throw Error(d(137,u));break;default:bi(c,u,ke,Ge,S,He)}return;default:if(Qd(u)){for(var Oi in _)Ge=_[Oi],_.hasOwnProperty(Oi)&&Ge!==void 0&&!S.hasOwnProperty(Oi)&&oS(c,u,Oi,void 0,S,Ge);for(Ze in S)Ge=S[Ze],He=_[Ze],!S.hasOwnProperty(Ze)||Ge===He||Ge===void 0&&He===void 0||oS(c,u,Ze,Ge,S,He);return}}for(var De in _)Ge=_[De],_.hasOwnProperty(De)&&Ge!=null&&!S.hasOwnProperty(De)&&bi(c,u,De,null,S,Ge);for(dt in S)Ge=S[dt],He=_[dt],!S.hasOwnProperty(dt)||Ge===He||Ge==null&&He==null||bi(c,u,dt,Ge,S,He)}var cS=null,ep=null;function Pg(c){return c.nodeType===9?c:c.ownerDocument}function oC(c){switch(c){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function cC(c,u){if(c===0)switch(u){case"svg":return 1;case"math":return 2;default:return 0}return c===1&&u==="foreignObject"?0:c}function lS(c,u){return c==="textarea"||c==="noscript"||typeof u.children=="string"||typeof u.children=="number"||typeof u.children=="bigint"||typeof u.dangerouslySetInnerHTML=="object"&&u.dangerouslySetInnerHTML!==null&&u.dangerouslySetInnerHTML.__html!=null}var dS=null;function xN(){var c=window.event;return c&&c.type==="popstate"?c===dS?!1:(dS=c,!0):(dS=null,!1)}var lC=typeof setTimeout=="function"?setTimeout:void 0,MN=typeof clearTimeout=="function"?clearTimeout:void 0,dC=typeof Promise=="function"?Promise:void 0,UN=typeof queueMicrotask=="function"?queueMicrotask:typeof dC<"u"?function(c){return dC.resolve(null).then(c).catch(jN)}:lC;function jN(c){setTimeout(function(){throw c})}function hd(c){return c==="head"}function uC(c,u){var _=u,S=0,A=0;do{var P=_.nextSibling;if(c.removeChild(_),P&&P.nodeType===8)if(_=P.data,_==="/$"){if(0<S&&8>S){_=S;var q=c.ownerDocument;if(_&1&&Zf(q.documentElement),_&2&&Zf(q.body),_&4)for(_=q.head,Zf(_),q=_.firstChild;q;){var ie=q.nextSibling,Se=q.nodeName;q[Ul]||Se==="SCRIPT"||Se==="STYLE"||Se==="LINK"&&q.rel.toLowerCase()==="stylesheet"||_.removeChild(q),q=ie}}if(A===0){c.removeChild(P),lm(u);return}A--}else _==="$"||_==="$?"||_==="$!"?A++:S=_.charCodeAt(0)-48;else S=0;_=P}while(_);lm(u)}function uS(c){var u=c.firstChild;for(u&&u.nodeType===10&&(u=u.nextSibling);u;){var _=u;switch(u=u.nextSibling,_.nodeName){case"HTML":case"HEAD":case"BODY":uS(_),Gc(_);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(_.rel.toLowerCase()==="stylesheet")continue}c.removeChild(_)}}function VN(c,u,_,S){for(;c.nodeType===1;){var A=_;if(c.nodeName.toLowerCase()!==u.toLowerCase()){if(!S&&(c.nodeName!=="INPUT"||c.type!=="hidden"))break}else if(S){if(!c[Ul])switch(u){case"meta":if(!c.hasAttribute("itemprop"))break;return c;case"link":if(P=c.getAttribute("rel"),P==="stylesheet"&&c.hasAttribute("data-precedence"))break;if(P!==A.rel||c.getAttribute("href")!==(A.href==null||A.href===""?null:A.href)||c.getAttribute("crossorigin")!==(A.crossOrigin==null?null:A.crossOrigin)||c.getAttribute("title")!==(A.title==null?null:A.title))break;return c;case"style":if(c.hasAttribute("data-precedence"))break;return c;case"script":if(P=c.getAttribute("src"),(P!==(A.src==null?null:A.src)||c.getAttribute("type")!==(A.type==null?null:A.type)||c.getAttribute("crossorigin")!==(A.crossOrigin==null?null:A.crossOrigin))&&P&&c.hasAttribute("async")&&!c.hasAttribute("itemprop"))break;return c;default:return c}}else if(u==="input"&&c.type==="hidden"){var P=A.name==null?null:""+A.name;if(A.type==="hidden"&&c.getAttribute("name")===P)return c}else return c;if(c=Do(c.nextSibling),c===null)break}return null}function FN(c,u,_){if(u==="")return null;for(;c.nodeType!==3;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!_||(c=Do(c.nextSibling),c===null))return null;return c}function Lg(c){return c.data==="$!"||c.data==="$?"&&c.ownerDocument.readyState==="complete"}function BN(c,u){var _=c.ownerDocument;if(c.data!=="$?"||_.readyState==="complete")u();else{var S=function(){u(),_.removeEventListener("DOMContentLoaded",S)};_.addEventListener("DOMContentLoaded",S),c._reactRetry=S}}function Do(c){for(;c!=null;c=c.nextSibling){var u=c.nodeType;if(u===1||u===3)break;if(u===8){if(u=c.data,u==="$"||u==="$!"||u==="$?"||u==="F!"||u==="F")break;if(u==="/$")return null}}return c}var hS=null;function hC(c){c=c.previousSibling;for(var u=0;c;){if(c.nodeType===8){var _=c.data;if(_==="$"||_==="$!"||_==="$?"){if(u===0)return c;u--}else _==="/$"&&u++}c=c.previousSibling}return null}function pC(c,u,_){switch(u=Pg(_),c){case"html":if(c=u.documentElement,!c)throw Error(d(452));return c;case"head":if(c=u.head,!c)throw Error(d(453));return c;case"body":if(c=u.body,!c)throw Error(d(454));return c;default:throw Error(d(451))}}function Zf(c){for(var u=c.attributes;u.length;)c.removeAttributeNode(u[0]);Gc(c)}var Qa=new Map,fC=new Set;function kg(c){return typeof c.getRootNode=="function"?c.getRootNode():c.nodeType===9?c:c.ownerDocument}var ll=je.d;je.d={f:GN,r:HN,D:zN,C:WN,L:qN,m:_C,X:YN,S:KN,M:XN};function GN(){var c=ll.f(),u=Cu();return c||u}function HN(c){var u=Jo(c);u!==null&&u.tag===5&&u.type==="form"?Ev(u):ll.r(c)}var tp=typeof document>"u"?null:document;function mC(c,u,_){var S=tp;if(S&&typeof u=="string"&&u){var A=Er(u);A='link[rel="'+c+'"][href="'+A+'"]',typeof _=="string"&&(A+='[crossorigin="'+_+'"]'),fC.has(A)||(fC.add(A),c={rel:c,crossOrigin:_,href:u},S.querySelector(A)===null&&(u=S.createElement("link"),as(u,"link",c),lr(u),S.head.appendChild(u)))}}function zN(c){ll.D(c),mC("dns-prefetch",c,null)}function WN(c,u){ll.C(c,u),mC("preconnect",c,u)}function qN(c,u,_){ll.L(c,u,_);var S=tp;if(S&&c&&u){var A='link[rel="preload"][as="'+Er(u)+'"]';u==="image"&&_&&_.imageSrcSet?(A+='[imagesrcset="'+Er(_.imageSrcSet)+'"]',typeof _.imageSizes=="string"&&(A+='[imagesizes="'+Er(_.imageSizes)+'"]')):A+='[href="'+Er(c)+'"]';var P=A;switch(u){case"style":P=np(c);break;case"script":P=rp(c)}Qa.has(P)||(c=x({rel:"preload",href:u==="image"&&_&&_.imageSrcSet?void 0:c,as:u},_),Qa.set(P,c),S.querySelector(A)!==null||u==="style"&&S.querySelector(ip(P))||u==="script"&&S.querySelector(em(P))||(u=S.createElement("link"),as(u,"link",c),lr(u),S.head.appendChild(u)))}}function _C(c,u){ll.m(c,u);var _=tp;if(_&&c){var S=u&&typeof u.as=="string"?u.as:"script",A='link[rel="modulepreload"][as="'+Er(S)+'"][href="'+Er(c)+'"]',P=A;switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":P=rp(c)}if(!Qa.has(P)&&(c=x({rel:"modulepreload",href:c},u),Qa.set(P,c),_.querySelector(A)===null)){switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(_.querySelector(em(P)))return}S=_.createElement("link"),as(S,"link",c),lr(S),_.head.appendChild(S)}}}function KN(c,u,_){ll.S(c,u,_);var S=tp;if(S&&c){var A=Rs(S).hoistableStyles,P=np(c);u=u||"default";var q=A.get(P);if(!q){var ie={loading:0,preload:null};if(q=S.querySelector(ip(P)))ie.loading=5;else{c=x({rel:"stylesheet",href:c,"data-precedence":u},_),(_=Qa.get(P))&&pS(c,_);var Se=q=S.createElement("link");lr(Se),as(Se,"link",c),Se._p=new Promise(function(ke,Ze){Se.onload=ke,Se.onerror=Ze}),Se.addEventListener("load",function(){ie.loading|=1}),Se.addEventListener("error",function(){ie.loading|=2}),ie.loading|=4,Ug(q,u,S)}q={type:"stylesheet",instance:q,count:1,state:ie},A.set(P,q)}}}function YN(c,u){ll.X(c,u);var _=tp;if(_&&c){var S=Rs(_).hoistableScripts,A=rp(c),P=S.get(A);P||(P=_.querySelector(em(A)),P||(c=x({src:c,async:!0},u),(u=Qa.get(A))&&fS(c,u),P=_.createElement("script"),lr(P),as(P,"link",c),_.head.appendChild(P)),P={type:"script",instance:P,count:1,state:null},S.set(A,P))}}function XN(c,u){ll.M(c,u);var _=tp;if(_&&c){var S=Rs(_).hoistableScripts,A=rp(c),P=S.get(A);P||(P=_.querySelector(em(A)),P||(c=x({src:c,async:!0,type:"module"},u),(u=Qa.get(A))&&fS(c,u),P=_.createElement("script"),lr(P),as(P,"link",c),_.head.appendChild(P)),P={type:"script",instance:P,count:1,state:null},S.set(A,P))}}function gC(c,u,_,S){var A=(A=$e.current)?kg(A):null;if(!A)throw Error(d(446));switch(c){case"meta":case"title":return null;case"style":return typeof _.precedence=="string"&&typeof _.href=="string"?(u=np(_.href),_=Rs(A).hoistableStyles,S=_.get(u),S||(S={type:"style",instance:null,count:0,state:null},_.set(u,S)),S):{type:"void",instance:null,count:0,state:null};case"link":if(_.rel==="stylesheet"&&typeof _.href=="string"&&typeof _.precedence=="string"){c=np(_.href);var P=Rs(A).hoistableStyles,q=P.get(c);if(q||(A=A.ownerDocument||A,q={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},P.set(c,q),(P=A.querySelector(ip(c)))&&!P._p&&(q.instance=P,q.state.loading=5),Qa.has(c)||(_={rel:"preload",as:"style",href:_.href,crossOrigin:_.crossOrigin,integrity:_.integrity,media:_.media,hrefLang:_.hrefLang,referrerPolicy:_.referrerPolicy},Qa.set(c,_),P||EC(A,c,_,q.state))),u&&S===null)throw Error(d(528,""));return q}if(u&&S!==null)throw Error(d(529,""));return null;case"script":return u=_.async,_=_.src,typeof _=="string"&&u&&typeof u!="function"&&typeof u!="symbol"?(u=rp(_),_=Rs(A).hoistableScripts,S=_.get(u),S||(S={type:"script",instance:null,count:0,state:null},_.set(u,S)),S):{type:"void",instance:null,count:0,state:null};default:throw Error(d(444,c))}}function np(c){return'href="'+Er(c)+'"'}function ip(c){return'link[rel="stylesheet"]['+c+"]"}function xg(c){return x({},c,{"data-precedence":c.precedence,precedence:null})}function EC(c,u,_,S){c.querySelector('link[rel="preload"][as="style"]['+u+"]")?S.loading=1:(u=c.createElement("link"),S.preload=u,u.addEventListener("load",function(){return S.loading|=1}),u.addEventListener("error",function(){return S.loading|=2}),as(u,"link",_),lr(u),c.head.appendChild(u))}function rp(c){return'[src="'+Er(c)+'"]'}function em(c){return"script[async]"+c}function Mg(c,u,_){if(u.count++,u.instance===null)switch(u.type){case"style":var S=c.querySelector('style[data-href~="'+Er(_.href)+'"]');if(S)return u.instance=S,lr(S),S;var A=x({},_,{"data-href":_.href,"data-precedence":_.precedence,href:null,precedence:null});return S=(c.ownerDocument||c).createElement("style"),lr(S),as(S,"style",A),Ug(S,_.precedence,c),u.instance=S;case"stylesheet":A=np(_.href);var P=c.querySelector(ip(A));if(P)return u.state.loading|=4,u.instance=P,lr(P),P;S=xg(_),(A=Qa.get(A))&&pS(S,A),P=(c.ownerDocument||c).createElement("link"),lr(P);var q=P;return q._p=new Promise(function(ie,Se){q.onload=ie,q.onerror=Se}),as(P,"link",S),u.state.loading|=4,Ug(P,_.precedence,c),u.instance=P;case"script":return P=rp(_.src),(A=c.querySelector(em(P)))?(u.instance=A,lr(A),A):(S=_,(A=Qa.get(P))&&(S=x({},_),fS(S,A)),c=c.ownerDocument||c,A=c.createElement("script"),lr(A),as(A,"link",S),c.head.appendChild(A),u.instance=A);case"void":return null;default:throw Error(d(443,u.type))}else u.type==="stylesheet"&&(u.state.loading&4)===0&&(S=u.instance,u.state.loading|=4,Ug(S,_.precedence,c));return u.instance}function Ug(c,u,_){for(var S=_.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),A=S.length?S[S.length-1]:null,P=A,q=0;q<S.length;q++){var ie=S[q];if(ie.dataset.precedence===u)P=ie;else if(P!==A)break}P?P.parentNode.insertBefore(c,P.nextSibling):(u=_.nodeType===9?_.head:_,u.insertBefore(c,u.firstChild))}function pS(c,u){c.crossOrigin==null&&(c.crossOrigin=u.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=u.referrerPolicy),c.title==null&&(c.title=u.title)}function fS(c,u){c.crossOrigin==null&&(c.crossOrigin=u.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=u.referrerPolicy),c.integrity==null&&(c.integrity=u.integrity)}var jg=null;function mS(c,u,_){if(jg===null){var S=new Map,A=jg=new Map;A.set(_,S)}else A=jg,S=A.get(_),S||(S=new Map,A.set(_,S));if(S.has(c))return S;for(S.set(c,null),_=_.getElementsByTagName(c),A=0;A<_.length;A++){var P=_[A];if(!(P[Ul]||P[Ur]||c==="link"&&P.getAttribute("rel")==="stylesheet")&&P.namespaceURI!=="http://www.w3.org/2000/svg"){var q=P.getAttribute(u)||"";q=c+q;var ie=S.get(q);ie?ie.push(P):S.set(q,[P])}}return S}function yC(c,u,_){c=c.ownerDocument||c,c.head.insertBefore(_,u==="title"?c.querySelector("head > title"):null)}function _S(c,u,_){if(_===1||u.itemProp!=null)return!1;switch(c){case"meta":case"title":return!0;case"style":if(typeof u.precedence!="string"||typeof u.href!="string"||u.href==="")break;return!0;case"link":if(typeof u.rel!="string"||typeof u.href!="string"||u.href===""||u.onLoad||u.onError)break;switch(u.rel){case"stylesheet":return c=u.disabled,typeof u.precedence=="string"&&c==null;default:return!0}case"script":if(u.async&&typeof u.async!="function"&&typeof u.async!="symbol"&&!u.onLoad&&!u.onError&&u.src&&typeof u.src=="string")return!0}return!1}function vC(c){return!(c.type==="stylesheet"&&(c.state.loading&3)===0)}var tm=null;function JN(){}function QN(c,u,_){if(tm===null)throw Error(d(475));var S=tm;if(u.type==="stylesheet"&&(typeof _.media!="string"||matchMedia(_.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var A=np(_.href),P=c.querySelector(ip(A));if(P){c=P._p,c!==null&&typeof c=="object"&&typeof c.then=="function"&&(S.count++,S=Vg.bind(S),c.then(S,S)),u.state.loading|=4,u.instance=P,lr(P);return}P=c.ownerDocument||c,_=xg(_),(A=Qa.get(A))&&pS(_,A),P=P.createElement("link"),lr(P);var q=P;q._p=new Promise(function(ie,Se){q.onload=ie,q.onerror=Se}),as(P,"link",_),u.instance=P}S.stylesheets===null&&(S.stylesheets=new Map),S.stylesheets.set(u,c),(c=u.state.preload)&&(u.state.loading&3)===0&&(S.count++,u=Vg.bind(S),c.addEventListener("load",u),c.addEventListener("error",u))}}function SC(){if(tm===null)throw Error(d(475));var c=tm;return c.stylesheets&&c.count===0&&im(c,c.stylesheets),0<c.count?function(u){var _=setTimeout(function(){if(c.stylesheets&&im(c,c.stylesheets),c.unsuspend){var S=c.unsuspend;c.unsuspend=null,S()}},6e4);return c.unsuspend=u,function(){c.unsuspend=null,clearTimeout(_)}}:null}function Vg(){if(this.count--,this.count===0){if(this.stylesheets)im(this,this.stylesheets);else if(this.unsuspend){var c=this.unsuspend;this.unsuspend=null,c()}}}var nm=null;function im(c,u){c.stylesheets=null,c.unsuspend!==null&&(c.count++,nm=new Map,u.forEach($N,c),nm=null,Vg.call(c))}function $N(c,u){if(!(u.state.loading&4)){var _=nm.get(c);if(_)var S=_.get(null);else{_=new Map,nm.set(c,_);for(var A=c.querySelectorAll("link[data-precedence],style[data-precedence]"),P=0;P<A.length;P++){var q=A[P];(q.nodeName==="LINK"||q.getAttribute("media")!=="not all")&&(_.set(q.dataset.precedence,q),S=q)}S&&_.set(null,S)}A=u.instance,q=A.getAttribute("data-precedence"),P=_.get(q)||S,P===S&&_.set(null,A),_.set(q,A),this.count++,S=Vg.bind(this),A.addEventListener("load",S),A.addEventListener("error",S),P?P.parentNode.insertBefore(A,P.nextSibling):(c=c.nodeType===9?c.head:c,c.insertBefore(A,c.firstChild)),u.state.loading|=4}}var rm={$$typeof:me,Provider:null,Consumer:null,_currentValue:nt,_currentValue2:nt,_threadCount:0};function TC(c,u,_,S,A,P,q,ie){this.tag=1,this.containerInfo=c,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ba(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ba(0),this.hiddenUpdates=Ba(null),this.identifierPrefix=S,this.onUncaughtError=A,this.onCaughtError=P,this.onRecoverableError=q,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ie,this.incompleteTransitions=new Map}function RC(c,u,_,S,A,P,q,ie,Se,ke,Ze,dt){return c=new TC(c,u,_,q,ie,Se,ke,dt),u=1,P===!0&&(u|=24),P=Aa(3,null,null,u),c.current=P,P.stateNode=c,u=pf(),u.refCount++,c.pooledCache=u,u.refCount++,P.memoizedState={element:S,isDehydrated:_,cache:u},H_(P),c}function gS(c){return c?(c=el,c):el}function ES(c,u,_,S,A,P){A=gS(A),S.context===null?S.context=A:S.pendingContext=A,S=Ql(u),S.payload={element:_},P=P===void 0?null:P,P!==null&&(S.callback=P),_=sl(c,S,u),_!==null&&(aa(_,c,u),gf(_,c,u))}function bC(c,u){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var _=c.retryLane;c.retryLane=_!==0&&_<u?_:u}}function yS(c,u){bC(c,u),(c=c.alternate)&&bC(c,u)}function CC(c){if(c.tag===13){var u=vh(c,67108864);u!==null&&aa(u,c,67108864),yS(c,67108864)}}var Fg=!0;function ZN(c,u,_,S){var A=we.T;we.T=null;var P=je.p;try{je.p=2,Bg(c,u,_,S)}finally{je.p=P,we.T=A}}function eO(c,u,_,S){var A=we.T;we.T=null;var P=je.p;try{je.p=8,Bg(c,u,_,S)}finally{je.p=P,we.T=A}}function Bg(c,u,_,S){if(Fg){var A=sm(S);if(A===null)Og(c,u,S,am,_),SS(c,S);else if(AC(A,c,u,_,S))S.stopPropagation();else if(SS(c,S),u&4&&-1<Fs.indexOf(c)){for(;A!==null;){var P=Jo(A);if(P!==null)switch(P.tag){case 3:if(P=P.stateNode,P.current.memoizedState.isDehydrated){var q=Ts(P.pendingLanes);if(q!==0){var ie=P;for(ie.pendingLanes|=2,ie.entangledLanes|=2;q;){var Se=1<<31-gn(q);ie.entanglements[1]|=Se,q&=~Se}Ja(P),(fi&6)===0&&(Hh=rn()+500,Xf(0))}}break;case 13:ie=vh(P,2),ie!==null&&aa(ie,P,2),Cu(),yS(P,2)}if(P=sm(S),P===null&&Og(c,u,S,am,_),P===A)break;A=P}A!==null&&S.stopPropagation()}else Og(c,u,S,null,_)}}function sm(c){return c=Ga(c),Je(c)}var am=null;function Je(c){if(am=null,c=Hc(c),c!==null){var u=y(c);if(u===null)c=null;else{var _=u.tag;if(_===13){if(c=R(u),c!==null)return c;c=null}else if(_===3){if(u.stateNode.current.memoizedState.isDehydrated)return u.tag===3?u.stateNode.containerInfo:null;c=null}else u!==c&&(c=null)}}return am=c,null}function wC(c){switch(c){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(kn()){case ui:return 2;case Zr:return 8;case _r:case Ko:return 32;case Qs:return 268435456;default:return 32}default:return 32}}var vS=!1,pd=null,fd=null,md=null,Du=new Map,om=new Map,_d=[],Fs="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function SS(c,u){switch(c){case"focusin":case"focusout":pd=null;break;case"dragenter":case"dragleave":fd=null;break;case"mouseover":case"mouseout":md=null;break;case"pointerover":case"pointerout":Du.delete(u.pointerId);break;case"gotpointercapture":case"lostpointercapture":om.delete(u.pointerId)}}function cm(c,u,_,S,A,P){return c===null||c.nativeEvent!==P?(c={blockedOn:u,domEventName:_,eventSystemFlags:S,nativeEvent:P,targetContainers:[A]},u!==null&&(u=Jo(u),u!==null&&CC(u)),c):(c.eventSystemFlags|=S,u=c.targetContainers,A!==null&&u.indexOf(A)===-1&&u.push(A),c)}function AC(c,u,_,S,A){switch(u){case"focusin":return pd=cm(pd,c,u,_,S,A),!0;case"dragenter":return fd=cm(fd,c,u,_,S,A),!0;case"mouseover":return md=cm(md,c,u,_,S,A),!0;case"pointerover":var P=A.pointerId;return Du.set(P,cm(Du.get(P)||null,c,u,_,S,A)),!0;case"gotpointercapture":return P=A.pointerId,om.set(P,cm(om.get(P)||null,c,u,_,S,A)),!0}return!1}function IC(c){var u=Hc(c.target);if(u!==null){var _=y(u);if(_!==null){if(u=_.tag,u===13){if(u=R(_),u!==null){c.blockedOn=u,p_(c.priority,function(){if(_.tag===13){var S=Da();S=va(S);var A=vh(_,S);A!==null&&aa(A,_,S),yS(_,S)}});return}}else if(u===3&&_.stateNode.current.memoizedState.isDehydrated){c.blockedOn=_.tag===3?_.stateNode.containerInfo:null;return}}}c.blockedOn=null}function sp(c){if(c.blockedOn!==null)return!1;for(var u=c.targetContainers;0<u.length;){var _=sm(c.nativeEvent);if(_===null){_=c.nativeEvent;var S=new _.constructor(_.type,_);qc=S,_.target.dispatchEvent(S),qc=null}else return u=Jo(_),u!==null&&CC(u),c.blockedOn=_,!1;u.shift()}return!0}function TS(c,u,_){sp(c)&&_.delete(u)}function NC(){vS=!1,pd!==null&&sp(pd)&&(pd=null),fd!==null&&sp(fd)&&(fd=null),md!==null&&sp(md)&&(md=null),Du.forEach(TS),om.forEach(TS)}function Gg(c,u){c.blockedOn===u&&(c.blockedOn=null,vS||(vS=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,NC)))}var Hg=null;function RS(c){Hg!==c&&(Hg=c,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){Hg===c&&(Hg=null);for(var u=0;u<c.length;u+=3){var _=c[u],S=c[u+1],A=c[u+2];if(typeof S!="function"){if(Je(S||_)===null)continue;break}var P=Jo(_);P!==null&&(c.splice(u,3),u-=3,Lh(P,{pending:!0,data:A,method:_.method,action:S},S,A))}}))}function lm(c){function u(Se){return Gg(Se,c)}pd!==null&&Gg(pd,c),fd!==null&&Gg(fd,c),md!==null&&Gg(md,c),Du.forEach(u),om.forEach(u);for(var _=0;_<_d.length;_++){var S=_d[_];S.blockedOn===c&&(S.blockedOn=null)}for(;0<_d.length&&(_=_d[0],_.blockedOn===null);)IC(_),_.blockedOn===null&&_d.shift();if(_=(c.ownerDocument||c).$$reactFormReplay,_!=null)for(S=0;S<_.length;S+=3){var A=_[S],P=_[S+1],q=A[Ar]||null;if(typeof P=="function")q||RS(_);else if(q){var ie=null;if(P&&P.hasAttribute("formAction")){if(A=P,q=P[Ar]||null)ie=q.formAction;else if(Je(A)!==null)continue}else ie=q.action;typeof ie=="function"?_[S+1]=ie:(_.splice(S,3),S-=3),RS(_)}}}function bS(c){this._internalRoot=c}dm.prototype.render=bS.prototype.render=function(c){var u=this._internalRoot;if(u===null)throw Error(d(409));var _=u.current,S=Da();ES(_,S,c,u,null,null)},dm.prototype.unmount=bS.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var u=c.containerInfo;ES(c.current,2,null,c,null,null),Cu(),u[ks]=null}};function dm(c){this._internalRoot=c}dm.prototype.unstable_scheduleHydration=function(c){if(c){var u=Ml();c={blockedOn:null,target:c,priority:u};for(var _=0;_<_d.length&&u!==0&&u<_d[_].priority;_++);_d.splice(_,0,c),_===0&&IC(c)}};var OC=i.version;if(OC!=="19.1.0")throw Error(d(527,OC,"19.1.0"));je.findDOMNode=function(c){var u=c._reactInternals;if(u===void 0)throw typeof c.render=="function"?Error(d(188)):(c=Object.keys(c).join(","),Error(d(268,c)));return c=N(u),c=c!==null?O(c):null,c=c===null?null:c.stateNode,c};var tO={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:we,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var um=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!um.isDisabled&&um.supportsFiber)try{Gt=um.inject(tO),Me=um}catch{}}return jT.createRoot=function(c,u){if(!f(c))throw Error(d(299));var _=!1,S="",A=Ob,P=Db,q=Pb,ie=null;return u!=null&&(u.unstable_strictMode===!0&&(_=!0),u.identifierPrefix!==void 0&&(S=u.identifierPrefix),u.onUncaughtError!==void 0&&(A=u.onUncaughtError),u.onCaughtError!==void 0&&(P=u.onCaughtError),u.onRecoverableError!==void 0&&(q=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(ie=u.unstable_transitionCallbacks)),u=RC(c,1,!1,null,null,_,S,A,P,q,ie,null),c[ks]=u.current,Ng(c),new bS(u)},jT.hydrateRoot=function(c,u,_){if(!f(c))throw Error(d(299));var S=!1,A="",P=Ob,q=Db,ie=Pb,Se=null,ke=null;return _!=null&&(_.unstable_strictMode===!0&&(S=!0),_.identifierPrefix!==void 0&&(A=_.identifierPrefix),_.onUncaughtError!==void 0&&(P=_.onUncaughtError),_.onCaughtError!==void 0&&(q=_.onCaughtError),_.onRecoverableError!==void 0&&(ie=_.onRecoverableError),_.unstable_transitionCallbacks!==void 0&&(Se=_.unstable_transitionCallbacks),_.formState!==void 0&&(ke=_.formState)),u=RC(c,1,!0,u,_??null,S,A,P,q,ie,Se,ke),u.context=gS(null),_=u.current,S=Da(),S=va(S),A=Ql(S),A.callback=null,sl(_,A,S),_=S,u.current.lanes=_,Fc(u,_),Ja(u),c[ks]=u.current,Ng(c),new dm(u)},jT.version="19.1.0",jT}var aG;function Bee(){if(aG)return jL.exports;aG=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(i){console.error(i)}}return o(),jL.exports=Fee(),jL.exports}var Gee=Bee(),VT={},oG;function Hee(){if(oG)return VT;oG=1,Object.defineProperty(VT,"__esModule",{value:!0}),VT.parse=R,VT.serialize=O;const o=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,i=/^[\u0021-\u003A\u003C-\u007E]*$/,a=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,d=/^[\u0020-\u003A\u003D-\u007E]*$/,f=Object.prototype.toString,y=(()=>{const W=function(){};return W.prototype=Object.create(null),W})();function R(W,ne){const Q=new y,se=W.length;if(se<2)return Q;const te=(ne==null?void 0:ne.decode)||x;let le=0;do{const ce=W.indexOf("=",le);if(ce===-1)break;const me=W.indexOf(";",le),Ce=me===-1?se:me;if(ce>Ce){le=W.lastIndexOf(";",ce-1)+1;continue}const _e=w(W,le,ce),ze=N(W,ce,_e),Z=W.slice(_e,ze);if(Q[Z]===void 0){let J=w(W,ce+1,Ce),$=N(W,Ce,J);const fe=te(W.slice(J,$));Q[Z]=fe}le=Ce+1}while(le<se);return Q}function w(W,ne,Q){do{const se=W.charCodeAt(ne);if(se!==32&&se!==9)return ne}while(++ne<Q);return Q}function N(W,ne,Q){for(;ne>Q;){const se=W.charCodeAt(--ne);if(se!==32&&se!==9)return ne+1}return Q}function O(W,ne,Q){const se=(Q==null?void 0:Q.encode)||encodeURIComponent;if(!o.test(W))throw new TypeError(`argument name is invalid: ${W}`);const te=se(ne);if(!i.test(te))throw new TypeError(`argument val is invalid: ${ne}`);let le=W+"="+te;if(!Q)return le;if(Q.maxAge!==void 0){if(!Number.isInteger(Q.maxAge))throw new TypeError(`option maxAge is invalid: ${Q.maxAge}`);le+="; Max-Age="+Q.maxAge}if(Q.domain){if(!a.test(Q.domain))throw new TypeError(`option domain is invalid: ${Q.domain}`);le+="; Domain="+Q.domain}if(Q.path){if(!d.test(Q.path))throw new TypeError(`option path is invalid: ${Q.path}`);le+="; Path="+Q.path}if(Q.expires){if(!G(Q.expires)||!Number.isFinite(Q.expires.valueOf()))throw new TypeError(`option expires is invalid: ${Q.expires}`);le+="; Expires="+Q.expires.toUTCString()}if(Q.httpOnly&&(le+="; HttpOnly"),Q.secure&&(le+="; Secure"),Q.partitioned&&(le+="; Partitioned"),Q.priority)switch(typeof Q.priority=="string"?Q.priority.toLowerCase():void 0){case"low":le+="; Priority=Low";break;case"medium":le+="; Priority=Medium";break;case"high":le+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${Q.priority}`)}if(Q.sameSite)switch(typeof Q.sameSite=="string"?Q.sameSite.toLowerCase():Q.sameSite){case!0:case"strict":le+="; SameSite=Strict";break;case"lax":le+="; SameSite=Lax";break;case"none":le+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${Q.sameSite}`)}return le}function x(W){if(W.indexOf("%")===-1)return W;try{return decodeURIComponent(W)}catch{return W}}function G(W){return f.call(W)==="[object Date]"}return VT}Hee();/**
 * react-router v7.5.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var cG="popstate";function zee(o={}){function i(d,f){let{pathname:y,search:R,hash:w}=d.location;return Mk("",{pathname:y,search:R,hash:w},f.state&&f.state.usr||null,f.state&&f.state.key||"default")}function a(d,f){return typeof f=="string"?f:oR(f)}return qee(i,a,null,o)}function mr(o,i){if(o===!1||o===null||typeof o>"u")throw new Error(i)}function Ol(o,i){if(!o){typeof console<"u"&&console.warn(i);try{throw new Error(i)}catch{}}}function Wee(){return Math.random().toString(36).substring(2,10)}function lG(o,i){return{usr:o.state,key:o.key,idx:i}}function Mk(o,i,a=null,d){return{pathname:typeof o=="string"?o:o.pathname,search:"",hash:"",...typeof i=="string"?_y(i):i,state:a,key:i&&i.key||d||Wee()}}function oR({pathname:o="/",search:i="",hash:a=""}){return i&&i!=="?"&&(o+=i.charAt(0)==="?"?i:"?"+i),a&&a!=="#"&&(o+=a.charAt(0)==="#"?a:"#"+a),o}function _y(o){let i={};if(o){let a=o.indexOf("#");a>=0&&(i.hash=o.substring(a),o=o.substring(0,a));let d=o.indexOf("?");d>=0&&(i.search=o.substring(d),o=o.substring(0,d)),o&&(i.pathname=o)}return i}function qee(o,i,a,d={}){let{window:f=document.defaultView,v5Compat:y=!1}=d,R=f.history,w="POP",N=null,O=x();O==null&&(O=0,R.replaceState({...R.state,idx:O},""));function x(){return(R.state||{idx:null}).idx}function G(){w="POP";let te=x(),le=te==null?null:te-O;O=te,N&&N({action:w,location:se.location,delta:le})}function W(te,le){w="PUSH";let ce=Mk(se.location,te,le);O=x()+1;let me=lG(ce,O),Ce=se.createHref(ce);try{R.pushState(me,"",Ce)}catch(_e){if(_e instanceof DOMException&&_e.name==="DataCloneError")throw _e;f.location.assign(Ce)}y&&N&&N({action:w,location:se.location,delta:1})}function ne(te,le){w="REPLACE";let ce=Mk(se.location,te,le);O=x();let me=lG(ce,O),Ce=se.createHref(ce);R.replaceState(me,"",Ce),y&&N&&N({action:w,location:se.location,delta:0})}function Q(te){let le=f.location.origin!=="null"?f.location.origin:f.location.href,ce=typeof te=="string"?te:oR(te);return ce=ce.replace(/ $/,"%20"),mr(le,`No window.location.(origin|href) available to create URL for href: ${ce}`),new URL(ce,le)}let se={get action(){return w},get location(){return o(f,R)},listen(te){if(N)throw new Error("A history only accepts one active listener");return f.addEventListener(cG,G),N=te,()=>{f.removeEventListener(cG,G),N=null}},createHref(te){return i(f,te)},createURL:Q,encodeLocation(te){let le=Q(te);return{pathname:le.pathname,search:le.search,hash:le.hash}},push:W,replace:ne,go(te){return R.go(te)}};return se}function S9(o,i,a="/"){return Kee(o,i,a,!1)}function Kee(o,i,a,d){let f=typeof i=="string"?_y(i):i,y=eh(f.pathname||"/",a);if(y==null)return null;let R=T9(o);Yee(R);let w=null;for(let N=0;w==null&&N<R.length;++N){let O=ste(y);w=ite(R[N],O,d)}return w}function T9(o,i=[],a=[],d=""){let f=(y,R,w)=>{let N={relativePath:w===void 0?y.path||"":w,caseSensitive:y.caseSensitive===!0,childrenIndex:R,route:y};N.relativePath.startsWith("/")&&(mr(N.relativePath.startsWith(d),`Absolute route path "${N.relativePath}" nested under path "${d}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),N.relativePath=N.relativePath.slice(d.length));let O=Ju([d,N.relativePath]),x=a.concat(N);y.children&&y.children.length>0&&(mr(y.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${O}".`),T9(y.children,i,x,O)),!(y.path==null&&!y.index)&&i.push({path:O,score:tte(O,y.index),routesMeta:x})};return o.forEach((y,R)=>{var w;if(y.path===""||!((w=y.path)!=null&&w.includes("?")))f(y,R);else for(let N of R9(y.path))f(y,R,N)}),i}function R9(o){let i=o.split("/");if(i.length===0)return[];let[a,...d]=i,f=a.endsWith("?"),y=a.replace(/\?$/,"");if(d.length===0)return f?[y,""]:[y];let R=R9(d.join("/")),w=[];return w.push(...R.map(N=>N===""?y:[y,N].join("/"))),f&&w.push(...R),w.map(N=>o.startsWith("/")&&N===""?"/":N)}function Yee(o){o.sort((i,a)=>i.score!==a.score?a.score-i.score:nte(i.routesMeta.map(d=>d.childrenIndex),a.routesMeta.map(d=>d.childrenIndex)))}var Xee=/^:[\w-]+$/,Jee=3,Qee=2,$ee=1,Zee=10,ete=-2,dG=o=>o==="*";function tte(o,i){let a=o.split("/"),d=a.length;return a.some(dG)&&(d+=ete),i&&(d+=Qee),a.filter(f=>!dG(f)).reduce((f,y)=>f+(Xee.test(y)?Jee:y===""?$ee:Zee),d)}function nte(o,i){return o.length===i.length&&o.slice(0,-1).every((d,f)=>d===i[f])?o[o.length-1]-i[i.length-1]:0}function ite(o,i,a=!1){let{routesMeta:d}=o,f={},y="/",R=[];for(let w=0;w<d.length;++w){let N=d[w],O=w===d.length-1,x=y==="/"?i:i.slice(y.length)||"/",G=Y0({path:N.relativePath,caseSensitive:N.caseSensitive,end:O},x),W=N.route;if(!G&&O&&a&&!d[d.length-1].route.index&&(G=Y0({path:N.relativePath,caseSensitive:N.caseSensitive,end:!1},x)),!G)return null;Object.assign(f,G.params),R.push({params:f,pathname:Ju([y,G.pathname]),pathnameBase:lte(Ju([y,G.pathnameBase])),route:W}),G.pathnameBase!=="/"&&(y=Ju([y,G.pathnameBase]))}return R}function Y0(o,i){typeof o=="string"&&(o={path:o,caseSensitive:!1,end:!0});let[a,d]=rte(o.path,o.caseSensitive,o.end),f=i.match(a);if(!f)return null;let y=f[0],R=y.replace(/(.)\/+$/,"$1"),w=f.slice(1);return{params:d.reduce((O,{paramName:x,isOptional:G},W)=>{if(x==="*"){let Q=w[W]||"";R=y.slice(0,y.length-Q.length).replace(/(.)\/+$/,"$1")}const ne=w[W];return G&&!ne?O[x]=void 0:O[x]=(ne||"").replace(/%2F/g,"/"),O},{}),pathname:y,pathnameBase:R,pattern:o}}function rte(o,i=!1,a=!0){Ol(o==="*"||!o.endsWith("*")||o.endsWith("/*"),`Route path "${o}" will be treated as if it were "${o.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${o.replace(/\*$/,"/*")}".`);let d=[],f="^"+o.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(R,w,N)=>(d.push({paramName:w,isOptional:N!=null}),N?"/?([^\\/]+)?":"/([^\\/]+)"));return o.endsWith("*")?(d.push({paramName:"*"}),f+=o==="*"||o==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?f+="\\/*$":o!==""&&o!=="/"&&(f+="(?:(?=\\/|$))"),[new RegExp(f,i?void 0:"i"),d]}function ste(o){try{return o.split("/").map(i=>decodeURIComponent(i).replace(/\//g,"%2F")).join("/")}catch(i){return Ol(!1,`The URL path "${o}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${i}).`),o}}function eh(o,i){if(i==="/")return o;if(!o.toLowerCase().startsWith(i.toLowerCase()))return null;let a=i.endsWith("/")?i.length-1:i.length,d=o.charAt(a);return d&&d!=="/"?null:o.slice(a)||"/"}function ate(o,i="/"){let{pathname:a,search:d="",hash:f=""}=typeof o=="string"?_y(o):o;return{pathname:a?a.startsWith("/")?a:ote(a,i):i,search:dte(d),hash:ute(f)}}function ote(o,i){let a=i.replace(/\/+$/,"").split("/");return o.split("/").forEach(f=>{f===".."?a.length>1&&a.pop():f!=="."&&a.push(f)}),a.length>1?a.join("/"):"/"}function GL(o,i,a,d){return`Cannot include a '${o}' character in a manually specified \`to.${i}\` field [${JSON.stringify(d)}].  Please separate it out to the \`to.${a}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function cte(o){return o.filter((i,a)=>a===0||i.route.path&&i.route.path.length>0)}function Ox(o){let i=cte(o);return i.map((a,d)=>d===i.length-1?a.pathname:a.pathnameBase)}function Dx(o,i,a,d=!1){let f;typeof o=="string"?f=_y(o):(f={...o},mr(!f.pathname||!f.pathname.includes("?"),GL("?","pathname","search",f)),mr(!f.pathname||!f.pathname.includes("#"),GL("#","pathname","hash",f)),mr(!f.search||!f.search.includes("#"),GL("#","search","hash",f)));let y=o===""||f.pathname==="",R=y?"/":f.pathname,w;if(R==null)w=a;else{let G=i.length-1;if(!d&&R.startsWith("..")){let W=R.split("/");for(;W[0]==="..";)W.shift(),G-=1;f.pathname=W.join("/")}w=G>=0?i[G]:"/"}let N=ate(f,w),O=R&&R!=="/"&&R.endsWith("/"),x=(y||R===".")&&a.endsWith("/");return!N.pathname.endsWith("/")&&(O||x)&&(N.pathname+="/"),N}var Ju=o=>o.join("/").replace(/\/\/+/g,"/"),lte=o=>o.replace(/\/+$/,"").replace(/^\/*/,"/"),dte=o=>!o||o==="?"?"":o.startsWith("?")?o:"?"+o,ute=o=>!o||o==="#"?"":o.startsWith("#")?o:"#"+o;function hte(o){return o!=null&&typeof o.status=="number"&&typeof o.statusText=="string"&&typeof o.internal=="boolean"&&"data"in o}var b9=["POST","PUT","PATCH","DELETE"];new Set(b9);var pte=["GET",...b9];new Set(pte);var gy=K.createContext(null);gy.displayName="DataRouter";var bI=K.createContext(null);bI.displayName="DataRouterState";var C9=K.createContext({isTransitioning:!1});C9.displayName="ViewTransition";var fte=K.createContext(new Map);fte.displayName="Fetchers";var mte=K.createContext(null);mte.displayName="Await";var Ll=K.createContext(null);Ll.displayName="Navigation";var RR=K.createContext(null);RR.displayName="Location";var Gd=K.createContext({outlet:null,matches:[],isDataRoute:!1});Gd.displayName="Route";var Px=K.createContext(null);Px.displayName="RouteError";function _te(o,{relative:i}={}){mr(Ey(),"useHref() may be used only in the context of a <Router> component.");let{basename:a,navigator:d}=K.useContext(Ll),{hash:f,pathname:y,search:R}=bR(o,{relative:i}),w=y;return a!=="/"&&(w=y==="/"?a:Ju([a,y])),d.createHref({pathname:w,search:R,hash:f})}function Ey(){return K.useContext(RR)!=null}function $r(){return mr(Ey(),"useLocation() may be used only in the context of a <Router> component."),K.useContext(RR).location}var w9="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function A9(o){K.useContext(Ll).static||K.useLayoutEffect(o)}function qo(){let{isDataRoute:o}=K.useContext(Gd);return o?Nte():gte()}function gte(){mr(Ey(),"useNavigate() may be used only in the context of a <Router> component.");let o=K.useContext(gy),{basename:i,navigator:a}=K.useContext(Ll),{matches:d}=K.useContext(Gd),{pathname:f}=$r(),y=JSON.stringify(Ox(d)),R=K.useRef(!1);return A9(()=>{R.current=!0}),K.useCallback((N,O={})=>{if(Ol(R.current,w9),!R.current)return;if(typeof N=="number"){a.go(N);return}let x=Dx(N,JSON.parse(y),f,O.relative==="path");o==null&&i!=="/"&&(x.pathname=x.pathname==="/"?i:Ju([i,x.pathname])),(O.replace?a.replace:a.push)(x,O.state,O)},[i,a,y,f,o])}K.createContext(null);function bR(o,{relative:i}={}){let{matches:a}=K.useContext(Gd),{pathname:d}=$r(),f=JSON.stringify(Ox(a));return K.useMemo(()=>Dx(o,JSON.parse(f),d,i==="path"),[o,f,d,i])}function Ete(o,i){return I9(o,i)}function I9(o,i,a,d){var ce;mr(Ey(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:f,static:y}=K.useContext(Ll),{matches:R}=K.useContext(Gd),w=R[R.length-1],N=w?w.params:{},O=w?w.pathname:"/",x=w?w.pathnameBase:"/",G=w&&w.route;{let me=G&&G.path||"";N9(O,!G||me.endsWith("*")||me.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${O}" (under <Route path="${me}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${me}"> to <Route path="${me==="/"?"*":`${me}/*`}">.`)}let W=$r(),ne;if(i){let me=typeof i=="string"?_y(i):i;mr(x==="/"||((ce=me.pathname)==null?void 0:ce.startsWith(x)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${x}" but pathname "${me.pathname}" was given in the \`location\` prop.`),ne=me}else ne=W;let Q=ne.pathname||"/",se=Q;if(x!=="/"){let me=x.replace(/^\//,"").split("/");se="/"+Q.replace(/^\//,"").split("/").slice(me.length).join("/")}let te=!y&&a&&a.matches&&a.matches.length>0?a.matches:S9(o,{pathname:se});Ol(G||te!=null,`No routes matched location "${ne.pathname}${ne.search}${ne.hash}" `),Ol(te==null||te[te.length-1].route.element!==void 0||te[te.length-1].route.Component!==void 0||te[te.length-1].route.lazy!==void 0,`Matched leaf route at location "${ne.pathname}${ne.search}${ne.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let le=Rte(te&&te.map(me=>Object.assign({},me,{params:Object.assign({},N,me.params),pathname:Ju([x,f.encodeLocation?f.encodeLocation(me.pathname).pathname:me.pathname]),pathnameBase:me.pathnameBase==="/"?x:Ju([x,f.encodeLocation?f.encodeLocation(me.pathnameBase).pathname:me.pathnameBase])})),R,a,d);return i&&le?K.createElement(RR.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...ne},navigationType:"POP"}},le):le}function yte(){let o=Ite(),i=hte(o)?`${o.status} ${o.statusText}`:o instanceof Error?o.message:JSON.stringify(o),a=o instanceof Error?o.stack:null,d="rgba(200,200,200, 0.5)",f={padding:"0.5rem",backgroundColor:d},y={padding:"2px 4px",backgroundColor:d},R=null;return console.error("Error handled by React Router default ErrorBoundary:",o),R=K.createElement(K.Fragment,null,K.createElement("p",null," Hey developer "),K.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",K.createElement("code",{style:y},"ErrorBoundary")," or"," ",K.createElement("code",{style:y},"errorElement")," prop on your route.")),K.createElement(K.Fragment,null,K.createElement("h2",null,"Unexpected Application Error!"),K.createElement("h3",{style:{fontStyle:"italic"}},i),a?K.createElement("pre",{style:f},a):null,R)}var vte=K.createElement(yte,null),Ste=class extends K.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,i){return i.location!==o.location||i.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:i.error,location:i.location,revalidation:o.revalidation||i.revalidation}}componentDidCatch(o,i){console.error("React Router caught the following error during render",o,i)}render(){return this.state.error!==void 0?K.createElement(Gd.Provider,{value:this.props.routeContext},K.createElement(Px.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Tte({routeContext:o,match:i,children:a}){let d=K.useContext(gy);return d&&d.static&&d.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(d.staticContext._deepestRenderedBoundaryId=i.route.id),K.createElement(Gd.Provider,{value:o},a)}function Rte(o,i=[],a=null,d=null){if(o==null){if(!a)return null;if(a.errors)o=a.matches;else if(i.length===0&&!a.initialized&&a.matches.length>0)o=a.matches;else return null}let f=o,y=a==null?void 0:a.errors;if(y!=null){let N=f.findIndex(O=>O.route.id&&(y==null?void 0:y[O.route.id])!==void 0);mr(N>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(y).join(",")}`),f=f.slice(0,Math.min(f.length,N+1))}let R=!1,w=-1;if(a)for(let N=0;N<f.length;N++){let O=f[N];if((O.route.HydrateFallback||O.route.hydrateFallbackElement)&&(w=N),O.route.id){let{loaderData:x,errors:G}=a,W=O.route.loader&&!x.hasOwnProperty(O.route.id)&&(!G||G[O.route.id]===void 0);if(O.route.lazy||W){R=!0,w>=0?f=f.slice(0,w+1):f=[f[0]];break}}}return f.reduceRight((N,O,x)=>{let G,W=!1,ne=null,Q=null;a&&(G=y&&O.route.id?y[O.route.id]:void 0,ne=O.route.errorElement||vte,R&&(w<0&&x===0?(N9("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),W=!0,Q=null):w===x&&(W=!0,Q=O.route.hydrateFallbackElement||null)));let se=i.concat(f.slice(0,x+1)),te=()=>{let le;return G?le=ne:W?le=Q:O.route.Component?le=K.createElement(O.route.Component,null):O.route.element?le=O.route.element:le=N,K.createElement(Tte,{match:O,routeContext:{outlet:N,matches:se,isDataRoute:a!=null},children:le})};return a&&(O.route.ErrorBoundary||O.route.errorElement||x===0)?K.createElement(Ste,{location:a.location,revalidation:a.revalidation,component:ne,error:G,children:te(),routeContext:{outlet:null,matches:se,isDataRoute:!0}}):te()},null)}function Lx(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function bte(o){let i=K.useContext(gy);return mr(i,Lx(o)),i}function Cte(o){let i=K.useContext(bI);return mr(i,Lx(o)),i}function wte(o){let i=K.useContext(Gd);return mr(i,Lx(o)),i}function kx(o){let i=wte(o),a=i.matches[i.matches.length-1];return mr(a.route.id,`${o} can only be used on routes that contain a unique "id"`),a.route.id}function Ate(){return kx("useRouteId")}function Ite(){var d;let o=K.useContext(Px),i=Cte("useRouteError"),a=kx("useRouteError");return o!==void 0?o:(d=i.errors)==null?void 0:d[a]}function Nte(){let{router:o}=bte("useNavigate"),i=kx("useNavigate"),a=K.useRef(!1);return A9(()=>{a.current=!0}),K.useCallback(async(f,y={})=>{Ol(a.current,w9),a.current&&(typeof f=="number"?o.navigate(f):await o.navigate(f,{fromRouteId:i,...y}))},[o,i])}var uG={};function N9(o,i,a){!i&&!uG[o]&&(uG[o]=!0,Ol(!1,a))}K.memo(Ote);function Ote({routes:o,future:i,state:a}){return I9(o,void 0,a,i)}function Dte({to:o,replace:i,state:a,relative:d}){mr(Ey(),"<Navigate> may be used only in the context of a <Router> component.");let{static:f}=K.useContext(Ll);Ol(!f,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:y}=K.useContext(Gd),{pathname:R}=$r(),w=qo(),N=Dx(o,Ox(y),R,d==="path"),O=JSON.stringify(N);return K.useEffect(()=>{w(JSON.parse(O),{replace:i,state:a,relative:d})},[w,O,d,i,a]),null}function ar(o){mr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Pte({basename:o="/",children:i=null,location:a,navigationType:d="POP",navigator:f,static:y=!1}){mr(!Ey(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let R=o.replace(/^\/*/,"/"),w=K.useMemo(()=>({basename:R,navigator:f,static:y,future:{}}),[R,f,y]);typeof a=="string"&&(a=_y(a));let{pathname:N="/",search:O="",hash:x="",state:G=null,key:W="default"}=a,ne=K.useMemo(()=>{let Q=eh(N,R);return Q==null?null:{location:{pathname:Q,search:O,hash:x,state:G,key:W},navigationType:d}},[R,N,O,x,G,W,d]);return Ol(ne!=null,`<Router basename="${R}"> is not able to match the URL "${N}${O}${x}" because it does not start with the basename, so the <Router> won't render anything.`),ne==null?null:K.createElement(Ll.Provider,{value:w},K.createElement(RR.Provider,{children:i,value:ne}))}function Lte({children:o,location:i}){return Ete(Uk(o),i)}function Uk(o,i=[]){let a=[];return K.Children.forEach(o,(d,f)=>{if(!K.isValidElement(d))return;let y=[...i,f];if(d.type===K.Fragment){a.push.apply(a,Uk(d.props.children,y));return}mr(d.type===ar,`[${typeof d.type=="string"?d.type:d.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),mr(!d.props.index||!d.props.children,"An index route cannot have child routes.");let R={id:d.props.id||y.join("-"),caseSensitive:d.props.caseSensitive,element:d.props.element,Component:d.props.Component,index:d.props.index,path:d.props.path,loader:d.props.loader,action:d.props.action,hydrateFallbackElement:d.props.hydrateFallbackElement,HydrateFallback:d.props.HydrateFallback,errorElement:d.props.errorElement,ErrorBoundary:d.props.ErrorBoundary,hasErrorBoundary:d.props.hasErrorBoundary===!0||d.props.ErrorBoundary!=null||d.props.errorElement!=null,shouldRevalidate:d.props.shouldRevalidate,handle:d.props.handle,lazy:d.props.lazy};d.props.children&&(R.children=Uk(d.props.children,y)),a.push(R)}),a}var c0="get",l0="application/x-www-form-urlencoded";function CI(o){return o!=null&&typeof o.tagName=="string"}function kte(o){return CI(o)&&o.tagName.toLowerCase()==="button"}function xte(o){return CI(o)&&o.tagName.toLowerCase()==="form"}function Mte(o){return CI(o)&&o.tagName.toLowerCase()==="input"}function Ute(o){return!!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)}function jte(o,i){return o.button===0&&(!i||i==="_self")&&!Ute(o)}var JA=null;function Vte(){if(JA===null)try{new FormData(document.createElement("form"),0),JA=!1}catch{JA=!0}return JA}var Fte=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function HL(o){return o!=null&&!Fte.has(o)?(Ol(!1,`"${o}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${l0}"`),null):o}function Bte(o,i){let a,d,f,y,R;if(xte(o)){let w=o.getAttribute("action");d=w?eh(w,i):null,a=o.getAttribute("method")||c0,f=HL(o.getAttribute("enctype"))||l0,y=new FormData(o)}else if(kte(o)||Mte(o)&&(o.type==="submit"||o.type==="image")){let w=o.form;if(w==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let N=o.getAttribute("formaction")||w.getAttribute("action");if(d=N?eh(N,i):null,a=o.getAttribute("formmethod")||w.getAttribute("method")||c0,f=HL(o.getAttribute("formenctype"))||HL(w.getAttribute("enctype"))||l0,y=new FormData(w,o),!Vte()){let{name:O,type:x,value:G}=o;if(x==="image"){let W=O?`${O}.`:"";y.append(`${W}x`,"0"),y.append(`${W}y`,"0")}else O&&y.append(O,G)}}else{if(CI(o))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');a=c0,d=null,f=l0,R=o}return y&&f==="text/plain"&&(R=y,y=void 0),{action:d,method:a.toLowerCase(),encType:f,formData:y,body:R}}function xx(o,i){if(o===!1||o===null||typeof o>"u")throw new Error(i)}async function Gte(o,i){if(o.id in i)return i[o.id];try{let a=await import(o.module);return i[o.id]=a,a}catch(a){return console.error(`Error loading route module \`${o.module}\`, reloading page...`),console.error(a),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Hte(o){return o==null?!1:o.href==null?o.rel==="preload"&&typeof o.imageSrcSet=="string"&&typeof o.imageSizes=="string":typeof o.rel=="string"&&typeof o.href=="string"}async function zte(o,i,a){let d=await Promise.all(o.map(async f=>{let y=i.routes[f.route.id];if(y){let R=await Gte(y,a);return R.links?R.links():[]}return[]}));return Yte(d.flat(1).filter(Hte).filter(f=>f.rel==="stylesheet"||f.rel==="preload").map(f=>f.rel==="stylesheet"?{...f,rel:"prefetch",as:"style"}:{...f,rel:"prefetch"}))}function hG(o,i,a,d,f,y){let R=(N,O)=>a[O]?N.route.id!==a[O].route.id:!0,w=(N,O)=>{var x;return a[O].pathname!==N.pathname||((x=a[O].route.path)==null?void 0:x.endsWith("*"))&&a[O].params["*"]!==N.params["*"]};return y==="assets"?i.filter((N,O)=>R(N,O)||w(N,O)):y==="data"?i.filter((N,O)=>{var G;let x=d.routes[N.route.id];if(!x||!x.hasLoader)return!1;if(R(N,O)||w(N,O))return!0;if(N.route.shouldRevalidate){let W=N.route.shouldRevalidate({currentUrl:new URL(f.pathname+f.search+f.hash,window.origin),currentParams:((G=a[0])==null?void 0:G.params)||{},nextUrl:new URL(o,window.origin),nextParams:N.params,defaultShouldRevalidate:!0});if(typeof W=="boolean")return W}return!0}):[]}function Wte(o,i,{includeHydrateFallback:a}={}){return qte(o.map(d=>{let f=i.routes[d.route.id];if(!f)return[];let y=[f.module];return f.clientActionModule&&(y=y.concat(f.clientActionModule)),f.clientLoaderModule&&(y=y.concat(f.clientLoaderModule)),a&&f.hydrateFallbackModule&&(y=y.concat(f.hydrateFallbackModule)),f.imports&&(y=y.concat(f.imports)),y}).flat(1))}function qte(o){return[...new Set(o)]}function Kte(o){let i={},a=Object.keys(o).sort();for(let d of a)i[d]=o[d];return i}function Yte(o,i){let a=new Set;return new Set(i),o.reduce((d,f)=>{let y=JSON.stringify(Kte(f));return a.has(y)||(a.add(y),d.push({key:y,link:f})),d},[])}function Xte(o,i){let a=typeof o=="string"?new URL(o,typeof window>"u"?"server://singlefetch/":window.location.origin):o;return a.pathname==="/"?a.pathname="_root.data":i&&eh(a.pathname,i)==="/"?a.pathname=`${i.replace(/\/$/,"")}/_root.data`:a.pathname=`${a.pathname.replace(/\/$/,"")}.data`,a}function O9(){let o=K.useContext(gy);return xx(o,"You must render this element inside a <DataRouterContext.Provider> element"),o}function Jte(){let o=K.useContext(bI);return xx(o,"You must render this element inside a <DataRouterStateContext.Provider> element"),o}var Mx=K.createContext(void 0);Mx.displayName="FrameworkContext";function D9(){let o=K.useContext(Mx);return xx(o,"You must render this element inside a <HydratedRouter> element"),o}function Qte(o,i){let a=K.useContext(Mx),[d,f]=K.useState(!1),[y,R]=K.useState(!1),{onFocus:w,onBlur:N,onMouseEnter:O,onMouseLeave:x,onTouchStart:G}=i,W=K.useRef(null);K.useEffect(()=>{if(o==="render"&&R(!0),o==="viewport"){let se=le=>{le.forEach(ce=>{R(ce.isIntersecting)})},te=new IntersectionObserver(se,{threshold:.5});return W.current&&te.observe(W.current),()=>{te.disconnect()}}},[o]),K.useEffect(()=>{if(d){let se=setTimeout(()=>{R(!0)},100);return()=>{clearTimeout(se)}}},[d]);let ne=()=>{f(!0)},Q=()=>{f(!1),R(!1)};return a?o!=="intent"?[y,W,{}]:[y,W,{onFocus:FT(w,ne),onBlur:FT(N,Q),onMouseEnter:FT(O,ne),onMouseLeave:FT(x,Q),onTouchStart:FT(G,ne)}]:[!1,W,{}]}function FT(o,i){return a=>{o&&o(a),a.defaultPrevented||i(a)}}function $te({page:o,...i}){let{router:a}=O9(),d=K.useMemo(()=>S9(a.routes,o,a.basename),[a.routes,o,a.basename]);return d?K.createElement(ene,{page:o,matches:d,...i}):null}function Zte(o){let{manifest:i,routeModules:a}=D9(),[d,f]=K.useState([]);return K.useEffect(()=>{let y=!1;return zte(o,i,a).then(R=>{y||f(R)}),()=>{y=!0}},[o,i,a]),d}function ene({page:o,matches:i,...a}){let d=$r(),{manifest:f,routeModules:y}=D9(),{basename:R}=O9(),{loaderData:w,matches:N}=Jte(),O=K.useMemo(()=>hG(o,i,N,f,d,"data"),[o,i,N,f,d]),x=K.useMemo(()=>hG(o,i,N,f,d,"assets"),[o,i,N,f,d]),G=K.useMemo(()=>{if(o===d.pathname+d.search+d.hash)return[];let Q=new Set,se=!1;if(i.forEach(le=>{var me;let ce=f.routes[le.route.id];!ce||!ce.hasLoader||(!O.some(Ce=>Ce.route.id===le.route.id)&&le.route.id in w&&((me=y[le.route.id])!=null&&me.shouldRevalidate)||ce.hasClientLoader?se=!0:Q.add(le.route.id))}),Q.size===0)return[];let te=Xte(o,R);return se&&Q.size>0&&te.searchParams.set("_routes",i.filter(le=>Q.has(le.route.id)).map(le=>le.route.id).join(",")),[te.pathname+te.search]},[R,w,d,f,O,i,o,y]),W=K.useMemo(()=>Wte(x,f),[x,f]),ne=Zte(x);return K.createElement(K.Fragment,null,G.map(Q=>K.createElement("link",{key:Q,rel:"prefetch",as:"fetch",href:Q,...a})),W.map(Q=>K.createElement("link",{key:Q,rel:"modulepreload",href:Q,...a})),ne.map(({key:Q,link:se})=>K.createElement("link",{key:Q,...se})))}function tne(...o){return i=>{o.forEach(a=>{typeof a=="function"?a(i):a!=null&&(a.current=i)})}}var P9=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{P9&&(window.__reactRouterVersion="7.5.0")}catch{}function nne({basename:o,children:i,window:a}){let d=K.useRef();d.current==null&&(d.current=zee({window:a,v5Compat:!0}));let f=d.current,[y,R]=K.useState({action:f.action,location:f.location}),w=K.useCallback(N=>{K.startTransition(()=>R(N))},[R]);return K.useLayoutEffect(()=>f.listen(w),[f,w]),K.createElement(Pte,{basename:o,children:i,location:y.location,navigationType:y.action,navigator:f})}var L9=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Wt=K.forwardRef(function({onClick:i,discover:a="render",prefetch:d="none",relative:f,reloadDocument:y,replace:R,state:w,target:N,to:O,preventScrollReset:x,viewTransition:G,...W},ne){let{basename:Q}=K.useContext(Ll),se=typeof O=="string"&&L9.test(O),te,le=!1;if(typeof O=="string"&&se&&(te=O,P9))try{let $=new URL(window.location.href),fe=O.startsWith("//")?new URL($.protocol+O):new URL(O),ve=eh(fe.pathname,Q);fe.origin===$.origin&&ve!=null?O=ve+fe.search+fe.hash:le=!0}catch{Ol(!1,`<Link to="${O}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let ce=_te(O,{relative:f}),[me,Ce,_e]=Qte(d,W),ze=ane(O,{replace:R,state:w,target:N,preventScrollReset:x,relative:f,viewTransition:G});function Z($){i&&i($),$.defaultPrevented||ze($)}let J=K.createElement("a",{...W,..._e,href:te||ce,onClick:le||y?i:Z,ref:tne(ne,Ce),target:N,"data-discover":!se&&a==="render"?"true":void 0});return me&&!se?K.createElement(K.Fragment,null,J,K.createElement($te,{page:ce})):J});Wt.displayName="Link";var ine=K.forwardRef(function({"aria-current":i="page",caseSensitive:a=!1,className:d="",end:f=!1,style:y,to:R,viewTransition:w,children:N,...O},x){let G=bR(R,{relative:O.relative}),W=$r(),ne=K.useContext(bI),{navigator:Q,basename:se}=K.useContext(Ll),te=ne!=null&&une(G)&&w===!0,le=Q.encodeLocation?Q.encodeLocation(G).pathname:G.pathname,ce=W.pathname,me=ne&&ne.navigation&&ne.navigation.location?ne.navigation.location.pathname:null;a||(ce=ce.toLowerCase(),me=me?me.toLowerCase():null,le=le.toLowerCase()),me&&se&&(me=eh(me,se)||me);const Ce=le!=="/"&&le.endsWith("/")?le.length-1:le.length;let _e=ce===le||!f&&ce.startsWith(le)&&ce.charAt(Ce)==="/",ze=me!=null&&(me===le||!f&&me.startsWith(le)&&me.charAt(le.length)==="/"),Z={isActive:_e,isPending:ze,isTransitioning:te},J=_e?i:void 0,$;typeof d=="function"?$=d(Z):$=[d,_e?"active":null,ze?"pending":null,te?"transitioning":null].filter(Boolean).join(" ");let fe=typeof y=="function"?y(Z):y;return K.createElement(Wt,{...O,"aria-current":J,className:$,ref:x,style:fe,to:R,viewTransition:w},typeof N=="function"?N(Z):N)});ine.displayName="NavLink";var rne=K.forwardRef(({discover:o="render",fetcherKey:i,navigate:a,reloadDocument:d,replace:f,state:y,method:R=c0,action:w,onSubmit:N,relative:O,preventScrollReset:x,viewTransition:G,...W},ne)=>{let Q=lne(),se=dne(w,{relative:O}),te=R.toLowerCase()==="get"?"get":"post",le=typeof w=="string"&&L9.test(w),ce=me=>{if(N&&N(me),me.defaultPrevented)return;me.preventDefault();let Ce=me.nativeEvent.submitter,_e=(Ce==null?void 0:Ce.getAttribute("formmethod"))||R;Q(Ce||me.currentTarget,{fetcherKey:i,method:_e,navigate:a,replace:f,state:y,relative:O,preventScrollReset:x,viewTransition:G})};return K.createElement("form",{ref:ne,method:te,action:se,onSubmit:d?N:ce,...W,"data-discover":!le&&o==="render"?"true":void 0})});rne.displayName="Form";function sne(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function k9(o){let i=K.useContext(gy);return mr(i,sne(o)),i}function ane(o,{target:i,replace:a,state:d,preventScrollReset:f,relative:y,viewTransition:R}={}){let w=qo(),N=$r(),O=bR(o,{relative:y});return K.useCallback(x=>{if(jte(x,i)){x.preventDefault();let G=a!==void 0?a:oR(N)===oR(O);w(o,{replace:G,state:d,preventScrollReset:f,relative:y,viewTransition:R})}},[N,w,O,a,d,i,o,f,y,R])}var one=0,cne=()=>`__${String(++one)}__`;function lne(){let{router:o}=k9("useSubmit"),{basename:i}=K.useContext(Ll),a=Ate();return K.useCallback(async(d,f={})=>{let{action:y,method:R,encType:w,formData:N,body:O}=Bte(d,i);if(f.navigate===!1){let x=f.fetcherKey||cne();await o.fetch(x,a,f.action||y,{preventScrollReset:f.preventScrollReset,formData:N,body:O,formMethod:f.method||R,formEncType:f.encType||w,flushSync:f.flushSync})}else await o.navigate(f.action||y,{preventScrollReset:f.preventScrollReset,formData:N,body:O,formMethod:f.method||R,formEncType:f.encType||w,replace:f.replace,state:f.state,fromRouteId:a,flushSync:f.flushSync,viewTransition:f.viewTransition})},[o,i,a])}function dne(o,{relative:i}={}){let{basename:a}=K.useContext(Ll),d=K.useContext(Gd);mr(d,"useFormAction must be used inside a RouteContext");let[f]=d.matches.slice(-1),y={...bR(o||".",{relative:i})},R=$r();if(o==null){y.search=R.search;let w=new URLSearchParams(y.search),N=w.getAll("index");if(N.some(x=>x==="")){w.delete("index"),N.filter(G=>G).forEach(G=>w.append("index",G));let x=w.toString();y.search=x?`?${x}`:""}}return(!o||o===".")&&f.route.index&&(y.search=y.search?y.search.replace(/^\?/,"?index&"):"?index"),a!=="/"&&(y.pathname=y.pathname==="/"?a:Ju([a,y.pathname])),oR(y)}function une(o,i={}){let a=K.useContext(C9);mr(a!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:d}=k9("useViewTransitionState"),f=bR(o,{relative:i.relative});if(!a.isTransitioning)return!1;let y=eh(a.currentLocation.pathname,d)||a.currentLocation.pathname,R=eh(a.nextLocation.pathname,d)||a.nextLocation.pathname;return Y0(f.pathname,R)!=null||Y0(f.pathname,y)!=null}new TextEncoder;var hne=v9();const ey=TR(hne);var zL={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var pG;function pne(){return pG||(pG=1,function(o){(function(){var i={}.hasOwnProperty;function a(){for(var y="",R=0;R<arguments.length;R++){var w=arguments[R];w&&(y=f(y,d(w)))}return y}function d(y){if(typeof y=="string"||typeof y=="number")return y;if(typeof y!="object")return"";if(Array.isArray(y))return a.apply(null,y);if(y.toString!==Object.prototype.toString&&!y.toString.toString().includes("[native code]"))return y.toString();var R="";for(var w in y)i.call(y,w)&&y[w]&&(R=f(R,w));return R}function f(y,R){return R?y?y+" "+R:y+R:y}o.exports?(a.default=a,o.exports=a):window.classNames=a})()}(zL)),zL.exports}var fne=pne();const Wi=TR(fne);function mne(o,i){if(o==null)return{};var a={};for(var d in o)if({}.hasOwnProperty.call(o,d)){if(i.indexOf(d)!==-1)continue;a[d]=o[d]}return a}function jk(o,i){return jk=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,d){return a.__proto__=d,a},jk(o,i)}function _ne(o,i){o.prototype=Object.create(i.prototype),o.prototype.constructor=o,jk(o,i)}const gne=["xxl","xl","lg","md","sm","xs"],Ene="xs",CR=K.createContext({prefixes:{},breakpoints:gne,minBreakpoint:Ene}),{Consumer:$pe,Provider:Zpe}=CR;function Jr(o,i){const{prefixes:a}=K.useContext(CR);return o||a[i]||i}function x9(){const{breakpoints:o}=K.useContext(CR);return o}function M9(){const{minBreakpoint:o}=K.useContext(CR);return o}function yne(){const{dir:o}=K.useContext(CR);return o==="rtl"}function wI(o){return o&&o.ownerDocument||document}function vne(o){var i=wI(o);return i&&i.defaultView||window}function Sne(o,i){return vne(o).getComputedStyle(o,i)}var Tne=/([A-Z])/g;function Rne(o){return o.replace(Tne,"-$1").toLowerCase()}var bne=/^ms-/;function QA(o){return Rne(o).replace(bne,"-ms-")}var Cne=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function wne(o){return!!(o&&Cne.test(o))}function Zm(o,i){var a="",d="";if(typeof i=="string")return o.style.getPropertyValue(QA(i))||Sne(o).getPropertyValue(QA(i));Object.keys(i).forEach(function(f){var y=i[f];!y&&y!==0?o.style.removeProperty(QA(f)):wne(f)?d+=f+"("+y+") ":a+=QA(f)+": "+y+";"}),d&&(a+="transform: "+d+";"),o.style.cssText+=";"+a}var WL={exports:{}},qL,fG;function Ane(){if(fG)return qL;fG=1;var o="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return qL=o,qL}var KL,mG;function Ine(){if(mG)return KL;mG=1;var o=Ane();function i(){}function a(){}return a.resetWarningCache=i,KL=function(){function d(R,w,N,O,x,G){if(G!==o){var W=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw W.name="Invariant Violation",W}}d.isRequired=d;function f(){return d}var y={array:d,bigint:d,bool:d,func:d,number:d,object:d,string:d,symbol:d,any:d,arrayOf:f,element:d,elementType:d,instanceOf:f,node:d,objectOf:f,oneOf:f,oneOfType:f,shape:f,exact:f,checkPropTypes:a,resetWarningCache:i};return y.PropTypes=y,y},KL}var _G;function Nne(){return _G||(_G=1,WL.exports=Ine()()),WL.exports}var One=Nne();const Qu=TR(One),gG={disabled:!1},U9=Hn.createContext(null);var Dne=function(i){return i.scrollTop},HT="unmounted",Wm="exited",Dp="entering",Xm="entered",Vk="exiting",oh=function(o){_ne(i,o);function i(d,f){var y;y=o.call(this,d,f)||this;var R=f,w=R&&!R.isMounting?d.enter:d.appear,N;return y.appearStatus=null,d.in?w?(N=Wm,y.appearStatus=Dp):N=Xm:d.unmountOnExit||d.mountOnEnter?N=HT:N=Wm,y.state={status:N},y.nextCallback=null,y}i.getDerivedStateFromProps=function(f,y){var R=f.in;return R&&y.status===HT?{status:Wm}:null};var a=i.prototype;return a.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},a.componentDidUpdate=function(f){var y=null;if(f!==this.props){var R=this.state.status;this.props.in?R!==Dp&&R!==Xm&&(y=Dp):(R===Dp||R===Xm)&&(y=Vk)}this.updateStatus(!1,y)},a.componentWillUnmount=function(){this.cancelNextCallback()},a.getTimeouts=function(){var f=this.props.timeout,y,R,w;return y=R=w=f,f!=null&&typeof f!="number"&&(y=f.exit,R=f.enter,w=f.appear!==void 0?f.appear:R),{exit:y,enter:R,appear:w}},a.updateStatus=function(f,y){if(f===void 0&&(f=!1),y!==null)if(this.cancelNextCallback(),y===Dp){if(this.props.unmountOnExit||this.props.mountOnEnter){var R=this.props.nodeRef?this.props.nodeRef.current:ey.findDOMNode(this);R&&Dne(R)}this.performEnter(f)}else this.performExit();else this.props.unmountOnExit&&this.state.status===Wm&&this.setState({status:HT})},a.performEnter=function(f){var y=this,R=this.props.enter,w=this.context?this.context.isMounting:f,N=this.props.nodeRef?[w]:[ey.findDOMNode(this),w],O=N[0],x=N[1],G=this.getTimeouts(),W=w?G.appear:G.enter;if(!f&&!R||gG.disabled){this.safeSetState({status:Xm},function(){y.props.onEntered(O)});return}this.props.onEnter(O,x),this.safeSetState({status:Dp},function(){y.props.onEntering(O,x),y.onTransitionEnd(W,function(){y.safeSetState({status:Xm},function(){y.props.onEntered(O,x)})})})},a.performExit=function(){var f=this,y=this.props.exit,R=this.getTimeouts(),w=this.props.nodeRef?void 0:ey.findDOMNode(this);if(!y||gG.disabled){this.safeSetState({status:Wm},function(){f.props.onExited(w)});return}this.props.onExit(w),this.safeSetState({status:Vk},function(){f.props.onExiting(w),f.onTransitionEnd(R.exit,function(){f.safeSetState({status:Wm},function(){f.props.onExited(w)})})})},a.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},a.safeSetState=function(f,y){y=this.setNextCallback(y),this.setState(f,y)},a.setNextCallback=function(f){var y=this,R=!0;return this.nextCallback=function(w){R&&(R=!1,y.nextCallback=null,f(w))},this.nextCallback.cancel=function(){R=!1},this.nextCallback},a.onTransitionEnd=function(f,y){this.setNextCallback(y);var R=this.props.nodeRef?this.props.nodeRef.current:ey.findDOMNode(this),w=f==null&&!this.props.addEndListener;if(!R||w){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var N=this.props.nodeRef?[this.nextCallback]:[R,this.nextCallback],O=N[0],x=N[1];this.props.addEndListener(O,x)}f!=null&&setTimeout(this.nextCallback,f)},a.render=function(){var f=this.state.status;if(f===HT)return null;var y=this.props,R=y.children;y.in,y.mountOnEnter,y.unmountOnExit,y.appear,y.enter,y.exit,y.timeout,y.addEndListener,y.onEnter,y.onEntering,y.onEntered,y.onExit,y.onExiting,y.onExited,y.nodeRef;var w=mne(y,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return Hn.createElement(U9.Provider,{value:null},typeof R=="function"?R(f,w):Hn.cloneElement(Hn.Children.only(R),w))},i}(Hn.Component);oh.contextType=U9;oh.propTypes={};function qE(){}oh.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:qE,onEntering:qE,onEntered:qE,onExit:qE,onExiting:qE,onExited:qE};oh.UNMOUNTED=HT;oh.EXITED=Wm;oh.ENTERING=Dp;oh.ENTERED=Xm;oh.EXITING=Vk;function Pne(o){return o.code==="Escape"||o.keyCode===27}function Lne(){const o=K.version.split(".");return{major:+o[0],minor:+o[1],patch:+o[2]}}function AI(o){if(!o||typeof o=="function")return null;const{major:i}=Lne();return i>=19?o.props.ref:o.ref}const yy=!!(typeof window<"u"&&window.document&&window.document.createElement);var Fk=!1,Bk=!1;try{var YL={get passive(){return Fk=!0},get once(){return Bk=Fk=!0}};yy&&(window.addEventListener("test",YL,YL),window.removeEventListener("test",YL,!0))}catch{}function j9(o,i,a,d){if(d&&typeof d!="boolean"&&!Bk){var f=d.once,y=d.capture,R=a;!Bk&&f&&(R=a.__once||function w(N){this.removeEventListener(i,w,y),a.call(this,N)},a.__once=R),o.addEventListener(i,R,Fk?d:y)}o.addEventListener(i,a,d)}function Gk(o,i,a,d){var f=d&&typeof d!="boolean"?d.capture:d;o.removeEventListener(i,a,f),a.__once&&o.removeEventListener(i,a.__once,f)}function X0(o,i,a,d){return j9(o,i,a,d),function(){Gk(o,i,a,d)}}function kne(o,i,a,d){if(d===void 0&&(d=!0),o){var f=document.createEvent("HTMLEvents");f.initEvent(i,a,d),o.dispatchEvent(f)}}function xne(o){var i=Zm(o,"transitionDuration")||"",a=i.indexOf("ms")===-1?1e3:1;return parseFloat(i)*a}function Mne(o,i,a){a===void 0&&(a=5);var d=!1,f=setTimeout(function(){d||kne(o,"transitionend",!0)},i+a),y=X0(o,"transitionend",function(){d=!0},{once:!0});return function(){clearTimeout(f),y()}}function V9(o,i,a,d){a==null&&(a=xne(o)||0);var f=Mne(o,a,d),y=X0(o,"transitionend",i);return function(){f(),y()}}function EG(o,i){const a=Zm(o,i)||"",d=a.indexOf("ms")===-1?1e3:1;return parseFloat(a)*d}function Une(o,i){const a=EG(o,"transitionDuration"),d=EG(o,"transitionDelay"),f=V9(o,y=>{y.target===o&&(f(),i(y))},a+d)}function jne(o){o.offsetHeight}const yG=o=>!o||typeof o=="function"?o:i=>{o.current=i};function Vne(o,i){const a=yG(o),d=yG(i);return f=>{a&&a(f),d&&d(f)}}function F9(o,i){return K.useMemo(()=>Vne(o,i),[o,i])}function Fne(o){return o&&"setState"in o?ey.findDOMNode(o):o??null}const Bne=Hn.forwardRef(({onEnter:o,onEntering:i,onEntered:a,onExit:d,onExiting:f,onExited:y,addEndListener:R,children:w,childRef:N,...O},x)=>{const G=K.useRef(null),W=F9(G,N),ne=ze=>{W(Fne(ze))},Q=ze=>Z=>{ze&&G.current&&ze(G.current,Z)},se=K.useCallback(Q(o),[o]),te=K.useCallback(Q(i),[i]),le=K.useCallback(Q(a),[a]),ce=K.useCallback(Q(d),[d]),me=K.useCallback(Q(f),[f]),Ce=K.useCallback(Q(y),[y]),_e=K.useCallback(Q(R),[R]);return E.jsx(oh,{ref:x,...O,onEnter:se,onEntered:le,onEntering:te,onExit:ce,onExited:Ce,onExiting:me,addEndListener:_e,nodeRef:G,children:typeof w=="function"?(ze,Z)=>w(ze,{...Z,ref:ne}):Hn.cloneElement(w,{ref:ne})})});function Gne(o){const i=K.useRef(o);return K.useEffect(()=>{i.current=o},[o]),i}function Hk(o){const i=Gne(o);return K.useCallback(function(...a){return i.current&&i.current(...a)},[i])}const Hne=o=>K.forwardRef((i,a)=>E.jsx("div",{...i,ref:a,className:Wi(i.className,o)}));function zne(o){const i=K.useRef(o);return K.useEffect(()=>{i.current=o},[o]),i}function Jm(o){const i=zne(o);return K.useCallback(function(...a){return i.current&&i.current(...a)},[i])}function Wne(){const o=K.useRef(!0),i=K.useRef(()=>o.current);return K.useEffect(()=>(o.current=!0,()=>{o.current=!1}),[]),i.current}function qne(o){const i=K.useRef(null);return K.useEffect(()=>{i.current=o}),i.current}const Kne=typeof global<"u"&&global.navigator&&global.navigator.product==="ReactNative",Yne=typeof document<"u",vG=Yne||Kne?K.useLayoutEffect:K.useEffect,Xne=["as","disabled"];function Jne(o,i){if(o==null)return{};var a={};for(var d in o)if({}.hasOwnProperty.call(o,d)){if(i.indexOf(d)>=0)continue;a[d]=o[d]}return a}function Qne(o){return!o||o.trim()==="#"}function B9({tagName:o,disabled:i,href:a,target:d,rel:f,role:y,onClick:R,tabIndex:w=0,type:N}){o||(a!=null||d!=null||f!=null?o="a":o="button");const O={tagName:o};if(o==="button")return[{type:N||"button",disabled:i},O];const x=W=>{if((i||o==="a"&&Qne(a))&&W.preventDefault(),i){W.stopPropagation();return}R==null||R(W)},G=W=>{W.key===" "&&(W.preventDefault(),x(W))};return o==="a"&&(a||(a="#"),i&&(a=void 0)),[{role:y??"button",disabled:void 0,tabIndex:i?void 0:w,href:a,target:o==="a"?d:void 0,"aria-disabled":i||void 0,rel:o==="a"?f:void 0,onClick:x,onKeyDown:G},O]}const $ne=K.forwardRef((o,i)=>{let{as:a,disabled:d}=o,f=Jne(o,Xne);const[y,{tagName:R}]=B9(Object.assign({tagName:a,disabled:d},f));return E.jsx(R,Object.assign({},f,y,{ref:i}))});$ne.displayName="Button";const Zne={[Dp]:"show",[Xm]:"show"},Ux=K.forwardRef(({className:o,children:i,transitionClasses:a={},onEnter:d,...f},y)=>{const R={in:!1,timeout:300,mountOnEnter:!1,unmountOnExit:!1,appear:!1,...f},w=K.useCallback((N,O)=>{jne(N),d==null||d(N,O)},[d]);return E.jsx(Bne,{ref:y,addEndListener:Une,...R,onEnter:w,childRef:AI(i),children:(N,O)=>K.cloneElement(i,{...O,className:Wi("fade",o,i.props.className,Zne[N],a[N])})})});Ux.displayName="Fade";const eie={"aria-label":Qu.string,onClick:Qu.func,variant:Qu.oneOf(["white"])},jx=K.forwardRef(({className:o,variant:i,"aria-label":a="Close",...d},f)=>E.jsx("button",{ref:f,type:"button",className:Wi("btn-close",i&&`btn-close-${i}`,o),"aria-label":a,...d}));jx.displayName="CloseButton";jx.propTypes=eie;const vy=K.forwardRef(({as:o,bsPrefix:i,variant:a="primary",size:d,active:f=!1,disabled:y=!1,className:R,...w},N)=>{const O=Jr(i,"btn"),[x,{tagName:G}]=B9({tagName:o,disabled:y,...w}),W=G;return E.jsx(W,{...x,...w,ref:N,disabled:y,className:Wi(R,O,f&&"active",a&&`${O}-${a}`,d&&`${O}-${d}`,w.href&&y&&"disabled")})});vy.displayName="Button";function tie(o){const i=K.useRef(o);return i.current=o,i}function nie(o){const i=tie(o);K.useEffect(()=>()=>i.current(),[])}function iie(o,i){return K.Children.toArray(o).some(a=>K.isValidElement(a)&&a.type===i)}function rie({as:o,bsPrefix:i,className:a,...d}){i=Jr(i,"col");const f=x9(),y=M9(),R=[],w=[];return f.forEach(N=>{const O=d[N];delete d[N];let x,G,W;typeof O=="object"&&O!=null?{span:x,offset:G,order:W}=O:x=O;const ne=N!==y?`-${N}`:"";x&&R.push(x===!0?`${i}${ne}`:`${i}${ne}-${x}`),W!=null&&w.push(`order${ne}-${W}`),G!=null&&w.push(`offset${ne}-${G}`)}),[{...d,className:Wi(a,...R,...w)},{as:o,bsPrefix:i,spans:R}]}const J0=K.forwardRef((o,i)=>{const[{className:a,...d},{as:f="div",bsPrefix:y,spans:R}]=rie(o);return E.jsx(f,{...d,ref:i,className:Wi(a,!R.length&&y)})});J0.displayName="Col";const G9=K.forwardRef(({bsPrefix:o,fluid:i=!1,as:a="div",className:d,...f},y)=>{const R=Jr(o,"container"),w=typeof i=="string"?`-${i}`:"-fluid";return E.jsx(a,{ref:y,...f,className:Wi(d,i?`${R}${w}`:R)})});G9.displayName="Container";var sie=Function.prototype.bind.call(Function.prototype.call,[].slice);function KE(o,i){return sie(o.querySelectorAll(i))}function SG(o,i){if(o.contains)return o.contains(i);if(o.compareDocumentPosition)return o===i||!!(o.compareDocumentPosition(i)&16)}const aie="data-rr-ui-";function oie(o){return`${aie}${o}`}const H9=K.createContext(yy?window:void 0);H9.Provider;function Vx(){return K.useContext(H9)}const cie={type:Qu.string,tooltip:Qu.bool,as:Qu.elementType},II=K.forwardRef(({as:o="div",className:i,type:a="valid",tooltip:d=!1,...f},y)=>E.jsx(o,{...f,ref:y,className:Wi(i,`${a}-${d?"tooltip":"feedback"}`)}));II.displayName="Feedback";II.propTypes=cie;const th=K.createContext({}),Fx=K.forwardRef(({id:o,bsPrefix:i,className:a,type:d="checkbox",isValid:f=!1,isInvalid:y=!1,as:R="input",...w},N)=>{const{controlId:O}=K.useContext(th);return i=Jr(i,"form-check-input"),E.jsx(R,{...w,ref:N,type:d,id:o||O,className:Wi(a,i,f&&"is-valid",y&&"is-invalid")})});Fx.displayName="FormCheckInput";const Q0=K.forwardRef(({bsPrefix:o,className:i,htmlFor:a,...d},f)=>{const{controlId:y}=K.useContext(th);return o=Jr(o,"form-check-label"),E.jsx("label",{...d,ref:f,htmlFor:a||y,className:Wi(i,o)})});Q0.displayName="FormCheckLabel";const z9=K.forwardRef(({id:o,bsPrefix:i,bsSwitchPrefix:a,inline:d=!1,reverse:f=!1,disabled:y=!1,isValid:R=!1,isInvalid:w=!1,feedbackTooltip:N=!1,feedback:O,feedbackType:x,className:G,style:W,title:ne="",type:Q="checkbox",label:se,children:te,as:le="input",...ce},me)=>{i=Jr(i,"form-check"),a=Jr(a,"form-switch");const{controlId:Ce}=K.useContext(th),_e=K.useMemo(()=>({controlId:o||Ce}),[Ce,o]),ze=!te&&se!=null&&se!==!1||iie(te,Q0),Z=E.jsx(Fx,{...ce,type:Q==="switch"?"checkbox":Q,ref:me,isValid:R,isInvalid:w,disabled:y,as:le});return E.jsx(th.Provider,{value:_e,children:E.jsx("div",{style:W,className:Wi(G,ze&&i,d&&`${i}-inline`,f&&`${i}-reverse`,Q==="switch"&&a),children:te||E.jsxs(E.Fragment,{children:[Z,ze&&E.jsx(Q0,{title:ne,children:se}),O&&E.jsx(II,{type:x,tooltip:N,children:O})]})})})});z9.displayName="FormCheck";const $0=Object.assign(z9,{Input:Fx,Label:Q0}),W9=K.forwardRef(({bsPrefix:o,type:i,size:a,htmlSize:d,id:f,className:y,isValid:R=!1,isInvalid:w=!1,plaintext:N,readOnly:O,as:x="input",...G},W)=>{const{controlId:ne}=K.useContext(th);return o=Jr(o,"form-control"),E.jsx(x,{...G,type:i,size:d,ref:W,readOnly:O,id:f||ne,className:Wi(y,N?`${o}-plaintext`:o,a&&`${o}-${a}`,i==="color"&&`${o}-color`,R&&"is-valid",w&&"is-invalid")})});W9.displayName="FormControl";const lie=Object.assign(W9,{Feedback:II}),q9=K.forwardRef(({className:o,bsPrefix:i,as:a="div",...d},f)=>(i=Jr(i,"form-floating"),E.jsx(a,{ref:f,className:Wi(o,i),...d})));q9.displayName="FormFloating";const Bx=K.forwardRef(({controlId:o,as:i="div",...a},d)=>{const f=K.useMemo(()=>({controlId:o}),[o]);return E.jsx(th.Provider,{value:f,children:E.jsx(i,{...a,ref:d})})});Bx.displayName="FormGroup";const K9=K.forwardRef(({as:o="label",bsPrefix:i,column:a=!1,visuallyHidden:d=!1,className:f,htmlFor:y,...R},w)=>{const{controlId:N}=K.useContext(th);i=Jr(i,"form-label");let O="col-form-label";typeof a=="string"&&(O=`${O} ${O}-${a}`);const x=Wi(f,i,d&&"visually-hidden",a&&O);return y=y||N,a?E.jsx(J0,{ref:w,as:"label",className:x,htmlFor:y,...R}):E.jsx(o,{ref:w,className:x,htmlFor:y,...R})});K9.displayName="FormLabel";const Y9=K.forwardRef(({bsPrefix:o,className:i,id:a,...d},f)=>{const{controlId:y}=K.useContext(th);return o=Jr(o,"form-range"),E.jsx("input",{...d,type:"range",ref:f,className:Wi(i,o),id:a||y})});Y9.displayName="FormRange";const X9=K.forwardRef(({bsPrefix:o,size:i,htmlSize:a,className:d,isValid:f=!1,isInvalid:y=!1,id:R,...w},N)=>{const{controlId:O}=K.useContext(th);return o=Jr(o,"form-select"),E.jsx("select",{...w,size:a,ref:N,className:Wi(d,o,i&&`${o}-${i}`,f&&"is-valid",y&&"is-invalid"),id:R||O})});X9.displayName="FormSelect";const J9=K.forwardRef(({bsPrefix:o,className:i,as:a="small",muted:d,...f},y)=>(o=Jr(o,"form-text"),E.jsx(a,{...f,ref:y,className:Wi(i,o,d&&"text-muted")})));J9.displayName="FormText";const Q9=K.forwardRef((o,i)=>E.jsx($0,{...o,ref:i,type:"switch"}));Q9.displayName="Switch";const die=Object.assign(Q9,{Input:$0.Input,Label:$0.Label}),$9=K.forwardRef(({bsPrefix:o,className:i,children:a,controlId:d,label:f,...y},R)=>(o=Jr(o,"form-floating"),E.jsxs(Bx,{ref:R,className:Wi(i,o),controlId:d,...y,children:[a,E.jsx("label",{htmlFor:d,children:f})]})));$9.displayName="FloatingLabel";const uie={_ref:Qu.any,validated:Qu.bool,as:Qu.elementType},Gx=K.forwardRef(({className:o,validated:i,as:a="form",...d},f)=>E.jsx(a,{...d,ref:f,className:Wi(o,i&&"was-validated")}));Gx.displayName="Form";Gx.propTypes=uie;const XL=Object.assign(Gx,{Group:Bx,Control:lie,Floating:q9,Check:$0,Switch:die,Label:K9,Text:J9,Range:Y9,Select:X9,FloatingLabel:$9}),TG=o=>!o||typeof o=="function"?o:i=>{o.current=i};function hie(o,i){const a=TG(o),d=TG(i);return f=>{a&&a(f),d&&d(f)}}function Hx(o,i){return K.useMemo(()=>hie(o,i),[o,i])}var $A;function RG(o){if((!$A&&$A!==0||o)&&yy){var i=document.createElement("div");i.style.position="absolute",i.style.top="-9999px",i.style.width="50px",i.style.height="50px",i.style.overflow="scroll",document.body.appendChild(i),$A=i.offsetWidth-i.clientWidth,document.body.removeChild(i)}return $A}function pie(){return K.useState(null)}function JL(o){o===void 0&&(o=wI());try{var i=o.activeElement;return!i||!i.nodeName?null:i}catch{return o.body}}function fie(o){const i=K.useRef(o);return i.current=o,i}function mie(o){const i=fie(o);K.useEffect(()=>()=>i.current(),[])}function _ie(o=document){const i=o.defaultView;return Math.abs(i.innerWidth-o.documentElement.clientWidth)}const bG=oie("modal-open");class zx{constructor({ownerDocument:i,handleContainerOverflow:a=!0,isRTL:d=!1}={}){this.handleContainerOverflow=a,this.isRTL=d,this.modals=[],this.ownerDocument=i}getScrollbarWidth(){return _ie(this.ownerDocument)}getElement(){return(this.ownerDocument||document).body}setModalAttributes(i){}removeModalAttributes(i){}setContainerStyle(i){const a={overflow:"hidden"},d=this.isRTL?"paddingLeft":"paddingRight",f=this.getElement();i.style={overflow:f.style.overflow,[d]:f.style[d]},i.scrollBarWidth&&(a[d]=`${parseInt(Zm(f,d)||"0",10)+i.scrollBarWidth}px`),f.setAttribute(bG,""),Zm(f,a)}reset(){[...this.modals].forEach(i=>this.remove(i))}removeContainerStyle(i){const a=this.getElement();a.removeAttribute(bG),Object.assign(a.style,i.style)}add(i){let a=this.modals.indexOf(i);return a!==-1||(a=this.modals.length,this.modals.push(i),this.setModalAttributes(i),a!==0)||(this.state={scrollBarWidth:this.getScrollbarWidth(),style:{}},this.handleContainerOverflow&&this.setContainerStyle(this.state)),a}remove(i){const a=this.modals.indexOf(i);a!==-1&&(this.modals.splice(a,1),!this.modals.length&&this.handleContainerOverflow&&this.removeContainerStyle(this.state),this.removeModalAttributes(i))}isTopModal(i){return!!this.modals.length&&this.modals[this.modals.length-1]===i}}const QL=(o,i)=>yy?o==null?(i||wI()).body:(typeof o=="function"&&(o=o()),o&&"current"in o&&(o=o.current),o&&("nodeType"in o||o.getBoundingClientRect)?o:null):null;function gie(o,i){const a=Vx(),[d,f]=K.useState(()=>QL(o,a==null?void 0:a.document));if(!d){const y=QL(o);y&&f(y)}return K.useEffect(()=>{},[i,d]),K.useEffect(()=>{const y=QL(o);y!==d&&f(y)},[o,d]),d}function Eie({children:o,in:i,onExited:a,mountOnEnter:d,unmountOnExit:f}){const y=K.useRef(null),R=K.useRef(i),w=Jm(a);K.useEffect(()=>{i?R.current=!0:w(y.current)},[i,w]);const N=Hx(y,AI(o)),O=K.cloneElement(o,{ref:N});return i?O:f||!R.current&&d?null:O}const yie=["onEnter","onEntering","onEntered","onExit","onExiting","onExited","addEndListener","children"];function vie(o,i){if(o==null)return{};var a={};for(var d in o)if({}.hasOwnProperty.call(o,d)){if(i.indexOf(d)>=0)continue;a[d]=o[d]}return a}function Sie(o){let{onEnter:i,onEntering:a,onEntered:d,onExit:f,onExiting:y,onExited:R,addEndListener:w,children:N}=o,O=vie(o,yie);const x=K.useRef(null),G=Hx(x,AI(N)),W=Ce=>_e=>{Ce&&x.current&&Ce(x.current,_e)},ne=K.useCallback(W(i),[i]),Q=K.useCallback(W(a),[a]),se=K.useCallback(W(d),[d]),te=K.useCallback(W(f),[f]),le=K.useCallback(W(y),[y]),ce=K.useCallback(W(R),[R]),me=K.useCallback(W(w),[w]);return Object.assign({},O,{nodeRef:x},i&&{onEnter:ne},a&&{onEntering:Q},d&&{onEntered:se},f&&{onExit:te},y&&{onExiting:le},R&&{onExited:ce},w&&{addEndListener:me},{children:typeof N=="function"?(Ce,_e)=>N(Ce,Object.assign({},_e,{ref:G})):K.cloneElement(N,{ref:G})})}const Tie=["component"];function Rie(o,i){if(o==null)return{};var a={};for(var d in o)if({}.hasOwnProperty.call(o,d)){if(i.indexOf(d)>=0)continue;a[d]=o[d]}return a}const bie=K.forwardRef((o,i)=>{let{component:a}=o,d=Rie(o,Tie);const f=Sie(d);return E.jsx(a,Object.assign({ref:i},f))});function Cie({in:o,onTransition:i}){const a=K.useRef(null),d=K.useRef(!0),f=Jm(i);return vG(()=>{if(!a.current)return;let y=!1;return f({in:o,element:a.current,initial:d.current,isStale:()=>y}),()=>{y=!0}},[o,f]),vG(()=>(d.current=!1,()=>{d.current=!0}),[]),a}function wie({children:o,in:i,onExited:a,onEntered:d,transition:f}){const[y,R]=K.useState(!i);i&&y&&R(!1);const w=Cie({in:!!i,onTransition:O=>{const x=()=>{O.isStale()||(O.in?d==null||d(O.element,O.initial):(R(!0),a==null||a(O.element)))};Promise.resolve(f(O)).then(x,G=>{throw O.in||R(!0),G})}}),N=Hx(w,AI(o));return y&&!i?null:K.cloneElement(o,{ref:N})}function CG(o,i,a){return o?E.jsx(bie,Object.assign({},a,{component:o})):i?E.jsx(wie,Object.assign({},a,{transition:i})):E.jsx(Eie,Object.assign({},a))}const Aie=["show","role","className","style","children","backdrop","keyboard","onBackdropClick","onEscapeKeyDown","transition","runTransition","backdropTransition","runBackdropTransition","autoFocus","enforceFocus","restoreFocus","restoreFocusOptions","renderDialog","renderBackdrop","manager","container","onShow","onHide","onExit","onExited","onExiting","onEnter","onEntering","onEntered"];function Iie(o,i){if(o==null)return{};var a={};for(var d in o)if({}.hasOwnProperty.call(o,d)){if(i.indexOf(d)>=0)continue;a[d]=o[d]}return a}let $L;function Nie(o){return $L||($L=new zx({ownerDocument:o==null?void 0:o.document})),$L}function Oie(o){const i=Vx(),a=o||Nie(i),d=K.useRef({dialog:null,backdrop:null});return Object.assign(d.current,{add:()=>a.add(d.current),remove:()=>a.remove(d.current),isTopModal:()=>a.isTopModal(d.current),setDialogRef:K.useCallback(f=>{d.current.dialog=f},[]),setBackdropRef:K.useCallback(f=>{d.current.backdrop=f},[])})}const Z9=K.forwardRef((o,i)=>{let{show:a=!1,role:d="dialog",className:f,style:y,children:R,backdrop:w=!0,keyboard:N=!0,onBackdropClick:O,onEscapeKeyDown:x,transition:G,runTransition:W,backdropTransition:ne,runBackdropTransition:Q,autoFocus:se=!0,enforceFocus:te=!0,restoreFocus:le=!0,restoreFocusOptions:ce,renderDialog:me,renderBackdrop:Ce=gt=>E.jsx("div",Object.assign({},gt)),manager:_e,container:ze,onShow:Z,onHide:J=()=>{},onExit:$,onExited:fe,onExiting:ve,onEnter:pe,onEntering:he,onEntered:Fe}=o,st=Iie(o,Aie);const we=Vx(),je=gie(ze),nt=Oie(_e),Et=Wne(),ge=qne(a),[qe,Oe]=K.useState(!a),Be=K.useRef(null);K.useImperativeHandle(i,()=>nt,[nt]),yy&&!ge&&a&&(Be.current=JL(we==null?void 0:we.document)),a&&qe&&Oe(!1);const rt=Jm(()=>{if(nt.add(),fn.current=X0(document,"keydown",bt),Bt.current=X0(document,"focus",()=>setTimeout($e),!0),Z&&Z(),se){var gt,Zt;const rn=JL((gt=(Zt=nt.dialog)==null?void 0:Zt.ownerDocument)!=null?gt:we==null?void 0:we.document);nt.dialog&&rn&&!SG(nt.dialog,rn)&&(Be.current=rn,nt.dialog.focus())}}),Nt=Jm(()=>{if(nt.remove(),fn.current==null||fn.current(),Bt.current==null||Bt.current(),le){var gt;(gt=Be.current)==null||gt.focus==null||gt.focus(ce),Be.current=null}});K.useEffect(()=>{!a||!je||rt()},[a,je,rt]),K.useEffect(()=>{qe&&Nt()},[qe,Nt]),mie(()=>{Nt()});const $e=Jm(()=>{if(!te||!Et()||!nt.isTopModal())return;const gt=JL(we==null?void 0:we.document);nt.dialog&&gt&&!SG(nt.dialog,gt)&&nt.dialog.focus()}),mt=Jm(gt=>{gt.target===gt.currentTarget&&(O==null||O(gt),w===!0&&J())}),bt=Jm(gt=>{N&&Pne(gt)&&nt.isTopModal()&&(x==null||x(gt),gt.defaultPrevented||J())}),Bt=K.useRef(),fn=K.useRef(),vn=(...gt)=>{Oe(!0),fe==null||fe(...gt)};if(!je)return null;const qi=Object.assign({role:d,ref:nt.setDialogRef,"aria-modal":d==="dialog"?!0:void 0},st,{style:y,className:f,tabIndex:-1});let yt=me?me(qi):E.jsx("div",Object.assign({},qi,{children:K.cloneElement(R,{role:"document"})}));yt=CG(G,W,{unmountOnExit:!0,mountOnEnter:!0,appear:!0,in:!!a,onExit:$,onExiting:ve,onExited:vn,onEnter:pe,onEntering:he,onEntered:Fe,children:yt});let Vt=null;return w&&(Vt=Ce({ref:nt.setBackdropRef,onClick:mt}),Vt=CG(ne,Q,{in:!!a,appear:!0,mountOnEnter:!0,unmountOnExit:!0,children:Vt})),E.jsx(E.Fragment,{children:ey.createPortal(E.jsxs(E.Fragment,{children:[Vt,yt]}),je)})});Z9.displayName="Modal";const Die=Object.assign(Z9,{Manager:zx});function Pie(o,i){return o.classList?o.classList.contains(i):(" "+(o.className.baseVal||o.className)+" ").indexOf(" "+i+" ")!==-1}function Lie(o,i){o.classList?o.classList.add(i):Pie(o,i)||(typeof o.className=="string"?o.className=o.className+" "+i:o.setAttribute("class",(o.className&&o.className.baseVal||"")+" "+i))}function wG(o,i){return o.replace(new RegExp("(^|\\s)"+i+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function kie(o,i){o.classList?o.classList.remove(i):typeof o.className=="string"?o.className=wG(o.className,i):o.setAttribute("class",wG(o.className&&o.className.baseVal||"",i))}const YE={FIXED_CONTENT:".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",STICKY_CONTENT:".sticky-top",NAVBAR_TOGGLER:".navbar-toggler"};class xie extends zx{adjustAndStore(i,a,d){const f=a.style[i];a.dataset[i]=f,Zm(a,{[i]:`${parseFloat(Zm(a,i))+d}px`})}restore(i,a){const d=a.dataset[i];d!==void 0&&(delete a.dataset[i],Zm(a,{[i]:d}))}setContainerStyle(i){super.setContainerStyle(i);const a=this.getElement();if(Lie(a,"modal-open"),!i.scrollBarWidth)return;const d=this.isRTL?"paddingLeft":"paddingRight",f=this.isRTL?"marginLeft":"marginRight";KE(a,YE.FIXED_CONTENT).forEach(y=>this.adjustAndStore(d,y,i.scrollBarWidth)),KE(a,YE.STICKY_CONTENT).forEach(y=>this.adjustAndStore(f,y,-i.scrollBarWidth)),KE(a,YE.NAVBAR_TOGGLER).forEach(y=>this.adjustAndStore(f,y,i.scrollBarWidth))}removeContainerStyle(i){super.removeContainerStyle(i);const a=this.getElement();kie(a,"modal-open");const d=this.isRTL?"paddingLeft":"paddingRight",f=this.isRTL?"marginLeft":"marginRight";KE(a,YE.FIXED_CONTENT).forEach(y=>this.restore(d,y)),KE(a,YE.STICKY_CONTENT).forEach(y=>this.restore(f,y)),KE(a,YE.NAVBAR_TOGGLER).forEach(y=>this.restore(f,y))}}let ZL;function Mie(o){return ZL||(ZL=new xie(o)),ZL}const ez=K.forwardRef(({className:o,bsPrefix:i,as:a="div",...d},f)=>(i=Jr(i,"modal-body"),E.jsx(a,{ref:f,className:Wi(o,i),...d})));ez.displayName="ModalBody";const tz=K.createContext({onHide(){}}),Wx=K.forwardRef(({bsPrefix:o,className:i,contentClassName:a,centered:d,size:f,fullscreen:y,children:R,scrollable:w,...N},O)=>{o=Jr(o,"modal");const x=`${o}-dialog`,G=typeof y=="string"?`${o}-fullscreen-${y}`:`${o}-fullscreen`;return E.jsx("div",{...N,ref:O,className:Wi(x,i,f&&`${o}-${f}`,d&&`${x}-centered`,w&&`${x}-scrollable`,y&&G),children:E.jsx("div",{className:Wi(`${o}-content`,a),children:R})})});Wx.displayName="ModalDialog";const nz=K.forwardRef(({className:o,bsPrefix:i,as:a="div",...d},f)=>(i=Jr(i,"modal-footer"),E.jsx(a,{ref:f,className:Wi(o,i),...d})));nz.displayName="ModalFooter";const Uie=K.forwardRef(({closeLabel:o="Close",closeVariant:i,closeButton:a=!1,onHide:d,children:f,...y},R)=>{const w=K.useContext(tz),N=Hk(()=>{w==null||w.onHide(),d==null||d()});return E.jsxs("div",{ref:R,...y,children:[f,a&&E.jsx(jx,{"aria-label":o,variant:i,onClick:N})]})}),iz=K.forwardRef(({bsPrefix:o,className:i,closeLabel:a="Close",closeButton:d=!1,...f},y)=>(o=Jr(o,"modal-header"),E.jsx(Uie,{ref:y,...f,className:Wi(i,o),closeLabel:a,closeButton:d})));iz.displayName="ModalHeader";const jie=Hne("h4"),rz=K.forwardRef(({className:o,bsPrefix:i,as:a=jie,...d},f)=>(i=Jr(i,"modal-title"),E.jsx(a,{ref:f,className:Wi(o,i),...d})));rz.displayName="ModalTitle";function Vie(o){return E.jsx(Ux,{...o,timeout:null})}function Fie(o){return E.jsx(Ux,{...o,timeout:null})}const sz=K.forwardRef(({bsPrefix:o,className:i,style:a,dialogClassName:d,contentClassName:f,children:y,dialogAs:R=Wx,"data-bs-theme":w,"aria-labelledby":N,"aria-describedby":O,"aria-label":x,show:G=!1,animation:W=!0,backdrop:ne=!0,keyboard:Q=!0,onEscapeKeyDown:se,onShow:te,onHide:le,container:ce,autoFocus:me=!0,enforceFocus:Ce=!0,restoreFocus:_e=!0,restoreFocusOptions:ze,onEntered:Z,onExit:J,onExiting:$,onEnter:fe,onEntering:ve,onExited:pe,backdropClassName:he,manager:Fe,...st},we)=>{const[je,nt]=K.useState({}),[Et,ge]=K.useState(!1),qe=K.useRef(!1),Oe=K.useRef(!1),Be=K.useRef(null),[rt,Nt]=pie(),$e=F9(we,Nt),mt=Hk(le),bt=yne();o=Jr(o,"modal");const Bt=K.useMemo(()=>({onHide:mt}),[mt]);function fn(){return Fe||Mie({isRTL:bt})}function vn(Gt){if(!yy)return;const Me=fn().getScrollbarWidth()>0,un=Gt.scrollHeight>wI(Gt).documentElement.clientHeight;nt({paddingRight:Me&&!un?RG():void 0,paddingLeft:!Me&&un?RG():void 0})}const qi=Hk(()=>{rt&&vn(rt.dialog)});nie(()=>{Gk(window,"resize",qi),Be.current==null||Be.current()});const yt=()=>{qe.current=!0},Vt=Gt=>{qe.current&&rt&&Gt.target===rt.dialog&&(Oe.current=!0),qe.current=!1},gt=()=>{ge(!0),Be.current=V9(rt.dialog,()=>{ge(!1)})},Zt=Gt=>{Gt.target===Gt.currentTarget&&gt()},rn=Gt=>{if(ne==="static"){Zt(Gt);return}if(Oe.current||Gt.target!==Gt.currentTarget){Oe.current=!1;return}le==null||le()},kn=Gt=>{Q?se==null||se(Gt):(Gt.preventDefault(),ne==="static"&&gt())},ui=(Gt,Me)=>{Gt&&vn(Gt),fe==null||fe(Gt,Me)},Zr=Gt=>{Be.current==null||Be.current(),J==null||J(Gt)},_r=(Gt,Me)=>{ve==null||ve(Gt,Me),j9(window,"resize",qi)},Ko=Gt=>{Gt&&(Gt.style.display=""),pe==null||pe(Gt),Gk(window,"resize",qi)},Qs=K.useCallback(Gt=>E.jsx("div",{...Gt,className:Wi(`${o}-backdrop`,he,!W&&"show")}),[W,he,o]),Ti={...a,...je};Ti.display="block";const Fa=Gt=>E.jsx("div",{role:"dialog",...Gt,style:Ti,className:Wi(i,o,Et&&`${o}-static`,!W&&"show"),onClick:ne?rn:void 0,onMouseUp:Vt,"data-bs-theme":w,"aria-label":x,"aria-labelledby":N,"aria-describedby":O,children:E.jsx(R,{...st,onMouseDown:yt,className:d,contentClassName:f,children:y})});return E.jsx(tz.Provider,{value:Bt,children:E.jsx(Die,{show:G,ref:$e,backdrop:ne,container:ce,keyboard:!0,autoFocus:me,enforceFocus:Ce,restoreFocus:_e,restoreFocusOptions:ze,onEscapeKeyDown:kn,onShow:te,onHide:le,onEnter:ui,onEntering:_r,onEntered:Z,onExit:Zr,onExiting:$,onExited:Ko,manager:fn(),transition:W?Vie:void 0,backdropTransition:W?Fie:void 0,renderBackdrop:Qs,renderDialog:Fa})})});sz.displayName="Modal";const tr=Object.assign(sz,{Body:ez,Header:iz,Title:rz,Footer:nz,Dialog:Wx,TRANSITION_DURATION:300,BACKDROP_TRANSITION_DURATION:150}),zk=K.forwardRef(({bsPrefix:o,className:i,as:a="div",...d},f)=>{const y=Jr(o,"row"),R=x9(),w=M9(),N=`${y}-cols`,O=[];return R.forEach(x=>{const G=d[x];delete d[x];let W;G!=null&&typeof G=="object"?{cols:W}=G:W=G;const ne=x!==w?`-${x}`:"";W!=null&&O.push(`${N}${ne}-${W}`)}),E.jsx(a,{ref:f,...d,className:Wi(i,y,...O)})});zk.displayName="Row";var ek={exports:{}},tk={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AG;function Bie(){if(AG)return tk;AG=1;var o=RI();function i(N,O){return N===O&&(N!==0||1/N===1/O)||N!==N&&O!==O}var a=typeof Object.is=="function"?Object.is:i,d=o.useSyncExternalStore,f=o.useRef,y=o.useEffect,R=o.useMemo,w=o.useDebugValue;return tk.useSyncExternalStoreWithSelector=function(N,O,x,G,W){var ne=f(null);if(ne.current===null){var Q={hasValue:!1,value:null};ne.current=Q}else Q=ne.current;ne=R(function(){function te(_e){if(!le){if(le=!0,ce=_e,_e=G(_e),W!==void 0&&Q.hasValue){var ze=Q.value;if(W(ze,_e))return me=ze}return me=_e}if(ze=me,a(ce,_e))return ze;var Z=G(_e);return W!==void 0&&W(ze,Z)?(ce=_e,ze):(ce=_e,me=Z)}var le=!1,ce,me,Ce=x===void 0?null:x;return[function(){return te(O())},Ce===null?void 0:function(){return te(Ce())}]},[O,x,G,W]);var se=d(N,ne[0],ne[1]);return y(function(){Q.hasValue=!0,Q.value=se},[se]),w(se),se},tk}var IG;function Gie(){return IG||(IG=1,ek.exports=Bie()),ek.exports}var Hie=Gie();function zie(o){o()}function Wie(){let o=null,i=null;return{clear(){o=null,i=null},notify(){zie(()=>{let a=o;for(;a;)a.callback(),a=a.next})},get(){const a=[];let d=o;for(;d;)a.push(d),d=d.next;return a},subscribe(a){let d=!0;const f=i={callback:a,next:null,prev:i};return f.prev?f.prev.next=f:o=f,function(){!d||o===null||(d=!1,f.next?f.next.prev=f.prev:i=f.prev,f.prev?f.prev.next=f.next:o=f.next)}}}}var NG={notify(){},get:()=>[]};function qie(o,i){let a,d=NG,f=0,y=!1;function R(se){x();const te=d.subscribe(se);let le=!1;return()=>{le||(le=!0,te(),G())}}function w(){d.notify()}function N(){Q.onStateChange&&Q.onStateChange()}function O(){return y}function x(){f++,a||(a=o.subscribe(N),d=Wie())}function G(){f--,a&&f===0&&(a(),a=void 0,d.clear(),d=NG)}function W(){y||(y=!0,x())}function ne(){y&&(y=!1,G())}const Q={addNestedSub:R,notifyNestedSubs:w,handleChangeWrapper:N,isSubscribed:O,trySubscribe:W,tryUnsubscribe:ne,getListeners:()=>d};return Q}var Kie=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Yie=Kie(),Xie=()=>typeof navigator<"u"&&navigator.product==="ReactNative",Jie=Xie(),Qie=()=>Yie||Jie?K.useLayoutEffect:K.useEffect,$ie=Qie(),nk=Symbol.for("react-redux-context"),ik=typeof globalThis<"u"?globalThis:{};function Zie(){if(!K.createContext)return{};const o=ik[nk]??(ik[nk]=new Map);let i=o.get(K.createContext);return i||(i=K.createContext(null),o.set(K.createContext,i)),i}var jp=Zie();function ere(o){const{children:i,context:a,serverState:d,store:f}=o,y=K.useMemo(()=>{const N=qie(f);return{store:f,subscription:N,getServerState:d?()=>d:void 0}},[f,d]),R=K.useMemo(()=>f.getState(),[f]);$ie(()=>{const{subscription:N}=y;return N.onStateChange=N.notifyNestedSubs,N.trySubscribe(),R!==f.getState()&&N.notifyNestedSubs(),()=>{N.tryUnsubscribe(),N.onStateChange=void 0}},[y,R]);const w=a||jp;return K.createElement(w.Provider,{value:y},i)}var tre=ere;function qx(o=jp){return function(){return K.useContext(o)}}var az=qx();function oz(o=jp){const i=o===jp?az:qx(o),a=()=>{const{store:d}=i();return d};return Object.assign(a,{withTypes:()=>a}),a}var nre=oz();function ire(o=jp){const i=o===jp?nre:oz(o),a=()=>i().dispatch;return Object.assign(a,{withTypes:()=>a}),a}var Mr=ire(),rre=(o,i)=>o===i;function sre(o=jp){const i=o===jp?az:qx(o),a=(d,f={})=>{const{equalityFn:y=rre}=typeof f=="function"?{equalityFn:f}:f,R=i(),{store:w,subscription:N,getServerState:O}=R;K.useRef(!0);const x=K.useCallback({[d.name](W){return d(W)}}[d.name],[d]),G=Hie.useSyncExternalStoreWithSelector(N.addNestedSub,w.getState,O||w.getState,x,y);return K.useDebugValue(G),G};return Object.assign(a,{withTypes:()=>a}),a}var Zi=sre();function Ks(o){return`Minified Redux error #${o}; visit https://redux.js.org/Errors?code=${o} for the full message or use the non-minified dev environment for full errors. `}var are=typeof Symbol=="function"&&Symbol.observable||"@@observable",OG=are,rk=()=>Math.random().toString(36).substring(7).split("").join("."),ore={INIT:`@@redux/INIT${rk()}`,REPLACE:`@@redux/REPLACE${rk()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${rk()}`},Z0=ore;function Kx(o){if(typeof o!="object"||o===null)return!1;let i=o;for(;Object.getPrototypeOf(i)!==null;)i=Object.getPrototypeOf(i);return Object.getPrototypeOf(o)===i||Object.getPrototypeOf(o)===null}function cz(o,i,a){if(typeof o!="function")throw new Error(Ks(2));if(typeof i=="function"&&typeof a=="function"||typeof a=="function"&&typeof arguments[3]=="function")throw new Error(Ks(0));if(typeof i=="function"&&typeof a>"u"&&(a=i,i=void 0),typeof a<"u"){if(typeof a!="function")throw new Error(Ks(1));return a(cz)(o,i)}let d=o,f=i,y=new Map,R=y,w=0,N=!1;function O(){R===y&&(R=new Map,y.forEach((te,le)=>{R.set(le,te)}))}function x(){if(N)throw new Error(Ks(3));return f}function G(te){if(typeof te!="function")throw new Error(Ks(4));if(N)throw new Error(Ks(5));let le=!0;O();const ce=w++;return R.set(ce,te),function(){if(le){if(N)throw new Error(Ks(6));le=!1,O(),R.delete(ce),y=null}}}function W(te){if(!Kx(te))throw new Error(Ks(7));if(typeof te.type>"u")throw new Error(Ks(8));if(typeof te.type!="string")throw new Error(Ks(17));if(N)throw new Error(Ks(9));try{N=!0,f=d(f,te)}finally{N=!1}return(y=R).forEach(ce=>{ce()}),te}function ne(te){if(typeof te!="function")throw new Error(Ks(10));d=te,W({type:Z0.REPLACE})}function Q(){const te=G;return{subscribe(le){if(typeof le!="object"||le===null)throw new Error(Ks(11));function ce(){const Ce=le;Ce.next&&Ce.next(x())}return ce(),{unsubscribe:te(ce)}},[OG](){return this}}}return W({type:Z0.INIT}),{dispatch:W,subscribe:G,getState:x,replaceReducer:ne,[OG]:Q}}function cre(o){Object.keys(o).forEach(i=>{const a=o[i];if(typeof a(void 0,{type:Z0.INIT})>"u")throw new Error(Ks(12));if(typeof a(void 0,{type:Z0.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Ks(13))})}function lre(o){const i=Object.keys(o),a={};for(let y=0;y<i.length;y++){const R=i[y];typeof o[R]=="function"&&(a[R]=o[R])}const d=Object.keys(a);let f;try{cre(a)}catch(y){f=y}return function(R={},w){if(f)throw f;let N=!1;const O={};for(let x=0;x<d.length;x++){const G=d[x],W=a[G],ne=R[G],Q=W(ne,w);if(typeof Q>"u")throw w&&w.type,new Error(Ks(14));O[G]=Q,N=N||Q!==ne}return N=N||d.length!==Object.keys(R).length,N?O:R}}function eI(...o){return o.length===0?i=>i:o.length===1?o[0]:o.reduce((i,a)=>(...d)=>i(a(...d)))}function dre(...o){return i=>(a,d)=>{const f=i(a,d);let y=()=>{throw new Error(Ks(15))};const R={getState:f.getState,dispatch:(N,...O)=>y(N,...O)},w=o.map(N=>N(R));return y=eI(...w)(f.dispatch),{...f,dispatch:y}}}function ure(o){return Kx(o)&&"type"in o&&typeof o.type=="string"}var lz=Symbol.for("immer-nothing"),DG=Symbol.for("immer-draftable"),zo=Symbol.for("immer-state");function Nl(o,...i){throw new Error(`[Immer] minified error nr: ${o}. Full error at: https://bit.ly/3cXEKWf`)}var cy=Object.getPrototypeOf;function i_(o){return!!o&&!!o[zo]}function nh(o){var i;return o?dz(o)||Array.isArray(o)||!!o[DG]||!!((i=o.constructor)!=null&&i[DG])||OI(o)||DI(o):!1}var hre=Object.prototype.constructor.toString();function dz(o){if(!o||typeof o!="object")return!1;const i=cy(o);if(i===null)return!0;const a=Object.hasOwnProperty.call(i,"constructor")&&i.constructor;return a===Object?!0:typeof a=="function"&&Function.toString.call(a)===hre}function tI(o,i){NI(o)===0?Reflect.ownKeys(o).forEach(a=>{i(a,o[a],o)}):o.forEach((a,d)=>i(d,a,o))}function NI(o){const i=o[zo];return i?i.type_:Array.isArray(o)?1:OI(o)?2:DI(o)?3:0}function Wk(o,i){return NI(o)===2?o.has(i):Object.prototype.hasOwnProperty.call(o,i)}function uz(o,i,a){const d=NI(o);d===2?o.set(i,a):d===3?o.add(a):o[i]=a}function pre(o,i){return o===i?o!==0||1/o===1/i:o!==o&&i!==i}function OI(o){return o instanceof Map}function DI(o){return o instanceof Set}function qm(o){return o.copy_||o.base_}function qk(o,i){if(OI(o))return new Map(o);if(DI(o))return new Set(o);if(Array.isArray(o))return Array.prototype.slice.call(o);const a=dz(o);if(i===!0||i==="class_only"&&!a){const d=Object.getOwnPropertyDescriptors(o);delete d[zo];let f=Reflect.ownKeys(d);for(let y=0;y<f.length;y++){const R=f[y],w=d[R];w.writable===!1&&(w.writable=!0,w.configurable=!0),(w.get||w.set)&&(d[R]={configurable:!0,writable:!0,enumerable:w.enumerable,value:o[R]})}return Object.create(cy(o),d)}else{const d=cy(o);if(d!==null&&a)return{...o};const f=Object.create(d);return Object.assign(f,o)}}function Yx(o,i=!1){return PI(o)||i_(o)||!nh(o)||(NI(o)>1&&(o.set=o.add=o.clear=o.delete=fre),Object.freeze(o),i&&Object.entries(o).forEach(([a,d])=>Yx(d,!0))),o}function fre(){Nl(2)}function PI(o){return Object.isFrozen(o)}var mre={};function r_(o){const i=mre[o];return i||Nl(0,o),i}var cR;function hz(){return cR}function _re(o,i){return{drafts_:[],parent_:o,immer_:i,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function PG(o,i){i&&(r_("Patches"),o.patches_=[],o.inversePatches_=[],o.patchListener_=i)}function Kk(o){Yk(o),o.drafts_.forEach(gre),o.drafts_=null}function Yk(o){o===cR&&(cR=o.parent_)}function LG(o){return cR=_re(cR,o)}function gre(o){const i=o[zo];i.type_===0||i.type_===1?i.revoke_():i.revoked_=!0}function kG(o,i){i.unfinalizedDrafts_=i.drafts_.length;const a=i.drafts_[0];return o!==void 0&&o!==a?(a[zo].modified_&&(Kk(i),Nl(4)),nh(o)&&(o=nI(i,o),i.parent_||iI(i,o)),i.patches_&&r_("Patches").generateReplacementPatches_(a[zo].base_,o,i.patches_,i.inversePatches_)):o=nI(i,a,[]),Kk(i),i.patches_&&i.patchListener_(i.patches_,i.inversePatches_),o!==lz?o:void 0}function nI(o,i,a){if(PI(i))return i;const d=i[zo];if(!d)return tI(i,(f,y)=>xG(o,d,i,f,y,a)),i;if(d.scope_!==o)return i;if(!d.modified_)return iI(o,d.base_,!0),d.base_;if(!d.finalized_){d.finalized_=!0,d.scope_.unfinalizedDrafts_--;const f=d.copy_;let y=f,R=!1;d.type_===3&&(y=new Set(f),f.clear(),R=!0),tI(y,(w,N)=>xG(o,d,f,w,N,a,R)),iI(o,f,!1),a&&o.patches_&&r_("Patches").generatePatches_(d,a,o.patches_,o.inversePatches_)}return d.copy_}function xG(o,i,a,d,f,y,R){if(i_(f)){const w=y&&i&&i.type_!==3&&!Wk(i.assigned_,d)?y.concat(d):void 0,N=nI(o,f,w);if(uz(a,d,N),i_(N))o.canAutoFreeze_=!1;else return}else R&&a.add(f);if(nh(f)&&!PI(f)){if(!o.immer_.autoFreeze_&&o.unfinalizedDrafts_<1)return;nI(o,f),(!i||!i.scope_.parent_)&&typeof d!="symbol"&&Object.prototype.propertyIsEnumerable.call(a,d)&&iI(o,f)}}function iI(o,i,a=!1){!o.parent_&&o.immer_.autoFreeze_&&o.canAutoFreeze_&&Yx(i,a)}function Ere(o,i){const a=Array.isArray(o),d={type_:a?1:0,scope_:i?i.scope_:hz(),modified_:!1,finalized_:!1,assigned_:{},parent_:i,base_:o,draft_:null,copy_:null,revoke_:null,isManual_:!1};let f=d,y=Xx;a&&(f=[d],y=lR);const{revoke:R,proxy:w}=Proxy.revocable(f,y);return d.draft_=w,d.revoke_=R,w}var Xx={get(o,i){if(i===zo)return o;const a=qm(o);if(!Wk(a,i))return yre(o,a,i);const d=a[i];return o.finalized_||!nh(d)?d:d===sk(o.base_,i)?(ak(o),o.copy_[i]=Jk(d,o)):d},has(o,i){return i in qm(o)},ownKeys(o){return Reflect.ownKeys(qm(o))},set(o,i,a){const d=pz(qm(o),i);if(d!=null&&d.set)return d.set.call(o.draft_,a),!0;if(!o.modified_){const f=sk(qm(o),i),y=f==null?void 0:f[zo];if(y&&y.base_===a)return o.copy_[i]=a,o.assigned_[i]=!1,!0;if(pre(a,f)&&(a!==void 0||Wk(o.base_,i)))return!0;ak(o),Xk(o)}return o.copy_[i]===a&&(a!==void 0||i in o.copy_)||Number.isNaN(a)&&Number.isNaN(o.copy_[i])||(o.copy_[i]=a,o.assigned_[i]=!0),!0},deleteProperty(o,i){return sk(o.base_,i)!==void 0||i in o.base_?(o.assigned_[i]=!1,ak(o),Xk(o)):delete o.assigned_[i],o.copy_&&delete o.copy_[i],!0},getOwnPropertyDescriptor(o,i){const a=qm(o),d=Reflect.getOwnPropertyDescriptor(a,i);return d&&{writable:!0,configurable:o.type_!==1||i!=="length",enumerable:d.enumerable,value:a[i]}},defineProperty(){Nl(11)},getPrototypeOf(o){return cy(o.base_)},setPrototypeOf(){Nl(12)}},lR={};tI(Xx,(o,i)=>{lR[o]=function(){return arguments[0]=arguments[0][0],i.apply(this,arguments)}});lR.deleteProperty=function(o,i){return lR.set.call(this,o,i,void 0)};lR.set=function(o,i,a){return Xx.set.call(this,o[0],i,a,o[0])};function sk(o,i){const a=o[zo];return(a?qm(a):o)[i]}function yre(o,i,a){var f;const d=pz(i,a);return d?"value"in d?d.value:(f=d.get)==null?void 0:f.call(o.draft_):void 0}function pz(o,i){if(!(i in o))return;let a=cy(o);for(;a;){const d=Object.getOwnPropertyDescriptor(a,i);if(d)return d;a=cy(a)}}function Xk(o){o.modified_||(o.modified_=!0,o.parent_&&Xk(o.parent_))}function ak(o){o.copy_||(o.copy_=qk(o.base_,o.scope_.immer_.useStrictShallowCopy_))}var vre=class{constructor(o){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(i,a,d)=>{if(typeof i=="function"&&typeof a!="function"){const y=a;a=i;const R=this;return function(N=y,...O){return R.produce(N,x=>a.call(this,x,...O))}}typeof a!="function"&&Nl(6),d!==void 0&&typeof d!="function"&&Nl(7);let f;if(nh(i)){const y=LG(this),R=Jk(i,void 0);let w=!0;try{f=a(R),w=!1}finally{w?Kk(y):Yk(y)}return PG(y,d),kG(f,y)}else if(!i||typeof i!="object"){if(f=a(i),f===void 0&&(f=i),f===lz&&(f=void 0),this.autoFreeze_&&Yx(f,!0),d){const y=[],R=[];r_("Patches").generateReplacementPatches_(i,f,y,R),d(y,R)}return f}else Nl(1,i)},this.produceWithPatches=(i,a)=>{if(typeof i=="function")return(R,...w)=>this.produceWithPatches(R,N=>i(N,...w));let d,f;return[this.produce(i,a,(R,w)=>{d=R,f=w}),d,f]},typeof(o==null?void 0:o.autoFreeze)=="boolean"&&this.setAutoFreeze(o.autoFreeze),typeof(o==null?void 0:o.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(o.useStrictShallowCopy)}createDraft(o){nh(o)||Nl(8),i_(o)&&(o=Sre(o));const i=LG(this),a=Jk(o,void 0);return a[zo].isManual_=!0,Yk(i),a}finishDraft(o,i){const a=o&&o[zo];(!a||!a.isManual_)&&Nl(9);const{scope_:d}=a;return PG(d,i),kG(void 0,d)}setAutoFreeze(o){this.autoFreeze_=o}setUseStrictShallowCopy(o){this.useStrictShallowCopy_=o}applyPatches(o,i){let a;for(a=i.length-1;a>=0;a--){const f=i[a];if(f.path.length===0&&f.op==="replace"){o=f.value;break}}a>-1&&(i=i.slice(a+1));const d=r_("Patches").applyPatches_;return i_(o)?d(o,i):this.produce(o,f=>d(f,i))}};function Jk(o,i){const a=OI(o)?r_("MapSet").proxyMap_(o,i):DI(o)?r_("MapSet").proxySet_(o,i):Ere(o,i);return(i?i.scope_:hz()).drafts_.push(a),a}function Sre(o){return i_(o)||Nl(10,o),fz(o)}function fz(o){if(!nh(o)||PI(o))return o;const i=o[zo];let a;if(i){if(!i.modified_)return i.base_;i.finalized_=!0,a=qk(o,i.scope_.immer_.useStrictShallowCopy_)}else a=qk(o,!0);return tI(a,(d,f)=>{uz(a,d,fz(f))}),i&&(i.finalized_=!1),a}var Wo=new vre,mz=Wo.produce;Wo.produceWithPatches.bind(Wo);Wo.setAutoFreeze.bind(Wo);Wo.setUseStrictShallowCopy.bind(Wo);Wo.applyPatches.bind(Wo);Wo.createDraft.bind(Wo);Wo.finishDraft.bind(Wo);function _z(o){return({dispatch:a,getState:d})=>f=>y=>typeof y=="function"?y(a,d,o):f(y)}var Tre=_z(),Rre=_z,bre=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?eI:eI.apply(null,arguments)},Cre=o=>o&&typeof o.match=="function";function JT(o,i){function a(...d){if(i){let f=i(...d);if(!f)throw new Error($u(0));return{type:o,payload:f.payload,..."meta"in f&&{meta:f.meta},..."error"in f&&{error:f.error}}}return{type:o,payload:d[0]}}return a.toString=()=>`${o}`,a.type=o,a.match=d=>ure(d)&&d.type===o,a}var gz=class zT extends Array{constructor(...i){super(...i),Object.setPrototypeOf(this,zT.prototype)}static get[Symbol.species](){return zT}concat(...i){return super.concat.apply(this,i)}prepend(...i){return i.length===1&&Array.isArray(i[0])?new zT(...i[0].concat(this)):new zT(...i.concat(this))}};function MG(o){return nh(o)?mz(o,()=>{}):o}function ZA(o,i,a){return o.has(i)?o.get(i):o.set(i,a(i)).get(i)}function wre(o){return typeof o=="boolean"}var Are=()=>function(i){const{thunk:a=!0,immutableCheck:d=!0,serializableCheck:f=!0,actionCreatorCheck:y=!0}=i??{};let R=new gz;return a&&(wre(a)?R.push(Tre):R.push(Rre(a.extraArgument))),R},Ire="RTK_autoBatch",UG=o=>i=>{setTimeout(i,o)},Nre=(o={type:"raf"})=>i=>(...a)=>{const d=i(...a);let f=!0,y=!1,R=!1;const w=new Set,N=o.type==="tick"?queueMicrotask:o.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:UG(10):o.type==="callback"?o.queueNotification:UG(o.timeout),O=()=>{R=!1,y&&(y=!1,w.forEach(x=>x()))};return Object.assign({},d,{subscribe(x){const G=()=>f&&x(),W=d.subscribe(G);return w.add(x),()=>{W(),w.delete(x)}},dispatch(x){var G;try{return f=!((G=x==null?void 0:x.meta)!=null&&G[Ire]),y=!f,y&&(R||(R=!0,N(O))),d.dispatch(x)}finally{f=!0}}})},Ore=o=>function(a){const{autoBatch:d=!0}=a??{};let f=new gz(o);return d&&f.push(Nre(typeof d=="object"?d:void 0)),f};function Dre(o){const i=Are(),{reducer:a=void 0,middleware:d,devTools:f=!0,preloadedState:y=void 0,enhancers:R=void 0}=o||{};let w;if(typeof a=="function")w=a;else if(Kx(a))w=lre(a);else throw new Error($u(1));let N;typeof d=="function"?N=d(i):N=i();let O=eI;f&&(O=bre({trace:!1,...typeof f=="object"&&f}));const x=dre(...N),G=Ore(x);let W=typeof R=="function"?R(G):G();const ne=O(...W);return cz(w,y,ne)}function Ez(o){const i={},a=[];let d;const f={addCase(y,R){const w=typeof y=="string"?y:y.type;if(!w)throw new Error($u(28));if(w in i)throw new Error($u(29));return i[w]=R,f},addMatcher(y,R){return a.push({matcher:y,reducer:R}),f},addDefaultCase(y){return d=y,f}};return o(f),[i,a,d]}function Pre(o){return typeof o=="function"}function Lre(o,i){let[a,d,f]=Ez(i),y;if(Pre(o))y=()=>MG(o());else{const w=MG(o);y=()=>w}function R(w=y(),N){let O=[a[N.type],...d.filter(({matcher:x})=>x(N)).map(({reducer:x})=>x)];return O.filter(x=>!!x).length===0&&(O=[f]),O.reduce((x,G)=>{if(G)if(i_(x)){const ne=G(x,N);return ne===void 0?x:ne}else{if(nh(x))return mz(x,W=>G(W,N));{const W=G(x,N);if(W===void 0){if(x===null)return x;throw Error("A case reducer on a non-draftable value must not return undefined")}return W}}return x},w)}return R.getInitialState=y,R}var kre=(o,i)=>Cre(o)?o.match(i):o(i);function xre(...o){return i=>o.some(a=>kre(a,i))}var Mre="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",Ure=(o=21)=>{let i="",a=o;for(;a--;)i+=Mre[Math.random()*64|0];return i},jre=["name","message","stack","code"],ok=class{constructor(o,i){kL(this,"_type");this.payload=o,this.meta=i}},jG=class{constructor(o,i){kL(this,"_type");this.payload=o,this.meta=i}},Vre=o=>{if(typeof o=="object"&&o!==null){const i={};for(const a of jre)typeof o[a]=="string"&&(i[a]=o[a]);return i}return{message:String(o)}},VG="External signal was aborted",$t=(()=>{function o(i,a,d){const f=JT(i+"/fulfilled",(N,O,x,G)=>({payload:N,meta:{...G||{},arg:x,requestId:O,requestStatus:"fulfilled"}})),y=JT(i+"/pending",(N,O,x)=>({payload:void 0,meta:{...x||{},arg:O,requestId:N,requestStatus:"pending"}})),R=JT(i+"/rejected",(N,O,x,G,W)=>({payload:G,error:(d&&d.serializeError||Vre)(N||"Rejected"),meta:{...W||{},arg:x,requestId:O,rejectedWithValue:!!G,requestStatus:"rejected",aborted:(N==null?void 0:N.name)==="AbortError",condition:(N==null?void 0:N.name)==="ConditionError"}}));function w(N,{signal:O}={}){return(x,G,W)=>{const ne=d!=null&&d.idGenerator?d.idGenerator(N):Ure(),Q=new AbortController;let se,te;function le(me){te=me,Q.abort()}O&&(O.aborted?le(VG):O.addEventListener("abort",()=>le(VG),{once:!0}));const ce=async function(){var _e,ze;let me;try{let Z=(_e=d==null?void 0:d.condition)==null?void 0:_e.call(d,N,{getState:G,extra:W});if(Bre(Z)&&(Z=await Z),Z===!1||Q.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};const J=new Promise(($,fe)=>{se=()=>{fe({name:"AbortError",message:te||"Aborted"})},Q.signal.addEventListener("abort",se)});x(y(ne,N,(ze=d==null?void 0:d.getPendingMeta)==null?void 0:ze.call(d,{requestId:ne,arg:N},{getState:G,extra:W}))),me=await Promise.race([J,Promise.resolve(a(N,{dispatch:x,getState:G,extra:W,requestId:ne,signal:Q.signal,abort:le,rejectWithValue:($,fe)=>new ok($,fe),fulfillWithValue:($,fe)=>new jG($,fe)})).then($=>{if($ instanceof ok)throw $;return $ instanceof jG?f($.payload,ne,N,$.meta):f($,ne,N)})])}catch(Z){me=Z instanceof ok?R(null,ne,N,Z.payload,Z.meta):R(Z,ne,N)}finally{se&&Q.signal.removeEventListener("abort",se)}return d&&!d.dispatchConditionRejection&&R.match(me)&&me.meta.condition||x(me),me}();return Object.assign(ce,{abort:le,requestId:ne,arg:N,unwrap(){return ce.then(Fre)}})}}return Object.assign(w,{pending:y,rejected:R,fulfilled:f,settled:xre(R,f),typePrefix:i})}return o.withTypes=()=>o,o})();function Fre(o){if(o.meta&&o.meta.rejectedWithValue)throw o.payload;if(o.error)throw o.error;return o.payload}function Bre(o){return o!==null&&typeof o=="object"&&typeof o.then=="function"}var Gre=Symbol.for("rtk-slice-createasyncthunk");function Hre(o,i){return`${o}/${i}`}function zre({creators:o}={}){var a;const i=(a=o==null?void 0:o.asyncThunk)==null?void 0:a[Gre];return function(f){const{name:y,reducerPath:R=y}=f;if(!y)throw new Error($u(11));const w=(typeof f.reducers=="function"?f.reducers(qre()):f.reducers)||{},N=Object.keys(w),O={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},x={addCase(Ce,_e){const ze=typeof Ce=="string"?Ce:Ce.type;if(!ze)throw new Error($u(12));if(ze in O.sliceCaseReducersByType)throw new Error($u(13));return O.sliceCaseReducersByType[ze]=_e,x},addMatcher(Ce,_e){return O.sliceMatchers.push({matcher:Ce,reducer:_e}),x},exposeAction(Ce,_e){return O.actionCreators[Ce]=_e,x},exposeCaseReducer(Ce,_e){return O.sliceCaseReducersByName[Ce]=_e,x}};N.forEach(Ce=>{const _e=w[Ce],ze={reducerName:Ce,type:Hre(y,Ce),createNotation:typeof f.reducers=="function"};Yre(_e)?Jre(ze,_e,x,i):Kre(ze,_e,x)});function G(){const[Ce={},_e=[],ze=void 0]=typeof f.extraReducers=="function"?Ez(f.extraReducers):[f.extraReducers],Z={...Ce,...O.sliceCaseReducersByType};return Lre(f.initialState,J=>{for(let $ in Z)J.addCase($,Z[$]);for(let $ of O.sliceMatchers)J.addMatcher($.matcher,$.reducer);for(let $ of _e)J.addMatcher($.matcher,$.reducer);ze&&J.addDefaultCase(ze)})}const W=Ce=>Ce,ne=new Map,Q=new WeakMap;let se;function te(Ce,_e){return se||(se=G()),se(Ce,_e)}function le(){return se||(se=G()),se.getInitialState()}function ce(Ce,_e=!1){function ze(J){let $=J[Ce];return typeof $>"u"&&_e&&($=ZA(Q,ze,le)),$}function Z(J=W){const $=ZA(ne,_e,()=>new WeakMap);return ZA($,J,()=>{const fe={};for(const[ve,pe]of Object.entries(f.selectors??{}))fe[ve]=Wre(pe,J,()=>ZA(Q,J,le),_e);return fe})}return{reducerPath:Ce,getSelectors:Z,get selectors(){return Z(ze)},selectSlice:ze}}const me={name:y,reducer:te,actions:O.actionCreators,caseReducers:O.sliceCaseReducersByName,getInitialState:le,...ce(R),injectInto(Ce,{reducerPath:_e,...ze}={}){const Z=_e??R;return Ce.inject({reducerPath:Z,reducer:te},ze),{...me,...ce(Z,!0)}}};return me}}function Wre(o,i,a,d){function f(y,...R){let w=i(y);return typeof w>"u"&&d&&(w=a()),o(w,...R)}return f.unwrapped=o,f}var l_=zre();function qre(){function o(i,a){return{_reducerDefinitionType:"asyncThunk",payloadCreator:i,...a}}return o.withTypes=()=>o,{reducer(i){return Object.assign({[i.name](...a){return i(...a)}}[i.name],{_reducerDefinitionType:"reducer"})},preparedReducer(i,a){return{_reducerDefinitionType:"reducerWithPrepare",prepare:i,reducer:a}},asyncThunk:o}}function Kre({type:o,reducerName:i,createNotation:a},d,f){let y,R;if("reducer"in d){if(a&&!Xre(d))throw new Error($u(17));y=d.reducer,R=d.prepare}else y=d;f.addCase(o,y).exposeCaseReducer(i,y).exposeAction(i,R?JT(o,R):JT(o))}function Yre(o){return o._reducerDefinitionType==="asyncThunk"}function Xre(o){return o._reducerDefinitionType==="reducerWithPrepare"}function Jre({type:o,reducerName:i},a,d,f){if(!f)throw new Error($u(18));const{payloadCreator:y,fulfilled:R,pending:w,rejected:N,settled:O,options:x}=a,G=f(o,y,x);d.exposeAction(i,G),R&&d.addCase(G.fulfilled,R),w&&d.addCase(G.pending,w),N&&d.addCase(G.rejected,N),O&&d.addMatcher(G.settled,O),d.exposeCaseReducer(i,{fulfilled:R||e0,pending:w||e0,rejected:N||e0,settled:O||e0})}function e0(){}function $u(o){return`Minified Redux Toolkit error #${o}; visit https://redux-toolkit.js.org/Errors?code=${o} for the full message or use the non-minified dev environment for full errors. `}function yz(o,i){return function(){return o.apply(i,arguments)}}const{toString:Qre}=Object.prototype,{getPrototypeOf:Jx}=Object,{iterator:LI,toStringTag:vz}=Symbol,kI=(o=>i=>{const a=Qre.call(i);return o[a]||(o[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),kl=o=>(o=o.toLowerCase(),i=>kI(i)===o),xI=o=>i=>typeof i===o,{isArray:Sy}=Array,dR=xI("undefined");function $re(o){return o!==null&&!dR(o)&&o.constructor!==null&&!dR(o.constructor)&&mo(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const Sz=kl("ArrayBuffer");function Zre(o){let i;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?i=ArrayBuffer.isView(o):i=o&&o.buffer&&Sz(o.buffer),i}const ese=xI("string"),mo=xI("function"),Tz=xI("number"),MI=o=>o!==null&&typeof o=="object",tse=o=>o===!0||o===!1,d0=o=>{if(kI(o)!=="object")return!1;const i=Jx(o);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(vz in o)&&!(LI in o)},nse=kl("Date"),ise=kl("File"),rse=kl("Blob"),sse=kl("FileList"),ase=o=>MI(o)&&mo(o.pipe),ose=o=>{let i;return o&&(typeof FormData=="function"&&o instanceof FormData||mo(o.append)&&((i=kI(o))==="formdata"||i==="object"&&mo(o.toString)&&o.toString()==="[object FormData]"))},cse=kl("URLSearchParams"),[lse,dse,use,hse]=["ReadableStream","Request","Response","Headers"].map(kl),pse=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function wR(o,i,{allOwnKeys:a=!1}={}){if(o===null||typeof o>"u")return;let d,f;if(typeof o!="object"&&(o=[o]),Sy(o))for(d=0,f=o.length;d<f;d++)i.call(null,o[d],d,o);else{const y=a?Object.getOwnPropertyNames(o):Object.keys(o),R=y.length;let w;for(d=0;d<R;d++)w=y[d],i.call(null,o[w],w,o)}}function Rz(o,i){i=i.toLowerCase();const a=Object.keys(o);let d=a.length,f;for(;d-- >0;)if(f=a[d],i===f.toLowerCase())return f;return null}const Qm=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,bz=o=>!dR(o)&&o!==Qm;function Qk(){const{caseless:o}=bz(this)&&this||{},i={},a=(d,f)=>{const y=o&&Rz(i,f)||f;d0(i[y])&&d0(d)?i[y]=Qk(i[y],d):d0(d)?i[y]=Qk({},d):Sy(d)?i[y]=d.slice():i[y]=d};for(let d=0,f=arguments.length;d<f;d++)arguments[d]&&wR(arguments[d],a);return i}const fse=(o,i,a,{allOwnKeys:d}={})=>(wR(i,(f,y)=>{a&&mo(f)?o[y]=yz(f,a):o[y]=f},{allOwnKeys:d}),o),mse=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),_se=(o,i,a,d)=>{o.prototype=Object.create(i.prototype,d),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:i.prototype}),a&&Object.assign(o.prototype,a)},gse=(o,i,a,d)=>{let f,y,R;const w={};if(i=i||{},o==null)return i;do{for(f=Object.getOwnPropertyNames(o),y=f.length;y-- >0;)R=f[y],(!d||d(R,o,i))&&!w[R]&&(i[R]=o[R],w[R]=!0);o=a!==!1&&Jx(o)}while(o&&(!a||a(o,i))&&o!==Object.prototype);return i},Ese=(o,i,a)=>{o=String(o),(a===void 0||a>o.length)&&(a=o.length),a-=i.length;const d=o.indexOf(i,a);return d!==-1&&d===a},yse=o=>{if(!o)return null;if(Sy(o))return o;let i=o.length;if(!Tz(i))return null;const a=new Array(i);for(;i-- >0;)a[i]=o[i];return a},vse=(o=>i=>o&&i instanceof o)(typeof Uint8Array<"u"&&Jx(Uint8Array)),Sse=(o,i)=>{const d=(o&&o[LI]).call(o);let f;for(;(f=d.next())&&!f.done;){const y=f.value;i.call(o,y[0],y[1])}},Tse=(o,i)=>{let a;const d=[];for(;(a=o.exec(i))!==null;)d.push(a);return d},Rse=kl("HTMLFormElement"),bse=o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,d,f){return d.toUpperCase()+f}),FG=(({hasOwnProperty:o})=>(i,a)=>o.call(i,a))(Object.prototype),Cse=kl("RegExp"),Cz=(o,i)=>{const a=Object.getOwnPropertyDescriptors(o),d={};wR(a,(f,y)=>{let R;(R=i(f,y,o))!==!1&&(d[y]=R||f)}),Object.defineProperties(o,d)},wse=o=>{Cz(o,(i,a)=>{if(mo(o)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const d=o[a];if(mo(d)){if(i.enumerable=!1,"writable"in i){i.writable=!1;return}i.set||(i.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},Ase=(o,i)=>{const a={},d=f=>{f.forEach(y=>{a[y]=!0})};return Sy(o)?d(o):d(String(o).split(i)),a},Ise=()=>{},Nse=(o,i)=>o!=null&&Number.isFinite(o=+o)?o:i;function Ose(o){return!!(o&&mo(o.append)&&o[vz]==="FormData"&&o[LI])}const Dse=o=>{const i=new Array(10),a=(d,f)=>{if(MI(d)){if(i.indexOf(d)>=0)return;if(!("toJSON"in d)){i[f]=d;const y=Sy(d)?[]:{};return wR(d,(R,w)=>{const N=a(R,f+1);!dR(N)&&(y[w]=N)}),i[f]=void 0,y}}return d};return a(o,0)},Pse=kl("AsyncFunction"),Lse=o=>o&&(MI(o)||mo(o))&&mo(o.then)&&mo(o.catch),wz=((o,i)=>o?setImmediate:i?((a,d)=>(Qm.addEventListener("message",({source:f,data:y})=>{f===Qm&&y===a&&d.length&&d.shift()()},!1),f=>{d.push(f),Qm.postMessage(a,"*")}))(`axios@${Math.random()}`,[]):a=>setTimeout(a))(typeof setImmediate=="function",mo(Qm.postMessage)),kse=typeof queueMicrotask<"u"?queueMicrotask.bind(Qm):typeof process<"u"&&process.nextTick||wz,xse=o=>o!=null&&mo(o[LI]),Qe={isArray:Sy,isArrayBuffer:Sz,isBuffer:$re,isFormData:ose,isArrayBufferView:Zre,isString:ese,isNumber:Tz,isBoolean:tse,isObject:MI,isPlainObject:d0,isReadableStream:lse,isRequest:dse,isResponse:use,isHeaders:hse,isUndefined:dR,isDate:nse,isFile:ise,isBlob:rse,isRegExp:Cse,isFunction:mo,isStream:ase,isURLSearchParams:cse,isTypedArray:vse,isFileList:sse,forEach:wR,merge:Qk,extend:fse,trim:pse,stripBOM:mse,inherits:_se,toFlatObject:gse,kindOf:kI,kindOfTest:kl,endsWith:Ese,toArray:yse,forEachEntry:Sse,matchAll:Tse,isHTMLForm:Rse,hasOwnProperty:FG,hasOwnProp:FG,reduceDescriptors:Cz,freezeMethods:wse,toObjectSet:Ase,toCamelCase:bse,noop:Ise,toFiniteNumber:Nse,findKey:Rz,global:Qm,isContextDefined:bz,isSpecCompliantForm:Ose,toJSONObject:Dse,isAsyncFn:Pse,isThenable:Lse,setImmediate:wz,asap:kse,isIterable:xse};function Ln(o,i,a,d,f){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",i&&(this.code=i),a&&(this.config=a),d&&(this.request=d),f&&(this.response=f,this.status=f.status?f.status:null)}Qe.inherits(Ln,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Qe.toJSONObject(this.config),code:this.code,status:this.status}}});const Az=Ln.prototype,Iz={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{Iz[o]={value:o}});Object.defineProperties(Ln,Iz);Object.defineProperty(Az,"isAxiosError",{value:!0});Ln.from=(o,i,a,d,f,y)=>{const R=Object.create(Az);return Qe.toFlatObject(o,R,function(N){return N!==Error.prototype},w=>w!=="isAxiosError"),Ln.call(R,o.message,i,a,d,f),R.cause=o,R.name=o.name,y&&Object.assign(R,y),R};const Mse=null;function $k(o){return Qe.isPlainObject(o)||Qe.isArray(o)}function Nz(o){return Qe.endsWith(o,"[]")?o.slice(0,-2):o}function BG(o,i,a){return o?o.concat(i).map(function(f,y){return f=Nz(f),!a&&y?"["+f+"]":f}).join(a?".":""):i}function Use(o){return Qe.isArray(o)&&!o.some($k)}const jse=Qe.toFlatObject(Qe,{},null,function(i){return/^is[A-Z]/.test(i)});function UI(o,i,a){if(!Qe.isObject(o))throw new TypeError("target must be an object");i=i||new FormData,a=Qe.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(se,te){return!Qe.isUndefined(te[se])});const d=a.metaTokens,f=a.visitor||x,y=a.dots,R=a.indexes,N=(a.Blob||typeof Blob<"u"&&Blob)&&Qe.isSpecCompliantForm(i);if(!Qe.isFunction(f))throw new TypeError("visitor must be a function");function O(Q){if(Q===null)return"";if(Qe.isDate(Q))return Q.toISOString();if(!N&&Qe.isBlob(Q))throw new Ln("Blob is not supported. Use a Buffer instead.");return Qe.isArrayBuffer(Q)||Qe.isTypedArray(Q)?N&&typeof Blob=="function"?new Blob([Q]):Buffer.from(Q):Q}function x(Q,se,te){let le=Q;if(Q&&!te&&typeof Q=="object"){if(Qe.endsWith(se,"{}"))se=d?se:se.slice(0,-2),Q=JSON.stringify(Q);else if(Qe.isArray(Q)&&Use(Q)||(Qe.isFileList(Q)||Qe.endsWith(se,"[]"))&&(le=Qe.toArray(Q)))return se=Nz(se),le.forEach(function(me,Ce){!(Qe.isUndefined(me)||me===null)&&i.append(R===!0?BG([se],Ce,y):R===null?se:se+"[]",O(me))}),!1}return $k(Q)?!0:(i.append(BG(te,se,y),O(Q)),!1)}const G=[],W=Object.assign(jse,{defaultVisitor:x,convertValue:O,isVisitable:$k});function ne(Q,se){if(!Qe.isUndefined(Q)){if(G.indexOf(Q)!==-1)throw Error("Circular reference detected in "+se.join("."));G.push(Q),Qe.forEach(Q,function(le,ce){(!(Qe.isUndefined(le)||le===null)&&f.call(i,le,Qe.isString(ce)?ce.trim():ce,se,W))===!0&&ne(le,se?se.concat(ce):[ce])}),G.pop()}}if(!Qe.isObject(o))throw new TypeError("data must be an object");return ne(o),i}function GG(o){const i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(d){return i[d]})}function Qx(o,i){this._pairs=[],o&&UI(o,this,i)}const Oz=Qx.prototype;Oz.append=function(i,a){this._pairs.push([i,a])};Oz.toString=function(i){const a=i?function(d){return i.call(this,d,GG)}:GG;return this._pairs.map(function(f){return a(f[0])+"="+a(f[1])},"").join("&")};function Vse(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Dz(o,i,a){if(!i)return o;const d=a&&a.encode||Vse;Qe.isFunction(a)&&(a={serialize:a});const f=a&&a.serialize;let y;if(f?y=f(i,a):y=Qe.isURLSearchParams(i)?i.toString():new Qx(i,a).toString(d),y){const R=o.indexOf("#");R!==-1&&(o=o.slice(0,R)),o+=(o.indexOf("?")===-1?"?":"&")+y}return o}class HG{constructor(){this.handlers=[]}use(i,a,d){return this.handlers.push({fulfilled:i,rejected:a,synchronous:d?d.synchronous:!1,runWhen:d?d.runWhen:null}),this.handlers.length-1}eject(i){this.handlers[i]&&(this.handlers[i]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(i){Qe.forEach(this.handlers,function(d){d!==null&&i(d)})}}const Pz={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Fse=typeof URLSearchParams<"u"?URLSearchParams:Qx,Bse=typeof FormData<"u"?FormData:null,Gse=typeof Blob<"u"?Blob:null,Hse={isBrowser:!0,classes:{URLSearchParams:Fse,FormData:Bse,Blob:Gse},protocols:["http","https","file","blob","url","data"]},$x=typeof window<"u"&&typeof document<"u",Zk=typeof navigator=="object"&&navigator||void 0,zse=$x&&(!Zk||["ReactNative","NativeScript","NS"].indexOf(Zk.product)<0),Wse=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",qse=$x&&window.location.href||"http://localhost",Kse=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:$x,hasStandardBrowserEnv:zse,hasStandardBrowserWebWorkerEnv:Wse,navigator:Zk,origin:qse},Symbol.toStringTag,{value:"Module"})),ga={...Kse,...Hse};function Yse(o,i){return UI(o,new ga.classes.URLSearchParams,Object.assign({visitor:function(a,d,f,y){return ga.isNode&&Qe.isBuffer(a)?(this.append(d,a.toString("base64")),!1):y.defaultVisitor.apply(this,arguments)}},i))}function Xse(o){return Qe.matchAll(/\w+|\[(\w*)]/g,o).map(i=>i[0]==="[]"?"":i[1]||i[0])}function Jse(o){const i={},a=Object.keys(o);let d;const f=a.length;let y;for(d=0;d<f;d++)y=a[d],i[y]=o[y];return i}function Lz(o){function i(a,d,f,y){let R=a[y++];if(R==="__proto__")return!0;const w=Number.isFinite(+R),N=y>=a.length;return R=!R&&Qe.isArray(f)?f.length:R,N?(Qe.hasOwnProp(f,R)?f[R]=[f[R],d]:f[R]=d,!w):((!f[R]||!Qe.isObject(f[R]))&&(f[R]=[]),i(a,d,f[R],y)&&Qe.isArray(f[R])&&(f[R]=Jse(f[R])),!w)}if(Qe.isFormData(o)&&Qe.isFunction(o.entries)){const a={};return Qe.forEachEntry(o,(d,f)=>{i(Xse(d),f,a,0)}),a}return null}function Qse(o,i,a){if(Qe.isString(o))try{return(i||JSON.parse)(o),Qe.trim(o)}catch(d){if(d.name!=="SyntaxError")throw d}return(a||JSON.stringify)(o)}const AR={transitional:Pz,adapter:["xhr","http","fetch"],transformRequest:[function(i,a){const d=a.getContentType()||"",f=d.indexOf("application/json")>-1,y=Qe.isObject(i);if(y&&Qe.isHTMLForm(i)&&(i=new FormData(i)),Qe.isFormData(i))return f?JSON.stringify(Lz(i)):i;if(Qe.isArrayBuffer(i)||Qe.isBuffer(i)||Qe.isStream(i)||Qe.isFile(i)||Qe.isBlob(i)||Qe.isReadableStream(i))return i;if(Qe.isArrayBufferView(i))return i.buffer;if(Qe.isURLSearchParams(i))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),i.toString();let w;if(y){if(d.indexOf("application/x-www-form-urlencoded")>-1)return Yse(i,this.formSerializer).toString();if((w=Qe.isFileList(i))||d.indexOf("multipart/form-data")>-1){const N=this.env&&this.env.FormData;return UI(w?{"files[]":i}:i,N&&new N,this.formSerializer)}}return y||f?(a.setContentType("application/json",!1),Qse(i)):i}],transformResponse:[function(i){const a=this.transitional||AR.transitional,d=a&&a.forcedJSONParsing,f=this.responseType==="json";if(Qe.isResponse(i)||Qe.isReadableStream(i))return i;if(i&&Qe.isString(i)&&(d&&!this.responseType||f)){const R=!(a&&a.silentJSONParsing)&&f;try{return JSON.parse(i)}catch(w){if(R)throw w.name==="SyntaxError"?Ln.from(w,Ln.ERR_BAD_RESPONSE,this,null,this.response):w}}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ga.classes.FormData,Blob:ga.classes.Blob},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Qe.forEach(["delete","get","head","post","put","patch"],o=>{AR.headers[o]={}});const $se=Qe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Zse=o=>{const i={};let a,d,f;return o&&o.split(`
`).forEach(function(R){f=R.indexOf(":"),a=R.substring(0,f).trim().toLowerCase(),d=R.substring(f+1).trim(),!(!a||i[a]&&$se[a])&&(a==="set-cookie"?i[a]?i[a].push(d):i[a]=[d]:i[a]=i[a]?i[a]+", "+d:d)}),i},zG=Symbol("internals");function BT(o){return o&&String(o).trim().toLowerCase()}function u0(o){return o===!1||o==null?o:Qe.isArray(o)?o.map(u0):String(o)}function eae(o){const i=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let d;for(;d=a.exec(o);)i[d[1]]=d[2];return i}const tae=o=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(o.trim());function ck(o,i,a,d,f){if(Qe.isFunction(d))return d.call(this,i,a);if(f&&(i=a),!!Qe.isString(i)){if(Qe.isString(d))return i.indexOf(d)!==-1;if(Qe.isRegExp(d))return d.test(i)}}function nae(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(i,a,d)=>a.toUpperCase()+d)}function iae(o,i){const a=Qe.toCamelCase(" "+i);["get","set","has"].forEach(d=>{Object.defineProperty(o,d+a,{value:function(f,y,R){return this[d].call(this,i,f,y,R)},configurable:!0})})}let _o=class{constructor(i){i&&this.set(i)}set(i,a,d){const f=this;function y(w,N,O){const x=BT(N);if(!x)throw new Error("header name must be a non-empty string");const G=Qe.findKey(f,x);(!G||f[G]===void 0||O===!0||O===void 0&&f[G]!==!1)&&(f[G||N]=u0(w))}const R=(w,N)=>Qe.forEach(w,(O,x)=>y(O,x,N));if(Qe.isPlainObject(i)||i instanceof this.constructor)R(i,a);else if(Qe.isString(i)&&(i=i.trim())&&!tae(i))R(Zse(i),a);else if(Qe.isObject(i)&&Qe.isIterable(i)){let w={},N,O;for(const x of i){if(!Qe.isArray(x))throw TypeError("Object iterator must return a key-value pair");w[O=x[0]]=(N=w[O])?Qe.isArray(N)?[...N,x[1]]:[N,x[1]]:x[1]}R(w,a)}else i!=null&&y(a,i,d);return this}get(i,a){if(i=BT(i),i){const d=Qe.findKey(this,i);if(d){const f=this[d];if(!a)return f;if(a===!0)return eae(f);if(Qe.isFunction(a))return a.call(this,f,d);if(Qe.isRegExp(a))return a.exec(f);throw new TypeError("parser must be boolean|regexp|function")}}}has(i,a){if(i=BT(i),i){const d=Qe.findKey(this,i);return!!(d&&this[d]!==void 0&&(!a||ck(this,this[d],d,a)))}return!1}delete(i,a){const d=this;let f=!1;function y(R){if(R=BT(R),R){const w=Qe.findKey(d,R);w&&(!a||ck(d,d[w],w,a))&&(delete d[w],f=!0)}}return Qe.isArray(i)?i.forEach(y):y(i),f}clear(i){const a=Object.keys(this);let d=a.length,f=!1;for(;d--;){const y=a[d];(!i||ck(this,this[y],y,i,!0))&&(delete this[y],f=!0)}return f}normalize(i){const a=this,d={};return Qe.forEach(this,(f,y)=>{const R=Qe.findKey(d,y);if(R){a[R]=u0(f),delete a[y];return}const w=i?nae(y):String(y).trim();w!==y&&delete a[y],a[w]=u0(f),d[w]=!0}),this}concat(...i){return this.constructor.concat(this,...i)}toJSON(i){const a=Object.create(null);return Qe.forEach(this,(d,f)=>{d!=null&&d!==!1&&(a[f]=i&&Qe.isArray(d)?d.join(", "):d)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([i,a])=>i+": "+a).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(i){return i instanceof this?i:new this(i)}static concat(i,...a){const d=new this(i);return a.forEach(f=>d.set(f)),d}static accessor(i){const d=(this[zG]=this[zG]={accessors:{}}).accessors,f=this.prototype;function y(R){const w=BT(R);d[w]||(iae(f,R),d[w]=!0)}return Qe.isArray(i)?i.forEach(y):y(i),this}};_o.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Qe.reduceDescriptors(_o.prototype,({value:o},i)=>{let a=i[0].toUpperCase()+i.slice(1);return{get:()=>o,set(d){this[a]=d}}});Qe.freezeMethods(_o);function lk(o,i){const a=this||AR,d=i||a,f=_o.from(d.headers);let y=d.data;return Qe.forEach(o,function(w){y=w.call(a,y,f.normalize(),i?i.status:void 0)}),f.normalize(),y}function kz(o){return!!(o&&o.__CANCEL__)}function Ty(o,i,a){Ln.call(this,o??"canceled",Ln.ERR_CANCELED,i,a),this.name="CanceledError"}Qe.inherits(Ty,Ln,{__CANCEL__:!0});function xz(o,i,a){const d=a.config.validateStatus;!a.status||!d||d(a.status)?o(a):i(new Ln("Request failed with status code "+a.status,[Ln.ERR_BAD_REQUEST,Ln.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}function rae(o){const i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return i&&i[1]||""}function sae(o,i){o=o||10;const a=new Array(o),d=new Array(o);let f=0,y=0,R;return i=i!==void 0?i:1e3,function(N){const O=Date.now(),x=d[y];R||(R=O),a[f]=N,d[f]=O;let G=y,W=0;for(;G!==f;)W+=a[G++],G=G%o;if(f=(f+1)%o,f===y&&(y=(y+1)%o),O-R<i)return;const ne=x&&O-x;return ne?Math.round(W*1e3/ne):void 0}}function aae(o,i){let a=0,d=1e3/i,f,y;const R=(O,x=Date.now())=>{a=x,f=null,y&&(clearTimeout(y),y=null),o.apply(null,O)};return[(...O)=>{const x=Date.now(),G=x-a;G>=d?R(O,x):(f=O,y||(y=setTimeout(()=>{y=null,R(f)},d-G)))},()=>f&&R(f)]}const rI=(o,i,a=3)=>{let d=0;const f=sae(50,250);return aae(y=>{const R=y.loaded,w=y.lengthComputable?y.total:void 0,N=R-d,O=f(N),x=R<=w;d=R;const G={loaded:R,total:w,progress:w?R/w:void 0,bytes:N,rate:O||void 0,estimated:O&&w&&x?(w-R)/O:void 0,event:y,lengthComputable:w!=null,[i?"download":"upload"]:!0};o(G)},a)},WG=(o,i)=>{const a=o!=null;return[d=>i[0]({lengthComputable:a,total:o,loaded:d}),i[1]]},qG=o=>(...i)=>Qe.asap(()=>o(...i)),oae=ga.hasStandardBrowserEnv?((o,i)=>a=>(a=new URL(a,ga.origin),o.protocol===a.protocol&&o.host===a.host&&(i||o.port===a.port)))(new URL(ga.origin),ga.navigator&&/(msie|trident)/i.test(ga.navigator.userAgent)):()=>!0,cae=ga.hasStandardBrowserEnv?{write(o,i,a,d,f,y){const R=[o+"="+encodeURIComponent(i)];Qe.isNumber(a)&&R.push("expires="+new Date(a).toGMTString()),Qe.isString(d)&&R.push("path="+d),Qe.isString(f)&&R.push("domain="+f),y===!0&&R.push("secure"),document.cookie=R.join("; ")},read(o){const i=document.cookie.match(new RegExp("(^|;\\s*)("+o+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove(o){this.write(o,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function lae(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function dae(o,i){return i?o.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):o}function Mz(o,i,a){let d=!lae(i);return o&&(d||a==!1)?dae(o,i):i}const KG=o=>o instanceof _o?{...o}:o;function s_(o,i){i=i||{};const a={};function d(O,x,G,W){return Qe.isPlainObject(O)&&Qe.isPlainObject(x)?Qe.merge.call({caseless:W},O,x):Qe.isPlainObject(x)?Qe.merge({},x):Qe.isArray(x)?x.slice():x}function f(O,x,G,W){if(Qe.isUndefined(x)){if(!Qe.isUndefined(O))return d(void 0,O,G,W)}else return d(O,x,G,W)}function y(O,x){if(!Qe.isUndefined(x))return d(void 0,x)}function R(O,x){if(Qe.isUndefined(x)){if(!Qe.isUndefined(O))return d(void 0,O)}else return d(void 0,x)}function w(O,x,G){if(G in i)return d(O,x);if(G in o)return d(void 0,O)}const N={url:y,method:y,data:y,baseURL:R,transformRequest:R,transformResponse:R,paramsSerializer:R,timeout:R,timeoutMessage:R,withCredentials:R,withXSRFToken:R,adapter:R,responseType:R,xsrfCookieName:R,xsrfHeaderName:R,onUploadProgress:R,onDownloadProgress:R,decompress:R,maxContentLength:R,maxBodyLength:R,beforeRedirect:R,transport:R,httpAgent:R,httpsAgent:R,cancelToken:R,socketPath:R,responseEncoding:R,validateStatus:w,headers:(O,x,G)=>f(KG(O),KG(x),G,!0)};return Qe.forEach(Object.keys(Object.assign({},o,i)),function(x){const G=N[x]||f,W=G(o[x],i[x],x);Qe.isUndefined(W)&&G!==w||(a[x]=W)}),a}const Uz=o=>{const i=s_({},o);let{data:a,withXSRFToken:d,xsrfHeaderName:f,xsrfCookieName:y,headers:R,auth:w}=i;i.headers=R=_o.from(R),i.url=Dz(Mz(i.baseURL,i.url,i.allowAbsoluteUrls),o.params,o.paramsSerializer),w&&R.set("Authorization","Basic "+btoa((w.username||"")+":"+(w.password?unescape(encodeURIComponent(w.password)):"")));let N;if(Qe.isFormData(a)){if(ga.hasStandardBrowserEnv||ga.hasStandardBrowserWebWorkerEnv)R.setContentType(void 0);else if((N=R.getContentType())!==!1){const[O,...x]=N?N.split(";").map(G=>G.trim()).filter(Boolean):[];R.setContentType([O||"multipart/form-data",...x].join("; "))}}if(ga.hasStandardBrowserEnv&&(d&&Qe.isFunction(d)&&(d=d(i)),d||d!==!1&&oae(i.url))){const O=f&&y&&cae.read(y);O&&R.set(f,O)}return i},uae=typeof XMLHttpRequest<"u",hae=uae&&function(o){return new Promise(function(a,d){const f=Uz(o);let y=f.data;const R=_o.from(f.headers).normalize();let{responseType:w,onUploadProgress:N,onDownloadProgress:O}=f,x,G,W,ne,Q;function se(){ne&&ne(),Q&&Q(),f.cancelToken&&f.cancelToken.unsubscribe(x),f.signal&&f.signal.removeEventListener("abort",x)}let te=new XMLHttpRequest;te.open(f.method.toUpperCase(),f.url,!0),te.timeout=f.timeout;function le(){if(!te)return;const me=_o.from("getAllResponseHeaders"in te&&te.getAllResponseHeaders()),_e={data:!w||w==="text"||w==="json"?te.responseText:te.response,status:te.status,statusText:te.statusText,headers:me,config:o,request:te};xz(function(Z){a(Z),se()},function(Z){d(Z),se()},_e),te=null}"onloadend"in te?te.onloadend=le:te.onreadystatechange=function(){!te||te.readyState!==4||te.status===0&&!(te.responseURL&&te.responseURL.indexOf("file:")===0)||setTimeout(le)},te.onabort=function(){te&&(d(new Ln("Request aborted",Ln.ECONNABORTED,o,te)),te=null)},te.onerror=function(){d(new Ln("Network Error",Ln.ERR_NETWORK,o,te)),te=null},te.ontimeout=function(){let Ce=f.timeout?"timeout of "+f.timeout+"ms exceeded":"timeout exceeded";const _e=f.transitional||Pz;f.timeoutErrorMessage&&(Ce=f.timeoutErrorMessage),d(new Ln(Ce,_e.clarifyTimeoutError?Ln.ETIMEDOUT:Ln.ECONNABORTED,o,te)),te=null},y===void 0&&R.setContentType(null),"setRequestHeader"in te&&Qe.forEach(R.toJSON(),function(Ce,_e){te.setRequestHeader(_e,Ce)}),Qe.isUndefined(f.withCredentials)||(te.withCredentials=!!f.withCredentials),w&&w!=="json"&&(te.responseType=f.responseType),O&&([W,Q]=rI(O,!0),te.addEventListener("progress",W)),N&&te.upload&&([G,ne]=rI(N),te.upload.addEventListener("progress",G),te.upload.addEventListener("loadend",ne)),(f.cancelToken||f.signal)&&(x=me=>{te&&(d(!me||me.type?new Ty(null,o,te):me),te.abort(),te=null)},f.cancelToken&&f.cancelToken.subscribe(x),f.signal&&(f.signal.aborted?x():f.signal.addEventListener("abort",x)));const ce=rae(f.url);if(ce&&ga.protocols.indexOf(ce)===-1){d(new Ln("Unsupported protocol "+ce+":",Ln.ERR_BAD_REQUEST,o));return}te.send(y||null)})},pae=(o,i)=>{const{length:a}=o=o?o.filter(Boolean):[];if(i||a){let d=new AbortController,f;const y=function(O){if(!f){f=!0,w();const x=O instanceof Error?O:this.reason;d.abort(x instanceof Ln?x:new Ty(x instanceof Error?x.message:x))}};let R=i&&setTimeout(()=>{R=null,y(new Ln(`timeout ${i} of ms exceeded`,Ln.ETIMEDOUT))},i);const w=()=>{o&&(R&&clearTimeout(R),R=null,o.forEach(O=>{O.unsubscribe?O.unsubscribe(y):O.removeEventListener("abort",y)}),o=null)};o.forEach(O=>O.addEventListener("abort",y));const{signal:N}=d;return N.unsubscribe=()=>Qe.asap(w),N}},fae=function*(o,i){let a=o.byteLength;if(a<i){yield o;return}let d=0,f;for(;d<a;)f=d+i,yield o.slice(d,f),d=f},mae=async function*(o,i){for await(const a of _ae(o))yield*fae(a,i)},_ae=async function*(o){if(o[Symbol.asyncIterator]){yield*o;return}const i=o.getReader();try{for(;;){const{done:a,value:d}=await i.read();if(a)break;yield d}}finally{await i.cancel()}},YG=(o,i,a,d)=>{const f=mae(o,i);let y=0,R,w=N=>{R||(R=!0,d&&d(N))};return new ReadableStream({async pull(N){try{const{done:O,value:x}=await f.next();if(O){w(),N.close();return}let G=x.byteLength;if(a){let W=y+=G;a(W)}N.enqueue(new Uint8Array(x))}catch(O){throw w(O),O}},cancel(N){return w(N),f.return()}},{highWaterMark:2})},jI=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",jz=jI&&typeof ReadableStream=="function",gae=jI&&(typeof TextEncoder=="function"?(o=>i=>o.encode(i))(new TextEncoder):async o=>new Uint8Array(await new Response(o).arrayBuffer())),Vz=(o,...i)=>{try{return!!o(...i)}catch{return!1}},Eae=jz&&Vz(()=>{let o=!1;const i=new Request(ga.origin,{body:new ReadableStream,method:"POST",get duplex(){return o=!0,"half"}}).headers.has("Content-Type");return o&&!i}),XG=64*1024,ex=jz&&Vz(()=>Qe.isReadableStream(new Response("").body)),sI={stream:ex&&(o=>o.body)};jI&&(o=>{["text","arrayBuffer","blob","formData","stream"].forEach(i=>{!sI[i]&&(sI[i]=Qe.isFunction(o[i])?a=>a[i]():(a,d)=>{throw new Ln(`Response type '${i}' is not supported`,Ln.ERR_NOT_SUPPORT,d)})})})(new Response);const yae=async o=>{if(o==null)return 0;if(Qe.isBlob(o))return o.size;if(Qe.isSpecCompliantForm(o))return(await new Request(ga.origin,{method:"POST",body:o}).arrayBuffer()).byteLength;if(Qe.isArrayBufferView(o)||Qe.isArrayBuffer(o))return o.byteLength;if(Qe.isURLSearchParams(o)&&(o=o+""),Qe.isString(o))return(await gae(o)).byteLength},vae=async(o,i)=>{const a=Qe.toFiniteNumber(o.getContentLength());return a??yae(i)},Sae=jI&&(async o=>{let{url:i,method:a,data:d,signal:f,cancelToken:y,timeout:R,onDownloadProgress:w,onUploadProgress:N,responseType:O,headers:x,withCredentials:G="same-origin",fetchOptions:W}=Uz(o);O=O?(O+"").toLowerCase():"text";let ne=pae([f,y&&y.toAbortSignal()],R),Q;const se=ne&&ne.unsubscribe&&(()=>{ne.unsubscribe()});let te;try{if(N&&Eae&&a!=="get"&&a!=="head"&&(te=await vae(x,d))!==0){let _e=new Request(i,{method:"POST",body:d,duplex:"half"}),ze;if(Qe.isFormData(d)&&(ze=_e.headers.get("content-type"))&&x.setContentType(ze),_e.body){const[Z,J]=WG(te,rI(qG(N)));d=YG(_e.body,XG,Z,J)}}Qe.isString(G)||(G=G?"include":"omit");const le="credentials"in Request.prototype;Q=new Request(i,{...W,signal:ne,method:a.toUpperCase(),headers:x.normalize().toJSON(),body:d,duplex:"half",credentials:le?G:void 0});let ce=await fetch(Q);const me=ex&&(O==="stream"||O==="response");if(ex&&(w||me&&se)){const _e={};["status","statusText","headers"].forEach($=>{_e[$]=ce[$]});const ze=Qe.toFiniteNumber(ce.headers.get("content-length")),[Z,J]=w&&WG(ze,rI(qG(w),!0))||[];ce=new Response(YG(ce.body,XG,Z,()=>{J&&J(),se&&se()}),_e)}O=O||"text";let Ce=await sI[Qe.findKey(sI,O)||"text"](ce,o);return!me&&se&&se(),await new Promise((_e,ze)=>{xz(_e,ze,{data:Ce,headers:_o.from(ce.headers),status:ce.status,statusText:ce.statusText,config:o,request:Q})})}catch(le){throw se&&se(),le&&le.name==="TypeError"&&/Load failed|fetch/i.test(le.message)?Object.assign(new Ln("Network Error",Ln.ERR_NETWORK,o,Q),{cause:le.cause||le}):Ln.from(le,le&&le.code,o,Q)}}),tx={http:Mse,xhr:hae,fetch:Sae};Qe.forEach(tx,(o,i)=>{if(o){try{Object.defineProperty(o,"name",{value:i})}catch{}Object.defineProperty(o,"adapterName",{value:i})}});const JG=o=>`- ${o}`,Tae=o=>Qe.isFunction(o)||o===null||o===!1,Fz={getAdapter:o=>{o=Qe.isArray(o)?o:[o];const{length:i}=o;let a,d;const f={};for(let y=0;y<i;y++){a=o[y];let R;if(d=a,!Tae(a)&&(d=tx[(R=String(a)).toLowerCase()],d===void 0))throw new Ln(`Unknown adapter '${R}'`);if(d)break;f[R||"#"+y]=d}if(!d){const y=Object.entries(f).map(([w,N])=>`adapter ${w} `+(N===!1?"is not supported by the environment":"is not available in the build"));let R=i?y.length>1?`since :
`+y.map(JG).join(`
`):" "+JG(y[0]):"as no adapter specified";throw new Ln("There is no suitable adapter to dispatch the request "+R,"ERR_NOT_SUPPORT")}return d},adapters:tx};function dk(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new Ty(null,o)}function QG(o){return dk(o),o.headers=_o.from(o.headers),o.data=lk.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),Fz.getAdapter(o.adapter||AR.adapter)(o).then(function(d){return dk(o),d.data=lk.call(o,o.transformResponse,d),d.headers=_o.from(d.headers),d},function(d){return kz(d)||(dk(o),d&&d.response&&(d.response.data=lk.call(o,o.transformResponse,d.response),d.response.headers=_o.from(d.response.headers))),Promise.reject(d)})}const Bz="1.9.0",VI={};["object","boolean","number","function","string","symbol"].forEach((o,i)=>{VI[o]=function(d){return typeof d===o||"a"+(i<1?"n ":" ")+o}});const $G={};VI.transitional=function(i,a,d){function f(y,R){return"[Axios v"+Bz+"] Transitional option '"+y+"'"+R+(d?". "+d:"")}return(y,R,w)=>{if(i===!1)throw new Ln(f(R," has been removed"+(a?" in "+a:"")),Ln.ERR_DEPRECATED);return a&&!$G[R]&&($G[R]=!0,console.warn(f(R," has been deprecated since v"+a+" and will be removed in the near future"))),i?i(y,R,w):!0}};VI.spelling=function(i){return(a,d)=>(console.warn(`${d} is likely a misspelling of ${i}`),!0)};function Rae(o,i,a){if(typeof o!="object")throw new Ln("options must be an object",Ln.ERR_BAD_OPTION_VALUE);const d=Object.keys(o);let f=d.length;for(;f-- >0;){const y=d[f],R=i[y];if(R){const w=o[y],N=w===void 0||R(w,y,o);if(N!==!0)throw new Ln("option "+y+" must be "+N,Ln.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new Ln("Unknown option "+y,Ln.ERR_BAD_OPTION)}}const h0={assertOptions:Rae,validators:VI},Ud=h0.validators;let e_=class{constructor(i){this.defaults=i||{},this.interceptors={request:new HG,response:new HG}}async request(i,a){try{return await this._request(i,a)}catch(d){if(d instanceof Error){let f={};Error.captureStackTrace?Error.captureStackTrace(f):f=new Error;const y=f.stack?f.stack.replace(/^.+\n/,""):"";try{d.stack?y&&!String(d.stack).endsWith(y.replace(/^.+\n.+\n/,""))&&(d.stack+=`
`+y):d.stack=y}catch{}}throw d}}_request(i,a){typeof i=="string"?(a=a||{},a.url=i):a=i||{},a=s_(this.defaults,a);const{transitional:d,paramsSerializer:f,headers:y}=a;d!==void 0&&h0.assertOptions(d,{silentJSONParsing:Ud.transitional(Ud.boolean),forcedJSONParsing:Ud.transitional(Ud.boolean),clarifyTimeoutError:Ud.transitional(Ud.boolean)},!1),f!=null&&(Qe.isFunction(f)?a.paramsSerializer={serialize:f}:h0.assertOptions(f,{encode:Ud.function,serialize:Ud.function},!0)),a.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?a.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:a.allowAbsoluteUrls=!0),h0.assertOptions(a,{baseUrl:Ud.spelling("baseURL"),withXsrfToken:Ud.spelling("withXSRFToken")},!0),a.method=(a.method||this.defaults.method||"get").toLowerCase();let R=y&&Qe.merge(y.common,y[a.method]);y&&Qe.forEach(["delete","get","head","post","put","patch","common"],Q=>{delete y[Q]}),a.headers=_o.concat(R,y);const w=[];let N=!0;this.interceptors.request.forEach(function(se){typeof se.runWhen=="function"&&se.runWhen(a)===!1||(N=N&&se.synchronous,w.unshift(se.fulfilled,se.rejected))});const O=[];this.interceptors.response.forEach(function(se){O.push(se.fulfilled,se.rejected)});let x,G=0,W;if(!N){const Q=[QG.bind(this),void 0];for(Q.unshift.apply(Q,w),Q.push.apply(Q,O),W=Q.length,x=Promise.resolve(a);G<W;)x=x.then(Q[G++],Q[G++]);return x}W=w.length;let ne=a;for(G=0;G<W;){const Q=w[G++],se=w[G++];try{ne=Q(ne)}catch(te){se.call(this,te);break}}try{x=QG.call(this,ne)}catch(Q){return Promise.reject(Q)}for(G=0,W=O.length;G<W;)x=x.then(O[G++],O[G++]);return x}getUri(i){i=s_(this.defaults,i);const a=Mz(i.baseURL,i.url,i.allowAbsoluteUrls);return Dz(a,i.params,i.paramsSerializer)}};Qe.forEach(["delete","get","head","options"],function(i){e_.prototype[i]=function(a,d){return this.request(s_(d||{},{method:i,url:a,data:(d||{}).data}))}});Qe.forEach(["post","put","patch"],function(i){function a(d){return function(y,R,w){return this.request(s_(w||{},{method:i,headers:d?{"Content-Type":"multipart/form-data"}:{},url:y,data:R}))}}e_.prototype[i]=a(),e_.prototype[i+"Form"]=a(!0)});let bae=class Gz{constructor(i){if(typeof i!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(y){a=y});const d=this;this.promise.then(f=>{if(!d._listeners)return;let y=d._listeners.length;for(;y-- >0;)d._listeners[y](f);d._listeners=null}),this.promise.then=f=>{let y;const R=new Promise(w=>{d.subscribe(w),y=w}).then(f);return R.cancel=function(){d.unsubscribe(y)},R},i(function(y,R,w){d.reason||(d.reason=new Ty(y,R,w),a(d.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(i){if(this.reason){i(this.reason);return}this._listeners?this._listeners.push(i):this._listeners=[i]}unsubscribe(i){if(!this._listeners)return;const a=this._listeners.indexOf(i);a!==-1&&this._listeners.splice(a,1)}toAbortSignal(){const i=new AbortController,a=d=>{i.abort(d)};return this.subscribe(a),i.signal.unsubscribe=()=>this.unsubscribe(a),i.signal}static source(){let i;return{token:new Gz(function(f){i=f}),cancel:i}}};function Cae(o){return function(a){return o.apply(null,a)}}function wae(o){return Qe.isObject(o)&&o.isAxiosError===!0}const nx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(nx).forEach(([o,i])=>{nx[i]=o});function Hz(o){const i=new e_(o),a=yz(e_.prototype.request,i);return Qe.extend(a,e_.prototype,i,{allOwnKeys:!0}),Qe.extend(a,i,null,{allOwnKeys:!0}),a.create=function(f){return Hz(s_(o,f))},a}const Qr=Hz(AR);Qr.Axios=e_;Qr.CanceledError=Ty;Qr.CancelToken=bae;Qr.isCancel=kz;Qr.VERSION=Bz;Qr.toFormData=UI;Qr.AxiosError=Ln;Qr.Cancel=Qr.CanceledError;Qr.all=function(i){return Promise.all(i)};Qr.spread=Cae;Qr.isAxiosError=wae;Qr.mergeConfig=s_;Qr.AxiosHeaders=_o;Qr.formToJSON=o=>Lz(Qe.isHTMLForm(o)?new FormData(o):o);Qr.getAdapter=Fz.getAdapter;Qr.HttpStatusCode=nx;Qr.default=Qr;const{Axios:nfe,AxiosError:ife,CanceledError:rfe,isCancel:sfe,CancelToken:afe,VERSION:ofe,all:cfe,Cancel:lfe,isAxiosError:dfe,spread:ufe,toFormData:hfe,AxiosHeaders:pfe,HttpStatusCode:ffe,formToJSON:mfe,getAdapter:_fe,mergeConfig:gfe}=Qr,Yn=Qr.create({baseURL:"https://awplconnectadmin.tgastaging.com/api"}),Aae=o=>Yn.post("/email-valid",o),Iae=o=>Yn.post("/login-password",o),Nae=o=>Yn.post("/forgot-password",o),Oae=o=>Yn.post("/otp-verfication",o),Dae=o=>Yn.post("/resend-otp",o),Pae=o=>Yn.post("/reset-password",o),Lae=o=>Yn.post("/first-login",o),kae=()=>{var o;return Yn.get("/doctor/profile",{headers:{Authorization:`Bearer ${(o=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:o.token}`}})},xae=o=>{var i;return Yn.post("/doctor/profile/update",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"multipart/form-data"}})},Mae=o=>{var i;return Yn.post("/doctor/profile/photo",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"multipart/form-data"}})},Uae=()=>{var o;return Yn.delete("/doctor/profile/photo",{headers:{Authorization:`Bearer ${(o=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:o.token}`}})},jae=()=>{var o;return Yn.get("/doctor/prescriptions/pending",{headers:{Authorization:`Bearer ${(o=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:o.token}`}})},Vae=()=>{var o;return Yn.get("/doctor/prescriptions/completed",{headers:{Authorization:`Bearer ${(o=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:o.token}`}})},Fae=o=>{var i;return Yn.post("/getScheduleTime",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`}})},Bae=o=>{var i;return Yn.post("/get_symptom",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"multipart/form-data"}})},Gae=o=>{var i;return Yn.post("/doctor/prescriptions/submit",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"application/json"}})},Hae=o=>{var i;return Yn.post("/create-channel",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"application/json"}})},zae=o=>{var i;return Yn.post("/call-notification",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"application/json"}})},Wae=o=>{var i;return Yn.post("/doctor-home",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"multipart/form-data"}})},qae=o=>{var i;return Yn.post("/api/logout",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`}})},Kae=()=>{var o;return Yn.post("/doctor/appointments/upcoming",{},{headers:{Authorization:`Bearer ${(o=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:o.token}`}})},Yae=()=>{var o;return Yn.post("/doctor/appointments/completed",{},{headers:{Authorization:`Bearer ${(o=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:o.token}`}})},Xae=()=>{var o;return Yn.post("/doctor/appointments/cancelled",{},{headers:{Authorization:`Bearer ${(o=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:o.token}`}})},Jae=o=>{var i;return Yn.post("/doctor/appointments/cancel",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"multipart/form-data"}})},Qae=o=>{var i;return Yn.post("/doctor/appointments/details",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"multipart/form-data"}})},$ae=o=>{var i;return Yn.post("/doctor/prescriptions/details",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"multipart/form-data"}})},Zae=o=>{var i;return Yn.post("/doctor/patients/profile",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"multipart/form-data"}})},eoe=o=>{var i;return Yn.post("/doctor/prescriptions/download",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"multipart/form-data"},responseType:"blob"})},toe=()=>{var o;return Yn.get("/doctor/notifications",{headers:{Authorization:`Bearer ${(o=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:o.token}`}})},noe=o=>{var i;return Yn.delete("/doctor/notifications/delete",{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"application/json"},data:{notification_ids:o}})},ioe=o=>{var i;return Yn.patch("/doctor/notifications/read",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"application/json"}})},roe=o=>{var i;return Yn.post("/doctor/medicines/search",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"multipart/form-data"}})},soe=()=>{var o;return Yn.get("/doctor/notifications/unread-count",{headers:{Authorization:`Bearer ${(o=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:o.token}`}})},aoe=()=>{var o;return Yn.get("/doctor/appointment-notifications-status",{headers:{Authorization:`Bearer ${(o=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:o.token}`}})},ooe=o=>{var i;return Yn.patch("/doctor/appointment-notifications-toggle",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`}})},coe=o=>{var i;return Yn.post("/doctor/patients/past",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"multipart/form-data"}})},loe=o=>{var i;return Yn.post("/doctor/appointments/reminders",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`}})},doe=o=>{var i;return Yn.post("/doctor/appointments/scheduleAppointmentByDoctor",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"multipart/form-data"}})},uoe=o=>{var i;return Yn.post("/doctor/prescriptions/submit_appointment_prescription",o,{headers:{Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("doctor-app")))==null?void 0:i.token}`,"Content-Type":"application/json"}})};function zz(o){var i,a,d="";if(typeof o=="string"||typeof o=="number")d+=o;else if(typeof o=="object")if(Array.isArray(o)){var f=o.length;for(i=0;i<f;i++)o[i]&&(a=zz(o[i]))&&(d&&(d+=" "),d+=a)}else for(a in o)o[a]&&(d&&(d+=" "),d+=a);return d}function t_(){for(var o,i,a=0,d="",f=arguments.length;a<f;a++)(o=arguments[a])&&(i=zz(o))&&(d&&(d+=" "),d+=i);return d}function hoe(o){if(typeof document>"u")return;let i=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",i.firstChild?i.insertBefore(a,i.firstChild):i.appendChild(a),a.styleSheet?a.styleSheet.cssText=o:a.appendChild(document.createTextNode(o))}hoe(`:root{--toastify-color-light: #fff;--toastify-color-dark: #121212;--toastify-color-info: #3498db;--toastify-color-success: #07bc0c;--toastify-color-warning: #f1c40f;--toastify-color-error: hsl(6, 78%, 57%);--toastify-color-transparent: rgba(255, 255, 255, .7);--toastify-icon-color-info: var(--toastify-color-info);--toastify-icon-color-success: var(--toastify-color-success);--toastify-icon-color-warning: var(--toastify-color-warning);--toastify-icon-color-error: var(--toastify-color-error);--toastify-container-width: fit-content;--toastify-toast-width: 320px;--toastify-toast-offset: 16px;--toastify-toast-top: max(var(--toastify-toast-offset), env(safe-area-inset-top));--toastify-toast-right: max(var(--toastify-toast-offset), env(safe-area-inset-right));--toastify-toast-left: max(var(--toastify-toast-offset), env(safe-area-inset-left));--toastify-toast-bottom: max(var(--toastify-toast-offset), env(safe-area-inset-bottom));--toastify-toast-background: #fff;--toastify-toast-padding: 14px;--toastify-toast-min-height: 64px;--toastify-toast-max-height: 800px;--toastify-toast-bd-radius: 6px;--toastify-toast-shadow: 0px 4px 12px rgba(0, 0, 0, .1);--toastify-font-family: sans-serif;--toastify-z-index: 9999;--toastify-text-color-light: #757575;--toastify-text-color-dark: #fff;--toastify-text-color-info: #fff;--toastify-text-color-success: #fff;--toastify-text-color-warning: #fff;--toastify-text-color-error: #fff;--toastify-spinner-color: #616161;--toastify-spinner-color-empty-area: #e0e0e0;--toastify-color-progress-light: linear-gradient(to right, #4cd964, #5ac8fa, #007aff, #34aadc, #5856d6, #ff2d55);--toastify-color-progress-dark: #bb86fc;--toastify-color-progress-info: var(--toastify-color-info);--toastify-color-progress-success: var(--toastify-color-success);--toastify-color-progress-warning: var(--toastify-color-warning);--toastify-color-progress-error: var(--toastify-color-error);--toastify-color-progress-bgo: .2}.Toastify__toast-container{z-index:var(--toastify-z-index);-webkit-transform:translate3d(0,0,var(--toastify-z-index));position:fixed;width:var(--toastify-container-width);box-sizing:border-box;color:#fff;display:flex;flex-direction:column}.Toastify__toast-container--top-left{top:var(--toastify-toast-top);left:var(--toastify-toast-left)}.Toastify__toast-container--top-center{top:var(--toastify-toast-top);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--top-right{top:var(--toastify-toast-top);right:var(--toastify-toast-right);align-items:end}.Toastify__toast-container--bottom-left{bottom:var(--toastify-toast-bottom);left:var(--toastify-toast-left)}.Toastify__toast-container--bottom-center{bottom:var(--toastify-toast-bottom);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--bottom-right{bottom:var(--toastify-toast-bottom);right:var(--toastify-toast-right);align-items:end}.Toastify__toast{--y: 0;position:relative;touch-action:none;width:var(--toastify-toast-width);min-height:var(--toastify-toast-min-height);box-sizing:border-box;margin-bottom:1rem;padding:var(--toastify-toast-padding);border-radius:var(--toastify-toast-bd-radius);box-shadow:var(--toastify-toast-shadow);max-height:var(--toastify-toast-max-height);font-family:var(--toastify-font-family);z-index:0;display:flex;flex:1 auto;align-items:center;word-break:break-word}@media only screen and (max-width: 480px){.Toastify__toast-container{width:100vw;left:env(safe-area-inset-left);margin:0}.Toastify__toast-container--top-left,.Toastify__toast-container--top-center,.Toastify__toast-container--top-right{top:env(safe-area-inset-top);transform:translate(0)}.Toastify__toast-container--bottom-left,.Toastify__toast-container--bottom-center,.Toastify__toast-container--bottom-right{bottom:env(safe-area-inset-bottom);transform:translate(0)}.Toastify__toast-container--rtl{right:env(safe-area-inset-right);left:initial}.Toastify__toast{--toastify-toast-width: 100%;margin-bottom:0;border-radius:0}}.Toastify__toast-container[data-stacked=true]{width:var(--toastify-toast-width)}.Toastify__toast--stacked{position:absolute;width:100%;transform:translate3d(0,var(--y),0) scale(var(--s));transition:transform .3s}.Toastify__toast--stacked[data-collapsed] .Toastify__toast-body,.Toastify__toast--stacked[data-collapsed] .Toastify__close-button{transition:opacity .1s}.Toastify__toast--stacked[data-collapsed=false]{overflow:visible}.Toastify__toast--stacked[data-collapsed=true]:not(:last-child)>*{opacity:0}.Toastify__toast--stacked:after{content:"";position:absolute;left:0;right:0;height:calc(var(--g) * 1px);bottom:100%}.Toastify__toast--stacked[data-pos=top]{top:0}.Toastify__toast--stacked[data-pos=bot]{bottom:0}.Toastify__toast--stacked[data-pos=bot].Toastify__toast--stacked:before{transform-origin:top}.Toastify__toast--stacked[data-pos=top].Toastify__toast--stacked:before{transform-origin:bottom}.Toastify__toast--stacked:before{content:"";position:absolute;left:0;right:0;bottom:0;height:100%;transform:scaleY(3);z-index:-1}.Toastify__toast--rtl{direction:rtl}.Toastify__toast--close-on-click{cursor:pointer}.Toastify__toast-icon{margin-inline-end:10px;width:22px;flex-shrink:0;display:flex}.Toastify--animate{animation-fill-mode:both;animation-duration:.5s}.Toastify--animate-icon{animation-fill-mode:both;animation-duration:.3s}.Toastify__toast-theme--dark{background:var(--toastify-color-dark);color:var(--toastify-text-color-dark)}.Toastify__toast-theme--light,.Toastify__toast-theme--colored.Toastify__toast--default{background:var(--toastify-color-light);color:var(--toastify-text-color-light)}.Toastify__toast-theme--colored.Toastify__toast--info{color:var(--toastify-text-color-info);background:var(--toastify-color-info)}.Toastify__toast-theme--colored.Toastify__toast--success{color:var(--toastify-text-color-success);background:var(--toastify-color-success)}.Toastify__toast-theme--colored.Toastify__toast--warning{color:var(--toastify-text-color-warning);background:var(--toastify-color-warning)}.Toastify__toast-theme--colored.Toastify__toast--error{color:var(--toastify-text-color-error);background:var(--toastify-color-error)}.Toastify__progress-bar-theme--light{background:var(--toastify-color-progress-light)}.Toastify__progress-bar-theme--dark{background:var(--toastify-color-progress-dark)}.Toastify__progress-bar--info{background:var(--toastify-color-progress-info)}.Toastify__progress-bar--success{background:var(--toastify-color-progress-success)}.Toastify__progress-bar--warning{background:var(--toastify-color-progress-warning)}.Toastify__progress-bar--error{background:var(--toastify-color-progress-error)}.Toastify__progress-bar-theme--colored.Toastify__progress-bar--info,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--success,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--warning,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--error{background:var(--toastify-color-transparent)}.Toastify__close-button{color:#fff;position:absolute;top:6px;right:6px;background:transparent;outline:none;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s ease;z-index:1}.Toastify__toast--rtl .Toastify__close-button{left:6px;right:unset}.Toastify__close-button--light{color:#000;opacity:.3}.Toastify__close-button>svg{fill:currentColor;height:16px;width:14px}.Toastify__close-button:hover,.Toastify__close-button:focus{opacity:1}@keyframes Toastify__trackProgress{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.Toastify__progress-bar{position:absolute;bottom:0;left:0;width:100%;height:100%;z-index:1;opacity:.7;transform-origin:left}.Toastify__progress-bar--animated{animation:Toastify__trackProgress linear 1 forwards}.Toastify__progress-bar--controlled{transition:transform .2s}.Toastify__progress-bar--rtl{right:0;left:initial;transform-origin:right;border-bottom-left-radius:initial}.Toastify__progress-bar--wrp{position:absolute;overflow:hidden;bottom:0;left:0;width:100%;height:5px;border-bottom-left-radius:var(--toastify-toast-bd-radius);border-bottom-right-radius:var(--toastify-toast-bd-radius)}.Toastify__progress-bar--wrp[data-hidden=true]{opacity:0}.Toastify__progress-bar--bg{opacity:var(--toastify-color-progress-bgo);width:100%;height:100%}.Toastify__spinner{width:20px;height:20px;box-sizing:border-box;border:2px solid;border-radius:100%;border-color:var(--toastify-spinner-color-empty-area);border-right-color:var(--toastify-spinner-color);animation:Toastify__spin .65s linear infinite}@keyframes Toastify__bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutRight{20%{opacity:1;transform:translate3d(-20px,var(--y),0)}to{opacity:0;transform:translate3d(2000px,var(--y),0)}}@keyframes Toastify__bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutLeft{20%{opacity:1;transform:translate3d(20px,var(--y),0)}to{opacity:0;transform:translate3d(-2000px,var(--y),0)}}@keyframes Toastify__bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes Toastify__bounceOutUp{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes Toastify__bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes Toastify__bounceOutDown{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.Toastify__bounce-enter--top-left,.Toastify__bounce-enter--bottom-left{animation-name:Toastify__bounceInLeft}.Toastify__bounce-enter--top-right,.Toastify__bounce-enter--bottom-right{animation-name:Toastify__bounceInRight}.Toastify__bounce-enter--top-center{animation-name:Toastify__bounceInDown}.Toastify__bounce-enter--bottom-center{animation-name:Toastify__bounceInUp}.Toastify__bounce-exit--top-left,.Toastify__bounce-exit--bottom-left{animation-name:Toastify__bounceOutLeft}.Toastify__bounce-exit--top-right,.Toastify__bounce-exit--bottom-right{animation-name:Toastify__bounceOutRight}.Toastify__bounce-exit--top-center{animation-name:Toastify__bounceOutUp}.Toastify__bounce-exit--bottom-center{animation-name:Toastify__bounceOutDown}@keyframes Toastify__zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes Toastify__zoomOut{0%{opacity:1}50%{opacity:0;transform:translate3d(0,var(--y),0) scale3d(.3,.3,.3)}to{opacity:0}}.Toastify__zoom-enter{animation-name:Toastify__zoomIn}.Toastify__zoom-exit{animation-name:Toastify__zoomOut}@keyframes Toastify__flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes Toastify__flipOut{0%{transform:translate3d(0,var(--y),0) perspective(400px)}30%{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(-20deg);opacity:1}to{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(90deg);opacity:0}}.Toastify__flip-enter{animation-name:Toastify__flipIn}.Toastify__flip-exit{animation-name:Toastify__flipOut}@keyframes Toastify__slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideOutRight{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(110%,var(--y),0)}}@keyframes Toastify__slideOutLeft{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(-110%,var(--y),0)}}@keyframes Toastify__slideOutDown{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes Toastify__slideOutUp{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.Toastify__slide-enter--top-left,.Toastify__slide-enter--bottom-left{animation-name:Toastify__slideInLeft}.Toastify__slide-enter--top-right,.Toastify__slide-enter--bottom-right{animation-name:Toastify__slideInRight}.Toastify__slide-enter--top-center{animation-name:Toastify__slideInDown}.Toastify__slide-enter--bottom-center{animation-name:Toastify__slideInUp}.Toastify__slide-exit--top-left,.Toastify__slide-exit--bottom-left{animation-name:Toastify__slideOutLeft;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-right,.Toastify__slide-exit--bottom-right{animation-name:Toastify__slideOutRight;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-center{animation-name:Toastify__slideOutUp;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--bottom-center{animation-name:Toastify__slideOutDown;animation-timing-function:ease-in;animation-duration:.3s}@keyframes Toastify__spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
`);var IR=o=>typeof o=="number"&&!isNaN(o),a_=o=>typeof o=="string",ih=o=>typeof o=="function",poe=o=>a_(o)||IR(o),ix=o=>a_(o)||ih(o)?o:null,foe=(o,i)=>o===!1||IR(o)&&o>0?o:i,rx=o=>K.isValidElement(o)||a_(o)||ih(o)||IR(o);function moe(o,i,a=300){let{scrollHeight:d,style:f}=o;requestAnimationFrame(()=>{f.minHeight="initial",f.height=d+"px",f.transition=`all ${a}ms`,requestAnimationFrame(()=>{f.height="0",f.padding="0",f.margin="0",setTimeout(i,a)})})}function _oe({enter:o,exit:i,appendPosition:a=!1,collapse:d=!0,collapseDuration:f=300}){return function({children:y,position:R,preventExitTransition:w,done:N,nodeRef:O,isIn:x,playToast:G}){let W=a?`${o}--${R}`:o,ne=a?`${i}--${R}`:i,Q=K.useRef(0);return K.useLayoutEffect(()=>{let se=O.current,te=W.split(" "),le=ce=>{ce.target===O.current&&(G(),se.removeEventListener("animationend",le),se.removeEventListener("animationcancel",le),Q.current===0&&ce.type!=="animationcancel"&&se.classList.remove(...te))};se.classList.add(...te),se.addEventListener("animationend",le),se.addEventListener("animationcancel",le)},[]),K.useEffect(()=>{let se=O.current,te=()=>{se.removeEventListener("animationend",te),d?moe(se,N,f):N()};x||(w?te():(Q.current=1,se.className+=` ${ne}`,se.addEventListener("animationend",te)))},[x]),Hn.createElement(Hn.Fragment,null,y)}}function ZG(o,i){return{content:Wz(o.content,o.props),containerId:o.props.containerId,id:o.props.toastId,theme:o.props.theme,type:o.props.type,data:o.props.data||{},isLoading:o.props.isLoading,icon:o.props.icon,reason:o.removalReason,status:i}}function Wz(o,i,a=!1){return K.isValidElement(o)&&!a_(o.type)?K.cloneElement(o,{closeToast:i.closeToast,toastProps:i,data:i.data,isPaused:a}):ih(o)?o({closeToast:i.closeToast,toastProps:i,data:i.data,isPaused:a}):o}function goe({closeToast:o,theme:i,ariaLabel:a="close"}){return Hn.createElement("button",{className:`Toastify__close-button Toastify__close-button--${i}`,type:"button",onClick:d=>{d.stopPropagation(),o(!0)},"aria-label":a},Hn.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},Hn.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function Eoe({delay:o,isRunning:i,closeToast:a,type:d="default",hide:f,className:y,controlledProgress:R,progress:w,rtl:N,isIn:O,theme:x}){let G=f||R&&w===0,W={animationDuration:`${o}ms`,animationPlayState:i?"running":"paused"};R&&(W.transform=`scaleX(${w})`);let ne=t_("Toastify__progress-bar",R?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${x}`,`Toastify__progress-bar--${d}`,{"Toastify__progress-bar--rtl":N}),Q=ih(y)?y({rtl:N,type:d,defaultClassName:ne}):t_(ne,y),se={[R&&w>=1?"onTransitionEnd":"onAnimationEnd"]:R&&w<1?null:()=>{O&&a()}};return Hn.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":G},Hn.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${x} Toastify__progress-bar--${d}`}),Hn.createElement("div",{role:"progressbar","aria-hidden":G?"true":"false","aria-label":"notification timer",className:Q,style:W,...se}))}var yoe=1,qz=()=>`${yoe++}`;function voe(o,i,a){let d=1,f=0,y=[],R=[],w=i,N=new Map,O=new Set,x=ce=>(O.add(ce),()=>O.delete(ce)),G=()=>{R=Array.from(N.values()),O.forEach(ce=>ce())},W=({containerId:ce,toastId:me,updateId:Ce})=>{let _e=ce?ce!==o:o!==1,ze=N.has(me)&&Ce==null;return _e||ze},ne=(ce,me)=>{N.forEach(Ce=>{var _e;(me==null||me===Ce.props.toastId)&&((_e=Ce.toggle)==null||_e.call(Ce,ce))})},Q=ce=>{var me,Ce;(Ce=(me=ce.props)==null?void 0:me.onClose)==null||Ce.call(me,ce.removalReason),ce.isActive=!1},se=ce=>{if(ce==null)N.forEach(Q);else{let me=N.get(ce);me&&Q(me)}G()},te=()=>{f-=y.length,y=[]},le=ce=>{var me,Ce;let{toastId:_e,updateId:ze}=ce.props,Z=ze==null;ce.staleId&&N.delete(ce.staleId),ce.isActive=!0,N.set(_e,ce),G(),a(ZG(ce,Z?"added":"updated")),Z&&((Ce=(me=ce.props).onOpen)==null||Ce.call(me))};return{id:o,props:w,observe:x,toggle:ne,removeToast:se,toasts:N,clearQueue:te,buildToast:(ce,me)=>{if(W(me))return;let{toastId:Ce,updateId:_e,data:ze,staleId:Z,delay:J}=me,$=_e==null;$&&f++;let fe={...w,style:w.toastStyle,key:d++,...Object.fromEntries(Object.entries(me).filter(([pe,he])=>he!=null)),toastId:Ce,updateId:_e,data:ze,isIn:!1,className:ix(me.className||w.toastClassName),progressClassName:ix(me.progressClassName||w.progressClassName),autoClose:me.isLoading?!1:foe(me.autoClose,w.autoClose),closeToast(pe){N.get(Ce).removalReason=pe,se(Ce)},deleteToast(){let pe=N.get(Ce);if(pe!=null){if(a(ZG(pe,"removed")),N.delete(Ce),f--,f<0&&(f=0),y.length>0){le(y.shift());return}G()}}};fe.closeButton=w.closeButton,me.closeButton===!1||rx(me.closeButton)?fe.closeButton=me.closeButton:me.closeButton===!0&&(fe.closeButton=rx(w.closeButton)?w.closeButton:!0);let ve={content:ce,props:fe,staleId:Z};w.limit&&w.limit>0&&f>w.limit&&$?y.push(ve):IR(J)?setTimeout(()=>{le(ve)},J):le(ve)},setProps(ce){w=ce},setToggle:(ce,me)=>{let Ce=N.get(ce);Ce&&(Ce.toggle=me)},isToastActive:ce=>{var me;return(me=N.get(ce))==null?void 0:me.isActive},getSnapshot:()=>R}}var ja=new Map,uR=[],sx=new Set,Soe=o=>sx.forEach(i=>i(o)),Kz=()=>ja.size>0;function Toe(){uR.forEach(o=>Xz(o.content,o.options)),uR=[]}var Roe=(o,{containerId:i})=>{var a;return(a=ja.get(i||1))==null?void 0:a.toasts.get(o)};function Yz(o,i){var a;if(i)return!!((a=ja.get(i))!=null&&a.isToastActive(o));let d=!1;return ja.forEach(f=>{f.isToastActive(o)&&(d=!0)}),d}function boe(o){if(!Kz()){uR=uR.filter(i=>o!=null&&i.options.toastId!==o);return}if(o==null||poe(o))ja.forEach(i=>{i.removeToast(o)});else if(o&&("containerId"in o||"id"in o)){let i=ja.get(o.containerId);i?i.removeToast(o.id):ja.forEach(a=>{a.removeToast(o.id)})}}var Coe=(o={})=>{ja.forEach(i=>{i.props.limit&&(!o.containerId||i.id===o.containerId)&&i.clearQueue()})};function Xz(o,i){rx(o)&&(Kz()||uR.push({content:o,options:i}),ja.forEach(a=>{a.buildToast(o,i)}))}function woe(o){var i;(i=ja.get(o.containerId||1))==null||i.setToggle(o.id,o.fn)}function Jz(o,i){ja.forEach(a=>{(i==null||!(i!=null&&i.containerId)||(i==null?void 0:i.containerId)===a.id)&&a.toggle(o,i==null?void 0:i.id)})}function Aoe(o){let i=o.containerId||1;return{subscribe(a){let d=voe(i,o,Soe);ja.set(i,d);let f=d.observe(a);return Toe(),()=>{f(),ja.delete(i)}},setProps(a){var d;(d=ja.get(i))==null||d.setProps(a)},getSnapshot(){var a;return(a=ja.get(i))==null?void 0:a.getSnapshot()}}}function Ioe(o){return sx.add(o),()=>{sx.delete(o)}}function Noe(o){return o&&(a_(o.toastId)||IR(o.toastId))?o.toastId:qz()}function NR(o,i){return Xz(o,i),i.toastId}function FI(o,i){return{...i,type:i&&i.type||o,toastId:Noe(i)}}function BI(o){return(i,a)=>NR(i,FI(o,a))}function It(o,i){return NR(o,FI("default",i))}It.loading=(o,i)=>NR(o,FI("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...i}));function Ooe(o,{pending:i,error:a,success:d},f){let y;i&&(y=a_(i)?It.loading(i,f):It.loading(i.render,{...f,...i}));let R={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},w=(O,x,G)=>{if(x==null){It.dismiss(y);return}let W={type:O,...R,...f,data:G},ne=a_(x)?{render:x}:x;return y?It.update(y,{...W,...ne}):It(ne.render,{...W,...ne}),G},N=ih(o)?o():o;return N.then(O=>w("success",d,O)).catch(O=>w("error",a,O)),N}It.promise=Ooe;It.success=BI("success");It.info=BI("info");It.error=BI("error");It.warning=BI("warning");It.warn=It.warning;It.dark=(o,i)=>NR(o,FI("default",{theme:"dark",...i}));function Doe(o){boe(o)}It.dismiss=Doe;It.clearWaitingQueue=Coe;It.isActive=Yz;It.update=(o,i={})=>{let a=Roe(o,i);if(a){let{props:d,content:f}=a,y={delay:100,...d,...i,toastId:i.toastId||o,updateId:qz()};y.toastId!==o&&(y.staleId=o);let R=y.render||f;delete y.render,NR(R,y)}};It.done=o=>{It.update(o,{progress:1})};It.onChange=Ioe;It.play=o=>Jz(!0,o);It.pause=o=>Jz(!1,o);function Poe(o){var i;let{subscribe:a,getSnapshot:d,setProps:f}=K.useRef(Aoe(o)).current;f(o);let y=(i=K.useSyncExternalStore(a,d,d))==null?void 0:i.slice();function R(w){if(!y)return[];let N=new Map;return o.newestOnTop&&y.reverse(),y.forEach(O=>{let{position:x}=O.props;N.has(x)||N.set(x,[]),N.get(x).push(O)}),Array.from(N,O=>w(O[0],O[1]))}return{getToastToRender:R,isToastActive:Yz,count:y==null?void 0:y.length}}function Loe(o){let[i,a]=K.useState(!1),[d,f]=K.useState(!1),y=K.useRef(null),R=K.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:w,pauseOnHover:N,closeToast:O,onClick:x,closeOnClick:G}=o;woe({id:o.toastId,containerId:o.containerId,fn:a}),K.useEffect(()=>{if(o.pauseOnFocusLoss)return W(),()=>{ne()}},[o.pauseOnFocusLoss]);function W(){document.hasFocus()||le(),window.addEventListener("focus",te),window.addEventListener("blur",le)}function ne(){window.removeEventListener("focus",te),window.removeEventListener("blur",le)}function Q(Z){if(o.draggable===!0||o.draggable===Z.pointerType){ce();let J=y.current;R.canCloseOnClick=!0,R.canDrag=!0,J.style.transition="none",o.draggableDirection==="x"?(R.start=Z.clientX,R.removalDistance=J.offsetWidth*(o.draggablePercent/100)):(R.start=Z.clientY,R.removalDistance=J.offsetHeight*(o.draggablePercent===80?o.draggablePercent*1.5:o.draggablePercent)/100)}}function se(Z){let{top:J,bottom:$,left:fe,right:ve}=y.current.getBoundingClientRect();Z.nativeEvent.type!=="touchend"&&o.pauseOnHover&&Z.clientX>=fe&&Z.clientX<=ve&&Z.clientY>=J&&Z.clientY<=$?le():te()}function te(){a(!0)}function le(){a(!1)}function ce(){R.didMove=!1,document.addEventListener("pointermove",Ce),document.addEventListener("pointerup",_e)}function me(){document.removeEventListener("pointermove",Ce),document.removeEventListener("pointerup",_e)}function Ce(Z){let J=y.current;if(R.canDrag&&J){R.didMove=!0,i&&le(),o.draggableDirection==="x"?R.delta=Z.clientX-R.start:R.delta=Z.clientY-R.start,R.start!==Z.clientX&&(R.canCloseOnClick=!1);let $=o.draggableDirection==="x"?`${R.delta}px, var(--y)`:`0, calc(${R.delta}px + var(--y))`;J.style.transform=`translate3d(${$},0)`,J.style.opacity=`${1-Math.abs(R.delta/R.removalDistance)}`}}function _e(){me();let Z=y.current;if(R.canDrag&&R.didMove&&Z){if(R.canDrag=!1,Math.abs(R.delta)>R.removalDistance){f(!0),o.closeToast(!0),o.collapseAll();return}Z.style.transition="transform 0.2s, opacity 0.2s",Z.style.removeProperty("transform"),Z.style.removeProperty("opacity")}}let ze={onPointerDown:Q,onPointerUp:se};return w&&N&&(ze.onMouseEnter=le,o.stacked||(ze.onMouseLeave=te)),G&&(ze.onClick=Z=>{x&&x(Z),R.canCloseOnClick&&O(!0)}),{playToast:te,pauseToast:le,isRunning:i,preventExitTransition:d,toastRef:y,eventHandlers:ze}}var koe=typeof window<"u"?K.useLayoutEffect:K.useEffect,GI=({theme:o,type:i,isLoading:a,...d})=>Hn.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:o==="colored"?"currentColor":`var(--toastify-icon-color-${i})`,...d});function xoe(o){return Hn.createElement(GI,{...o},Hn.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))}function Moe(o){return Hn.createElement(GI,{...o},Hn.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))}function Uoe(o){return Hn.createElement(GI,{...o},Hn.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))}function joe(o){return Hn.createElement(GI,{...o},Hn.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))}function Voe(){return Hn.createElement("div",{className:"Toastify__spinner"})}var ax={info:Moe,warning:xoe,success:Uoe,error:joe,spinner:Voe},Foe=o=>o in ax;function Boe({theme:o,type:i,isLoading:a,icon:d}){let f=null,y={theme:o,type:i};return d===!1||(ih(d)?f=d({...y,isLoading:a}):K.isValidElement(d)?f=K.cloneElement(d,y):a?f=ax.spinner():Foe(i)&&(f=ax[i](y))),f}var Goe=o=>{let{isRunning:i,preventExitTransition:a,toastRef:d,eventHandlers:f,playToast:y}=Loe(o),{closeButton:R,children:w,autoClose:N,onClick:O,type:x,hideProgressBar:G,closeToast:W,transition:ne,position:Q,className:se,style:te,progressClassName:le,updateId:ce,role:me,progress:Ce,rtl:_e,toastId:ze,deleteToast:Z,isIn:J,isLoading:$,closeOnClick:fe,theme:ve,ariaLabel:pe}=o,he=t_("Toastify__toast",`Toastify__toast-theme--${ve}`,`Toastify__toast--${x}`,{"Toastify__toast--rtl":_e},{"Toastify__toast--close-on-click":fe}),Fe=ih(se)?se({rtl:_e,position:Q,type:x,defaultClassName:he}):t_(he,se),st=Boe(o),we=!!Ce||!N,je={closeToast:W,type:x,theme:ve},nt=null;return R===!1||(ih(R)?nt=R(je):K.isValidElement(R)?nt=K.cloneElement(R,je):nt=goe(je)),Hn.createElement(ne,{isIn:J,done:Z,position:Q,preventExitTransition:a,nodeRef:d,playToast:y},Hn.createElement("div",{id:ze,tabIndex:0,onClick:O,"data-in":J,className:Fe,...f,style:te,ref:d,...J&&{role:me,"aria-label":pe}},st!=null&&Hn.createElement("div",{className:t_("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!$})},st),Wz(w,o,!i),nt,!o.customProgressBar&&Hn.createElement(Eoe,{...ce&&!we?{key:`p-${ce}`}:{},rtl:_e,theme:ve,delay:N,isRunning:i,isIn:J,closeToast:W,hide:G,type:x,className:le,controlledProgress:we,progress:Ce||0})))},Hoe=(o,i=!1)=>({enter:`Toastify--animate Toastify__${o}-enter`,exit:`Toastify--animate Toastify__${o}-exit`,appendPosition:i}),zoe=_oe(Hoe("bounce",!0)),Woe={position:"top-right",transition:zoe,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light","aria-label":"Notifications Alt+T",hotKeys:o=>o.altKey&&o.code==="KeyT"};function qoe(o){let i={...Woe,...o},a=o.stacked,[d,f]=K.useState(!0),y=K.useRef(null),{getToastToRender:R,isToastActive:w,count:N}=Poe(i),{className:O,style:x,rtl:G,containerId:W,hotKeys:ne}=i;function Q(te){let le=t_("Toastify__toast-container",`Toastify__toast-container--${te}`,{"Toastify__toast-container--rtl":G});return ih(O)?O({position:te,rtl:G,defaultClassName:le}):t_(le,ix(O))}function se(){a&&(f(!0),It.play())}return koe(()=>{var te;if(a){let le=y.current.querySelectorAll('[data-in="true"]'),ce=12,me=(te=i.position)==null?void 0:te.includes("top"),Ce=0,_e=0;Array.from(le).reverse().forEach((ze,Z)=>{let J=ze;J.classList.add("Toastify__toast--stacked"),Z>0&&(J.dataset.collapsed=`${d}`),J.dataset.pos||(J.dataset.pos=me?"top":"bot");let $=Ce*(d?.2:1)+(d?0:ce*Z);J.style.setProperty("--y",`${me?$:$*-1}px`),J.style.setProperty("--g",`${ce}`),J.style.setProperty("--s",`${1-(d?_e:0)}`),Ce+=J.offsetHeight,_e+=.025})}},[d,N,a]),K.useEffect(()=>{function te(le){var ce;let me=y.current;ne(le)&&((ce=me.querySelector('[tabIndex="0"]'))==null||ce.focus(),f(!1),It.pause()),le.key==="Escape"&&(document.activeElement===me||me!=null&&me.contains(document.activeElement))&&(f(!0),It.play())}return document.addEventListener("keydown",te),()=>{document.removeEventListener("keydown",te)}},[ne]),Hn.createElement("section",{ref:y,className:"Toastify",id:W,onMouseEnter:()=>{a&&(f(!1),It.pause())},onMouseLeave:se,"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text","aria-label":i["aria-label"]},R((te,le)=>{let ce=le.length?{...x}:{...x,pointerEvents:"none"};return Hn.createElement("div",{tabIndex:-1,className:Q(te),"data-stacked":a,style:ce,key:`c-${te}`},le.map(({content:me,props:Ce})=>Hn.createElement(Goe,{...Ce,stacked:a,collapseAll:se,isIn:w(Ce.toastId,Ce.containerId),key:`t-${Ce.key}`},me)))}))}function t0(){It.error("Token Expired"),localStorage.removeItem("nfc-admin"),setTimeout(()=>{window.location.href="/"},1e3)}const p0=$t("doctor/emailCheck",async(o,{rejectWithValue:i})=>{var a;try{return(await Aae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),f0=$t("doctor/login",async(o,{rejectWithValue:i})=>{var a;try{return(await Iae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),m0=$t("doctor/forgotPassword",async(o,{rejectWithValue:i})=>{var a;try{return(await Nae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),_0=$t("doctor/otpVerification",async(o,{rejectWithValue:i})=>{var a;try{return(await Oae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),g0=$t("doctor/resendOtp",async(o,{rejectWithValue:i})=>{var a;try{return(await Dae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),E0=$t("doctor/resetPassword",async(o,{rejectWithValue:i})=>{var a;try{return(await Pae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),y0=$t("doctor/firstLogin",async(o,{rejectWithValue:i})=>{var a;try{return(await Lae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),Pp=$t("doctor/getDoctorProfile",async(o,{rejectWithValue:i})=>{var a;try{return(await kae()).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),v0=$t("doctor/doctorProfileUpdate",async(o,{rejectWithValue:i})=>{var a;try{return(await xae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),S0=$t("doctor/doctorPhotoUpdate",async(o,{rejectWithValue:i})=>{var a;try{return(await Mae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),T0=$t("doctor/deleteDoctorPhoto",async(o,{rejectWithValue:i})=>{var a;try{return(await Uae()).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),R0=$t("doctor/doctorPendingPrescriptions",async(o,{rejectWithValue:i})=>{var a;try{return(await jae()).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),b0=$t("doctor/doctorCompletedPrescriptions",async(o,{rejectWithValue:i})=>{var a;try{return(await Vae()).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),C0=$t("doctor/symptomUploadDetails",async(o,{rejectWithValue:i})=>{var a;try{return(await Bae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),w0=$t("doctor/completePrescription",async(o,{rejectWithValue:i})=>{var a;try{return(await Gae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),A0=$t("doctor/logout",async(o,{rejectWithValue:i})=>{var a;try{return(await qae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),QT=$t("user/medicineSearch",async(o,{rejectWithValue:i})=>{var a;try{return(await roe(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),uk=$t("user/getAllUser",async(o,{rejectWithValue:i})=>{var a;try{return(await(void 0)()).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}});$t("user/userId",async(o,{rejectWithValue:i})=>{var a;try{return(await(void 0)()).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}});const hk=$t("user/create",async(o,{rejectWithValue:i})=>{var a;try{return(await(void 0)(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),pk=$t("user/editUser",async(o,{rejectWithValue:i})=>{var a;try{return(await(void 0)(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),fk=$t("user/delete",async(o,{rejectWithValue:i})=>{var a;try{return(await(void 0)(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),Koe=l_({name:"user",initialState:{user:[],pendingPrescription:[],completedPrescription:[],symptomUploadDetail:[],medicineSearch:[],completeAssignedPrescription:null,loading:!1,loading2:!1,error:null,message:null},reducers:{},extraReducers:o=>{o.addCase(p0.pending,i=>{i.loading=!0,i.error=null}).addCase(p0.fulfilled,(i,a)=>{i.loading=!1,i.user=a.payload}).addCase(p0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(f0.pending,i=>{i.loading=!0,i.error=null}).addCase(f0.fulfilled,(i,a)=>{var d,f;i.loading=!1,i.user=a.payload,localStorage.setItem("doctor-app",JSON.stringify({doctorData:(d=a.payload.data)==null?void 0:d.doctor,token:(f=a.payload.data)==null?void 0:f.token}))}).addCase(f0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(m0.pending,i=>{i.loading=!0,i.error=null}).addCase(m0.fulfilled,(i,a)=>{i.loading=!1,i.user=a.payload}).addCase(m0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(_0.pending,i=>{i.loading=!0,i.error=null}).addCase(_0.fulfilled,(i,a)=>{i.loading=!1,i.user=a.payload}).addCase(_0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(g0.pending,i=>{i.loading=!0,i.error=null}).addCase(g0.fulfilled,(i,a)=>{i.loading=!1,i.user=a.payload}).addCase(g0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(E0.pending,i=>{i.loading=!0,i.error=null}).addCase(E0.fulfilled,(i,a)=>{var d,f;i.loading=!1,i.user=a.payload,localStorage.setItem("doctor-app",JSON.stringify({id:(d=a.payload.data)==null?void 0:d.id,token:(f=a.payload.data)==null?void 0:f.token}))}).addCase(E0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(y0.pending,i=>{i.loading=!0,i.error=null}).addCase(y0.fulfilled,(i,a)=>{var d,f;i.loading=!1,i.user=a.payload,localStorage.setItem("doctor-app",JSON.stringify({doctorData:(d=a.payload.data)==null?void 0:d.doctor,token:(f=a.payload.data)==null?void 0:f.token}))}).addCase(y0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(Pp.pending,i=>{i.loading=!0,i.error=null}).addCase(Pp.fulfilled,(i,a)=>{var d,f;i.loading=!1,i.user=(f=(d=a.payload)==null?void 0:d.data)==null?void 0:f.doctor}).addCase(Pp.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(v0.pending,i=>{i.loading=!0,i.error=null}).addCase(v0.fulfilled,(i,a)=>{i.loading=!1,i.user=a.payload}).addCase(v0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(S0.pending,i=>{i.loading=!0,i.error=null}).addCase(S0.fulfilled,(i,a)=>{i.loading=!1,i.user=a.payload}).addCase(S0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(T0.pending,i=>{i.loading=!0,i.error=null}).addCase(T0.fulfilled,(i,a)=>{i.loading=!1,i.user&&(i.user.profile_path=null)}).addCase(T0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(R0.pending,i=>{i.loading=!0,i.error=null}).addCase(R0.fulfilled,(i,a)=>{var d;i.loading=!1,i.pendingPrescription=(d=a.payload.data)==null?void 0:d.pending_prescriptions}).addCase(R0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(b0.pending,i=>{i.loading=!0,i.error=null}).addCase(b0.fulfilled,(i,a)=>{var d;i.loading=!1,i.completedPrescription=(d=a.payload.data)==null?void 0:d.completed_prescriptions}).addCase(b0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(C0.pending,i=>{i.loading=!0,i.error=null}).addCase(C0.fulfilled,(i,a)=>{i.loading=!1,i.symptomUploadDetail=a.payload.data}).addCase(C0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(w0.pending,i=>{i.loading=!0,i.error=null}).addCase(w0.fulfilled,(i,a)=>{i.loading=!1,i.completeAssignedPrescription=a.payload}).addCase(w0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(A0.pending,i=>{i.loading=!0,i.error=null}).addCase(A0.fulfilled,i=>{i.loading=!1,i.user=null,localStorage.removeItem("doctor-app")}).addCase(A0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(QT.pending,i=>{i.loading2=!0,i.error=null}).addCase(QT.fulfilled,(i,a)=>{var d,f;i.loading2=!1,i.medicineSearch=(f=(d=a.payload)==null?void 0:d.data)==null?void 0:f.results}).addCase(QT.rejected,(i,a)=>{i.loading2=!1,i.error=a.payload||"Failed to search medicine",It.error(a.payload.message||"Failed to search medicine")}).addCase(uk.pending,i=>{i.loading=!0,i.error=null}).addCase(uk.fulfilled,(i,a)=>{i.loading=!1,i.user=a.payload}).addCase(uk.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to fetch users",a.payload.message=="Unauthenticated."&&t0()}).addCase(hk.pending,i=>{i.loading=!0,i.error=null}).addCase(hk.fulfilled,(i,a)=>{i.loading=!1,i.user=a.payload,i.message="User created successfully",It.success(a.payload.message||"User created successfully")}).addCase(hk.rejected,(i,a)=>{var d;i.loading=!1,i.error=((d=a.payload)==null?void 0:d.errors)||"User creation failed",a.payload.message=="Unauthenticated."&&t0()}).addCase(pk.pending,i=>{i.loading=!0,i.error=null}).addCase(pk.fulfilled,(i,a)=>{i.loading=!1,i.user=a.payload,i.message="User updated successfully"}).addCase(pk.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to update user",a.payload.message=="Unauthenticated."&&t0()}).addCase(fk.pending,i=>{i.loading=!0,i.error=null}).addCase(fk.fulfilled,(i,a)=>{i.loading=!1,i.user=a.payload,i.message="User Deleted successfully",It.success(a.payload.message||"User deleted successfully")}).addCase(fk.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to delete user",It.error(a.payload.message||"Failed to delete user"),a.payload.message=="Unauthenticated."&&t0()})}}),Yoe=Koe.reducer;function mk(){It.error("Token Expired"),localStorage.removeItem("doctor-app"),setTimeout(()=>{window.location.href="/"},1e3)}const ty=$t("notification/getAllNotifications",async(o,{rejectWithValue:i})=>{var a;try{return(await toe()).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),I0=$t("doctor/deleteNotification",async(o,{rejectWithValue:i})=>{var a;try{const d=await noe(o);return{deletedIds:o}}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),N0=$t("doctor/markAllRead",async(o,{rejectWithValue:i})=>{var a;try{return(await ioe(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),O0=$t("/doctor/unreadCount",async(o,{rejectWithValue:i})=>{var a;try{return(await soe()).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),D0=$t("/doctor/checkToggleNotification",async(o,{rejectWithValue:i})=>{var a;try{return(await aoe()).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),P0=$t("/doctor/changeAppointmentNotificaiton",async(o,{rejectWithValue:i})=>{var a;try{return(await ooe(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}});$t("/doctor/toggleNotifications",async(o,{rejectWithValue:i})=>{var a;try{return(await(void 0)()).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}});const L0=$t("/doctor/reminderPopup",async(o,{rejectWithValue:i})=>{var a;try{return(await loe(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),Xoe=l_({name:"Notification",initialState:{doctorNotifications:[],unreadCounts:[],isNotificationActive:!1,reminderPopupData:[],loading:!1,error:null},reducer:{},extraReducers:o=>{o.addCase(ty.pending,i=>{i.loading=!0,i.error=null}).addCase(ty.fulfilled,(i,a)=>{i.loading=!1,i.doctorNotifications=a.payload.data}).addCase(ty.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to fetch users",a.payload.message=="Unauthenticated."&&mk()}).addCase(I0.pending,i=>{i.loading=!0,i.error=null}).addCase(I0.fulfilled,(i,a)=>{const d=a.payload.deletedIds,f=y=>(y==null?void 0:y.filter(R=>!d.includes(R.id)))??[];i.doctorNotifications.today=f(i.doctorNotifications.today),i.doctorNotifications.yesterday=f(i.doctorNotifications.yesterday),i.doctorNotifications.older=f(i.doctorNotifications.older)}).addCase(I0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to fetch users",a.payload.message=="Unauthenticated."&&mk()}).addCase(N0.pending,i=>{i.loading=!0,i.error=null}).addCase(N0.fulfilled,(i,a)=>{i.loading=!1,i.user=a.payload}).addCase(N0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to update user",a.payload.message=="Unauthenticated."&&mk()}).addCase(O0.pending,i=>{i.loading=!0,i.error=null}).addCase(O0.fulfilled,(i,a)=>{i.loading=!1,i.unreadCounts=a.payload.data.count}).addCase(O0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to fetch unread count"}).addCase(D0.pending,i=>{i.loading=!0}).addCase(D0.fulfilled,(i,a)=>{i.loading=!1,i.isNotificationActive=a.payload.data.isActive}).addCase(D0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to Get Notification Status"}).addCase(P0.pending,i=>{i.loading=!0}).addCase(P0.fulfilled,(i,a)=>{i.loading=!1,i.isNotificationActive=a.payload.data.isActive}).addCase(P0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to Update Notification Status"}).addCase(L0.pending,i=>{i.loading=!0}).addCase(L0.fulfilled,(i,a)=>{i.loading=!1,i.reminderPopupData=a.payload.data}).addCase(L0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to Update Notification Status"})}}),Joe=Xoe.reducer,Va=()=>{const[o,i]=K.useState(!1),[a,d]=K.useState(!1),f=qo(),y=Mr(),{user:R}=Zi(W=>W.user),w=void 0,{unreadCounts:N,isNotificationActive:O}=Zi(W=>W.notification);K.useEffect(()=>{y(O0()),y(D0())},[y]),K.useEffect(()=>{R!=null&&R.profile_path||y(Pp())},[y,R]);const x=()=>{i(!1),localStorage.removeItem("doctor-app"),y(A0()),f("/")},G=()=>{y(P0({isActive:!O}))};return E.jsxs(E.Fragment,{children:[E.jsx("div",{className:"sidebar",style:{transform:a?"translateX(0)":"translateX(-100%)",transition:"transform 0.3s ease-in-out",position:"fixed",left:0,top:0,width:"280px",height:"100%",backgroundColor:"#fff",zIndex:1e3},children:E.jsxs("div",{className:"sidebar-inr",children:[E.jsx("div",{className:"sidebar-close",onClick:()=>d(!1),style:{cursor:"pointer",padding:"10px",textAlign:"right"},children:E.jsx("i",{className:"fa-solid fa-times-circle"})}),E.jsxs("div",{className:"doc-profile-wrp",children:[E.jsx("div",{className:"doc-img",children:E.jsx("img",{src:`${w}/${R==null?void 0:R.profile_path}`,alt:"Doctor"})}),E.jsxs("div",{className:"doc-profile-body",children:[E.jsx("p",{children:(R==null?void 0:R.name)||"Doctor Name"}),E.jsx(Wt,{to:"/UserProfile",className:"view-profile",children:"View my profile"})]})]}),E.jsx("div",{className:"sidebar-nav",children:E.jsxs("ul",{children:[E.jsxs("li",{children:[E.jsx("img",{src:"/images/dash.svg",alt:"Icon",style:{height:"20px",width:"20px"}}),E.jsx(Wt,{to:"/doctor-home",onClick:()=>d(!1),children:"Dashboard"})]}),E.jsx("li",{children:E.jsxs("div",{className:"notification-set",children:[E.jsxs("div",{className:"not-set-left",children:[E.jsx("img",{src:"/images/notification-icon.svg",alt:"Notification"}),E.jsx("span",{children:"Notification"})]}),E.jsx("div",{className:"not-set-right",children:E.jsxs("div",{className:"not-toggler",children:[E.jsx("input",{type:"checkbox",id:"notificationToggle",checked:O,onChange:G}),E.jsx("label",{htmlFor:"notificationToggle"})]})})]})}),E.jsxs("li",{children:[E.jsx("img",{src:"/images/appointment-icon.svg",alt:"Icon"}),E.jsx(Wt,{to:"/my-appointments",onClick:()=>d(!1),children:"My Appointments"})]}),E.jsxs("li",{children:[E.jsx("img",{src:"/images/pending-prescription-icon.svg",alt:"Icon"}),E.jsx(Wt,{to:"/pendingprescription",onClick:()=>d(!1),children:"Pending prescriptions"})]}),E.jsxs("li",{children:[E.jsx("img",{src:"/images/past-patients-icon.svg",alt:"Icon"}),E.jsx(Wt,{to:"/pastpatient",onClick:()=>d(!1),children:"My Past Patients"})]}),E.jsxs("li",{className:"logout",children:[E.jsx("img",{src:"/images/menu-logout-icon.svg",alt:"Icon"}),E.jsxs(vy,{variant:"link",style:{textDecoration:"none",color:"black",fontWeight:"600",textTransform:"none"},onClick:()=>i(!0),children:["Logout ",E.jsx("i",{className:"fa-solid fa-chevron-right"})]})]})]})})]})}),E.jsxs("div",{className:"doc-panel-header",style:{display:"flex",alignItems:"center",padding:"15px 10px",background:"#fff",justifyContent:"space-between"},children:[E.jsx("button",{type:"button",className:"docpnl-hdr-toggler",onClick:()=>d(!0),style:{background:"transparent",border:"none",cursor:"pointer"},children:E.jsx("img",{src:"/images/bars.svg",alt:"Menu"})}),E.jsx("div",{className:"logo",children:E.jsx(Wt,{to:"/doctor-home",children:E.jsx("img",{src:"/images/logo.png",alt:"Logo"})})}),E.jsxs("div",{className:"notifications",children:[E.jsx(Wt,{to:"/notifications",children:E.jsx("img",{src:"/images/notification-icon-2.svg",alt:"Notification"})}),N>0&&E.jsx("span",{})]})]}),o&&E.jsx("div",{className:"modal fade show popup-wrp small-pop dash-pop",tabIndex:"-1",style:{display:"block",background:"rgba(0,0,0,0.5)"},children:E.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:E.jsxs("div",{className:"modal-content",children:[E.jsx("button",{type:"button",className:"close",onClick:()=>i(!1),"aria-label":"Close",children:E.jsx("span",{"aria-hidden":"true",children:E.jsx("img",{src:"/images/cross-blue.png",alt:"Close"})})}),E.jsx("div",{className:"modal-icon",children:E.jsx("img",{src:"/images/logout-icon.svg",alt:"Icon"})}),E.jsxs("div",{className:"modal-header",children:[E.jsx("h2",{children:"Logout"}),E.jsx("p",{children:"Are you sure you want to logout?"})]}),E.jsxs("div",{className:"modal-footer btn-wrp",children:[E.jsx("button",{type:"button",className:"cmn-btn",onClick:()=>i(!1),children:"Cancel"}),E.jsx("button",{type:"button",className:"cmn-btn orange-btn",onClick:x,children:"Logout"})]})]})})})]})},go=()=>E.jsxs("div",{className:"panel-footer",children:[E.jsx("div",{className:"copyright",children:E.jsxs("p",{children:[" ",E.jsx("span",{className:"curryr",children:new Date().getFullYear()})," . All rights reserved."]})}),E.jsx("div",{className:"ftr-right",children:E.jsxs("p",{children:["Design & Developed with ",E.jsx("i",{className:"fa-solid fa-heart"})," by"," ",E.jsx("a",{href:"https://yesitlabs.com",target:"_blank",rel:"noopener noreferrer",children:"Yes IT Labs"})]})})]}),Qoe=()=>{const[o,i]=K.useState(!1),a=Mr(),{loading:d}=Zi(x=>x.user),[f,y]=K.useState(""),[R,w]=K.useState(""),N=qo();K.useEffect(()=>{localStorage.getItem("doctor-app")&&N("/doctor-home")},[]);const O=async x=>{var se,te,le,ce;if(x.preventDefault(),!/^[\w.-]+@([\w-]+\.)+[\w-]{2,4}$/.test(f)){w("Please enter a valid email address");return}const W=f.split("@")[1];if(!["gmail.com","yahoo.com","yopmail.com","hotmail.com"].includes(W)){w("Please enter a valid and supported email address");return}w("");const Q=await a(p0({email:f}));console.log(Q),((se=Q.payload.data)==null?void 0:se.verified)==1&&((te=Q.payload.data)==null?void 0:te.new_user)==1?N("/create-password",{state:{email:f}}):((le=Q.payload.data)==null?void 0:le.verified)==1&&((ce=Q.payload.data)==null?void 0:ce.new_user)==0?N("/login-password",{state:{email:f}}):i(!0)};return E.jsxs(E.Fragment,{children:[E.jsx("div",{className:"sign-sec",children:E.jsx("div",{className:"container",children:E.jsx("div",{className:"sign-sec-inr",children:E.jsxs("div",{className:"sign-inr-row row",children:[E.jsx("div",{className:"sign-left-wrp col-lg-7",children:E.jsxs("div",{className:"sign-left has-texture",children:[E.jsx("div",{className:"texture",children:E.jsx("img",{src:"./images/doctor-symbol.png",alt:"Doctor Symbol"})}),E.jsx("div",{className:"sign-left-img",children:E.jsx("img",{src:"./images/login-left-img.png",alt:"Login Left Image"})})]})}),E.jsx("div",{className:"sign-right-wrp col-lg-5",children:E.jsxs("div",{className:"sign-right",children:[E.jsx("div",{className:"logo-wrp",children:E.jsx("div",{className:"logo-inr-wrp",children:E.jsx("span",{children:E.jsx("img",{src:"./images/logo.png",alt:"Logo"})})})}),E.jsxs("div",{className:"sign-inr-head",children:[E.jsx("h1",{children:"Login as Doctor"}),E.jsx("p",{children:"Use credentials to access your account"})]}),E.jsx("div",{className:"sign-form",children:E.jsx("form",{onSubmit:O,children:E.jsx("div",{className:"sign-form-steps-wrp",children:E.jsxs("div",{className:"sign-form-step email-step",children:[E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Enter Email Id"}),E.jsx("input",{type:"email",placeholder:"Enter Your Email Id",required:!0,value:f,onChange:x=>{y(x.target.value),R&&w("")}}),R&&E.jsx("div",{className:"text-danger mt-1",style:{fontSize:"0.9rem"},children:R})]}),E.jsx("input",{type:"submit",value:"Next"})]})})})})]})})]})})})}),E.jsx(tr,{show:o,onHide:()=>i(!1),centered:!0,className:"popup-wrp",children:E.jsxs(tr.Body,{className:"text-center",children:[E.jsx("div",{className:"modal-icon",children:E.jsx("img",{src:"/images/wrong-mail-icon.png",alt:"Icon"})}),E.jsxs(tr.Header,{className:"modal-header",children:[E.jsx("h2",{children:"Unrecognized Email Id"}),E.jsx("p",{children:"Your Email Id is not registered yet."})]}),E.jsx(tr.Footer,{className:"modal-footer",children:E.jsx(vy,{className:"orange-btn",onClick:()=>i(!1),children:"OK"})})]})})]})},$oe=()=>{const o=Mr(),{loading:i}=Zi(ne=>ne.user),a=$r(),{email:d,password:f}=a.state||{},[y,R]=K.useState(""),[w,N]=K.useState(!1),[O,x]=K.useState(!1),G=async ne=>{if(ne.preventDefault(),console.log("Form submitted"),!/^(?=.*[a-z])(?=.*[A-Z])(?=.*[\d\W]).{8,}$/.test(y)){It.error("Please enter a valid password");return}const se=await o(f0({email:d,password:y}));console.log(se),console.log(d),console.log(y),se.payload&&se.payload.status?N(!0):It.error("Invalid password. Please try again.")},W=()=>{x(ne=>!ne)};return E.jsxs(E.Fragment,{children:[E.jsx("div",{className:"sign-sec",children:E.jsx("div",{className:"container",children:E.jsx("div",{className:"sign-sec-inr",children:E.jsxs("div",{className:"sign-inr-row row",children:[E.jsx("div",{className:"sign-left-wrp col-lg-7",children:E.jsxs("div",{className:"sign-left has-texture",children:[E.jsx("div",{className:"texture",children:E.jsx("img",{src:"./images/doctor-symbol.png",alt:"Doctor Symbol"})}),E.jsx("div",{className:"sign-left-img",children:E.jsx("img",{src:"./images/login-left-img.png",alt:"Login Left Image"})})]})}),E.jsx("div",{className:"sign-right-wrp col-lg-5",children:E.jsxs("div",{className:"sign-right",children:[E.jsx("div",{className:"logo-wrp",children:E.jsx("div",{className:"logo-inr-wrp",children:E.jsx("span",{children:E.jsx("img",{src:"./images/logo.png",alt:"Logo"})})})}),E.jsxs("div",{className:"sign-inr-head",children:[E.jsx("h1",{children:"Login as Doctor"}),E.jsx("p",{children:"Use credentials to access your account"})]}),E.jsx("div",{className:"sign-form",children:E.jsx("form",{onSubmit:G,children:E.jsx("div",{className:"sign-form-steps-wrp",children:E.jsxs("div",{className:"sign-form-step",children:[E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Enter Password"}),E.jsxs("div",{className:"input-pass-field",children:[E.jsx("input",{type:O?"text":"password",id:"password",placeholder:"Password",required:!0,value:y,onChange:ne=>R(ne.target.value)}),E.jsx("span",{className:"eye-btn",onClick:W,style:{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",cursor:"pointer"},children:E.jsx("img",{src:O?"./images/eye-open.svg":"./images/eye-close.svg",alt:O?"Hide password":"Show password"})})]})]}),E.jsx("div",{className:"text-right",children:E.jsx(Wt,{to:"/forgot-password",className:"forgot-pass",children:"Forgot password?"})}),E.jsx("button",{type:"submit",className:"orange-btn",children:" Login "})]})})})})]})})]})})})}),E.jsxs(tr,{show:w,onHide:()=>{},centered:!0,className:"popup-wrp",id:"congratulations",dialogClassName:"custom-modal",children:[E.jsx("style",{children:`
                      .custom-modal .modal-content{
                        padding:30px 0 50px 0;
                        margin:0;
                      }
            
                    `}),E.jsx("div",{className:"modal-icon text-center mt-4",children:E.jsx("img",{src:"/images/check-icon.png",alt:"Icon"})}),E.jsxs(tr.Header,{className:"border-0 flex-column text-center",children:[E.jsx(tr.Title,{id:"exampleModalLongTitle",className:"w-100",children:E.jsx("h2",{children:"Login Successful"})}),E.jsx("p",{children:"Welcome to the world of health."})]}),E.jsx(tr.Footer,{className:"d-flex justify-content-center border-0",children:E.jsx(Wt,{to:"/doctor-home",className:"orange-btn",onClick:()=>N(!1),children:"Ok"})})]})]})},Zoe=()=>{const o=qo(),i=Mr(),[a,d]=K.useState(""),{loading:f}=Zi(R=>R.user),y=async R=>{var O;if(R.preventDefault(),!a.trim()){It.error("Please enter the email");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)){It.error("Invalid email");return}const N=await i(m0({email:a}));console.log(N),console.log((O=N.payload)==null?void 0:O.status),N.payload.status?o("/otp-verification",{state:{sendEmail:a}}):It.error("Email is not registered")};return E.jsx("div",{className:"sign-sec pt-0",children:E.jsx("div",{className:"container",children:E.jsxs("div",{className:"sign-sec-inr",children:[E.jsx("div",{className:"docpnl-sec-head",style:{padding:"0",margin:"0"},children:E.jsx("div",{className:"back-btn",style:{padding:"0",margin:"0"},children:E.jsx(Wt,{to:"/login-password",children:E.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})}),E.jsxs("div",{className:"sign-inr-row row",style:{padding:"0",margin:"0"},children:[E.jsx("div",{className:"sign-left-wrp col-lg-7",style:{padding:"0",margin:"0"},children:E.jsxs("div",{className:"sign-left has-texture",children:[E.jsx("div",{className:"texture",children:E.jsx("img",{src:"./images/doctor-symbol.png",alt:"Doctor Symbol"})}),E.jsx("div",{className:"sign-left-img",children:E.jsx("img",{src:"./images/forgot-pass-bnr.png",alt:"Forgot Password Banner",style:{width:"80%"}})})]})}),E.jsx("div",{className:"sign-right-wrp col-lg-5",style:{padding:"0",margin:"0"},children:E.jsxs("div",{className:"sign-right",children:[E.jsx("div",{className:"logo-wrp",children:E.jsx("div",{className:"logo-inr-wrp",children:E.jsx("span",{children:E.jsx("img",{src:"./images/logo.png",alt:"Logo"})})})}),E.jsxs("div",{className:"sign-inr-head",children:[E.jsx("h1",{children:"Forgot Password"}),E.jsx("p",{children:"Select which contact details should be used to reset your password"})]}),E.jsx("div",{className:"sign-form",children:E.jsx("form",{onSubmit:y,children:E.jsx("div",{className:"sign-form-steps-wrp",children:E.jsxs("div",{className:"sign-form-step",children:[E.jsxs("div",{className:"formfield mb-0",children:[E.jsx("label",{children:"Enter Email Id"}),E.jsx("input",{type:"email",placeholder:"Enter Your Email Id",value:a,onChange:R=>d(R.target.value)})]}),E.jsx("input",{type:"submit",value:f?"Loading...":"Continue"})]})})})})]})})]})]})})})},ece=()=>{const o=Mr();qo();const i=$r(),[a,d]=K.useState(0),{sendEmail:f}=i.state||{},[y,R]=K.useState(!1),[w,N]=K.useState(["","","","",""]),O=K.useRef([]);K.useEffect(()=>{if(a>0){const se=setInterval(()=>{d(te=>te-1)},1e3);return()=>clearInterval(se)}},[a]);const x=(se,te)=>{if(te.length>1)return;const le=[...w];le[se]=te,N(le),te&&se<4&&O.current[se+1].focus()},G=(se,te)=>{te.key==="Backspace"&&!w[se]&&se>0&&O.current[se-1].focus()},W=se=>{se.preventDefault();const te=se.clipboardData.getData("text/plain").slice(0,5),le=[...w];te.split("").forEach((ce,me)=>{me<5&&(le[me]=ce,me<4&&O.current[me+1].focus())}),N(le)},ne=async se=>{if(se.preventDefault(),w.some(le=>le===""))return It.error("Please enter the OTP");const te=await o(_0({email:f,otp:w.join("")}));console.log(f),console.log(w),console.log(te),te.payload.status?R(!0):It.error("Please enter the correct OTP.")},Q=async se=>{if(se.preventDefault(),a>0)return;(await o(g0({sendEmail:f}))).payload.status?(It.success("OTP resent successfully."),d(120)):It.error("Failed to resend OTP.")};return E.jsxs(E.Fragment,{children:[E.jsx("div",{className:"sign-sec pt-0",children:E.jsx("div",{className:"container",children:E.jsxs("div",{className:"sign-sec-inr",children:[E.jsx("div",{className:"docpnl-sec-head",style:{padding:"0",margin:"0"},children:E.jsx("div",{className:"back-btn",style:{padding:"0",margin:"0"},children:E.jsx(Wt,{to:"/forgot-password",children:E.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})}),E.jsxs("div",{className:"sign-inr-row row",style:{padding:"0",margin:"0"},children:[E.jsx("div",{className:"sign-left-wrp col-lg-7",style:{padding:"0",margin:"0"},children:E.jsxs("div",{className:"sign-left has-texture",children:[E.jsx("div",{className:"texture",children:E.jsx("img",{src:"./images/doctor-symbol.png",alt:"Doctor Symbol"})}),E.jsx("div",{className:"sign-left-img",children:E.jsx("img",{src:"./images/otp-bnr.png",alt:"OTP Banner",style:{width:"63%"}})})]})}),E.jsx("div",{className:"sign-right-wrp col-lg-5",style:{padding:"0",margin:"0"},children:E.jsxs("div",{className:"sign-right",children:[E.jsx("div",{className:"logo-wrp",children:E.jsx("div",{className:"logo-inr-wrp",children:E.jsx("span",{children:E.jsx("img",{src:"./images/logo.png",alt:"Logo"})})})}),E.jsxs("div",{className:"sign-inr-head",children:[E.jsx("h1",{children:"Enter Verification Code"}),E.jsx("p",{children:"We have sent the code verification to your registered email id or phone number"})]}),E.jsx("div",{className:"sign-form",children:E.jsx("form",{onSubmit:ne,children:E.jsx("div",{className:"sign-form-steps-wrp",children:E.jsxs("div",{className:"sign-form-step",children:[E.jsx("div",{className:"formfield",children:E.jsx("div",{className:"otp-container",style:{display:"flex",gap:"10px",justifyContent:"center",marginBottom:"10px"},children:[0,1,2,3,4].map(se=>E.jsx("input",{id:`otp-${se}`,ref:te=>O.current[se]=te,type:"number",maxLength:1,value:w[se],className:"otp-verification-code-in",onChange:te=>x(se,te.target.value),onKeyDown:te=>G(se,te),onPaste:W},se))})}),E.jsx("div",{className:"resend-code",style:{paddingRight:"18px"},children:E.jsxs("p",{children:["Didnt get a Code?",a>0?E.jsxs("span",{style:{color:"#888",marginLeft:5},children:["Resend in ",a,"S"]}):E.jsx(Wt,{to:"#",onClick:Q,style:{color:"#199FD9",marginLeft:5},children:"Resend"})]})}),E.jsx("input",{type:"submit",value:"Continue"})]})})})})]})})]})]})})}),E.jsxs(tr,{show:y,onHide:()=>R(!1),centered:!0,className:"popup-wrp",dialogClassName:"custom-modal",children:[E.jsx("style",{children:`
    .custom-modal .modal-content {
      padding: 30px 20px;
      position: relative; /* Needed for absolute close button */
    }
  `}),E.jsx("div",{className:"modal-icon text-center mt-4",children:E.jsx("img",{src:"/images/passd.png",alt:"Info Icon"})}),E.jsx("span",{"aria-hidden":"true",onClick:()=>R(!1),style:{position:"absolute",top:"15px",right:"15px",cursor:"pointer"},children:E.jsx("img",{src:"/images/cross-blue.png",alt:"Close"})}),E.jsxs(tr.Header,{className:"border-0 flex-column text-center",children:[E.jsx(tr.Title,{className:"w-100",children:E.jsx("h2",{children:"Enter New Password"})}),E.jsx("p",{children:"You will be redirected to reset your password."})]}),E.jsx(tr.Footer,{className:"d-flex justify-content-center border-0",children:E.jsx(Wt,{to:"/set-password",state:{email:f},className:"orange-btn",onClick:()=>R(!1),children:"Ok"})})]})]})},tce=()=>{const[o,i]=K.useState(""),[a,d]=K.useState(""),[f,y]=K.useState(!1),[R,w]=K.useState(!1),[N,O]=K.useState(!1),x=Mr(),G=$r(),{email:W}=G.state||{};console.log(W,"email");const ne=async Q=>{var te,le;if(Q.preventDefault(),o.trim()||It.error("Please enter the password"),!a.trim()){It.error("Please confirm your password");return}if(!/^(?=.*[a-z])(?=.*[A-Z])(?=.*[\d\W]).{8,}$/.test(o)){It.error("Password must be at least 8 characters long and include at least one uppercase letter, one lowercase letter, and one number or special character.");return}if(o!==a){It.error("Passwords do not match");return}try{const ce=await x(E0({email:W,password:o}));console.log(W),console.log(o),(te=ce.payload)!=null&&te.status?O(!0):It.error(((le=ce.payload)==null?void 0:le.message)||"Password reset failed")}catch(ce){console.log("Password reset error:",ce),It.error("An error occurred during password reset")}};return E.jsxs("div",{className:"sign-sec set-pass pt-0",children:[E.jsx("div",{className:"container",children:E.jsxs("div",{className:"sign-sec-inr",children:[E.jsx("div",{className:"docpnl-sec-head",children:E.jsx("div",{className:"back-btn",children:E.jsx(Wt,{to:"/login-password",children:E.jsx("img",{src:"/images/left-arrow.svg",alt:"Icon"})})})}),E.jsxs("div",{className:"sign-inr-row row",children:[E.jsx("div",{className:"sign-left-wrp col-lg-7",children:E.jsxs("div",{className:"sign-left has-texture",children:[E.jsx("div",{className:"texture",children:E.jsx("img",{src:"/images/doctor-symbol.png",alt:"Doctor Symbol"})}),E.jsx("div",{className:"sign-left-img",children:E.jsx("img",{src:"/images/new-pass-bnr.png",alt:"Login Left Image"})})]})}),E.jsx("div",{className:"sign-right-wrp col-lg-5",children:E.jsxs("div",{className:"sign-right",children:[E.jsx("div",{className:"logo-wrp",children:E.jsx("div",{className:"logo-inr-wrp",children:E.jsx("span",{children:E.jsx("img",{src:"/images/logo.png",alt:"Logo"})})})}),E.jsxs("div",{className:"sign-inr-head",children:[E.jsx("h1",{children:"Enter New Password"}),E.jsx("p",{children:"Please enter your new password"})]}),E.jsx("div",{className:"sign-form",children:E.jsx("form",{onSubmit:ne,children:E.jsx("div",{className:"sign-form-steps-wrp",children:E.jsxs("div",{className:"sign-form-step",children:[E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Enter New Password"}),E.jsxs("div",{className:"input-pass-field position-relative",children:[E.jsx("input",{type:f?"text":"password",placeholder:"Password",value:o,onChange:Q=>{i(Q.target.value),Q.target.value.length===0&&y(!1)}}),E.jsx("span",{className:"eye-btn",onClick:()=>{o.length>0&&y(!f)},style:{cursor:o.length>0?"pointer":"not-allowed",position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)"},children:E.jsx("img",{src:o.length>0&&f?"/images/eye-open.svg":"/images/eye-close.svg",alt:f?"Hide Password":"Show Password"})})]})]}),E.jsxs("div",{className:"formfield mb-0",children:[E.jsx("label",{children:"Confirm New Password"}),E.jsxs("div",{className:"input-pass-field position-relative",children:[E.jsx("input",{type:R?"text":"password",placeholder:"Password",value:a,onChange:Q=>{d(Q.target.value),Q.target.value.length===0&&w(!1)}}),E.jsx("span",{className:"eye-btn",onClick:()=>{a.length>0&&w(!R)},style:{cursor:a.length>0?"pointer":"not-allowed",position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)"},children:E.jsx("img",{src:a.length>0&&R?"/images/eye-open.svg":"/images/eye-close.svg",alt:R?"Hide Password":"Show Password"})})]})]}),E.jsx(vy,{type:"submit",className:"orange-btn mt-3",children:"Continue"})]})})})})]})})]})]})}),E.jsxs(tr,{show:N,onHide:()=>O(!1),centered:!0,className:"popup-wrp",dialogClassName:"custom-modal",children:[E.jsx("style",{children:`
    .custom-modal .modal-content {
      padding: 30px 0 50px 0;
      margin: 0;
      position: relative; /* needed for absolute close icon */
    }
  `}),E.jsx("div",{className:"modal-icon text-center mt-4",children:E.jsx("img",{src:"/images/check-icon.png",alt:"Success"})}),E.jsx("span",{"aria-hidden":"true",onClick:()=>O(!1),style:{position:"absolute",top:"15px",right:"15px",cursor:"pointer",zIndex:1051},children:E.jsx("img",{src:"/images/cross-blue.png",alt:"Close"})}),E.jsxs(tr.Header,{className:"border-0 flex-column text-center",children:[E.jsx(tr.Title,{className:"w-100",children:E.jsx("h2",{children:"Congratulations"})}),E.jsx("p",{children:"Your account is ready to use."})]}),E.jsx(tr.Footer,{className:"d-flex justify-content-center border-0",children:E.jsx(Wt,{to:"/",className:"orange-btn",onClick:()=>O(!1),children:"Continue"})})]})]})},Zu=({visible:o,title:i,subtitle:a,onCancel:d,onConfirm:f,inputField:y=!1,inputValue:R="",onInputChange:w=()=>{},actionType:N="cancel"})=>{if(!o)return null;const O=()=>{switch(N){case"cancel":return"/images/cancel-icon.png";case"success":return"/images/check-icon.png";default:return null}};return E.jsx("div",{className:"modal fade show d-block popup-wrp dash-pop",tabIndex:"-1",role:"dialog",children:E.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:E.jsxs("div",{className:`modal-content ${N==="info"?"large-pop":"small-pop"}`,children:[N!=="info"&&E.jsx("div",{className:"modal-icon",style:{cursor:N==="cancel"?"pointer":"default"},onClick:N==="cancel"?d:null,children:E.jsx("img",{src:O(),alt:"Icon"})}),N!=="success"&&E.jsx("button",{type:"button",className:"close",onClick:d,"aria-label":"Close",children:E.jsx("span",{"aria-hidden":"true",children:E.jsx("img",{src:"/images/cross-blue.png",alt:"Close"})})}),E.jsxs("div",{className:"modal-header",children:[E.jsx("h2",{children:i}),N!=="info"&&E.jsx("p",{children:a})]}),y&&E.jsx("div",{className:"modal-body",children:E.jsx("form",{children:E.jsxs("div",{className:"input-grp",children:[E.jsx("label",{children:"Reason for cancellation."}),E.jsx("textarea",{placeholder:"Give the reason.",required:!0,value:R,onChange:x=>w(x.target.value)})]})})}),E.jsx("div",{className:"modal-footer btn-wrp",children:N==="cancel"?E.jsxs(E.Fragment,{children:[E.jsx("button",{className:"cmn-btn white-input",onClick:d,children:"No"}),E.jsx("button",{className:"orange-btn",onClick:f,children:"Yes"})]}):N==="info"?E.jsx("button",{className:"orange-btn",onClick:f,children:"Submit"}):E.jsx("button",{className:"orange-btn",onClick:f,children:"Ok"})})]})})})},$T=$t("doctor/doctorHomeDashboard",async(o,{rejectWithValue:i})=>{var a;try{return(await Wae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),ny=$t("/doctor/patients/past",async(o,{rejectWithValue:i})=>{var a;try{return(await coe(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),k0=$t("doctor/videoCallSubmit",async(o,{rejectWithValue:i})=>{var a;try{return(await uoe(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),nce=l_({name:"dataSlice",initialState:{userdata:[],pastPatients:[],videoSubmit:[],loading:!1,error:null,message:null},reducers:{},extraReducers:o=>{o.addCase($T.pending,i=>{i.loading=!0,i.error=null}).addCase($T.fulfilled,(i,a)=>{i.loading=!1,i.userdata=a.payload.data}).addCase($T.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(ny.pending,i=>{i.loading=!0,i.error=null}).addCase(ny.fulfilled,(i,a)=>{var d,f;i.loading=!1,i.pastPatients=(f=(d=a.payload)==null?void 0:d.data)==null?void 0:f.past_patients}).addCase(ny.rejected,(i,a)=>{i.loading=!1,i.error=a.payload}).addCase(k0.pending,i=>{i.loading=!0,i.error=null}).addCase(k0.fulfilled,(i,a)=>{i.loading=!1,i.videoSubmit=a.payload}).addCase(k0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload})}}),ice=nce.reducer;function Np(){It.error("Token Expired"),localStorage.removeItem("doctor-app"),setTimeout(()=>{window.location.href="/"},1e3)}const ZT=$t("user/getAllUpcomingAppointment",async(o,{rejectWithValue:i})=>{var a;try{return(await Kae()).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),eR=$t("create-channel",async(o,{rejectWithValue:i})=>{var a;try{return(await Hae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),tR=$t("/call-notification",async(o,{rejectWithValue:i})=>{var a;try{return(await zae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),x0=$t("user/getAllCompletedAppointment",async(o,{rejectWithValue:i})=>{var a;try{return(await Yae()).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),M0=$t("user/getAllCanceledAppointment",async(o,{rejectWithValue:i})=>{var a;try{return(await Xae()).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),iy=$t("user/doctorCanceledAppointment",async(o,{rejectWithValue:i})=>{var a;try{return(await Jae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),U0=$t("user/patientAppointmentDetails",async(o,{rejectWithValue:i})=>{var a;try{return(await Qae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}});$t("user/userId",async(o,{rejectWithValue:i})=>{var a;try{return(await(void 0)()).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}});const _k=$t("user/delete",async(o,{rejectWithValue:i})=>{var a;try{return(await(void 0)(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),rce=l_({name:"Appointment",initialState:{upcommingAppointment:[],upcomingLoading:!1,completedAppointment:[],completedLoading:!1,cancelledAppointment:[],cancelledLoading:!1,doctorCancelledAppointment:[],doctorcancelledLoading:!1,patientAppointmentsDetail:[],patientAppointmentsDetailLoading:!1,channelDetails:null,channelDetailsLoading:!1,pushNotificationLoading:!1,pushnotification:null,error:null},reducers:{},extraReducers:o=>{o.addCase(ZT.pending,i=>{i.upcomingLoading=!0,i.error=null}).addCase(ZT.fulfilled,(i,a)=>{var d,f;i.upcomingLoading=!1,i.upcommingAppointment=(f=(d=a.payload)==null?void 0:d.data)==null?void 0:f.upcomingAppointments}).addCase(ZT.rejected,(i,a)=>{i.upcomingLoading=!1,i.error=a.payload||"Failed to fetch users",a.payload.message=="Unauthenticated."&&Np()}).addCase(x0.pending,i=>{i.completedLoading=!0,i.error=null}).addCase(x0.fulfilled,(i,a)=>{i.completedLoading=!1,i.completedAppointment=a.payload.data.completed_appointments}).addCase(x0.rejected,(i,a)=>{i.completedLoading=!1,i.error=a.payload||"Failed to fetch users",a.payload.message=="Unauthenticated."&&Np()}).addCase(M0.pending,i=>{i.cancelledLoading=!0,i.error=null}).addCase(M0.fulfilled,(i,a)=>{i.cancelledLoading=!1,i.cancelledAppointment=a.payload.data.cancelled_appointments}).addCase(M0.rejected,(i,a)=>{i.cancelledLoading=!1,i.error=a.payload||"Failed to fetch users",a.payload.message=="Unauthenticated."&&Np()}).addCase(iy.pending,i=>{i.doctorcancelledLoading=!0,i.error=null}).addCase(iy.fulfilled,(i,a)=>{i.doctorcancelledLoading=!1,i.doctorcancelledAppointment=a.payload}).addCase(iy.rejected,(i,a)=>{i.doctorcancelledLoading=!1,i.error=a.payload||"Failed to fetch users",a.payload.message=="Unauthenticated."&&Np()}).addCase(U0.pending,i=>{i.patientAppointmentsDetailLoading=!0,i.error=null}).addCase(U0.fulfilled,(i,a)=>{i.patientAppointmentsDetailLoading=!1,i.patientAppointmentsDetail=a.payload.data}).addCase(U0.rejected,(i,a)=>{i.patientAppointmentsDetailLoading=!1,i.error=a.payload||"Failed to fetch users",a.payload.message=="Unauthenticated."&&Np()}).addCase(tR.pending,i=>{i.pushNotificationLoading=!0,i.error=null}).addCase(tR.fulfilled,(i,a)=>{i.pushNotificationLoading=!1,i.pushnotification=a.payload.data}).addCase(tR.rejected,(i,a)=>{i.pushNotificationLoading=!1,i.error=a.payload||"Failed to fetch users",a.payload.message=="Unauthenticated."&&Np()}).addCase(eR.pending,i=>{i.channelDetailsLoading=!0,i.error=null}).addCase(eR.fulfilled,(i,a)=>{i.channelDetailsLoading=!1,i.channelDetails=a.payload.data}).addCase(eR.rejected,(i,a)=>{i.channelDetailsLoading=!1,i.error=a.payload||"Failed to fetch users",a.payload.message=="Unauthenticated."&&Np()}).addCase(_k.pending,i=>{i.loading=!0,i.error=null}).addCase(_k.fulfilled,(i,a)=>{i.loading=!1,i.user=a.payload,i.message="User Deleted successfully",It.success(a.payload.message||"User deleted successfully")}).addCase(_k.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to delete user",It.error(a.payload.message||"Failed to delete user"),a.payload.message=="Unauthenticated."&&Np()})}}),sce=rce.reducer,ace=()=>{const o=qo(),a=JSON.parse(localStorage.getItem("doctor-app")||"{}").doctorData;console.log(a==null?void 0:a.id,"Doctor Data");const d=void 0,f=Mr(),{userdata:y,loading:R,error:w}=Zi($e=>$e.userdata),{channelDetails:N}=Zi($e=>$e.appointments);console.log(N,"jfaklshfsahdfks"),K.useEffect(()=>{f($T())},[f]);const[O,x]=K.useState(!1),[G,W]=K.useState(!1),[ne,Q]=K.useState(!1),[se,te]=K.useState(null),[le,ce]=K.useState(""),[me,Ce]=K.useState(!1),[_e,ze]=K.useState(!1),[Z,J]=K.useState(!1),[$,fe]=K.useState(!1),[ve,pe]=K.useState(!0),[he,Fe]=K.useState(!1),[st,we]=K.useState(null);K.useEffect(()=>{if(y!=null&&y.upcomingAppointments){const $e=y.upcomingAppointments.find(mt=>mt.status===1);$e?(console.log("Found active appointment:",$e),we($e),Fe(!0)):(we(null),Fe(!1))}},[y==null?void 0:y.upcomingAppointments]);const je=$e=>{te($e),x(!0)},nt=()=>{x(!1),W(!0)},Et=()=>{console.log("Cancelled appointment ID:",se),console.log("Reason:",le),f(iy({appointment_id:se,cancel_message:le})).then(()=>{f($T()),W(!1),ce(""),te(null),Q(!0)})};K.useEffect(()=>{const $e=setTimeout(()=>{},1e3),mt=setTimeout(()=>{Fe(!0)},3e3);return()=>{clearTimeout($e),clearTimeout(mt)}},[]);const ge=(y==null?void 0:y.upcomingAppointments)||[],qe=(y==null?void 0:y.pendingPrescriptions)||[],Oe=me?ge:ge.slice(0,4),Be=_e?qe:qe.slice(0,3),rt=async $e=>{console.log($e,`JoinCall + ${a==null?void 0:a.id}`,"params of the data"),f(eR({appointmentId:$e})),f(tR({appointment_id:$e})),N&&o("/VideoCall",{state:{id:st.appointment_id,patientId:st.patient_id,name:st==null?void 0:st.patient_name}})},Nt=($e,mt)=>{if(!$e||!mt)return!1;try{const[bt,Bt,fn]=$e.split(" "),vn=new Date().getFullYear(),qi=new Date(`${Bt} ${fn}, ${vn}`),[yt,Vt]=mt.split(" - "),gt=Vt.includes("AM")?"AM":"PM",Zt=`${yt} ${gt}`;return(new Date(`${qi.toDateString()} ${Zt}`)-new Date)/(1e3*60*60)<=2}catch(bt){return console.error("Date parse error:",bt),!1}};return E.jsx(E.Fragment,{children:E.jsxs("main",{className:"doctor-panel",children:[E.jsxs("div",{className:"container-fluid",children:[E.jsx("div",{className:"doc-panel-inr",children:E.jsx(Va,{})}),R?E.jsx("div",{className:"loader-main",children:E.jsx("span",{className:"loader"})}):E.jsx("div",{className:"doc-panel-body",children:E.jsxs("div",{className:"appointments",children:[he&&st&&E.jsxs("div",{className:"start-appointment cmn-mb",children:[E.jsx("div",{className:"docpnl-sec-head",children:E.jsx("h1",{className:"h2-title",children:"Start Appointment"})}),E.jsxs("div",{className:"apointment-detail-card",children:[E.jsx("div",{className:"apoint-dtl-img",children:E.jsx("img",{src:`${d}/${st.patient_profile}`,alt:st.patient_name})}),E.jsxs("div",{className:"appoint-dtl-content",children:[E.jsxs("div",{className:"appoint-dtl-left",children:[E.jsxs("div",{className:"appoint-dtl-head",children:[E.jsx("h2",{className:"h3-title",children:st.patient_name}),st.is_referred_patient&&E.jsxs("p",{children:["Referred by DS: ",st.ds_code]})]}),E.jsxs("div",{className:"appoint-btm",children:[E.jsxs("p",{children:[E.jsx("img",{src:"/images/clock-icon.svg",alt:"Icon"}),st.date]}),E.jsx("p",{className:"appoint-time",children:st.time}),E.jsx("a",{className:"orange-btn",onClick:()=>rt(String(st.appointment_id)),children:"Start now"}),console.log("patientId123:",st.patient_id)]})]}),E.jsx(Wt,{to:"/patient-profile",state:{patientId:st.patient_id},className:"cmn-btn",children:"View profile"})]})]})]}),E.jsxs("div",{className:"upcoming-apoints cmn-mb",children:[E.jsxs("div",{className:"docpnl-sec-head",children:[E.jsx("h1",{className:"h2-title",children:"Upcoming Appointments"}),E.jsx("button",{className:"cmn-btn",onClick:()=>o("/my-appointments"),children:"See all"})]}),E.jsx("div",{className:"appointments-row-wrp cmn-mb",children:E.jsx("div",{className:"appointments-row row",children:Oe.map(($e,mt)=>E.jsx("div",{className:"appointment-card-wrp col-lg-3 col-md-4 col-sm-6",children:E.jsxs("div",{className:"appointment-card",children:[E.jsx("div",{className:"card-img",children:E.jsx("img",{src:`${d}/${$e.patient_profile}`||"",alt:$e.patient_name})}),E.jsxs("div",{className:"card-body",children:[E.jsx(Wt,{to:"/patient-details",state:{id:$e.appointment_id,patientId:$e.patient_id,referrerDscode:$e.ds_code,referrer:$e.referred_patient_name},className:"cmn-btn",children:"View full detail"}),console.log("appointment_id for patient details",$e.appointment_id),E.jsxs("div",{className:"appointment-datetime",children:[E.jsx("p",{className:"date",children:$e.date}),E.jsx("p",{className:"time",children:$e.time})]}),E.jsx("div",{style:{minHeight:"24px"},children:$e.is_referred_patient?E.jsxs("p",{children:["Referred by DS Code: ",E.jsx("span",{style:{color:"#199FD9"},children:$e.ds_code})]}):E.jsx("p",{style:{visibility:"hidden"},children:"Placeholder"})}),E.jsx("h3",{children:$e.patient_name}),E.jsx("input",{type:"submit",value:"Cancel",className:"w-100",onClick:()=>je($e.appointment_id),disabled:Nt($e.dayDate,$e.time)?{opacity:.5,cursor:"not-allowed"}:{}})]})]})},mt))})}),E.jsxs("div",{className:"pending-prescriptions",children:[E.jsxs("div",{className:"docpnl-sec-head",children:[E.jsx("h2",{children:"Pending Prescriptions"}),E.jsx("button",{className:"cmn-btn",onClick:()=>o("/pendingprescription"),children:"See all"})]}),E.jsx("div",{className:"pending-presc-table",children:E.jsxs("table",{children:[E.jsx("thead",{children:E.jsxs("tr",{children:[E.jsx("th",{children:"S.no."}),E.jsx("th",{children:"Patient Name"}),E.jsx("th",{children:"Upload Date"}),E.jsx("th",{children:"View Details"})]})}),E.jsxs("tbody",{children:[Be.length==0&&E.jsx("tr",{children:E.jsx("td",{colSpan:"8",style:{textAlign:"center"},children:R?"Loading...":"No data found"})}),Be.map(($e,mt)=>E.jsxs("tr",{children:[E.jsx("td",{children:String(mt+1).padStart(2,"0")}),E.jsxs("td",{style:{textAlign:"left",paddingLeft:"45px",width:"200px"},children:[E.jsx(Wt,{to:"/patient-profile",state:{patientId:$e.patient_id},className:"no-underline-link",style:{display:"inline-block"},children:$e.patient_name}),($e==null?void 0:$e.ds_code)&&E.jsxs("div",{className:"time",style:{color:"#199FD9"},children:["(DS Code: ",$e.ds_code,")"]})]}),E.jsxs("td",{children:[E.jsx("div",{className:"date",children:$e.symptom_upload_date.split(" ")[0]}),E.jsxs("div",{className:"time",children:[$e.symptom_upload_date.split(" ")[1]," ",$e.symptom_upload_date.split(" ")[2]]})]}),E.jsx("td",{children:E.jsx(Wt,{to:"/PendingAssignedPrescriptionDetails",state:{id:$e.symptom_id,patientId:$e.patient_id},children:"View"})})]},mt))]})]})})]})]})]})}),!he&&$&&E.jsx("div",{className:"modal fade show",tabIndex:"-1",style:{display:"block",backgroundColor:"rgba(0, 0, 0, 0.5)"},children:E.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:E.jsxs("div",{className:"modal-content text-center position-relative shadow",style:{width:"400px",minHeight:"280px",borderRadius:"20px",padding:"30px 20px"},children:[E.jsx("button",{type:"button",onClick:()=>fe(!1),className:"position-absolute top-0 end-0 m-3 border-0 bg-transparent","aria-label":"Close",children:E.jsx("img",{src:"./images/cross-blue.png",alt:"Close Icon",style:{width:"24px",height:"24px"}})}),E.jsx("div",{className:"modal-icon mb-3",children:E.jsx("img",{src:"./images/bell-icon.svg",alt:"Reminder Icon",style:{width:"40px",height:"40px"}})}),E.jsxs("div",{className:"modal-header border-0 flex-column align-items-center p-0",children:[E.jsx("h2",{className:"fw-bold mb-2",style:{fontSize:"22px",color:"#333"},children:"Reminder:"}),E.jsx("p",{className:"m-0",style:{color:"#009CDE",fontWeight:"500"},children:"Your Appointment Starts in 2 Minutes!"})]}),E.jsxs("div",{className:"modal-body p-0 mt-4",children:[E.jsxs("div",{className:"text-muted mb-2",children:["Patients Name:"," ",E.jsx("span",{className:"fw-medium",style:{color:"#356598"},children:"John Smith"})]}),E.jsxs("div",{className:"text-muted",children:["Date and Time:"," ",E.jsx("span",{className:"fw-medium",style:{color:"#356598"},children:"December 26, 2024, 3:00 PM"})]})]})]})})}),E.jsx(go,{})]}),E.jsx(Zu,{visible:O,title:"Cancel Appointment",subtitle:"Are you sure you want to cancel the appointment?",onConfirm:nt,onCancel:()=>x(!1),actionType:"cancel"}),E.jsx(Zu,{visible:G,title:"Cancel Appointment",subtitle:"Reason for cancellation",inputField:!0,inputValue:le,onInputChange:$e=>ce($e),onCancel:()=>{W(!1),ce("")},onConfirm:Et,actionType:"info"}),E.jsx(Zu,{visible:ne,title:"Appointment Cancelled",subtitle:"Your appointment is cancelled successfully.",onConfirm:()=>Q(!1),onCancel:()=>Q(!1),actionType:"success"})]})})},oce=()=>{var st,we,je,nt,Et,ge,qe,Oe,Be,rt,Nt,$e,mt,bt,Bt,fn,vn,qi,yt,Vt;const o=qo(),i=$r(),{id:a,patientId:d,referrerDscode:f,referrer:y}=i.state||{};console.log(f,"reffer");const[R,w]=K.useState(!1),[N,O]=K.useState(!1),[x,G]=K.useState(!1),[W,ne]=K.useState(null),[Q,se]=K.useState(""),[te,le]=K.useState(null),[ce,me]=K.useState(!1),Ce=Mr(),{patientAppointmentsDetail:_e,doctorcancelledAppointment:ze,patientAppointmentsDetailLoading:Z,doctorcancelledLoading:J}=Zi(gt=>gt.appointments),$=void 0;K.useEffect(()=>{a&&Ce(U0({appointmentId:a}))},[Ce,a]),console.log("patientAppointmentsDetail",_e),console.log("id",a);const fe=gt=>{ne(gt),w(!0)},ve=()=>{w(!1),O(!0)},pe=()=>{Ce(iy({appointment_id:W,cancel_message:Q})).then(()=>{O(!1),se(""),ne(null),G(!0)})},he=gt=>{le(gt),me(!0)},Fe=()=>{var rn,kn;const gt=(rn=_e==null?void 0:_e.patientData)==null?void 0:rn.dayDate,Zt=(kn=_e==null?void 0:_e.patientData)==null?void 0:kn.time;if(!gt||!Zt)return!1;try{const[,ui,Zr]=gt.split(" "),_r=new Date().getFullYear(),[Ko,Qs]=Zt.split(" - "),Ti=Qs.split(" ")[1],Fa=`${ui} ${Zr} ${_r} ${Ko} ${Ti}`;return(new Date(Fa)-new Date)/(1e3*60*60)<=2}catch(ui){return console.error("Date parse error:",ui),!1}};return E.jsx(E.Fragment,{children:E.jsxs("main",{className:"doctor-panel",children:[E.jsxs("div",{className:"container-fluid",children:[E.jsx("div",{className:"doc-panel-inr",children:E.jsx(Va,{})}),Z?E.jsx("div",{className:"loader-main",children:E.jsx("span",{className:"loader"})}):E.jsxs("div",{className:"doc-panel-body appoint-details-pg has-texture",children:[E.jsx("div",{className:"texture only-img",children:E.jsx("img",{src:"/images/doctor-symbol.png",alt:"Image"})}),E.jsxs("div",{className:"appointments",children:[E.jsxs("div",{className:"start-appointment cmn-mb",children:[E.jsxs("div",{className:"docpnl-sec-head",children:[E.jsx("h1",{className:"h2-title",children:"Appointment Details"}),E.jsx("div",{className:"back-btn",children:E.jsx(Wt,{to:"#",onClick:gt=>{gt.preventDefault(),window.history.back()},children:E.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),((st=_e==null?void 0:_e.patientData)==null?void 0:st.is_referred_patient)&&E.jsx("div",{className:"refered-by-cd",children:E.jsxs("p",{children:["Referred by ",y," (",f,")"]})}),E.jsxs("div",{className:"apointment-detail-card",style:{border:"2px solid #199FD9"},children:[!((we=_e==null?void 0:_e.patientData)!=null&&we.is_referred_patient)&&E.jsx("div",{className:"apoint-dtl-img",children:E.jsx("img",{src:`${$}/${(je=_e==null?void 0:_e.patientData)==null?void 0:je.patient_profile}`,alt:"Client"})}),E.jsxs("div",{className:`appoint-dtl-content ${(nt=_e==null?void 0:_e.patientData)!=null&&nt.is_referred_patient?"w-100 p-0":""}`,children:[E.jsxs("div",{className:"appoint-dtl-left",children:[E.jsx("div",{className:"appoint-dtl-head",children:E.jsx("h2",{className:"h3-title",children:(Et=_e==null?void 0:_e.patientData)==null?void 0:Et.patient_name})}),E.jsxs("div",{className:"appoint-btm",children:[E.jsxs("p",{children:[E.jsx("img",{src:"/images/clock-icon.svg",alt:"Icon"}),(ge=_e==null?void 0:_e.patientData)==null?void 0:ge.dayDate]}),E.jsx("p",{className:"appoint-time",children:(qe=_e==null?void 0:_e.patientData)==null?void 0:qe.time})]})]}),E.jsx(Wt,{to:"/patient-profile",state:{patientId:d,hideSchedule:!0},className:"cmn-btn",children:"View profile"})]})]})]}),E.jsx("div",{className:"patient-details-wrp",children:E.jsx("form",{children:E.jsxs("div",{className:"patient-dtl-form",children:[E.jsxs("div",{className:"patient-basic-info cmn-mb2",children:[E.jsx("h2",{children:"Basic Information"}),E.jsxs("div",{className:"row",children:[E.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Full Name"}),E.jsx("input",{type:"text",placeholder:"Name",value:(Oe=_e==null?void 0:_e.basicInformation)==null?void 0:Oe.name,readOnly:!0})]})}),E.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Enter Your Height"}),E.jsx("input",{type:"text",placeholder:"26",value:(Be=_e==null?void 0:_e.basicInformation)==null?void 0:Be.height,readOnly:!0})]})}),E.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Enter Your Weight"}),E.jsx("input",{type:"text",placeholder:"50kg",value:(rt=_e==null?void 0:_e.basicInformation)==null?void 0:rt.weight,readOnly:!0})]})}),E.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Gender"}),E.jsx("input",{type:"text",placeholder:"Male",value:(Nt=_e==null?void 0:_e.basicInformation)==null?void 0:Nt.gender,readOnly:!0})]})}),E.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Enter Age"}),E.jsx("input",{type:"text",placeholder:"26",value:($e=_e==null?void 0:_e.basicInformation)==null?void 0:$e.age,readOnly:!0})]})})]})]}),E.jsxs("div",{className:"scheduled-call-consultations cmn-mb2",children:[E.jsx("h2",{children:"Scheduled Call Consultations"}),E.jsxs("div",{className:"row",children:[E.jsx("div",{className:"col-lg-12",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"1. How long are you suffering from this disease?"}),E.jsx("input",{type:"text",placeholder:"Answer",value:(mt=_e==null?void 0:_e.symptomAnswers)==null?void 0:mt.answer1,readOnly:!0})]})}),E.jsx("div",{className:"col-lg-12",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"2. Any other problem which you would like to share related to your problem?"}),E.jsx("input",{type:"text",placeholder:"Answer",value:(bt=_e==null?void 0:_e.symptomAnswers)==null?void 0:bt.answer2,readOnly:!0})]})}),E.jsx("div",{className:"col-lg-12",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"3. Do you have any history of this disease?"}),E.jsx("input",{type:"text",placeholder:"Answer",value:(Bt=_e==null?void 0:_e.symptomAnswers)==null?void 0:Bt.answer3,readOnly:!0})]})}),E.jsx("div",{className:"col-lg-12",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"4. Are you taking any medicines? If yes, please share the name of medicine and since how long you are taking this medicine?"}),E.jsx("input",{type:"text",placeholder:"Answer",value:(fn=_e==null?void 0:_e.symptomAnswers)==null?void 0:fn.answer4,readOnly:!0})]})})]})]}),Array.isArray(_e==null?void 0:_e.symptomFiles)&&(_e==null?void 0:_e.symptomFiles.length)>0&&E.jsxs("div",{className:"view-uploaded-images-wrp",children:[E.jsx("h2",{children:"View Uploaded Images"}),E.jsx("div",{className:"view-uploaded-img",children:_e==null?void 0:_e.symptomFiles.filter(gt=>gt.file_type.toLowerCase().match(/jpg|jpeg|png|gif/)).map((gt,Zt)=>E.jsx("div",{className:"img-wrp",children:E.jsx("a",{href:"#",onClick:rn=>{rn.preventDefault(),he(gt)},children:E.jsx("img",{src:`${$}/${gt.file_path}`,alt:`Symptom Image ${Zt+1}`})})},Zt))})]}),E.jsx("div",{className:"btn-wrp",children:E.jsx("button",{type:"button",className:"orange-btn",onClick:()=>{Fe()||fe(a)},disabled:Fe((vn=_e==null?void 0:_e.patientData)==null?void 0:vn.dayDate,(qi=_e==null?void 0:_e.patientData)==null?void 0:qi.time),style:Fe((yt=_e==null?void 0:_e.patientData)==null?void 0:yt.dayDate,(Vt=_e==null?void 0:_e.patientData)==null?void 0:Vt.time)?{opacity:.5,cursor:"not-allowed"}:{},children:"Cancel"})})]})})})]})]}),E.jsx(go,{})]}),E.jsx(Zu,{visible:R,title:"Cancel Appointment",subtitle:"Are you sure you want to cancel the appointment?",onConfirm:ve,onCancel:()=>w(!1),actionType:"cancel"}),E.jsx(Zu,{visible:N,title:"Cancel Appointment",subtitle:"Reason for cancellation",inputField:!0,inputValue:Q,onInputChange:gt=>se(gt),onCancel:()=>{O(!1),se("")},onConfirm:pe,actionType:"info"}),E.jsx(Zu,{visible:x,title:"Appointment Cancelled",subtitle:"Your appointment is cancelled successfully.",onConfirm:()=>{G(!1),o("/doctor-home")},onCancel:()=>G(!1),actionType:"success"}),ce&&te&&E.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center",overflow:"auto"},children:[E.jsx("button",{onClick:()=>me(!1),style:{position:"fixed",right:"30px",top:"30px",zIndex:1060,background:"transparent",border:"none",cursor:"pointer",padding:0},"aria-label":"Close",children:E.jsx("img",{src:"/images/cross-blue.png",alt:"Close",style:{width:"24px",height:"24px",filter:"brightness(0) invert(1)"}})}),E.jsx("div",{style:{maxWidth:"90vw",maxHeight:"90vh",display:"flex",alignItems:"center",justifyContent:"center"},children:E.jsx("img",{src:`${$}/${te.file_path}`,alt:"Enlarged view",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})})]})]})})};function cce(){It.error("Token Expired"),localStorage.removeItem("doctor-app"),setTimeout(()=>{window.location.href="/"},1e3)}const ry=$t("doctor/getPatientProfileData",async(o,{rejectWithValue:i})=>{var a;try{return(await Zae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),lce=l_({name:"patientProfile",initialState:{patientProfileData:[],loading:!1,error:null},reducers:{},extraReducers:o=>{o.addCase(ry.pending,i=>{i.loading=!0,i.error=null}).addCase(ry.fulfilled,(i,a)=>{var d;i.loading=!1,i.patientProfileData=(d=a.payload)==null?void 0:d.data}).addCase(ry.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to fetch users",a.payload.message=="Unauthenticated."&&cce()})}}),dce=lce.reducer,uce=()=>{var Ce,_e,ze,Z,J,$,fe,ve,pe,he,Fe,st,we,je,nt,Et,ge,qe;const i=$r(),{patientId:a,appointmentId:d,hideSchedule:f,source:y}=i.state||{};console.log("patientIdPPPPPP",a),console.log("sourcePPPPPP",y),console.log("appointmentIdPPPPPPP",d);const R=Mr(),{patientProfileData:w,loading:N}=Zi(Oe=>Oe.patientProfile),[O,x]=K.useState(null),[G,W]=K.useState(null),[ne,Q]=K.useState(!1);K.useEffect(()=>{a&&R(ry({patientId:a,source:y}))},[R,a,y]);const se=(w==null?void 0:w.basic_information)||{},te=(w==null?void 0:w.appointment_date_time)||{},le=(w==null?void 0:w.appointment_history)||{},ce=(w==null?void 0:w.referred_patients)||{},me=Oe=>{W(Oe),Q(!0)};return E.jsx(E.Fragment,{children:E.jsx("main",{className:"doctor-panel",children:E.jsxs("div",{className:"container-fluid",children:[E.jsx("div",{className:"doc-panel-inr",children:E.jsx(Va,{})}),N?E.jsx("div",{className:"loader-main",children:E.jsx("span",{className:"loader"})}):E.jsx("div",{className:"doc-panel-body has-texture",children:E.jsxs("div",{className:"start-appointment cmn-mb",children:[E.jsxs("div",{className:"docpnl-sec-head text-center",children:[E.jsx("h1",{className:"h2-title",children:"Patient Profile"}),E.jsx("div",{className:"back-btn",children:E.jsx(Wt,{to:"#",onClick:Oe=>{Oe.preventDefault(),window.history.back()},children:E.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),E.jsxs("div",{className:"patient-details-wrp",children:[E.jsx("div",{className:"patient-profile-wrp cmn-mb2",style:(Ce=w==null?void 0:w.basic_information)!=null&&Ce.is_referred?{}:{width:"100%",maxWidth:"100%"},children:E.jsx("div",{className:"patient-profile",style:{width:"100%",maxWidth:"100%"},children:E.jsxs("div",{className:"patient-profile-inr",style:{display:"flex",width:"100%",alignItems:"flex-start"},children:[!((_e=w==null?void 0:w.basic_information)!=null&&_e.is_referred)&&E.jsx("div",{className:"patient-profile-left",children:E.jsx("div",{className:"patient-profile-img-cover",children:E.jsx("div",{className:"patient-profile-cover-inr",children:E.jsx("div",{className:"patient-profile-img",children:E.jsx("img",{src:`undefined/${se.patient_profile}`,alt:"Patinet Profile Image"})})})})}),console.log((ze=w==null?void 0:w.basic_information)==null?void 0:ze.is_referred),E.jsxs("div",{className:"patient-profile-right",style:{maxWidth:(Z=w==null?void 0:w.basic_information)!=null&&Z.is_referred?"100%":void 0},children:[E.jsxs("div",{className:"patient-id",children:[E.jsx("h2",{children:se.name}),E.jsx("p",{className:"dscode",children:(J=w==null?void 0:w.basic_information)!=null&&J.is_referred?E.jsxs(E.Fragment,{children:[E.jsx("span",{style:{color:"black"},children:"Referred by"}),E.jsx(Wt,{to:"/patient-profile",state:{patientId:($=w==null?void 0:w.basic_information)==null?void 0:$.referred_id},style:{color:"#199fd9",textDecoration:"underline",marginLeft:5,display:"inline"},children:(fe=w==null?void 0:w.basic_information)==null?void 0:fe.referred_by})]}):E.jsxs("span",{children:["(DS Code:",se.ds_code,")"]})})]}),E.jsxs("div",{className:"patient-info",style:{display:"flex",flexWrap:"wrap",gap:"16px",padding:"0 16px"},children:[E.jsxs("div",{className:"patient-info-card",style:{flex:"0 1 calc(25% - 12px)",minWidth:"150px"},children:[E.jsx("h3",{children:"Gender"}),E.jsx("p",{children:((ve=se.gender)==null?void 0:ve.charAt(0).toUpperCase())+((pe=se.gender)==null?void 0:pe.slice(1).toLowerCase())})]}),E.jsxs("div",{className:"patient-info-card",style:{flex:"0 1 calc(25% - 12px)",minWidth:"150px"},children:[E.jsx("h3",{children:"Age"}),E.jsx("p",{children:se.age})]}),E.jsxs("div",{className:"patient-info-card",style:{flex:"0 1 calc(25% - 12px)",minWidth:"150px"},children:[E.jsx("h3",{children:"Height"}),E.jsx("p",{children:se.height})]}),E.jsxs("div",{className:"patient-info-card",style:{flex:"0 1 calc(25% - 12px)",minWidth:"150px"},children:[E.jsx("h3",{children:"Weight"}),E.jsx("p",{children:se.weight})]})]}),!((he=w==null?void 0:w.basic_information)!=null&&he.is_referred)&&E.jsxs("div",{className:"patient-info",children:[E.jsxs("div",{className:"patient-info-card",children:[E.jsx("h3",{children:"Phone number"}),E.jsx("p",{children:se.phone_no})]}),E.jsxs("div",{className:"patient-info-card",children:[E.jsx("h3",{children:"Email ID"}),E.jsx("p",{children:se.email})]})]})]})]})})}),(w==null?void 0:w.is_appointment_present)&&E.jsxs("div",{className:"patient-basic-info cmn-mb2",children:[E.jsx("h2",{children:"Appointment Date & Time"}),E.jsxs("div",{className:"appointment-timing",children:[E.jsx("div",{className:"appointment-date",children:te.date}),E.jsx("div",{className:"appointment-time",children:te.time})]})]}),(w==null?void 0:w.is_appointment_present)&&!((Fe=w==null?void 0:w.basic_information)!=null&&Fe.is_referred)&&E.jsx("div",{className:"patient-detail-form-wrp cmn-mb2",children:E.jsx("form",{children:E.jsx("div",{className:"patient-dtl-form",children:E.jsxs("div",{className:"health-issues-symptoms cmn-mb2",children:[E.jsx("h2",{children:"Appointment Details"}),E.jsxs("div",{className:"health-symptoms-inr",children:[E.jsxs("div",{className:"health-symptoms-content",children:[E.jsxs("div",{className:"formfield white-input",children:[E.jsx("label",{children:"What symptoms are you facing? Please describe your symptoms in brief."}),E.jsx("input",{type:"text",placeholder:"Answer",value:((st=w==null?void 0:w.appointment_details)==null?void 0:st.answer1)||"No symptoms reported",readOnly:!0})]}),E.jsxs("div",{className:"formfield white-input",children:[E.jsx("label",{children:"How long have you been experiencing these symptoms?"}),E.jsx("input",{type:"text",placeholder:"Answer",value:((we=w==null?void 0:w.appointment_details)==null?void 0:we.answer2)||"No duration specified",readOnly:!0})]}),E.jsxs("div",{className:"formfield white-input",children:[E.jsx("label",{children:"Any knows Diseases / Health Conditions you are facing?"}),E.jsx("input",{type:"text",placeholder:"Parasitic diseases",value:((je=w==null?void 0:w.appointment_details)==null?void 0:je.answer3)||"No known diseases",readOnly:!0})]}),E.jsxs("div",{className:"formfield white-input",children:[E.jsx("label",{children:"Any past medical conditions?"}),E.jsx("input",{type:"text",placeholder:"Answer",value:((nt=w==null?void 0:w.appointment_details)==null?void 0:nt.answer4)||"No past conditions reported",readOnly:!0})]})]}),Array.isArray(w==null?void 0:w.viewUploadedImages)&&((Et=w==null?void 0:w.viewUploadedImages)==null?void 0:Et.length)>0&&E.jsxs("div",{className:"view-uploaded-images-wrp",children:[E.jsx("h2",{className:"h5-title",children:"View Uploaded Images"}),E.jsx("div",{className:"view-uploaded-img",children:((ge=w==null?void 0:w.viewUploadedImages)==null?void 0:ge.length)>0?w.viewUploadedImages.map((Oe,Be)=>E.jsx("div",{className:"img-wrp",children:E.jsx("a",{href:"#",onClick:rt=>{rt.preventDefault(),me(Oe)},children:E.jsx("img",{src:`undefined/${Oe.file_path}`,alt:`Symptom ${Be+1}`})})},Be)):E.jsx("p",{children:"No images uploaded"})}),ne&&G&&E.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center",overflow:"auto"},children:[E.jsx("button",{onClick:()=>Q(!1),style:{position:"fixed",right:"30px",top:"30px",zIndex:1060,background:"transparent",border:"none",cursor:"pointer",padding:0},"aria-label":"Close",children:E.jsx("img",{src:"/images/cross-blue.png",alt:"Close",style:{width:"24px",height:"24px",filter:"brightness(0) invert(1)"}})}),E.jsx("div",{style:{maxWidth:"90vw",maxHeight:"90vh",display:"flex",alignItems:"center",justifyContent:"center"},children:E.jsx("img",{src:`undefined/${G.file_path}`,alt:"Enlarged view",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})})]})]})]})]})})})}),E.jsxs("div",{className:"pending-prescriptions cmn-mb2 bg-blue",children:[E.jsx("h2",{children:"Appointment History"}),E.jsx("div",{className:"pending-presc-table",children:E.jsxs("table",{children:[E.jsx("thead",{children:E.jsxs("tr",{children:[E.jsx("th",{children:"S.no."}),E.jsx("th",{children:"Appointment Date"}),E.jsx("th",{children:"Disease"}),E.jsx("th",{children:"View Prescription"})]})}),E.jsx("tbody",{children:le.length>0?le.map((Oe,Be)=>{var rt;return E.jsxs("tr",{children:[E.jsx("td",{children:String(Be+1).padStart(2,"0")}),E.jsx("td",{children:Oe.appointment_date}),E.jsx("td",{children:Oe.diagnosis}),E.jsx("td",{children:E.jsx(Wt,{to:"/completed-appointment-screen",state:{id:Oe.prescription_id,patientId:(rt=w==null?void 0:w.appointment_details)==null?void 0:rt.patient_id,chat_id:Oe.chat_id},className:"link",children:"View"})})]},Oe.id||Be)}):E.jsx("tr",{children:E.jsx("td",{colSpan:"4",className:"text-center",children:"No Appointment history found"})})})]})})]}),!((qe=w==null?void 0:w.basic_information)!=null&&qe.is_referred)&&E.jsxs("div",{className:"pending-prescriptions",children:[E.jsx("h2",{children:"Referred Patient list"}),E.jsx("div",{className:"pending-presc-table",children:E.jsxs("table",{children:[E.jsx("thead",{children:E.jsxs("tr",{children:[E.jsx("th",{children:"S.no."}),E.jsx("th",{children:"Patient Name"}),E.jsx("th",{children:"Gender"}),E.jsx("th",{children:"Age"}),E.jsx("th",{children:"Weight (kg)"}),E.jsx("th",{children:"Height"}),E.jsx("th",{children:"View Profile"})]})}),E.jsx("tbody",{children:ce.length>0?ce.map((Oe,Be)=>{var rt,Nt;return E.jsxs("tr",{children:[E.jsx("td",{children:String(Be+1).padStart(2,"0")}),E.jsx("td",{style:{textAlign:"left",paddingLeft:"35px",width:"200px"},children:E.jsx(Wt,{to:"/patient-profile",state:{patientid:a},className:"no-underline-link",style:{display:"inline-block"},children:Oe.name})}),E.jsx("td",{children:((rt=se.gender)==null?void 0:rt.charAt(0).toUpperCase())+((Nt=se.gender)==null?void 0:Nt.slice(1).toLowerCase())}),E.jsx("td",{children:Oe.age}),E.jsx("td",{children:Oe.weight}),E.jsx("td",{children:Oe.height}),E.jsx("td",{children:E.jsx(Wt,{to:"/patient-profile",state:{referrer:se.name,referrerDscode:se.ds_code,id:Oe.id,patientId:Oe.id},children:"View Profile"})})]},Oe.id||Be)}):E.jsx("tr",{children:E.jsx("td",{colSpan:"7",className:"text-center",children:"No Referred patients found"})})})]})})]})]}),!(w!=null&&w.is_appointment_present)&&!f&&E.jsx("div",{className:"schedule-appoinment-btn",children:E.jsx(Wt,{to:"/schedule-appointment",state:{patientId:a,appointmentId:d},className:"orange-btn",children:"Schedule Appointment"})})]})}),E.jsx(go,{})]})})})},hce=({onFilterChange:o,onSearch:i,activeTab:a,onSearchDate:d})=>{const[f,y]=K.useState(""),[R,w]=K.useState([]),[N,O]=K.useState(""),[x,G]=K.useState(!1),[W,ne]=K.useState([]),[Q,se]=K.useState({name:"",age:"",diagnosis:""}),[te,le]=K.useState(!1),[ce,me]=K.useState(new Date().getMonth()),[Ce,_e]=K.useState(new Date().getFullYear()),[ze,Z]=K.useState(!0),[J,$]=K.useState(""),[fe,ve]=K.useState(""),[pe,he]=K.useState("");Mr();const{completedAppointment:Fe}=Zi(mt=>mt.appointments),st=["January","February","March","April","May","June","July","August","September","October","November","December"];K.useEffect(()=>{we()},[]),K.useEffect(()=>{we(),d(null),o({name:"",age:"",diagnosis:""})},[a]),K.useEffect(()=>{if(Fe&&Fe.length>0){const mt=[...new Set(Fe.map(bt=>bt.diagnosis).filter(bt=>bt&&bt.trim()!==""&&bt.trim()!=="-"))];ne(mt)}},[Fe]);const we=()=>{y(""),O(""),se({name:"",age:"",diagnosis:""}),G(!1),$(""),ve(""),le(!1),me(new Date().getMonth()),_e(new Date().getFullYear()),he("")},je=mt=>{const bt=mt.target.value;he(bt),i(bt)},nt=mt=>{const{name:bt,value:Bt}=mt.target;if(bt==="name"){const fn=Bt.replace(/[^A-Za-z\s]/g,"");se(vn=>({...vn,[bt]:fn}))}else bt==="age"?(Bt===""||/^[0-9\b]+$/.test(Bt))&&(Bt===""||parseInt(Bt,10)>=0&&parseInt(Bt,10)<=99&&Bt.length<=2)&&se(fn=>({...fn,[bt]:Bt})):se(fn=>({...fn,[bt]:Bt}))},Et=()=>{G(mt=>!mt)},ge=mt=>{let bt=ce+mt,Bt=Ce;bt>11?(bt=0,Bt++):bt<0&&(bt=11,Bt--),me(bt),_e(Bt)},qe=()=>{const mt=new Date(Ce,ce,1).getDay(),bt=new Date(Ce,ce+1,0).getDate(),Bt=[];let fn=[];for(let vn=0;vn<mt;vn++)fn.push(E.jsx("td",{className:"empty-cell"},`empty-${vn}`));for(let vn=1;vn<=bt;vn++){const qi=J&&J.startsWith(`${vn}/${ce+1}`),yt=fe&&fe.startsWith(`${vn}/${ce+1}`);let Vt=!1;if(!ze&&J){const gt=J.split("/"),Zt=new Date(gt[2],gt[1]-1,gt[0]);Vt=new Date(Ce,ce,vn)<=Zt}fn.push(E.jsx("td",{className:`calendar-day 
            ${qi?"selected-from":""} 
            ${yt?"selected-to":""}
            ${Vt?"disabled-day":""}`,onClick:()=>!Vt&&Oe(vn),style:Vt?{color:"#ccc",cursor:"not-allowed"}:{},children:vn},`day-${vn}`)),((mt+vn)%7===0||vn===bt)&&(Bt.push(E.jsx("tr",{children:fn},`week-${Bt.length}`)),fn=[])}return Bt},Oe=mt=>{const bt=`${mt}/${ce+1}/${Ce}`;if(ze){if($(bt),Z(!1),fe){const Bt=fe.split("/"),fn=new Date(Bt[2],Bt[1]-1,Bt[0]),vn=new Date(Ce,ce,mt);fn<=vn&&ve("")}}else{const Bt=J.split("/"),fn=new Date(Bt[2],Bt[1]-1,Bt[0]);if(new Date(Ce,ce,mt)>fn)ve(bt);else{alert("To Date must be after From Date");return}}},Be=()=>{le(mt=>!mt),!te&&!J&&!fe&&Z(!0)},rt=mt=>{mt==="clear"?(se({name:"",age:"",diagnosis:""}),o({name:"",age:"",diagnosis:""}),G(!1)):(o(Q),G(!1))},Nt=()=>{$(""),ve(""),Z(!0),d(null),le(!1)},$e=()=>{if(J&&fe){const mt=J.split("/"),bt=fe.split("/"),Bt=new Date(mt[2],mt[1]-1,mt[0]),fn=new Date(bt[2],bt[1]-1,bt[0]);fn.setHours(23,59,59,999),d([Bt,fn]),le(!1)}};return E.jsxs("div",{className:"my-appointments-search-wrp",style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px"},children:[E.jsxs("div",{className:"datepicker-wrp",style:a=="upcoming"?{display:"none"}:{},children:[E.jsx("input",{type:"text",id:"dateRangeInput",placeholder:"Select date range",readOnly:!0,value:J&&fe?`${J} - ${fe}`:"",onClick:Be}),te&&E.jsxs("div",{className:"calendar-popup",style:{display:"block",position:"absolute",zIndex:1e3,background:"white",padding:"0px",borderRadius:"5px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)",width:"300px",left:0,overflow:"hidden"},children:[E.jsxs("div",{className:"calendar-header",children:[E.jsx("div",{className:"cal-head-btn-wrp",children:E.jsx("button",{type:"button",className:`range-btn ${ze?"active":""}`,onClick:()=>Z(!0),children:E.jsx("span",{id:"fromDateLabel",children:J||"From Date"})})}),E.jsx("div",{className:"cal-head-btn-wrp",children:E.jsx("button",{type:"button",className:`range-btn ${ze?"":"active"}`,onClick:()=>Z(!1),children:E.jsx("span",{id:"toDateLabel",children:fe||"To Date"})})}),E.jsxs("div",{className:"monthyear-wrp w-100",style:{display:"flex",justifyContent:"space-between",alignItems:"center",margin:"10px 0"},children:[E.jsx("button",{type:"button",className:"arrow-btn",onClick:()=>ge(-1),style:{border:"none",background:"none",cursor:"pointer",fontSize:"16px"},children:""}),E.jsxs("span",{id:"monthYearLabel",style:{fontWeight:"bold"},children:[st[ce]," ",Ce]}),E.jsx("button",{type:"button",className:"arrow-btn",onClick:()=>ge(1),style:{border:"none",background:"none",cursor:"pointer",fontSize:"16px"},children:""})]})]}),E.jsxs("table",{className:"calendar-grid",style:{width:"100%",borderCollapse:"collapse"},children:[E.jsx("thead",{children:E.jsx("tr",{children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(mt=>E.jsx("th",{style:{padding:"5px",textAlign:"center"},children:mt},mt))})}),E.jsx("tbody",{children:qe()})]}),E.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"10px",borderTop:"1px solid #eee"},children:[E.jsx("button",{onClick:Nt,style:{padding:"5px 10px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:"3px",cursor:"pointer"},children:"Clear"}),E.jsx("button",{onClick:$e,disabled:!J||!fe,style:{padding:"5px 10px",background:J&&fe?"#0066cc":"#ccc",color:"white",border:"none",borderRadius:"3px",cursor:J&&fe?"pointer":"not-allowed"},children:"Apply"})]})]})]}),E.jsxs("div",{className:"formfield",style:a=="completed"?{display:"none"}:{},children:[E.jsx("input",{placeholder:"Search anything here",type:"text",value:pe,onChange:je}),E.jsx("input",{type:"submit"})]}),E.jsxs("div",{className:"past-patient-filter-wrp",style:a==="cancelled"||a==="upcoming"?{display:"none"}:{},children:[E.jsxs("button",{type:"button",onClick:Et,children:["Filter",E.jsx("img",{src:"./images/filter-icon.svg",alt:"Icon"})]}),E.jsx("div",{className:`filter-options-drpdn ${x?"active":""}`,children:E.jsxs("form",{children:[E.jsxs("div",{className:"filter-form",children:[E.jsxs("div",{className:"filter-grp",children:[E.jsx("label",{children:"Patient Name"}),E.jsx("input",{type:"text",name:"name",value:Q.name,onChange:nt,placeholder:"Patient Name",pattern:"[A-Za-z\\s]+",title:"Only letters and spaces allowed"})]}),E.jsxs("div",{className:"filter-grp",children:[E.jsx("label",{children:"Age"}),E.jsx("input",{type:"text",name:"age",value:Q.age,onChange:nt,placeholder:"Age",maxLength:2,pattern:"[0-9]*"})]}),E.jsxs("div",{className:"filter-grp",children:[E.jsx("label",{children:"Disease"}),E.jsxs("select",{name:"diagnosis",value:Q.diagnosis,onChange:nt,children:[E.jsx("option",{value:"",children:"Disease"}),W.map((mt,bt)=>E.jsx("option",{value:mt,children:mt},bt))]})]})]}),E.jsxs("div",{className:"filter-form-btn-wrp",children:[E.jsx("button",{type:"button",className:"orange-btn",onClick:()=>rt("clear"),style:{borderRadius:0},children:"Clear Filter"}),E.jsx("button",{type:"button",className:"orange-btn",onClick:()=>rt("apply"),style:{borderRadius:0},children:"Apply Filter"})]})]})})]})]})},nR=({currentPage:o,totalPages:i,onPageChange:a,onNext:d,onPrevious:f})=>{const y=[];if(i<=5)for(let R=1;R<=i;R++)y.push(R);else o<=3?y.push(1,2,3,4,"...",i):o>=i-2?y.push(1,"...",i-3,i-2,i-1,i):y.push(1,"...",o-1,o,o+1,"...",i);return E.jsxs("div",{className:"tablepagination",children:[E.jsx("div",{className:"tbl-pagination-inr",children:E.jsxs("ul",{children:[E.jsx("li",{children:E.jsxs(Wt,{to:"#url",onClick:R=>{R.preventDefault(),f()},children:[E.jsx("img",{src:"./images/arrow-left-black.svg",alt:"Icon"}),"Previous"]})}),y.map((R,w)=>E.jsx("li",{className:o===R?"active":"",children:R==="..."?E.jsx(Wt,{to:"#url",onClick:N=>N.preventDefault(),children:"..."}):E.jsx(Wt,{to:"#url",onClick:N=>{N.preventDefault(),a(R)},children:R})},w)),E.jsx("li",{children:E.jsxs(Wt,{to:"#url",onClick:R=>{R.preventDefault(),d()},children:["Next",E.jsx("img",{src:"./images/arrow-right-black.svg",alt:"Icon"})]})})]})}),E.jsxs("div",{className:"pages-select",children:[E.jsx("form",{children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Page"}),E.jsx("select",{value:o,onChange:R=>a(Number(R.target.value)),children:Array.from({length:i},(R,w)=>w+1).map(R=>E.jsx("option",{value:R,children:R},`page-${R}`))})]})}),E.jsxs("p",{children:["of ",i]})]})]})},eH=()=>{var _r,Ko,Qs,Ti,Fa,Gt;const o=qo(),{channelDetails:i}=Zi(Me=>Me.appointments);console.log(i,"jfaklshfsahdfks");const a=Mr(),{upcommingAppointment:d,completedAppointment:f,cancelledAppointment:y,doctorcancelledAppointment:R,upcomingLoading:w,completedLoading:N,cancelledLoading:O,doctorcancelledLoading:x}=Zi(Me=>Me.appointments),G=void 0,[W,ne]=K.useState("upcoming"),[Q,se]=K.useState(!1),[te,le]=K.useState(!1),[ce,me]=K.useState(!1),[Ce,_e]=K.useState(null),[ze,Z]=K.useState(""),[J,$]=K.useState(1),[fe,ve]=K.useState(new Date),pe=8,[he,Fe]=K.useState({patientName:"",age:"",disease:""}),[st,we]=K.useState([]),[je,nt]=K.useState([]),[Et,ge]=K.useState([]);K.useEffect(()=>{a(ZT()),a(x0()),a(M0())},[a]),K.useEffect(()=>{$(1),Fe({patientName:"",age:"",disease:""}),we(d),nt(f),ge(y)},[W,d,f,y]),console.log("$$$$$$$$$$$$",d),K.useEffect(()=>{nt(qe(f,"completed"))},[he]);const qe=(Me,un)=>Me.filter(gn=>{var gr;const Ai=!he.patientName||((gr=gn.patient_name)==null?void 0:gr.toLowerCase().includes(he.patientName.toLowerCase())),Ea=!he.age||gn.patient_age.toString().includes(he.age);if(un==="cancelled")return Ai&&Ea;const Ki=!he.disease||gn.diagnosis&&gn.diagnosis!=="-"&&gn.diagnosis.toLowerCase()===he.disease.toLowerCase();return Ai&&Ea&&Ki}),[Oe,Be]=K.useState(null);K.useEffect(()=>{if(st){const Me=st.find(un=>un.status===1);Me?(console.log("Found active appointment:",Me),Be(Me)):Be(null)}},[st]);const rt=Me=>{switch(Fe({patientName:Me.name||"",age:Me.age||"",disease:Me.diagnosis||""}),W){case"upcoming":we(qe(d,"upcoming"));break;case"completed":nt(qe(f,"completed"));break;case"cancelled":ge(qe(y,"cancelled"));break}$(1)},$e=JSON.parse(localStorage.getItem("doctor-app")||"{}").doctorData;console.log($e==null?void 0:$e.id,"Doctor Data");const mt=async Me=>{console.log(Me,`JoinCall + ${$e==null?void 0:$e.id}`,"params of the data"),a(eR({channelName:`JoinCall + ${$e==null?void 0:$e.id}`,appointmentId:Me})),a(tR({appointment_id:Me})),i&&o("/VideoCall",{state:{id:Oe.appointment_id,patientId:Oe.patient_id,name:Oe==null?void 0:Oe.patient_name}})},bt=Me=>{const un=Me.toLowerCase().trim(),gn=/^\d+$/.test(Me),Ai=Ea=>Ea.filter(Ki=>{var Yo,Xo,ya,Vc,xl,Ba;const gr=((Yo=Ki.patient_age)==null?void 0:Yo.toString())||"",cr=((Xo=Ki.patient_phone)==null?void 0:Xo.toString())||"",Ts=Ki.datetime?new Date(Ki.datetime).getDate().toString():"";return gn?gr===Me||cr.includes(Me):((ya=Ki.patient_name)==null?void 0:ya.toLowerCase().includes(un))||((Vc=Ki.patient_gender)==null?void 0:Vc.toLowerCase())===un||cr.includes(Me)||Ts.includes(un)||((xl=Ki.datetime)==null?void 0:xl.toLowerCase().includes(un))||W==="completed"&&((Ba=Ki.diagnosis)==null?void 0:Ba.toLowerCase().includes(un))});switch(W){case"upcoming":we(Ai(d));break;case"completed":nt(Ai(f));break;case"cancelled":ge(Ai(y));break}$(1)},Bt=Me=>{const[un,gn,Ai]=Me.split(" "),[Ea,Ki,gr]=un.split("/").map(Number);let[cr,Ts]=gn.split(":").map(Number);return Ai==="PM"&&cr!==12&&(cr+=12),Ai==="AM"&&cr===12&&(cr=0),new Date(gr,Ki-1,Ea,cr,Ts)},fn=Me=>{if(Me==null){switch(W){case"completed":nt(f);break;case"cancelled":ge(y);break}return}if(!Me||Me.length!==2)return;const[un,gn]=Me;switch(W){case"completed":const Ai=f.filter(Ki=>{const gr=Bt(Ki.datetime);return gr>=un&&gr<=gn});nt(Ai);break;case"cancelled":const Ea=y.filter(Ki=>{const gr=Bt(Ki.datetime);return gr>=un&&gr<=gn});ge(Ea);break}},vn=Me=>{_e(Me),se(!0)},qi=()=>{se(!1),le(!0)},yt=()=>{console.log("Cancelled appointment ID:",Ce),console.log("Reason:",ze),a(iy({appointment_id:Ce,cancel_message:ze})).then(()=>{a(ZT()),le(!1),Z(""),_e(null),me(!0)})},Vt=Me=>{const un=J*pe,gn=un-pe;return Me==null?void 0:Me.slice(gn,un)},gt=Me=>Math.ceil((Me==null?void 0:Me.length)/pe),Zt=Me=>{$(Me)},rn=()=>{const Me=gt(W==="upcoming"?st:W==="completed"?je:Et);J<Me&&$(J+1)},kn=()=>{J>1&&$(J-1)};gt(W==="upcoming"?st:W==="completed"?je:Et);const Zr=Me=>{const un=Bt(Me),gn=new Date,Ai=new Date(gn.getTime()+1*60*60*1e3);return console.log(un),un<=Ai};return E.jsxs("div",{className:"doctor-panel",children:[E.jsxs("div",{className:"container-fluid",children:[E.jsxs("div",{className:"doc-panel-inr",children:[" ",E.jsx(Va,{})," "]}),w||N||O?E.jsx("div",{className:"loader-main",children:E.jsx("span",{className:"loader"})}):E.jsx("div",{className:"doc-panel-body",children:E.jsx("div",{className:"my-appointments-wrp",children:E.jsxs("div",{className:"my-appointments-inr",children:[E.jsxs("div",{className:"my-appointments-tab-header",children:[E.jsx("div",{className:"my-appointments-tab-head",children:E.jsxs("ul",{style:{position:"relative"},children:[E.jsx("li",{className:"tab-bg"}),E.jsx("li",{style:W=="upcoming"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>ne("upcoming"),children:" Upcoming "}),E.jsx("li",{style:W=="completed"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>ne("completed"),children:" Completed "}),E.jsx("li",{style:W=="cancelled"?{backgroundColor:"white",borderRadius:"10px",color:"#356598"}:{},onClick:()=>ne("cancelled"),children:" Cancelled "})]})}),E.jsx(hce,{onFilterChange:rt,onSearch:bt,onSearchDate:fn,activeTab:W})]}),E.jsxs("div",{className:"my-appointments-tab-content-wrp",children:[E.jsxs("div",{className:`myapintmnt-content-tab ${W==="upcoming"?"upcoming":""}`,style:{display:W==="upcoming"?"block":"none"},children:[E.jsx("div",{className:"myapintmnt-table",children:E.jsxs("table",{children:[E.jsx("thead",{children:E.jsxs("tr",{children:[E.jsx("th",{children:"S.no."}),E.jsx("th",{children:"Name"}),E.jsx("th",{children:"Age"}),E.jsx("th",{children:"Gender"}),E.jsx("th",{children:"Phone number"}),E.jsx("th",{children:"Appointment date"}),E.jsx("th",{children:"Status"}),E.jsx("th",{children:"Action"})]})}),E.jsxs("tbody",{children:[console.log("filteredUpcomingPatients1234: ",st),((_r=Vt(st))==null?void 0:_r.length)==0&&E.jsx("tr",{children:E.jsx("td",{colSpan:"8",style:{textAlign:"center",padding:"25px 0"},children:"No data found"})}),(Ko=Vt(st))==null?void 0:Ko.map((Me,un)=>{var gn,Ai;return E.jsxs("tr",{children:[E.jsx("td",{children:String((J-1)*pe+un+1).padStart(2,"0")}),E.jsxs("td",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[E.jsx("img",{src:G+"/"+(Me==null?void 0:Me.patient_profile),alt:"Patient"}),E.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[E.jsx(Wt,{to:"/patient-profile",state:{patientId:Me.patient_id},children:E.jsx("h3",{style:{margin:0,textAlign:"left"},children:Me.patient_name||"-"})}),(Me==null?void 0:Me.ds_code)&&E.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:["(DS Code: ",Me.ds_code,")"]})]})]}),E.jsx("td",{children:Me.patient_age||"-"}),E.jsx("td",{children:((gn=Me.patient_gender)==null?void 0:gn.charAt(0).toUpperCase())+((Ai=Me.patient_gender)==null?void 0:Ai.slice(1).toLowerCase())}),E.jsx("td",{children:Me.patient_phone||"-"}),E.jsxs("td",{children:[E.jsx("div",{className:"date h3-title",children:Me.datetime.split(" ")[0]}),E.jsxs("div",{className:"time",children:[Me.datetime.split(" ")[1]," ",Me.datetime.split(" ")[2]]})]}),E.jsx("td",{children:Me.status===1?E.jsx("a",{className:"orange-btn",style:{cursor:"pointer"},onClick:()=>mt(Me.appointment_id),children:"Start now"}):E.jsx("button",{type:"button",className:"cmn-btn blue-bg",onClick:()=>vn(Me.appointment_id),disabled:Zr(Me.datetime),style:{opacity:Zr(Me.datetime)?.6:1,cursor:Zr(Me.datetime)?"not-allowed":"pointer"},children:"Cancel"})}),E.jsx("td",{children:E.jsx(Wt,{to:"/patient-profile",state:{patientId:Me.patient_id},className:"cmn-btn",children:"View Profile"})})]},`upcoming-${un}`)})]})]})}),(st==null?void 0:st.length)>0&&E.jsx(nR,{currentPage:J,totalPages:gt(st),onPageChange:Zt,onPrevious:kn,onNext:rn})]}),E.jsxs("div",{className:`myapintmnt-content-tab ${W==="completed"?"completed":""}`,style:{display:W==="completed"?"block":"none"},children:[E.jsx("div",{className:"myapintmnt-table",children:E.jsxs("table",{children:[E.jsx("thead",{children:E.jsxs("tr",{children:[E.jsx("th",{children:"S.no."}),E.jsx("th",{children:"Name"}),E.jsx("th",{children:"Age"}),E.jsx("th",{children:"Gender"}),E.jsx("th",{children:"Phone number"}),E.jsx("th",{children:"Appointment date"}),E.jsx("th",{children:"Disease"}),E.jsx("th",{children:"Prescription Details"}),E.jsx("th",{children:"Action"})]})}),E.jsxs("tbody",{children:[((Qs=Vt(je))==null?void 0:Qs.length)==0&&E.jsx("tr",{children:E.jsx("td",{colSpan:"8",style:{textAlign:"center",padding:"25px 0"},children:"No data found"})}),(Ti=Vt(je))==null?void 0:Ti.map((Me,un)=>{var gn,Ai;return E.jsxs("tr",{children:[E.jsx("td",{children:String((J-1)*pe+un+1).padStart(2,"0")}),E.jsxs("td",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[E.jsx("img",{src:G+"/"+(Me==null?void 0:Me.patient_profile),alt:"Patient"}),E.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[E.jsx(Wt,{to:"/patient-profile",state:{patientId:Me.patient_id},children:E.jsx("h3",{style:{margin:0,textAlign:"left"},children:Me.patient_name||"-"})}),(Me==null?void 0:Me.ds_code)&&E.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:["(DS Code: ",Me.ds_code,")"]})]})]}),E.jsx("td",{children:Me.patient_age||"-"}),E.jsx("td",{children:((gn=Me.patient_gender)==null?void 0:gn.charAt(0).toUpperCase())+((Ai=Me.patient_gender)==null?void 0:Ai.slice(1).toLowerCase())}),E.jsx("td",{children:Me.patient_phone||"-"}),E.jsxs("td",{children:[E.jsx("div",{className:"date h3-title",children:Me.datetime.split(" ")[0]}),E.jsxs("div",{className:"time",children:[Me.datetime.split(" ")[1]," ",Me.datetime.split(" ")[2]]})]}),E.jsx("td",{children:Me.diagnosis||"-"}),E.jsx("td",{children:E.jsx(Wt,{to:"/completed-appointment-screen",state:{id:Me.prescription_id,patientId:Me.patient_id,chat_id:Me.chat_id},style:{color:"#199FD9",textDecoration:"underline !important"},className:"text-primary text-decoration-underline",children:"View"})}),E.jsx("td",{children:E.jsx(Wt,{to:"/patient-profile",state:{patientId:Me.patient_id,appointmentId:Me.appointment_id,source:"completed",hideSchedule:!1},className:"cmn-btn",children:"View Profile"})})]},`completed-${un}`)})]})]})}),(je==null?void 0:je.length)>0&&E.jsx(nR,{currentPage:J,totalPages:gt(je),onPageChange:Zt,onPrevious:kn,onNext:rn})]}),E.jsxs("div",{className:`myapintmnt-content-tab ${W==="cancelled"?"cancelled":""}`,style:{display:W==="cancelled"?"block":"none"},children:[E.jsx("div",{className:"myapintmnt-table",children:E.jsxs("table",{children:[E.jsx("thead",{children:E.jsxs("tr",{children:[E.jsx("th",{children:"S.no."}),E.jsx("th",{children:"Name"}),E.jsx("th",{children:"Age"}),E.jsx("th",{children:"Gender"}),E.jsx("th",{children:"Phone number"}),E.jsx("th",{children:"Appointment date"}),E.jsx("th",{children:"Action"})]})}),E.jsxs("tbody",{children:[((Fa=Vt(Et))==null?void 0:Fa.length)==0&&E.jsx("tr",{children:E.jsx("td",{colSpan:"8",style:{textAlign:"center",padding:"25px 0"},children:"No data found"})}),(Gt=Vt(Et))==null?void 0:Gt.map((Me,un)=>{var gn,Ai;return E.jsxs("tr",{children:[E.jsx("td",{children:String((J-1)*pe+un+1).padStart(2,"0")}),E.jsxs("td",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[E.jsx("img",{src:G+"/"+(Me==null?void 0:Me.patient_profile),alt:"Patient"}),E.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[E.jsx(Wt,{to:"/patient-profile",state:{patientId:Me.patient_id},children:E.jsx("h3",{style:{margin:0,textAlign:"left"},children:Me.patient_name||"-"})}),(Me==null?void 0:Me.ds_code)&&E.jsxs("div",{style:{color:"#199fd9",marginTop:"2px"},children:["(DS Code: ",Me.ds_code,")"]})]})]}),E.jsx("td",{children:Me.patient_age||"-"}),E.jsx("td",{children:((gn=Me.patient_gender)==null?void 0:gn.charAt(0).toUpperCase())+((Ai=Me.patient_gender)==null?void 0:Ai.slice(1).toLowerCase())}),E.jsx("td",{children:Me.patient_phone||"-"}),E.jsxs("td",{children:[E.jsx("div",{className:"date h3-title",children:Me.datetime.split(" ")[0]}),E.jsxs("div",{className:"time",children:[Me.datetime.split(" ")[1]," ",Me.datetime.split(" ")[2]]})]}),E.jsx("td",{children:E.jsx(Wt,{to:"/patient-profile",state:{patientId:Me.patient_id,appointmentId:Me.appointment_id,source:"cancelled",hideSchedule:!1},className:"cmn-btn",children:"View Profile"})})]},`cancelled-${un}`)})]})]})}),(Et==null?void 0:Et.length)>0&&E.jsx(nR,{currentPage:J,totalPages:gt(Et),onPageChange:Zt,onPrevious:kn,onNext:rn})]})]})]})})}),E.jsx(go,{})]}),E.jsx(Zu,{visible:Q,title:"Cancel Appointment",subtitle:"Are you sure you want to cancel the appointment?",onConfirm:qi,onCancel:()=>se(!1),actionType:"cancel"}),E.jsx(Zu,{visible:te,title:"Cancel Appointment",subtitle:"Reason for cancellation",inputField:!0,inputValue:ze,onInputChange:Me=>Z(Me),onCancel:()=>{le(!1),Z("")},onConfirm:yt,actionType:"info"}),E.jsx(Zu,{visible:ce,title:"Appointment Cancelled",subtitle:"Your appointment is cancelled successfully.",onConfirm:()=>me(!1),onCancel:()=>me(!1),actionType:"success"})]})};function n0(){It.error("Token Expired"),localStorage.removeItem("doctor-app"),setTimeout(()=>{window.location.href="/"},1e3)}const j0=$t("doctor/getScheduleTime",async(o,{rejectWithValue:i})=>{var a;try{return(await Fae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),V0=$t("doctor/completeAppointmentPatientDetails",async(o,{rejectWithValue:i})=>{var a;try{return(await $ae(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),gk=$t("doctor/prescriptionDownload",async(o,{rejectWithValue:i})=>{var a;try{const d=await eoe(o);return console.log(d,"dddd"),d.data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),F0=$t("doctor/bookAppointment",async(o,{rejectWithValue:i})=>{var a;try{return(await doe(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),pce=l_({name:"prescriptions",initialState:{scheduleTime:[],bookAppointments:[],prescription_Download:[],completeAppointmentPatientDetail:[],loading:!1,error:null},reducers:{},extraReducers:o=>{o.addCase(j0.pending,i=>{i.upcomingLoading=!0,i.error=null}).addCase(j0.fulfilled,(i,a)=>{var d,f;i.upcomingLoading=!1,i.scheduleTime=(f=(d=a.payload)==null?void 0:d.data)==null?void 0:f.available_time_slots}).addCase(j0.rejected,(i,a)=>{i.upcomingLoading=!1,i.error=a.payload||"Failed to fetch users",a.payload.message=="Unauthenticated."&&n0()}).addCase(V0.pending,i=>{i.loading=!0,i.error=null}).addCase(V0.fulfilled,(i,a)=>{var d;i.loading=!1,i.completeAppointmentPatientDetail=(d=a.payload)==null?void 0:d.data}).addCase(V0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to fetch users",a.payload.message=="Unauthenticated."&&n0()}).addCase(gk.pending,i=>{i.loading=!0,i.error=null}).addCase(gk.fulfilled,(i,a)=>{i.loading=!1}).addCase(gk.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to fetch users",a.payload.message=="Unauthenticated."&&n0()}).addCase(F0.pending,i=>{i.loading=!0,i.error=null}).addCase(F0.fulfilled,(i,a)=>{i.loading=!1,i.bookAppointments=a.payload}).addCase(F0.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to fetch users",a.payload.message=="Unauthenticated."&&n0()})}}),fce=pce.reducer,mce=()=>{const o=$r(),{patientId:i,appointmentId:a,patientName:d}=o.state||{},f=Mr(),{scheduleTime:y,loading:R}=Zi(Fe=>Fe.prescriptions),{patientProfileData:w}=Zi(Fe=>Fe.patientProfile),[N,O]=K.useState(new Date),[x,G]=K.useState(),[W,ne]=K.useState(!1),[Q,se]=K.useState(N.getMonth()),[te,le]=K.useState(N.getFullYear());function ce(Fe){const st=new Date(Fe),we=st.getFullYear(),je=String(st.getMonth()+1).padStart(2,"0"),nt=String(st.getDate()).padStart(2,"0");return`${we}-${je}-${nt}`}K.useEffect(()=>{se(N.getMonth()),le(N.getFullYear())},[N]),K.useEffect(()=>{f(j0({date:ce(N)}))},[f,N]);const Ce=(()=>{const Fe=[],st=new Date(te,Q,1).getDay(),we=st===0?7:st,je=new Date(te,Q+1,0).getDate(),nt=new Date(te,Q,0).getDate();for(let ge=we-1;ge>0;ge--)Fe.push({day:nt-ge+1,currentMonth:!1,date:new Date(te,Q-1,nt-ge+1)});for(let ge=1;ge<=je;ge++)Fe.push({day:ge,currentMonth:!0,date:new Date(te,Q,ge)});const Et=7-Fe.length%7;if(Et<7)for(let ge=1;ge<=Et;ge++)Fe.push({day:ge,currentMonth:!1,date:new Date(te,Q+1,ge)});return Fe})(),_e=()=>{let Fe=Q-1,st=te;Fe<0&&(Fe=11,st-=1),se(Fe),le(st),O(new Date(st,Fe,1)),G(void 0)},ze=()=>{let Fe=Q+1,st=te;Fe>11&&(Fe=0,st+=1),se(Fe),le(st),O(new Date(st,Fe,1)),G(void 0)},Z=Fe=>{Fe.currentMonth&&(O(Fe.date),G(void 0))},J=(Fe,st=N)=>{if(!Fe||!st)return!1;const we=Fe.match(/(\d{1,2}:\d{2})\s*(AM|PM)/i);if(!we)return!1;const[,je,nt]=we;let[Et,ge]=je.split(":").map(Number);nt.toLowerCase()==="pm"&&Et!==12&&(Et+=12),nt.toLowerCase()==="am"&&Et===12&&(Et=0);const qe=new Date,Oe=new Date(st);if(Oe.setHours(0,0,0,0),qe.setSeconds(0,0),!(Oe.toDateString()===qe.toDateString()))return!1;const rt=new Date;return rt.setHours(Et,ge,0,0),rt<=qe},$=(Fe,st=N)=>{if(!Fe||!st)return!1;const we=Fe.match(/(\d{1,2}:\d{2})\s*(AM|PM)/i);if(!we)return!1;const[,je,nt]=we;let[Et,ge]=je.split(":").map(Number);nt.toLowerCase()==="pm"&&Et!==12&&(Et+=12),nt.toLowerCase()==="am"&&Et===12&&(Et=0);const qe=new Date,Oe=new Date(st);return Oe.setHours(Et,ge,0,0),(Oe-qe)/(1e3*60*60)>=2},fe=(Fe,st)=>{st&&(J(Fe)||G(Fe))},ve=async()=>{var Fe,st;if(!x){It.error("Please select a time");return}if(!$(x)){It.error("Appointments must be booked at least 2 hours in advance");return}try{const we=await f(F0({date:ce(N),time:x,patient_id:i,appointment_id:a}));(Fe=we.payload)!=null&&Fe.status?ne(!0):It.error(((st=we.payload)==null?void 0:st.message)||"Failed to book appointment")}catch{It.error("An error occurred while booking the appointment")}},pe=()=>ne(!1),he=Fe=>{const st=new Date;return st.setHours(0,0,0,0),Fe<st};return E.jsxs("div",{className:"doctor-panel",children:[E.jsxs("div",{className:"container-fluid",children:[E.jsx("div",{className:"doc-panel-inr",children:E.jsx(Va,{})}),R?E.jsx("div",{className:"loader-main",children:E.jsx("span",{className:"loader"})}):E.jsx("div",{className:"doc-panel-body has-texture",children:E.jsxs("div",{className:"start-appointment cmn-mb",children:[E.jsxs("div",{className:"docpnl-sec-head text-center",children:[E.jsx("h1",{className:"h2-title",children:"Schedule Appointment"}),E.jsx("div",{className:"back-btn",children:E.jsx(Wt,{to:"#",onClick:Fe=>{Fe.preventDefault(),window.history.back()},children:E.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),E.jsx("div",{className:"schedule-appointment-wrp",children:E.jsxs("div",{className:"schedule-appointment row",children:[E.jsx("div",{className:"schedule-appointment-left-wrp col-lg-6",children:E.jsx("div",{className:"schedule-appointmnet-left",children:E.jsx("img",{src:"./images/schedule-aapointment-left-img.png",alt:"Schedule"})})}),E.jsx("div",{className:"schedule-appointment-right-wrp col-lg-6",children:E.jsx("div",{className:"schedule-appointment-right",children:E.jsxs("div",{className:"calender-wrp",children:[E.jsx("div",{className:"caleder-heading",children:E.jsx("h2",{className:"h3-title",children:"Select Date and Time"})}),E.jsxs("div",{className:"calender",children:[E.jsxs("div",{className:"calender-monthyear",children:[E.jsx("button",{className:"prev-month",onClick:_e,type:"button",children:E.jsx("img",{src:"./images/chevron-left.svg",alt:"Icon"})}),E.jsx("h2",{className:"h3-title",children:new Date(te,Q).toLocaleString("default",{month:"long",year:"numeric"})}),E.jsx("button",{className:"next-month",onClick:ze,type:"button",children:E.jsx("img",{src:"./images/chevron-right.svg",alt:"Icon"})})]}),E.jsx("div",{className:"calneder-body",children:E.jsxs("div",{className:"calender-body-inr",children:[E.jsxs("div",{className:"week-days-wrp",children:[E.jsx("div",{children:"mon"}),E.jsx("div",{children:"tue"}),E.jsx("div",{children:"wed"}),E.jsx("div",{children:"thu"}),E.jsx("div",{children:"fri"}),E.jsx("div",{children:"sat"}),E.jsx("div",{children:"sun"})]}),E.jsx("div",{className:"moth-days-wrp",children:Ce.map((Fe,st)=>{const we=ce(Fe.date)===ce(N),je=ce(Fe.date)===ce(new Date),nt=!Fe.currentMonth||he(Fe.date);return E.jsx("div",{className:`day ${we?"selected-day":je?"today":""} ${Fe.currentMonth?"":"not-current-month"} ${nt?"disabled-day":""}`,onClick:()=>Z(Fe),style:{cursor:nt?"default":"pointer",color:Fe.currentMonth?nt?"#999":we?"#fff":"#000":"#ccc",backgroundColor:we?"#199FD9":je?"#ccc":"transparent",borderRadius:we?"50%":"0",userSelect:"none",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",margin:"2px",fontWeight:we?"bold":"normal"},children:Fe.day},st)})})]})}),E.jsxs("div",{className:"selected-date",style:{marginTop:"15px",fontWeight:"bold"},children:["Selected:"," ",N.toLocaleString("default",{month:"long",day:"numeric",year:"numeric"})]}),E.jsxs("div",{className:"select-time-wrp",style:{marginTop:"15px"},children:[R&&E.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",minHeight:"100px"},children:E.jsx("span",{className:"loader"})}),y.map(Fe=>{const st=!(Fe!=null&&Fe.is_available),we=J(Fe==null?void 0:Fe.display_time),je=x===(Fe==null?void 0:Fe.display_time);return E.jsx("div",{className:`available-time 
                                      ${st?"booked-time":""}
                                      ${we?"disabled-time":""}
                                      ${je?"selected":""}`,onClick:()=>fe(Fe==null?void 0:Fe.display_time,Fe==null?void 0:Fe.is_available),style:{pointerEvents:st||we?"none":"auto",opacity:st||we?.5:1,cursor:st||we?"default":"pointer",userSelect:"none",padding:"8px 12px",borderRadius:"4px",margin:"4px",display:"inline-block",border:je?"2px solid #199FD9":"1px solid #ccc",backgroundColor:je?"#199FD9":"#fff",fontWeight:je?"bold":"normal"},children:Fe==null?void 0:Fe.display_time},Fe==null?void 0:Fe.value)})]}),E.jsx("button",{type:"button",className:"orange-btn book-btn",onClick:ve,disabled:!N||!x,style:{marginTop:"20px"},children:"Book Now"})]})]})})})]})})]})}),E.jsx(go,{})]}),E.jsxs(tr,{show:W,onHide:pe,centered:!0,className:"popup-wrp",id:"congratulations",dialogClassName:"custom-modal",children:[E.jsx("style",{children:`
            .custom-modal .modal-content {
              padding: 30px 0 50px 0;
              margin: 0;
            }
          `}),E.jsx("button",{type:"button",className:"close",onClick:pe,"aria-label":"Close",children:E.jsx("span",{"aria-hidden":"true",children:E.jsx("img",{src:"/images/cross-blue.png",alt:"Close"})})}),E.jsx("div",{className:"modal-icon text-center mt-4",children:E.jsx("img",{src:"./images/check-icon.png",alt:"Icon"})}),E.jsxs(tr.Header,{className:"border-0 flex-column text-center",children:[E.jsx(tr.Title,{id:"exampleModalLongTitle",className:"w-100",children:E.jsx("h2",{children:"Congratulations"})}),E.jsxs("p",{style:{padding:"20px",fontSize:"25px",color:"#858484"},children:["Your appointment with",E.jsx("br",{})," ",d," is confirmed for"," ",E.jsx("br",{}),E.jsx("span",{className:"bookingDateTime",children:N&&x?`${N.toLocaleString("default",{month:"long",day:"numeric",year:"numeric"})} at ${x}`:""}),"."]})]}),E.jsx(tr.Footer,{className:"d-flex justify-content-center border-0",children:E.jsx(Wt,{to:"/doctor-home",className:"orange-btn",onClick:pe,children:"Ok"})})]})]})},_ce=()=>{};var tH={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qz=function(o){const i=[];let a=0;for(let d=0;d<o.length;d++){let f=o.charCodeAt(d);f<128?i[a++]=f:f<2048?(i[a++]=f>>6|192,i[a++]=f&63|128):(f&64512)===55296&&d+1<o.length&&(o.charCodeAt(d+1)&64512)===56320?(f=65536+((f&1023)<<10)+(o.charCodeAt(++d)&1023),i[a++]=f>>18|240,i[a++]=f>>12&63|128,i[a++]=f>>6&63|128,i[a++]=f&63|128):(i[a++]=f>>12|224,i[a++]=f>>6&63|128,i[a++]=f&63|128)}return i},gce=function(o){const i=[];let a=0,d=0;for(;a<o.length;){const f=o[a++];if(f<128)i[d++]=String.fromCharCode(f);else if(f>191&&f<224){const y=o[a++];i[d++]=String.fromCharCode((f&31)<<6|y&63)}else if(f>239&&f<365){const y=o[a++],R=o[a++],w=o[a++],N=((f&7)<<18|(y&63)<<12|(R&63)<<6|w&63)-65536;i[d++]=String.fromCharCode(55296+(N>>10)),i[d++]=String.fromCharCode(56320+(N&1023))}else{const y=o[a++],R=o[a++];i[d++]=String.fromCharCode((f&15)<<12|(y&63)<<6|R&63)}}return i.join("")},$z={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(o,i){if(!Array.isArray(o))throw Error("encodeByteArray takes an array as a parameter");this.init_();const a=i?this.byteToCharMapWebSafe_:this.byteToCharMap_,d=[];for(let f=0;f<o.length;f+=3){const y=o[f],R=f+1<o.length,w=R?o[f+1]:0,N=f+2<o.length,O=N?o[f+2]:0,x=y>>2,G=(y&3)<<4|w>>4;let W=(w&15)<<2|O>>6,ne=O&63;N||(ne=64,R||(W=64)),d.push(a[x],a[G],a[W],a[ne])}return d.join("")},encodeString(o,i){return this.HAS_NATIVE_SUPPORT&&!i?btoa(o):this.encodeByteArray(Qz(o),i)},decodeString(o,i){return this.HAS_NATIVE_SUPPORT&&!i?atob(o):gce(this.decodeStringToByteArray(o,i))},decodeStringToByteArray(o,i){this.init_();const a=i?this.charToByteMapWebSafe_:this.charToByteMap_,d=[];for(let f=0;f<o.length;){const y=a[o.charAt(f++)],w=f<o.length?a[o.charAt(f)]:0;++f;const O=f<o.length?a[o.charAt(f)]:64;++f;const G=f<o.length?a[o.charAt(f)]:64;if(++f,y==null||w==null||O==null||G==null)throw new Ece;const W=y<<2|w>>4;if(d.push(W),O!==64){const ne=w<<4&240|O>>2;if(d.push(ne),G!==64){const Q=O<<6&192|G;d.push(Q)}}}return d},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let o=0;o<this.ENCODED_VALS.length;o++)this.byteToCharMap_[o]=this.ENCODED_VALS.charAt(o),this.charToByteMap_[this.byteToCharMap_[o]]=o,this.byteToCharMapWebSafe_[o]=this.ENCODED_VALS_WEBSAFE.charAt(o),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[o]]=o,o>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(o)]=o,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(o)]=o)}}};class Ece extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const yce=function(o){const i=Qz(o);return $z.encodeByteArray(i,!0)},aI=function(o){return yce(o).replace(/\./g,"")},vce=function(o){try{return $z.decodeString(o,!0)}catch(i){console.error("base64Decode failed: ",i)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sce(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tce=()=>Sce().__FIREBASE_DEFAULTS__,Rce=()=>{if(typeof process>"u"||typeof tH>"u")return;const o=tH.__FIREBASE_DEFAULTS__;if(o)return JSON.parse(o)},bce=()=>{if(typeof document>"u")return;let o;try{o=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const i=o&&vce(o[1]);return i&&JSON.parse(i)},Zx=()=>{try{return _ce()||Tce()||Rce()||bce()}catch(o){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${o}`);return}},Cce=o=>{var i,a;return(a=(i=Zx())===null||i===void 0?void 0:i.emulatorHosts)===null||a===void 0?void 0:a[o]},wce=o=>{const i=Cce(o);if(!i)return;const a=i.lastIndexOf(":");if(a<=0||a+1===i.length)throw new Error(`Invalid host ${i} with no separate hostname and port!`);const d=parseInt(i.substring(a+1),10);return i[0]==="["?[i.substring(1,a-1),d]:[i.substring(0,a),d]},Zz=()=>{var o;return(o=Zx())===null||o===void 0?void 0:o.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ace{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((i,a)=>{this.resolve=i,this.reject=a})}wrapCallback(i){return(a,d)=>{a?this.reject(a):this.resolve(d),typeof i=="function"&&(this.promise.catch(()=>{}),i.length===1?i(a):i(a,d))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ice(o,i){if(o.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const a={alg:"none",type:"JWT"},d=i||"demo-project",f=o.iat||0,y=o.sub||o.user_id;if(!y)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const R=Object.assign({iss:`https://securetoken.google.com/${d}`,aud:d,iat:f,exp:f+3600,auth_time:f,sub:y,user_id:y,firebase:{sign_in_provider:"custom",identities:{}}},o);return[aI(JSON.stringify(a)),aI(JSON.stringify(R)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nce(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Oce(){var o;const i=(o=Zx())===null||o===void 0?void 0:o.forceEnvironment;if(i==="node")return!0;if(i==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Dce(){return!Oce()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Pce(){try{return typeof indexedDB=="object"}catch{return!1}}function Lce(){return new Promise((o,i)=>{try{let a=!0;const d="validate-browser-context-for-indexeddb-analytics-module",f=self.indexedDB.open(d);f.onsuccess=()=>{f.result.close(),a||self.indexedDB.deleteDatabase(d),o(!0)},f.onupgradeneeded=()=>{a=!1},f.onerror=()=>{var y;i(((y=f.error)===null||y===void 0?void 0:y.message)||"")}}catch(a){i(a)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kce="FirebaseError";class Ry extends Error{constructor(i,a,d){super(a),this.code=i,this.customData=d,this.name=kce,Object.setPrototypeOf(this,Ry.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,e8.prototype.create)}}class e8{constructor(i,a,d){this.service=i,this.serviceName=a,this.errors=d}create(i,...a){const d=a[0]||{},f=`${this.service}/${i}`,y=this.errors[i],R=y?xce(y,d):"Error",w=`${this.serviceName}: ${R} (${f}).`;return new Ry(f,w,d)}}function xce(o,i){return o.replace(Mce,(a,d)=>{const f=i[d];return f!=null?String(f):`<${d}?>`})}const Mce=/\{\$([^}]+)}/g;function oI(o,i){if(o===i)return!0;const a=Object.keys(o),d=Object.keys(i);for(const f of a){if(!d.includes(f))return!1;const y=o[f],R=i[f];if(nH(y)&&nH(R)){if(!oI(y,R))return!1}else if(y!==R)return!1}for(const f of d)if(!a.includes(f))return!1;return!0}function nH(o){return o!==null&&typeof o=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dl(o){return o&&o._delegate?o._delegate:o}class hR{constructor(i,a,d){this.name=i,this.instanceFactory=a,this.type=d,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(i){return this.instantiationMode=i,this}setMultipleInstances(i){return this.multipleInstances=i,this}setServiceProps(i){return this.serviceProps=i,this}setInstanceCreatedCallback(i){return this.onInstanceCreated=i,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Km="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uce{constructor(i,a){this.name=i,this.container=a,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(i){const a=this.normalizeInstanceIdentifier(i);if(!this.instancesDeferred.has(a)){const d=new Ace;if(this.instancesDeferred.set(a,d),this.isInitialized(a)||this.shouldAutoInitialize())try{const f=this.getOrInitializeService({instanceIdentifier:a});f&&d.resolve(f)}catch{}}return this.instancesDeferred.get(a).promise}getImmediate(i){var a;const d=this.normalizeInstanceIdentifier(i==null?void 0:i.identifier),f=(a=i==null?void 0:i.optional)!==null&&a!==void 0?a:!1;if(this.isInitialized(d)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:d})}catch(y){if(f)return null;throw y}else{if(f)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(i){if(i.name!==this.name)throw Error(`Mismatching Component ${i.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=i,!!this.shouldAutoInitialize()){if(Vce(i))try{this.getOrInitializeService({instanceIdentifier:Km})}catch{}for(const[a,d]of this.instancesDeferred.entries()){const f=this.normalizeInstanceIdentifier(a);try{const y=this.getOrInitializeService({instanceIdentifier:f});d.resolve(y)}catch{}}}}clearInstance(i=Km){this.instancesDeferred.delete(i),this.instancesOptions.delete(i),this.instances.delete(i)}async delete(){const i=Array.from(this.instances.values());await Promise.all([...i.filter(a=>"INTERNAL"in a).map(a=>a.INTERNAL.delete()),...i.filter(a=>"_delete"in a).map(a=>a._delete())])}isComponentSet(){return this.component!=null}isInitialized(i=Km){return this.instances.has(i)}getOptions(i=Km){return this.instancesOptions.get(i)||{}}initialize(i={}){const{options:a={}}=i,d=this.normalizeInstanceIdentifier(i.instanceIdentifier);if(this.isInitialized(d))throw Error(`${this.name}(${d}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const f=this.getOrInitializeService({instanceIdentifier:d,options:a});for(const[y,R]of this.instancesDeferred.entries()){const w=this.normalizeInstanceIdentifier(y);d===w&&R.resolve(f)}return f}onInit(i,a){var d;const f=this.normalizeInstanceIdentifier(a),y=(d=this.onInitCallbacks.get(f))!==null&&d!==void 0?d:new Set;y.add(i),this.onInitCallbacks.set(f,y);const R=this.instances.get(f);return R&&i(R,f),()=>{y.delete(i)}}invokeOnInitCallbacks(i,a){const d=this.onInitCallbacks.get(a);if(d)for(const f of d)try{f(i,a)}catch{}}getOrInitializeService({instanceIdentifier:i,options:a={}}){let d=this.instances.get(i);if(!d&&this.component&&(d=this.component.instanceFactory(this.container,{instanceIdentifier:jce(i),options:a}),this.instances.set(i,d),this.instancesOptions.set(i,a),this.invokeOnInitCallbacks(d,i),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,i,d)}catch{}return d||null}normalizeInstanceIdentifier(i=Km){return this.component?this.component.multipleInstances?i:Km:i}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function jce(o){return o===Km?void 0:o}function Vce(o){return o.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fce{constructor(i){this.name=i,this.providers=new Map}addComponent(i){const a=this.getProvider(i.name);if(a.isComponentSet())throw new Error(`Component ${i.name} has already been registered with ${this.name}`);a.setComponent(i)}addOrOverwriteComponent(i){this.getProvider(i.name).isComponentSet()&&this.providers.delete(i.name),this.addComponent(i)}getProvider(i){if(this.providers.has(i))return this.providers.get(i);const a=new Uce(i,this);return this.providers.set(i,a),a}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var di;(function(o){o[o.DEBUG=0]="DEBUG",o[o.VERBOSE=1]="VERBOSE",o[o.INFO=2]="INFO",o[o.WARN=3]="WARN",o[o.ERROR=4]="ERROR",o[o.SILENT=5]="SILENT"})(di||(di={}));const Bce={debug:di.DEBUG,verbose:di.VERBOSE,info:di.INFO,warn:di.WARN,error:di.ERROR,silent:di.SILENT},Gce=di.INFO,Hce={[di.DEBUG]:"log",[di.VERBOSE]:"log",[di.INFO]:"info",[di.WARN]:"warn",[di.ERROR]:"error"},zce=(o,i,...a)=>{if(i<o.logLevel)return;const d=new Date().toISOString(),f=Hce[i];if(f)console[f](`[${d}]  ${o.name}:`,...a);else throw new Error(`Attempted to log a message with an invalid logType (value: ${i})`)};class t8{constructor(i){this.name=i,this._logLevel=Gce,this._logHandler=zce,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(i){if(!(i in di))throw new TypeError(`Invalid value "${i}" assigned to \`logLevel\``);this._logLevel=i}setLogLevel(i){this._logLevel=typeof i=="string"?Bce[i]:i}get logHandler(){return this._logHandler}set logHandler(i){if(typeof i!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=i}get userLogHandler(){return this._userLogHandler}set userLogHandler(i){this._userLogHandler=i}debug(...i){this._userLogHandler&&this._userLogHandler(this,di.DEBUG,...i),this._logHandler(this,di.DEBUG,...i)}log(...i){this._userLogHandler&&this._userLogHandler(this,di.VERBOSE,...i),this._logHandler(this,di.VERBOSE,...i)}info(...i){this._userLogHandler&&this._userLogHandler(this,di.INFO,...i),this._logHandler(this,di.INFO,...i)}warn(...i){this._userLogHandler&&this._userLogHandler(this,di.WARN,...i),this._logHandler(this,di.WARN,...i)}error(...i){this._userLogHandler&&this._userLogHandler(this,di.ERROR,...i),this._logHandler(this,di.ERROR,...i)}}const Wce=(o,i)=>i.some(a=>o instanceof a);let iH,rH;function qce(){return iH||(iH=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Kce(){return rH||(rH=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const n8=new WeakMap,ox=new WeakMap,i8=new WeakMap,Ek=new WeakMap,e1=new WeakMap;function Yce(o){const i=new Promise((a,d)=>{const f=()=>{o.removeEventListener("success",y),o.removeEventListener("error",R)},y=()=>{a(kp(o.result)),f()},R=()=>{d(o.error),f()};o.addEventListener("success",y),o.addEventListener("error",R)});return i.then(a=>{a instanceof IDBCursor&&n8.set(a,o)}).catch(()=>{}),e1.set(i,o),i}function Xce(o){if(ox.has(o))return;const i=new Promise((a,d)=>{const f=()=>{o.removeEventListener("complete",y),o.removeEventListener("error",R),o.removeEventListener("abort",R)},y=()=>{a(),f()},R=()=>{d(o.error||new DOMException("AbortError","AbortError")),f()};o.addEventListener("complete",y),o.addEventListener("error",R),o.addEventListener("abort",R)});ox.set(o,i)}let cx={get(o,i,a){if(o instanceof IDBTransaction){if(i==="done")return ox.get(o);if(i==="objectStoreNames")return o.objectStoreNames||i8.get(o);if(i==="store")return a.objectStoreNames[1]?void 0:a.objectStore(a.objectStoreNames[0])}return kp(o[i])},set(o,i,a){return o[i]=a,!0},has(o,i){return o instanceof IDBTransaction&&(i==="done"||i==="store")?!0:i in o}};function Jce(o){cx=o(cx)}function Qce(o){return o===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(i,...a){const d=o.call(yk(this),i,...a);return i8.set(d,i.sort?i.sort():[i]),kp(d)}:Kce().includes(o)?function(...i){return o.apply(yk(this),i),kp(n8.get(this))}:function(...i){return kp(o.apply(yk(this),i))}}function $ce(o){return typeof o=="function"?Qce(o):(o instanceof IDBTransaction&&Xce(o),Wce(o,qce())?new Proxy(o,cx):o)}function kp(o){if(o instanceof IDBRequest)return Yce(o);if(Ek.has(o))return Ek.get(o);const i=$ce(o);return i!==o&&(Ek.set(o,i),e1.set(i,o)),i}const yk=o=>e1.get(o);function Zce(o,i,{blocked:a,upgrade:d,blocking:f,terminated:y}={}){const R=indexedDB.open(o,i),w=kp(R);return d&&R.addEventListener("upgradeneeded",N=>{d(kp(R.result),N.oldVersion,N.newVersion,kp(R.transaction),N)}),a&&R.addEventListener("blocked",N=>a(N.oldVersion,N.newVersion,N)),w.then(N=>{y&&N.addEventListener("close",()=>y()),f&&N.addEventListener("versionchange",O=>f(O.oldVersion,O.newVersion,O))}).catch(()=>{}),w}const ele=["get","getKey","getAll","getAllKeys","count"],tle=["put","add","delete","clear"],vk=new Map;function sH(o,i){if(!(o instanceof IDBDatabase&&!(i in o)&&typeof i=="string"))return;if(vk.get(i))return vk.get(i);const a=i.replace(/FromIndex$/,""),d=i!==a,f=tle.includes(a);if(!(a in(d?IDBIndex:IDBObjectStore).prototype)||!(f||ele.includes(a)))return;const y=async function(R,...w){const N=this.transaction(R,f?"readwrite":"readonly");let O=N.store;return d&&(O=O.index(w.shift())),(await Promise.all([O[a](...w),f&&N.done]))[0]};return vk.set(i,y),y}Jce(o=>({...o,get:(i,a,d)=>sH(i,a)||o.get(i,a,d),has:(i,a)=>!!sH(i,a)||o.has(i,a)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nle{constructor(i){this.container=i}getPlatformInfoString(){return this.container.getProviders().map(a=>{if(ile(a)){const d=a.getImmediate();return`${d.library}/${d.version}`}else return null}).filter(a=>a).join(" ")}}function ile(o){const i=o.getComponent();return(i==null?void 0:i.type)==="VERSION"}const lx="@firebase/app",aH="0.11.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rh=new t8("@firebase/app"),rle="@firebase/app-compat",sle="@firebase/analytics-compat",ale="@firebase/analytics",ole="@firebase/app-check-compat",cle="@firebase/app-check",lle="@firebase/auth",dle="@firebase/auth-compat",ule="@firebase/database",hle="@firebase/data-connect",ple="@firebase/database-compat",fle="@firebase/functions",mle="@firebase/functions-compat",_le="@firebase/installations",gle="@firebase/installations-compat",Ele="@firebase/messaging",yle="@firebase/messaging-compat",vle="@firebase/performance",Sle="@firebase/performance-compat",Tle="@firebase/remote-config",Rle="@firebase/remote-config-compat",ble="@firebase/storage",Cle="@firebase/storage-compat",wle="@firebase/firestore",Ale="@firebase/vertexai",Ile="@firebase/firestore-compat",Nle="firebase",Ole="11.6.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dx="[DEFAULT]",Dle={[lx]:"fire-core",[rle]:"fire-core-compat",[ale]:"fire-analytics",[sle]:"fire-analytics-compat",[cle]:"fire-app-check",[ole]:"fire-app-check-compat",[lle]:"fire-auth",[dle]:"fire-auth-compat",[ule]:"fire-rtdb",[hle]:"fire-data-connect",[ple]:"fire-rtdb-compat",[fle]:"fire-fn",[mle]:"fire-fn-compat",[_le]:"fire-iid",[gle]:"fire-iid-compat",[Ele]:"fire-fcm",[yle]:"fire-fcm-compat",[vle]:"fire-perf",[Sle]:"fire-perf-compat",[Tle]:"fire-rc",[Rle]:"fire-rc-compat",[ble]:"fire-gcs",[Cle]:"fire-gcs-compat",[wle]:"fire-fst",[Ile]:"fire-fst-compat",[Ale]:"fire-vertex","fire-js":"fire-js",[Nle]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cI=new Map,Ple=new Map,ux=new Map;function oH(o,i){try{o.container.addComponent(i)}catch(a){rh.debug(`Component ${i.name} failed to register with FirebaseApp ${o.name}`,a)}}function lI(o){const i=o.name;if(ux.has(i))return rh.debug(`There were multiple attempts to register component ${i}.`),!1;ux.set(i,o);for(const a of cI.values())oH(a,o);for(const a of Ple.values())oH(a,o);return!0}function Lle(o,i){const a=o.container.getProvider("heartbeat").getImmediate({optional:!0});return a&&a.triggerHeartbeat(),o.container.getProvider(i)}function kle(o){return o==null?!1:o.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xle={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},xp=new e8("app","Firebase",xle);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mle{constructor(i,a,d){this._isDeleted=!1,this._options=Object.assign({},i),this._config=Object.assign({},a),this._name=a.name,this._automaticDataCollectionEnabled=a.automaticDataCollectionEnabled,this._container=d,this.container.addComponent(new hR("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(i){this.checkDestroyed(),this._automaticDataCollectionEnabled=i}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(i){this._isDeleted=i}checkDestroyed(){if(this.isDeleted)throw xp.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ule=Ole;function r8(o,i={}){let a=o;typeof i!="object"&&(i={name:i});const d=Object.assign({name:dx,automaticDataCollectionEnabled:!1},i),f=d.name;if(typeof f!="string"||!f)throw xp.create("bad-app-name",{appName:String(f)});if(a||(a=Zz()),!a)throw xp.create("no-options");const y=cI.get(f);if(y){if(oI(a,y.options)&&oI(d,y.config))return y;throw xp.create("duplicate-app",{appName:f})}const R=new Fce(f);for(const N of ux.values())R.addComponent(N);const w=new Mle(a,d,R);return cI.set(f,w),w}function jle(o=dx){const i=cI.get(o);if(!i&&o===dx&&Zz())return r8();if(!i)throw xp.create("no-app",{appName:o});return i}function sy(o,i,a){var d;let f=(d=Dle[o])!==null&&d!==void 0?d:o;a&&(f+=`-${a}`);const y=f.match(/\s|\//),R=i.match(/\s|\//);if(y||R){const w=[`Unable to register library "${f}" with version "${i}":`];y&&w.push(`library name "${f}" contains illegal characters (whitespace or "/")`),y&&R&&w.push("and"),R&&w.push(`version name "${i}" contains illegal characters (whitespace or "/")`),rh.warn(w.join(" "));return}lI(new hR(`${f}-version`,()=>({library:f,version:i}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vle="firebase-heartbeat-database",Fle=1,pR="firebase-heartbeat-store";let Sk=null;function s8(){return Sk||(Sk=Zce(Vle,Fle,{upgrade:(o,i)=>{switch(i){case 0:try{o.createObjectStore(pR)}catch(a){console.warn(a)}}}}).catch(o=>{throw xp.create("idb-open",{originalErrorMessage:o.message})})),Sk}async function Ble(o){try{const a=(await s8()).transaction(pR),d=await a.objectStore(pR).get(a8(o));return await a.done,d}catch(i){if(i instanceof Ry)rh.warn(i.message);else{const a=xp.create("idb-get",{originalErrorMessage:i==null?void 0:i.message});rh.warn(a.message)}}}async function cH(o,i){try{const d=(await s8()).transaction(pR,"readwrite");await d.objectStore(pR).put(i,a8(o)),await d.done}catch(a){if(a instanceof Ry)rh.warn(a.message);else{const d=xp.create("idb-set",{originalErrorMessage:a==null?void 0:a.message});rh.warn(d.message)}}}function a8(o){return`${o.name}!${o.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gle=1024,Hle=30;class zle{constructor(i){this.container=i,this._heartbeatsCache=null;const a=this.container.getProvider("app").getImmediate();this._storage=new qle(a),this._heartbeatsCachePromise=this._storage.read().then(d=>(this._heartbeatsCache=d,d))}async triggerHeartbeat(){var i,a;try{const f=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),y=lH();if(((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((a=this._heartbeatsCache)===null||a===void 0?void 0:a.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===y||this._heartbeatsCache.heartbeats.some(R=>R.date===y))return;if(this._heartbeatsCache.heartbeats.push({date:y,agent:f}),this._heartbeatsCache.heartbeats.length>Hle){const R=Kle(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(R,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(d){rh.warn(d)}}async getHeartbeatsHeader(){var i;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const a=lH(),{heartbeatsToSend:d,unsentEntries:f}=Wle(this._heartbeatsCache.heartbeats),y=aI(JSON.stringify({version:2,heartbeats:d}));return this._heartbeatsCache.lastSentHeartbeatDate=a,f.length>0?(this._heartbeatsCache.heartbeats=f,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),y}catch(a){return rh.warn(a),""}}}function lH(){return new Date().toISOString().substring(0,10)}function Wle(o,i=Gle){const a=[];let d=o.slice();for(const f of o){const y=a.find(R=>R.agent===f.agent);if(y){if(y.dates.push(f.date),dH(a)>i){y.dates.pop();break}}else if(a.push({agent:f.agent,dates:[f.date]}),dH(a)>i){a.pop();break}d=d.slice(1)}return{heartbeatsToSend:a,unsentEntries:d}}class qle{constructor(i){this.app=i,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Pce()?Lce().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const a=await Ble(this.app);return a!=null&&a.heartbeats?a:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(i){var a;if(await this._canUseIndexedDBPromise){const f=await this.read();return cH(this.app,{lastSentHeartbeatDate:(a=i.lastSentHeartbeatDate)!==null&&a!==void 0?a:f.lastSentHeartbeatDate,heartbeats:i.heartbeats})}else return}async add(i){var a;if(await this._canUseIndexedDBPromise){const f=await this.read();return cH(this.app,{lastSentHeartbeatDate:(a=i.lastSentHeartbeatDate)!==null&&a!==void 0?a:f.lastSentHeartbeatDate,heartbeats:[...f.heartbeats,...i.heartbeats]})}else return}}function dH(o){return aI(JSON.stringify({version:2,heartbeats:o})).length}function Kle(o){if(o.length===0)return-1;let i=0,a=o[0].date;for(let d=1;d<o.length;d++)o[d].date<a&&(a=o[d].date,i=d);return i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yle(o){lI(new hR("platform-logger",i=>new nle(i),"PRIVATE")),lI(new hR("heartbeat",i=>new zle(i),"PRIVATE")),sy(lx,aH,o),sy(lx,aH,"esm2017"),sy("fire-js","")}Yle("");var uH=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Mp,o8;(function(){var o;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function i(Z,J){function $(){}$.prototype=J.prototype,Z.D=J.prototype,Z.prototype=new $,Z.prototype.constructor=Z,Z.C=function(fe,ve,pe){for(var he=Array(arguments.length-2),Fe=2;Fe<arguments.length;Fe++)he[Fe-2]=arguments[Fe];return J.prototype[ve].apply(fe,he)}}function a(){this.blockSize=-1}function d(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}i(d,a),d.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function f(Z,J,$){$||($=0);var fe=Array(16);if(typeof J=="string")for(var ve=0;16>ve;++ve)fe[ve]=J.charCodeAt($++)|J.charCodeAt($++)<<8|J.charCodeAt($++)<<16|J.charCodeAt($++)<<24;else for(ve=0;16>ve;++ve)fe[ve]=J[$++]|J[$++]<<8|J[$++]<<16|J[$++]<<24;J=Z.g[0],$=Z.g[1],ve=Z.g[2];var pe=Z.g[3],he=J+(pe^$&(ve^pe))+fe[0]+3614090360&4294967295;J=$+(he<<7&4294967295|he>>>25),he=pe+(ve^J&($^ve))+fe[1]+3905402710&4294967295,pe=J+(he<<12&4294967295|he>>>20),he=ve+($^pe&(J^$))+fe[2]+606105819&4294967295,ve=pe+(he<<17&4294967295|he>>>15),he=$+(J^ve&(pe^J))+fe[3]+3250441966&4294967295,$=ve+(he<<22&4294967295|he>>>10),he=J+(pe^$&(ve^pe))+fe[4]+4118548399&4294967295,J=$+(he<<7&4294967295|he>>>25),he=pe+(ve^J&($^ve))+fe[5]+1200080426&4294967295,pe=J+(he<<12&4294967295|he>>>20),he=ve+($^pe&(J^$))+fe[6]+2821735955&4294967295,ve=pe+(he<<17&4294967295|he>>>15),he=$+(J^ve&(pe^J))+fe[7]+4249261313&4294967295,$=ve+(he<<22&4294967295|he>>>10),he=J+(pe^$&(ve^pe))+fe[8]+1770035416&4294967295,J=$+(he<<7&4294967295|he>>>25),he=pe+(ve^J&($^ve))+fe[9]+2336552879&4294967295,pe=J+(he<<12&4294967295|he>>>20),he=ve+($^pe&(J^$))+fe[10]+4294925233&4294967295,ve=pe+(he<<17&4294967295|he>>>15),he=$+(J^ve&(pe^J))+fe[11]+2304563134&4294967295,$=ve+(he<<22&4294967295|he>>>10),he=J+(pe^$&(ve^pe))+fe[12]+1804603682&4294967295,J=$+(he<<7&4294967295|he>>>25),he=pe+(ve^J&($^ve))+fe[13]+4254626195&4294967295,pe=J+(he<<12&4294967295|he>>>20),he=ve+($^pe&(J^$))+fe[14]+2792965006&4294967295,ve=pe+(he<<17&4294967295|he>>>15),he=$+(J^ve&(pe^J))+fe[15]+1236535329&4294967295,$=ve+(he<<22&4294967295|he>>>10),he=J+(ve^pe&($^ve))+fe[1]+4129170786&4294967295,J=$+(he<<5&4294967295|he>>>27),he=pe+($^ve&(J^$))+fe[6]+3225465664&4294967295,pe=J+(he<<9&4294967295|he>>>23),he=ve+(J^$&(pe^J))+fe[11]+643717713&4294967295,ve=pe+(he<<14&4294967295|he>>>18),he=$+(pe^J&(ve^pe))+fe[0]+3921069994&4294967295,$=ve+(he<<20&4294967295|he>>>12),he=J+(ve^pe&($^ve))+fe[5]+3593408605&4294967295,J=$+(he<<5&4294967295|he>>>27),he=pe+($^ve&(J^$))+fe[10]+38016083&4294967295,pe=J+(he<<9&4294967295|he>>>23),he=ve+(J^$&(pe^J))+fe[15]+3634488961&4294967295,ve=pe+(he<<14&4294967295|he>>>18),he=$+(pe^J&(ve^pe))+fe[4]+3889429448&4294967295,$=ve+(he<<20&4294967295|he>>>12),he=J+(ve^pe&($^ve))+fe[9]+568446438&4294967295,J=$+(he<<5&4294967295|he>>>27),he=pe+($^ve&(J^$))+fe[14]+3275163606&4294967295,pe=J+(he<<9&4294967295|he>>>23),he=ve+(J^$&(pe^J))+fe[3]+4107603335&4294967295,ve=pe+(he<<14&4294967295|he>>>18),he=$+(pe^J&(ve^pe))+fe[8]+1163531501&4294967295,$=ve+(he<<20&4294967295|he>>>12),he=J+(ve^pe&($^ve))+fe[13]+2850285829&4294967295,J=$+(he<<5&4294967295|he>>>27),he=pe+($^ve&(J^$))+fe[2]+4243563512&4294967295,pe=J+(he<<9&4294967295|he>>>23),he=ve+(J^$&(pe^J))+fe[7]+1735328473&4294967295,ve=pe+(he<<14&4294967295|he>>>18),he=$+(pe^J&(ve^pe))+fe[12]+2368359562&4294967295,$=ve+(he<<20&4294967295|he>>>12),he=J+($^ve^pe)+fe[5]+4294588738&4294967295,J=$+(he<<4&4294967295|he>>>28),he=pe+(J^$^ve)+fe[8]+2272392833&4294967295,pe=J+(he<<11&4294967295|he>>>21),he=ve+(pe^J^$)+fe[11]+1839030562&4294967295,ve=pe+(he<<16&4294967295|he>>>16),he=$+(ve^pe^J)+fe[14]+4259657740&4294967295,$=ve+(he<<23&4294967295|he>>>9),he=J+($^ve^pe)+fe[1]+2763975236&4294967295,J=$+(he<<4&4294967295|he>>>28),he=pe+(J^$^ve)+fe[4]+1272893353&4294967295,pe=J+(he<<11&4294967295|he>>>21),he=ve+(pe^J^$)+fe[7]+4139469664&4294967295,ve=pe+(he<<16&4294967295|he>>>16),he=$+(ve^pe^J)+fe[10]+3200236656&4294967295,$=ve+(he<<23&4294967295|he>>>9),he=J+($^ve^pe)+fe[13]+681279174&4294967295,J=$+(he<<4&4294967295|he>>>28),he=pe+(J^$^ve)+fe[0]+3936430074&4294967295,pe=J+(he<<11&4294967295|he>>>21),he=ve+(pe^J^$)+fe[3]+3572445317&4294967295,ve=pe+(he<<16&4294967295|he>>>16),he=$+(ve^pe^J)+fe[6]+76029189&4294967295,$=ve+(he<<23&4294967295|he>>>9),he=J+($^ve^pe)+fe[9]+3654602809&4294967295,J=$+(he<<4&4294967295|he>>>28),he=pe+(J^$^ve)+fe[12]+3873151461&4294967295,pe=J+(he<<11&4294967295|he>>>21),he=ve+(pe^J^$)+fe[15]+530742520&4294967295,ve=pe+(he<<16&4294967295|he>>>16),he=$+(ve^pe^J)+fe[2]+3299628645&4294967295,$=ve+(he<<23&4294967295|he>>>9),he=J+(ve^($|~pe))+fe[0]+4096336452&4294967295,J=$+(he<<6&4294967295|he>>>26),he=pe+($^(J|~ve))+fe[7]+1126891415&4294967295,pe=J+(he<<10&4294967295|he>>>22),he=ve+(J^(pe|~$))+fe[14]+2878612391&4294967295,ve=pe+(he<<15&4294967295|he>>>17),he=$+(pe^(ve|~J))+fe[5]+4237533241&4294967295,$=ve+(he<<21&4294967295|he>>>11),he=J+(ve^($|~pe))+fe[12]+1700485571&4294967295,J=$+(he<<6&4294967295|he>>>26),he=pe+($^(J|~ve))+fe[3]+2399980690&4294967295,pe=J+(he<<10&4294967295|he>>>22),he=ve+(J^(pe|~$))+fe[10]+4293915773&4294967295,ve=pe+(he<<15&4294967295|he>>>17),he=$+(pe^(ve|~J))+fe[1]+2240044497&4294967295,$=ve+(he<<21&4294967295|he>>>11),he=J+(ve^($|~pe))+fe[8]+1873313359&4294967295,J=$+(he<<6&4294967295|he>>>26),he=pe+($^(J|~ve))+fe[15]+4264355552&4294967295,pe=J+(he<<10&4294967295|he>>>22),he=ve+(J^(pe|~$))+fe[6]+2734768916&4294967295,ve=pe+(he<<15&4294967295|he>>>17),he=$+(pe^(ve|~J))+fe[13]+1309151649&4294967295,$=ve+(he<<21&4294967295|he>>>11),he=J+(ve^($|~pe))+fe[4]+4149444226&4294967295,J=$+(he<<6&4294967295|he>>>26),he=pe+($^(J|~ve))+fe[11]+3174756917&4294967295,pe=J+(he<<10&4294967295|he>>>22),he=ve+(J^(pe|~$))+fe[2]+718787259&4294967295,ve=pe+(he<<15&4294967295|he>>>17),he=$+(pe^(ve|~J))+fe[9]+3951481745&4294967295,Z.g[0]=Z.g[0]+J&4294967295,Z.g[1]=Z.g[1]+(ve+(he<<21&4294967295|he>>>11))&4294967295,Z.g[2]=Z.g[2]+ve&4294967295,Z.g[3]=Z.g[3]+pe&4294967295}d.prototype.u=function(Z,J){J===void 0&&(J=Z.length);for(var $=J-this.blockSize,fe=this.B,ve=this.h,pe=0;pe<J;){if(ve==0)for(;pe<=$;)f(this,Z,pe),pe+=this.blockSize;if(typeof Z=="string"){for(;pe<J;)if(fe[ve++]=Z.charCodeAt(pe++),ve==this.blockSize){f(this,fe),ve=0;break}}else for(;pe<J;)if(fe[ve++]=Z[pe++],ve==this.blockSize){f(this,fe),ve=0;break}}this.h=ve,this.o+=J},d.prototype.v=function(){var Z=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Z[0]=128;for(var J=1;J<Z.length-8;++J)Z[J]=0;var $=8*this.o;for(J=Z.length-8;J<Z.length;++J)Z[J]=$&255,$/=256;for(this.u(Z),Z=Array(16),J=$=0;4>J;++J)for(var fe=0;32>fe;fe+=8)Z[$++]=this.g[J]>>>fe&255;return Z};function y(Z,J){var $=w;return Object.prototype.hasOwnProperty.call($,Z)?$[Z]:$[Z]=J(Z)}function R(Z,J){this.h=J;for(var $=[],fe=!0,ve=Z.length-1;0<=ve;ve--){var pe=Z[ve]|0;fe&&pe==J||($[ve]=pe,fe=!1)}this.g=$}var w={};function N(Z){return-128<=Z&&128>Z?y(Z,function(J){return new R([J|0],0>J?-1:0)}):new R([Z|0],0>Z?-1:0)}function O(Z){if(isNaN(Z)||!isFinite(Z))return G;if(0>Z)return te(O(-Z));for(var J=[],$=1,fe=0;Z>=$;fe++)J[fe]=Z/$|0,$*=4294967296;return new R(J,0)}function x(Z,J){if(Z.length==0)throw Error("number format error: empty string");if(J=J||10,2>J||36<J)throw Error("radix out of range: "+J);if(Z.charAt(0)=="-")return te(x(Z.substring(1),J));if(0<=Z.indexOf("-"))throw Error('number format error: interior "-" character');for(var $=O(Math.pow(J,8)),fe=G,ve=0;ve<Z.length;ve+=8){var pe=Math.min(8,Z.length-ve),he=parseInt(Z.substring(ve,ve+pe),J);8>pe?(pe=O(Math.pow(J,pe)),fe=fe.j(pe).add(O(he))):(fe=fe.j($),fe=fe.add(O(he)))}return fe}var G=N(0),W=N(1),ne=N(16777216);o=R.prototype,o.m=function(){if(se(this))return-te(this).m();for(var Z=0,J=1,$=0;$<this.g.length;$++){var fe=this.i($);Z+=(0<=fe?fe:4294967296+fe)*J,J*=4294967296}return Z},o.toString=function(Z){if(Z=Z||10,2>Z||36<Z)throw Error("radix out of range: "+Z);if(Q(this))return"0";if(se(this))return"-"+te(this).toString(Z);for(var J=O(Math.pow(Z,6)),$=this,fe="";;){var ve=Ce($,J).g;$=le($,ve.j(J));var pe=((0<$.g.length?$.g[0]:$.h)>>>0).toString(Z);if($=ve,Q($))return pe+fe;for(;6>pe.length;)pe="0"+pe;fe=pe+fe}},o.i=function(Z){return 0>Z?0:Z<this.g.length?this.g[Z]:this.h};function Q(Z){if(Z.h!=0)return!1;for(var J=0;J<Z.g.length;J++)if(Z.g[J]!=0)return!1;return!0}function se(Z){return Z.h==-1}o.l=function(Z){return Z=le(this,Z),se(Z)?-1:Q(Z)?0:1};function te(Z){for(var J=Z.g.length,$=[],fe=0;fe<J;fe++)$[fe]=~Z.g[fe];return new R($,~Z.h).add(W)}o.abs=function(){return se(this)?te(this):this},o.add=function(Z){for(var J=Math.max(this.g.length,Z.g.length),$=[],fe=0,ve=0;ve<=J;ve++){var pe=fe+(this.i(ve)&65535)+(Z.i(ve)&65535),he=(pe>>>16)+(this.i(ve)>>>16)+(Z.i(ve)>>>16);fe=he>>>16,pe&=65535,he&=65535,$[ve]=he<<16|pe}return new R($,$[$.length-1]&-2147483648?-1:0)};function le(Z,J){return Z.add(te(J))}o.j=function(Z){if(Q(this)||Q(Z))return G;if(se(this))return se(Z)?te(this).j(te(Z)):te(te(this).j(Z));if(se(Z))return te(this.j(te(Z)));if(0>this.l(ne)&&0>Z.l(ne))return O(this.m()*Z.m());for(var J=this.g.length+Z.g.length,$=[],fe=0;fe<2*J;fe++)$[fe]=0;for(fe=0;fe<this.g.length;fe++)for(var ve=0;ve<Z.g.length;ve++){var pe=this.i(fe)>>>16,he=this.i(fe)&65535,Fe=Z.i(ve)>>>16,st=Z.i(ve)&65535;$[2*fe+2*ve]+=he*st,ce($,2*fe+2*ve),$[2*fe+2*ve+1]+=pe*st,ce($,2*fe+2*ve+1),$[2*fe+2*ve+1]+=he*Fe,ce($,2*fe+2*ve+1),$[2*fe+2*ve+2]+=pe*Fe,ce($,2*fe+2*ve+2)}for(fe=0;fe<J;fe++)$[fe]=$[2*fe+1]<<16|$[2*fe];for(fe=J;fe<2*J;fe++)$[fe]=0;return new R($,0)};function ce(Z,J){for(;(Z[J]&65535)!=Z[J];)Z[J+1]+=Z[J]>>>16,Z[J]&=65535,J++}function me(Z,J){this.g=Z,this.h=J}function Ce(Z,J){if(Q(J))throw Error("division by zero");if(Q(Z))return new me(G,G);if(se(Z))return J=Ce(te(Z),J),new me(te(J.g),te(J.h));if(se(J))return J=Ce(Z,te(J)),new me(te(J.g),J.h);if(30<Z.g.length){if(se(Z)||se(J))throw Error("slowDivide_ only works with positive integers.");for(var $=W,fe=J;0>=fe.l(Z);)$=_e($),fe=_e(fe);var ve=ze($,1),pe=ze(fe,1);for(fe=ze(fe,2),$=ze($,2);!Q(fe);){var he=pe.add(fe);0>=he.l(Z)&&(ve=ve.add($),pe=he),fe=ze(fe,1),$=ze($,1)}return J=le(Z,ve.j(J)),new me(ve,J)}for(ve=G;0<=Z.l(J);){for($=Math.max(1,Math.floor(Z.m()/J.m())),fe=Math.ceil(Math.log($)/Math.LN2),fe=48>=fe?1:Math.pow(2,fe-48),pe=O($),he=pe.j(J);se(he)||0<he.l(Z);)$-=fe,pe=O($),he=pe.j(J);Q(pe)&&(pe=W),ve=ve.add(pe),Z=le(Z,he)}return new me(ve,Z)}o.A=function(Z){return Ce(this,Z).h},o.and=function(Z){for(var J=Math.max(this.g.length,Z.g.length),$=[],fe=0;fe<J;fe++)$[fe]=this.i(fe)&Z.i(fe);return new R($,this.h&Z.h)},o.or=function(Z){for(var J=Math.max(this.g.length,Z.g.length),$=[],fe=0;fe<J;fe++)$[fe]=this.i(fe)|Z.i(fe);return new R($,this.h|Z.h)},o.xor=function(Z){for(var J=Math.max(this.g.length,Z.g.length),$=[],fe=0;fe<J;fe++)$[fe]=this.i(fe)^Z.i(fe);return new R($,this.h^Z.h)};function _e(Z){for(var J=Z.g.length+1,$=[],fe=0;fe<J;fe++)$[fe]=Z.i(fe)<<1|Z.i(fe-1)>>>31;return new R($,Z.h)}function ze(Z,J){var $=J>>5;J%=32;for(var fe=Z.g.length-$,ve=[],pe=0;pe<fe;pe++)ve[pe]=0<J?Z.i(pe+$)>>>J|Z.i(pe+$+1)<<32-J:Z.i(pe+$);return new R(ve,Z.h)}d.prototype.digest=d.prototype.v,d.prototype.reset=d.prototype.s,d.prototype.update=d.prototype.u,o8=d,R.prototype.add=R.prototype.add,R.prototype.multiply=R.prototype.j,R.prototype.modulo=R.prototype.A,R.prototype.compare=R.prototype.l,R.prototype.toNumber=R.prototype.m,R.prototype.toString=R.prototype.toString,R.prototype.getBits=R.prototype.i,R.fromNumber=O,R.fromString=x,Mp=R}).apply(typeof uH<"u"?uH:typeof self<"u"?self:typeof window<"u"?window:{});var i0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var c8,WT,l8,B0,hx,d8,u8,h8;(function(){var o,i=typeof Object.defineProperties=="function"?Object.defineProperty:function(b,j,z){return b==Array.prototype||b==Object.prototype||(b[j]=z.value),b};function a(b){b=[typeof globalThis=="object"&&globalThis,b,typeof window=="object"&&window,typeof self=="object"&&self,typeof i0=="object"&&i0];for(var j=0;j<b.length;++j){var z=b[j];if(z&&z.Math==Math)return z}throw Error("Cannot find global object")}var d=a(this);function f(b,j){if(j)e:{var z=d;b=b.split(".");for(var oe=0;oe<b.length-1;oe++){var Pe=b[oe];if(!(Pe in z))break e;z=z[Pe]}b=b[b.length-1],oe=z[b],j=j(oe),j!=oe&&j!=null&&i(z,b,{configurable:!0,writable:!0,value:j})}}function y(b,j){b instanceof String&&(b+="");var z=0,oe=!1,Pe={next:function(){if(!oe&&z<b.length){var Ke=z++;return{value:j(Ke,b[Ke]),done:!1}}return oe=!0,{done:!0,value:void 0}}};return Pe[Symbol.iterator]=function(){return Pe},Pe}f("Array.prototype.values",function(b){return b||function(){return y(this,function(j,z){return z})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var R=R||{},w=this||self;function N(b){var j=typeof b;return j=j!="object"?j:b?Array.isArray(b)?"array":j:"null",j=="array"||j=="object"&&typeof b.length=="number"}function O(b){var j=typeof b;return j=="object"&&b!=null||j=="function"}function x(b,j,z){return b.call.apply(b.bind,arguments)}function G(b,j,z){if(!b)throw Error();if(2<arguments.length){var oe=Array.prototype.slice.call(arguments,2);return function(){var Pe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Pe,oe),b.apply(j,Pe)}}return function(){return b.apply(j,arguments)}}function W(b,j,z){return W=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?x:G,W.apply(null,arguments)}function ne(b,j){var z=Array.prototype.slice.call(arguments,1);return function(){var oe=z.slice();return oe.push.apply(oe,arguments),b.apply(this,oe)}}function Q(b,j){function z(){}z.prototype=j.prototype,b.aa=j.prototype,b.prototype=new z,b.prototype.constructor=b,b.Qb=function(oe,Pe,Ke){for(var Tt=Array(arguments.length-2),$n=2;$n<arguments.length;$n++)Tt[$n-2]=arguments[$n];return j.prototype[Pe].apply(oe,Tt)}}function se(b){const j=b.length;if(0<j){const z=Array(j);for(let oe=0;oe<j;oe++)z[oe]=b[oe];return z}return[]}function te(b,j){for(let z=1;z<arguments.length;z++){const oe=arguments[z];if(N(oe)){const Pe=b.length||0,Ke=oe.length||0;b.length=Pe+Ke;for(let Tt=0;Tt<Ke;Tt++)b[Pe+Tt]=oe[Tt]}else b.push(oe)}}class le{constructor(j,z){this.i=j,this.j=z,this.h=0,this.g=null}get(){let j;return 0<this.h?(this.h--,j=this.g,this.g=j.next,j.next=null):j=this.i(),j}}function ce(b){return/^[\s\xa0]*$/.test(b)}function me(){var b=w.navigator;return b&&(b=b.userAgent)?b:""}function Ce(b){return Ce[" "](b),b}Ce[" "]=function(){};var _e=me().indexOf("Gecko")!=-1&&!(me().toLowerCase().indexOf("webkit")!=-1&&me().indexOf("Edge")==-1)&&!(me().indexOf("Trident")!=-1||me().indexOf("MSIE")!=-1)&&me().indexOf("Edge")==-1;function ze(b,j,z){for(const oe in b)j.call(z,b[oe],oe,b)}function Z(b,j){for(const z in b)j.call(void 0,b[z],z,b)}function J(b){const j={};for(const z in b)j[z]=b[z];return j}const $="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function fe(b,j){let z,oe;for(let Pe=1;Pe<arguments.length;Pe++){oe=arguments[Pe];for(z in oe)b[z]=oe[z];for(let Ke=0;Ke<$.length;Ke++)z=$[Ke],Object.prototype.hasOwnProperty.call(oe,z)&&(b[z]=oe[z])}}function ve(b){var j=1;b=b.split(":");const z=[];for(;0<j&&b.length;)z.push(b.shift()),j--;return b.length&&z.push(b.join(":")),z}function pe(b){w.setTimeout(()=>{throw b},0)}function he(){var b=Et;let j=null;return b.g&&(j=b.g,b.g=b.g.next,b.g||(b.h=null),j.next=null),j}class Fe{constructor(){this.h=this.g=null}add(j,z){const oe=st.get();oe.set(j,z),this.h?this.h.next=oe:this.g=oe,this.h=oe}}var st=new le(()=>new we,b=>b.reset());class we{constructor(){this.next=this.g=this.h=null}set(j,z){this.h=j,this.g=z,this.next=null}reset(){this.next=this.g=this.h=null}}let je,nt=!1,Et=new Fe,ge=()=>{const b=w.Promise.resolve(void 0);je=()=>{b.then(qe)}};var qe=()=>{for(var b;b=he();){try{b.h.call(b.g)}catch(z){pe(z)}var j=st;j.j(b),100>j.h&&(j.h++,b.next=j.g,j.g=b)}nt=!1};function Oe(){this.s=this.s,this.C=this.C}Oe.prototype.s=!1,Oe.prototype.ma=function(){this.s||(this.s=!0,this.N())},Oe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Be(b,j){this.type=b,this.g=this.target=j,this.defaultPrevented=!1}Be.prototype.h=function(){this.defaultPrevented=!0};var rt=function(){if(!w.addEventListener||!Object.defineProperty)return!1;var b=!1,j=Object.defineProperty({},"passive",{get:function(){b=!0}});try{const z=()=>{};w.addEventListener("test",z,j),w.removeEventListener("test",z,j)}catch{}return b}();function Nt(b,j){if(Be.call(this,b?b.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,b){var z=this.type=b.type,oe=b.changedTouches&&b.changedTouches.length?b.changedTouches[0]:null;if(this.target=b.target||b.srcElement,this.g=j,j=b.relatedTarget){if(_e){e:{try{Ce(j.nodeName);var Pe=!0;break e}catch{}Pe=!1}Pe||(j=null)}}else z=="mouseover"?j=b.fromElement:z=="mouseout"&&(j=b.toElement);this.relatedTarget=j,oe?(this.clientX=oe.clientX!==void 0?oe.clientX:oe.pageX,this.clientY=oe.clientY!==void 0?oe.clientY:oe.pageY,this.screenX=oe.screenX||0,this.screenY=oe.screenY||0):(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0),this.button=b.button,this.key=b.key||"",this.ctrlKey=b.ctrlKey,this.altKey=b.altKey,this.shiftKey=b.shiftKey,this.metaKey=b.metaKey,this.pointerId=b.pointerId||0,this.pointerType=typeof b.pointerType=="string"?b.pointerType:$e[b.pointerType]||"",this.state=b.state,this.i=b,b.defaultPrevented&&Nt.aa.h.call(this)}}Q(Nt,Be);var $e={2:"touch",3:"pen",4:"mouse"};Nt.prototype.h=function(){Nt.aa.h.call(this);var b=this.i;b.preventDefault?b.preventDefault():b.returnValue=!1};var mt="closure_listenable_"+(1e6*Math.random()|0),bt=0;function Bt(b,j,z,oe,Pe){this.listener=b,this.proxy=null,this.src=j,this.type=z,this.capture=!!oe,this.ha=Pe,this.key=++bt,this.da=this.fa=!1}function fn(b){b.da=!0,b.listener=null,b.proxy=null,b.src=null,b.ha=null}function vn(b){this.src=b,this.g={},this.h=0}vn.prototype.add=function(b,j,z,oe,Pe){var Ke=b.toString();b=this.g[Ke],b||(b=this.g[Ke]=[],this.h++);var Tt=yt(b,j,oe,Pe);return-1<Tt?(j=b[Tt],z||(j.fa=!1)):(j=new Bt(j,this.src,Ke,!!oe,Pe),j.fa=z,b.push(j)),j};function qi(b,j){var z=j.type;if(z in b.g){var oe=b.g[z],Pe=Array.prototype.indexOf.call(oe,j,void 0),Ke;(Ke=0<=Pe)&&Array.prototype.splice.call(oe,Pe,1),Ke&&(fn(j),b.g[z].length==0&&(delete b.g[z],b.h--))}}function yt(b,j,z,oe){for(var Pe=0;Pe<b.length;++Pe){var Ke=b[Pe];if(!Ke.da&&Ke.listener==j&&Ke.capture==!!z&&Ke.ha==oe)return Pe}return-1}var Vt="closure_lm_"+(1e6*Math.random()|0),gt={};function Zt(b,j,z,oe,Pe){if(Array.isArray(j)){for(var Ke=0;Ke<j.length;Ke++)Zt(b,j[Ke],z,oe,Pe);return null}return z=Fa(z),b&&b[mt]?b.K(j,z,O(oe)?!!oe.capture:!1,Pe):rn(b,j,z,!1,oe,Pe)}function rn(b,j,z,oe,Pe,Ke){if(!j)throw Error("Invalid event type");var Tt=O(Pe)?!!Pe.capture:!!Pe,$n=Qs(b);if($n||(b[Vt]=$n=new vn(b)),z=$n.add(j,z,oe,Tt,Ke),z.proxy)return z;if(oe=kn(),z.proxy=oe,oe.src=b,oe.listener=z,b.addEventListener)rt||(Pe=Tt),Pe===void 0&&(Pe=!1),b.addEventListener(j.toString(),oe,Pe);else if(b.attachEvent)b.attachEvent(_r(j.toString()),oe);else if(b.addListener&&b.removeListener)b.addListener(oe);else throw Error("addEventListener and attachEvent are unavailable.");return z}function kn(){function b(z){return j.call(b.src,b.listener,z)}const j=Ko;return b}function ui(b,j,z,oe,Pe){if(Array.isArray(j))for(var Ke=0;Ke<j.length;Ke++)ui(b,j[Ke],z,oe,Pe);else oe=O(oe)?!!oe.capture:!!oe,z=Fa(z),b&&b[mt]?(b=b.i,j=String(j).toString(),j in b.g&&(Ke=b.g[j],z=yt(Ke,z,oe,Pe),-1<z&&(fn(Ke[z]),Array.prototype.splice.call(Ke,z,1),Ke.length==0&&(delete b.g[j],b.h--)))):b&&(b=Qs(b))&&(j=b.g[j.toString()],b=-1,j&&(b=yt(j,z,oe,Pe)),(z=-1<b?j[b]:null)&&Zr(z))}function Zr(b){if(typeof b!="number"&&b&&!b.da){var j=b.src;if(j&&j[mt])qi(j.i,b);else{var z=b.type,oe=b.proxy;j.removeEventListener?j.removeEventListener(z,oe,b.capture):j.detachEvent?j.detachEvent(_r(z),oe):j.addListener&&j.removeListener&&j.removeListener(oe),(z=Qs(j))?(qi(z,b),z.h==0&&(z.src=null,j[Vt]=null)):fn(b)}}}function _r(b){return b in gt?gt[b]:gt[b]="on"+b}function Ko(b,j){if(b.da)b=!0;else{j=new Nt(j,this);var z=b.listener,oe=b.ha||b.src;b.fa&&Zr(b),b=z.call(oe,j)}return b}function Qs(b){return b=b[Vt],b instanceof vn?b:null}var Ti="__closure_events_fn_"+(1e9*Math.random()>>>0);function Fa(b){return typeof b=="function"?b:(b[Ti]||(b[Ti]=function(j){return b.handleEvent(j)}),b[Ti])}function Gt(){Oe.call(this),this.i=new vn(this),this.M=this,this.F=null}Q(Gt,Oe),Gt.prototype[mt]=!0,Gt.prototype.removeEventListener=function(b,j,z,oe){ui(this,b,j,z,oe)};function Me(b,j){var z,oe=b.F;if(oe)for(z=[];oe;oe=oe.F)z.push(oe);if(b=b.M,oe=j.type||j,typeof j=="string")j=new Be(j,b);else if(j instanceof Be)j.target=j.target||b;else{var Pe=j;j=new Be(oe,b),fe(j,Pe)}if(Pe=!0,z)for(var Ke=z.length-1;0<=Ke;Ke--){var Tt=j.g=z[Ke];Pe=un(Tt,oe,!0,j)&&Pe}if(Tt=j.g=b,Pe=un(Tt,oe,!0,j)&&Pe,Pe=un(Tt,oe,!1,j)&&Pe,z)for(Ke=0;Ke<z.length;Ke++)Tt=j.g=z[Ke],Pe=un(Tt,oe,!1,j)&&Pe}Gt.prototype.N=function(){if(Gt.aa.N.call(this),this.i){var b=this.i,j;for(j in b.g){for(var z=b.g[j],oe=0;oe<z.length;oe++)fn(z[oe]);delete b.g[j],b.h--}}this.F=null},Gt.prototype.K=function(b,j,z,oe){return this.i.add(String(b),j,!1,z,oe)},Gt.prototype.L=function(b,j,z,oe){return this.i.add(String(b),j,!0,z,oe)};function un(b,j,z,oe){if(j=b.i.g[String(j)],!j)return!0;j=j.concat();for(var Pe=!0,Ke=0;Ke<j.length;++Ke){var Tt=j[Ke];if(Tt&&!Tt.da&&Tt.capture==z){var $n=Tt.listener,jr=Tt.ha||Tt.src;Tt.fa&&qi(b.i,Tt),Pe=$n.call(jr,oe)!==!1&&Pe}}return Pe&&!oe.defaultPrevented}function gn(b,j,z){if(typeof b=="function")z&&(b=W(b,z));else if(b&&typeof b.handleEvent=="function")b=W(b.handleEvent,b);else throw Error("Invalid listener argument");return 2147483647<Number(j)?-1:w.setTimeout(b,j||0)}function Ai(b){b.g=gn(()=>{b.g=null,b.i&&(b.i=!1,Ai(b))},b.l);const j=b.h;b.h=null,b.m.apply(null,j)}class Ea extends Oe{constructor(j,z){super(),this.m=j,this.l=z,this.h=null,this.i=!1,this.g=null}j(j){this.h=arguments,this.g?this.i=!0:Ai(this)}N(){super.N(),this.g&&(w.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ki(b){Oe.call(this),this.h=b,this.g={}}Q(Ki,Oe);var gr=[];function cr(b){ze(b.g,function(j,z){this.g.hasOwnProperty(z)&&Zr(j)},b),b.g={}}Ki.prototype.N=function(){Ki.aa.N.call(this),cr(this)},Ki.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ts=w.JSON.stringify,Yo=w.JSON.parse,Xo=class{stringify(b){return w.JSON.stringify(b,void 0)}parse(b){return w.JSON.parse(b,void 0)}};function ya(){}ya.prototype.h=null;function Vc(b){return b.h||(b.h=b.i())}function xl(){}var Ba={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Fc(){Be.call(this,"d")}Q(Fc,Be);function Kp(){Be.call(this,"c")}Q(Kp,Be);var $s={},Yp=null;function va(){return Yp=Yp||new Gt}$s.La="serverreachability";function ch(b){Be.call(this,$s.La,b)}Q(ch,Be);function Ml(b){const j=va();Me(j,new ch(j))}$s.STAT_EVENT="statevent";function p_(b,j){Be.call(this,$s.STAT_EVENT,b),this.stat=j}Q(p_,Be);function zn(b){const j=va();Me(j,new p_(j,b))}$s.Ma="timingevent";function Ur(b,j){Be.call(this,$s.Ma,b),this.size=j}Q(Ur,Be);function Ar(b,j){if(typeof b!="function")throw Error("Fn must not be null and must be a function");return w.setTimeout(function(){b()},j)}function ks(){this.g=!0}ks.prototype.xa=function(){this.g=!1};function lh(b,j,z,oe,Pe,Ke){b.info(function(){if(b.g)if(Ke)for(var Tt="",$n=Ke.split("&"),jr=0;jr<$n.length;jr++){var Cn=$n[jr].split("=");if(1<Cn.length){var ns=Cn[0];Cn=Cn[1];var Vr=ns.split("_");Tt=2<=Vr.length&&Vr[1]=="type"?Tt+(ns+"="+Cn+"&"):Tt+(ns+"=redacted&")}}else Tt=null;else Tt=Ke;return"XMLHTTP REQ ("+oe+") [attempt "+Pe+"]: "+j+`
`+z+`
`+Tt})}function f_(b,j,z,oe,Pe,Ke,Tt){b.info(function(){return"XMLHTTP RESP ("+oe+") [ attempt "+Pe+"]: "+j+`
`+z+`
`+Ke+" "+Tt})}function Bc(b,j,z,oe){b.info(function(){return"XMLHTTP TEXT ("+j+"): "+Ul(b,z)+(oe?" "+oe:"")})}function m_(b,j){b.info(function(){return"TIMEOUT: "+j})}ks.prototype.info=function(){};function Ul(b,j){if(!b.g)return j;if(!j)return null;try{var z=JSON.parse(j);if(z){for(b=0;b<z.length;b++)if(Array.isArray(z[b])){var oe=z[b];if(!(2>oe.length)){var Pe=oe[1];if(Array.isArray(Pe)&&!(1>Pe.length)){var Ke=Pe[0];if(Ke!="noop"&&Ke!="stop"&&Ke!="close")for(var Tt=1;Tt<Pe.length;Tt++)Pe[Tt]=""}}}}return Ts(z)}catch{return j}}var Gc={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Hc={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Jo;function Qo(){}Q(Qo,ya),Qo.prototype.g=function(){return new XMLHttpRequest},Qo.prototype.i=function(){return{}},Jo=new Qo;function Rs(b,j,z,oe){this.j=b,this.i=j,this.l=z,this.R=oe||1,this.U=new Ki(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new lr}function lr(){this.i=null,this.g="",this.h=!1}var Hd={},zd={};function bs(b,j,z){b.L=1,b.v=Jd(Ta(j)),b.m=z,b.P=!0,zc(b,null)}function zc(b,j){b.F=Date.now(),Wd(b),b.A=Ta(b.v);var z=b.A,oe=b.R;Array.isArray(oe)||(oe=[String(oe)]),$p(z.i,"t",oe),b.C=0,z=b.j.J,b.h=new lr,b.g=af(b.j,z?j:null,!b.m),0<b.O&&(b.M=new Ea(W(b.Y,b,b.g),b.O)),j=b.U,z=b.g,oe=b.ca;var Pe="readystatechange";Array.isArray(Pe)||(Pe&&(gr[0]=Pe.toString()),Pe=gr);for(var Ke=0;Ke<Pe.length;Ke++){var Tt=Zt(z,Pe[Ke],oe||j.handleEvent,!1,j.h||j);if(!Tt)break;j.g[Tt.key]=Tt}j=b.H?J(b.H):{},b.m?(b.u||(b.u="POST"),j["Content-Type"]="application/x-www-form-urlencoded",b.g.ea(b.A,b.u,b.m,j)):(b.u="GET",b.g.ea(b.A,b.u,null,j)),Ml(),lh(b.i,b.u,b.A,b.l,b.R,b.m)}Rs.prototype.ca=function(b){b=b.target;const j=this.M;j&&za(b)==3?j.j():this.Y(b)},Rs.prototype.Y=function(b){try{if(b==this.g)e:{const Vr=za(this.g);var j=this.g.Ba();const $c=this.g.Z();if(!(3>Vr)&&(Vr!=3||this.g&&(this.h.h||this.g.oa()||T_(this.g)))){this.J||Vr!=4||j==7||(j==8||0>=$c?Ml(3):Ml(2)),ki(this);var z=this.g.Z();this.X=z;t:if(__(this)){var oe=T_(this.g);b="";var Pe=oe.length,Ke=za(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){hs(this),$o(this);var Tt="";break t}this.h.i=new w.TextDecoder}for(j=0;j<Pe;j++)this.h.h=!0,b+=this.h.i.decode(oe[j],{stream:!(Ke&&j==Pe-1)});oe.length=0,this.h.g+=b,this.C=0,Tt=this.h.g}else Tt=this.g.oa();if(this.o=z==200,f_(this.i,this.u,this.A,this.l,this.R,Vr,z),this.o){if(this.T&&!this.K){t:{if(this.g){var $n,jr=this.g;if(($n=jr.g?jr.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ce($n)){var Cn=$n;break t}}Cn=null}if(z=Cn)Bc(this.i,this.l,z,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,qd(this,z);else{this.o=!1,this.s=3,zn(12),hs(this),$o(this);break e}}if(this.P){z=!0;let is;for(;!this.J&&this.C<Tt.length;)if(is=Sa(this,Tt),is==zd){Vr==4&&(this.s=4,zn(14),z=!1),Bc(this.i,this.l,null,"[Incomplete Response]");break}else if(is==Hd){this.s=4,zn(15),Bc(this.i,this.l,Tt,"[Invalid Chunk]"),z=!1;break}else Bc(this.i,this.l,is,null),qd(this,is);if(__(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Vr!=4||Tt.length!=0||this.h.h||(this.s=1,zn(16),z=!1),this.o=this.o&&z,!z)Bc(this.i,this.l,Tt,"[Invalid Chunked Response]"),hs(this),$o(this);else if(0<Tt.length&&!this.W){this.W=!0;var ns=this.j;ns.g==this&&ns.ba&&!ns.M&&(ns.j.info("Great, no buffering proxy detected. Bytes received: "+Tt.length),nu(ns),ns.M=!0,zn(11))}}else Bc(this.i,this.l,Tt,null),qd(this,Tt);Vr==4&&hs(this),this.o&&!this.J&&(Vr==4?w_(this.j,this):(this.o=!1,Wd(this)))}else Oy(this.g),z==400&&0<Tt.indexOf("Unknown SID")?(this.s=3,zn(12)):(this.s=0,zn(13)),hs(this),$o(this)}}}catch{}finally{}};function __(b){return b.g?b.u=="GET"&&b.L!=2&&b.j.Ca:!1}function Sa(b,j){var z=b.C,oe=j.indexOf(`
`,z);return oe==-1?zd:(z=Number(j.substring(z,oe)),isNaN(z)?Hd:(oe+=1,oe+z>j.length?zd:(j=j.slice(oe,oe+z),b.C=oe+z,j)))}Rs.prototype.cancel=function(){this.J=!0,hs(this)};function Wd(b){b.S=Date.now()+b.I,g_(b,b.I)}function g_(b,j){if(b.B!=null)throw Error("WatchDog timer not null");b.B=Ar(W(b.ba,b),j)}function ki(b){b.B&&(w.clearTimeout(b.B),b.B=null)}Rs.prototype.ba=function(){this.B=null;const b=Date.now();0<=b-this.S?(m_(this.i,this.A),this.L!=2&&(Ml(),zn(17)),hs(this),this.s=2,$o(this)):g_(this,this.S-b)};function $o(b){b.j.G==0||b.J||w_(b.j,b)}function hs(b){ki(b);var j=b.M;j&&typeof j.ma=="function"&&j.ma(),b.M=null,cr(b.U),b.g&&(j=b.g,b.g=null,j.abort(),j.ma())}function qd(b,j){try{var z=b.j;if(z.G!=0&&(z.g==b||Xp(z.h,b))){if(!b.K&&Xp(z.h,b)&&z.G==3){try{var oe=z.Da.g.parse(j)}catch{oe=null}if(Array.isArray(oe)&&oe.length==3){var Pe=oe;if(Pe[0]==0){e:if(!z.u){if(z.g)if(z.g.F+3e3<b.F)gh(z),Gl(z);else break e;Jc(z),zn(18)}}else z.za=Pe[1],0<z.za-z.T&&37500>Pe[2]&&z.F&&z.v==0&&!z.C&&(z.C=Ar(W(z.Za,z),6e3));if(1>=Kd(z.h)&&z.ca){try{z.ca()}catch{}z.ca=void 0}}else ta(z,11)}else if((b.K||z.g==b)&&gh(z),!ce(j))for(Pe=z.Da.g.parse(j),j=0;j<Pe.length;j++){let Cn=Pe[j];if(z.T=Cn[0],Cn=Cn[1],z.G==2)if(Cn[0]=="c"){z.K=Cn[1],z.ia=Cn[2];const ns=Cn[3];ns!=null&&(z.la=ns,z.j.info("VER="+z.la));const Vr=Cn[4];Vr!=null&&(z.Aa=Vr,z.j.info("SVER="+z.Aa));const $c=Cn[5];$c!=null&&typeof $c=="number"&&0<$c&&(oe=1.5*$c,z.L=oe,z.j.info("backChannelRequestTimeoutMs_="+oe)),oe=z;const is=b.g;if(is){const Wa=is.g?is.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Wa){var Ke=oe.h;Ke.g||Wa.indexOf("spdy")==-1&&Wa.indexOf("quic")==-1&&Wa.indexOf("h2")==-1||(Ke.j=Ke.l,Ke.g=new Set,Ke.h&&(uh(Ke,Ke.h),Ke.h=null))}if(oe.D){const of=is.g?is.g.getResponseHeader("X-HTTP-Session-Id"):null;of&&(oe.ya=of,Ii(oe.I,oe.D,of))}}z.G=3,z.l&&z.l.ua(),z.ba&&(z.R=Date.now()-b.F,z.j.info("Handshake RTT: "+z.R+"ms")),oe=z;var Tt=b;if(oe.qa=Qc(oe,oe.J?oe.ia:null,oe.W),Tt.K){xs(oe.h,Tt);var $n=Tt,jr=oe.L;jr&&($n.I=jr),$n.B&&(ki($n),Wd($n)),oe.g=Tt}else rc(oe);0<z.i.length&&Hl(z)}else Cn[0]!="stop"&&Cn[0]!="close"||ta(z,7);else z.G==3&&(Cn[0]=="stop"||Cn[0]=="close"?Cn[0]=="stop"?ta(z,7):nf(z):Cn[0]!="noop"&&z.l&&z.l.ta(Cn),z.v=0)}}Ml(4)}catch{}}var E_=class{constructor(b,j){this.g=b,this.map=j}};function Eo(b){this.l=b||10,w.PerformanceNavigationTiming?(b=w.performance.getEntriesByType("navigation"),b=0<b.length&&(b[0].nextHopProtocol=="hq"||b[0].nextHopProtocol=="h2")):b=!!(w.chrome&&w.chrome.loadTimes&&w.chrome.loadTimes()&&w.chrome.loadTimes().wasFetchedViaSpdy),this.j=b?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function dh(b){return b.h?!0:b.g?b.g.size>=b.j:!1}function Kd(b){return b.h?1:b.g?b.g.size:0}function Xp(b,j){return b.h?b.h==j:b.g?b.g.has(j):!1}function uh(b,j){b.g?b.g.add(j):b.h=j}function xs(b,j){b.h&&b.h==j?b.h=null:b.g&&b.g.has(j)&&b.g.delete(j)}Eo.prototype.cancel=function(){if(this.i=Zo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const b of this.g.values())b.cancel();this.g.clear()}};function Zo(b){if(b.h!=null)return b.i.concat(b.h.D);if(b.g!=null&&b.g.size!==0){let j=b.i;for(const z of b.g.values())j=j.concat(z.D);return j}return se(b.i)}function Jp(b){if(b.V&&typeof b.V=="function")return b.V();if(typeof Map<"u"&&b instanceof Map||typeof Set<"u"&&b instanceof Set)return Array.from(b.values());if(typeof b=="string")return b.split("");if(N(b)){for(var j=[],z=b.length,oe=0;oe<z;oe++)j.push(b[oe]);return j}j=[],z=0;for(oe in b)j[z++]=b[oe];return j}function hh(b){if(b.na&&typeof b.na=="function")return b.na();if(!b.V||typeof b.V!="function"){if(typeof Map<"u"&&b instanceof Map)return Array.from(b.keys());if(!(typeof Set<"u"&&b instanceof Set)){if(N(b)||typeof b=="string"){var j=[];b=b.length;for(var z=0;z<b;z++)j.push(z);return j}j=[],z=0;for(const oe in b)j[z++]=oe;return j}}}function hi(b,j){if(b.forEach&&typeof b.forEach=="function")b.forEach(j,void 0);else if(N(b)||typeof b=="string")Array.prototype.forEach.call(b,j,void 0);else for(var z=hh(b),oe=Jp(b),Pe=oe.length,Ke=0;Ke<Pe;Ke++)j.call(void 0,oe[Ke],z&&z[Ke],b)}var Yd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function y_(b,j){if(b){b=b.split("&");for(var z=0;z<b.length;z++){var oe=b[z].indexOf("="),Pe=null;if(0<=oe){var Ke=b[z].substring(0,oe);Pe=b[z].substring(oe+1)}else Ke=b[z];j(Ke,Pe?decodeURIComponent(Pe.replace(/\+/g," ")):"")}}}function Er(b){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,b instanceof Er){this.h=b.h,Xd(this,b.j),this.o=b.o,this.g=b.g,jl(this,b.s),this.l=b.l;var j=b.i,z=new qc;z.i=j.i,j.g&&(z.g=new Map(j.g),z.h=j.h),Wc(this,z),this.m=b.m}else b&&(j=String(b).match(Yd))?(this.h=!1,Xd(this,j[1]||"",!0),this.o=Zs(j[2]||""),this.g=Zs(j[3]||"",!0),jl(this,j[4]),this.l=Zs(j[5]||"",!0),Wc(this,j[6]||"",!0),this.m=Zs(j[7]||"")):(this.h=!1,this.i=new qc(null,this.h))}Er.prototype.toString=function(){var b=[],j=this.j;j&&b.push(Vl(j,Qp,!0),":");var z=this.g;return(z||j=="file")&&(b.push("//"),(j=this.o)&&b.push(Vl(j,Qp,!0),"@"),b.push(encodeURIComponent(String(z)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),z=this.s,z!=null&&b.push(":",String(z))),(z=this.l)&&(this.g&&z.charAt(0)!="/"&&b.push("/"),b.push(Vl(z,z.charAt(0)=="/"?Ny:Qd,!0))),(z=this.i.toString())&&b.push("?",z),(z=this.m)&&b.push("#",Vl(z,fh)),b.join("")};function Ta(b){return new Er(b)}function Xd(b,j,z){b.j=z?Zs(j,!0):j,b.j&&(b.j=b.j.replace(/:$/,""))}function jl(b,j){if(j){if(j=Number(j),isNaN(j)||0>j)throw Error("Bad port number "+j);b.s=j}else b.s=null}function Wc(b,j,z){j instanceof qc?(b.i=j,S_(b.i,b.h)):(z||(j=Vl(j,v_)),b.i=new qc(j,b.h))}function Ii(b,j,z){b.i.set(j,z)}function Jd(b){return Ii(b,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),b}function Zs(b,j){return b?j?decodeURI(b.replace(/%25/g,"%2525")):decodeURIComponent(b):""}function Vl(b,j,z){return typeof b=="string"?(b=encodeURI(b).replace(j,ph),z&&(b=b.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),b):null}function ph(b){return b=b.charCodeAt(0),"%"+(b>>4&15).toString(16)+(b&15).toString(16)}var Qp=/[#\/\?@]/g,Qd=/[#\?:]/g,Ny=/[#\?]/g,v_=/[#\?@]/g,fh=/#/g;function qc(b,j){this.h=this.g=null,this.i=b||null,this.j=!!j}function Ga(b){b.g||(b.g=new Map,b.h=0,b.i&&y_(b.i,function(j,z){b.add(decodeURIComponent(j.replace(/\+/g," ")),z)}))}o=qc.prototype,o.add=function(b,j){Ga(this),this.i=null,b=ec(this,b);var z=this.g.get(b);return z||this.g.set(b,z=[]),z.push(j),this.h+=1,this};function Kc(b,j){Ga(b),j=ec(b,j),b.g.has(j)&&(b.i=null,b.h-=b.g.get(j).length,b.g.delete(j))}function Yc(b,j){return Ga(b),j=ec(b,j),b.g.has(j)}o.forEach=function(b,j){Ga(this),this.g.forEach(function(z,oe){z.forEach(function(Pe){b.call(j,Pe,oe,this)},this)},this)},o.na=function(){Ga(this);const b=Array.from(this.g.values()),j=Array.from(this.g.keys()),z=[];for(let oe=0;oe<j.length;oe++){const Pe=b[oe];for(let Ke=0;Ke<Pe.length;Ke++)z.push(j[oe])}return z},o.V=function(b){Ga(this);let j=[];if(typeof b=="string")Yc(this,b)&&(j=j.concat(this.g.get(ec(this,b))));else{b=Array.from(this.g.values());for(let z=0;z<b.length;z++)j=j.concat(b[z])}return j},o.set=function(b,j){return Ga(this),this.i=null,b=ec(this,b),Yc(this,b)&&(this.h-=this.g.get(b).length),this.g.set(b,[j]),this.h+=1,this},o.get=function(b,j){return b?(b=this.V(b),0<b.length?String(b[0]):j):j};function $p(b,j,z){Kc(b,j),0<z.length&&(b.i=null,b.g.set(ec(b,j),se(z)),b.h+=z.length)}o.toString=function(){if(this.i)return this.i;if(!this.g)return"";const b=[],j=Array.from(this.g.keys());for(var z=0;z<j.length;z++){var oe=j[z];const Ke=encodeURIComponent(String(oe)),Tt=this.V(oe);for(oe=0;oe<Tt.length;oe++){var Pe=Ke;Tt[oe]!==""&&(Pe+="="+encodeURIComponent(String(Tt[oe]))),b.push(Pe)}}return this.i=b.join("&")};function ec(b,j){return j=String(j),b.j&&(j=j.toLowerCase()),j}function S_(b,j){j&&!b.j&&(Ga(b),b.i=null,b.g.forEach(function(z,oe){var Pe=oe.toLowerCase();oe!=Pe&&(Kc(this,oe),$p(this,Pe,z))},b)),b.j=j}function Fl(b,j){const z=new ks;if(w.Image){const oe=new Image;oe.onload=ne(Ha,z,"TestLoadImage: loaded",!0,j,oe),oe.onerror=ne(Ha,z,"TestLoadImage: error",!1,j,oe),oe.onabort=ne(Ha,z,"TestLoadImage: abort",!1,j,oe),oe.ontimeout=ne(Ha,z,"TestLoadImage: timeout",!1,j,oe),w.setTimeout(function(){oe.ontimeout&&oe.ontimeout()},1e4),oe.src=b}else j(!1)}function yo(b,j){const z=new ks,oe=new AbortController,Pe=setTimeout(()=>{oe.abort(),Ha(z,"TestPingServer: timeout",!1,j)},1e4);fetch(b,{signal:oe.signal}).then(Ke=>{clearTimeout(Pe),Ke.ok?Ha(z,"TestPingServer: ok",!0,j):Ha(z,"TestPingServer: server error",!1,j)}).catch(()=>{clearTimeout(Pe),Ha(z,"TestPingServer: error",!1,j)})}function Ha(b,j,z,oe,Pe){try{Pe&&(Pe.onload=null,Pe.onerror=null,Pe.onabort=null,Pe.ontimeout=null),oe(z)}catch{}}function $d(){this.g=new Xo}function ea(b,j,z){const oe=z||"";try{hi(b,function(Pe,Ke){let Tt=Pe;O(Pe)&&(Tt=Ts(Pe)),j.push(oe+Ke+"="+encodeURIComponent(Tt))})}catch(Pe){throw j.push(oe+"type="+encodeURIComponent("_badmap")),Pe}}function Bl(b){this.l=b.Ub||null,this.j=b.eb||!1}Q(Bl,ya),Bl.prototype.g=function(){return new Xc(this.l,this.j)},Bl.prototype.i=function(b){return function(){return b}}({});function Xc(b,j){Gt.call(this),this.D=b,this.o=j,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}Q(Xc,Gt),o=Xc.prototype,o.open=function(b,j){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=b,this.A=j,this.readyState=1,vo(this)},o.send=function(b){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const j={headers:this.u,method:this.B,credentials:this.m,cache:void 0};b&&(j.body=b),(this.D||w).fetch(new Request(this.A,j)).then(this.Sa.bind(this),this.ga.bind(this))},o.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,tc(this)),this.readyState=0},o.Sa=function(b){if(this.g&&(this.l=b,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=b.headers,this.readyState=2,vo(this)),this.g&&(this.readyState=3,vo(this),this.g)))if(this.responseType==="arraybuffer")b.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof w.ReadableStream<"u"&&"body"in b){if(this.j=b.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Zp(this)}else b.text().then(this.Ra.bind(this),this.ga.bind(this))};function Zp(b){b.j.read().then(b.Pa.bind(b)).catch(b.ga.bind(b))}o.Pa=function(b){if(this.g){if(this.o&&b.value)this.response.push(b.value);else if(!this.o){var j=b.value?b.value:new Uint8Array(0);(j=this.v.decode(j,{stream:!b.done}))&&(this.response=this.responseText+=j)}b.done?tc(this):vo(this),this.readyState==3&&Zp(this)}},o.Ra=function(b){this.g&&(this.response=this.responseText=b,tc(this))},o.Qa=function(b){this.g&&(this.response=b,tc(this))},o.ga=function(){this.g&&tc(this)};function tc(b){b.readyState=4,b.l=null,b.j=null,b.v=null,vo(b)}o.setRequestHeader=function(b,j){this.u.append(b,j)},o.getResponseHeader=function(b){return this.h&&this.h.get(b.toLowerCase())||""},o.getAllResponseHeaders=function(){if(!this.h)return"";const b=[],j=this.h.entries();for(var z=j.next();!z.done;)z=z.value,b.push(z[0]+": "+z[1]),z=j.next();return b.join(`\r
`)};function vo(b){b.onreadystatechange&&b.onreadystatechange.call(b)}Object.defineProperty(Xc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(b){this.m=b?"include":"same-origin"}});function ef(b){let j="";return ze(b,function(z,oe){j+=oe,j+=":",j+=z,j+=`\r
`}),j}function es(b,j,z){e:{for(oe in z){var oe=!1;break e}oe=!0}oe||(z=ef(z),typeof b=="string"?z!=null&&encodeURIComponent(String(z)):Ii(b,j,z))}function vi(b){Gt.call(this),this.headers=new Map,this.o=b||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}Q(vi,Gt);var Ra=/^https?$/i,ts=["POST","PUT"];o=vi.prototype,o.Ha=function(b){this.J=b},o.ea=function(b,j,z,oe){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+b);j=j?j.toUpperCase():"GET",this.D=b,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Jo.g(),this.v=this.o?Vc(this.o):Vc(Jo),this.g.onreadystatechange=W(this.Ea,this);try{this.B=!0,this.g.open(j,String(b),!0),this.B=!1}catch(Ke){tf(this,Ke);return}if(b=z||"",z=new Map(this.headers),oe)if(Object.getPrototypeOf(oe)===Object.prototype)for(var Pe in oe)z.set(Pe,oe[Pe]);else if(typeof oe.keys=="function"&&typeof oe.get=="function")for(const Ke of oe.keys())z.set(Ke,oe.get(Ke));else throw Error("Unknown input type for opt_headers: "+String(oe));oe=Array.from(z.keys()).find(Ke=>Ke.toLowerCase()=="content-type"),Pe=w.FormData&&b instanceof w.FormData,!(0<=Array.prototype.indexOf.call(ts,j,void 0))||oe||Pe||z.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Ke,Tt]of z)this.g.setRequestHeader(Ke,Tt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{yr(this),this.u=!0,this.g.send(b),this.u=!1}catch(Ke){tf(this,Ke)}};function tf(b,j){b.h=!1,b.g&&(b.j=!0,b.g.abort(),b.j=!1),b.l=j,b.m=5,mh(b),nc(b)}function mh(b){b.A||(b.A=!0,Me(b,"complete"),Me(b,"error"))}o.abort=function(b){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=b||7,Me(this,"complete"),Me(this,"abort"),nc(this))},o.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),nc(this,!0)),vi.aa.N.call(this)},o.Ea=function(){this.s||(this.B||this.u||this.j?_h(this):this.bb())},o.bb=function(){_h(this)};function _h(b){if(b.h&&typeof R<"u"&&(!b.v[1]||za(b)!=4||b.Z()!=2)){if(b.u&&za(b)==4)gn(b.Ea,0,b);else if(Me(b,"readystatechange"),za(b)==4){b.h=!1;try{const Tt=b.Z();e:switch(Tt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var j=!0;break e;default:j=!1}var z;if(!(z=j)){var oe;if(oe=Tt===0){var Pe=String(b.D).match(Yd)[1]||null;!Pe&&w.self&&w.self.location&&(Pe=w.self.location.protocol.slice(0,-1)),oe=!Ra.test(Pe?Pe.toLowerCase():"")}z=oe}if(z)Me(b,"complete"),Me(b,"success");else{b.m=6;try{var Ke=2<za(b)?b.g.statusText:""}catch{Ke=""}b.l=Ke+" ["+b.Z()+"]",mh(b)}}finally{nc(b)}}}}function nc(b,j){if(b.g){yr(b);const z=b.g,oe=b.v[0]?()=>{}:null;b.g=null,b.v=null,j||Me(b,"ready");try{z.onreadystatechange=oe}catch{}}}function yr(b){b.I&&(w.clearTimeout(b.I),b.I=null)}o.isActive=function(){return!!this.g};function za(b){return b.g?b.g.readyState:0}o.Z=function(){try{return 2<za(this)?this.g.status:-1}catch{return-1}},o.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},o.Oa=function(b){if(this.g){var j=this.g.responseText;return b&&j.indexOf(b)==0&&(j=j.substring(b.length)),Yo(j)}};function T_(b){try{if(!b.g)return null;if("response"in b.g)return b.g.response;switch(b.H){case"":case"text":return b.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in b.g)return b.g.mozResponseArrayBuffer}return null}catch{return null}}function Oy(b){const j={};b=(b.g&&2<=za(b)&&b.g.getAllResponseHeaders()||"").split(`\r
`);for(let oe=0;oe<b.length;oe++){if(ce(b[oe]))continue;var z=ve(b[oe]);const Pe=z[0];if(z=z[1],typeof z!="string")continue;z=z.trim();const Ke=j[Pe]||[];j[Pe]=Ke,Ke.push(z)}Z(j,function(oe){return oe.join(", ")})}o.Ba=function(){return this.m},o.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ic(b,j,z){return z&&z.internalChannelParams&&z.internalChannelParams[b]||j}function Zd(b){this.Aa=0,this.i=[],this.j=new ks,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ic("failFast",!1,b),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ic("baseRetryDelayMs",5e3,b),this.cb=ic("retryDelaySeedMs",1e4,b),this.Wa=ic("forwardChannelMaxRetries",2,b),this.wa=ic("forwardChannelRequestTimeoutMs",2e4,b),this.pa=b&&b.xmlHttpFactory||void 0,this.Xa=b&&b.Tb||void 0,this.Ca=b&&b.useFetchStreams||!1,this.L=void 0,this.J=b&&b.supportsCrossDomainXhr||!1,this.K="",this.h=new Eo(b&&b.concurrentRequestLimit),this.Da=new $d,this.P=b&&b.fastHandshake||!1,this.O=b&&b.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=b&&b.Rb||!1,b&&b.xa&&this.j.xa(),b&&b.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&b&&b.detectBufferingProxy||!1,this.ja=void 0,b&&b.longPollingTimeout&&0<b.longPollingTimeout&&(this.ja=b.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}o=Zd.prototype,o.la=8,o.G=1,o.connect=function(b,j,z,oe){zn(0),this.W=b,this.H=j||{},z&&oe!==void 0&&(this.H.OSID=z,this.H.OAID=oe),this.F=this.X,this.I=Qc(this,null,this.W),Hl(this)};function nf(b){if(R_(b),b.G==3){var j=b.U++,z=Ta(b.I);if(Ii(z,"SID",b.K),Ii(z,"RID",j),Ii(z,"TYPE","terminate"),tu(b,z),j=new Rs(b,b.j,j),j.L=2,j.v=Jd(Ta(z)),z=!1,w.navigator&&w.navigator.sendBeacon)try{z=w.navigator.sendBeacon(j.v.toString(),"")}catch{}!z&&w.Image&&(new Image().src=j.v,z=!0),z||(j.g=af(j.j,null),j.g.ea(j.v)),j.F=Date.now(),Wd(j)}A_(b)}function Gl(b){b.g&&(nu(b),b.g.cancel(),b.g=null)}function R_(b){Gl(b),b.u&&(w.clearTimeout(b.u),b.u=null),gh(b),b.h.cancel(),b.s&&(typeof b.s=="number"&&w.clearTimeout(b.s),b.s=null)}function Hl(b){if(!dh(b.h)&&!b.s){b.s=!0;var j=b.Ga;je||ge(),nt||(je(),nt=!0),Et.add(j,b),b.B=0}}function rf(b,j){return Kd(b.h)>=b.h.j-(b.s?1:0)?!1:b.s?(b.i=j.D.concat(b.i),!0):b.G==1||b.G==2||b.B>=(b.Va?0:b.Wa)?!1:(b.s=Ar(W(b.Ga,b,j),sf(b,b.B)),b.B++,!0)}o.Ga=function(b){if(this.s)if(this.s=null,this.G==1){if(!b){this.U=Math.floor(1e5*Math.random()),b=this.U++;const Pe=new Rs(this,this.j,b);let Ke=this.o;if(this.S&&(Ke?(Ke=J(Ke),fe(Ke,this.S)):Ke=this.S),this.m!==null||this.O||(Pe.H=Ke,Ke=null),this.P)e:{for(var j=0,z=0;z<this.i.length;z++){t:{var oe=this.i[z];if("__data__"in oe.map&&(oe=oe.map.__data__,typeof oe=="string")){oe=oe.length;break t}oe=void 0}if(oe===void 0)break;if(j+=oe,4096<j){j=z;break e}if(j===4096||z===this.i.length-1){j=z+1;break e}}j=1e3}else j=1e3;j=b_(this,Pe,j),z=Ta(this.I),Ii(z,"RID",b),Ii(z,"CVER",22),this.D&&Ii(z,"X-HTTP-Session-Id",this.D),tu(this,z),Ke&&(this.O?j="headers="+encodeURIComponent(String(ef(Ke)))+"&"+j:this.m&&es(z,this.m,Ke)),uh(this.h,Pe),this.Ua&&Ii(z,"TYPE","init"),this.P?(Ii(z,"$req",j),Ii(z,"SID","null"),Pe.T=!0,bs(Pe,z,null)):bs(Pe,z,j),this.G=2}}else this.G==3&&(b?eu(this,b):this.i.length==0||dh(this.h)||eu(this))};function eu(b,j){var z;j?z=j.l:z=b.U++;const oe=Ta(b.I);Ii(oe,"SID",b.K),Ii(oe,"RID",z),Ii(oe,"AID",b.T),tu(b,oe),b.m&&b.o&&es(oe,b.m,b.o),z=new Rs(b,b.j,z,b.B+1),b.m===null&&(z.H=b.o),j&&(b.i=j.D.concat(b.i)),j=b_(b,z,1e3),z.I=Math.round(.5*b.wa)+Math.round(.5*b.wa*Math.random()),uh(b.h,z),bs(z,oe,j)}function tu(b,j){b.H&&ze(b.H,function(z,oe){Ii(j,oe,z)}),b.l&&hi({},function(z,oe){Ii(j,oe,z)})}function b_(b,j,z){z=Math.min(b.i.length,z);var oe=b.l?W(b.l.Na,b.l,b):null;e:{var Pe=b.i;let Ke=-1;for(;;){const Tt=["count="+z];Ke==-1?0<z?(Ke=Pe[0].g,Tt.push("ofs="+Ke)):Ke=0:Tt.push("ofs="+Ke);let $n=!0;for(let jr=0;jr<z;jr++){let Cn=Pe[jr].g;const ns=Pe[jr].map;if(Cn-=Ke,0>Cn)Ke=Math.max(0,Pe[jr].g-100),$n=!1;else try{ea(ns,Tt,"req"+Cn+"_")}catch{oe&&oe(ns)}}if($n){oe=Tt.join("&");break e}}}return b=b.i.splice(0,z),j.D=b,oe}function rc(b){if(!b.g&&!b.u){b.Y=1;var j=b.Fa;je||ge(),nt||(je(),nt=!0),Et.add(j,b),b.v=0}}function Jc(b){return b.g||b.u||3<=b.v?!1:(b.Y++,b.u=Ar(W(b.Fa,b),sf(b,b.v)),b.v++,!0)}o.Fa=function(){if(this.u=null,C_(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var b=2*this.R;this.j.info("BP detection timer enabled: "+b),this.A=Ar(W(this.ab,this),b)}},o.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,zn(10),Gl(this),C_(this))};function nu(b){b.A!=null&&(w.clearTimeout(b.A),b.A=null)}function C_(b){b.g=new Rs(b,b.j,"rpc",b.Y),b.m===null&&(b.g.H=b.o),b.g.O=0;var j=Ta(b.qa);Ii(j,"RID","rpc"),Ii(j,"SID",b.K),Ii(j,"AID",b.T),Ii(j,"CI",b.F?"0":"1"),!b.F&&b.ja&&Ii(j,"TO",b.ja),Ii(j,"TYPE","xmlhttp"),tu(b,j),b.m&&b.o&&es(j,b.m,b.o),b.L&&(b.g.I=b.L);var z=b.g;b=b.ia,z.L=1,z.v=Jd(Ta(j)),z.m=null,z.P=!0,zc(z,b)}o.Za=function(){this.C!=null&&(this.C=null,Gl(this),Jc(this),zn(19))};function gh(b){b.C!=null&&(w.clearTimeout(b.C),b.C=null)}function w_(b,j){var z=null;if(b.g==j){gh(b),nu(b),b.g=null;var oe=2}else if(Xp(b.h,j))z=j.D,xs(b.h,j),oe=1;else return;if(b.G!=0){if(j.o)if(oe==1){z=j.m?j.m.length:0,j=Date.now()-j.F;var Pe=b.B;oe=va(),Me(oe,new Ur(oe,z)),Hl(b)}else rc(b);else if(Pe=j.s,Pe==3||Pe==0&&0<j.X||!(oe==1&&rf(b,j)||oe==2&&Jc(b)))switch(z&&0<z.length&&(j=b.h,j.i=j.i.concat(z)),Pe){case 1:ta(b,5);break;case 4:ta(b,10);break;case 3:ta(b,6);break;default:ta(b,2)}}}function sf(b,j){let z=b.Ta+Math.floor(Math.random()*b.cb);return b.isActive()||(z*=2),z*j}function ta(b,j){if(b.j.info("Error code "+j),j==2){var z=W(b.fb,b),oe=b.Xa;const Pe=!oe;oe=new Er(oe||"//www.google.com/images/cleardot.gif"),w.location&&w.location.protocol=="http"||Xd(oe,"https"),Jd(oe),Pe?Fl(oe.toString(),z):yo(oe.toString(),z)}else zn(2);b.G=0,b.l&&b.l.sa(j),A_(b),R_(b)}o.fb=function(b){b?(this.j.info("Successfully pinged google.com"),zn(2)):(this.j.info("Failed to ping google.com"),zn(1))};function A_(b){if(b.G=0,b.ka=[],b.l){const j=Zo(b.h);(j.length!=0||b.i.length!=0)&&(te(b.ka,j),te(b.ka,b.i),b.h.i.length=0,se(b.i),b.i.length=0),b.l.ra()}}function Qc(b,j,z){var oe=z instanceof Er?Ta(z):new Er(z);if(oe.g!="")j&&(oe.g=j+"."+oe.g),jl(oe,oe.s);else{var Pe=w.location;oe=Pe.protocol,j=j?j+"."+Pe.hostname:Pe.hostname,Pe=+Pe.port;var Ke=new Er(null);oe&&Xd(Ke,oe),j&&(Ke.g=j),Pe&&jl(Ke,Pe),z&&(Ke.l=z),oe=Ke}return z=b.D,j=b.ya,z&&j&&Ii(oe,z,j),Ii(oe,"VER",b.la),tu(b,oe),oe}function af(b,j,z){if(j&&!b.J)throw Error("Can't create secondary domain capable XhrIo object.");return j=b.Ca&&!b.pa?new vi(new Bl({eb:z})):new vi(b.pa),j.Ha(b.J),j}o.isActive=function(){return!!this.l&&this.l.isActive(this)};function I_(){}o=I_.prototype,o.ua=function(){},o.ta=function(){},o.sa=function(){},o.ra=function(){},o.isActive=function(){return!0},o.Na=function(){};function dn(){}dn.prototype.g=function(b,j){return new Ms(b,j)};function Ms(b,j){Gt.call(this),this.g=new Zd(j),this.l=b,this.h=j&&j.messageUrlParams||null,b=j&&j.messageHeaders||null,j&&j.clientProtocolHeaderRequired&&(b?b["X-Client-Protocol"]="webchannel":b={"X-Client-Protocol":"webchannel"}),this.g.o=b,b=j&&j.initMessageHeaders||null,j&&j.messageContentType&&(b?b["X-WebChannel-Content-Type"]=j.messageContentType:b={"X-WebChannel-Content-Type":j.messageContentType}),j&&j.va&&(b?b["X-WebChannel-Client-Profile"]=j.va:b={"X-WebChannel-Client-Profile":j.va}),this.g.S=b,(b=j&&j.Sb)&&!ce(b)&&(this.g.m=b),this.v=j&&j.supportsCrossDomainXhr||!1,this.u=j&&j.sendRawJson||!1,(j=j&&j.httpSessionIdParam)&&!ce(j)&&(this.g.D=j,b=this.h,b!==null&&j in b&&(b=this.h,j in b&&delete b[j])),this.j=new sc(this)}Q(Ms,Gt),Ms.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ms.prototype.close=function(){nf(this.g)},Ms.prototype.o=function(b){var j=this.g;if(typeof b=="string"){var z={};z.__data__=b,b=z}else this.u&&(z={},z.__data__=Ts(b),b=z);j.i.push(new E_(j.Ya++,b)),j.G==3&&Hl(j)},Ms.prototype.N=function(){this.g.l=null,delete this.j,nf(this.g),delete this.g,Ms.aa.N.call(this)};function N_(b){Fc.call(this),b.__headers__&&(this.headers=b.__headers__,this.statusCode=b.__status__,delete b.__headers__,delete b.__status__);var j=b.__sm__;if(j){e:{for(const z in j){b=z;break e}b=void 0}(this.i=b)&&(b=this.i,j=j!==null&&b in j?j[b]:void 0),this.data=j}else this.data=b}Q(N_,Fc);function O_(){Kp.call(this),this.status=1}Q(O_,Kp);function sc(b){this.g=b}Q(sc,I_),sc.prototype.ua=function(){Me(this.g,"a")},sc.prototype.ta=function(b){Me(this.g,new N_(b))},sc.prototype.sa=function(b){Me(this.g,new O_)},sc.prototype.ra=function(){Me(this.g,"b")},dn.prototype.createWebChannel=dn.prototype.g,Ms.prototype.send=Ms.prototype.o,Ms.prototype.open=Ms.prototype.m,Ms.prototype.close=Ms.prototype.close,h8=function(){return new dn},u8=function(){return va()},d8=$s,hx={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Gc.NO_ERROR=0,Gc.TIMEOUT=8,Gc.HTTP_ERROR=6,B0=Gc,Hc.COMPLETE="complete",l8=Hc,xl.EventType=Ba,Ba.OPEN="a",Ba.CLOSE="b",Ba.ERROR="c",Ba.MESSAGE="d",Gt.prototype.listen=Gt.prototype.K,WT=xl,vi.prototype.listenOnce=vi.prototype.L,vi.prototype.getLastError=vi.prototype.Ka,vi.prototype.getLastErrorCode=vi.prototype.Ba,vi.prototype.getStatus=vi.prototype.Z,vi.prototype.getResponseJson=vi.prototype.Oa,vi.prototype.getResponseText=vi.prototype.oa,vi.prototype.send=vi.prototype.ea,vi.prototype.setWithCredentials=vi.prototype.Ha,c8=vi}).apply(typeof i0<"u"?i0:typeof self<"u"?self:typeof window<"u"?window:{});const hH="@firebase/firestore",pH="4.7.11";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ma{constructor(i){this.uid=i}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(i){return i.uid===this.uid}}ma.UNAUTHENTICATED=new ma(null),ma.GOOGLE_CREDENTIALS=new ma("google-credentials-uid"),ma.FIRST_PARTY=new ma("first-party-uid"),ma.MOCK_USER=new ma("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let by="11.6.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o_=new t8("@firebase/firestore");function XE(){return o_.logLevel}function Mt(o,...i){if(o_.logLevel<=di.DEBUG){const a=i.map(t1);o_.debug(`Firestore (${by}): ${o}`,...a)}}function sh(o,...i){if(o_.logLevel<=di.ERROR){const a=i.map(t1);o_.error(`Firestore (${by}): ${o}`,...a)}}function ly(o,...i){if(o_.logLevel<=di.WARN){const a=i.map(t1);o_.warn(`Firestore (${by}): ${o}`,...a)}}function t1(o){if(typeof o=="string")return o;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(a){return JSON.stringify(a)}(o)}catch{return o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pn(o,i,a){let d="Unexpected state";typeof i=="string"?d=i:a=i,p8(o,d,a)}function p8(o,i,a){let d=`FIRESTORE (${by}) INTERNAL ASSERTION FAILED: ${i} (ID: ${o.toString(16)})`;if(a!==void 0)try{d+=" CONTEXT: "+JSON.stringify(a)}catch{d+=" CONTEXT: "+a}throw sh(d),new Error(d)}function Li(o,i,a,d){let f="Unexpected state";typeof a=="string"?f=a:d=a,o||p8(i,f,d)}function bn(o,i){return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ht={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ut extends Ry{constructor(i,a){super(i,a),this.code=i,this.message=a,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n_{constructor(){this.promise=new Promise((i,a)=>{this.resolve=i,this.reject=a})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f8{constructor(i,a){this.user=a,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${i}`)}}class Xle{getToken(){return Promise.resolve(null)}invalidateToken(){}start(i,a){i.enqueueRetryable(()=>a(ma.UNAUTHENTICATED))}shutdown(){}}class Jle{constructor(i){this.token=i,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(i,a){this.changeListener=a,i.enqueueRetryable(()=>a(this.token.user))}shutdown(){this.changeListener=null}}class Qle{constructor(i){this.t=i,this.currentUser=ma.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(i,a){Li(this.o===void 0,42304);let d=this.i;const f=N=>this.i!==d?(d=this.i,a(N)):Promise.resolve();let y=new n_;this.o=()=>{this.i++,this.currentUser=this.u(),y.resolve(),y=new n_,i.enqueueRetryable(()=>f(this.currentUser))};const R=()=>{const N=y;i.enqueueRetryable(async()=>{await N.promise,await f(this.currentUser)})},w=N=>{Mt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=N,this.o&&(this.auth.addAuthTokenListener(this.o),R())};this.t.onInit(N=>w(N)),setTimeout(()=>{if(!this.auth){const N=this.t.getImmediate({optional:!0});N?w(N):(Mt("FirebaseAuthCredentialsProvider","Auth not yet detected"),y.resolve(),y=new n_)}},0),R()}getToken(){const i=this.i,a=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(a).then(d=>this.i!==i?(Mt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):d?(Li(typeof d.accessToken=="string",31837,{l:d}),new f8(d.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const i=this.auth&&this.auth.getUid();return Li(i===null||typeof i=="string",2055,{h:i}),new ma(i)}}class $le{constructor(i,a,d){this.P=i,this.T=a,this.I=d,this.type="FirstParty",this.user=ma.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const i=this.R();return i&&this.A.set("Authorization",i),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Zle{constructor(i,a,d){this.P=i,this.T=a,this.I=d}getToken(){return Promise.resolve(new $le(this.P,this.T,this.I))}start(i,a){i.enqueueRetryable(()=>a(ma.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class fH{constructor(i){this.value=i,this.type="AppCheck",this.headers=new Map,i&&i.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ede{constructor(i,a){this.V=a,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,kle(i)&&i.settings.appCheckToken&&(this.p=i.settings.appCheckToken)}start(i,a){Li(this.o===void 0,3512);const d=y=>{y.error!=null&&Mt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${y.error.message}`);const R=y.token!==this.m;return this.m=y.token,Mt("FirebaseAppCheckTokenProvider",`Received ${R?"new":"existing"} token.`),R?a(y.token):Promise.resolve()};this.o=y=>{i.enqueueRetryable(()=>d(y))};const f=y=>{Mt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=y,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(y=>f(y)),setTimeout(()=>{if(!this.appCheck){const y=this.V.getImmediate({optional:!0});y?f(y):Mt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new fH(this.p));const i=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(i).then(a=>a?(Li(typeof a.token=="string",44558,{tokenResult:a}),this.m=a.token,new fH(a.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tde(o){const i=typeof self<"u"&&(self.crypto||self.msCrypto),a=new Uint8Array(o);if(i&&typeof i.getRandomValues=="function")i.getRandomValues(a);else for(let d=0;d<o;d++)a[d]=Math.floor(256*Math.random());return a}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m8(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _8{static newId(){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=62*Math.floor(4.129032258064516);let d="";for(;d.length<20;){const f=tde(40);for(let y=0;y<f.length;++y)d.length<20&&f[y]<a&&(d+=i.charAt(f[y]%62))}return d}}function Kn(o,i){return o<i?-1:o>i?1:0}function px(o,i){let a=0;for(;a<o.length&&a<i.length;){const d=o.codePointAt(a),f=i.codePointAt(a);if(d!==f){if(d<128&&f<128)return Kn(d,f);{const y=m8(),R=nde(y.encode(mH(o,a)),y.encode(mH(i,a)));return R!==0?R:Kn(d,f)}}a+=d>65535?2:1}return Kn(o.length,i.length)}function mH(o,i){return o.codePointAt(i)>65535?o.substring(i,i+2):o.substring(i,i+1)}function nde(o,i){for(let a=0;a<o.length&&a<i.length;++a)if(o[a]!==i[a])return Kn(o[a],i[a]);return Kn(o.length,i.length)}function dy(o,i,a){return o.length===i.length&&o.every((d,f)=>a(d,i[f]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _H=-62135596800,gH=1e6;class vs{static now(){return vs.fromMillis(Date.now())}static fromDate(i){return vs.fromMillis(i.getTime())}static fromMillis(i){const a=Math.floor(i/1e3),d=Math.floor((i-1e3*a)*gH);return new vs(a,d)}constructor(i,a){if(this.seconds=i,this.nanoseconds=a,a<0)throw new Ut(ht.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+a);if(a>=1e9)throw new Ut(ht.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+a);if(i<_H)throw new Ut(ht.INVALID_ARGUMENT,"Timestamp seconds out of range: "+i);if(i>=253402300800)throw new Ut(ht.INVALID_ARGUMENT,"Timestamp seconds out of range: "+i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/gH}_compareTo(i){return this.seconds===i.seconds?Kn(this.nanoseconds,i.nanoseconds):Kn(this.seconds,i.seconds)}isEqual(i){return i.seconds===this.seconds&&i.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const i=this.seconds-_H;return String(i).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tn{static fromTimestamp(i){return new Tn(i)}static min(){return new Tn(new vs(0,0))}static max(){return new Tn(new vs(253402300799,999999999))}constructor(i){this.timestamp=i}compareTo(i){return this.timestamp._compareTo(i.timestamp)}isEqual(i){return this.timestamp.isEqual(i.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EH="__name__";class jd{constructor(i,a,d){a===void 0?a=0:a>i.length&&pn(637,{offset:a,range:i.length}),d===void 0?d=i.length-a:d>i.length-a&&pn(1746,{length:d,range:i.length-a}),this.segments=i,this.offset=a,this.len=d}get length(){return this.len}isEqual(i){return jd.comparator(this,i)===0}child(i){const a=this.segments.slice(this.offset,this.limit());return i instanceof jd?i.forEach(d=>{a.push(d)}):a.push(i),this.construct(a)}limit(){return this.offset+this.length}popFirst(i){return i=i===void 0?1:i,this.construct(this.segments,this.offset+i,this.length-i)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(i){return this.segments[this.offset+i]}isEmpty(){return this.length===0}isPrefixOf(i){if(i.length<this.length)return!1;for(let a=0;a<this.length;a++)if(this.get(a)!==i.get(a))return!1;return!0}isImmediateParentOf(i){if(this.length+1!==i.length)return!1;for(let a=0;a<this.length;a++)if(this.get(a)!==i.get(a))return!1;return!0}forEach(i){for(let a=this.offset,d=this.limit();a<d;a++)i(this.segments[a])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(i,a){const d=Math.min(i.length,a.length);for(let f=0;f<d;f++){const y=jd.compareSegments(i.get(f),a.get(f));if(y!==0)return y}return Kn(i.length,a.length)}static compareSegments(i,a){const d=jd.isNumericId(i),f=jd.isNumericId(a);return d&&!f?-1:!d&&f?1:d&&f?jd.extractNumericId(i).compare(jd.extractNumericId(a)):px(i,a)}static isNumericId(i){return i.startsWith("__id")&&i.endsWith("__")}static extractNumericId(i){return Mp.fromString(i.substring(4,i.length-2))}}class or extends jd{construct(i,a,d){return new or(i,a,d)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...i){const a=[];for(const d of i){if(d.indexOf("//")>=0)throw new Ut(ht.INVALID_ARGUMENT,`Invalid segment (${d}). Paths must not contain // in them.`);a.push(...d.split("/").filter(f=>f.length>0))}return new or(a)}static emptyPath(){return new or([])}}const ide=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Xs extends jd{construct(i,a,d){return new Xs(i,a,d)}static isValidIdentifier(i){return ide.test(i)}canonicalString(){return this.toArray().map(i=>(i=i.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Xs.isValidIdentifier(i)||(i="`"+i+"`"),i)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===EH}static keyField(){return new Xs([EH])}static fromServerFormat(i){const a=[];let d="",f=0;const y=()=>{if(d.length===0)throw new Ut(ht.INVALID_ARGUMENT,`Invalid field path (${i}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);a.push(d),d=""};let R=!1;for(;f<i.length;){const w=i[f];if(w==="\\"){if(f+1===i.length)throw new Ut(ht.INVALID_ARGUMENT,"Path has trailing escape character: "+i);const N=i[f+1];if(N!=="\\"&&N!=="."&&N!=="`")throw new Ut(ht.INVALID_ARGUMENT,"Path has invalid escape sequence: "+i);d+=N,f+=2}else w==="`"?(R=!R,f++):w!=="."||R?(d+=w,f++):(y(),f++)}if(y(),R)throw new Ut(ht.INVALID_ARGUMENT,"Unterminated ` in path: "+i);return new Xs(a)}static emptyPath(){return new Xs([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{constructor(i){this.path=i}static fromPath(i){return new Qt(or.fromString(i))}static fromName(i){return new Qt(or.fromString(i).popFirst(5))}static empty(){return new Qt(or.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(i){return this.path.length>=2&&this.path.get(this.path.length-2)===i}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(i){return i!==null&&or.comparator(this.path,i.path)===0}toString(){return this.path.toString()}static comparator(i,a){return or.comparator(i.path,a.path)}static isDocumentKey(i){return i.length%2==0}static fromSegments(i){return new Qt(new or(i.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fR=-1;function rde(o,i){const a=o.toTimestamp().seconds,d=o.toTimestamp().nanoseconds+1,f=Tn.fromTimestamp(d===1e9?new vs(a+1,0):new vs(a,d));return new Vp(f,Qt.empty(),i)}function sde(o){return new Vp(o.readTime,o.key,fR)}class Vp{constructor(i,a,d){this.readTime=i,this.documentKey=a,this.largestBatchId=d}static min(){return new Vp(Tn.min(),Qt.empty(),fR)}static max(){return new Vp(Tn.max(),Qt.empty(),fR)}}function ade(o,i){let a=o.readTime.compareTo(i.readTime);return a!==0?a:(a=Qt.comparator(o.documentKey,i.documentKey),a!==0?a:Kn(o.largestBatchId,i.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ode="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class cde{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(i){this.onCommittedListeners.push(i)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(i=>i())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cy(o){if(o.code!==ht.FAILED_PRECONDITION||o.message!==ode)throw o;Mt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pt{constructor(i){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,i(a=>{this.isDone=!0,this.result=a,this.nextCallback&&this.nextCallback(a)},a=>{this.isDone=!0,this.error=a,this.catchCallback&&this.catchCallback(a)})}catch(i){return this.next(void 0,i)}next(i,a){return this.callbackAttached&&pn(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(a,this.error):this.wrapSuccess(i,this.result):new pt((d,f)=>{this.nextCallback=y=>{this.wrapSuccess(i,y).next(d,f)},this.catchCallback=y=>{this.wrapFailure(a,y).next(d,f)}})}toPromise(){return new Promise((i,a)=>{this.next(i,a)})}wrapUserFunction(i){try{const a=i();return a instanceof pt?a:pt.resolve(a)}catch(a){return pt.reject(a)}}wrapSuccess(i,a){return i?this.wrapUserFunction(()=>i(a)):pt.resolve(a)}wrapFailure(i,a){return i?this.wrapUserFunction(()=>i(a)):pt.reject(a)}static resolve(i){return new pt((a,d)=>{a(i)})}static reject(i){return new pt((a,d)=>{d(i)})}static waitFor(i){return new pt((a,d)=>{let f=0,y=0,R=!1;i.forEach(w=>{++f,w.next(()=>{++y,R&&y===f&&a()},N=>d(N))}),R=!0,y===f&&a()})}static or(i){let a=pt.resolve(!1);for(const d of i)a=a.next(f=>f?pt.resolve(f):d());return a}static forEach(i,a){const d=[];return i.forEach((f,y)=>{d.push(a.call(this,f,y))}),this.waitFor(d)}static mapArray(i,a){return new pt((d,f)=>{const y=i.length,R=new Array(y);let w=0;for(let N=0;N<y;N++){const O=N;a(i[O]).next(x=>{R[O]=x,++w,w===y&&d(R)},x=>f(x))}})}static doWhile(i,a){return new pt((d,f)=>{const y=()=>{i()===!0?a().next(()=>{y()},f):d()};y()})}}function lde(o){const i=o.match(/Android ([\d.]+)/i),a=i?i[1].split(".").slice(0,2).join("."):"-1";return Number(a)}function wy(o){return o.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HI{constructor(i,a){this.previousValue=i,a&&(a.sequenceNumberHandler=d=>this.ue(d),this.ce=d=>a.writeSequenceNumber(d))}ue(i){return this.previousValue=Math.max(i,this.previousValue),this.previousValue}next(){const i=++this.previousValue;return this.ce&&this.ce(i),i}}HI.le=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n1=-1;function zI(o){return o==null}function dI(o){return o===0&&1/o==-1/0}function dde(o){return typeof o=="number"&&Number.isInteger(o)&&!dI(o)&&o<=Number.MAX_SAFE_INTEGER&&o>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g8="";function ude(o){let i="";for(let a=0;a<o.length;a++)i.length>0&&(i=yH(i)),i=hde(o.get(a),i);return yH(i)}function hde(o,i){let a=i;const d=o.length;for(let f=0;f<d;f++){const y=o.charAt(f);switch(y){case"\0":a+="";break;case g8:a+="";break;default:a+=y}}return a}function yH(o){return o+g8+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vH(o){let i=0;for(const a in o)Object.prototype.hasOwnProperty.call(o,a)&&i++;return i}function Wp(o,i){for(const a in o)Object.prototype.hasOwnProperty.call(o,a)&&i(a,o[a])}function E8(o){for(const i in o)if(Object.prototype.hasOwnProperty.call(o,i))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr{constructor(i,a){this.comparator=i,this.root=a||Ys.EMPTY}insert(i,a){return new wr(this.comparator,this.root.insert(i,a,this.comparator).copy(null,null,Ys.BLACK,null,null))}remove(i){return new wr(this.comparator,this.root.remove(i,this.comparator).copy(null,null,Ys.BLACK,null,null))}get(i){let a=this.root;for(;!a.isEmpty();){const d=this.comparator(i,a.key);if(d===0)return a.value;d<0?a=a.left:d>0&&(a=a.right)}return null}indexOf(i){let a=0,d=this.root;for(;!d.isEmpty();){const f=this.comparator(i,d.key);if(f===0)return a+d.left.size;f<0?d=d.left:(a+=d.left.size+1,d=d.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(i){return this.root.inorderTraversal(i)}forEach(i){this.inorderTraversal((a,d)=>(i(a,d),!1))}toString(){const i=[];return this.inorderTraversal((a,d)=>(i.push(`${a}:${d}`),!1)),`{${i.join(", ")}}`}reverseTraversal(i){return this.root.reverseTraversal(i)}getIterator(){return new r0(this.root,null,this.comparator,!1)}getIteratorFrom(i){return new r0(this.root,i,this.comparator,!1)}getReverseIterator(){return new r0(this.root,null,this.comparator,!0)}getReverseIteratorFrom(i){return new r0(this.root,i,this.comparator,!0)}}class r0{constructor(i,a,d,f){this.isReverse=f,this.nodeStack=[];let y=1;for(;!i.isEmpty();)if(y=a?d(i.key,a):1,a&&f&&(y*=-1),y<0)i=this.isReverse?i.left:i.right;else{if(y===0){this.nodeStack.push(i);break}this.nodeStack.push(i),i=this.isReverse?i.right:i.left}}getNext(){let i=this.nodeStack.pop();const a={key:i.key,value:i.value};if(this.isReverse)for(i=i.left;!i.isEmpty();)this.nodeStack.push(i),i=i.right;else for(i=i.right;!i.isEmpty();)this.nodeStack.push(i),i=i.left;return a}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const i=this.nodeStack[this.nodeStack.length-1];return{key:i.key,value:i.value}}}class Ys{constructor(i,a,d,f,y){this.key=i,this.value=a,this.color=d??Ys.RED,this.left=f??Ys.EMPTY,this.right=y??Ys.EMPTY,this.size=this.left.size+1+this.right.size}copy(i,a,d,f,y){return new Ys(i??this.key,a??this.value,d??this.color,f??this.left,y??this.right)}isEmpty(){return!1}inorderTraversal(i){return this.left.inorderTraversal(i)||i(this.key,this.value)||this.right.inorderTraversal(i)}reverseTraversal(i){return this.right.reverseTraversal(i)||i(this.key,this.value)||this.left.reverseTraversal(i)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(i,a,d){let f=this;const y=d(i,f.key);return f=y<0?f.copy(null,null,null,f.left.insert(i,a,d),null):y===0?f.copy(null,a,null,null,null):f.copy(null,null,null,null,f.right.insert(i,a,d)),f.fixUp()}removeMin(){if(this.left.isEmpty())return Ys.EMPTY;let i=this;return i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.removeMin(),null),i.fixUp()}remove(i,a){let d,f=this;if(a(i,f.key)<0)f.left.isEmpty()||f.left.isRed()||f.left.left.isRed()||(f=f.moveRedLeft()),f=f.copy(null,null,null,f.left.remove(i,a),null);else{if(f.left.isRed()&&(f=f.rotateRight()),f.right.isEmpty()||f.right.isRed()||f.right.left.isRed()||(f=f.moveRedRight()),a(i,f.key)===0){if(f.right.isEmpty())return Ys.EMPTY;d=f.right.min(),f=f.copy(d.key,d.value,null,null,f.right.removeMin())}f=f.copy(null,null,null,null,f.right.remove(i,a))}return f.fixUp()}isRed(){return this.color}fixUp(){let i=this;return i.right.isRed()&&!i.left.isRed()&&(i=i.rotateLeft()),i.left.isRed()&&i.left.left.isRed()&&(i=i.rotateRight()),i.left.isRed()&&i.right.isRed()&&(i=i.colorFlip()),i}moveRedLeft(){let i=this.colorFlip();return i.right.left.isRed()&&(i=i.copy(null,null,null,null,i.right.rotateRight()),i=i.rotateLeft(),i=i.colorFlip()),i}moveRedRight(){let i=this.colorFlip();return i.left.left.isRed()&&(i=i.rotateRight(),i=i.colorFlip()),i}rotateLeft(){const i=this.copy(null,null,Ys.RED,null,this.right.left);return this.right.copy(null,null,this.color,i,null)}rotateRight(){const i=this.copy(null,null,Ys.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,i)}colorFlip(){const i=this.left.copy(null,null,!this.left.color,null,null),a=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,i,a)}checkMaxDepth(){const i=this.check();return Math.pow(2,i)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw pn(43730,{key:this.key,value:this.value});if(this.right.isRed())throw pn(14113,{key:this.key,value:this.value});const i=this.left.check();if(i!==this.right.check())throw pn(27949);return i+(this.isRed()?0:1)}}Ys.EMPTY=null,Ys.RED=!0,Ys.BLACK=!1;Ys.EMPTY=new class{constructor(){this.size=0}get key(){throw pn(57766)}get value(){throw pn(16141)}get color(){throw pn(16727)}get left(){throw pn(29726)}get right(){throw pn(36894)}copy(i,a,d,f,y){return this}insert(i,a,d){return new Ys(i,a)}remove(i,a){return this}isEmpty(){return!0}inorderTraversal(i){return!1}reverseTraversal(i){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss{constructor(i){this.comparator=i,this.data=new wr(this.comparator)}has(i){return this.data.get(i)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(i){return this.data.indexOf(i)}forEach(i){this.data.inorderTraversal((a,d)=>(i(a),!1))}forEachInRange(i,a){const d=this.data.getIteratorFrom(i[0]);for(;d.hasNext();){const f=d.getNext();if(this.comparator(f.key,i[1])>=0)return;a(f.key)}}forEachWhile(i,a){let d;for(d=a!==void 0?this.data.getIteratorFrom(a):this.data.getIterator();d.hasNext();)if(!i(d.getNext().key))return}firstAfterOrEqual(i){const a=this.data.getIteratorFrom(i);return a.hasNext()?a.getNext().key:null}getIterator(){return new SH(this.data.getIterator())}getIteratorFrom(i){return new SH(this.data.getIteratorFrom(i))}add(i){return this.copy(this.data.remove(i).insert(i,!0))}delete(i){return this.has(i)?this.copy(this.data.remove(i)):this}isEmpty(){return this.data.isEmpty()}unionWith(i){let a=this;return a.size<i.size&&(a=i,i=this),i.forEach(d=>{a=a.add(d)}),a}isEqual(i){if(!(i instanceof Ss)||this.size!==i.size)return!1;const a=this.data.getIterator(),d=i.data.getIterator();for(;a.hasNext();){const f=a.getNext().key,y=d.getNext().key;if(this.comparator(f,y)!==0)return!1}return!0}toArray(){const i=[];return this.forEach(a=>{i.push(a)}),i}toString(){const i=[];return this.forEach(a=>i.push(a)),"SortedSet("+i.toString()+")"}copy(i){const a=new Ss(this.comparator);return a.data=i,a}}class SH{constructor(i){this.iter=i}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Go{constructor(i){this.fields=i,i.sort(Xs.comparator)}static empty(){return new Go([])}unionWith(i){let a=new Ss(Xs.comparator);for(const d of this.fields)a=a.add(d);for(const d of i)a=a.add(d);return new Go(a.toArray())}covers(i){for(const a of this.fields)if(a.isPrefixOf(i))return!0;return!1}isEqual(i){return dy(this.fields,i.fields,(a,d)=>a.isEqual(d))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y8 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js{constructor(i){this.binaryString=i}static fromBase64String(i){const a=function(f){try{return atob(f)}catch(y){throw typeof DOMException<"u"&&y instanceof DOMException?new y8("Invalid base64 string: "+y):y}}(i);return new Js(a)}static fromUint8Array(i){const a=function(f){let y="";for(let R=0;R<f.length;++R)y+=String.fromCharCode(f[R]);return y}(i);return new Js(a)}[Symbol.iterator](){let i=0;return{next:()=>i<this.binaryString.length?{value:this.binaryString.charCodeAt(i++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(a){return btoa(a)}(this.binaryString)}toUint8Array(){return function(a){const d=new Uint8Array(a.length);for(let f=0;f<a.length;f++)d[f]=a.charCodeAt(f);return d}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(i){return Kn(this.binaryString,i.binaryString)}isEqual(i){return this.binaryString===i.binaryString}}Js.EMPTY_BYTE_STRING=new Js("");const pde=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Fp(o){if(Li(!!o,39018),typeof o=="string"){let i=0;const a=pde.exec(o);if(Li(!!a,46558,{timestamp:o}),a[1]){let f=a[1];f=(f+"000000000").substr(0,9),i=Number(f)}const d=new Date(o);return{seconds:Math.floor(d.getTime()/1e3),nanos:i}}return{seconds:Xr(o.seconds),nanos:Xr(o.nanos)}}function Xr(o){return typeof o=="number"?o:typeof o=="string"?Number(o):0}function Bp(o){return typeof o=="string"?Js.fromBase64String(o):Js.fromUint8Array(o)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v8="server_timestamp",S8="__type__",T8="__previous_value__",R8="__local_write_time__";function i1(o){var i,a;return((a=(((i=o==null?void 0:o.mapValue)===null||i===void 0?void 0:i.fields)||{})[S8])===null||a===void 0?void 0:a.stringValue)===v8}function WI(o){const i=o.mapValue.fields[T8];return i1(i)?WI(i):i}function mR(o){const i=Fp(o.mapValue.fields[R8].timestampValue);return new vs(i.seconds,i.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fde{constructor(i,a,d,f,y,R,w,N,O){this.databaseId=i,this.appId=a,this.persistenceKey=d,this.host=f,this.ssl=y,this.forceLongPolling=R,this.autoDetectLongPolling=w,this.longPollingOptions=N,this.useFetchStreams=O}}const uI="(default)";class _R{constructor(i,a){this.projectId=i,this.database=a||uI}static empty(){return new _R("","")}get isDefaultDatabase(){return this.database===uI}isEqual(i){return i instanceof _R&&i.projectId===this.projectId&&i.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b8="__type__",mde="__max__",s0={mapValue:{}},C8="__vector__",hI="value";function Gp(o){return"nullValue"in o?0:"booleanValue"in o?1:"integerValue"in o||"doubleValue"in o?2:"timestampValue"in o?3:"stringValue"in o?5:"bytesValue"in o?6:"referenceValue"in o?7:"geoPointValue"in o?8:"arrayValue"in o?9:"mapValue"in o?i1(o)?4:gde(o)?9007199254740991:_de(o)?10:11:pn(28295,{value:o})}function Bd(o,i){if(o===i)return!0;const a=Gp(o);if(a!==Gp(i))return!1;switch(a){case 0:case 9007199254740991:return!0;case 1:return o.booleanValue===i.booleanValue;case 4:return mR(o).isEqual(mR(i));case 3:return function(f,y){if(typeof f.timestampValue=="string"&&typeof y.timestampValue=="string"&&f.timestampValue.length===y.timestampValue.length)return f.timestampValue===y.timestampValue;const R=Fp(f.timestampValue),w=Fp(y.timestampValue);return R.seconds===w.seconds&&R.nanos===w.nanos}(o,i);case 5:return o.stringValue===i.stringValue;case 6:return function(f,y){return Bp(f.bytesValue).isEqual(Bp(y.bytesValue))}(o,i);case 7:return o.referenceValue===i.referenceValue;case 8:return function(f,y){return Xr(f.geoPointValue.latitude)===Xr(y.geoPointValue.latitude)&&Xr(f.geoPointValue.longitude)===Xr(y.geoPointValue.longitude)}(o,i);case 2:return function(f,y){if("integerValue"in f&&"integerValue"in y)return Xr(f.integerValue)===Xr(y.integerValue);if("doubleValue"in f&&"doubleValue"in y){const R=Xr(f.doubleValue),w=Xr(y.doubleValue);return R===w?dI(R)===dI(w):isNaN(R)&&isNaN(w)}return!1}(o,i);case 9:return dy(o.arrayValue.values||[],i.arrayValue.values||[],Bd);case 10:case 11:return function(f,y){const R=f.mapValue.fields||{},w=y.mapValue.fields||{};if(vH(R)!==vH(w))return!1;for(const N in R)if(R.hasOwnProperty(N)&&(w[N]===void 0||!Bd(R[N],w[N])))return!1;return!0}(o,i);default:return pn(52216,{left:o})}}function gR(o,i){return(o.values||[]).find(a=>Bd(a,i))!==void 0}function uy(o,i){if(o===i)return 0;const a=Gp(o),d=Gp(i);if(a!==d)return Kn(a,d);switch(a){case 0:case 9007199254740991:return 0;case 1:return Kn(o.booleanValue,i.booleanValue);case 2:return function(y,R){const w=Xr(y.integerValue||y.doubleValue),N=Xr(R.integerValue||R.doubleValue);return w<N?-1:w>N?1:w===N?0:isNaN(w)?isNaN(N)?0:-1:1}(o,i);case 3:return TH(o.timestampValue,i.timestampValue);case 4:return TH(mR(o),mR(i));case 5:return px(o.stringValue,i.stringValue);case 6:return function(y,R){const w=Bp(y),N=Bp(R);return w.compareTo(N)}(o.bytesValue,i.bytesValue);case 7:return function(y,R){const w=y.split("/"),N=R.split("/");for(let O=0;O<w.length&&O<N.length;O++){const x=Kn(w[O],N[O]);if(x!==0)return x}return Kn(w.length,N.length)}(o.referenceValue,i.referenceValue);case 8:return function(y,R){const w=Kn(Xr(y.latitude),Xr(R.latitude));return w!==0?w:Kn(Xr(y.longitude),Xr(R.longitude))}(o.geoPointValue,i.geoPointValue);case 9:return RH(o.arrayValue,i.arrayValue);case 10:return function(y,R){var w,N,O,x;const G=y.fields||{},W=R.fields||{},ne=(w=G[hI])===null||w===void 0?void 0:w.arrayValue,Q=(N=W[hI])===null||N===void 0?void 0:N.arrayValue,se=Kn(((O=ne==null?void 0:ne.values)===null||O===void 0?void 0:O.length)||0,((x=Q==null?void 0:Q.values)===null||x===void 0?void 0:x.length)||0);return se!==0?se:RH(ne,Q)}(o.mapValue,i.mapValue);case 11:return function(y,R){if(y===s0.mapValue&&R===s0.mapValue)return 0;if(y===s0.mapValue)return 1;if(R===s0.mapValue)return-1;const w=y.fields||{},N=Object.keys(w),O=R.fields||{},x=Object.keys(O);N.sort(),x.sort();for(let G=0;G<N.length&&G<x.length;++G){const W=px(N[G],x[G]);if(W!==0)return W;const ne=uy(w[N[G]],O[x[G]]);if(ne!==0)return ne}return Kn(N.length,x.length)}(o.mapValue,i.mapValue);default:throw pn(23264,{Pe:a})}}function TH(o,i){if(typeof o=="string"&&typeof i=="string"&&o.length===i.length)return Kn(o,i);const a=Fp(o),d=Fp(i),f=Kn(a.seconds,d.seconds);return f!==0?f:Kn(a.nanos,d.nanos)}function RH(o,i){const a=o.values||[],d=i.values||[];for(let f=0;f<a.length&&f<d.length;++f){const y=uy(a[f],d[f]);if(y)return y}return Kn(a.length,d.length)}function hy(o){return fx(o)}function fx(o){return"nullValue"in o?"null":"booleanValue"in o?""+o.booleanValue:"integerValue"in o?""+o.integerValue:"doubleValue"in o?""+o.doubleValue:"timestampValue"in o?function(a){const d=Fp(a);return`time(${d.seconds},${d.nanos})`}(o.timestampValue):"stringValue"in o?o.stringValue:"bytesValue"in o?function(a){return Bp(a).toBase64()}(o.bytesValue):"referenceValue"in o?function(a){return Qt.fromName(a).toString()}(o.referenceValue):"geoPointValue"in o?function(a){return`geo(${a.latitude},${a.longitude})`}(o.geoPointValue):"arrayValue"in o?function(a){let d="[",f=!0;for(const y of a.values||[])f?f=!1:d+=",",d+=fx(y);return d+"]"}(o.arrayValue):"mapValue"in o?function(a){const d=Object.keys(a.fields||{}).sort();let f="{",y=!0;for(const R of d)y?y=!1:f+=",",f+=`${R}:${fx(a.fields[R])}`;return f+"}"}(o.mapValue):pn(61005,{value:o})}function G0(o){switch(Gp(o)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const i=WI(o);return i?16+G0(i):16;case 5:return 2*o.stringValue.length;case 6:return Bp(o.bytesValue).approximateByteSize();case 7:return o.referenceValue.length;case 9:return function(d){return(d.values||[]).reduce((f,y)=>f+G0(y),0)}(o.arrayValue);case 10:case 11:return function(d){let f=0;return Wp(d.fields,(y,R)=>{f+=y.length+G0(R)}),f}(o.mapValue);default:throw pn(13486,{value:o})}}function bH(o,i){return{referenceValue:`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`}}function mx(o){return!!o&&"integerValue"in o}function r1(o){return!!o&&"arrayValue"in o}function CH(o){return!!o&&"nullValue"in o}function wH(o){return!!o&&"doubleValue"in o&&isNaN(Number(o.doubleValue))}function H0(o){return!!o&&"mapValue"in o}function _de(o){var i,a;return((a=(((i=o==null?void 0:o.mapValue)===null||i===void 0?void 0:i.fields)||{})[b8])===null||a===void 0?void 0:a.stringValue)===C8}function iR(o){if(o.geoPointValue)return{geoPointValue:Object.assign({},o.geoPointValue)};if(o.timestampValue&&typeof o.timestampValue=="object")return{timestampValue:Object.assign({},o.timestampValue)};if(o.mapValue){const i={mapValue:{fields:{}}};return Wp(o.mapValue.fields,(a,d)=>i.mapValue.fields[a]=iR(d)),i}if(o.arrayValue){const i={arrayValue:{values:[]}};for(let a=0;a<(o.arrayValue.values||[]).length;++a)i.arrayValue.values[a]=iR(o.arrayValue.values[a]);return i}return Object.assign({},o)}function gde(o){return(((o.mapValue||{}).fields||{}).__type__||{}).stringValue===mde}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fo{constructor(i){this.value=i}static empty(){return new fo({mapValue:{}})}field(i){if(i.isEmpty())return this.value;{let a=this.value;for(let d=0;d<i.length-1;++d)if(a=(a.mapValue.fields||{})[i.get(d)],!H0(a))return null;return a=(a.mapValue.fields||{})[i.lastSegment()],a||null}}set(i,a){this.getFieldsMap(i.popLast())[i.lastSegment()]=iR(a)}setAll(i){let a=Xs.emptyPath(),d={},f=[];i.forEach((R,w)=>{if(!a.isImmediateParentOf(w)){const N=this.getFieldsMap(a);this.applyChanges(N,d,f),d={},f=[],a=w.popLast()}R?d[w.lastSegment()]=iR(R):f.push(w.lastSegment())});const y=this.getFieldsMap(a);this.applyChanges(y,d,f)}delete(i){const a=this.field(i.popLast());H0(a)&&a.mapValue.fields&&delete a.mapValue.fields[i.lastSegment()]}isEqual(i){return Bd(this.value,i.value)}getFieldsMap(i){let a=this.value;a.mapValue.fields||(a.mapValue={fields:{}});for(let d=0;d<i.length;++d){let f=a.mapValue.fields[i.get(d)];H0(f)&&f.mapValue.fields||(f={mapValue:{fields:{}}},a.mapValue.fields[i.get(d)]=f),a=f}return a.mapValue.fields}applyChanges(i,a,d){Wp(a,(f,y)=>i[f]=y);for(const f of d)delete i[f]}clone(){return new fo(iR(this.value))}}function w8(o){const i=[];return Wp(o.fields,(a,d)=>{const f=new Xs([a]);if(H0(d)){const y=w8(d.mapValue).fields;if(y.length===0)i.push(f);else for(const R of y)i.push(f.child(R))}else i.push(f)}),new Go(i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{constructor(i,a,d,f,y,R,w){this.key=i,this.documentType=a,this.version=d,this.readTime=f,this.createTime=y,this.data=R,this.documentState=w}static newInvalidDocument(i){return new _a(i,0,Tn.min(),Tn.min(),Tn.min(),fo.empty(),0)}static newFoundDocument(i,a,d,f){return new _a(i,1,a,Tn.min(),d,f,0)}static newNoDocument(i,a){return new _a(i,2,a,Tn.min(),Tn.min(),fo.empty(),0)}static newUnknownDocument(i,a){return new _a(i,3,a,Tn.min(),Tn.min(),fo.empty(),2)}convertToFoundDocument(i,a){return!this.createTime.isEqual(Tn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=i),this.version=i,this.documentType=1,this.data=a,this.documentState=0,this}convertToNoDocument(i){return this.version=i,this.documentType=2,this.data=fo.empty(),this.documentState=0,this}convertToUnknownDocument(i){return this.version=i,this.documentType=3,this.data=fo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Tn.min(),this}setReadTime(i){return this.readTime=i,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(i){return i instanceof _a&&this.key.isEqual(i.key)&&this.version.isEqual(i.version)&&this.documentType===i.documentType&&this.documentState===i.documentState&&this.data.isEqual(i.data)}mutableCopy(){return new _a(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pI{constructor(i,a){this.position=i,this.inclusive=a}}function AH(o,i,a){let d=0;for(let f=0;f<o.position.length;f++){const y=i[f],R=o.position[f];if(y.field.isKeyField()?d=Qt.comparator(Qt.fromName(R.referenceValue),a.key):d=uy(R,a.data.field(y.field)),y.dir==="desc"&&(d*=-1),d!==0)break}return d}function IH(o,i){if(o===null)return i===null;if(i===null||o.inclusive!==i.inclusive||o.position.length!==i.position.length)return!1;for(let a=0;a<o.position.length;a++)if(!Bd(o.position[a],i.position[a]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ER{constructor(i,a="asc"){this.field=i,this.dir=a}}function Ede(o,i){return o.dir===i.dir&&o.field.isEqual(i.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A8{}class us extends A8{constructor(i,a,d){super(),this.field=i,this.op=a,this.value=d}static create(i,a,d){return i.isKeyField()?a==="in"||a==="not-in"?this.createKeyFieldInFilter(i,a,d):new vde(i,a,d):a==="array-contains"?new Rde(i,d):a==="in"?new bde(i,d):a==="not-in"?new Cde(i,d):a==="array-contains-any"?new wde(i,d):new us(i,a,d)}static createKeyFieldInFilter(i,a,d){return a==="in"?new Sde(i,d):new Tde(i,d)}matches(i){const a=i.data.field(this.field);return this.op==="!="?a!==null&&a.nullValue===void 0&&this.matchesComparison(uy(a,this.value)):a!==null&&Gp(this.value)===Gp(a)&&this.matchesComparison(uy(a,this.value))}matchesComparison(i){switch(this.op){case"<":return i<0;case"<=":return i<=0;case"==":return i===0;case"!=":return i!==0;case">":return i>0;case">=":return i>=0;default:return pn(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Pl extends A8{constructor(i,a){super(),this.filters=i,this.op=a,this.Te=null}static create(i,a){return new Pl(i,a)}matches(i){return I8(this)?this.filters.find(a=>!a.matches(i))===void 0:this.filters.find(a=>a.matches(i))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((i,a)=>i.concat(a.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function I8(o){return o.op==="and"}function N8(o){return yde(o)&&I8(o)}function yde(o){for(const i of o.filters)if(i instanceof Pl)return!1;return!0}function _x(o){if(o instanceof us)return o.field.canonicalString()+o.op.toString()+hy(o.value);if(N8(o))return o.filters.map(i=>_x(i)).join(",");{const i=o.filters.map(a=>_x(a)).join(",");return`${o.op}(${i})`}}function O8(o,i){return o instanceof us?function(d,f){return f instanceof us&&d.op===f.op&&d.field.isEqual(f.field)&&Bd(d.value,f.value)}(o,i):o instanceof Pl?function(d,f){return f instanceof Pl&&d.op===f.op&&d.filters.length===f.filters.length?d.filters.reduce((y,R,w)=>y&&O8(R,f.filters[w]),!0):!1}(o,i):void pn(19439)}function D8(o){return o instanceof us?function(a){return`${a.field.canonicalString()} ${a.op} ${hy(a.value)}`}(o):o instanceof Pl?function(a){return a.op.toString()+" {"+a.getFilters().map(D8).join(" ,")+"}"}(o):"Filter"}class vde extends us{constructor(i,a,d){super(i,a,d),this.key=Qt.fromName(d.referenceValue)}matches(i){const a=Qt.comparator(i.key,this.key);return this.matchesComparison(a)}}class Sde extends us{constructor(i,a){super(i,"in",a),this.keys=P8("in",a)}matches(i){return this.keys.some(a=>a.isEqual(i.key))}}class Tde extends us{constructor(i,a){super(i,"not-in",a),this.keys=P8("not-in",a)}matches(i){return!this.keys.some(a=>a.isEqual(i.key))}}function P8(o,i){var a;return(((a=i.arrayValue)===null||a===void 0?void 0:a.values)||[]).map(d=>Qt.fromName(d.referenceValue))}class Rde extends us{constructor(i,a){super(i,"array-contains",a)}matches(i){const a=i.data.field(this.field);return r1(a)&&gR(a.arrayValue,this.value)}}class bde extends us{constructor(i,a){super(i,"in",a)}matches(i){const a=i.data.field(this.field);return a!==null&&gR(this.value.arrayValue,a)}}class Cde extends us{constructor(i,a){super(i,"not-in",a)}matches(i){if(gR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const a=i.data.field(this.field);return a!==null&&a.nullValue===void 0&&!gR(this.value.arrayValue,a)}}class wde extends us{constructor(i,a){super(i,"array-contains-any",a)}matches(i){const a=i.data.field(this.field);return!(!r1(a)||!a.arrayValue.values)&&a.arrayValue.values.some(d=>gR(this.value.arrayValue,d))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ade{constructor(i,a=null,d=[],f=[],y=null,R=null,w=null){this.path=i,this.collectionGroup=a,this.orderBy=d,this.filters=f,this.limit=y,this.startAt=R,this.endAt=w,this.Ie=null}}function NH(o,i=null,a=[],d=[],f=null,y=null,R=null){return new Ade(o,i,a,d,f,y,R)}function s1(o){const i=bn(o);if(i.Ie===null){let a=i.path.canonicalString();i.collectionGroup!==null&&(a+="|cg:"+i.collectionGroup),a+="|f:",a+=i.filters.map(d=>_x(d)).join(","),a+="|ob:",a+=i.orderBy.map(d=>function(y){return y.field.canonicalString()+y.dir}(d)).join(","),zI(i.limit)||(a+="|l:",a+=i.limit),i.startAt&&(a+="|lb:",a+=i.startAt.inclusive?"b:":"a:",a+=i.startAt.position.map(d=>hy(d)).join(",")),i.endAt&&(a+="|ub:",a+=i.endAt.inclusive?"a:":"b:",a+=i.endAt.position.map(d=>hy(d)).join(",")),i.Ie=a}return i.Ie}function a1(o,i){if(o.limit!==i.limit||o.orderBy.length!==i.orderBy.length)return!1;for(let a=0;a<o.orderBy.length;a++)if(!Ede(o.orderBy[a],i.orderBy[a]))return!1;if(o.filters.length!==i.filters.length)return!1;for(let a=0;a<o.filters.length;a++)if(!O8(o.filters[a],i.filters[a]))return!1;return o.collectionGroup===i.collectionGroup&&!!o.path.isEqual(i.path)&&!!IH(o.startAt,i.startAt)&&IH(o.endAt,i.endAt)}function gx(o){return Qt.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ay{constructor(i,a=null,d=[],f=[],y=null,R="F",w=null,N=null){this.path=i,this.collectionGroup=a,this.explicitOrderBy=d,this.filters=f,this.limit=y,this.limitType=R,this.startAt=w,this.endAt=N,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function Ide(o,i,a,d,f,y,R,w){return new Ay(o,i,a,d,f,y,R,w)}function o1(o){return new Ay(o)}function OH(o){return o.filters.length===0&&o.limit===null&&o.startAt==null&&o.endAt==null&&(o.explicitOrderBy.length===0||o.explicitOrderBy.length===1&&o.explicitOrderBy[0].field.isKeyField())}function L8(o){return o.collectionGroup!==null}function rR(o){const i=bn(o);if(i.Ee===null){i.Ee=[];const a=new Set;for(const y of i.explicitOrderBy)i.Ee.push(y),a.add(y.field.canonicalString());const d=i.explicitOrderBy.length>0?i.explicitOrderBy[i.explicitOrderBy.length-1].dir:"asc";(function(R){let w=new Ss(Xs.comparator);return R.filters.forEach(N=>{N.getFlattenedFilters().forEach(O=>{O.isInequality()&&(w=w.add(O.field))})}),w})(i).forEach(y=>{a.has(y.canonicalString())||y.isKeyField()||i.Ee.push(new ER(y,d))}),a.has(Xs.keyField().canonicalString())||i.Ee.push(new ER(Xs.keyField(),d))}return i.Ee}function Vd(o){const i=bn(o);return i.de||(i.de=Nde(i,rR(o))),i.de}function Nde(o,i){if(o.limitType==="F")return NH(o.path,o.collectionGroup,i,o.filters,o.limit,o.startAt,o.endAt);{i=i.map(f=>{const y=f.dir==="desc"?"asc":"desc";return new ER(f.field,y)});const a=o.endAt?new pI(o.endAt.position,o.endAt.inclusive):null,d=o.startAt?new pI(o.startAt.position,o.startAt.inclusive):null;return NH(o.path,o.collectionGroup,i,o.filters,o.limit,a,d)}}function Ex(o,i){const a=o.filters.concat([i]);return new Ay(o.path,o.collectionGroup,o.explicitOrderBy.slice(),a,o.limit,o.limitType,o.startAt,o.endAt)}function yx(o,i,a){return new Ay(o.path,o.collectionGroup,o.explicitOrderBy.slice(),o.filters.slice(),i,a,o.startAt,o.endAt)}function qI(o,i){return a1(Vd(o),Vd(i))&&o.limitType===i.limitType}function k8(o){return`${s1(Vd(o))}|lt:${o.limitType}`}function JE(o){return`Query(target=${function(a){let d=a.path.canonicalString();return a.collectionGroup!==null&&(d+=" collectionGroup="+a.collectionGroup),a.filters.length>0&&(d+=`, filters: [${a.filters.map(f=>D8(f)).join(", ")}]`),zI(a.limit)||(d+=", limit: "+a.limit),a.orderBy.length>0&&(d+=`, orderBy: [${a.orderBy.map(f=>function(R){return`${R.field.canonicalString()} (${R.dir})`}(f)).join(", ")}]`),a.startAt&&(d+=", startAt: ",d+=a.startAt.inclusive?"b:":"a:",d+=a.startAt.position.map(f=>hy(f)).join(",")),a.endAt&&(d+=", endAt: ",d+=a.endAt.inclusive?"a:":"b:",d+=a.endAt.position.map(f=>hy(f)).join(",")),`Target(${d})`}(Vd(o))}; limitType=${o.limitType})`}function KI(o,i){return i.isFoundDocument()&&function(d,f){const y=f.key.path;return d.collectionGroup!==null?f.key.hasCollectionId(d.collectionGroup)&&d.path.isPrefixOf(y):Qt.isDocumentKey(d.path)?d.path.isEqual(y):d.path.isImmediateParentOf(y)}(o,i)&&function(d,f){for(const y of rR(d))if(!y.field.isKeyField()&&f.data.field(y.field)===null)return!1;return!0}(o,i)&&function(d,f){for(const y of d.filters)if(!y.matches(f))return!1;return!0}(o,i)&&function(d,f){return!(d.startAt&&!function(R,w,N){const O=AH(R,w,N);return R.inclusive?O<=0:O<0}(d.startAt,rR(d),f)||d.endAt&&!function(R,w,N){const O=AH(R,w,N);return R.inclusive?O>=0:O>0}(d.endAt,rR(d),f))}(o,i)}function Ode(o){return o.collectionGroup||(o.path.length%2==1?o.path.lastSegment():o.path.get(o.path.length-2))}function x8(o){return(i,a)=>{let d=!1;for(const f of rR(o)){const y=Dde(f,i,a);if(y!==0)return y;d=d||f.field.isKeyField()}return 0}}function Dde(o,i,a){const d=o.field.isKeyField()?Qt.comparator(i.key,a.key):function(y,R,w){const N=R.data.field(y),O=w.data.field(y);return N!==null&&O!==null?uy(N,O):pn(42886)}(o.field,i,a);switch(o.dir){case"asc":return d;case"desc":return-1*d;default:return pn(19790,{direction:o.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d_{constructor(i,a){this.mapKeyFn=i,this.equalsFn=a,this.inner={},this.innerSize=0}get(i){const a=this.mapKeyFn(i),d=this.inner[a];if(d!==void 0){for(const[f,y]of d)if(this.equalsFn(f,i))return y}}has(i){return this.get(i)!==void 0}set(i,a){const d=this.mapKeyFn(i),f=this.inner[d];if(f===void 0)return this.inner[d]=[[i,a]],void this.innerSize++;for(let y=0;y<f.length;y++)if(this.equalsFn(f[y][0],i))return void(f[y]=[i,a]);f.push([i,a]),this.innerSize++}delete(i){const a=this.mapKeyFn(i),d=this.inner[a];if(d===void 0)return!1;for(let f=0;f<d.length;f++)if(this.equalsFn(d[f][0],i))return d.length===1?delete this.inner[a]:d.splice(f,1),this.innerSize--,!0;return!1}forEach(i){Wp(this.inner,(a,d)=>{for(const[f,y]of d)i(f,y)})}isEmpty(){return E8(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pde=new wr(Qt.comparator);function ah(){return Pde}const M8=new wr(Qt.comparator);function qT(...o){let i=M8;for(const a of o)i=i.insert(a.key,a);return i}function U8(o){let i=M8;return o.forEach((a,d)=>i=i.insert(a,d.overlayedDocument)),i}function $m(){return sR()}function j8(){return sR()}function sR(){return new d_(o=>o.toString(),(o,i)=>o.isEqual(i))}const Lde=new wr(Qt.comparator),kde=new Ss(Qt.comparator);function ti(...o){let i=kde;for(const a of o)i=i.add(a);return i}const xde=new Ss(Kn);function Mde(){return xde}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c1(o,i){if(o.useProto3Json){if(isNaN(i))return{doubleValue:"NaN"};if(i===1/0)return{doubleValue:"Infinity"};if(i===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:dI(i)?"-0":i}}function V8(o){return{integerValue:""+o}}function Ude(o,i){return dde(i)?V8(i):c1(o,i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YI{constructor(){this._=void 0}}function jde(o,i,a){return o instanceof fI?function(f,y){const R={fields:{[S8]:{stringValue:v8},[R8]:{timestampValue:{seconds:f.seconds,nanos:f.nanoseconds}}}};return y&&i1(y)&&(y=WI(y)),y&&(R.fields[T8]=y),{mapValue:R}}(a,i):o instanceof yR?B8(o,i):o instanceof vR?G8(o,i):function(f,y){const R=F8(f,y),w=DH(R)+DH(f.Re);return mx(R)&&mx(f.Re)?V8(w):c1(f.serializer,w)}(o,i)}function Vde(o,i,a){return o instanceof yR?B8(o,i):o instanceof vR?G8(o,i):a}function F8(o,i){return o instanceof mI?function(d){return mx(d)||function(y){return!!y&&"doubleValue"in y}(d)}(i)?i:{integerValue:0}:null}class fI extends YI{}class yR extends YI{constructor(i){super(),this.elements=i}}function B8(o,i){const a=H8(i);for(const d of o.elements)a.some(f=>Bd(f,d))||a.push(d);return{arrayValue:{values:a}}}class vR extends YI{constructor(i){super(),this.elements=i}}function G8(o,i){let a=H8(i);for(const d of o.elements)a=a.filter(f=>!Bd(f,d));return{arrayValue:{values:a}}}class mI extends YI{constructor(i,a){super(),this.serializer=i,this.Re=a}}function DH(o){return Xr(o.integerValue||o.doubleValue)}function H8(o){return r1(o)&&o.arrayValue.values?o.arrayValue.values.slice():[]}function Fde(o,i){return o.field.isEqual(i.field)&&function(d,f){return d instanceof yR&&f instanceof yR||d instanceof vR&&f instanceof vR?dy(d.elements,f.elements,Bd):d instanceof mI&&f instanceof mI?Bd(d.Re,f.Re):d instanceof fI&&f instanceof fI}(o.transform,i.transform)}class Bde{constructor(i,a){this.version=i,this.transformResults=a}}class jc{constructor(i,a){this.updateTime=i,this.exists=a}static none(){return new jc}static exists(i){return new jc(void 0,i)}static updateTime(i){return new jc(i)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(i){return this.exists===i.exists&&(this.updateTime?!!i.updateTime&&this.updateTime.isEqual(i.updateTime):!i.updateTime)}}function z0(o,i){return o.updateTime!==void 0?i.isFoundDocument()&&i.version.isEqual(o.updateTime):o.exists===void 0||o.exists===i.isFoundDocument()}class XI{}function z8(o,i){if(!o.hasLocalMutations||i&&i.fields.length===0)return null;if(i===null)return o.isNoDocument()?new l1(o.key,jc.none()):new OR(o.key,o.data,jc.none());{const a=o.data,d=fo.empty();let f=new Ss(Xs.comparator);for(let y of i.fields)if(!f.has(y)){let R=a.field(y);R===null&&y.length>1&&(y=y.popLast(),R=a.field(y)),R===null?d.delete(y):d.set(y,R),f=f.add(y)}return new qp(o.key,d,new Go(f.toArray()),jc.none())}}function Gde(o,i,a){o instanceof OR?function(f,y,R){const w=f.value.clone(),N=LH(f.fieldTransforms,y,R.transformResults);w.setAll(N),y.convertToFoundDocument(R.version,w).setHasCommittedMutations()}(o,i,a):o instanceof qp?function(f,y,R){if(!z0(f.precondition,y))return void y.convertToUnknownDocument(R.version);const w=LH(f.fieldTransforms,y,R.transformResults),N=y.data;N.setAll(W8(f)),N.setAll(w),y.convertToFoundDocument(R.version,N).setHasCommittedMutations()}(o,i,a):function(f,y,R){y.convertToNoDocument(R.version).setHasCommittedMutations()}(0,i,a)}function aR(o,i,a,d){return o instanceof OR?function(y,R,w,N){if(!z0(y.precondition,R))return w;const O=y.value.clone(),x=kH(y.fieldTransforms,N,R);return O.setAll(x),R.convertToFoundDocument(R.version,O).setHasLocalMutations(),null}(o,i,a,d):o instanceof qp?function(y,R,w,N){if(!z0(y.precondition,R))return w;const O=kH(y.fieldTransforms,N,R),x=R.data;return x.setAll(W8(y)),x.setAll(O),R.convertToFoundDocument(R.version,x).setHasLocalMutations(),w===null?null:w.unionWith(y.fieldMask.fields).unionWith(y.fieldTransforms.map(G=>G.field))}(o,i,a,d):function(y,R,w){return z0(y.precondition,R)?(R.convertToNoDocument(R.version).setHasLocalMutations(),null):w}(o,i,a)}function Hde(o,i){let a=null;for(const d of o.fieldTransforms){const f=i.data.field(d.field),y=F8(d.transform,f||null);y!=null&&(a===null&&(a=fo.empty()),a.set(d.field,y))}return a||null}function PH(o,i){return o.type===i.type&&!!o.key.isEqual(i.key)&&!!o.precondition.isEqual(i.precondition)&&!!function(d,f){return d===void 0&&f===void 0||!(!d||!f)&&dy(d,f,(y,R)=>Fde(y,R))}(o.fieldTransforms,i.fieldTransforms)&&(o.type===0?o.value.isEqual(i.value):o.type!==1||o.data.isEqual(i.data)&&o.fieldMask.isEqual(i.fieldMask))}class OR extends XI{constructor(i,a,d,f=[]){super(),this.key=i,this.value=a,this.precondition=d,this.fieldTransforms=f,this.type=0}getFieldMask(){return null}}class qp extends XI{constructor(i,a,d,f,y=[]){super(),this.key=i,this.data=a,this.fieldMask=d,this.precondition=f,this.fieldTransforms=y,this.type=1}getFieldMask(){return this.fieldMask}}function W8(o){const i=new Map;return o.fieldMask.fields.forEach(a=>{if(!a.isEmpty()){const d=o.data.field(a);i.set(a,d)}}),i}function LH(o,i,a){const d=new Map;Li(o.length===a.length,32656,{Ve:a.length,me:o.length});for(let f=0;f<a.length;f++){const y=o[f],R=y.transform,w=i.data.field(y.field);d.set(y.field,Vde(R,w,a[f]))}return d}function kH(o,i,a){const d=new Map;for(const f of o){const y=f.transform,R=a.data.field(f.field);d.set(f.field,jde(y,R,i))}return d}class l1 extends XI{constructor(i,a){super(),this.key=i,this.precondition=a,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class zde extends XI{constructor(i,a){super(),this.key=i,this.precondition=a,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wde{constructor(i,a,d,f){this.batchId=i,this.localWriteTime=a,this.baseMutations=d,this.mutations=f}applyToRemoteDocument(i,a){const d=a.mutationResults;for(let f=0;f<this.mutations.length;f++){const y=this.mutations[f];y.key.isEqual(i.key)&&Gde(y,i,d[f])}}applyToLocalView(i,a){for(const d of this.baseMutations)d.key.isEqual(i.key)&&(a=aR(d,i,a,this.localWriteTime));for(const d of this.mutations)d.key.isEqual(i.key)&&(a=aR(d,i,a,this.localWriteTime));return a}applyToLocalDocumentSet(i,a){const d=j8();return this.mutations.forEach(f=>{const y=i.get(f.key),R=y.overlayedDocument;let w=this.applyToLocalView(R,y.mutatedFields);w=a.has(f.key)?null:w;const N=z8(R,w);N!==null&&d.set(f.key,N),R.isValidDocument()||R.convertToNoDocument(Tn.min())}),d}keys(){return this.mutations.reduce((i,a)=>i.add(a.key),ti())}isEqual(i){return this.batchId===i.batchId&&dy(this.mutations,i.mutations,(a,d)=>PH(a,d))&&dy(this.baseMutations,i.baseMutations,(a,d)=>PH(a,d))}}class d1{constructor(i,a,d,f){this.batch=i,this.commitVersion=a,this.mutationResults=d,this.docVersions=f}static from(i,a,d){Li(i.mutations.length===d.length,58842,{fe:i.mutations.length,ge:d.length});let f=function(){return Lde}();const y=i.mutations;for(let R=0;R<y.length;R++)f=f.insert(y[R].key,d[R].version);return new d1(i,a,d,f)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qde{constructor(i,a){this.largestBatchId=i,this.mutation=a}getKey(){return this.mutation.key}isEqual(i){return i!==null&&this.mutation===i.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kde{constructor(i,a){this.count=i,this.unchangedNames=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ds,li;function Yde(o){switch(o){case ht.OK:return pn(64938);case ht.CANCELLED:case ht.UNKNOWN:case ht.DEADLINE_EXCEEDED:case ht.RESOURCE_EXHAUSTED:case ht.INTERNAL:case ht.UNAVAILABLE:case ht.UNAUTHENTICATED:return!1;case ht.INVALID_ARGUMENT:case ht.NOT_FOUND:case ht.ALREADY_EXISTS:case ht.PERMISSION_DENIED:case ht.FAILED_PRECONDITION:case ht.ABORTED:case ht.OUT_OF_RANGE:case ht.UNIMPLEMENTED:case ht.DATA_LOSS:return!0;default:return pn(15467,{code:o})}}function q8(o){if(o===void 0)return sh("GRPC error has no .code"),ht.UNKNOWN;switch(o){case ds.OK:return ht.OK;case ds.CANCELLED:return ht.CANCELLED;case ds.UNKNOWN:return ht.UNKNOWN;case ds.DEADLINE_EXCEEDED:return ht.DEADLINE_EXCEEDED;case ds.RESOURCE_EXHAUSTED:return ht.RESOURCE_EXHAUSTED;case ds.INTERNAL:return ht.INTERNAL;case ds.UNAVAILABLE:return ht.UNAVAILABLE;case ds.UNAUTHENTICATED:return ht.UNAUTHENTICATED;case ds.INVALID_ARGUMENT:return ht.INVALID_ARGUMENT;case ds.NOT_FOUND:return ht.NOT_FOUND;case ds.ALREADY_EXISTS:return ht.ALREADY_EXISTS;case ds.PERMISSION_DENIED:return ht.PERMISSION_DENIED;case ds.FAILED_PRECONDITION:return ht.FAILED_PRECONDITION;case ds.ABORTED:return ht.ABORTED;case ds.OUT_OF_RANGE:return ht.OUT_OF_RANGE;case ds.UNIMPLEMENTED:return ht.UNIMPLEMENTED;case ds.DATA_LOSS:return ht.DATA_LOSS;default:return pn(39323,{code:o})}}(li=ds||(ds={}))[li.OK=0]="OK",li[li.CANCELLED=1]="CANCELLED",li[li.UNKNOWN=2]="UNKNOWN",li[li.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",li[li.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",li[li.NOT_FOUND=5]="NOT_FOUND",li[li.ALREADY_EXISTS=6]="ALREADY_EXISTS",li[li.PERMISSION_DENIED=7]="PERMISSION_DENIED",li[li.UNAUTHENTICATED=16]="UNAUTHENTICATED",li[li.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",li[li.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",li[li.ABORTED=10]="ABORTED",li[li.OUT_OF_RANGE=11]="OUT_OF_RANGE",li[li.UNIMPLEMENTED=12]="UNIMPLEMENTED",li[li.INTERNAL=13]="INTERNAL",li[li.UNAVAILABLE=14]="UNAVAILABLE",li[li.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xde=new Mp([4294967295,4294967295],0);function xH(o){const i=m8().encode(o),a=new o8;return a.update(i),new Uint8Array(a.digest())}function MH(o){const i=new DataView(o.buffer),a=i.getUint32(0,!0),d=i.getUint32(4,!0),f=i.getUint32(8,!0),y=i.getUint32(12,!0);return[new Mp([a,d],0),new Mp([f,y],0)]}class u1{constructor(i,a,d){if(this.bitmap=i,this.padding=a,this.hashCount=d,a<0||a>=8)throw new KT(`Invalid padding: ${a}`);if(d<0)throw new KT(`Invalid hash count: ${d}`);if(i.length>0&&this.hashCount===0)throw new KT(`Invalid hash count: ${d}`);if(i.length===0&&a!==0)throw new KT(`Invalid padding when bitmap length is 0: ${a}`);this.pe=8*i.length-a,this.ye=Mp.fromNumber(this.pe)}we(i,a,d){let f=i.add(a.multiply(Mp.fromNumber(d)));return f.compare(Xde)===1&&(f=new Mp([f.getBits(0),f.getBits(1)],0)),f.modulo(this.ye).toNumber()}be(i){return!!(this.bitmap[Math.floor(i/8)]&1<<i%8)}mightContain(i){if(this.pe===0)return!1;const a=xH(i),[d,f]=MH(a);for(let y=0;y<this.hashCount;y++){const R=this.we(d,f,y);if(!this.be(R))return!1}return!0}static create(i,a,d){const f=i%8==0?0:8-i%8,y=new Uint8Array(Math.ceil(i/8)),R=new u1(y,f,a);return d.forEach(w=>R.insert(w)),R}insert(i){if(this.pe===0)return;const a=xH(i),[d,f]=MH(a);for(let y=0;y<this.hashCount;y++){const R=this.we(d,f,y);this.Se(R)}}Se(i){const a=Math.floor(i/8),d=i%8;this.bitmap[a]|=1<<d}}class KT extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JI{constructor(i,a,d,f,y){this.snapshotVersion=i,this.targetChanges=a,this.targetMismatches=d,this.documentUpdates=f,this.resolvedLimboDocuments=y}static createSynthesizedRemoteEventForCurrentChange(i,a,d){const f=new Map;return f.set(i,DR.createSynthesizedTargetChangeForCurrentChange(i,a,d)),new JI(Tn.min(),f,new wr(Kn),ah(),ti())}}class DR{constructor(i,a,d,f,y){this.resumeToken=i,this.current=a,this.addedDocuments=d,this.modifiedDocuments=f,this.removedDocuments=y}static createSynthesizedTargetChangeForCurrentChange(i,a,d){return new DR(d,a,ti(),ti(),ti())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W0{constructor(i,a,d,f){this.De=i,this.removedTargetIds=a,this.key=d,this.ve=f}}class K8{constructor(i,a){this.targetId=i,this.Ce=a}}class Y8{constructor(i,a,d=Js.EMPTY_BYTE_STRING,f=null){this.state=i,this.targetIds=a,this.resumeToken=d,this.cause=f}}class UH{constructor(){this.Fe=0,this.Me=jH(),this.xe=Js.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(i){i.approximateByteSize()>0&&(this.Ne=!0,this.xe=i)}qe(){let i=ti(),a=ti(),d=ti();return this.Me.forEach((f,y)=>{switch(y){case 0:i=i.add(f);break;case 2:a=a.add(f);break;case 1:d=d.add(f);break;default:pn(38017,{changeType:y})}}),new DR(this.xe,this.Oe,i,a,d)}Qe(){this.Ne=!1,this.Me=jH()}$e(i,a){this.Ne=!0,this.Me=this.Me.insert(i,a)}Ue(i){this.Ne=!0,this.Me=this.Me.remove(i)}Ke(){this.Fe+=1}We(){this.Fe-=1,Li(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class Jde{constructor(i){this.ze=i,this.je=new Map,this.He=ah(),this.Je=a0(),this.Ye=a0(),this.Ze=new wr(Kn)}Xe(i){for(const a of i.De)i.ve&&i.ve.isFoundDocument()?this.et(a,i.ve):this.tt(a,i.key,i.ve);for(const a of i.removedTargetIds)this.tt(a,i.key,i.ve)}nt(i){this.forEachTarget(i,a=>{const d=this.rt(a);switch(i.state){case 0:this.it(a)&&d.ke(i.resumeToken);break;case 1:d.We(),d.Be||d.Qe(),d.ke(i.resumeToken);break;case 2:d.We(),d.Be||this.removeTarget(a);break;case 3:this.it(a)&&(d.Ge(),d.ke(i.resumeToken));break;case 4:this.it(a)&&(this.st(a),d.ke(i.resumeToken));break;default:pn(56790,{state:i.state})}})}forEachTarget(i,a){i.targetIds.length>0?i.targetIds.forEach(a):this.je.forEach((d,f)=>{this.it(f)&&a(f)})}ot(i){const a=i.targetId,d=i.Ce.count,f=this._t(a);if(f){const y=f.target;if(gx(y))if(d===0){const R=new Qt(y.path);this.tt(a,R,_a.newNoDocument(R,Tn.min()))}else Li(d===1,20013,{expectedCount:d});else{const R=this.ut(a);if(R!==d){const w=this.ct(i),N=w?this.lt(w,i,R):1;if(N!==0){this.st(a);const O=N===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(a,O)}}}}}ct(i){const a=i.Ce.unchangedNames;if(!a||!a.bits)return null;const{bits:{bitmap:d="",padding:f=0},hashCount:y=0}=a;let R,w;try{R=Bp(d).toUint8Array()}catch(N){if(N instanceof y8)return ly("Decoding the base64 bloom filter in existence filter failed ("+N.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw N}try{w=new u1(R,f,y)}catch(N){return ly(N instanceof KT?"BloomFilter error: ":"Applying bloom filter failed: ",N),null}return w.pe===0?null:w}lt(i,a,d){return a.Ce.count===d-this.Tt(i,a.targetId)?0:2}Tt(i,a){const d=this.ze.getRemoteKeysForTarget(a);let f=0;return d.forEach(y=>{const R=this.ze.Pt(),w=`projects/${R.projectId}/databases/${R.database}/documents/${y.path.canonicalString()}`;i.mightContain(w)||(this.tt(a,y,null),f++)}),f}It(i){const a=new Map;this.je.forEach((y,R)=>{const w=this._t(R);if(w){if(y.current&&gx(w.target)){const N=new Qt(w.target.path);this.Et(N).has(R)||this.dt(R,N)||this.tt(R,N,_a.newNoDocument(N,i))}y.Le&&(a.set(R,y.qe()),y.Qe())}});let d=ti();this.Ye.forEach((y,R)=>{let w=!0;R.forEachWhile(N=>{const O=this._t(N);return!O||O.purpose==="TargetPurposeLimboResolution"||(w=!1,!1)}),w&&(d=d.add(y))}),this.He.forEach((y,R)=>R.setReadTime(i));const f=new JI(i,a,this.Ze,this.He,d);return this.He=ah(),this.Je=a0(),this.Ye=a0(),this.Ze=new wr(Kn),f}et(i,a){if(!this.it(i))return;const d=this.dt(i,a.key)?2:0;this.rt(i).$e(a.key,d),this.He=this.He.insert(a.key,a),this.Je=this.Je.insert(a.key,this.Et(a.key).add(i)),this.Ye=this.Ye.insert(a.key,this.At(a.key).add(i))}tt(i,a,d){if(!this.it(i))return;const f=this.rt(i);this.dt(i,a)?f.$e(a,1):f.Ue(a),this.Ye=this.Ye.insert(a,this.At(a).delete(i)),this.Ye=this.Ye.insert(a,this.At(a).add(i)),d&&(this.He=this.He.insert(a,d))}removeTarget(i){this.je.delete(i)}ut(i){const a=this.rt(i).qe();return this.ze.getRemoteKeysForTarget(i).size+a.addedDocuments.size-a.removedDocuments.size}Ke(i){this.rt(i).Ke()}rt(i){let a=this.je.get(i);return a||(a=new UH,this.je.set(i,a)),a}At(i){let a=this.Ye.get(i);return a||(a=new Ss(Kn),this.Ye=this.Ye.insert(i,a)),a}Et(i){let a=this.Je.get(i);return a||(a=new Ss(Kn),this.Je=this.Je.insert(i,a)),a}it(i){const a=this._t(i)!==null;return a||Mt("WatchChangeAggregator","Detected inactive target",i),a}_t(i){const a=this.je.get(i);return a&&a.Be?null:this.ze.Rt(i)}st(i){this.je.set(i,new UH),this.ze.getRemoteKeysForTarget(i).forEach(a=>{this.tt(i,a,null)})}dt(i,a){return this.ze.getRemoteKeysForTarget(i).has(a)}}function a0(){return new wr(Qt.comparator)}function jH(){return new wr(Qt.comparator)}const Qde={asc:"ASCENDING",desc:"DESCENDING"},$de={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Zde={and:"AND",or:"OR"};class eue{constructor(i,a){this.databaseId=i,this.useProto3Json=a}}function vx(o,i){return o.useProto3Json||zI(i)?i:{value:i}}function _I(o,i){return o.useProto3Json?`${new Date(1e3*i.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+i.nanoseconds).slice(-9)}Z`:{seconds:""+i.seconds,nanos:i.nanoseconds}}function X8(o,i){return o.useProto3Json?i.toBase64():i.toUint8Array()}function tue(o,i){return _I(o,i.toTimestamp())}function Fd(o){return Li(!!o,49232),Tn.fromTimestamp(function(a){const d=Fp(a);return new vs(d.seconds,d.nanos)}(o))}function h1(o,i){return Sx(o,i).canonicalString()}function Sx(o,i){const a=function(f){return new or(["projects",f.projectId,"databases",f.database])}(o).child("documents");return i===void 0?a:a.child(i)}function J8(o){const i=or.fromString(o);return Li(tW(i),10190,{key:i.toString()}),i}function Tx(o,i){return h1(o.databaseId,i.path)}function Tk(o,i){const a=J8(i);if(a.get(1)!==o.databaseId.projectId)throw new Ut(ht.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+a.get(1)+" vs "+o.databaseId.projectId);if(a.get(3)!==o.databaseId.database)throw new Ut(ht.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+a.get(3)+" vs "+o.databaseId.database);return new Qt($8(a))}function Q8(o,i){return h1(o.databaseId,i)}function nue(o){const i=J8(o);return i.length===4?or.emptyPath():$8(i)}function Rx(o){return new or(["projects",o.databaseId.projectId,"databases",o.databaseId.database]).canonicalString()}function $8(o){return Li(o.length>4&&o.get(4)==="documents",29091,{key:o.toString()}),o.popFirst(5)}function VH(o,i,a){return{name:Tx(o,i),fields:a.value.mapValue.fields}}function iue(o,i){let a;if("targetChange"in i){i.targetChange;const d=function(O){return O==="NO_CHANGE"?0:O==="ADD"?1:O==="REMOVE"?2:O==="CURRENT"?3:O==="RESET"?4:pn(39313,{state:O})}(i.targetChange.targetChangeType||"NO_CHANGE"),f=i.targetChange.targetIds||[],y=function(O,x){return O.useProto3Json?(Li(x===void 0||typeof x=="string",58123),Js.fromBase64String(x||"")):(Li(x===void 0||x instanceof Buffer||x instanceof Uint8Array,16193),Js.fromUint8Array(x||new Uint8Array))}(o,i.targetChange.resumeToken),R=i.targetChange.cause,w=R&&function(O){const x=O.code===void 0?ht.UNKNOWN:q8(O.code);return new Ut(x,O.message||"")}(R);a=new Y8(d,f,y,w||null)}else if("documentChange"in i){i.documentChange;const d=i.documentChange;d.document,d.document.name,d.document.updateTime;const f=Tk(o,d.document.name),y=Fd(d.document.updateTime),R=d.document.createTime?Fd(d.document.createTime):Tn.min(),w=new fo({mapValue:{fields:d.document.fields}}),N=_a.newFoundDocument(f,y,R,w),O=d.targetIds||[],x=d.removedTargetIds||[];a=new W0(O,x,N.key,N)}else if("documentDelete"in i){i.documentDelete;const d=i.documentDelete;d.document;const f=Tk(o,d.document),y=d.readTime?Fd(d.readTime):Tn.min(),R=_a.newNoDocument(f,y),w=d.removedTargetIds||[];a=new W0([],w,R.key,R)}else if("documentRemove"in i){i.documentRemove;const d=i.documentRemove;d.document;const f=Tk(o,d.document),y=d.removedTargetIds||[];a=new W0([],y,f,null)}else{if(!("filter"in i))return pn(11601,{Vt:i});{i.filter;const d=i.filter;d.targetId;const{count:f=0,unchangedNames:y}=d,R=new Kde(f,y),w=d.targetId;a=new K8(w,R)}}return a}function rue(o,i){let a;if(i instanceof OR)a={update:VH(o,i.key,i.value)};else if(i instanceof l1)a={delete:Tx(o,i.key)};else if(i instanceof qp)a={update:VH(o,i.key,i.data),updateMask:pue(i.fieldMask)};else{if(!(i instanceof zde))return pn(16599,{ft:i.type});a={verify:Tx(o,i.key)}}return i.fieldTransforms.length>0&&(a.updateTransforms=i.fieldTransforms.map(d=>function(y,R){const w=R.transform;if(w instanceof fI)return{fieldPath:R.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(w instanceof yR)return{fieldPath:R.field.canonicalString(),appendMissingElements:{values:w.elements}};if(w instanceof vR)return{fieldPath:R.field.canonicalString(),removeAllFromArray:{values:w.elements}};if(w instanceof mI)return{fieldPath:R.field.canonicalString(),increment:w.Re};throw pn(20930,{transform:R.transform})}(0,d))),i.precondition.isNone||(a.currentDocument=function(f,y){return y.updateTime!==void 0?{updateTime:tue(f,y.updateTime)}:y.exists!==void 0?{exists:y.exists}:pn(27497)}(o,i.precondition)),a}function sue(o,i){return o&&o.length>0?(Li(i!==void 0,14353),o.map(a=>function(f,y){let R=f.updateTime?Fd(f.updateTime):Fd(y);return R.isEqual(Tn.min())&&(R=Fd(y)),new Bde(R,f.transformResults||[])}(a,i))):[]}function aue(o,i){return{documents:[Q8(o,i.path)]}}function oue(o,i){const a={structuredQuery:{}},d=i.path;let f;i.collectionGroup!==null?(f=d,a.structuredQuery.from=[{collectionId:i.collectionGroup,allDescendants:!0}]):(f=d.popLast(),a.structuredQuery.from=[{collectionId:d.lastSegment()}]),a.parent=Q8(o,f);const y=function(O){if(O.length!==0)return eW(Pl.create(O,"and"))}(i.filters);y&&(a.structuredQuery.where=y);const R=function(O){if(O.length!==0)return O.map(x=>function(W){return{field:QE(W.field),direction:due(W.dir)}}(x))}(i.orderBy);R&&(a.structuredQuery.orderBy=R);const w=vx(o,i.limit);return w!==null&&(a.structuredQuery.limit=w),i.startAt&&(a.structuredQuery.startAt=function(O){return{before:O.inclusive,values:O.position}}(i.startAt)),i.endAt&&(a.structuredQuery.endAt=function(O){return{before:!O.inclusive,values:O.position}}(i.endAt)),{gt:a,parent:f}}function cue(o){let i=nue(o.parent);const a=o.structuredQuery,d=a.from?a.from.length:0;let f=null;if(d>0){Li(d===1,65062);const x=a.from[0];x.allDescendants?f=x.collectionId:i=i.child(x.collectionId)}let y=[];a.where&&(y=function(G){const W=Z8(G);return W instanceof Pl&&N8(W)?W.getFilters():[W]}(a.where));let R=[];a.orderBy&&(R=function(G){return G.map(W=>function(Q){return new ER($E(Q.field),function(te){switch(te){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Q.direction))}(W))}(a.orderBy));let w=null;a.limit&&(w=function(G){let W;return W=typeof G=="object"?G.value:G,zI(W)?null:W}(a.limit));let N=null;a.startAt&&(N=function(G){const W=!!G.before,ne=G.values||[];return new pI(ne,W)}(a.startAt));let O=null;return a.endAt&&(O=function(G){const W=!G.before,ne=G.values||[];return new pI(ne,W)}(a.endAt)),Ide(i,f,R,y,w,"F",N,O)}function lue(o,i){const a=function(f){switch(f){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return pn(28987,{purpose:f})}}(i.purpose);return a==null?null:{"goog-listen-tags":a}}function Z8(o){return o.unaryFilter!==void 0?function(a){switch(a.unaryFilter.op){case"IS_NAN":const d=$E(a.unaryFilter.field);return us.create(d,"==",{doubleValue:NaN});case"IS_NULL":const f=$E(a.unaryFilter.field);return us.create(f,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const y=$E(a.unaryFilter.field);return us.create(y,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const R=$E(a.unaryFilter.field);return us.create(R,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return pn(61313);default:return pn(60726)}}(o):o.fieldFilter!==void 0?function(a){return us.create($E(a.fieldFilter.field),function(f){switch(f){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return pn(58110);default:return pn(50506)}}(a.fieldFilter.op),a.fieldFilter.value)}(o):o.compositeFilter!==void 0?function(a){return Pl.create(a.compositeFilter.filters.map(d=>Z8(d)),function(f){switch(f){case"AND":return"and";case"OR":return"or";default:return pn(1026)}}(a.compositeFilter.op))}(o):pn(30097,{filter:o})}function due(o){return Qde[o]}function uue(o){return $de[o]}function hue(o){return Zde[o]}function QE(o){return{fieldPath:o.canonicalString()}}function $E(o){return Xs.fromServerFormat(o.fieldPath)}function eW(o){return o instanceof us?function(a){if(a.op==="=="){if(wH(a.value))return{unaryFilter:{field:QE(a.field),op:"IS_NAN"}};if(CH(a.value))return{unaryFilter:{field:QE(a.field),op:"IS_NULL"}}}else if(a.op==="!="){if(wH(a.value))return{unaryFilter:{field:QE(a.field),op:"IS_NOT_NAN"}};if(CH(a.value))return{unaryFilter:{field:QE(a.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:QE(a.field),op:uue(a.op),value:a.value}}}(o):o instanceof Pl?function(a){const d=a.getFilters().map(f=>eW(f));return d.length===1?d[0]:{compositeFilter:{op:hue(a.op),filters:d}}}(o):pn(54877,{filter:o})}function pue(o){const i=[];return o.fields.forEach(a=>i.push(a.canonicalString())),{fieldPaths:i}}function tW(o){return o.length>=4&&o.get(0)==="projects"&&o.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lp{constructor(i,a,d,f,y=Tn.min(),R=Tn.min(),w=Js.EMPTY_BYTE_STRING,N=null){this.target=i,this.targetId=a,this.purpose=d,this.sequenceNumber=f,this.snapshotVersion=y,this.lastLimboFreeSnapshotVersion=R,this.resumeToken=w,this.expectedCount=N}withSequenceNumber(i){return new Lp(this.target,this.targetId,this.purpose,i,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(i,a){return new Lp(this.target,this.targetId,this.purpose,this.sequenceNumber,a,this.lastLimboFreeSnapshotVersion,i,null)}withExpectedCount(i){return new Lp(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,i)}withLastLimboFreeSnapshotVersion(i){return new Lp(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,i,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fue{constructor(i){this.wt=i}}function mue(o){const i=cue({parent:o.parent,structuredQuery:o.structuredQuery});return o.limitType==="LAST"?yx(i,i.limit,"L"):i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _ue{constructor(){this.yn=new gue}addToCollectionParentIndex(i,a){return this.yn.add(a),pt.resolve()}getCollectionParents(i,a){return pt.resolve(this.yn.getEntries(a))}addFieldIndex(i,a){return pt.resolve()}deleteFieldIndex(i,a){return pt.resolve()}deleteAllFieldIndexes(i){return pt.resolve()}createTargetIndexes(i,a){return pt.resolve()}getDocumentsMatchingTarget(i,a){return pt.resolve(null)}getIndexType(i,a){return pt.resolve(0)}getFieldIndexes(i,a){return pt.resolve([])}getNextCollectionGroupToUpdate(i){return pt.resolve(null)}getMinOffset(i,a){return pt.resolve(Vp.min())}getMinOffsetFromCollectionGroup(i,a){return pt.resolve(Vp.min())}updateCollectionGroup(i,a,d){return pt.resolve()}updateIndexEntries(i,a){return pt.resolve()}}class gue{constructor(){this.index={}}add(i){const a=i.lastSegment(),d=i.popLast(),f=this.index[a]||new Ss(or.comparator),y=!f.has(d);return this.index[a]=f.add(d),y}has(i){const a=i.lastSegment(),d=i.popLast(),f=this.index[a];return f&&f.has(d)}getEntries(i){return(this.index[i]||new Ss(or.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FH={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},nW=41943040;class po{static withCacheSize(i){return new po(i,po.DEFAULT_COLLECTION_PERCENTILE,po.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(i,a,d){this.cacheSizeCollectionThreshold=i,this.percentileToCollect=a,this.maximumSequenceNumbersToCollect=d}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */po.DEFAULT_COLLECTION_PERCENTILE=10,po.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,po.DEFAULT=new po(nW,po.DEFAULT_COLLECTION_PERCENTILE,po.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),po.DISABLED=new po(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class py{constructor(i){this.nr=i}next(){return this.nr+=2,this.nr}static rr(){return new py(0)}static ir(){return new py(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BH="LruGarbageCollector",Eue=1048576;function GH([o,i],[a,d]){const f=Kn(o,a);return f===0?Kn(i,d):f}class yue{constructor(i){this.cr=i,this.buffer=new Ss(GH),this.lr=0}hr(){return++this.lr}Pr(i){const a=[i,this.hr()];if(this.buffer.size<this.cr)this.buffer=this.buffer.add(a);else{const d=this.buffer.last();GH(a,d)<0&&(this.buffer=this.buffer.delete(d).add(a))}}get maxValue(){return this.buffer.last()[0]}}class vue{constructor(i,a,d){this.garbageCollector=i,this.asyncQueue=a,this.localStore=d,this.Tr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ir(6e4)}stop(){this.Tr&&(this.Tr.cancel(),this.Tr=null)}get started(){return this.Tr!==null}Ir(i){Mt(BH,`Garbage collection scheduled in ${i}ms`),this.Tr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",i,async()=>{this.Tr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(a){wy(a)?Mt(BH,"Ignoring IndexedDB error during garbage collection: ",a):await Cy(a)}await this.Ir(3e5)})}}class Sue{constructor(i,a){this.Er=i,this.params=a}calculateTargetCount(i,a){return this.Er.dr(i).next(d=>Math.floor(a/100*d))}nthSequenceNumber(i,a){if(a===0)return pt.resolve(HI.le);const d=new yue(a);return this.Er.forEachTarget(i,f=>d.Pr(f.sequenceNumber)).next(()=>this.Er.Ar(i,f=>d.Pr(f))).next(()=>d.maxValue)}removeTargets(i,a,d){return this.Er.removeTargets(i,a,d)}removeOrphanedDocuments(i,a){return this.Er.removeOrphanedDocuments(i,a)}collect(i,a){return this.params.cacheSizeCollectionThreshold===-1?(Mt("LruGarbageCollector","Garbage collection skipped; disabled"),pt.resolve(FH)):this.getCacheSize(i).next(d=>d<this.params.cacheSizeCollectionThreshold?(Mt("LruGarbageCollector",`Garbage collection skipped; Cache size ${d} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),FH):this.Rr(i,a))}getCacheSize(i){return this.Er.getCacheSize(i)}Rr(i,a){let d,f,y,R,w,N,O;const x=Date.now();return this.calculateTargetCount(i,this.params.percentileToCollect).next(G=>(G>this.params.maximumSequenceNumbersToCollect?(Mt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${G}`),f=this.params.maximumSequenceNumbersToCollect):f=G,R=Date.now(),this.nthSequenceNumber(i,f))).next(G=>(d=G,w=Date.now(),this.removeTargets(i,d,a))).next(G=>(y=G,N=Date.now(),this.removeOrphanedDocuments(i,d))).next(G=>(O=Date.now(),XE()<=di.DEBUG&&Mt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${R-x}ms
	Determined least recently used ${f} in `+(w-R)+`ms
	Removed ${y} targets in `+(N-w)+`ms
	Removed ${G} documents in `+(O-N)+`ms
Total Duration: ${O-x}ms`),pt.resolve({didRun:!0,sequenceNumbersCollected:f,targetsRemoved:y,documentsRemoved:G})))}}function Tue(o,i){return new Sue(o,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rue{constructor(){this.changes=new d_(i=>i.toString(),(i,a)=>i.isEqual(a)),this.changesApplied=!1}addEntry(i){this.assertNotApplied(),this.changes.set(i.key,i)}removeEntry(i,a){this.assertNotApplied(),this.changes.set(i,_a.newInvalidDocument(i).setReadTime(a))}getEntry(i,a){this.assertNotApplied();const d=this.changes.get(a);return d!==void 0?pt.resolve(d):this.getFromCache(i,a)}getEntries(i,a){return this.getAllFromCache(i,a)}apply(i){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(i)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bue{constructor(i,a){this.overlayedDocument=i,this.mutatedFields=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cue{constructor(i,a,d,f){this.remoteDocumentCache=i,this.mutationQueue=a,this.documentOverlayCache=d,this.indexManager=f}getDocument(i,a){let d=null;return this.documentOverlayCache.getOverlay(i,a).next(f=>(d=f,this.remoteDocumentCache.getEntry(i,a))).next(f=>(d!==null&&aR(d.mutation,f,Go.empty(),vs.now()),f))}getDocuments(i,a){return this.remoteDocumentCache.getEntries(i,a).next(d=>this.getLocalViewOfDocuments(i,d,ti()).next(()=>d))}getLocalViewOfDocuments(i,a,d=ti()){const f=$m();return this.populateOverlays(i,f,a).next(()=>this.computeViews(i,a,f,d).next(y=>{let R=qT();return y.forEach((w,N)=>{R=R.insert(w,N.overlayedDocument)}),R}))}getOverlayedDocuments(i,a){const d=$m();return this.populateOverlays(i,d,a).next(()=>this.computeViews(i,a,d,ti()))}populateOverlays(i,a,d){const f=[];return d.forEach(y=>{a.has(y)||f.push(y)}),this.documentOverlayCache.getOverlays(i,f).next(y=>{y.forEach((R,w)=>{a.set(R,w)})})}computeViews(i,a,d,f){let y=ah();const R=sR(),w=function(){return sR()}();return a.forEach((N,O)=>{const x=d.get(O.key);f.has(O.key)&&(x===void 0||x.mutation instanceof qp)?y=y.insert(O.key,O):x!==void 0?(R.set(O.key,x.mutation.getFieldMask()),aR(x.mutation,O,x.mutation.getFieldMask(),vs.now())):R.set(O.key,Go.empty())}),this.recalculateAndSaveOverlays(i,y).next(N=>(N.forEach((O,x)=>R.set(O,x)),a.forEach((O,x)=>{var G;return w.set(O,new bue(x,(G=R.get(O))!==null&&G!==void 0?G:null))}),w))}recalculateAndSaveOverlays(i,a){const d=sR();let f=new wr((R,w)=>R-w),y=ti();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(i,a).next(R=>{for(const w of R)w.keys().forEach(N=>{const O=a.get(N);if(O===null)return;let x=d.get(N)||Go.empty();x=w.applyToLocalView(O,x),d.set(N,x);const G=(f.get(w.batchId)||ti()).add(N);f=f.insert(w.batchId,G)})}).next(()=>{const R=[],w=f.getReverseIterator();for(;w.hasNext();){const N=w.getNext(),O=N.key,x=N.value,G=j8();x.forEach(W=>{if(!y.has(W)){const ne=z8(a.get(W),d.get(W));ne!==null&&G.set(W,ne),y=y.add(W)}}),R.push(this.documentOverlayCache.saveOverlays(i,O,G))}return pt.waitFor(R)}).next(()=>d)}recalculateAndSaveOverlaysForDocumentKeys(i,a){return this.remoteDocumentCache.getEntries(i,a).next(d=>this.recalculateAndSaveOverlays(i,d))}getDocumentsMatchingQuery(i,a,d,f){return function(R){return Qt.isDocumentKey(R.path)&&R.collectionGroup===null&&R.filters.length===0}(a)?this.getDocumentsMatchingDocumentQuery(i,a.path):L8(a)?this.getDocumentsMatchingCollectionGroupQuery(i,a,d,f):this.getDocumentsMatchingCollectionQuery(i,a,d,f)}getNextDocuments(i,a,d,f){return this.remoteDocumentCache.getAllFromCollectionGroup(i,a,d,f).next(y=>{const R=f-y.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(i,a,d.largestBatchId,f-y.size):pt.resolve($m());let w=fR,N=y;return R.next(O=>pt.forEach(O,(x,G)=>(w<G.largestBatchId&&(w=G.largestBatchId),y.get(x)?pt.resolve():this.remoteDocumentCache.getEntry(i,x).next(W=>{N=N.insert(x,W)}))).next(()=>this.populateOverlays(i,O,y)).next(()=>this.computeViews(i,N,O,ti())).next(x=>({batchId:w,changes:U8(x)})))})}getDocumentsMatchingDocumentQuery(i,a){return this.getDocument(i,new Qt(a)).next(d=>{let f=qT();return d.isFoundDocument()&&(f=f.insert(d.key,d)),f})}getDocumentsMatchingCollectionGroupQuery(i,a,d,f){const y=a.collectionGroup;let R=qT();return this.indexManager.getCollectionParents(i,y).next(w=>pt.forEach(w,N=>{const O=function(G,W){return new Ay(W,null,G.explicitOrderBy.slice(),G.filters.slice(),G.limit,G.limitType,G.startAt,G.endAt)}(a,N.child(y));return this.getDocumentsMatchingCollectionQuery(i,O,d,f).next(x=>{x.forEach((G,W)=>{R=R.insert(G,W)})})}).next(()=>R))}getDocumentsMatchingCollectionQuery(i,a,d,f){let y;return this.documentOverlayCache.getOverlaysForCollection(i,a.path,d.largestBatchId).next(R=>(y=R,this.remoteDocumentCache.getDocumentsMatchingQuery(i,a,d,y,f))).next(R=>{y.forEach((N,O)=>{const x=O.getKey();R.get(x)===null&&(R=R.insert(x,_a.newInvalidDocument(x)))});let w=qT();return R.forEach((N,O)=>{const x=y.get(N);x!==void 0&&aR(x.mutation,O,Go.empty(),vs.now()),KI(a,O)&&(w=w.insert(N,O))}),w})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wue{constructor(i){this.serializer=i,this.Fr=new Map,this.Mr=new Map}getBundleMetadata(i,a){return pt.resolve(this.Fr.get(a))}saveBundleMetadata(i,a){return this.Fr.set(a.id,function(f){return{id:f.id,version:f.version,createTime:Fd(f.createTime)}}(a)),pt.resolve()}getNamedQuery(i,a){return pt.resolve(this.Mr.get(a))}saveNamedQuery(i,a){return this.Mr.set(a.name,function(f){return{name:f.name,query:mue(f.bundledQuery),readTime:Fd(f.readTime)}}(a)),pt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aue{constructor(){this.overlays=new wr(Qt.comparator),this.Or=new Map}getOverlay(i,a){return pt.resolve(this.overlays.get(a))}getOverlays(i,a){const d=$m();return pt.forEach(a,f=>this.getOverlay(i,f).next(y=>{y!==null&&d.set(f,y)})).next(()=>d)}saveOverlays(i,a,d){return d.forEach((f,y)=>{this.St(i,a,y)}),pt.resolve()}removeOverlaysForBatchId(i,a,d){const f=this.Or.get(d);return f!==void 0&&(f.forEach(y=>this.overlays=this.overlays.remove(y)),this.Or.delete(d)),pt.resolve()}getOverlaysForCollection(i,a,d){const f=$m(),y=a.length+1,R=new Qt(a.child("")),w=this.overlays.getIteratorFrom(R);for(;w.hasNext();){const N=w.getNext().value,O=N.getKey();if(!a.isPrefixOf(O.path))break;O.path.length===y&&N.largestBatchId>d&&f.set(N.getKey(),N)}return pt.resolve(f)}getOverlaysForCollectionGroup(i,a,d,f){let y=new wr((O,x)=>O-x);const R=this.overlays.getIterator();for(;R.hasNext();){const O=R.getNext().value;if(O.getKey().getCollectionGroup()===a&&O.largestBatchId>d){let x=y.get(O.largestBatchId);x===null&&(x=$m(),y=y.insert(O.largestBatchId,x)),x.set(O.getKey(),O)}}const w=$m(),N=y.getIterator();for(;N.hasNext()&&(N.getNext().value.forEach((O,x)=>w.set(O,x)),!(w.size()>=f)););return pt.resolve(w)}St(i,a,d){const f=this.overlays.get(d.key);if(f!==null){const R=this.Or.get(f.largestBatchId).delete(d.key);this.Or.set(f.largestBatchId,R)}this.overlays=this.overlays.insert(d.key,new qde(a,d));let y=this.Or.get(a);y===void 0&&(y=ti(),this.Or.set(a,y)),this.Or.set(a,y.add(d.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iue{constructor(){this.sessionToken=Js.EMPTY_BYTE_STRING}getSessionToken(i){return pt.resolve(this.sessionToken)}setSessionToken(i,a){return this.sessionToken=a,pt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p1{constructor(){this.Nr=new Ss(Ls.Br),this.Lr=new Ss(Ls.kr)}isEmpty(){return this.Nr.isEmpty()}addReference(i,a){const d=new Ls(i,a);this.Nr=this.Nr.add(d),this.Lr=this.Lr.add(d)}qr(i,a){i.forEach(d=>this.addReference(d,a))}removeReference(i,a){this.Qr(new Ls(i,a))}$r(i,a){i.forEach(d=>this.removeReference(d,a))}Ur(i){const a=new Qt(new or([])),d=new Ls(a,i),f=new Ls(a,i+1),y=[];return this.Lr.forEachInRange([d,f],R=>{this.Qr(R),y.push(R.key)}),y}Kr(){this.Nr.forEach(i=>this.Qr(i))}Qr(i){this.Nr=this.Nr.delete(i),this.Lr=this.Lr.delete(i)}Wr(i){const a=new Qt(new or([])),d=new Ls(a,i),f=new Ls(a,i+1);let y=ti();return this.Lr.forEachInRange([d,f],R=>{y=y.add(R.key)}),y}containsKey(i){const a=new Ls(i,0),d=this.Nr.firstAfterOrEqual(a);return d!==null&&i.isEqual(d.key)}}class Ls{constructor(i,a){this.key=i,this.Gr=a}static Br(i,a){return Qt.comparator(i.key,a.key)||Kn(i.Gr,a.Gr)}static kr(i,a){return Kn(i.Gr,a.Gr)||Qt.comparator(i.key,a.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nue{constructor(i,a){this.indexManager=i,this.referenceDelegate=a,this.mutationQueue=[],this.Jn=1,this.zr=new Ss(Ls.Br)}checkEmpty(i){return pt.resolve(this.mutationQueue.length===0)}addMutationBatch(i,a,d,f){const y=this.Jn;this.Jn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const R=new Wde(y,a,d,f);this.mutationQueue.push(R);for(const w of f)this.zr=this.zr.add(new Ls(w.key,y)),this.indexManager.addToCollectionParentIndex(i,w.key.path.popLast());return pt.resolve(R)}lookupMutationBatch(i,a){return pt.resolve(this.jr(a))}getNextMutationBatchAfterBatchId(i,a){const d=a+1,f=this.Hr(d),y=f<0?0:f;return pt.resolve(this.mutationQueue.length>y?this.mutationQueue[y]:null)}getHighestUnacknowledgedBatchId(){return pt.resolve(this.mutationQueue.length===0?n1:this.Jn-1)}getAllMutationBatches(i){return pt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(i,a){const d=new Ls(a,0),f=new Ls(a,Number.POSITIVE_INFINITY),y=[];return this.zr.forEachInRange([d,f],R=>{const w=this.jr(R.Gr);y.push(w)}),pt.resolve(y)}getAllMutationBatchesAffectingDocumentKeys(i,a){let d=new Ss(Kn);return a.forEach(f=>{const y=new Ls(f,0),R=new Ls(f,Number.POSITIVE_INFINITY);this.zr.forEachInRange([y,R],w=>{d=d.add(w.Gr)})}),pt.resolve(this.Jr(d))}getAllMutationBatchesAffectingQuery(i,a){const d=a.path,f=d.length+1;let y=d;Qt.isDocumentKey(y)||(y=y.child(""));const R=new Ls(new Qt(y),0);let w=new Ss(Kn);return this.zr.forEachWhile(N=>{const O=N.key.path;return!!d.isPrefixOf(O)&&(O.length===f&&(w=w.add(N.Gr)),!0)},R),pt.resolve(this.Jr(w))}Jr(i){const a=[];return i.forEach(d=>{const f=this.jr(d);f!==null&&a.push(f)}),a}removeMutationBatch(i,a){Li(this.Yr(a.batchId,"removed")===0,55003),this.mutationQueue.shift();let d=this.zr;return pt.forEach(a.mutations,f=>{const y=new Ls(f.key,a.batchId);return d=d.delete(y),this.referenceDelegate.markPotentiallyOrphaned(i,f.key)}).next(()=>{this.zr=d})}Xn(i){}containsKey(i,a){const d=new Ls(a,0),f=this.zr.firstAfterOrEqual(d);return pt.resolve(a.isEqual(f&&f.key))}performConsistencyCheck(i){return this.mutationQueue.length,pt.resolve()}Yr(i,a){return this.Hr(i)}Hr(i){return this.mutationQueue.length===0?0:i-this.mutationQueue[0].batchId}jr(i){const a=this.Hr(i);return a<0||a>=this.mutationQueue.length?null:this.mutationQueue[a]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oue{constructor(i){this.Zr=i,this.docs=function(){return new wr(Qt.comparator)}(),this.size=0}setIndexManager(i){this.indexManager=i}addEntry(i,a){const d=a.key,f=this.docs.get(d),y=f?f.size:0,R=this.Zr(a);return this.docs=this.docs.insert(d,{document:a.mutableCopy(),size:R}),this.size+=R-y,this.indexManager.addToCollectionParentIndex(i,d.path.popLast())}removeEntry(i){const a=this.docs.get(i);a&&(this.docs=this.docs.remove(i),this.size-=a.size)}getEntry(i,a){const d=this.docs.get(a);return pt.resolve(d?d.document.mutableCopy():_a.newInvalidDocument(a))}getEntries(i,a){let d=ah();return a.forEach(f=>{const y=this.docs.get(f);d=d.insert(f,y?y.document.mutableCopy():_a.newInvalidDocument(f))}),pt.resolve(d)}getDocumentsMatchingQuery(i,a,d,f){let y=ah();const R=a.path,w=new Qt(R.child("__id-9223372036854775808__")),N=this.docs.getIteratorFrom(w);for(;N.hasNext();){const{key:O,value:{document:x}}=N.getNext();if(!R.isPrefixOf(O.path))break;O.path.length>R.length+1||ade(sde(x),d)<=0||(f.has(x.key)||KI(a,x))&&(y=y.insert(x.key,x.mutableCopy()))}return pt.resolve(y)}getAllFromCollectionGroup(i,a,d,f){pn(9500)}Xr(i,a){return pt.forEach(this.docs,d=>a(d))}newChangeBuffer(i){return new Due(this)}getSize(i){return pt.resolve(this.size)}}class Due extends Rue{constructor(i){super(),this.vr=i}applyChanges(i){const a=[];return this.changes.forEach((d,f)=>{f.isValidDocument()?a.push(this.vr.addEntry(i,f)):this.vr.removeEntry(d)}),pt.waitFor(a)}getFromCache(i,a){return this.vr.getEntry(i,a)}getAllFromCache(i,a){return this.vr.getEntries(i,a)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pue{constructor(i){this.persistence=i,this.ei=new d_(a=>s1(a),a1),this.lastRemoteSnapshotVersion=Tn.min(),this.highestTargetId=0,this.ti=0,this.ni=new p1,this.targetCount=0,this.ri=py.rr()}forEachTarget(i,a){return this.ei.forEach((d,f)=>a(f)),pt.resolve()}getLastRemoteSnapshotVersion(i){return pt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(i){return pt.resolve(this.ti)}allocateTargetId(i){return this.highestTargetId=this.ri.next(),pt.resolve(this.highestTargetId)}setTargetsMetadata(i,a,d){return d&&(this.lastRemoteSnapshotVersion=d),a>this.ti&&(this.ti=a),pt.resolve()}ar(i){this.ei.set(i.target,i);const a=i.targetId;a>this.highestTargetId&&(this.ri=new py(a),this.highestTargetId=a),i.sequenceNumber>this.ti&&(this.ti=i.sequenceNumber)}addTargetData(i,a){return this.ar(a),this.targetCount+=1,pt.resolve()}updateTargetData(i,a){return this.ar(a),pt.resolve()}removeTargetData(i,a){return this.ei.delete(a.target),this.ni.Ur(a.targetId),this.targetCount-=1,pt.resolve()}removeTargets(i,a,d){let f=0;const y=[];return this.ei.forEach((R,w)=>{w.sequenceNumber<=a&&d.get(w.targetId)===null&&(this.ei.delete(R),y.push(this.removeMatchingKeysForTargetId(i,w.targetId)),f++)}),pt.waitFor(y).next(()=>f)}getTargetCount(i){return pt.resolve(this.targetCount)}getTargetData(i,a){const d=this.ei.get(a)||null;return pt.resolve(d)}addMatchingKeys(i,a,d){return this.ni.qr(a,d),pt.resolve()}removeMatchingKeys(i,a,d){this.ni.$r(a,d);const f=this.persistence.referenceDelegate,y=[];return f&&a.forEach(R=>{y.push(f.markPotentiallyOrphaned(i,R))}),pt.waitFor(y)}removeMatchingKeysForTargetId(i,a){return this.ni.Ur(a),pt.resolve()}getMatchingKeysForTargetId(i,a){const d=this.ni.Wr(a);return pt.resolve(d)}containsKey(i,a){return pt.resolve(this.ni.containsKey(a))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iW{constructor(i,a){this.ii={},this.overlays={},this.si=new HI(0),this.oi=!1,this.oi=!0,this._i=new Iue,this.referenceDelegate=i(this),this.ai=new Pue(this),this.indexManager=new _ue,this.remoteDocumentCache=function(f){return new Oue(f)}(d=>this.referenceDelegate.ui(d)),this.serializer=new fue(a),this.ci=new wue(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.oi=!1,Promise.resolve()}get started(){return this.oi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(i){return this.indexManager}getDocumentOverlayCache(i){let a=this.overlays[i.toKey()];return a||(a=new Aue,this.overlays[i.toKey()]=a),a}getMutationQueue(i,a){let d=this.ii[i.toKey()];return d||(d=new Nue(a,this.referenceDelegate),this.ii[i.toKey()]=d),d}getGlobalsCache(){return this._i}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.ci}runTransaction(i,a,d){Mt("MemoryPersistence","Starting transaction:",i);const f=new Lue(this.si.next());return this.referenceDelegate.li(),d(f).next(y=>this.referenceDelegate.hi(f).next(()=>y)).toPromise().then(y=>(f.raiseOnCommittedEvent(),y))}Pi(i,a){return pt.or(Object.values(this.ii).map(d=>()=>d.containsKey(i,a)))}}class Lue extends cde{constructor(i){super(),this.currentSequenceNumber=i}}class f1{constructor(i){this.persistence=i,this.Ti=new p1,this.Ii=null}static Ei(i){return new f1(i)}get di(){if(this.Ii)return this.Ii;throw pn(60996)}addReference(i,a,d){return this.Ti.addReference(d,a),this.di.delete(d.toString()),pt.resolve()}removeReference(i,a,d){return this.Ti.removeReference(d,a),this.di.add(d.toString()),pt.resolve()}markPotentiallyOrphaned(i,a){return this.di.add(a.toString()),pt.resolve()}removeTarget(i,a){this.Ti.Ur(a.targetId).forEach(f=>this.di.add(f.toString()));const d=this.persistence.getTargetCache();return d.getMatchingKeysForTargetId(i,a.targetId).next(f=>{f.forEach(y=>this.di.add(y.toString()))}).next(()=>d.removeTargetData(i,a))}li(){this.Ii=new Set}hi(i){const a=this.persistence.getRemoteDocumentCache().newChangeBuffer();return pt.forEach(this.di,d=>{const f=Qt.fromPath(d);return this.Ai(i,f).next(y=>{y||a.removeEntry(f,Tn.min())})}).next(()=>(this.Ii=null,a.apply(i)))}updateLimboDocument(i,a){return this.Ai(i,a).next(d=>{d?this.di.delete(a.toString()):this.di.add(a.toString())})}ui(i){return 0}Ai(i,a){return pt.or([()=>pt.resolve(this.Ti.containsKey(a)),()=>this.persistence.getTargetCache().containsKey(i,a),()=>this.persistence.Pi(i,a)])}}class gI{constructor(i,a){this.persistence=i,this.Ri=new d_(d=>ude(d.path),(d,f)=>d.isEqual(f)),this.garbageCollector=Tue(this,a)}static Ei(i,a){return new gI(i,a)}li(){}hi(i){return pt.resolve()}forEachTarget(i,a){return this.persistence.getTargetCache().forEachTarget(i,a)}dr(i){const a=this.Vr(i);return this.persistence.getTargetCache().getTargetCount(i).next(d=>a.next(f=>d+f))}Vr(i){let a=0;return this.Ar(i,d=>{a++}).next(()=>a)}Ar(i,a){return pt.forEach(this.Ri,(d,f)=>this.gr(i,d,f).next(y=>y?pt.resolve():a(f)))}removeTargets(i,a,d){return this.persistence.getTargetCache().removeTargets(i,a,d)}removeOrphanedDocuments(i,a){let d=0;const f=this.persistence.getRemoteDocumentCache(),y=f.newChangeBuffer();return f.Xr(i,R=>this.gr(i,R,a).next(w=>{w||(d++,y.removeEntry(R,Tn.min()))})).next(()=>y.apply(i)).next(()=>d)}markPotentiallyOrphaned(i,a){return this.Ri.set(a,i.currentSequenceNumber),pt.resolve()}removeTarget(i,a){const d=a.withSequenceNumber(i.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(i,d)}addReference(i,a,d){return this.Ri.set(d,i.currentSequenceNumber),pt.resolve()}removeReference(i,a,d){return this.Ri.set(d,i.currentSequenceNumber),pt.resolve()}updateLimboDocument(i,a){return this.Ri.set(a,i.currentSequenceNumber),pt.resolve()}ui(i){let a=i.key.toString().length;return i.isFoundDocument()&&(a+=G0(i.data.value)),a}gr(i,a,d){return pt.or([()=>this.persistence.Pi(i,a),()=>this.persistence.getTargetCache().containsKey(i,a),()=>{const f=this.Ri.get(a);return pt.resolve(f!==void 0&&f>d)}])}getCacheSize(i){return this.persistence.getRemoteDocumentCache().getSize(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m1{constructor(i,a,d,f){this.targetId=i,this.fromCache=a,this.ls=d,this.hs=f}static Ps(i,a){let d=ti(),f=ti();for(const y of a.docChanges)switch(y.type){case 0:d=d.add(y.doc.key);break;case 1:f=f.add(y.doc.key)}return new m1(i,a.fromCache,d,f)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kue{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(i){this._documentReadCount+=i}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xue{constructor(){this.Ts=!1,this.Is=!1,this.Es=100,this.ds=function(){return Dce()?8:lde(Nce())>0?6:4}()}initialize(i,a){this.As=i,this.indexManager=a,this.Ts=!0}getDocumentsMatchingQuery(i,a,d,f){const y={result:null};return this.Rs(i,a).next(R=>{y.result=R}).next(()=>{if(!y.result)return this.Vs(i,a,f,d).next(R=>{y.result=R})}).next(()=>{if(y.result)return;const R=new kue;return this.fs(i,a,R).next(w=>{if(y.result=w,this.Is)return this.gs(i,a,R,w.size)})}).next(()=>y.result)}gs(i,a,d,f){return d.documentReadCount<this.Es?(XE()<=di.DEBUG&&Mt("QueryEngine","SDK will not create cache indexes for query:",JE(a),"since it only creates cache indexes for collection contains","more than or equal to",this.Es,"documents"),pt.resolve()):(XE()<=di.DEBUG&&Mt("QueryEngine","Query:",JE(a),"scans",d.documentReadCount,"local documents and returns",f,"documents as results."),d.documentReadCount>this.ds*f?(XE()<=di.DEBUG&&Mt("QueryEngine","The SDK decides to create cache indexes for query:",JE(a),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(i,Vd(a))):pt.resolve())}Rs(i,a){if(OH(a))return pt.resolve(null);let d=Vd(a);return this.indexManager.getIndexType(i,d).next(f=>f===0?null:(a.limit!==null&&f===1&&(a=yx(a,null,"F"),d=Vd(a)),this.indexManager.getDocumentsMatchingTarget(i,d).next(y=>{const R=ti(...y);return this.As.getDocuments(i,R).next(w=>this.indexManager.getMinOffset(i,d).next(N=>{const O=this.ps(a,w);return this.ys(a,O,R,N.readTime)?this.Rs(i,yx(a,null,"F")):this.ws(i,O,a,N)}))})))}Vs(i,a,d,f){return OH(a)||f.isEqual(Tn.min())?pt.resolve(null):this.As.getDocuments(i,d).next(y=>{const R=this.ps(a,y);return this.ys(a,R,d,f)?pt.resolve(null):(XE()<=di.DEBUG&&Mt("QueryEngine","Re-using previous result from %s to execute query: %s",f.toString(),JE(a)),this.ws(i,R,a,rde(f,fR)).next(w=>w))})}ps(i,a){let d=new Ss(x8(i));return a.forEach((f,y)=>{KI(i,y)&&(d=d.add(y))}),d}ys(i,a,d,f){if(i.limit===null)return!1;if(d.size!==a.size)return!0;const y=i.limitType==="F"?a.last():a.first();return!!y&&(y.hasPendingWrites||y.version.compareTo(f)>0)}fs(i,a,d){return XE()<=di.DEBUG&&Mt("QueryEngine","Using full collection scan to execute query:",JE(a)),this.As.getDocumentsMatchingQuery(i,a,Vp.min(),d)}ws(i,a,d,f){return this.As.getDocumentsMatchingQuery(i,d,f).next(y=>(a.forEach(R=>{y=y.insert(R.key,R)}),y))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _1="LocalStore",Mue=3e8;class Uue{constructor(i,a,d,f){this.persistence=i,this.bs=a,this.serializer=f,this.Ss=new wr(Kn),this.Ds=new d_(y=>s1(y),a1),this.vs=new Map,this.Cs=i.getRemoteDocumentCache(),this.ai=i.getTargetCache(),this.ci=i.getBundleCache(),this.Fs(d)}Fs(i){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(i),this.indexManager=this.persistence.getIndexManager(i),this.mutationQueue=this.persistence.getMutationQueue(i,this.indexManager),this.localDocuments=new Cue(this.Cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Cs.setIndexManager(this.indexManager),this.bs.initialize(this.localDocuments,this.indexManager)}collectGarbage(i){return this.persistence.runTransaction("Collect garbage","readwrite-primary",a=>i.collect(a,this.Ss))}}function jue(o,i,a,d){return new Uue(o,i,a,d)}async function rW(o,i){const a=bn(o);return await a.persistence.runTransaction("Handle user change","readonly",d=>{let f;return a.mutationQueue.getAllMutationBatches(d).next(y=>(f=y,a.Fs(i),a.mutationQueue.getAllMutationBatches(d))).next(y=>{const R=[],w=[];let N=ti();for(const O of f){R.push(O.batchId);for(const x of O.mutations)N=N.add(x.key)}for(const O of y){w.push(O.batchId);for(const x of O.mutations)N=N.add(x.key)}return a.localDocuments.getDocuments(d,N).next(O=>({Ms:O,removedBatchIds:R,addedBatchIds:w}))})})}function Vue(o,i){const a=bn(o);return a.persistence.runTransaction("Acknowledge batch","readwrite-primary",d=>{const f=i.batch.keys(),y=a.Cs.newChangeBuffer({trackRemovals:!0});return function(w,N,O,x){const G=O.batch,W=G.keys();let ne=pt.resolve();return W.forEach(Q=>{ne=ne.next(()=>x.getEntry(N,Q)).next(se=>{const te=O.docVersions.get(Q);Li(te!==null,48541),se.version.compareTo(te)<0&&(G.applyToRemoteDocument(se,O),se.isValidDocument()&&(se.setReadTime(O.commitVersion),x.addEntry(se)))})}),ne.next(()=>w.mutationQueue.removeMutationBatch(N,G))}(a,d,i,y).next(()=>y.apply(d)).next(()=>a.mutationQueue.performConsistencyCheck(d)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(d,f,i.batch.batchId)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,function(w){let N=ti();for(let O=0;O<w.mutationResults.length;++O)w.mutationResults[O].transformResults.length>0&&(N=N.add(w.batch.mutations[O].key));return N}(i))).next(()=>a.localDocuments.getDocuments(d,f))})}function sW(o){const i=bn(o);return i.persistence.runTransaction("Get last remote snapshot version","readonly",a=>i.ai.getLastRemoteSnapshotVersion(a))}function Fue(o,i){const a=bn(o),d=i.snapshotVersion;let f=a.Ss;return a.persistence.runTransaction("Apply remote event","readwrite-primary",y=>{const R=a.Cs.newChangeBuffer({trackRemovals:!0});f=a.Ss;const w=[];i.targetChanges.forEach((x,G)=>{const W=f.get(G);if(!W)return;w.push(a.ai.removeMatchingKeys(y,x.removedDocuments,G).next(()=>a.ai.addMatchingKeys(y,x.addedDocuments,G)));let ne=W.withSequenceNumber(y.currentSequenceNumber);i.targetMismatches.get(G)!==null?ne=ne.withResumeToken(Js.EMPTY_BYTE_STRING,Tn.min()).withLastLimboFreeSnapshotVersion(Tn.min()):x.resumeToken.approximateByteSize()>0&&(ne=ne.withResumeToken(x.resumeToken,d)),f=f.insert(G,ne),function(se,te,le){return se.resumeToken.approximateByteSize()===0||te.snapshotVersion.toMicroseconds()-se.snapshotVersion.toMicroseconds()>=Mue?!0:le.addedDocuments.size+le.modifiedDocuments.size+le.removedDocuments.size>0}(W,ne,x)&&w.push(a.ai.updateTargetData(y,ne))});let N=ah(),O=ti();if(i.documentUpdates.forEach(x=>{i.resolvedLimboDocuments.has(x)&&w.push(a.persistence.referenceDelegate.updateLimboDocument(y,x))}),w.push(Bue(y,R,i.documentUpdates).next(x=>{N=x.xs,O=x.Os})),!d.isEqual(Tn.min())){const x=a.ai.getLastRemoteSnapshotVersion(y).next(G=>a.ai.setTargetsMetadata(y,y.currentSequenceNumber,d));w.push(x)}return pt.waitFor(w).next(()=>R.apply(y)).next(()=>a.localDocuments.getLocalViewOfDocuments(y,N,O)).next(()=>N)}).then(y=>(a.Ss=f,y))}function Bue(o,i,a){let d=ti(),f=ti();return a.forEach(y=>d=d.add(y)),i.getEntries(o,d).next(y=>{let R=ah();return a.forEach((w,N)=>{const O=y.get(w);N.isFoundDocument()!==O.isFoundDocument()&&(f=f.add(w)),N.isNoDocument()&&N.version.isEqual(Tn.min())?(i.removeEntry(w,N.readTime),R=R.insert(w,N)):!O.isValidDocument()||N.version.compareTo(O.version)>0||N.version.compareTo(O.version)===0&&O.hasPendingWrites?(i.addEntry(N),R=R.insert(w,N)):Mt(_1,"Ignoring outdated watch update for ",w,". Current version:",O.version," Watch version:",N.version)}),{xs:R,Os:f}})}function Gue(o,i){const a=bn(o);return a.persistence.runTransaction("Get next mutation batch","readonly",d=>(i===void 0&&(i=n1),a.mutationQueue.getNextMutationBatchAfterBatchId(d,i)))}function Hue(o,i){const a=bn(o);return a.persistence.runTransaction("Allocate target","readwrite",d=>{let f;return a.ai.getTargetData(d,i).next(y=>y?(f=y,pt.resolve(f)):a.ai.allocateTargetId(d).next(R=>(f=new Lp(i,R,"TargetPurposeListen",d.currentSequenceNumber),a.ai.addTargetData(d,f).next(()=>f))))}).then(d=>{const f=a.Ss.get(d.targetId);return(f===null||d.snapshotVersion.compareTo(f.snapshotVersion)>0)&&(a.Ss=a.Ss.insert(d.targetId,d),a.Ds.set(i,d.targetId)),d})}async function bx(o,i,a){const d=bn(o),f=d.Ss.get(i),y=a?"readwrite":"readwrite-primary";try{a||await d.persistence.runTransaction("Release target",y,R=>d.persistence.referenceDelegate.removeTarget(R,f))}catch(R){if(!wy(R))throw R;Mt(_1,`Failed to update sequence numbers for target ${i}: ${R}`)}d.Ss=d.Ss.remove(i),d.Ds.delete(f.target)}function HH(o,i,a){const d=bn(o);let f=Tn.min(),y=ti();return d.persistence.runTransaction("Execute query","readwrite",R=>function(N,O,x){const G=bn(N),W=G.Ds.get(x);return W!==void 0?pt.resolve(G.Ss.get(W)):G.ai.getTargetData(O,x)}(d,R,Vd(i)).next(w=>{if(w)return f=w.lastLimboFreeSnapshotVersion,d.ai.getMatchingKeysForTargetId(R,w.targetId).next(N=>{y=N})}).next(()=>d.bs.getDocumentsMatchingQuery(R,i,a?f:Tn.min(),a?y:ti())).next(w=>(zue(d,Ode(i),w),{documents:w,Ns:y})))}function zue(o,i,a){let d=o.vs.get(i)||Tn.min();a.forEach((f,y)=>{y.readTime.compareTo(d)>0&&(d=y.readTime)}),o.vs.set(i,d)}class zH{constructor(){this.activeTargetIds=Mde()}$s(i){this.activeTargetIds=this.activeTargetIds.add(i)}Us(i){this.activeTargetIds=this.activeTargetIds.delete(i)}Qs(){const i={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(i)}}class Wue{constructor(){this.So=new zH,this.Do={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(i){}updateMutationState(i,a,d){}addLocalQueryTarget(i,a=!0){return a&&this.So.$s(i),this.Do[i]||"not-current"}updateQueryState(i,a,d){this.Do[i]=a}removeLocalQueryTarget(i){this.So.Us(i)}isLocalQueryTarget(i){return this.So.activeTargetIds.has(i)}clearQueryState(i){delete this.Do[i]}getAllActiveQueryTargets(){return this.So.activeTargetIds}isActiveQueryTarget(i){return this.So.activeTargetIds.has(i)}start(){return this.So=new zH,Promise.resolve()}handleUserChange(i,a,d){}setOnlineState(i){}shutdown(){}writeSequenceNumber(i){}notifyBundleLoaded(i){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class que{vo(i){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WH="ConnectivityMonitor";class qH{constructor(){this.Co=()=>this.Fo(),this.Mo=()=>this.xo(),this.Oo=[],this.No()}vo(i){this.Oo.push(i)}shutdown(){window.removeEventListener("online",this.Co),window.removeEventListener("offline",this.Mo)}No(){window.addEventListener("online",this.Co),window.addEventListener("offline",this.Mo)}Fo(){Mt(WH,"Network connectivity changed: AVAILABLE");for(const i of this.Oo)i(0)}xo(){Mt(WH,"Network connectivity changed: UNAVAILABLE");for(const i of this.Oo)i(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let o0=null;function Cx(){return o0===null?o0=function(){return 268435456+Math.round(2147483648*Math.random())}():o0++,"0x"+o0.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rk="RestConnection",Kue={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Yue{get Bo(){return!1}constructor(i){this.databaseInfo=i,this.databaseId=i.databaseId;const a=i.ssl?"https":"http",d=encodeURIComponent(this.databaseId.projectId),f=encodeURIComponent(this.databaseId.database);this.Lo=a+"://"+i.host,this.ko=`projects/${d}/databases/${f}`,this.qo=this.databaseId.database===uI?`project_id=${d}`:`project_id=${d}&database_id=${f}`}Qo(i,a,d,f,y){const R=Cx(),w=this.$o(i,a.toUriEncodedString());Mt(Rk,`Sending RPC '${i}' ${R}:`,w,d);const N={"google-cloud-resource-prefix":this.ko,"x-goog-request-params":this.qo};return this.Uo(N,f,y),this.Ko(i,w,N,d).then(O=>(Mt(Rk,`Received RPC '${i}' ${R}: `,O),O),O=>{throw ly(Rk,`RPC '${i}' ${R} failed with error: `,O,"url: ",w,"request:",d),O})}Wo(i,a,d,f,y,R){return this.Qo(i,a,d,f,y)}Uo(i,a,d){i["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+by}(),i["Content-Type"]="text/plain",this.databaseInfo.appId&&(i["X-Firebase-GMPID"]=this.databaseInfo.appId),a&&a.headers.forEach((f,y)=>i[y]=f),d&&d.headers.forEach((f,y)=>i[y]=f)}$o(i,a){const d=Kue[i];return`${this.Lo}/v1/${a}:${d}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xue{constructor(i){this.Go=i.Go,this.zo=i.zo}jo(i){this.Ho=i}Jo(i){this.Yo=i}Zo(i){this.Xo=i}onMessage(i){this.e_=i}close(){this.zo()}send(i){this.Go(i)}t_(){this.Ho()}n_(){this.Yo()}r_(i){this.Xo(i)}i_(i){this.e_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fa="WebChannelConnection";class Jue extends Yue{constructor(i){super(i),this.forceLongPolling=i.forceLongPolling,this.autoDetectLongPolling=i.autoDetectLongPolling,this.useFetchStreams=i.useFetchStreams,this.longPollingOptions=i.longPollingOptions}Ko(i,a,d,f){const y=Cx();return new Promise((R,w)=>{const N=new c8;N.setWithCredentials(!0),N.listenOnce(l8.COMPLETE,()=>{try{switch(N.getLastErrorCode()){case B0.NO_ERROR:const x=N.getResponseJson();Mt(fa,`XHR for RPC '${i}' ${y} received:`,JSON.stringify(x)),R(x);break;case B0.TIMEOUT:Mt(fa,`RPC '${i}' ${y} timed out`),w(new Ut(ht.DEADLINE_EXCEEDED,"Request time out"));break;case B0.HTTP_ERROR:const G=N.getStatus();if(Mt(fa,`RPC '${i}' ${y} failed with status:`,G,"response text:",N.getResponseText()),G>0){let W=N.getResponseJson();Array.isArray(W)&&(W=W[0]);const ne=W==null?void 0:W.error;if(ne&&ne.status&&ne.message){const Q=function(te){const le=te.toLowerCase().replace(/_/g,"-");return Object.values(ht).indexOf(le)>=0?le:ht.UNKNOWN}(ne.status);w(new Ut(Q,ne.message))}else w(new Ut(ht.UNKNOWN,"Server responded with status "+N.getStatus()))}else w(new Ut(ht.UNAVAILABLE,"Connection failed."));break;default:pn(9055,{s_:i,streamId:y,o_:N.getLastErrorCode(),__:N.getLastError()})}}finally{Mt(fa,`RPC '${i}' ${y} completed.`)}});const O=JSON.stringify(f);Mt(fa,`RPC '${i}' ${y} sending request:`,f),N.send(a,"POST",O,d,15)})}a_(i,a,d){const f=Cx(),y=[this.Lo,"/","google.firestore.v1.Firestore","/",i,"/channel"],R=h8(),w=u8(),N={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},O=this.longPollingOptions.timeoutSeconds;O!==void 0&&(N.longPollingTimeout=Math.round(1e3*O)),this.useFetchStreams&&(N.useFetchStreams=!0),this.Uo(N.initMessageHeaders,a,d),N.encodeInitMessageHeaders=!0;const x=y.join("");Mt(fa,`Creating RPC '${i}' stream ${f}: ${x}`,N);const G=R.createWebChannel(x,N);let W=!1,ne=!1;const Q=new Xue({Go:te=>{ne?Mt(fa,`Not sending because RPC '${i}' stream ${f} is closed:`,te):(W||(Mt(fa,`Opening RPC '${i}' stream ${f} transport.`),G.open(),W=!0),Mt(fa,`RPC '${i}' stream ${f} sending:`,te),G.send(te))},zo:()=>G.close()}),se=(te,le,ce)=>{te.listen(le,me=>{try{ce(me)}catch(Ce){setTimeout(()=>{throw Ce},0)}})};return se(G,WT.EventType.OPEN,()=>{ne||(Mt(fa,`RPC '${i}' stream ${f} transport opened.`),Q.t_())}),se(G,WT.EventType.CLOSE,()=>{ne||(ne=!0,Mt(fa,`RPC '${i}' stream ${f} transport closed`),Q.r_())}),se(G,WT.EventType.ERROR,te=>{ne||(ne=!0,ly(fa,`RPC '${i}' stream ${f} transport errored. Name:`,te.name,"Message:",te.message),Q.r_(new Ut(ht.UNAVAILABLE,"The operation could not be completed")))}),se(G,WT.EventType.MESSAGE,te=>{var le;if(!ne){const ce=te.data[0];Li(!!ce,16349);const me=ce,Ce=(me==null?void 0:me.error)||((le=me[0])===null||le===void 0?void 0:le.error);if(Ce){Mt(fa,`RPC '${i}' stream ${f} received error:`,Ce);const _e=Ce.status;let ze=function($){const fe=ds[$];if(fe!==void 0)return q8(fe)}(_e),Z=Ce.message;ze===void 0&&(ze=ht.INTERNAL,Z="Unknown error status: "+_e+" with message "+Ce.message),ne=!0,Q.r_(new Ut(ze,Z)),G.close()}else Mt(fa,`RPC '${i}' stream ${f} received:`,ce),Q.i_(ce)}}),se(w,d8.STAT_EVENT,te=>{te.stat===hx.PROXY?Mt(fa,`RPC '${i}' stream ${f} detected buffering proxy`):te.stat===hx.NOPROXY&&Mt(fa,`RPC '${i}' stream ${f} detected no buffering proxy`)}),setTimeout(()=>{Q.n_()},0),Q}}function bk(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QI(o){return new eue(o,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aW{constructor(i,a,d=1e3,f=1.5,y=6e4){this.bi=i,this.timerId=a,this.u_=d,this.c_=f,this.l_=y,this.h_=0,this.P_=null,this.T_=Date.now(),this.reset()}reset(){this.h_=0}I_(){this.h_=this.l_}E_(i){this.cancel();const a=Math.floor(this.h_+this.d_()),d=Math.max(0,Date.now()-this.T_),f=Math.max(0,a-d);f>0&&Mt("ExponentialBackoff",`Backing off for ${f} ms (base delay: ${this.h_} ms, delay with jitter: ${a} ms, last attempt: ${d} ms ago)`),this.P_=this.bi.enqueueAfterDelay(this.timerId,f,()=>(this.T_=Date.now(),i())),this.h_*=this.c_,this.h_<this.u_&&(this.h_=this.u_),this.h_>this.l_&&(this.h_=this.l_)}A_(){this.P_!==null&&(this.P_.skipDelay(),this.P_=null)}cancel(){this.P_!==null&&(this.P_.cancel(),this.P_=null)}d_(){return(Math.random()-.5)*this.h_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KH="PersistentStream";class oW{constructor(i,a,d,f,y,R,w,N){this.bi=i,this.R_=d,this.V_=f,this.connection=y,this.authCredentialsProvider=R,this.appCheckCredentialsProvider=w,this.listener=N,this.state=0,this.m_=0,this.f_=null,this.g_=null,this.stream=null,this.p_=0,this.y_=new aW(i,a)}w_(){return this.state===1||this.state===5||this.b_()}b_(){return this.state===2||this.state===3}start(){this.p_=0,this.state!==4?this.auth():this.S_()}async stop(){this.w_()&&await this.close(0)}D_(){this.state=0,this.y_.reset()}v_(){this.b_()&&this.f_===null&&(this.f_=this.bi.enqueueAfterDelay(this.R_,6e4,()=>this.C_()))}F_(i){this.M_(),this.stream.send(i)}async C_(){if(this.b_())return this.close(0)}M_(){this.f_&&(this.f_.cancel(),this.f_=null)}x_(){this.g_&&(this.g_.cancel(),this.g_=null)}async close(i,a){this.M_(),this.x_(),this.y_.cancel(),this.m_++,i!==4?this.y_.reset():a&&a.code===ht.RESOURCE_EXHAUSTED?(sh(a.toString()),sh("Using maximum backoff delay to prevent overloading the backend."),this.y_.I_()):a&&a.code===ht.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.O_(),this.stream.close(),this.stream=null),this.state=i,await this.listener.Zo(a)}O_(){}auth(){this.state=1;const i=this.N_(this.m_),a=this.m_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([d,f])=>{this.m_===a&&this.B_(d,f)},d=>{i(()=>{const f=new Ut(ht.UNKNOWN,"Fetching auth token failed: "+d.message);return this.L_(f)})})}B_(i,a){const d=this.N_(this.m_);this.stream=this.k_(i,a),this.stream.jo(()=>{d(()=>this.listener.jo())}),this.stream.Jo(()=>{d(()=>(this.state=2,this.g_=this.bi.enqueueAfterDelay(this.V_,1e4,()=>(this.b_()&&(this.state=3),Promise.resolve())),this.listener.Jo()))}),this.stream.Zo(f=>{d(()=>this.L_(f))}),this.stream.onMessage(f=>{d(()=>++this.p_==1?this.q_(f):this.onNext(f))})}S_(){this.state=5,this.y_.E_(async()=>{this.state=0,this.start()})}L_(i){return Mt(KH,`close with error: ${i}`),this.stream=null,this.close(4,i)}N_(i){return a=>{this.bi.enqueueAndForget(()=>this.m_===i?a():(Mt(KH,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Que extends oW{constructor(i,a,d,f,y,R){super(i,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",a,d,f,R),this.serializer=y}k_(i,a){return this.connection.a_("Listen",i,a)}q_(i){return this.onNext(i)}onNext(i){this.y_.reset();const a=iue(this.serializer,i),d=function(y){if(!("targetChange"in y))return Tn.min();const R=y.targetChange;return R.targetIds&&R.targetIds.length?Tn.min():R.readTime?Fd(R.readTime):Tn.min()}(i);return this.listener.Q_(a,d)}U_(i){const a={};a.database=Rx(this.serializer),a.addTarget=function(y,R){let w;const N=R.target;if(w=gx(N)?{documents:aue(y,N)}:{query:oue(y,N).gt},w.targetId=R.targetId,R.resumeToken.approximateByteSize()>0){w.resumeToken=X8(y,R.resumeToken);const O=vx(y,R.expectedCount);O!==null&&(w.expectedCount=O)}else if(R.snapshotVersion.compareTo(Tn.min())>0){w.readTime=_I(y,R.snapshotVersion.toTimestamp());const O=vx(y,R.expectedCount);O!==null&&(w.expectedCount=O)}return w}(this.serializer,i);const d=lue(this.serializer,i);d&&(a.labels=d),this.F_(a)}K_(i){const a={};a.database=Rx(this.serializer),a.removeTarget=i,this.F_(a)}}class $ue extends oW{constructor(i,a,d,f,y,R){super(i,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",a,d,f,R),this.serializer=y}get W_(){return this.p_>0}start(){this.lastStreamToken=void 0,super.start()}O_(){this.W_&&this.G_([])}k_(i,a){return this.connection.a_("Write",i,a)}q_(i){return Li(!!i.streamToken,31322),this.lastStreamToken=i.streamToken,Li(!i.writeResults||i.writeResults.length===0,55816),this.listener.z_()}onNext(i){Li(!!i.streamToken,12678),this.lastStreamToken=i.streamToken,this.y_.reset();const a=sue(i.writeResults,i.commitTime),d=Fd(i.commitTime);return this.listener.j_(d,a)}H_(){const i={};i.database=Rx(this.serializer),this.F_(i)}G_(i){const a={streamToken:this.lastStreamToken,writes:i.map(d=>rue(this.serializer,d))};this.F_(a)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zue{}class ehe extends Zue{constructor(i,a,d,f){super(),this.authCredentials=i,this.appCheckCredentials=a,this.connection=d,this.serializer=f,this.J_=!1}Y_(){if(this.J_)throw new Ut(ht.FAILED_PRECONDITION,"The client has already been terminated.")}Qo(i,a,d,f){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([y,R])=>this.connection.Qo(i,Sx(a,d),f,y,R)).catch(y=>{throw y.name==="FirebaseError"?(y.code===ht.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),y):new Ut(ht.UNKNOWN,y.toString())})}Wo(i,a,d,f,y){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([R,w])=>this.connection.Wo(i,Sx(a,d),f,R,w,y)).catch(R=>{throw R.name==="FirebaseError"?(R.code===ht.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),R):new Ut(ht.UNKNOWN,R.toString())})}terminate(){this.J_=!0,this.connection.terminate()}}class the{constructor(i,a){this.asyncQueue=i,this.onlineStateHandler=a,this.state="Unknown",this.Z_=0,this.X_=null,this.ea=!0}ta(){this.Z_===0&&(this.na("Unknown"),this.X_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.X_=null,this.ra("Backend didn't respond within 10 seconds."),this.na("Offline"),Promise.resolve())))}ia(i){this.state==="Online"?this.na("Unknown"):(this.Z_++,this.Z_>=1&&(this.sa(),this.ra(`Connection failed 1 times. Most recent error: ${i.toString()}`),this.na("Offline")))}set(i){this.sa(),this.Z_=0,i==="Online"&&(this.ea=!1),this.na(i)}na(i){i!==this.state&&(this.state=i,this.onlineStateHandler(i))}ra(i){const a=`Could not reach Cloud Firestore backend. ${i}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ea?(sh(a),this.ea=!1):Mt("OnlineStateTracker",a)}sa(){this.X_!==null&&(this.X_.cancel(),this.X_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c_="RemoteStore";class nhe{constructor(i,a,d,f,y){this.localStore=i,this.datastore=a,this.asyncQueue=d,this.remoteSyncer={},this.oa=[],this._a=new Map,this.aa=new Set,this.ua=[],this.ca=y,this.ca.vo(R=>{d.enqueueAndForget(async()=>{u_(this)&&(Mt(c_,"Restarting streams for network reachability change."),await async function(N){const O=bn(N);O.aa.add(4),await PR(O),O.la.set("Unknown"),O.aa.delete(4),await $I(O)}(this))})}),this.la=new the(d,f)}}async function $I(o){if(u_(o))for(const i of o.ua)await i(!0)}async function PR(o){for(const i of o.ua)await i(!1)}function cW(o,i){const a=bn(o);a._a.has(i.targetId)||(a._a.set(i.targetId,i),v1(a)?y1(a):Iy(a).b_()&&E1(a,i))}function g1(o,i){const a=bn(o),d=Iy(a);a._a.delete(i),d.b_()&&lW(a,i),a._a.size===0&&(d.b_()?d.v_():u_(a)&&a.la.set("Unknown"))}function E1(o,i){if(o.ha.Ke(i.targetId),i.resumeToken.approximateByteSize()>0||i.snapshotVersion.compareTo(Tn.min())>0){const a=o.remoteSyncer.getRemoteKeysForTarget(i.targetId).size;i=i.withExpectedCount(a)}Iy(o).U_(i)}function lW(o,i){o.ha.Ke(i),Iy(o).K_(i)}function y1(o){o.ha=new Jde({getRemoteKeysForTarget:i=>o.remoteSyncer.getRemoteKeysForTarget(i),Rt:i=>o._a.get(i)||null,Pt:()=>o.datastore.serializer.databaseId}),Iy(o).start(),o.la.ta()}function v1(o){return u_(o)&&!Iy(o).w_()&&o._a.size>0}function u_(o){return bn(o).aa.size===0}function dW(o){o.ha=void 0}async function ihe(o){o.la.set("Online")}async function rhe(o){o._a.forEach((i,a)=>{E1(o,i)})}async function she(o,i){dW(o),v1(o)?(o.la.ia(i),y1(o)):o.la.set("Unknown")}async function ahe(o,i,a){if(o.la.set("Online"),i instanceof Y8&&i.state===2&&i.cause)try{await async function(f,y){const R=y.cause;for(const w of y.targetIds)f._a.has(w)&&(await f.remoteSyncer.rejectListen(w,R),f._a.delete(w),f.ha.removeTarget(w))}(o,i)}catch(d){Mt(c_,"Failed to remove targets %s: %s ",i.targetIds.join(","),d),await EI(o,d)}else if(i instanceof W0?o.ha.Xe(i):i instanceof K8?o.ha.ot(i):o.ha.nt(i),!a.isEqual(Tn.min()))try{const d=await sW(o.localStore);a.compareTo(d)>=0&&await function(y,R){const w=y.ha.It(R);return w.targetChanges.forEach((N,O)=>{if(N.resumeToken.approximateByteSize()>0){const x=y._a.get(O);x&&y._a.set(O,x.withResumeToken(N.resumeToken,R))}}),w.targetMismatches.forEach((N,O)=>{const x=y._a.get(N);if(!x)return;y._a.set(N,x.withResumeToken(Js.EMPTY_BYTE_STRING,x.snapshotVersion)),lW(y,N);const G=new Lp(x.target,N,O,x.sequenceNumber);E1(y,G)}),y.remoteSyncer.applyRemoteEvent(w)}(o,a)}catch(d){Mt(c_,"Failed to raise snapshot:",d),await EI(o,d)}}async function EI(o,i,a){if(!wy(i))throw i;o.aa.add(1),await PR(o),o.la.set("Offline"),a||(a=()=>sW(o.localStore)),o.asyncQueue.enqueueRetryable(async()=>{Mt(c_,"Retrying IndexedDB access"),await a(),o.aa.delete(1),await $I(o)})}function uW(o,i){return i().catch(a=>EI(o,a,i))}async function ZI(o){const i=bn(o),a=Hp(i);let d=i.oa.length>0?i.oa[i.oa.length-1].batchId:n1;for(;ohe(i);)try{const f=await Gue(i.localStore,d);if(f===null){i.oa.length===0&&a.v_();break}d=f.batchId,che(i,f)}catch(f){await EI(i,f)}hW(i)&&pW(i)}function ohe(o){return u_(o)&&o.oa.length<10}function che(o,i){o.oa.push(i);const a=Hp(o);a.b_()&&a.W_&&a.G_(i.mutations)}function hW(o){return u_(o)&&!Hp(o).w_()&&o.oa.length>0}function pW(o){Hp(o).start()}async function lhe(o){Hp(o).H_()}async function dhe(o){const i=Hp(o);for(const a of o.oa)i.G_(a.mutations)}async function uhe(o,i,a){const d=o.oa.shift(),f=d1.from(d,i,a);await uW(o,()=>o.remoteSyncer.applySuccessfulWrite(f)),await ZI(o)}async function hhe(o,i){i&&Hp(o).W_&&await async function(d,f){if(function(R){return Yde(R)&&R!==ht.ABORTED}(f.code)){const y=d.oa.shift();Hp(d).D_(),await uW(d,()=>d.remoteSyncer.rejectFailedWrite(y.batchId,f)),await ZI(d)}}(o,i),hW(o)&&pW(o)}async function YH(o,i){const a=bn(o);a.asyncQueue.verifyOperationInProgress(),Mt(c_,"RemoteStore received new credentials");const d=u_(a);a.aa.add(3),await PR(a),d&&a.la.set("Unknown"),await a.remoteSyncer.handleCredentialChange(i),a.aa.delete(3),await $I(a)}async function phe(o,i){const a=bn(o);i?(a.aa.delete(2),await $I(a)):i||(a.aa.add(2),await PR(a),a.la.set("Unknown"))}function Iy(o){return o.Pa||(o.Pa=function(a,d,f){const y=bn(a);return y.Y_(),new Que(d,y.connection,y.authCredentials,y.appCheckCredentials,y.serializer,f)}(o.datastore,o.asyncQueue,{jo:ihe.bind(null,o),Jo:rhe.bind(null,o),Zo:she.bind(null,o),Q_:ahe.bind(null,o)}),o.ua.push(async i=>{i?(o.Pa.D_(),v1(o)?y1(o):o.la.set("Unknown")):(await o.Pa.stop(),dW(o))})),o.Pa}function Hp(o){return o.Ta||(o.Ta=function(a,d,f){const y=bn(a);return y.Y_(),new $ue(d,y.connection,y.authCredentials,y.appCheckCredentials,y.serializer,f)}(o.datastore,o.asyncQueue,{jo:()=>Promise.resolve(),Jo:lhe.bind(null,o),Zo:hhe.bind(null,o),z_:dhe.bind(null,o),j_:uhe.bind(null,o)}),o.ua.push(async i=>{i?(o.Ta.D_(),await ZI(o)):(await o.Ta.stop(),o.oa.length>0&&(Mt(c_,`Stopping write stream with ${o.oa.length} pending writes`),o.oa=[]))})),o.Ta}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S1{constructor(i,a,d,f,y){this.asyncQueue=i,this.timerId=a,this.targetTimeMs=d,this.op=f,this.removalCallback=y,this.deferred=new n_,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(R=>{})}get promise(){return this.deferred.promise}static createAndSchedule(i,a,d,f,y){const R=Date.now()+d,w=new S1(i,a,R,f,y);return w.start(d),w}start(i){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),i)}skipDelay(){return this.handleDelayElapsed()}cancel(i){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ut(ht.CANCELLED,"Operation cancelled"+(i?": "+i:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(i=>this.deferred.resolve(i))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function T1(o,i){if(sh("AsyncQueue",`${i}: ${o}`),wy(o))return new Ut(ht.UNAVAILABLE,`${i}: ${o}`);throw o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ay{static emptySet(i){return new ay(i.comparator)}constructor(i){this.comparator=i?(a,d)=>i(a,d)||Qt.comparator(a.key,d.key):(a,d)=>Qt.comparator(a.key,d.key),this.keyedMap=qT(),this.sortedSet=new wr(this.comparator)}has(i){return this.keyedMap.get(i)!=null}get(i){return this.keyedMap.get(i)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(i){const a=this.keyedMap.get(i);return a?this.sortedSet.indexOf(a):-1}get size(){return this.sortedSet.size}forEach(i){this.sortedSet.inorderTraversal((a,d)=>(i(a),!1))}add(i){const a=this.delete(i.key);return a.copy(a.keyedMap.insert(i.key,i),a.sortedSet.insert(i,null))}delete(i){const a=this.get(i);return a?this.copy(this.keyedMap.remove(i),this.sortedSet.remove(a)):this}isEqual(i){if(!(i instanceof ay)||this.size!==i.size)return!1;const a=this.sortedSet.getIterator(),d=i.sortedSet.getIterator();for(;a.hasNext();){const f=a.getNext().key,y=d.getNext().key;if(!f.isEqual(y))return!1}return!0}toString(){const i=[];return this.forEach(a=>{i.push(a.toString())}),i.length===0?"DocumentSet ()":`DocumentSet (
  `+i.join(`  
`)+`
)`}copy(i,a){const d=new ay;return d.comparator=this.comparator,d.keyedMap=i,d.sortedSet=a,d}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XH{constructor(){this.Ia=new wr(Qt.comparator)}track(i){const a=i.doc.key,d=this.Ia.get(a);d?i.type!==0&&d.type===3?this.Ia=this.Ia.insert(a,i):i.type===3&&d.type!==1?this.Ia=this.Ia.insert(a,{type:d.type,doc:i.doc}):i.type===2&&d.type===2?this.Ia=this.Ia.insert(a,{type:2,doc:i.doc}):i.type===2&&d.type===0?this.Ia=this.Ia.insert(a,{type:0,doc:i.doc}):i.type===1&&d.type===0?this.Ia=this.Ia.remove(a):i.type===1&&d.type===2?this.Ia=this.Ia.insert(a,{type:1,doc:d.doc}):i.type===0&&d.type===1?this.Ia=this.Ia.insert(a,{type:2,doc:i.doc}):pn(63341,{Vt:i,Ea:d}):this.Ia=this.Ia.insert(a,i)}da(){const i=[];return this.Ia.inorderTraversal((a,d)=>{i.push(d)}),i}}class fy{constructor(i,a,d,f,y,R,w,N,O){this.query=i,this.docs=a,this.oldDocs=d,this.docChanges=f,this.mutatedKeys=y,this.fromCache=R,this.syncStateChanged=w,this.excludesMetadataChanges=N,this.hasCachedResults=O}static fromInitialDocuments(i,a,d,f,y){const R=[];return a.forEach(w=>{R.push({type:0,doc:w})}),new fy(i,a,ay.emptySet(a),R,d,f,!0,!1,y)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(i){if(!(this.fromCache===i.fromCache&&this.hasCachedResults===i.hasCachedResults&&this.syncStateChanged===i.syncStateChanged&&this.mutatedKeys.isEqual(i.mutatedKeys)&&qI(this.query,i.query)&&this.docs.isEqual(i.docs)&&this.oldDocs.isEqual(i.oldDocs)))return!1;const a=this.docChanges,d=i.docChanges;if(a.length!==d.length)return!1;for(let f=0;f<a.length;f++)if(a[f].type!==d[f].type||!a[f].doc.isEqual(d[f].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fhe{constructor(){this.Aa=void 0,this.Ra=[]}Va(){return this.Ra.some(i=>i.ma())}}class mhe{constructor(){this.queries=JH(),this.onlineState="Unknown",this.fa=new Set}terminate(){(function(a,d){const f=bn(a),y=f.queries;f.queries=JH(),y.forEach((R,w)=>{for(const N of w.Ra)N.onError(d)})})(this,new Ut(ht.ABORTED,"Firestore shutting down"))}}function JH(){return new d_(o=>k8(o),qI)}async function _he(o,i){const a=bn(o);let d=3;const f=i.query;let y=a.queries.get(f);y?!y.Va()&&i.ma()&&(d=2):(y=new fhe,d=i.ma()?0:1);try{switch(d){case 0:y.Aa=await a.onListen(f,!0);break;case 1:y.Aa=await a.onListen(f,!1);break;case 2:await a.onFirstRemoteStoreListen(f)}}catch(R){const w=T1(R,`Initialization of query '${JE(i.query)}' failed`);return void i.onError(w)}a.queries.set(f,y),y.Ra.push(i),i.ga(a.onlineState),y.Aa&&i.pa(y.Aa)&&R1(a)}async function ghe(o,i){const a=bn(o),d=i.query;let f=3;const y=a.queries.get(d);if(y){const R=y.Ra.indexOf(i);R>=0&&(y.Ra.splice(R,1),y.Ra.length===0?f=i.ma()?0:1:!y.Va()&&i.ma()&&(f=2))}switch(f){case 0:return a.queries.delete(d),a.onUnlisten(d,!0);case 1:return a.queries.delete(d),a.onUnlisten(d,!1);case 2:return a.onLastRemoteStoreUnlisten(d);default:return}}function Ehe(o,i){const a=bn(o);let d=!1;for(const f of i){const y=f.query,R=a.queries.get(y);if(R){for(const w of R.Ra)w.pa(f)&&(d=!0);R.Aa=f}}d&&R1(a)}function yhe(o,i,a){const d=bn(o),f=d.queries.get(i);if(f)for(const y of f.Ra)y.onError(a);d.queries.delete(i)}function R1(o){o.fa.forEach(i=>{i.next()})}var wx,QH;(QH=wx||(wx={})).ya="default",QH.Cache="cache";class vhe{constructor(i,a,d){this.query=i,this.wa=a,this.ba=!1,this.Sa=null,this.onlineState="Unknown",this.options=d||{}}pa(i){if(!this.options.includeMetadataChanges){const d=[];for(const f of i.docChanges)f.type!==3&&d.push(f);i=new fy(i.query,i.docs,i.oldDocs,d,i.mutatedKeys,i.fromCache,i.syncStateChanged,!0,i.hasCachedResults)}let a=!1;return this.ba?this.Da(i)&&(this.wa.next(i),a=!0):this.va(i,this.onlineState)&&(this.Ca(i),a=!0),this.Sa=i,a}onError(i){this.wa.error(i)}ga(i){this.onlineState=i;let a=!1;return this.Sa&&!this.ba&&this.va(this.Sa,i)&&(this.Ca(this.Sa),a=!0),a}va(i,a){if(!i.fromCache||!this.ma())return!0;const d=a!=="Offline";return(!this.options.Fa||!d)&&(!i.docs.isEmpty()||i.hasCachedResults||a==="Offline")}Da(i){if(i.docChanges.length>0)return!0;const a=this.Sa&&this.Sa.hasPendingWrites!==i.hasPendingWrites;return!(!i.syncStateChanged&&!a)&&this.options.includeMetadataChanges===!0}Ca(i){i=fy.fromInitialDocuments(i.query,i.docs,i.mutatedKeys,i.fromCache,i.hasCachedResults),this.ba=!0,this.wa.next(i)}ma(){return this.options.source!==wx.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fW{constructor(i){this.key=i}}class mW{constructor(i){this.key=i}}class She{constructor(i,a){this.query=i,this.qa=a,this.Qa=null,this.hasCachedResults=!1,this.current=!1,this.$a=ti(),this.mutatedKeys=ti(),this.Ua=x8(i),this.Ka=new ay(this.Ua)}get Wa(){return this.qa}Ga(i,a){const d=a?a.za:new XH,f=a?a.Ka:this.Ka;let y=a?a.mutatedKeys:this.mutatedKeys,R=f,w=!1;const N=this.query.limitType==="F"&&f.size===this.query.limit?f.last():null,O=this.query.limitType==="L"&&f.size===this.query.limit?f.first():null;if(i.inorderTraversal((x,G)=>{const W=f.get(x),ne=KI(this.query,G)?G:null,Q=!!W&&this.mutatedKeys.has(W.key),se=!!ne&&(ne.hasLocalMutations||this.mutatedKeys.has(ne.key)&&ne.hasCommittedMutations);let te=!1;W&&ne?W.data.isEqual(ne.data)?Q!==se&&(d.track({type:3,doc:ne}),te=!0):this.ja(W,ne)||(d.track({type:2,doc:ne}),te=!0,(N&&this.Ua(ne,N)>0||O&&this.Ua(ne,O)<0)&&(w=!0)):!W&&ne?(d.track({type:0,doc:ne}),te=!0):W&&!ne&&(d.track({type:1,doc:W}),te=!0,(N||O)&&(w=!0)),te&&(ne?(R=R.add(ne),y=se?y.add(x):y.delete(x)):(R=R.delete(x),y=y.delete(x)))}),this.query.limit!==null)for(;R.size>this.query.limit;){const x=this.query.limitType==="F"?R.last():R.first();R=R.delete(x.key),y=y.delete(x.key),d.track({type:1,doc:x})}return{Ka:R,za:d,ys:w,mutatedKeys:y}}ja(i,a){return i.hasLocalMutations&&a.hasCommittedMutations&&!a.hasLocalMutations}applyChanges(i,a,d,f){const y=this.Ka;this.Ka=i.Ka,this.mutatedKeys=i.mutatedKeys;const R=i.za.da();R.sort((x,G)=>function(ne,Q){const se=te=>{switch(te){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return pn(20277,{Vt:te})}};return se(ne)-se(Q)}(x.type,G.type)||this.Ua(x.doc,G.doc)),this.Ha(d),f=f!=null&&f;const w=a&&!f?this.Ja():[],N=this.$a.size===0&&this.current&&!f?1:0,O=N!==this.Qa;return this.Qa=N,R.length!==0||O?{snapshot:new fy(this.query,i.Ka,y,R,i.mutatedKeys,N===0,O,!1,!!d&&d.resumeToken.approximateByteSize()>0),Ya:w}:{Ya:w}}ga(i){return this.current&&i==="Offline"?(this.current=!1,this.applyChanges({Ka:this.Ka,za:new XH,mutatedKeys:this.mutatedKeys,ys:!1},!1)):{Ya:[]}}Za(i){return!this.qa.has(i)&&!!this.Ka.has(i)&&!this.Ka.get(i).hasLocalMutations}Ha(i){i&&(i.addedDocuments.forEach(a=>this.qa=this.qa.add(a)),i.modifiedDocuments.forEach(a=>{}),i.removedDocuments.forEach(a=>this.qa=this.qa.delete(a)),this.current=i.current)}Ja(){if(!this.current)return[];const i=this.$a;this.$a=ti(),this.Ka.forEach(d=>{this.Za(d.key)&&(this.$a=this.$a.add(d.key))});const a=[];return i.forEach(d=>{this.$a.has(d)||a.push(new mW(d))}),this.$a.forEach(d=>{i.has(d)||a.push(new fW(d))}),a}Xa(i){this.qa=i.Ns,this.$a=ti();const a=this.Ga(i.documents);return this.applyChanges(a,!0)}eu(){return fy.fromInitialDocuments(this.query,this.Ka,this.mutatedKeys,this.Qa===0,this.hasCachedResults)}}const b1="SyncEngine";class The{constructor(i,a,d){this.query=i,this.targetId=a,this.view=d}}class Rhe{constructor(i){this.key=i,this.tu=!1}}class bhe{constructor(i,a,d,f,y,R){this.localStore=i,this.remoteStore=a,this.eventManager=d,this.sharedClientState=f,this.currentUser=y,this.maxConcurrentLimboResolutions=R,this.nu={},this.ru=new d_(w=>k8(w),qI),this.iu=new Map,this.su=new Set,this.ou=new wr(Qt.comparator),this._u=new Map,this.au=new p1,this.uu={},this.cu=new Map,this.lu=py.ir(),this.onlineState="Unknown",this.hu=void 0}get isPrimaryClient(){return this.hu===!0}}async function Che(o,i,a=!0){const d=SW(o);let f;const y=d.ru.get(i);return y?(d.sharedClientState.addLocalQueryTarget(y.targetId),f=y.view.eu()):f=await _W(d,i,a,!0),f}async function whe(o,i){const a=SW(o);await _W(a,i,!0,!1)}async function _W(o,i,a,d){const f=await Hue(o.localStore,Vd(i)),y=f.targetId,R=o.sharedClientState.addLocalQueryTarget(y,a);let w;return d&&(w=await Ahe(o,i,y,R==="current",f.resumeToken)),o.isPrimaryClient&&a&&cW(o.remoteStore,f),w}async function Ahe(o,i,a,d,f){o.Pu=(G,W,ne)=>async function(se,te,le,ce){let me=te.view.Ga(le);me.ys&&(me=await HH(se.localStore,te.query,!1).then(({documents:Z})=>te.view.Ga(Z,me)));const Ce=ce&&ce.targetChanges.get(te.targetId),_e=ce&&ce.targetMismatches.get(te.targetId)!=null,ze=te.view.applyChanges(me,se.isPrimaryClient,Ce,_e);return ZH(se,te.targetId,ze.Ya),ze.snapshot}(o,G,W,ne);const y=await HH(o.localStore,i,!0),R=new She(i,y.Ns),w=R.Ga(y.documents),N=DR.createSynthesizedTargetChangeForCurrentChange(a,d&&o.onlineState!=="Offline",f),O=R.applyChanges(w,o.isPrimaryClient,N);ZH(o,a,O.Ya);const x=new The(i,a,R);return o.ru.set(i,x),o.iu.has(a)?o.iu.get(a).push(i):o.iu.set(a,[i]),O.snapshot}async function Ihe(o,i,a){const d=bn(o),f=d.ru.get(i),y=d.iu.get(f.targetId);if(y.length>1)return d.iu.set(f.targetId,y.filter(R=>!qI(R,i))),void d.ru.delete(i);d.isPrimaryClient?(d.sharedClientState.removeLocalQueryTarget(f.targetId),d.sharedClientState.isActiveQueryTarget(f.targetId)||await bx(d.localStore,f.targetId,!1).then(()=>{d.sharedClientState.clearQueryState(f.targetId),a&&g1(d.remoteStore,f.targetId),Ax(d,f.targetId)}).catch(Cy)):(Ax(d,f.targetId),await bx(d.localStore,f.targetId,!0))}async function Nhe(o,i){const a=bn(o),d=a.ru.get(i),f=a.iu.get(d.targetId);a.isPrimaryClient&&f.length===1&&(a.sharedClientState.removeLocalQueryTarget(d.targetId),g1(a.remoteStore,d.targetId))}async function Ohe(o,i,a){const d=Uhe(o);try{const f=await function(R,w){const N=bn(R),O=vs.now(),x=w.reduce((ne,Q)=>ne.add(Q.key),ti());let G,W;return N.persistence.runTransaction("Locally write mutations","readwrite",ne=>{let Q=ah(),se=ti();return N.Cs.getEntries(ne,x).next(te=>{Q=te,Q.forEach((le,ce)=>{ce.isValidDocument()||(se=se.add(le))})}).next(()=>N.localDocuments.getOverlayedDocuments(ne,Q)).next(te=>{G=te;const le=[];for(const ce of w){const me=Hde(ce,G.get(ce.key).overlayedDocument);me!=null&&le.push(new qp(ce.key,me,w8(me.value.mapValue),jc.exists(!0)))}return N.mutationQueue.addMutationBatch(ne,O,le,w)}).next(te=>{W=te;const le=te.applyToLocalDocumentSet(G,se);return N.documentOverlayCache.saveOverlays(ne,te.batchId,le)})}).then(()=>({batchId:W.batchId,changes:U8(G)}))}(d.localStore,i);d.sharedClientState.addPendingMutation(f.batchId),function(R,w,N){let O=R.uu[R.currentUser.toKey()];O||(O=new wr(Kn)),O=O.insert(w,N),R.uu[R.currentUser.toKey()]=O}(d,f.batchId,a),await LR(d,f.changes),await ZI(d.remoteStore)}catch(f){const y=T1(f,"Failed to persist write");a.reject(y)}}async function gW(o,i){const a=bn(o);try{const d=await Fue(a.localStore,i);i.targetChanges.forEach((f,y)=>{const R=a._u.get(y);R&&(Li(f.addedDocuments.size+f.modifiedDocuments.size+f.removedDocuments.size<=1,22616),f.addedDocuments.size>0?R.tu=!0:f.modifiedDocuments.size>0?Li(R.tu,14607):f.removedDocuments.size>0&&(Li(R.tu,42227),R.tu=!1))}),await LR(a,d,i)}catch(d){await Cy(d)}}function $H(o,i,a){const d=bn(o);if(d.isPrimaryClient&&a===0||!d.isPrimaryClient&&a===1){const f=[];d.ru.forEach((y,R)=>{const w=R.view.ga(i);w.snapshot&&f.push(w.snapshot)}),function(R,w){const N=bn(R);N.onlineState=w;let O=!1;N.queries.forEach((x,G)=>{for(const W of G.Ra)W.ga(w)&&(O=!0)}),O&&R1(N)}(d.eventManager,i),f.length&&d.nu.Q_(f),d.onlineState=i,d.isPrimaryClient&&d.sharedClientState.setOnlineState(i)}}async function Dhe(o,i,a){const d=bn(o);d.sharedClientState.updateQueryState(i,"rejected",a);const f=d._u.get(i),y=f&&f.key;if(y){let R=new wr(Qt.comparator);R=R.insert(y,_a.newNoDocument(y,Tn.min()));const w=ti().add(y),N=new JI(Tn.min(),new Map,new wr(Kn),R,w);await gW(d,N),d.ou=d.ou.remove(y),d._u.delete(i),C1(d)}else await bx(d.localStore,i,!1).then(()=>Ax(d,i,a)).catch(Cy)}async function Phe(o,i){const a=bn(o),d=i.batch.batchId;try{const f=await Vue(a.localStore,i);yW(a,d,null),EW(a,d),a.sharedClientState.updateMutationState(d,"acknowledged"),await LR(a,f)}catch(f){await Cy(f)}}async function Lhe(o,i,a){const d=bn(o);try{const f=await function(R,w){const N=bn(R);return N.persistence.runTransaction("Reject batch","readwrite-primary",O=>{let x;return N.mutationQueue.lookupMutationBatch(O,w).next(G=>(Li(G!==null,37113),x=G.keys(),N.mutationQueue.removeMutationBatch(O,G))).next(()=>N.mutationQueue.performConsistencyCheck(O)).next(()=>N.documentOverlayCache.removeOverlaysForBatchId(O,x,w)).next(()=>N.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(O,x)).next(()=>N.localDocuments.getDocuments(O,x))})}(d.localStore,i);yW(d,i,a),EW(d,i),d.sharedClientState.updateMutationState(i,"rejected",a),await LR(d,f)}catch(f){await Cy(f)}}function EW(o,i){(o.cu.get(i)||[]).forEach(a=>{a.resolve()}),o.cu.delete(i)}function yW(o,i,a){const d=bn(o);let f=d.uu[d.currentUser.toKey()];if(f){const y=f.get(i);y&&(a?y.reject(a):y.resolve(),f=f.remove(i)),d.uu[d.currentUser.toKey()]=f}}function Ax(o,i,a=null){o.sharedClientState.removeLocalQueryTarget(i);for(const d of o.iu.get(i))o.ru.delete(d),a&&o.nu.Tu(d,a);o.iu.delete(i),o.isPrimaryClient&&o.au.Ur(i).forEach(d=>{o.au.containsKey(d)||vW(o,d)})}function vW(o,i){o.su.delete(i.path.canonicalString());const a=o.ou.get(i);a!==null&&(g1(o.remoteStore,a),o.ou=o.ou.remove(i),o._u.delete(a),C1(o))}function ZH(o,i,a){for(const d of a)d instanceof fW?(o.au.addReference(d.key,i),khe(o,d)):d instanceof mW?(Mt(b1,"Document no longer in limbo: "+d.key),o.au.removeReference(d.key,i),o.au.containsKey(d.key)||vW(o,d.key)):pn(19791,{Iu:d})}function khe(o,i){const a=i.key,d=a.path.canonicalString();o.ou.get(a)||o.su.has(d)||(Mt(b1,"New document in limbo: "+a),o.su.add(d),C1(o))}function C1(o){for(;o.su.size>0&&o.ou.size<o.maxConcurrentLimboResolutions;){const i=o.su.values().next().value;o.su.delete(i);const a=new Qt(or.fromString(i)),d=o.lu.next();o._u.set(d,new Rhe(a)),o.ou=o.ou.insert(a,d),cW(o.remoteStore,new Lp(Vd(o1(a.path)),d,"TargetPurposeLimboResolution",HI.le))}}async function LR(o,i,a){const d=bn(o),f=[],y=[],R=[];d.ru.isEmpty()||(d.ru.forEach((w,N)=>{R.push(d.Pu(N,i,a).then(O=>{var x;if((O||a)&&d.isPrimaryClient){const G=O?!O.fromCache:(x=a==null?void 0:a.targetChanges.get(N.targetId))===null||x===void 0?void 0:x.current;d.sharedClientState.updateQueryState(N.targetId,G?"current":"not-current")}if(O){f.push(O);const G=m1.Ps(N.targetId,O);y.push(G)}}))}),await Promise.all(R),d.nu.Q_(f),await async function(N,O){const x=bn(N);try{await x.persistence.runTransaction("notifyLocalViewChanges","readwrite",G=>pt.forEach(O,W=>pt.forEach(W.ls,ne=>x.persistence.referenceDelegate.addReference(G,W.targetId,ne)).next(()=>pt.forEach(W.hs,ne=>x.persistence.referenceDelegate.removeReference(G,W.targetId,ne)))))}catch(G){if(!wy(G))throw G;Mt(_1,"Failed to update sequence numbers: "+G)}for(const G of O){const W=G.targetId;if(!G.fromCache){const ne=x.Ss.get(W),Q=ne.snapshotVersion,se=ne.withLastLimboFreeSnapshotVersion(Q);x.Ss=x.Ss.insert(W,se)}}}(d.localStore,y))}async function xhe(o,i){const a=bn(o);if(!a.currentUser.isEqual(i)){Mt(b1,"User change. New user:",i.toKey());const d=await rW(a.localStore,i);a.currentUser=i,function(y,R){y.cu.forEach(w=>{w.forEach(N=>{N.reject(new Ut(ht.CANCELLED,R))})}),y.cu.clear()}(a,"'waitForPendingWrites' promise is rejected due to a user change."),a.sharedClientState.handleUserChange(i,d.removedBatchIds,d.addedBatchIds),await LR(a,d.Ms)}}function Mhe(o,i){const a=bn(o),d=a._u.get(i);if(d&&d.tu)return ti().add(d.key);{let f=ti();const y=a.iu.get(i);if(!y)return f;for(const R of y){const w=a.ru.get(R);f=f.unionWith(w.view.Wa)}return f}}function SW(o){const i=bn(o);return i.remoteStore.remoteSyncer.applyRemoteEvent=gW.bind(null,i),i.remoteStore.remoteSyncer.getRemoteKeysForTarget=Mhe.bind(null,i),i.remoteStore.remoteSyncer.rejectListen=Dhe.bind(null,i),i.nu.Q_=Ehe.bind(null,i.eventManager),i.nu.Tu=yhe.bind(null,i.eventManager),i}function Uhe(o){const i=bn(o);return i.remoteStore.remoteSyncer.applySuccessfulWrite=Phe.bind(null,i),i.remoteStore.remoteSyncer.rejectFailedWrite=Lhe.bind(null,i),i}class yI{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(i){this.serializer=QI(i.databaseInfo.databaseId),this.sharedClientState=this.Au(i),this.persistence=this.Ru(i),await this.persistence.start(),this.localStore=this.Vu(i),this.gcScheduler=this.mu(i,this.localStore),this.indexBackfillerScheduler=this.fu(i,this.localStore)}mu(i,a){return null}fu(i,a){return null}Vu(i){return jue(this.persistence,new xue,i.initialUser,this.serializer)}Ru(i){return new iW(f1.Ei,this.serializer)}Au(i){return new Wue}async terminate(){var i,a;(i=this.gcScheduler)===null||i===void 0||i.stop(),(a=this.indexBackfillerScheduler)===null||a===void 0||a.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}yI.provider={build:()=>new yI};class jhe extends yI{constructor(i){super(),this.cacheSizeBytes=i}mu(i,a){Li(this.persistence.referenceDelegate instanceof gI,46915);const d=this.persistence.referenceDelegate.garbageCollector;return new vue(d,i.asyncQueue,a)}Ru(i){const a=this.cacheSizeBytes!==void 0?po.withCacheSize(this.cacheSizeBytes):po.DEFAULT;return new iW(d=>gI.Ei(d,a),this.serializer)}}class Ix{async initialize(i,a){this.localStore||(this.localStore=i.localStore,this.sharedClientState=i.sharedClientState,this.datastore=this.createDatastore(a),this.remoteStore=this.createRemoteStore(a),this.eventManager=this.createEventManager(a),this.syncEngine=this.createSyncEngine(a,!i.synchronizeTabs),this.sharedClientState.onlineStateHandler=d=>$H(this.syncEngine,d,1),this.remoteStore.remoteSyncer.handleCredentialChange=xhe.bind(null,this.syncEngine),await phe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(i){return function(){return new mhe}()}createDatastore(i){const a=QI(i.databaseInfo.databaseId),d=function(y){return new Jue(y)}(i.databaseInfo);return function(y,R,w,N){return new ehe(y,R,w,N)}(i.authCredentials,i.appCheckCredentials,d,a)}createRemoteStore(i){return function(d,f,y,R,w){return new nhe(d,f,y,R,w)}(this.localStore,this.datastore,i.asyncQueue,a=>$H(this.syncEngine,a,0),function(){return qH.C()?new qH:new que}())}createSyncEngine(i,a){return function(f,y,R,w,N,O,x){const G=new bhe(f,y,R,w,N,O);return x&&(G.hu=!0),G}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,i.initialUser,i.maxConcurrentLimboResolutions,a)}async terminate(){var i,a;await async function(f){const y=bn(f);Mt(c_,"RemoteStore shutting down."),y.aa.add(5),await PR(y),y.ca.shutdown(),y.la.set("Unknown")}(this.remoteStore),(i=this.datastore)===null||i===void 0||i.terminate(),(a=this.eventManager)===null||a===void 0||a.terminate()}}Ix.provider={build:()=>new Ix};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vhe{constructor(i){this.observer=i,this.muted=!1}next(i){this.muted||this.observer.next&&this.pu(this.observer.next,i)}error(i){this.muted||(this.observer.error?this.pu(this.observer.error,i):sh("Uncaught Error in snapshot listener:",i.toString()))}yu(){this.muted=!0}pu(i,a){setTimeout(()=>{this.muted||i(a)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zp="FirestoreClient";class Fhe{constructor(i,a,d,f,y){this.authCredentials=i,this.appCheckCredentials=a,this.asyncQueue=d,this.databaseInfo=f,this.user=ma.UNAUTHENTICATED,this.clientId=_8.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=y,this.authCredentials.start(d,async R=>{Mt(zp,"Received user=",R.uid),await this.authCredentialListener(R),this.user=R}),this.appCheckCredentials.start(d,R=>(Mt(zp,"Received new app check token=",R),this.appCheckCredentialListener(R,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(i){this.authCredentialListener=i}setAppCheckTokenChangeListener(i){this.appCheckCredentialListener=i}terminate(){this.asyncQueue.enterRestrictedMode();const i=new n_;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),i.resolve()}catch(a){const d=T1(a,"Failed to shutdown persistence");i.reject(d)}}),i.promise}}async function Ck(o,i){o.asyncQueue.verifyOperationInProgress(),Mt(zp,"Initializing OfflineComponentProvider");const a=o.configuration;await i.initialize(a);let d=a.initialUser;o.setCredentialChangeListener(async f=>{d.isEqual(f)||(await rW(i.localStore,f),d=f)}),i.persistence.setDatabaseDeletedListener(()=>o.terminate()),o._offlineComponents=i}async function e9(o,i){o.asyncQueue.verifyOperationInProgress();const a=await Bhe(o);Mt(zp,"Initializing OnlineComponentProvider"),await i.initialize(a,o.configuration),o.setCredentialChangeListener(d=>YH(i.remoteStore,d)),o.setAppCheckTokenChangeListener((d,f)=>YH(i.remoteStore,f)),o._onlineComponents=i}async function Bhe(o){if(!o._offlineComponents)if(o._uninitializedComponentsProvider){Mt(zp,"Using user provided OfflineComponentProvider");try{await Ck(o,o._uninitializedComponentsProvider._offline)}catch(i){const a=i;if(!function(f){return f.name==="FirebaseError"?f.code===ht.FAILED_PRECONDITION||f.code===ht.UNIMPLEMENTED:!(typeof DOMException<"u"&&f instanceof DOMException)||f.code===22||f.code===20||f.code===11}(a))throw a;ly("Error using user provided cache. Falling back to memory cache: "+a),await Ck(o,new yI)}}else Mt(zp,"Using default OfflineComponentProvider"),await Ck(o,new jhe(void 0));return o._offlineComponents}async function TW(o){return o._onlineComponents||(o._uninitializedComponentsProvider?(Mt(zp,"Using user provided OnlineComponentProvider"),await e9(o,o._uninitializedComponentsProvider._online)):(Mt(zp,"Using default OnlineComponentProvider"),await e9(o,new Ix))),o._onlineComponents}function Ghe(o){return TW(o).then(i=>i.syncEngine)}async function t9(o){const i=await TW(o),a=i.eventManager;return a.onListen=Che.bind(null,i.syncEngine),a.onUnlisten=Ihe.bind(null,i.syncEngine),a.onFirstRemoteStoreListen=whe.bind(null,i.syncEngine),a.onLastRemoteStoreUnlisten=Nhe.bind(null,i.syncEngine),a}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RW(o){const i={};return o.timeoutSeconds!==void 0&&(i.timeoutSeconds=o.timeoutSeconds),i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n9=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bW(o,i,a){if(!a)throw new Ut(ht.INVALID_ARGUMENT,`Function ${o}() cannot be called with an empty ${i}.`)}function Hhe(o,i,a,d){if(i===!0&&d===!0)throw new Ut(ht.INVALID_ARGUMENT,`${o} and ${a} cannot be used together.`)}function i9(o){if(!Qt.isDocumentKey(o))throw new Ut(ht.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${o} has ${o.length}.`)}function r9(o){if(Qt.isDocumentKey(o))throw new Ut(ht.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${o} has ${o.length}.`)}function eN(o){if(o===void 0)return"undefined";if(o===null)return"null";if(typeof o=="string")return o.length>20&&(o=`${o.substring(0,20)}...`),JSON.stringify(o);if(typeof o=="number"||typeof o=="boolean")return""+o;if(typeof o=="object"){if(o instanceof Array)return"an array";{const i=function(d){return d.constructor?d.constructor.name:null}(o);return i?`a custom ${i} object`:"an object"}}return typeof o=="function"?"a function":pn(12329,{type:typeof o})}function oy(o,i){if("_delegate"in o&&(o=o._delegate),!(o instanceof i)){if(i.name===o.constructor.name)throw new Ut(ht.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const a=eN(o);throw new Ut(ht.INVALID_ARGUMENT,`Expected type '${i.name}', but it was: ${a}`)}}return o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CW="firestore.googleapis.com",s9=!0;class a9{constructor(i){var a,d;if(i.host===void 0){if(i.ssl!==void 0)throw new Ut(ht.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=CW,this.ssl=s9}else this.host=i.host,this.ssl=(a=i.ssl)!==null&&a!==void 0?a:s9;if(this.credentials=i.credentials,this.ignoreUndefinedProperties=!!i.ignoreUndefinedProperties,this.localCache=i.localCache,i.cacheSizeBytes===void 0)this.cacheSizeBytes=nW;else{if(i.cacheSizeBytes!==-1&&i.cacheSizeBytes<Eue)throw new Ut(ht.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=i.cacheSizeBytes}Hhe("experimentalForceLongPolling",i.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",i.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!i.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:i.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!i.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=RW((d=i.experimentalLongPollingOptions)!==null&&d!==void 0?d:{}),function(y){if(y.timeoutSeconds!==void 0){if(isNaN(y.timeoutSeconds))throw new Ut(ht.INVALID_ARGUMENT,`invalid long polling timeout: ${y.timeoutSeconds} (must not be NaN)`);if(y.timeoutSeconds<5)throw new Ut(ht.INVALID_ARGUMENT,`invalid long polling timeout: ${y.timeoutSeconds} (minimum allowed value is 5)`);if(y.timeoutSeconds>30)throw new Ut(ht.INVALID_ARGUMENT,`invalid long polling timeout: ${y.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!i.useFetchStreams}isEqual(i){return this.host===i.host&&this.ssl===i.ssl&&this.credentials===i.credentials&&this.cacheSizeBytes===i.cacheSizeBytes&&this.experimentalForceLongPolling===i.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===i.experimentalAutoDetectLongPolling&&function(d,f){return d.timeoutSeconds===f.timeoutSeconds}(this.experimentalLongPollingOptions,i.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===i.ignoreUndefinedProperties&&this.useFetchStreams===i.useFetchStreams}}class tN{constructor(i,a,d,f){this._authCredentials=i,this._appCheckCredentials=a,this._databaseId=d,this._app=f,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new a9({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ut(ht.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(i){if(this._settingsFrozen)throw new Ut(ht.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new a9(i),this._emulatorOptions=i.emulatorOptions||{},i.credentials!==void 0&&(this._authCredentials=function(d){if(!d)return new Xle;switch(d.type){case"firstParty":return new Zle(d.sessionIndex||"0",d.iamToken||null,d.authTokenFactory||null);case"provider":return d.client;default:throw new Ut(ht.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(i.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(a){const d=n9.get(a);d&&(Mt("ComponentProvider","Removing Datastore"),n9.delete(a),d.terminate())}(this),Promise.resolve()}}function zhe(o,i,a,d={}){var f;const y=(o=oy(o,tN))._getSettings(),R=Object.assign(Object.assign({},y),{emulatorOptions:o._getEmulatorOptions()}),w=`${i}:${a}`;y.host!==CW&&y.host!==w&&ly("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const N=Object.assign(Object.assign({},y),{host:w,ssl:!1,emulatorOptions:d});if(!oI(N,R)&&(o._setSettings(N),d.mockUserToken)){let O,x;if(typeof d.mockUserToken=="string")O=d.mockUserToken,x=ma.MOCK_USER;else{O=Ice(d.mockUserToken,(f=o._app)===null||f===void 0?void 0:f.options.projectId);const G=d.mockUserToken.sub||d.mockUserToken.user_id;if(!G)throw new Ut(ht.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");x=new ma(G)}o._authCredentials=new Jle(new f8(O,x))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h_{constructor(i,a,d){this.converter=a,this._query=d,this.type="query",this.firestore=i}withConverter(i){return new h_(this.firestore,i,this._query)}}class Ho{constructor(i,a,d){this.converter=a,this._key=d,this.type="document",this.firestore=i}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Up(this.firestore,this.converter,this._key.path.popLast())}withConverter(i){return new Ho(this.firestore,i,this._key)}}class Up extends h_{constructor(i,a,d){super(i,a,o1(d)),this._path=d,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const i=this._path.popLast();return i.isEmpty()?null:new Ho(this.firestore,null,new Qt(i))}withConverter(i){return new Up(this.firestore,i,this._path)}}function wk(o,i,...a){if(o=Dl(o),bW("collection","path",i),o instanceof tN){const d=or.fromString(i,...a);return r9(d),new Up(o,null,d)}{if(!(o instanceof Ho||o instanceof Up))throw new Ut(ht.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const d=o._path.child(or.fromString(i,...a));return r9(d),new Up(o.firestore,null,d)}}function wW(o,i,...a){if(o=Dl(o),arguments.length===1&&(i=_8.newId()),bW("doc","path",i),o instanceof tN){const d=or.fromString(i,...a);return i9(d),new Ho(o,null,new Qt(d))}{if(!(o instanceof Ho||o instanceof Up))throw new Ut(ht.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const d=o._path.child(or.fromString(i,...a));return i9(d),new Ho(o.firestore,o instanceof Up?o.converter:null,new Qt(d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o9="AsyncQueue";class c9{constructor(i=Promise.resolve()){this.Qu=[],this.$u=!1,this.Uu=[],this.Ku=null,this.Wu=!1,this.Gu=!1,this.zu=[],this.y_=new aW(this,"async_queue_retry"),this.ju=()=>{const d=bk();d&&Mt(o9,"Visibility state changed to "+d.visibilityState),this.y_.A_()},this.Hu=i;const a=bk();a&&typeof a.addEventListener=="function"&&a.addEventListener("visibilitychange",this.ju)}get isShuttingDown(){return this.$u}enqueueAndForget(i){this.enqueue(i)}enqueueAndForgetEvenWhileRestricted(i){this.Ju(),this.Yu(i)}enterRestrictedMode(i){if(!this.$u){this.$u=!0,this.Gu=i||!1;const a=bk();a&&typeof a.removeEventListener=="function"&&a.removeEventListener("visibilitychange",this.ju)}}enqueue(i){if(this.Ju(),this.$u)return new Promise(()=>{});const a=new n_;return this.Yu(()=>this.$u&&this.Gu?Promise.resolve():(i().then(a.resolve,a.reject),a.promise)).then(()=>a.promise)}enqueueRetryable(i){this.enqueueAndForget(()=>(this.Qu.push(i),this.Zu()))}async Zu(){if(this.Qu.length!==0){try{await this.Qu[0](),this.Qu.shift(),this.y_.reset()}catch(i){if(!wy(i))throw i;Mt(o9,"Operation failed with retryable error: "+i)}this.Qu.length>0&&this.y_.E_(()=>this.Zu())}}Yu(i){const a=this.Hu.then(()=>(this.Wu=!0,i().catch(d=>{throw this.Ku=d,this.Wu=!1,sh("INTERNAL UNHANDLED ERROR: ",l9(d)),d}).then(d=>(this.Wu=!1,d))));return this.Hu=a,a}enqueueAfterDelay(i,a,d){this.Ju(),this.zu.indexOf(i)>-1&&(a=0);const f=S1.createAndSchedule(this,i,a,d,y=>this.Xu(y));return this.Uu.push(f),f}Ju(){this.Ku&&pn(47125,{ec:l9(this.Ku)})}verifyOperationInProgress(){}async tc(){let i;do i=this.Hu,await i;while(i!==this.Hu)}nc(i){for(const a of this.Uu)if(a.timerId===i)return!0;return!1}rc(i){return this.tc().then(()=>{this.Uu.sort((a,d)=>a.targetTimeMs-d.targetTimeMs);for(const a of this.Uu)if(a.skipDelay(),i!=="all"&&a.timerId===i)break;return this.tc()})}sc(i){this.zu.push(i)}Xu(i){const a=this.Uu.indexOf(i);this.Uu.splice(a,1)}}function l9(o){let i=o.message||"";return o.stack&&(i=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d9(o){return function(a,d){if(typeof a!="object"||a===null)return!1;const f=a;for(const y of d)if(y in f&&typeof f[y]=="function")return!0;return!1}(o,["next","error","complete"])}class SR extends tN{constructor(i,a,d,f){super(i,a,d,f),this.type="firestore",this._queue=new c9,this._persistenceKey=(f==null?void 0:f.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const i=this._firestoreClient.terminate();this._queue=new c9(i),this._firestoreClient=void 0,await i}}}function Whe(o,i){const a=typeof o=="object"?o:jle(),d=typeof o=="string"?o:uI,f=Lle(a,"firestore").getImmediate({identifier:d});if(!f._initialized){const y=wce("firestore");y&&zhe(f,...y)}return f}function w1(o){if(o._terminated)throw new Ut(ht.FAILED_PRECONDITION,"The client has already been terminated.");return o._firestoreClient||qhe(o),o._firestoreClient}function qhe(o){var i,a,d;const f=o._freezeSettings(),y=function(w,N,O,x){return new fde(w,N,O,x.host,x.ssl,x.experimentalForceLongPolling,x.experimentalAutoDetectLongPolling,RW(x.experimentalLongPollingOptions),x.useFetchStreams)}(o._databaseId,((i=o._app)===null||i===void 0?void 0:i.options.appId)||"",o._persistenceKey,f);o._componentsProvider||!((a=f.localCache)===null||a===void 0)&&a._offlineComponentProvider&&(!((d=f.localCache)===null||d===void 0)&&d._onlineComponentProvider)&&(o._componentsProvider={_offline:f.localCache._offlineComponentProvider,_online:f.localCache._onlineComponentProvider}),o._firestoreClient=new Fhe(o._authCredentials,o._appCheckCredentials,o._queue,y,o._componentsProvider&&function(w){const N=w==null?void 0:w._online.build();return{_offline:w==null?void 0:w._offline.build(N),_online:N}}(o._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class my{constructor(i){this._byteString=i}static fromBase64String(i){try{return new my(Js.fromBase64String(i))}catch(a){throw new Ut(ht.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+a)}}static fromUint8Array(i){return new my(Js.fromUint8Array(i))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(i){return this._byteString.isEqual(i._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nN{constructor(...i){for(let a=0;a<i.length;++a)if(i[a].length===0)throw new Ut(ht.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Xs(i)}isEqual(i){return this._internalPath.isEqual(i._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A1{constructor(i){this._methodName=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I1{constructor(i,a){if(!isFinite(i)||i<-90||i>90)throw new Ut(ht.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+i);if(!isFinite(a)||a<-180||a>180)throw new Ut(ht.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+a);this._lat=i,this._long=a}get latitude(){return this._lat}get longitude(){return this._long}isEqual(i){return this._lat===i._lat&&this._long===i._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(i){return Kn(this._lat,i._lat)||Kn(this._long,i._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N1{constructor(i){this._values=(i||[]).map(a=>a)}toArray(){return this._values.map(i=>i)}isEqual(i){return function(d,f){if(d.length!==f.length)return!1;for(let y=0;y<d.length;++y)if(d[y]!==f[y])return!1;return!0}(this._values,i._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Khe=/^__.*__$/;class Yhe{constructor(i,a,d){this.data=i,this.fieldMask=a,this.fieldTransforms=d}toMutation(i,a){return this.fieldMask!==null?new qp(i,this.data,this.fieldMask,a,this.fieldTransforms):new OR(i,this.data,a,this.fieldTransforms)}}class AW{constructor(i,a,d){this.data=i,this.fieldMask=a,this.fieldTransforms=d}toMutation(i,a){return new qp(i,this.data,this.fieldMask,a,this.fieldTransforms)}}function IW(o){switch(o){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw pn(40011,{oc:o})}}class O1{constructor(i,a,d,f,y,R){this.settings=i,this.databaseId=a,this.serializer=d,this.ignoreUndefinedProperties=f,y===void 0&&this._c(),this.fieldTransforms=y||[],this.fieldMask=R||[]}get path(){return this.settings.path}get oc(){return this.settings.oc}ac(i){return new O1(Object.assign(Object.assign({},this.settings),i),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}uc(i){var a;const d=(a=this.path)===null||a===void 0?void 0:a.child(i),f=this.ac({path:d,cc:!1});return f.lc(i),f}hc(i){var a;const d=(a=this.path)===null||a===void 0?void 0:a.child(i),f=this.ac({path:d,cc:!1});return f._c(),f}Pc(i){return this.ac({path:void 0,cc:!0})}Tc(i){return vI(i,this.settings.methodName,this.settings.Ic||!1,this.path,this.settings.Ec)}contains(i){return this.fieldMask.find(a=>i.isPrefixOf(a))!==void 0||this.fieldTransforms.find(a=>i.isPrefixOf(a.field))!==void 0}_c(){if(this.path)for(let i=0;i<this.path.length;i++)this.lc(this.path.get(i))}lc(i){if(i.length===0)throw this.Tc("Document fields must not be empty");if(IW(this.oc)&&Khe.test(i))throw this.Tc('Document fields cannot begin and end with "__"')}}class Xhe{constructor(i,a,d){this.databaseId=i,this.ignoreUndefinedProperties=a,this.serializer=d||QI(i)}dc(i,a,d,f=!1){return new O1({oc:i,methodName:a,Ec:d,path:Xs.emptyPath(),cc:!1,Ic:f},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function D1(o){const i=o._freezeSettings(),a=QI(o._databaseId);return new Xhe(o._databaseId,!!i.ignoreUndefinedProperties,a)}function NW(o,i,a,d,f,y={}){const R=o.dc(y.merge||y.mergeFields?2:0,i,a,f);P1("Data must be an object, but it was:",R,d);const w=OW(d,R);let N,O;if(y.merge)N=new Go(R.fieldMask),O=R.fieldTransforms;else if(y.mergeFields){const x=[];for(const G of y.mergeFields){const W=Nx(i,G,a);if(!R.contains(W))throw new Ut(ht.INVALID_ARGUMENT,`Field '${W}' is specified in your field mask but missing from your input data.`);PW(x,W)||x.push(W)}N=new Go(x),O=R.fieldTransforms.filter(G=>N.covers(G.field))}else N=null,O=R.fieldTransforms;return new Yhe(new fo(w),N,O)}class iN extends A1{_toFieldTransform(i){if(i.oc!==2)throw i.oc===1?i.Tc(`${this._methodName}() can only appear at the top level of your update data`):i.Tc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return i.fieldMask.push(i.path),null}isEqual(i){return i instanceof iN}}function Jhe(o,i,a,d){const f=o.dc(1,i,a);P1("Data must be an object, but it was:",f,d);const y=[],R=fo.empty();Wp(d,(N,O)=>{const x=L1(i,N,a);O=Dl(O);const G=f.hc(x);if(O instanceof iN)y.push(x);else{const W=kR(O,G);W!=null&&(y.push(x),R.set(x,W))}});const w=new Go(y);return new AW(R,w,f.fieldTransforms)}function Qhe(o,i,a,d,f,y){const R=o.dc(1,i,a),w=[Nx(i,d,a)],N=[f];if(y.length%2!=0)throw new Ut(ht.INVALID_ARGUMENT,`Function ${i}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let W=0;W<y.length;W+=2)w.push(Nx(i,y[W])),N.push(y[W+1]);const O=[],x=fo.empty();for(let W=w.length-1;W>=0;--W)if(!PW(O,w[W])){const ne=w[W];let Q=N[W];Q=Dl(Q);const se=R.hc(ne);if(Q instanceof iN)O.push(ne);else{const te=kR(Q,se);te!=null&&(O.push(ne),x.set(ne,te))}}const G=new Go(O);return new AW(x,G,R.fieldTransforms)}function $he(o,i,a,d=!1){return kR(a,o.dc(d?4:3,i))}function kR(o,i){if(DW(o=Dl(o)))return P1("Unsupported field value:",i,o),OW(o,i);if(o instanceof A1)return function(d,f){if(!IW(f.oc))throw f.Tc(`${d._methodName}() can only be used with update() and set()`);if(!f.path)throw f.Tc(`${d._methodName}() is not currently supported inside arrays`);const y=d._toFieldTransform(f);y&&f.fieldTransforms.push(y)}(o,i),null;if(o===void 0&&i.ignoreUndefinedProperties)return null;if(i.path&&i.fieldMask.push(i.path),o instanceof Array){if(i.settings.cc&&i.oc!==4)throw i.Tc("Nested arrays are not supported");return function(d,f){const y=[];let R=0;for(const w of d){let N=kR(w,f.Pc(R));N==null&&(N={nullValue:"NULL_VALUE"}),y.push(N),R++}return{arrayValue:{values:y}}}(o,i)}return function(d,f){if((d=Dl(d))===null)return{nullValue:"NULL_VALUE"};if(typeof d=="number")return Ude(f.serializer,d);if(typeof d=="boolean")return{booleanValue:d};if(typeof d=="string")return{stringValue:d};if(d instanceof Date){const y=vs.fromDate(d);return{timestampValue:_I(f.serializer,y)}}if(d instanceof vs){const y=new vs(d.seconds,1e3*Math.floor(d.nanoseconds/1e3));return{timestampValue:_I(f.serializer,y)}}if(d instanceof I1)return{geoPointValue:{latitude:d.latitude,longitude:d.longitude}};if(d instanceof my)return{bytesValue:X8(f.serializer,d._byteString)};if(d instanceof Ho){const y=f.databaseId,R=d.firestore._databaseId;if(!R.isEqual(y))throw f.Tc(`Document reference is for database ${R.projectId}/${R.database} but should be for database ${y.projectId}/${y.database}`);return{referenceValue:h1(d.firestore._databaseId||f.databaseId,d._key.path)}}if(d instanceof N1)return function(R,w){return{mapValue:{fields:{[b8]:{stringValue:C8},[hI]:{arrayValue:{values:R.toArray().map(O=>{if(typeof O!="number")throw w.Tc("VectorValues must only contain numeric values.");return c1(w.serializer,O)})}}}}}}(d,f);throw f.Tc(`Unsupported field value: ${eN(d)}`)}(o,i)}function OW(o,i){const a={};return E8(o)?i.path&&i.path.length>0&&i.fieldMask.push(i.path):Wp(o,(d,f)=>{const y=kR(f,i.uc(d));y!=null&&(a[d]=y)}),{mapValue:{fields:a}}}function DW(o){return!(typeof o!="object"||o===null||o instanceof Array||o instanceof Date||o instanceof vs||o instanceof I1||o instanceof my||o instanceof Ho||o instanceof A1||o instanceof N1)}function P1(o,i,a){if(!DW(a)||!function(f){return typeof f=="object"&&f!==null&&(Object.getPrototypeOf(f)===Object.prototype||Object.getPrototypeOf(f)===null)}(a)){const d=eN(a);throw d==="an object"?i.Tc(o+" a custom object"):i.Tc(o+" "+d)}}function Nx(o,i,a){if((i=Dl(i))instanceof nN)return i._internalPath;if(typeof i=="string")return L1(o,i);throw vI("Field path arguments must be of type string or ",o,!1,void 0,a)}const Zhe=new RegExp("[~\\*/\\[\\]]");function L1(o,i,a){if(i.search(Zhe)>=0)throw vI(`Invalid field path (${i}). Paths must not contain '~', '*', '/', '[', or ']'`,o,!1,void 0,a);try{return new nN(...i.split("."))._internalPath}catch{throw vI(`Invalid field path (${i}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,o,!1,void 0,a)}}function vI(o,i,a,d,f){const y=d&&!d.isEmpty(),R=f!==void 0;let w=`Function ${i}() called with invalid data`;a&&(w+=" (via `toFirestore()`)"),w+=". ";let N="";return(y||R)&&(N+=" (found",y&&(N+=` in field ${d}`),R&&(N+=` in document ${f}`),N+=")"),new Ut(ht.INVALID_ARGUMENT,w+o+N)}function PW(o,i){return o.some(a=>a.isEqual(i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LW{constructor(i,a,d,f,y){this._firestore=i,this._userDataWriter=a,this._key=d,this._document=f,this._converter=y}get id(){return this._key.path.lastSegment()}get ref(){return new Ho(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const i=new epe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(i)}return this._userDataWriter.convertValue(this._document.data.value)}}get(i){if(this._document){const a=this._document.data.field(rN("DocumentSnapshot.get",i));if(a!==null)return this._userDataWriter.convertValue(a)}}}class epe extends LW{data(){return super.data()}}function rN(o,i){return typeof i=="string"?L1(o,i):i instanceof nN?i._internalPath:i._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tpe(o){if(o.limitType==="L"&&o.explicitOrderBy.length===0)throw new Ut(ht.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class k1{}class kW extends k1{}function u9(o,i,...a){let d=[];i instanceof k1&&d.push(i),d=d.concat(a),function(y){const R=y.filter(N=>N instanceof x1).length,w=y.filter(N=>N instanceof sN).length;if(R>1||R>0&&w>0)throw new Ut(ht.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(d);for(const f of d)o=f._apply(o);return o}class sN extends kW{constructor(i,a,d){super(),this._field=i,this._op=a,this._value=d,this.type="where"}static _create(i,a,d){return new sN(i,a,d)}_apply(i){const a=this._parse(i);return xW(i._query,a),new h_(i.firestore,i.converter,Ex(i._query,a))}_parse(i){const a=D1(i.firestore);return function(y,R,w,N,O,x,G){let W;if(O.isKeyField()){if(x==="array-contains"||x==="array-contains-any")throw new Ut(ht.INVALID_ARGUMENT,`Invalid Query. You can't perform '${x}' queries on documentId().`);if(x==="in"||x==="not-in"){f9(G,x);const Q=[];for(const se of G)Q.push(p9(N,y,se));W={arrayValue:{values:Q}}}else W=p9(N,y,G)}else x!=="in"&&x!=="not-in"&&x!=="array-contains-any"||f9(G,x),W=$he(w,R,G,x==="in"||x==="not-in");return us.create(O,x,W)}(i._query,"where",a,i.firestore._databaseId,this._field,this._op,this._value)}}function h9(o,i,a){const d=i,f=rN("where",o);return sN._create(f,d,a)}class x1 extends k1{constructor(i,a){super(),this.type=i,this._queryConstraints=a}static _create(i,a){return new x1(i,a)}_parse(i){const a=this._queryConstraints.map(d=>d._parse(i)).filter(d=>d.getFilters().length>0);return a.length===1?a[0]:Pl.create(a,this._getOperator())}_apply(i){const a=this._parse(i);return a.getFilters().length===0?i:(function(f,y){let R=f;const w=y.getFlattenedFilters();for(const N of w)xW(R,N),R=Ex(R,N)}(i._query,a),new h_(i.firestore,i.converter,Ex(i._query,a)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class M1 extends kW{constructor(i,a){super(),this._field=i,this._direction=a,this.type="orderBy"}static _create(i,a){return new M1(i,a)}_apply(i){const a=function(f,y,R){if(f.startAt!==null)throw new Ut(ht.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(f.endAt!==null)throw new Ut(ht.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ER(y,R)}(i._query,this._field,this._direction);return new h_(i.firestore,i.converter,function(f,y){const R=f.explicitOrderBy.concat([y]);return new Ay(f.path,f.collectionGroup,R,f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(i._query,a))}}function npe(o,i="asc"){const a=i,d=rN("orderBy",o);return M1._create(d,a)}function p9(o,i,a){if(typeof(a=Dl(a))=="string"){if(a==="")throw new Ut(ht.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!L8(i)&&a.indexOf("/")!==-1)throw new Ut(ht.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${a}' contains a '/' character.`);const d=i.path.child(or.fromString(a));if(!Qt.isDocumentKey(d))throw new Ut(ht.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${d}' is not because it has an odd number of segments (${d.length}).`);return bH(o,new Qt(d))}if(a instanceof Ho)return bH(o,a._key);throw new Ut(ht.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${eN(a)}.`)}function f9(o,i){if(!Array.isArray(o)||o.length===0)throw new Ut(ht.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${i.toString()}' filters.`)}function xW(o,i){const a=function(f,y){for(const R of f)for(const w of R.getFlattenedFilters())if(y.indexOf(w.op)>=0)return w.op;return null}(o.filters,function(f){switch(f){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(i.op));if(a!==null)throw a===i.op?new Ut(ht.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${i.op.toString()}' filter.`):new Ut(ht.INVALID_ARGUMENT,`Invalid query. You cannot use '${i.op.toString()}' filters with '${a.toString()}' filters.`)}class ipe{convertValue(i,a="none"){switch(Gp(i)){case 0:return null;case 1:return i.booleanValue;case 2:return Xr(i.integerValue||i.doubleValue);case 3:return this.convertTimestamp(i.timestampValue);case 4:return this.convertServerTimestamp(i,a);case 5:return i.stringValue;case 6:return this.convertBytes(Bp(i.bytesValue));case 7:return this.convertReference(i.referenceValue);case 8:return this.convertGeoPoint(i.geoPointValue);case 9:return this.convertArray(i.arrayValue,a);case 11:return this.convertObject(i.mapValue,a);case 10:return this.convertVectorValue(i.mapValue);default:throw pn(62114,{value:i})}}convertObject(i,a){return this.convertObjectMap(i.fields,a)}convertObjectMap(i,a="none"){const d={};return Wp(i,(f,y)=>{d[f]=this.convertValue(y,a)}),d}convertVectorValue(i){var a,d,f;const y=(f=(d=(a=i.fields)===null||a===void 0?void 0:a[hI].arrayValue)===null||d===void 0?void 0:d.values)===null||f===void 0?void 0:f.map(R=>Xr(R.doubleValue));return new N1(y)}convertGeoPoint(i){return new I1(Xr(i.latitude),Xr(i.longitude))}convertArray(i,a){return(i.values||[]).map(d=>this.convertValue(d,a))}convertServerTimestamp(i,a){switch(a){case"previous":const d=WI(i);return d==null?null:this.convertValue(d,a);case"estimate":return this.convertTimestamp(mR(i));default:return null}}convertTimestamp(i){const a=Fp(i);return new vs(a.seconds,a.nanos)}convertDocumentKey(i,a){const d=or.fromString(i);Li(tW(d),9688,{name:i});const f=new _R(d.get(1),d.get(3)),y=new Qt(d.popFirst(5));return f.isEqual(a)||sh(`Document ${y} contains a document reference within a different database (${f.projectId}/${f.database}) which is not supported. It will be treated as a reference in the current database (${a.projectId}/${a.database}) instead.`),y}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MW(o,i,a){let d;return d=o?a&&(a.merge||a.mergeFields)?o.toFirestore(i,a):o.toFirestore(i):i,d}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YT{constructor(i,a){this.hasPendingWrites=i,this.fromCache=a}isEqual(i){return this.hasPendingWrites===i.hasPendingWrites&&this.fromCache===i.fromCache}}class UW extends LW{constructor(i,a,d,f,y,R){super(i,a,d,f,R),this._firestore=i,this._firestoreImpl=i,this.metadata=y}exists(){return super.exists()}data(i={}){if(this._document){if(this._converter){const a=new q0(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(a,i)}return this._userDataWriter.convertValue(this._document.data.value,i.serverTimestamps)}}get(i,a={}){if(this._document){const d=this._document.data.field(rN("DocumentSnapshot.get",i));if(d!==null)return this._userDataWriter.convertValue(d,a.serverTimestamps)}}}class q0 extends UW{data(i={}){return super.data(i)}}class rpe{constructor(i,a,d,f){this._firestore=i,this._userDataWriter=a,this._snapshot=f,this.metadata=new YT(f.hasPendingWrites,f.fromCache),this.query=d}get docs(){const i=[];return this.forEach(a=>i.push(a)),i}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(i,a){this._snapshot.docs.forEach(d=>{i.call(a,new q0(this._firestore,this._userDataWriter,d.key,d,new YT(this._snapshot.mutatedKeys.has(d.key),this._snapshot.fromCache),this.query.converter))})}docChanges(i={}){const a=!!i.includeMetadataChanges;if(a&&this._snapshot.excludesMetadataChanges)throw new Ut(ht.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===a||(this._cachedChanges=function(f,y){if(f._snapshot.oldDocs.isEmpty()){let R=0;return f._snapshot.docChanges.map(w=>{const N=new q0(f._firestore,f._userDataWriter,w.doc.key,w.doc,new YT(f._snapshot.mutatedKeys.has(w.doc.key),f._snapshot.fromCache),f.query.converter);return w.doc,{type:"added",doc:N,oldIndex:-1,newIndex:R++}})}{let R=f._snapshot.oldDocs;return f._snapshot.docChanges.filter(w=>y||w.type!==3).map(w=>{const N=new q0(f._firestore,f._userDataWriter,w.doc.key,w.doc,new YT(f._snapshot.mutatedKeys.has(w.doc.key),f._snapshot.fromCache),f.query.converter);let O=-1,x=-1;return w.type!==0&&(O=R.indexOf(w.doc.key),R=R.delete(w.doc.key)),w.type!==1&&(R=R.add(w.doc),x=R.indexOf(w.doc.key)),{type:spe(w.type),doc:N,oldIndex:O,newIndex:x}})}}(this,a),this._cachedChangesIncludeMetadataChanges=a),this._cachedChanges}}function spe(o){switch(o){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return pn(61501,{type:o})}}class jW extends ipe{constructor(i){super(),this.firestore=i}convertBytes(i){return new my(i)}convertReference(i){const a=this.convertDocumentKey(i,this.firestore._databaseId);return new Ho(this.firestore,null,a)}}function ape(o,i){const a=oy(o.firestore,SR),d=wW(o),f=MW(o.converter,i);return VW(a,[NW(D1(o.firestore),"addDoc",d._key,f,o.converter!==null,{}).toMutation(d._key,jc.exists(!1))]).then(()=>d)}function m9(o,...i){var a,d,f;o=Dl(o);let y={includeMetadataChanges:!1,source:"default"},R=0;typeof i[R]!="object"||d9(i[R])||(y=i[R],R++);const w={includeMetadataChanges:y.includeMetadataChanges,source:y.source};if(d9(i[R])){const G=i[R];i[R]=(a=G.next)===null||a===void 0?void 0:a.bind(G),i[R+1]=(d=G.error)===null||d===void 0?void 0:d.bind(G),i[R+2]=(f=G.complete)===null||f===void 0?void 0:f.bind(G)}let N,O,x;if(o instanceof Ho)O=oy(o.firestore,SR),x=o1(o._key.path),N={next:G=>{i[R]&&i[R](ope(O,o,G))},error:i[R+1],complete:i[R+2]};else{const G=oy(o,h_);O=oy(G.firestore,SR),x=G._query;const W=new jW(O);N={next:ne=>{i[R]&&i[R](new rpe(O,W,G,ne))},error:i[R+1],complete:i[R+2]},tpe(o._query)}return function(W,ne,Q,se){const te=new Vhe(se),le=new vhe(ne,te,Q);return W.asyncQueue.enqueueAndForget(async()=>_he(await t9(W),le)),()=>{te.yu(),W.asyncQueue.enqueueAndForget(async()=>ghe(await t9(W),le))}}(w1(O),x,w,N)}function VW(o,i){return function(d,f){const y=new n_;return d.asyncQueue.enqueueAndForget(async()=>Ohe(await Ghe(d),f,y)),y.promise}(w1(o),i)}function ope(o,i,a){const d=a.docs.get(i._key),f=new jW(o);return new UW(o,f,i._key,d,new YT(a.hasPendingWrites,a.fromCache),i.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cpe{constructor(i,a){this._firestore=i,this._commitHandler=a,this._mutations=[],this._committed=!1,this._dataReader=D1(i)}set(i,a,d){this._verifyNotCommitted();const f=Ak(i,this._firestore),y=MW(f.converter,a,d),R=NW(this._dataReader,"WriteBatch.set",f._key,y,f.converter!==null,d);return this._mutations.push(R.toMutation(f._key,jc.none())),this}update(i,a,d,...f){this._verifyNotCommitted();const y=Ak(i,this._firestore);let R;return R=typeof(a=Dl(a))=="string"||a instanceof nN?Qhe(this._dataReader,"WriteBatch.update",y._key,a,d,f):Jhe(this._dataReader,"WriteBatch.update",y._key,a),this._mutations.push(R.toMutation(y._key,jc.exists(!0))),this}delete(i){this._verifyNotCommitted();const a=Ak(i,this._firestore);return this._mutations=this._mutations.concat(new l1(a._key,jc.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Ut(ht.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ak(o,i){if((o=Dl(o)).firestore!==i)throw new Ut(ht.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lpe(o){return w1(o=oy(o,SR)),new cpe(o,i=>VW(o,i))}(function(i,a=!0){(function(f){by=f})(Ule),lI(new hR("firestore",(d,{instanceIdentifier:f,options:y})=>{const R=d.getProvider("app").getImmediate(),w=new SR(new Qle(d.getProvider("auth-internal")),new ede(R,d.getProvider("app-check-internal")),function(O,x){if(!Object.prototype.hasOwnProperty.apply(O.options,["projectId"]))throw new Ut(ht.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new _R(O.options.projectId,x)}(R,f),R);return y=Object.assign({useFetchStreams:a},y),w._setSettings(y),w},"PUBLIC").setMultipleInstances(!0)),sy(hH,pH,i),sy(hH,pH,"esm2017")})();var dpe="firebase",upe="11.6.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */sy(dpe,upe,"app");const hpe={apiKey:"AIzaSyDo6M6nxQUsRmzlpp0H4tY4zNPopkFmqOA",authDomain:"awpl-d2745.firebaseapp.com",projectId:"awpl-d2745",storageBucket:"awpl-d2745.firebasestorage.app",messagingSenderId:"70994480464",appId:"1:70994480464:web:2fc753f18b87c92a0b3055",measurementId:"G-5S9W471V4H"},ppe=r8(hpe),GT=Whe(ppe);function fpe({chat_id:o,senderImg:i,receiverImg:a}){const[d,f]=K.useState([]),[y,R]=K.useState(""),w=K.useRef(null),N=o,O=o.split("_"),x=O[1],G=O[2],W=se=>se?new Date(se).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}):"",ne=(se,te)=>{if(!se||!te)return!1;const le=new Date(se),ce=new Date(te);return le.getFullYear()===ce.getFullYear()&&le.getMonth()===ce.getMonth()&&le.getDate()===ce.getDate()};K.useEffect(()=>{if(!N){console.warn("chatId is missing, skipping message fetch.");return}const se=u9(wk(GT,"chats",N,"messages"),npe("timestamp","asc")),te=m9(se,le=>{const ce=le.docs.map(me=>({id:me.id,...me.data()}));f(ce)});return()=>te()},[N]),K.useEffect(()=>{w.current&&(w.current.scrollTop=w.current.scrollHeight)},[d]),K.useEffect(()=>{if(!N||!x||!G)return;const se=u9(wk(GT,"chats",N,"messages"),h9("senderId","==",G),h9("seen","==",!1)),te=m9(se,le=>{if(!le.empty){const ce=lpe(GT);le.docs.forEach(me=>{const Ce=wW(GT,"chats",N,"messages",me.id);ce.update(Ce,{seen:!0})}),ce.commit().then(()=>{console.log(`Marked ${le.docs.length} messages from ${G} as seen by ${x} in chat ${N}`)}).catch(me=>{console.error("Error marking messages as seen:",me)})}});return()=>te()},[N,x,G]);const Q=async se=>{if(se.preventDefault(),!y.trim())return;const te=Date.now();try{await ape(wk(GT,"chats",N,"messages"),{message:y,senderId:x,receiverId:G,timestamp:te,seen:!1})}catch(le){console.error("Error sending message:",le)}R("")};return E.jsx("div",{className:"completed-appoint-scrn-right col-lg-6",children:E.jsx("div",{className:"completed-appoint-chat-scrn",children:E.jsxs("div",{className:"chat-container",style:{padding:"20px",maxHeight:"600px"},children:[E.jsxs("div",{className:"chat-messages",ref:w,style:{height:"400px",overflowY:"scroll",marginBottom:"10px",WebkitOverflowScrolling:"touch",overflowX:"hidden"},children:[d.map((se,te)=>{const le=se.senderId===x,ce=le?"#d2f1ff":"#eeeeee",me=le?"flex-end":"flex-start",Ce={borderTopLeftRadius:"12px",borderTopRightRadius:"4px",borderBottomLeftRadius:"12px",borderBottomRightRadius:"12px"},_e={borderTopLeftRadius:"4px",borderTopRightRadius:"12px",borderBottomLeftRadius:"12px",borderBottomRightRadius:"12px"};let ze=!1;if(se.timestamp)if(te===0)ze=!0;else{const Z=d[te-1];Z&&Z.timestamp?ze=!ne(se.timestamp,Z.timestamp):ze=!0}return E.jsxs(Hn.Fragment,{children:[ze&&E.jsxs("div",{style:{textAlign:"center",margin:"20px 0 10px",position:"relative",fontSize:"13px",color:"#666"},children:[E.jsx("span",{style:{backgroundColor:"#f0f2f5",padding:"5px 12px",borderRadius:"15px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:W(se.timestamp)}),E.jsx("div",{style:{position:"absolute",top:"50%",left:"0",right:"0",height:"1px",backgroundColor:"#e0e0e0",zIndex:-1}})]}),E.jsxs("div",{style:{display:"flex",justifyContent:me,margin:"8px 0",alignItems:"flex-end"},children:[!le&&E.jsx("div",{style:{marginRight:"8px"},children:E.jsx("img",{src:a,alt:"Receiver Avatar",style:{width:"40px",height:"40px",borderRadius:"50%",objectFit:"cover"}})}),E.jsxs("div",{style:{padding:"10px 14px",backgroundColor:ce,maxWidth:"70%",fontSize:"14px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",wordBreak:"break-word",...le?Ce:_e},children:[se.imageUrl&&E.jsx("img",{src:se.imageUrl,alt:"Message attachment",style:{maxWidth:"100%",borderRadius:"8px",marginBottom:se.message||se.timestamp&&typeof se.timestamp=="number"?"8px":"0",display:"block"}}),se.message&&E.jsx("div",{children:se.message}),E.jsxs("div",{style:{fontSize:"10px",color:"#666",marginTop:"6px",textAlign:le?"right":"left",display:"flex",alignItems:"center",justifyContent:le?"flex-end":"flex-start",gap:"4px",alignSelf:"flex-end"},children:[se.timestamp?new Date(se.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",le&&(se.seen?E.jsx("span",{style:{color:"#007bff",marginLeft:"4px"},children:""}):E.jsx("span",{style:{color:"#888",marginLeft:"4px"},children:""}))]})]}),le&&E.jsx("div",{style:{marginLeft:"8px"},children:E.jsx("img",{src:i,alt:"Sender Avatar",style:{width:"40px",height:"40px",borderRadius:"50%",objectFit:"cover"}})})]})]},se.id)}),E.jsx("div",{ref:w})]}),E.jsxs("form",{onSubmit:Q,className:"chat-footer",style:{display:"flex",alignItems:"center",gap:"10px"},children:[E.jsxs("div",{className:"chat-input",style:{flex:1,position:"relative"},children:[E.jsx("input",{type:"text",value:y,onChange:se=>R(se.target.value),placeholder:"Type a message",style:{width:"100%",padding:"10px 45px 10px 15px",borderRadius:"30px",border:"1px solid #ccc"}}),E.jsxs("div",{className:"chat-file-upld",style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)"},children:[E.jsx("input",{type:"file",style:{display:"none"},id:"fileInput"}),E.jsx("label",{htmlFor:"fileInput",className:"attach-btn",style:{cursor:"pointer"},children:E.jsx("img",{src:"./images/attach-icon.svg",alt:"Attach"})})]})]}),E.jsx("button",{type:"submit",className:"send-btn",children:E.jsx("img",{src:"./images/send-icon.svg",alt:"Icon"})})]})]})})})}const mpe="https://awplconnectadmin.tgastaging.com",_9={BaseUrl:mpe},_pe=()=>{var W,ne,Q,se,te,le,ce,me,Ce,_e,ze;const o=$r(),{id:i,patientId:a,appointmentId:d,chat_id:f}=o.state||{};console.log("id",i,f,"Chat idddd***************");const{user:y}=Zi(({user:Z})=>Z);console.log(_9.BaseUrl+(y==null?void 0:y.profile_path),"sdjflsjadkflsfj");const R=Mr(),{completeAppointmentPatientDetail:w,prescription_Download:N,loading:O,error:x}=Zi(Z=>Z.prescriptions);K.useEffect(()=>{i&&(R(V0({prescriptionId:i})),console.log("data",w))},[R,i]);const G=void 0;return E.jsx(E.Fragment,{children:E.jsx("main",{className:"doctor-panel",children:E.jsxs("div",{className:"container-fluid",children:[E.jsx("div",{className:"doc-panel-inr",children:E.jsx(Va,{})}),O?E.jsx("div",{className:"loader-main",children:E.jsx("span",{className:"loader"})}):E.jsx("div",{className:"doc-panel-body appoint-details-pg",children:E.jsxs("div",{className:"completed-appoint-scrn",children:[E.jsxs("div",{className:"docpnl-sec-head",children:[E.jsx("h1",{className:"h2-title",children:"Prescription Details"}),E.jsx("div",{className:"back-btn",children:E.jsx(Wt,{to:"#",onClick:Z=>{Z.preventDefault(),window.history.back()},children:E.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),E.jsxs("div",{className:"completed-appoint-scrn-inr row",children:[E.jsxs("div",{className:"completed-appoint-scrn-left col-lg-6",children:[E.jsxs("div",{className:"apointment-detail-card cmn-mb2",children:[E.jsx("div",{className:"apoint-dtl-img",children:E.jsx("img",{src:`${G}/${(W=w==null?void 0:w.patientData)==null?void 0:W.patient_image}`,alt:"Client"})}),E.jsxs("div",{className:"appoint-dtl-content",children:[E.jsxs("div",{className:"appoint-dtl-left",children:[E.jsx("div",{className:"appoint-dtl-head",children:E.jsx("h2",{className:"h4-title",children:(ne=w==null?void 0:w.patientData)==null?void 0:ne.patient_name})}),E.jsx("div",{className:"date h3-title",children:(Q=w==null?void 0:w.patientData)==null?void 0:Q.dayDate}),E.jsx("div",{className:"time",children:(se=w==null?void 0:w.patientData)==null?void 0:se.time})]}),E.jsx(Wt,{to:"/patient-profile",state:{patientId:a,source:"completed",hideSchedule:!1},className:"cmn-btn",children:"View profile"})]})]}),E.jsx("div",{className:"patient-details-wrp",children:E.jsx("form",{children:E.jsx("div",{className:"patient-dtl-form",children:E.jsxs("div",{className:"patient-basic-info",children:[E.jsx("h2",{children:"Basic Information"}),E.jsxs("div",{className:"row",children:[E.jsx("div",{className:"col-lg-12",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Full Name"}),E.jsx("input",{type:"text",value:((te=w==null?void 0:w.basicInformation)==null?void 0:te.patient_fullname)||"",readOnly:!0})]})}),E.jsx("div",{className:"col-lg-12",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Enter Your Height"}),E.jsx("input",{type:"text",value:((le=w==null?void 0:w.basicInformation)==null?void 0:le.Patient_height)||"",readOnly:!0})]})}),E.jsx("div",{className:"col-lg-12",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Enter Your Weight"}),E.jsx("input",{type:"text",value:((ce=w==null?void 0:w.basicInformation)==null?void 0:ce.Patient_weight)||"",readOnly:!0})]})}),E.jsx("div",{className:"col-lg-12",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Gender"}),E.jsx("input",{type:"text",value:((me=w==null?void 0:w.basicInformation)==null?void 0:me.Patient_gender.charAt(0).toUpperCase())+((Ce=w==null?void 0:w.basicInformation)==null?void 0:Ce.Patient_gender.slice(1))||"",readOnly:!0})]})}),E.jsx("div",{className:"col-lg-12",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Enter Age"}),E.jsx("input",{type:"text",value:((_e=w==null?void 0:w.basicInformation)==null?void 0:_e.patient_age)||"",readOnly:!0})]})})]})]})})})})]}),E.jsx(fpe,{chat_id:f,senderImg:_9.BaseUrl+(y==null?void 0:y.profile_path),receiverImg:`${G}/${(ze=w==null?void 0:w.patientData)==null?void 0:ze.patient_image}`})]})]})}),E.jsx(go,{})]})})})};var K0={exports:{}},gpe=K0.exports,g9;function Epe(){return g9||(g9=1,function(o,i){(function(a,d){o.exports=d()})(gpe,function(){function a(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in e)){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(e)}var d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof xL<"u"?xL:typeof self<"u"?self:{};function f(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var y=function(e){try{return!!e()}catch{return!0}},R=!y(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),w=R,N=Function.prototype,O=N.call,x=w&&N.bind.bind(O,O),G=w?x:function(e){return function(){return O.apply(e,arguments)}},W=G({}.isPrototypeOf),ne=function(e){return e&&e.Math===Math&&e},Q=ne(typeof globalThis=="object"&&globalThis)||ne(typeof window=="object"&&window)||ne(typeof self=="object"&&self)||ne(typeof d=="object"&&d)||ne(typeof d=="object"&&d)||function(){return this}()||Function("return this")(),se=R,te=Function.prototype,le=te.apply,ce=te.call,me=typeof Reflect=="object"&&Reflect.apply||(se?ce.bind(le):function(){return ce.apply(le,arguments)}),Ce=G,_e=Ce({}.toString),ze=Ce("".slice),Z=function(e){return ze(_e(e),8,-1)},J=Z,$=G,fe=function(e){if(J(e)==="Function")return $(e)},ve=typeof document=="object"&&document.all,pe=ve===void 0&&ve!==void 0?function(e){return typeof e=="function"||e===ve}:function(e){return typeof e=="function"},he={},Fe=!y(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),st=R,we=Function.prototype.call,je=st?we.bind(we):function(){return we.apply(we,arguments)},nt={},Et={}.propertyIsEnumerable,ge=Object.getOwnPropertyDescriptor,qe=ge&&!Et.call({1:2},1);nt.f=qe?function(e){var t=ge(this,e);return!!t&&t.enumerable}:Et;var Oe,Be,rt=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Nt=y,$e=Z,mt=Object,bt=G("".split),Bt=Nt(function(){return!mt("z").propertyIsEnumerable(0)})?function(e){return $e(e)==="String"?bt(e,""):mt(e)}:mt,fn=function(e){return e==null},vn=fn,qi=TypeError,yt=function(e){if(vn(e))throw new qi("Can't call method on "+e);return e},Vt=Bt,gt=yt,Zt=function(e){return Vt(gt(e))},rn=pe,kn=function(e){return typeof e=="object"?e!==null:rn(e)},ui={},Zr=ui,_r=Q,Ko=pe,Qs=function(e){return Ko(e)?e:void 0},Ti=function(e,t){return arguments.length<2?Qs(Zr[e])||Qs(_r[e]):Zr[e]&&Zr[e][t]||_r[e]&&_r[e][t]},Fa=Q.navigator,Gt=Fa&&Fa.userAgent,Me=Gt?String(Gt):"",un=Q,gn=Me,Ai=un.process,Ea=un.Deno,Ki=Ai&&Ai.versions||Ea&&Ea.version,gr=Ki&&Ki.v8;gr&&(Be=(Oe=gr.split("."))[0]>0&&Oe[0]<4?1:+(Oe[0]+Oe[1])),!Be&&gn&&(!(Oe=gn.match(/Edge\/(\d+)/))||Oe[1]>=74)&&(Oe=gn.match(/Chrome\/(\d+)/))&&(Be=+Oe[1]);var cr=Be,Ts=cr,Yo=y,Xo=Q.String,ya=!!Object.getOwnPropertySymbols&&!Yo(function(){var e=Symbol("symbol detection");return!Xo(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ts&&Ts<41}),Vc=ya&&!Symbol.sham&&typeof Symbol.iterator=="symbol",xl=Ti,Ba=pe,Fc=W,Kp=Object,$s=Vc?function(e){return typeof e=="symbol"}:function(e){var t=xl("Symbol");return Ba(t)&&Fc(t.prototype,Kp(e))},Yp=String,va=function(e){try{return Yp(e)}catch{return"Object"}},ch=pe,Ml=va,p_=TypeError,zn=function(e){if(ch(e))return e;throw new p_(Ml(e)+" is not a function")},Ur=zn,Ar=fn,ks=function(e,t){var n=e[t];return Ar(n)?void 0:Ur(n)},lh=je,f_=pe,Bc=kn,m_=TypeError,Ul={exports:{}},Gc=Q,Hc=Object.defineProperty,Jo=Q,Qo=function(e,t){try{Hc(Gc,e,{value:t,configurable:!0,writable:!0})}catch{Gc[e]=t}return t},Rs="__core-js_shared__",lr=Ul.exports=Jo[Rs]||Qo(Rs,{});(lr.versions||(lr.versions=[])).push({version:"3.41.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.41.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Hd=Ul.exports,zd=Hd,bs=function(e,t){return zd[e]||(zd[e]=t||{})},zc=yt,__=Object,Sa=function(e){return __(zc(e))},Wd=Sa,g_=G({}.hasOwnProperty),ki=Object.hasOwn||function(e,t){return g_(Wd(e),t)},$o=G,hs=0,qd=Math.random(),E_=$o(1 .toString),Eo=function(e){return"Symbol("+(e===void 0?"":e)+")_"+E_(++hs+qd,36)},dh=bs,Kd=ki,Xp=Eo,uh=ya,xs=Vc,Zo=Q.Symbol,Jp=dh("wks"),hh=xs?Zo.for||Zo:Zo&&Zo.withoutSetter||Xp,hi=function(e){return Kd(Jp,e)||(Jp[e]=uh&&Kd(Zo,e)?Zo[e]:hh("Symbol."+e)),Jp[e]},Yd=je,y_=kn,Er=$s,Ta=ks,Xd=function(e,t){var n,r;if(f_(n=e.toString)&&!Bc(r=lh(n,e))||f_(n=e.valueOf)&&!Bc(r=lh(n,e)))return r;throw new m_("Can't convert object to primitive value")},jl=TypeError,Wc=hi("toPrimitive"),Ii=function(e,t){if(!y_(e)||Er(e))return e;var n,r=Ta(e,Wc);if(r){if(n=Yd(r,e,t),!y_(n)||Er(n))return n;throw new jl("Can't convert object to primitive value")}return Xd(e)},Jd=$s,Zs=function(e){var t=Ii(e,"string");return Jd(t)?t:t+""},Vl=kn,ph=Q.document,Qp=Vl(ph)&&Vl(ph.createElement),Qd=function(e){return Qp?ph.createElement(e):{}},Ny=Qd,v_=!Fe&&!y(function(){return Object.defineProperty(Ny("div"),"a",{get:function(){return 7}}).a!==7}),fh=Fe,qc=je,Ga=nt,Kc=rt,Yc=Zt,$p=Zs,ec=ki,S_=v_,Fl=Object.getOwnPropertyDescriptor;he.f=fh?Fl:function(e,t){if(e=Yc(e),t=$p(t),S_)try{return Fl(e,t)}catch{}if(ec(e,t))return Kc(!qc(Ga.f,e,t),e[t])};var yo=y,Ha=pe,$d=/#|\.prototype\./,ea=function(e,t){var n=Xc[Bl(e)];return n===tc||n!==Zp&&(Ha(t)?yo(t):!!t)},Bl=ea.normalize=function(e){return String(e).replace($d,".").toLowerCase()},Xc=ea.data={},Zp=ea.NATIVE="N",tc=ea.POLYFILL="P",vo=ea,ef=zn,es=R,vi=fe(fe.bind),Ra=function(e,t){return ef(e),t===void 0?e:es?vi(e,t):function(){return e.apply(t,arguments)}},ts={},tf=Fe&&y(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),mh=kn,_h=String,nc=TypeError,yr=function(e){if(mh(e))return e;throw new nc(_h(e)+" is not an object")},za=Fe,T_=v_,Oy=tf,ic=yr,Zd=Zs,nf=TypeError,Gl=Object.defineProperty,R_=Object.getOwnPropertyDescriptor,Hl="enumerable",rf="configurable",eu="writable";ts.f=za?Oy?function(e,t,n){if(ic(e),t=Zd(t),ic(n),typeof e=="function"&&t==="prototype"&&"value"in n&&eu in n&&!n[eu]){var r=R_(e,t);r&&r[eu]&&(e[t]=n.value,n={configurable:rf in n?n[rf]:r[rf],enumerable:Hl in n?n[Hl]:r[Hl],writable:!1})}return Gl(e,t,n)}:Gl:function(e,t,n){if(ic(e),t=Zd(t),ic(n),T_)try{return Gl(e,t,n)}catch{}if("get"in n||"set"in n)throw new nf("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var tu=ts,b_=rt,rc=Fe?function(e,t,n){return tu.f(e,t,b_(1,n))}:function(e,t,n){return e[t]=n,e},Jc=Q,nu=me,C_=fe,gh=pe,w_=he.f,sf=vo,ta=ui,A_=Ra,Qc=rc,af=ki,I_=function(e){var t=function(n,r,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,s)}return nu(e,this,arguments)};return t.prototype=e.prototype,t},dn=function(e,t){var n,r,s,l,h,p,m,g,v,T=e.target,C=e.global,I=e.stat,U=e.proto,k=C?Jc:I?Jc[T]:Jc[T]&&Jc[T].prototype,M=C?ta:ta[T]||Qc(ta,T,{})[T],F=M.prototype;for(l in t)r=!(n=sf(C?l:T+(I?".":"#")+l,e.forced))&&k&&af(k,l),p=M[l],r&&(m=e.dontCallGetSet?(v=w_(k,l))&&v.value:k[l]),h=r&&m?m:t[l],(n||U||typeof p!=typeof h)&&(g=e.bind&&r?A_(h,Jc):e.wrap&&r?I_(h):U&&gh(h)?C_(h):h,(e.sham||h&&h.sham||p&&p.sham)&&Qc(g,"sham",!0),Qc(M,l,g),U&&(af(ta,s=T+"Prototype")||Qc(ta,s,{}),Qc(ta[s],l,h),e.real&&F&&(n||!F[l])&&Qc(F,l,h)))},Ms=Math.ceil,N_=Math.floor,O_=Math.trunc||function(e){var t=+e;return(t>0?N_:Ms)(t)},sc=O_,b=function(e){var t=+e;return t!=t||t===0?0:sc(t)},j=b,z=Math.max,oe=Math.min,Pe=function(e,t){var n=j(e);return n<0?z(n+t,0):oe(n,t)},Ke=b,Tt=Math.min,$n=function(e){var t=Ke(e);return t>0?Tt(t,9007199254740991):0},jr=$n,Cn=function(e){return jr(e.length)},ns=Zt,Vr=Pe,$c=Cn,is=function(e){return function(t,n,r){var s=ns(t),l=$c(s);if(l===0)return!e&&-1;var h,p=Vr(r,l);if(e&&n!=n){for(;l>p;)if((h=s[p++])!=h)return!0}else for(;l>p;p++)if((e||p in s)&&s[p]===n)return e||p||0;return!e&&-1}},Wa={includes:is(!0),indexOf:is(!1)},of=Wa.includes;dn({target:"Array",proto:!0,forced:y(function(){return!Array(1).includes()})},{includes:function(e){return of(this,e,arguments.length>1?arguments[1]:void 0)}});var D_=Q,xR=ui,ba=function(e,t){var n=xR[e+"Prototype"],r=n&&n[t];if(r)return r;var s=D_[e],l=s&&s.prototype;return l&&l[t]},Dy=ba("Array","includes"),Py=kn,MR=Z,UR=hi("match"),Ly=function(e){var t;return Py(e)&&((t=e[UR])!==void 0?!!t:MR(e)==="RegExp")},aN=Ly,oN=TypeError,jR={};jR[hi("toStringTag")]="z";var ky=String(jR)==="[object z]",cN=ky,Ca=pe,zl=Z,VR=hi("toStringTag"),FR=Object,BR=zl(function(){return arguments}())==="Arguments",Zc=cN?zl:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(s,l){try{return s[l]}catch{}}(t=FR(e),VR))=="string"?n:BR?zl(t):(r=zl(t))==="Object"&&Ca(t.callee)?"Arguments":r},xy=Zc,lN=String,Fr=function(e){if(xy(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return lN(e)},My=hi("match"),cf=dn,Uy=function(e){if(aN(e))throw new oN("The method doesn't accept regular expressions");return e},GR=yt,Wl=Fr,Eh=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[My]=!1,"/./"[e](t)}catch{}}return!1},jy=G("".indexOf);cf({target:"String",proto:!0,forced:!Eh("includes")},{includes:function(e){return!!~jy(Wl(GR(this)),Wl(Uy(e)),arguments.length>1?arguments[1]:void 0)}});var HR=ba("String","includes"),ql=W,zR=Dy,WR=HR,P_=Array.prototype,Vy=String.prototype,dN=function(e){var t=e.includes;return e===P_||ql(P_,e)&&t===P_.includes?zR:typeof e=="string"||e===Vy||ql(Vy,e)&&t===Vy.includes?WR:t},Ye=f(dN),qR=zn,KR=Sa,Fy=Bt,So=Cn,By=TypeError,wa="Reduce of empty array with no initial value",qa=function(e){return function(t,n,r,s){var l=KR(t),h=Fy(l),p=So(l);if(qR(n),p===0&&r<2)throw new By(wa);var m=e?p-1:0,g=e?-1:1;if(r<2)for(;;){if(m in h){s=h[m],m+=g;break}if(m+=g,e?m<0:p<=m)throw new By(wa)}for(;e?m>=0:p>m;m+=g)m in h&&(s=n(s,h[m],m,l));return s}},yh={left:qa(!1)},Gy=y,iu=function(e,t){var n=[][e];return!!n&&Gy(function(){n.call(null,t||function(){return 1},1)})},Kl=Q,Hy=Me,vh=Z,lf=function(e){return Hy.slice(0,e.length)===e},Sh=lf("Bun/")?"BUN":lf("Cloudflare-Workers")?"CLOUDFLARE":lf("Deno/")?"DENO":lf("Node.js/")?"NODE":Kl.Bun&&typeof Bun.version=="string"?"BUN":Kl.Deno&&typeof Deno.version=="object"?"DENO":vh(Kl.process)==="process"?"NODE":Kl.window&&Kl.document?"BROWSER":"REST",el=Sh==="NODE",uN=yh.left;dn({target:"Array",proto:!0,forced:!el&&cr>79&&cr<83||!iu("reduce")},{reduce:function(e){var t=arguments.length;return uN(this,e,t,t>1?arguments[1]:void 0)}});var Aa=ba("Array","reduce"),zy=W,tl=Aa,L_=Array.prototype,k_=function(e){var t=e.reduce;return e===L_||zy(L_,e)&&t===L_.reduce?tl:t},Yl=k_,na=f(Yl),Wy=Z,ac=Array.isArray||function(e){return Wy(e)==="Array"},Th=dn,x_=ac,M_=G([].reverse),Ia=[1,2];Th({target:"Array",proto:!0,forced:String(Ia)===String(Ia.reverse())},{reverse:function(){return x_(this)&&(this.length=this.length),M_(this)}});var Ka=ba("Array","reverse"),ru=W,nl=Ka,To=Array.prototype,su=function(e){var t=e.reverse;return e===To||ru(To,e)&&t===To.reverse?nl:t},qy=su,U_=f(qy),Ky=Eo,Cs=bs("keys"),Yi=function(e){return Cs[e]||(Cs[e]=Ky(e))},pi=!y(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),au=ki,oc=pe,Yy=Sa,ou=pi,Xy=Yi("IE_PROTO"),j_=Object,df=j_.prototype,cu=ou?j_.getPrototypeOf:function(e){var t=Yy(e);if(au(t,Xy))return t[Xy];var n=t.constructor;return oc(n)&&t instanceof n?n.prototype:t instanceof j_?df:null},YR=G,uf=zn,Jy=kn,lu=function(e){return Jy(e)||e===null},il=String,Xl=TypeError,rl=function(e,t,n){try{return YR(uf(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},Qy=kn,$y=yt,hf=function(e){if(lu(e))return e;throw new Xl("Can't set "+il(e)+" as a prototype")},V_=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=rl(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(r,s){return $y(r),hf(s),Qy(r)&&(t?e(r,s):r.__proto__=s),r}}():void 0),cc={},Br={},Rh=ki,XR=Zt,hN=Wa.indexOf,pN=Br,JR=G([].push),Ir=function(e,t){var n,r=XR(e),s=0,l=[];for(n in r)!Rh(pN,n)&&Rh(r,n)&&JR(l,n);for(;t.length>s;)Rh(r,n=t[s++])&&(~hN(l,n)||JR(l,n));return l},pf=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ff=Ir,mf=pf.concat("length","prototype");cc.f=Object.getOwnPropertyNames||function(e){return ff(e,mf)};var du={};du.f=Object.getOwnPropertySymbols;var bh=Ti,Ch=cc,fN=du,QR=yr,mN=G([].concat),$R=bh("Reflect","ownKeys")||function(e){var t=Ch.f(QR(e)),n=fN.f;return n?mN(t,n(e)):t},Jl=ki,Zy=$R,F_=he,ZR=ts,uu={},eb=Ir,B_=pf,wh=Object.keys||function(e){return eb(e,B_)},tb=Fe,G_=tf,nb=ts,_f=yr,ib=Zt,rb=wh;uu.f=tb&&!G_?Object.defineProperties:function(e,t){_f(e);for(var n,r=ib(t),s=rb(t),l=s.length,h=0;l>h;)nb.f(e,n=s[h++],r[n]);return e};var Ro,H_=Ti("document","documentElement"),ev=yr,Ql=uu,sl=pf,gf=Br,tv=H_,nv=Qd,hu="prototype",pu="script",iv=Yi("IE_PROTO"),z_=function(){},fu=function(e){return"<"+pu+">"+e+"</"+pu+">"},Ef=function(e){e.write(fu("")),e.close();var t=e.parentWindow.Object;return e=null,t},yf=function(){try{Ro=new ActiveXObject("htmlfile")}catch{}var e,t,n;yf=typeof document<"u"?document.domain&&Ro?Ef(Ro):(t=nv("iframe"),n="java"+pu+":",t.style.display="none",tv.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(fu("document.F=Object")),e.close(),e.F):Ef(Ro);for(var r=sl.length;r--;)delete yf[hu][sl[r]];return yf()};gf[iv]=!0;var mu=Object.create||function(e,t){var n;return e!==null?(z_[hu]=ev(e),n=new z_,z_[hu]=null,n[iv]=e):n=yf(),t===void 0?n:Ql.f(n,t)},rv=kn,$l=rc,In=Error,Ni=G("".replace),Nr=String(new In("zxcasd").stack),vf=/\n\s*at [^:]*:[^\n]*/,Ah=vf.test(Nr),_u=rt,W_=!y(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",_u(1,7)),e.stack!==7)}),Sf=rc,Ih=function(e,t){if(Ah&&typeof e=="string"&&!In.prepareStackTrace)for(;t--;)e=Ni(e,vf,"");return e},_N=W_,dr=Error.captureStackTrace,Zl={},sv=Zl,sb=hi("iterator"),ab=Array.prototype,ob=function(e){return e!==void 0&&(sv.Array===e||ab[sb]===e)},av=Zc,q_=ks,ov=fn,ia=Zl,Or=hi("iterator"),Nh=function(e){if(!ov(e))return q_(e,Or)||q_(e,"@@iterator")||ia[av(e)]},Tf=je,K_=zn,cv=yr,al=va,Y_=Nh,lv=TypeError,Rf=function(e,t){var n=arguments.length<2?Y_(e):t;if(K_(n))return cv(Tf(n,e));throw new lv(al(e)+" is not iterable")},cb=je,dv=yr,lb=ks,uv=function(e,t,n){var r,s;dv(e);try{if(!(r=lb(e,"return"))){if(t==="throw")throw n;return n}r=cb(r,e)}catch(l){s=!0,r=l}if(t==="throw")throw n;if(s)throw r;return dv(r),n},db=Ra,ub=je,hv=yr,hb=va,gN=ob,pb=Cn,pv=W,fb=Rf,fv=Nh,mv=uv,mb=TypeError,bf=function(e,t){this.stopped=e,this.result=t},_v=bf.prototype,Oh=function(e,t,n){var r,s,l,h,p,m,g,v=n&&n.that,T=!(!n||!n.AS_ENTRIES),C=!(!n||!n.IS_RECORD),I=!(!n||!n.IS_ITERATOR),U=!(!n||!n.INTERRUPTED),k=db(t,v),M=function(B){return r&&mv(r,"normal",B),new bf(!0,B)},F=function(B){return T?(hv(B),U?k(B[0],B[1],M):k(B[0],B[1])):U?k(B,M):k(B)};if(C)r=e.iterator;else if(I)r=e;else{if(!(s=fv(e)))throw new mb(hb(e)+" is not iterable");if(gN(s)){for(l=0,h=pb(e);h>l;l++)if((p=F(e[l]))&&pv(_v,p))return p;return new bf(!1)}r=fb(e,s)}for(m=C?e.next:r.next;!(g=ub(m,r)).done;){try{p=F(g.value)}catch(B){mv(r,"throw",B)}if(typeof p=="object"&&p&&pv(_v,p))return p}return new bf(!1)},EN=Fr,_b=dn,Dh=W,X_=cu,Cf=V_,J_=function(e,t,n){for(var r=Zy(t),s=ZR.f,l=F_.f,h=0;h<r.length;h++){var p=r[h];Jl(e,p)||n&&Jl(n,p)||s(e,p,l(t,p))}},Ph=mu,Q_=rc,$_=rt,gb=function(e,t){rv(t)&&"cause"in t&&$l(e,"cause",t.cause)},Eb=function(e,t,n,r){_N&&(dr?dr(e,t):Sf(e,"stack",Ih(n,r)))},yb=Oh,vb=function(e,t){return e===void 0?arguments.length<2?"":t:EN(e)},gv=hi("toStringTag"),wf=Error,Sb=[].push,ed=function(e,t){var n,r=Dh(Z_,this);Cf?n=Cf(new wf,r?X_(this):Z_):(n=r?this:Ph(Z_),Q_(n,gv,"Error")),t!==void 0&&Q_(n,"message",vb(t)),Eb(n,ed,n.stack,1),arguments.length>2&&gb(n,arguments[2]);var s=[];return yb(e,Sb,{that:s}),Q_(n,"errors",s),n};Cf?Cf(ed,wf):J_(ed,wf,{name:!0});var Z_=ed.prototype=Ph(wf.prototype,{constructor:$_(1,ed),message:$_(1,""),name:$_(1,"AggregateError")});_b({global:!0},{AggregateError:ed});var Af,If,Lh,Tb=pe,Ev=Q.WeakMap,yv=Tb(Ev)&&/native code/.test(String(Ev)),vv=Q,Rb=kn,yN=rc,Sv=ki,eg=Hd,Nf=Yi,Tv=Br,Of="Object already initialized",tg=vv.TypeError,bb=vv.WeakMap;if(yv||eg.state){var Na=eg.state||(eg.state=new bb);Na.get=Na.get,Na.has=Na.has,Na.set=Na.set,Af=function(e,t){if(Na.has(e))throw new tg(Of);return t.facade=e,Na.set(e,t),t},If=function(e){return Na.get(e)||{}},Lh=function(e){return Na.has(e)}}else{var gu=Nf("state");Tv[gu]=!0,Af=function(e,t){if(Sv(e,gu))throw new tg(Of);return t.facade=e,yN(e,gu,t),t},If=function(e){return Sv(e,gu)?e[gu]:{}},Lh=function(e){return Sv(e,gu)}}var td,Cb,Eu,bo={set:Af,get:If,has:Lh,enforce:function(e){return Lh(e)?If(e):Af(e,{})},getterFor:function(e){return function(t){var n;if(!Rb(t)||(n=If(t)).type!==e)throw new tg("Incompatible receiver, "+e+" required");return n}}},kh=Fe,Df=ki,Pf=Function.prototype,wb=kh&&Object.getOwnPropertyDescriptor,Rv=Df(Pf,"name"),yu={PROPER:Rv&&(function(){}).name==="something",CONFIGURABLE:Rv&&(!kh||kh&&wb(Pf,"name").configurable)},Ab=rc,Gr=function(e,t,n,r){return r&&r.enumerable?e[t]=n:Ab(e,t,n),e},lc=y,nd=pe,Ib=kn,id=mu,dc=cu,Hr=Gr,xh=hi("iterator"),ng=!1;[].keys&&("next"in(Eu=[].keys())?(Cb=dc(dc(Eu)))!==Object.prototype&&(td=Cb):ng=!0);var bv=!Ib(td)||lc(function(){var e={};return td[xh].call(e)!==e});nd((td=bv?{}:id(td))[xh])||Hr(td,xh,function(){return this});var Cv={IteratorPrototype:td,BUGGY_SAFARI_ITERATORS:ng},Nb=Zc,vu=ky?{}.toString:function(){return"[object "+Nb(this)+"]"},ig=ky,Ob=ts.f,Db=rc,Pb=ki,rg=vu,wv=hi("toStringTag"),Co=function(e,t,n,r){var s=n?e:e&&e.prototype;s&&(Pb(s,wv)||Ob(s,wv,{configurable:!0,value:t}),r&&!ig&&Db(s,"toString",rg))},Lb=Cv.IteratorPrototype,kb=mu,vN=rt,xb=Co,rs=Zl,ps=function(){return this},sg=function(e,t,n,r){var s=t+" Iterator";return e.prototype=kb(Lb,{next:vN(+!r,n)}),xb(e,s,!1,!0),rs[s]=ps,e},Mb=dn,Ub=je,jb=yu,Vb=sg,ag=cu,Av=Co,Iv=Gr,Nv=Zl,Fb=Cv,Ov=jb.PROPER,Mh=Fb.BUGGY_SAFARI_ITERATORS,Lf=hi("iterator"),Dv="keys",Uh="values",kf="entries",Pv=function(){return this},Lv=function(e,t,n,r,s,l,h){Vb(n,t,r);var p,m,g,v=function(F){if(F===s&&k)return k;if(!Mh&&F&&F in I)return I[F];switch(F){case Dv:case Uh:case kf:return function(){return new n(this,F)}}return function(){return new n(this)}},T=t+" Iterator",C=!1,I=e.prototype,U=I[Lf]||I["@@iterator"]||s&&I[s],k=!Mh&&U||v(s),M=t==="Array"&&I.entries||U;if(M&&(p=ag(M.call(new e)))!==Object.prototype&&p.next&&(Av(p,T,!0,!0),Nv[T]=Pv),Ov&&s===Uh&&U&&U.name!==Uh&&(C=!0,k=function(){return Ub(U,this)}),s)if(m={values:v(Uh),keys:l?k:v(Dv),entries:v(kf)},h)for(g in m)(Mh||C||!(g in I))&&Iv(I,g,m[g]);else Mb({target:t,proto:!0,forced:Mh||C},m);return h&&I[Lf]!==k&&Iv(I,Lf,k,{}),Nv[t]=k,m},jh=function(e,t){return{value:e,done:t}},Bb=Zt,uc=Zl,og=bo;ts.f;var SN=Lv,xf=jh,hc="Array Iterator",Gb=og.set,cg=og.getterFor(hc);SN(Array,"Array",function(e,t){Gb(this,{type:hc,target:Bb(e),index:0,kind:t})},function(){var e=cg(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,xf(void 0,!0);switch(e.kind){case"keys":return xf(n,!1);case"values":return xf(t[n],!1)}return xf([n,t[n]],!1)},"values"),uc.Arguments=uc.Array;var Mf=ts,Fi=function(e,t,n){return Mf.f(e,t,n)},TN=Ti,RN=Fi,Hb=Fe,Vh=hi("species"),rd=W,zb=TypeError,lg=function(e,t){if(rd(t,e))return e;throw new zb("Incorrect invocation")},Uf=pe,Ya=Hd,Wb=G(Function.toString);Uf(Ya.inspectSource)||(Ya.inspectSource=function(e){return Wb(e)});var dg=Ya.inspectSource,qb=G,kv=y,ug=pe,hg=Zc,Kb=dg,pc=function(){},ur=Ti("Reflect","construct"),jf=/^\s*(?:class|function)\b/,Yb=qb(jf.exec),ss=!jf.test(pc),Vf=function(e){if(!ug(e))return!1;try{return ur(pc,[],e),!0}catch{return!1}},xv=function(e){if(!ug(e))return!1;switch(hg(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return ss||!!Yb(jf,Kb(e))}catch{return!0}};xv.sham=!0;var Fh,Ri,Us,wo,Ff=!ur||kv(function(){var e;return Vf(Vf.call)||!Vf(Object)||!Vf(function(){e=!0})||e})?xv:Vf,Xb=Ff,bN=va,Mv=TypeError,ra=yr,Ao=function(e){if(Xb(e))return e;throw new Mv(bN(e)+" is not a constructor")},Jb=fn,Oa=hi("species"),pg=function(e,t){var n,r=ra(e).constructor;return r===void 0||Jb(n=ra(r)[Oa])?t:Ao(n)},js=G([].slice),Su=TypeError,sa=function(e,t){if(e<t)throw new Su("Not enough arguments");return e},fg=/(?:ipad|iphone|ipod).*applewebkit/i.test(Me),Vs=Q,fc=me,Qb=Ra,Tu=pe,Bf=ki,Bh=y,Ru=H_,$b=js,Uv=Qd,Gf=sa,Zb=fg,mg=el,_g=Vs.setImmediate,jv=Vs.clearImmediate,CN=Vs.process,fi=Vs.Dispatch,Bi=Vs.Function,Vn=Vs.MessageChannel,ei=Vs.String,mi=0,fs={},ol="onreadystatechange";Bh(function(){Fh=Vs.location});var sd=function(e){if(Bf(fs,e)){var t=fs[e];delete fs[e],t()}},Hf=function(e){return function(){sd(e)}},mc=function(e){sd(e.data)},nr=function(e){Vs.postMessage(ei(e),Fh.protocol+"//"+Fh.host)};_g&&jv||(_g=function(e){Gf(arguments.length,1);var t=Tu(e)?e:Bi(e),n=$b(arguments,1);return fs[++mi]=function(){fc(t,void 0,n)},Ri(mi),mi},jv=function(e){delete fs[e]},mg?Ri=function(e){CN.nextTick(Hf(e))}:fi&&fi.now?Ri=function(e){fi.now(Hf(e))}:Vn&&!Zb?(wo=(Us=new Vn).port2,Us.port1.onmessage=mc,Ri=Qb(wo.postMessage,wo)):Vs.addEventListener&&Tu(Vs.postMessage)&&!Vs.importScripts&&Fh&&Fh.protocol!=="file:"&&!Bh(nr)?(Ri=nr,Vs.addEventListener("message",mc,!1)):Ri=ol in Uv("script")?function(e){Ru.appendChild(Uv("script"))[ol]=function(){Ru.removeChild(this),sd(e)}}:function(e){setTimeout(Hf(e),0)});var Io={set:_g,clear:jv},ad=Q,Vv=Fe,Xa=Object.getOwnPropertyDescriptor,bu=function(e){if(!Vv)return ad[e];var t=Xa(ad,e);return t&&t.value},Gh=function(){this.head=null,this.tail=null};Gh.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var zr,zf,Wf,Hh,qf,cl=Gh,ms=/ipad|iphone|ipod/i.test(Me)&&typeof Pebble<"u",od=/web0s(?!.*chrome)/i.test(Me),No=Q,zh=bu,gg=Ra,Kf=Io.set,eC=cl,Yf=fg,Fv=ms,Da=od,Eg=el,aa=No.MutationObserver||No.WebKitMutationObserver,Bv=No.document,Gv=No.process,yg=No.Promise,_c=zh("queueMicrotask");if(!_c){var Cu=new eC,Wh=function(){var e,t;for(Eg&&(e=Gv.domain)&&e.exit();t=Cu.get();)try{t()}catch(n){throw Cu.head&&zr(),n}e&&e.enter()};Yf||Eg||Da||!aa||!Bv?!Fv&&yg&&yg.resolve?((Hh=yg.resolve(void 0)).constructor=yg,qf=gg(Hh.then,Hh),zr=function(){qf(Wh)}):Eg?zr=function(){Gv.nextTick(Wh)}:(Kf=gg(Kf,No),zr=function(){Kf(Wh)}):(zf=!0,Wf=Bv.createTextNode(""),new aa(Wh).observe(Wf,{characterData:!0}),zr=function(){Wf.data=zf=!zf}),_c=function(e){Cu.head||zr(),Cu.add(e)}}var wu=_c,Au=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},cd=Q.Promise,tC=Q,Iu=cd,Hv=pe,wN=vo,AN=dg,IN=hi,zv=Sh,vg=cr,Nu=Iu&&Iu.prototype,Sg=IN("species"),Wv=Hv(tC.PromiseRejectionEvent),nC=wN("Promise",function(){var e=AN(Iu),t=e!==String(Iu);if(!t&&vg===66||!Nu.catch||!Nu.finally)return!0;if(!vg||vg<51||!/native code/.test(e)){var n=new Iu(function(s){s(1)}),r=function(s){s(function(){},function(){})};if((n.constructor={})[Sg]=r,!(n.then(function(){})instanceof r))return!0}return!(t||zv!=="BROWSER"&&zv!=="DENO"||Wv)}),qh={CONSTRUCTOR:nC,REJECTION_EVENT:Wv},Oo={},qv=zn,iC=TypeError,Tg=function(e){var t,n;this.promise=new e(function(r,s){if(t!==void 0||n!==void 0)throw new iC("Bad Promise constructor");t=r,n=s}),this.resolve=qv(t),this.reject=qv(n)};Oo.f=function(e){return new Tg(e)};var Rg,Kv,xi=dn,Kh=el,ld=Q,Yh=je,NN=Gr,ON=Co,DN=function(e){var t=TN(e);Hb&&t&&!t[Vh]&&RN(t,Vh,{configurable:!0,get:function(){return this}})},bg=zn,dd=pe,Yv=kn,Cg=lg,Xv=pg,ud=Io.set,Ja=wu,Xf=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},PN=Au,rC=cl,Jv=bo,wg=cd,Qv=qh,sC=Oo,Xh="Promise",$v=Qv.CONSTRUCTOR,aC=Qv.REJECTION_EVENT,Zv=Jv.getterFor(Xh),eS=Jv.set,tS=wg&&wg.prototype,Jf=wg,nS=tS,Jh=ld.TypeError,iS=ld.document,Ag=ld.process,xn=sC.f,rS=xn,Ig=!!(iS&&iS.createEvent&&ld.dispatchEvent),Ng="unhandledrejection",sS=function(e){var t;return!(!Yv(e)||!dd(t=e.then))&&t},Og=function(e,t){var n,r,s,l=t.value,h=t.state===1,p=h?e.ok:e.fail,m=e.resolve,g=e.reject,v=e.domain;try{p?(h||(t.rejection===2&&LN(t),t.rejection=1),p===!0?n=l:(v&&v.enter(),n=p(l),v&&(v.exit(),s=!0)),n===e.promise?g(new Jh("Promise-chain cycle")):(r=sS(n))?Yh(r,n,m,g):m(n)):g(l)}catch(T){v&&!s&&v.exit(),g(T)}},Qh=function(e,t){e.notified||(e.notified=!0,Ja(function(){for(var n,r=e.reactions;n=r.get();)Og(n,e);e.notified=!1,t&&!e.rejection&&$h(e)}))},Qf=function(e,t,n){var r,s;Ig?((r=iS.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),ld.dispatchEvent(r)):r={promise:t,reason:n},!aC&&(s=ld["on"+e])?s(r):e===Ng&&Xf("Unhandled promise rejection",n)},$h=function(e){Yh(ud,ld,function(){var t,n=e.facade,r=e.value;if(aS(e)&&(t=PN(function(){Kh?Ag.emit("unhandledRejection",r,n):Qf(Ng,n,r)}),e.rejection=Kh||aS(e)?2:1,t.error))throw t.value})},aS=function(e){return e.rejection!==1&&!e.parent},LN=function(e){Yh(ud,ld,function(){var t=e.facade;Kh?Ag.emit("rejectionHandled",t):Qf("rejectionhandled",t,e.value)})},Zh=function(e,t,n){return function(r){e(t,r,n)}},Ou=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,Qh(e,!0))},Dg=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new Jh("Promise can't be resolved itself");var r=sS(t);r?Ja(function(){var s={done:!1};try{Yh(r,t,Zh(Dg,s,e),Zh(Ou,s,e))}catch(l){Ou(s,l,e)}}):(e.value=t,e.state=1,Qh(e,!1))}catch(s){Ou({done:!1},s,e)}}};$v&&(nS=(Jf=function(e){Cg(this,nS),bg(e),Yh(Rg,this);var t=Zv(this);try{e(Zh(Dg,t),Zh(Ou,t))}catch(n){Ou(t,n)}}).prototype,(Rg=function(e){eS(this,{type:Xh,done:!1,notified:!1,parent:!1,reactions:new rC,rejection:!1,state:0,value:null})}).prototype=NN(nS,"then",function(e,t){var n=Zv(this),r=xn(Xv(this,Jf));return n.parent=!0,r.ok=!dd(e)||e,r.fail=dd(t)&&t,r.domain=Kh?Ag.domain:void 0,n.state===0?n.reactions.add(r):Ja(function(){Og(r,n)}),r.promise}),Kv=function(){var e=new Rg,t=Zv(e);this.promise=e,this.resolve=Zh(Dg,t),this.reject=Zh(Ou,t)},sC.f=xn=function(e){return e===Jf||e===void 0?new Kv(e):rS(e)}),xi({global:!0,wrap:!0,forced:$v},{Promise:Jf}),ON(Jf,Xh,!1,!0),DN(Xh);var $f=hi("iterator"),bi=!1;try{var oS=0,as={next:function(){return{done:!!oS++}},return:function(){bi=!0}};as[$f]=function(){return this},Array.from(as,function(){throw 2})}catch{}var kN=cd,cS=function(e,t){try{if(!t&&!bi)return!1}catch{return!1}var n=!1;try{var r={};r[$f]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch{}return n},ep=qh.CONSTRUCTOR||!cS(function(e){kN.all(e).then(void 0,function(){})}),Pg=je,oC=zn,cC=Oo,lS=Au,dS=Oh;dn({target:"Promise",stat:!0,forced:ep},{all:function(e){var t=this,n=cC.f(t),r=n.resolve,s=n.reject,l=lS(function(){var h=oC(t.resolve),p=[],m=0,g=1;dS(e,function(v){var T=m++,C=!1;g++,Pg(h,t,v).then(function(I){C||(C=!0,p[T]=I,--g||r(p))},s)}),--g||r(p)});return l.error&&s(l.value),n.promise}});var xN=dn,lC=qh.CONSTRUCTOR;cd&&cd.prototype,xN({target:"Promise",proto:!0,forced:lC,real:!0},{catch:function(e){return this.then(void 0,e)}});var MN=je,dC=zn,UN=Oo,jN=Au,hd=Oh;dn({target:"Promise",stat:!0,forced:ep},{race:function(e){var t=this,n=UN.f(t),r=n.reject,s=jN(function(){var l=dC(t.resolve);hd(e,function(h){MN(l,t,h).then(n.resolve,r)})});return s.error&&r(s.value),n.promise}});var uC=Oo;dn({target:"Promise",stat:!0,forced:qh.CONSTRUCTOR},{reject:function(e){var t=uC.f(this);return(0,t.reject)(e),t.promise}});var uS=yr,VN=kn,FN=Oo,Lg=function(e,t){if(uS(e),VN(t)&&t.constructor===e)return t;var n=FN.f(e);return(0,n.resolve)(t),n.promise},BN=dn,Do=cd,hS=qh.CONSTRUCTOR,hC=Lg,pC=Ti("Promise"),Zf=!hS;BN({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return hC(Zf&&this===pC?Do:this,e)}});var Qa=je,fC=zn,kg=Oo,ll=Au,GN=Oh;dn({target:"Promise",stat:!0,forced:ep},{allSettled:function(e){var t=this,n=kg.f(t),r=n.resolve,s=n.reject,l=ll(function(){var h=fC(t.resolve),p=[],m=0,g=1;GN(e,function(v){var T=m++,C=!1;g++,Qa(h,t,v).then(function(I){C||(C=!0,p[T]={status:"fulfilled",value:I},--g||r(p))},function(I){C||(C=!0,p[T]={status:"rejected",reason:I},--g||r(p))})}),--g||r(p)});return l.error&&s(l.value),n.promise}});var HN=je,tp=zn,mC=Ti,zN=Oo,WN=Au,qN=Oh,_C="No one promise resolved";dn({target:"Promise",stat:!0,forced:ep},{any:function(e){var t=this,n=mC("AggregateError"),r=zN.f(t),s=r.resolve,l=r.reject,h=WN(function(){var p=tp(t.resolve),m=[],g=0,v=1,T=!1;qN(e,function(C){var I=g++,U=!1;v++,HN(p,t,C).then(function(k){U||T||(T=!0,s(k))},function(k){U||T||(U=!0,m[I]=k,--v||l(new n(m,_C)))})}),--v||l(new n(m,_C))});return h.error&&l(h.value),r.promise}});var KN=dn,YN=me,XN=js,gC=Oo,np=zn,ip=Au,xg=Q.Promise,EC=!1;KN({target:"Promise",stat:!0,forced:!xg||!xg.try||ip(function(){xg.try(function(e){EC=e===8},8)}).error||!EC},{try:function(e){var t=arguments.length>1?XN(arguments,1):[],n=gC.f(this),r=ip(function(){return YN(np(e),void 0,t)});return(r.error?n.reject:n.resolve)(r.value),n.promise}});var rp=Oo;dn({target:"Promise",stat:!0},{withResolvers:function(){var e=rp.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var em=dn,Mg=cd,Ug=y,pS=Ti,fS=pe,jg=pg,mS=Lg,yC=Mg&&Mg.prototype;em({target:"Promise",proto:!0,real:!0,forced:!!Mg&&Ug(function(){yC.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=jg(this,pS("Promise")),n=fS(e);return this.then(n?function(r){return mS(t,e()).then(function(){return r})}:e,n?function(r){return mS(t,e()).then(function(){throw r})}:e)}});var _S=G,vC=b,tm=Fr,JN=yt,QN=_S("".charAt),SC=_S("".charCodeAt),Vg=_S("".slice),nm=function(e){return function(t,n){var r,s,l=tm(JN(t)),h=vC(n),p=l.length;return h<0||h>=p?e?"":void 0:(r=SC(l,h))<55296||r>56319||h+1===p||(s=SC(l,h+1))<56320||s>57343?e?QN(l,h):r:e?Vg(l,h,h+2):s-56320+(r-55296<<10)+65536}},im={codeAt:nm(!1),charAt:nm(!0)},$N=im.charAt,rm=Fr,TC=bo,RC=Lv,gS=jh,ES="String Iterator",bC=TC.set,yS=TC.getterFor(ES);RC(String,"String",function(e){bC(this,{type:ES,string:rm(e),index:0})},function(){var e,t=yS(this),n=t.string,r=t.index;return r>=n.length?gS(void 0,!0):(e=$N(n,r),t.index+=e.length,gS(e,!1))});var CC=ui.Promise,Fg={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},ZN=Q,eO=Co,Bg=Zl;for(var sm in Fg)eO(ZN[sm],sm),Bg[sm]=Bg.Array;var am=CC,Je=f(am),wC=ba("Array","values"),vS=Zc,pd=ki,fd=W,md=wC,Du=Array.prototype,om={DOMTokenList:!0,NodeList:!0},_d=function(e){var t=e.values;return e===Du||fd(Du,e)&&t===Du.values||pd(om,vS(e))?md:t},Fs=f(_d),SS=va,cm=TypeError,AC=js,IC=Math.floor,sp=function(e,t){var n=e.length;if(n<8)for(var r,s,l=1;l<n;){for(s=l,r=e[l];s&&t(e[s-1],r)>0;)e[s]=e[--s];s!==l++&&(e[s]=r)}else for(var h=IC(n/2),p=sp(AC(e,0,h),t),m=sp(AC(e,h),t),g=p.length,v=m.length,T=0,C=0;T<g||C<v;)e[T+C]=T<g&&C<v?t(p[T],m[C])<=0?p[T++]:m[C++]:T<g?p[T++]:m[C++];return e},TS=sp,NC=Me.match(/firefox\/(\d+)/i),Gg=!!NC&&+NC[1],Hg=/MSIE|Trident/.test(Me),RS=Me.match(/AppleWebKit\/(\d+)\./),lm=!!RS&&+RS[1],bS=dn,dm=G,OC=zn,tO=Sa,um=Cn,c=function(e,t){if(!delete e[t])throw new cm("Cannot delete property "+SS(t)+" of "+SS(e))},u=Fr,_=y,S=TS,A=iu,P=Gg,q=Hg,ie=cr,Se=lm,ke=[],Ze=dm(ke.sort),dt=dm(ke.push),Ge=_(function(){ke.sort(void 0)}),He=_(function(){ke.sort(null)}),hn=A("sort"),Xt=!_(function(){if(ie)return ie<70;if(!(P&&P>3)){if(q)return!0;if(Se)return Se<603;var e,t,n,r,s="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)ke.push({k:t+r,v:n})}for(ke.sort(function(l,h){return h.v-l.v}),r=0;r<ke.length;r++)t=ke[r].k.charAt(0),s.charAt(s.length-1)!==t&&(s+=t);return s!=="DGBEFHACIJK"}});bS({target:"Array",proto:!0,forced:Ge||!He||!hn||!Xt},{sort:function(e){e!==void 0&&OC(e);var t=tO(this);if(Xt)return e===void 0?Ze(t):Ze(t,e);var n,r,s=[],l=um(t);for(r=0;r<l;r++)r in t&&dt(s,t[r]);for(S(s,function(h){return function(p,m){return m===void 0?-1:p===void 0?1:h!==void 0?+h(p,m)||0:u(p)>u(m)?1:-1}}(e)),n=um(s),r=0;r<n;)t[r]=s[r++];for(;r<l;)c(t,r++);return t}});var Oi=ba("Array","sort"),De=W,be=Oi,xe=Array.prototype,ot=function(e){var t=e.sort;return e===xe||De(xe,e)&&t===xe.sort?be:t},Pt=f(ot),Fn=dn,Ht=G,sn=Pe,os=RangeError,ni=String.fromCharCode,dl=String.fromCodePoint,nO=Ht([].join);Fn({target:"String",stat:!0,forced:!!dl&&dl.length!==1},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,s=0;r>s;){if(t=+arguments[s++],sn(t,1114111)!==t)throw new os(t+" is not a valid code point");n[s]=t<65536?ni(t):ni(55296+((t-=65536)>>10),t%1024+56320)}return nO(n,"")}});var zW=y,WW=hi("iterator"),DC=!zW(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach(function(s,l){t.delete("b"),r+=l+s}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[WW]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||r!=="a1c3"||new URL("https://x",void 0).host!=="x"}),qW=Gr,iO=dn,U1=Q,rO=bu,KW=Ti,PC=je,ul=G,CS=Fe,j1=DC,V1=Gr,YW=Fi,XW=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:qW(e,r,t[r],n);return e},JW=Co,QW=sg,sO=bo,F1=lg,aO=pe,$W=ki,ZW=Ra,eq=Zc,tq=yr,B1=kn,Pa=Fr,nq=mu,G1=rt,H1=Rf,iq=Nh,LC=jh,zg=sa,rq=TS,sq=hi("iterator"),Wg="URLSearchParams",z1=Wg+"Iterator",W1=sO.set,gc=sO.getterFor(Wg),aq=sO.getterFor(z1),q1=rO("fetch"),kC=rO("Request"),wS=rO("Headers"),oO=kC&&kC.prototype,K1=wS&&wS.prototype,oq=U1.TypeError,cq=U1.encodeURIComponent,lq=String.fromCharCode,dq=KW("String","fromCodePoint"),uq=parseInt,xC=ul("".charAt),Y1=ul([].join),ap=ul([].push),X1=ul("".replace),hq=ul([].shift),J1=ul([].splice),Q1=ul("".split),$1=ul("".slice),pq=ul(/./.exec),fq=/\+/g,mq=/^[0-9a-f]+$/i,Z1=function(e,t){var n=$1(e,t,t+2);return pq(mq,n)?uq(n,16):NaN},_q=function(e){for(var t=0,n=128;n>0&&(e&n)!=0;n>>=1)t++;return t},gq=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},eM=function(e){for(var t=(e=X1(e,fq," ")).length,n="",r=0;r<t;){var s=xC(e,r);if(s==="%"){if(xC(e,r+1)==="%"||r+3>t){n+="%",r++;continue}var l=Z1(e,r+1);if(l!=l){n+=s,r++;continue}r+=2;var h=_q(l);if(h===0)s=lq(l);else{if(h===1||h>4){n+="",r++;continue}for(var p=[l],m=1;m<h&&!(++r+3>t||xC(e,r)!=="%");){var g=Z1(e,r+1);if(g!=g){r+=3;break}if(g>191||g<128)break;ap(p,g),r+=2,m++}if(p.length!==h){n+="";continue}var v=gq(p);v===null?n+="":s=dq(v)}}n+=s,r++}return n},Eq=/[!'()~]|%20/g,yq={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},vq=function(e){return yq[e]},tM=function(e){return X1(cq(e),Eq,vq)},cO=QW(function(e,t){W1(this,{type:z1,target:gc(e).entries,index:0,kind:t})},Wg,function(){var e=aq(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,LC(void 0,!0);var r=t[n];switch(e.kind){case"keys":return LC(r.key,!1);case"values":return LC(r.value,!1)}return LC([r.key,r.value],!1)},!0),nM=function(e){this.entries=[],this.url=null,e!==void 0&&(B1(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?xC(e,0)==="?"?$1(e,1):e:Pa(e)))};nM.prototype={type:Wg,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,s,l,h,p,m=this.entries,g=iq(e);if(g)for(n=(t=H1(e,g)).next;!(r=PC(n,t)).done;){if(l=(s=H1(tq(r.value))).next,(h=PC(l,s)).done||(p=PC(l,s)).done||!PC(l,s).done)throw new oq("Expected sequence with length 2");ap(m,{key:Pa(h.value),value:Pa(p.value)})}else for(var v in e)$W(e,v)&&ap(m,{key:v,value:Pa(e[v])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,s=Q1(e,"&"),l=0;l<s.length;)(t=s[l++]).length&&(n=Q1(t,"="),ap(r,{key:eM(hq(n)),value:eM(Y1(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],ap(n,tM(e.key)+"="+tM(e.value));return Y1(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var MC=function(){F1(this,qg);var e=W1(this,new nM(arguments.length>0?arguments[0]:void 0));CS||(this.size=e.entries.length)},qg=MC.prototype;if(XW(qg,{append:function(e,t){var n=gc(this);zg(arguments.length,2),ap(n.entries,{key:Pa(e),value:Pa(t)}),CS||this.length++,n.updateURL()},delete:function(e){for(var t=gc(this),n=zg(arguments.length,1),r=t.entries,s=Pa(e),l=n<2?void 0:arguments[1],h=l===void 0?l:Pa(l),p=0;p<r.length;){var m=r[p];if(m.key!==s||h!==void 0&&m.value!==h)p++;else if(J1(r,p,1),h!==void 0)break}CS||(this.size=r.length),t.updateURL()},get:function(e){var t=gc(this).entries;zg(arguments.length,1);for(var n=Pa(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=gc(this).entries;zg(arguments.length,1);for(var n=Pa(e),r=[],s=0;s<t.length;s++)t[s].key===n&&ap(r,t[s].value);return r},has:function(e){for(var t=gc(this).entries,n=zg(arguments.length,1),r=Pa(e),s=n<2?void 0:arguments[1],l=s===void 0?s:Pa(s),h=0;h<t.length;){var p=t[h++];if(p.key===r&&(l===void 0||p.value===l))return!0}return!1},set:function(e,t){var n=gc(this);zg(arguments.length,1);for(var r,s=n.entries,l=!1,h=Pa(e),p=Pa(t),m=0;m<s.length;m++)(r=s[m]).key===h&&(l?J1(s,m--,1):(l=!0,r.value=p));l||ap(s,{key:h,value:p}),CS||(this.size=s.length),n.updateURL()},sort:function(){var e=gc(this);rq(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=gc(this).entries,r=ZW(e,arguments.length>1?arguments[1]:void 0),s=0;s<n.length;)r((t=n[s++]).value,t.key,this)},keys:function(){return new cO(this,"keys")},values:function(){return new cO(this,"values")},entries:function(){return new cO(this,"entries")}},{enumerable:!0}),V1(qg,sq,qg.entries,{}),V1(qg,"toString",function(){return gc(this).serialize()},{enumerable:!0}),CS&&YW(qg,"size",{get:function(){return gc(this).entries.length},configurable:!0,enumerable:!0}),JW(MC,Wg),iO({global:!0,forced:!j1},{URLSearchParams:MC}),!j1&&aO(wS)){var Sq=ul(K1.has),Tq=ul(K1.set),iM=function(e){if(B1(e)){var t,n=e.body;if(eq(n)===Wg)return t=e.headers?new wS(e.headers):new wS,Sq(t,"content-type")||Tq(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),nq(e,{body:G1(0,Pa(n)),headers:G1(0,t)})}return e};if(aO(q1)&&iO({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return q1(e,arguments.length>1?iM(arguments[1]):{})}}),aO(kC)){var lO=function(e){return F1(this,oO),new kC(e,arguments.length>1?iM(arguments[1]):{})};oO.constructor=lO,lO.prototype=oO,iO({global:!0,dontCallGetSet:!0,forced:!0},{Request:lO})}}var Ec,Rq={URLSearchParams:MC,getState:gc},bq=ui.URLSearchParams,rM=Fe,Cq=G,wq=je,Aq=y,dO=wh,Iq=du,Nq=nt,Oq=Sa,Dq=Bt,Kg=Object.assign,sM=Object.defineProperty,Pq=Cq([].concat),Lq=!Kg||Aq(function(){if(rM&&Kg({b:1},Kg(sM({},"a",{enumerable:!0,get:function(){sM(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(s){t[s]=s}),Kg({},e)[n]!==7||dO(Kg({},t)).join("")!==r})?function(e,t){for(var n=Oq(e),r=arguments.length,s=1,l=Iq.f,h=Nq.f;r>s;)for(var p,m=Dq(arguments[s++]),g=l?Pq(dO(m),l(m)):dO(m),v=g.length,T=0;v>T;)p=g[T++],rM&&!wq(h,m,p)||(n[p]=m[p]);return n}:Kg,kq=yr,xq=uv,Mq=Fe,Uq=ts,jq=rt,uO=function(e,t,n){Mq?Uq.f(e,t,jq(0,n)):e[t]=n},Vq=Ra,Fq=je,Bq=Sa,Gq=function(e,t,n,r){try{return r?t(kq(n)[0],n[1]):t(n)}catch(s){xq(e,"throw",s)}},Hq=ob,zq=Ff,Wq=Cn,aM=uO,qq=Rf,Kq=Nh,oM=Array,hm=G,hO=2147483647,Yq=/[^\0-\u007E]/,cM=/[.\u3002\uFF0E\uFF61]/g,lM="Overflow: input needs wider integers to process",dM=RangeError,Xq=hm(cM.exec),Yg=Math.floor,pO=String.fromCharCode,uM=hm("".charCodeAt),hM=hm([].join),op=hm([].push),Jq=hm("".replace),Qq=hm("".split),$q=hm("".toLowerCase),pM=function(e){return e+22+75*(e<26)},Zq=function(e,t,n){var r=0;for(e=n?Yg(e/700):e>>1,e+=Yg(e/t);e>455;)e=Yg(e/35),r+=36;return Yg(r+36*e/(e+38))},eK=function(e){var t=[];e=function(F){for(var B=[],ee=0,ue=F.length;ee<ue;){var de=uM(F,ee++);if(de>=55296&&de<=56319&&ee<ue){var ae=uM(F,ee++);(64512&ae)==56320?op(B,((1023&de)<<10)+(1023&ae)+65536):(op(B,de),ee--)}else op(B,de)}return B}(e);var n,r,s=e.length,l=128,h=0,p=72;for(n=0;n<e.length;n++)(r=e[n])<128&&op(t,pO(r));var m=t.length,g=m;for(m&&op(t,"-");g<s;){var v=hO;for(n=0;n<e.length;n++)(r=e[n])>=l&&r<v&&(v=r);var T=g+1;if(v-l>Yg((hO-h)/T))throw new dM(lM);for(h+=(v-l)*T,l=v,n=0;n<e.length;n++){if((r=e[n])<l&&++h>hO)throw new dM(lM);if(r===l){for(var C=h,I=36;;){var U=I<=p?1:I>=p+26?26:I-p;if(C<U)break;var k=C-U,M=36-U;op(t,pO(pM(U+k%M))),C=Yg(k/M),I+=36}op(t,pO(pM(C))),p=Zq(h,T,g===m),h=0,g++}}h++,l++}return hM(t,"")},tK=dn,fO=Fe,nK=DC,mO=Q,fM=Ra,yc=G,UC=Gr,vc=Fi,iK=lg,_O=ki,gO=Lq,Xg=function(e){var t=Bq(e),n=zq(this),r=arguments.length,s=r>1?arguments[1]:void 0,l=s!==void 0;l&&(s=Vq(s,r>2?arguments[2]:void 0));var h,p,m,g,v,T,C=Kq(t),I=0;if(!C||this===oM&&Hq(C))for(h=Wq(t),p=n?new this(h):oM(h);h>I;I++)T=l?s(t[I],I):t[I],aM(p,I,T);else for(p=n?new this:[],v=(g=qq(t,C)).next;!(m=Fq(v,g)).done;I++)T=l?Gq(g,s,[m.value,I],!0):m.value,aM(p,I,T);return p.length=I,p},hl=js,rK=im.codeAt,sK=function(e){var t,n,r=[],s=Qq(Jq($q(e),cM,"."),".");for(t=0;t<s.length;t++)n=s[t],op(r,Xq(Yq,n)?"xn--"+eK(n):n);return hM(r,".")},Pu=Fr,aK=Co,oK=sa,mM=Rq,_M=bo,cK=_M.set,jC=_M.getterFor("URL"),lK=mM.URLSearchParams,dK=mM.getState,AS=mO.URL,EO=mO.TypeError,VC=mO.parseInt,uK=Math.floor,gM=Math.pow,Sc=yc("".charAt),pl=yc(/./.exec),IS=yc([].join),hK=yc(1 .toString),pK=yc([].pop),Jg=yc([].push),yO=yc("".replace),fK=yc([].shift),mK=yc("".split),NS=yc("".slice),FC=yc("".toLowerCase),_K=yc([].unshift),vO="Invalid scheme",pm="Invalid host",EM="Invalid port",yM=/[a-z]/i,gK=/[\d+-.a-z]/i,SO=/\d/,EK=/^0x/i,yK=/^[0-7]+$/,vK=/^\d+$/,vM=/^[\da-f]+$/i,SK=/[\0\t\n\r #%/:<>?@[\\\]^|]/,TK=/[\0\t\n\r #/:<>?@[\\\]^|]/,RK=/^[\u0000-\u0020]+/,bK=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,CK=/[\t\n\r]/g,OS=function(e){var t,n,r,s;if(typeof e=="number"){for(t=[],n=0;n<4;n++)_K(t,e%256),e=uK(e/256);return IS(t,".")}if(typeof e=="object"){for(t="",r=function(l){for(var h=null,p=1,m=null,g=0,v=0;v<8;v++)l[v]!==0?(g>p&&(h=m,p=g),m=null,g=0):(m===null&&(m=v),++g);return g>p?m:h}(e),n=0;n<8;n++)s&&e[n]===0||(s&&(s=!1),r===n?(t+=n?":":"::",s=!0):(t+=hK(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},BC={},SM=gO({},BC,{" ":1,'"':1,"<":1,">":1,"`":1}),TM=gO({},SM,{"#":1,"?":1,"{":1,"}":1}),TO=gO({},TM,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),cp=function(e,t){var n=rK(e,0);return n>32&&n<127&&!_O(t,e)?e:encodeURIComponent(e)},GC={ftp:21,file:null,http:80,https:443,ws:80,wss:443},DS=function(e,t){var n;return e.length===2&&pl(yM,Sc(e,0))&&((n=Sc(e,1))===":"||!t&&n==="|")},RM=function(e){var t;return e.length>1&&DS(NS(e,0,2))&&(e.length===2||(t=Sc(e,2))==="/"||t==="\\"||t==="?"||t==="#")},wK=function(e){return e==="."||FC(e)==="%2e"},RO={},bM={},bO={},CM={},wM={},CO={},AM={},IM={},HC={},zC={},wO={},AO={},IO={},NO={},NM={},OO={},Qg={},gd={},OM={},fm={},Lu={},DO=function(e,t,n){var r,s,l,h=Pu(e);if(t){if(s=this.parse(h))throw new EO(s);this.searchParams=null}else{if(n!==void 0&&(r=new DO(n,!0)),s=this.parse(h,null,r))throw new EO(s);(l=dK(new lK)).bindURL(this),this.searchParams=l}};DO.prototype={type:"URL",parse:function(e,t,n){var r,s,l,h,p,m=this,g=t||RO,v=0,T="",C=!1,I=!1,U=!1;for(e=Pu(e),t||(m.scheme="",m.username="",m.password="",m.host=null,m.port=null,m.path=[],m.query=null,m.fragment=null,m.cannotBeABaseURL=!1,e=yO(e,RK,""),e=yO(e,bK,"$1")),e=yO(e,CK,""),r=Xg(e);v<=r.length;){switch(s=r[v],g){case RO:if(!s||!pl(yM,s)){if(t)return vO;g=bO;continue}T+=FC(s),g=bM;break;case bM:if(s&&(pl(gK,s)||s==="+"||s==="-"||s==="."))T+=FC(s);else{if(s!==":"){if(t)return vO;T="",g=bO,v=0;continue}if(t&&(m.isSpecial()!==_O(GC,T)||T==="file"&&(m.includesCredentials()||m.port!==null)||m.scheme==="file"&&!m.host))return;if(m.scheme=T,t)return void(m.isSpecial()&&GC[m.scheme]===m.port&&(m.port=null));T="",m.scheme==="file"?g=NO:m.isSpecial()&&n&&n.scheme===m.scheme?g=CM:m.isSpecial()?g=IM:r[v+1]==="/"?(g=wM,v++):(m.cannotBeABaseURL=!0,Jg(m.path,""),g=OM)}break;case bO:if(!n||n.cannotBeABaseURL&&s!=="#")return vO;if(n.cannotBeABaseURL&&s==="#"){m.scheme=n.scheme,m.path=hl(n.path),m.query=n.query,m.fragment="",m.cannotBeABaseURL=!0,g=Lu;break}g=n.scheme==="file"?NO:CO;continue;case CM:if(s!=="/"||r[v+1]!=="/"){g=CO;continue}g=HC,v++;break;case wM:if(s==="/"){g=zC;break}g=gd;continue;case CO:if(m.scheme=n.scheme,s===Ec)m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=hl(n.path),m.query=n.query;else if(s==="/"||s==="\\"&&m.isSpecial())g=AM;else if(s==="?")m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=hl(n.path),m.query="",g=fm;else{if(s!=="#"){m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=hl(n.path),m.path.length--,g=gd;continue}m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=hl(n.path),m.query=n.query,m.fragment="",g=Lu}break;case AM:if(!m.isSpecial()||s!=="/"&&s!=="\\"){if(s!=="/"){m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,g=gd;continue}g=zC}else g=HC;break;case IM:if(g=HC,s!=="/"||Sc(T,v+1)!=="/")continue;v++;break;case HC:if(s!=="/"&&s!=="\\"){g=zC;continue}break;case zC:if(s==="@"){C&&(T="%40"+T),C=!0,l=Xg(T);for(var k=0;k<l.length;k++){var M=l[k];if(M!==":"||U){var F=cp(M,TO);U?m.password+=F:m.username+=F}else U=!0}T=""}else if(s===Ec||s==="/"||s==="?"||s==="#"||s==="\\"&&m.isSpecial()){if(C&&T==="")return"Invalid authority";v-=Xg(T).length+1,T="",g=wO}else T+=s;break;case wO:case AO:if(t&&m.scheme==="file"){g=OO;continue}if(s!==":"||I){if(s===Ec||s==="/"||s==="?"||s==="#"||s==="\\"&&m.isSpecial()){if(m.isSpecial()&&T==="")return pm;if(t&&T===""&&(m.includesCredentials()||m.port!==null))return;if(h=m.parseHost(T))return h;if(T="",g=Qg,t)return;continue}s==="["?I=!0:s==="]"&&(I=!1),T+=s}else{if(T==="")return pm;if(h=m.parseHost(T))return h;if(T="",g=IO,t===AO)return}break;case IO:if(!pl(SO,s)){if(s===Ec||s==="/"||s==="?"||s==="#"||s==="\\"&&m.isSpecial()||t){if(T!==""){var B=VC(T,10);if(B>65535)return EM;m.port=m.isSpecial()&&B===GC[m.scheme]?null:B,T=""}if(t)return;g=Qg;continue}return EM}T+=s;break;case NO:if(m.scheme="file",s==="/"||s==="\\")g=NM;else{if(!n||n.scheme!=="file"){g=gd;continue}switch(s){case Ec:m.host=n.host,m.path=hl(n.path),m.query=n.query;break;case"?":m.host=n.host,m.path=hl(n.path),m.query="",g=fm;break;case"#":m.host=n.host,m.path=hl(n.path),m.query=n.query,m.fragment="",g=Lu;break;default:RM(IS(hl(r,v),""))||(m.host=n.host,m.path=hl(n.path),m.shortenPath()),g=gd;continue}}break;case NM:if(s==="/"||s==="\\"){g=OO;break}n&&n.scheme==="file"&&!RM(IS(hl(r,v),""))&&(DS(n.path[0],!0)?Jg(m.path,n.path[0]):m.host=n.host),g=gd;continue;case OO:if(s===Ec||s==="/"||s==="\\"||s==="?"||s==="#"){if(!t&&DS(T))g=gd;else if(T===""){if(m.host="",t)return;g=Qg}else{if(h=m.parseHost(T))return h;if(m.host==="localhost"&&(m.host=""),t)return;T="",g=Qg}continue}T+=s;break;case Qg:if(m.isSpecial()){if(g=gd,s!=="/"&&s!=="\\")continue}else if(t||s!=="?")if(t||s!=="#"){if(s!==Ec&&(g=gd,s!=="/"))continue}else m.fragment="",g=Lu;else m.query="",g=fm;break;case gd:if(s===Ec||s==="/"||s==="\\"&&m.isSpecial()||!t&&(s==="?"||s==="#")){if((p=FC(p=T))===".."||p==="%2e."||p===".%2e"||p==="%2e%2e"?(m.shortenPath(),s==="/"||s==="\\"&&m.isSpecial()||Jg(m.path,"")):wK(T)?s==="/"||s==="\\"&&m.isSpecial()||Jg(m.path,""):(m.scheme==="file"&&!m.path.length&&DS(T)&&(m.host&&(m.host=""),T=Sc(T,0)+":"),Jg(m.path,T)),T="",m.scheme==="file"&&(s===Ec||s==="?"||s==="#"))for(;m.path.length>1&&m.path[0]==="";)fK(m.path);s==="?"?(m.query="",g=fm):s==="#"&&(m.fragment="",g=Lu)}else T+=cp(s,TM);break;case OM:s==="?"?(m.query="",g=fm):s==="#"?(m.fragment="",g=Lu):s!==Ec&&(m.path[0]+=cp(s,BC));break;case fm:t||s!=="#"?s!==Ec&&(s==="'"&&m.isSpecial()?m.query+="%27":m.query+=s==="#"?"%23":cp(s,BC)):(m.fragment="",g=Lu);break;case Lu:s!==Ec&&(m.fragment+=cp(s,SM))}v++}},parseHost:function(e){var t,n,r;if(Sc(e,0)==="["){if(Sc(e,e.length-1)!=="]"||(t=function(s){var l,h,p,m,g,v,T,C=[0,0,0,0,0,0,0,0],I=0,U=null,k=0,M=function(){return Sc(s,k)};if(M()===":"){if(Sc(s,1)!==":")return;k+=2,U=++I}for(;M();){if(I===8)return;if(M()!==":"){for(l=h=0;h<4&&pl(vM,M());)l=16*l+VC(M(),16),k++,h++;if(M()==="."){if(h===0||(k-=h,I>6))return;for(p=0;M();){if(m=null,p>0){if(!(M()==="."&&p<4))return;k++}if(!pl(SO,M()))return;for(;pl(SO,M());){if(g=VC(M(),10),m===null)m=g;else{if(m===0)return;m=10*m+g}if(m>255)return;k++}C[I]=256*C[I]+m,++p!=2&&p!==4||I++}if(p!==4)return;break}if(M()===":"){if(k++,!M())return}else if(M())return;C[I++]=l}else{if(U!==null)return;k++,U=++I}}if(U!==null)for(v=I-U,I=7;I!==0&&v>0;)T=C[I],C[I--]=C[U+v-1],C[U+--v]=T;else if(I!==8)return;return C}(NS(e,1,-1)),!t))return pm;this.host=t}else if(this.isSpecial()){if(e=sK(e),pl(SK,e)||(t=function(s){var l,h,p,m,g,v,T,C=mK(s,".");if(C.length&&C[C.length-1]===""&&C.length--,(l=C.length)>4)return s;for(h=[],p=0;p<l;p++){if((m=C[p])==="")return s;if(g=10,m.length>1&&Sc(m,0)==="0"&&(g=pl(EK,m)?16:8,m=NS(m,g===8?1:2)),m==="")v=0;else{if(!pl(g===10?vK:g===8?yK:vM,m))return s;v=VC(m,g)}Jg(h,v)}for(p=0;p<l;p++)if(v=h[p],p===l-1){if(v>=gM(256,5-l))return null}else if(v>255)return null;for(T=pK(h),p=0;p<h.length;p++)T+=h[p]*gM(256,3-p);return T}(e),t===null))return pm;this.host=t}else{if(pl(TK,e))return pm;for(t="",n=Xg(e),r=0;r<n.length;r++)t+=cp(n[r],BC);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return _O(GC,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&DS(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,s=e.host,l=e.port,h=e.path,p=e.query,m=e.fragment,g=t+":";return s!==null?(g+="//",e.includesCredentials()&&(g+=n+(r?":"+r:"")+"@"),g+=OS(s),l!==null&&(g+=":"+l)):t==="file"&&(g+="//"),g+=e.cannotBeABaseURL?h[0]:h.length?"/"+IS(h,"/"):"",p!==null&&(g+="?"+p),m!==null&&(g+="#"+m),g},setHref:function(e){var t=this.parse(e);if(t)throw new EO(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new $g(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+OS(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Pu(e)+":",RO)},getUsername:function(){return this.username},setUsername:function(e){var t=Xg(Pu(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=cp(t[n],TO)}},getPassword:function(){return this.password},setPassword:function(e){var t=Xg(Pu(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=cp(t[n],TO)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?OS(e):OS(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,wO)},getHostname:function(){var e=this.host;return e===null?"":OS(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,AO)},getPort:function(){var e=this.port;return e===null?"":Pu(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Pu(e))===""?this.port=null:this.parse(e,IO))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+IS(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Qg))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Pu(e))===""?this.query=null:(Sc(e,0)==="?"&&(e=NS(e,1)),this.query="",this.parse(e,fm)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Pu(e))!==""?(Sc(e,0)==="#"&&(e=NS(e,1)),this.fragment="",this.parse(e,Lu)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var $g=function(e){var t=iK(this,La),n=oK(arguments.length,1)>1?arguments[1]:void 0,r=cK(t,new DO(e,!1,n));fO||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},La=$g.prototype,Tc=function(e,t){return{get:function(){return jC(this)[e]()},set:t&&function(n){return jC(this)[t](n)},configurable:!0,enumerable:!0}};if(fO&&(vc(La,"href",Tc("serialize","setHref")),vc(La,"origin",Tc("getOrigin")),vc(La,"protocol",Tc("getProtocol","setProtocol")),vc(La,"username",Tc("getUsername","setUsername")),vc(La,"password",Tc("getPassword","setPassword")),vc(La,"host",Tc("getHost","setHost")),vc(La,"hostname",Tc("getHostname","setHostname")),vc(La,"port",Tc("getPort","setPort")),vc(La,"pathname",Tc("getPathname","setPathname")),vc(La,"search",Tc("getSearch","setSearch")),vc(La,"searchParams",Tc("getSearchParams")),vc(La,"hash",Tc("getHash","setHash"))),UC(La,"toJSON",function(){return jC(this).serialize()},{enumerable:!0}),UC(La,"toString",function(){return jC(this).serialize()},{enumerable:!0}),AS){var DM=AS.createObjectURL,PM=AS.revokeObjectURL;DM&&UC($g,"createObjectURL",fM(DM,AS)),PM&&UC($g,"revokeObjectURL",fM(PM,AS))}aK($g,"URL"),tK({global:!0,forced:!nK,sham:!fO},{URL:$g});var AK=dn,LM=y,IK=sa,kM=Fr,NK=DC,PO=Ti("URL"),OK=NK&&LM(function(){PO.canParse()}),DK=LM(function(){return PO.canParse.length!==1});AK({target:"URL",stat:!0,forced:!OK||DK},{canParse:function(e){var t=IK(arguments.length,1),n=kM(e),r=t<2||arguments[1]===void 0?void 0:kM(arguments[1]);try{return!!new PO(n,r)}catch{return!1}}});var PK=dn,LK=sa,xM=Fr,kK=DC,xK=Ti("URL");PK({target:"URL",stat:!0,forced:!kK},{parse:function(e){var t=LK(arguments.length,1),n=xM(e),r=t<2||arguments[1]===void 0?void 0:xM(arguments[1]);try{return new xK(n,r)}catch{return null}}});var WC=f(ui.URL);let MM=!0,UM=!0;function qC(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function mm(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(h,p){if(h!==t)return s.apply(this,arguments);const m=g=>{const v=n(g);v&&(p.handleEvent?p.handleEvent(v):p(v))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(p,m),s.apply(this,[h,m])};const l=r.removeEventListener;r.removeEventListener=function(h,p){if(h!==t||!this._eventMap||!this._eventMap[t])return l.apply(this,arguments);if(!this._eventMap[t].has(p))return l.apply(this,arguments);const m=this._eventMap[t].get(p);return this._eventMap[t].delete(p),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[h,m])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(h){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),h&&this.addEventListener(t,this["_on"+t]=h)},enumerable:!0,configurable:!0})}function MK(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(MM=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function UK(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(UM=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function jM(){if(typeof window=="object"){if(MM)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function LO(e,t){UM&&console.warn(e+" is deprecated, please use "+t+" instead.")}function VM(e){return Object.prototype.toString.call(e)==="[object Object]"}function FM(e){var t;return VM(e)?na(t=Object.keys(e)).call(t,function(n,r){const s=VM(e[r]),l=s?FM(e[r]):e[r],h=s&&!Object.keys(l).length;return l===void 0||h?n:Object.assign(n,{[r]:l})},{}):e}function kO(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?kO(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(s=>{kO(e,e.get(s),n)})}))}function BM(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",s=new Map;if(t===null)return s;const l=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===t.id&&l.push(h)}),l.forEach(h=>{e.forEach(p=>{p.type===r&&p.trackId===h.id&&kO(e,p,s)})}),s}const GM=jM;function HM(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const p={};return Object.keys(h).forEach(m=>{if(m==="require"||m==="advanced"||m==="mediaSource")return;const g=typeof h[m]=="object"?h[m]:{ideal:h[m]};g.exact!==void 0&&typeof g.exact=="number"&&(g.min=g.max=g.exact);const v=function(T,C){return T?T+C.charAt(0).toUpperCase()+C.slice(1):C==="deviceId"?"sourceId":C};if(g.ideal!==void 0){p.optional=p.optional||[];let T={};typeof g.ideal=="number"?(T[v("min",m)]=g.ideal,p.optional.push(T),T={},T[v("max",m)]=g.ideal,p.optional.push(T)):(T[v("",m)]=g.ideal,p.optional.push(T))}g.exact!==void 0&&typeof g.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[v("",m)]=g.exact):["min","max"].forEach(T=>{g[T]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[v(T,m)]=g[T])})}),h.advanced&&(p.optional=(p.optional||[]).concat(h.advanced)),p},s=function(h,p){if(t.version>=61)return p(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const m=function(g,v,T){v in g&&!(T in g)&&(g[T]=g[v],delete g[v])};m((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),m(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=r(h.audio)}if(h&&typeof h.video=="object"){let m=h.video.facingMode;m=m&&(typeof m=="object"?m:{ideal:m});const g=t.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||g)){let v;if(delete h.video.facingMode,m.exact==="environment"||m.ideal==="environment"?v=["back","rear"]:m.exact!=="user"&&m.ideal!=="user"||(v=["front"]),v)return n.mediaDevices.enumerateDevices().then(T=>{let C=(T=T.filter(I=>I.kind==="videoinput")).find(I=>v.some(U=>{var k;return Ye(k=I.label.toLowerCase()).call(k,U)}));return!C&&T.length&&Ye(v).call(v,"back")&&(C=T[T.length-1]),C&&(h.video.deviceId=m.exact?{exact:C.deviceId}:{ideal:C.deviceId}),h.video=r(h.video),GM("chrome: "+JSON.stringify(h)),p(h)})}h.video=r(h.video)}return GM("chrome: "+JSON.stringify(h)),p(h)},l=function(h){return t.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(h,p,m){s(h,g=>{n.webkitGetUserMedia(g,p,v=>{m&&m(l(v))})})}).bind(n),n.mediaDevices.getUserMedia){const h=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(p){return s(p,m=>h(m).then(g=>{if(m.audio&&!g.getAudioTracks().length||m.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return g},g=>Je.reject(l(g))))}}}function zM(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function WM(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===r.track.id):{track:r.track};const l=new Event("track");l.track=r.track,l.receiver=s,l.transceiver={receiver:s},l.streams=[n.stream],this.dispatchEvent(l)}),n.stream.getTracks().forEach(r=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===r.id):{track:r};const l=new Event("track");l.track=r,l.receiver=s,l.transceiver={receiver:s},l.streams=[n.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else mm(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function qM(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(s,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=s.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:s}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,p){let m=s.apply(this,arguments);return m||(m=t(this,h),this._senders.push(m)),m};const l=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){l.apply(this,arguments);const p=this._senders.indexOf(h);p!==-1&&this._senders.splice(p,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(l=>{this._senders.push(t(this,l))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(l=>{const h=this._senders.find(p=>p.track===l);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function KM(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,r,s]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const l=function(p){const m={};return p.result().forEach(g=>{const v={id:g.id,timestamp:g.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||g.type};g.names().forEach(T=>{v[T]=g.stat(T)}),m[v.id]=v}),m},h=function(p){return new Map(Object.keys(p).map(m=>[m,p[m]]))};if(arguments.length>=2){const p=function(m){r(h(l(m)))};return t.apply(this,[p,n])}return new Je((p,m)=>{t.apply(this,[function(g){p(h(l(g)))},m])}).then(r,s)}}function YM(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(l=>l._pc=this),s});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(l=>BM(l,s.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),mm(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>BM(s,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let r,s,l;return this.getSenders().forEach(h=>{h.track===n&&(r?l=!0:r=h)}),this.getReceivers().forEach(h=>(h.track===n&&(s?l=!0:s=h),h.track===n)),l||r&&s?Je.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Je.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function XM(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,h){if(!h)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=t.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(p)===-1&&this._shimmedLocalStreams[h.id].push(p):this._shimmedLocalStreams[h.id]=[h,p],p};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(m=>{if(this.getSenders().find(v=>v.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();n.apply(this,arguments);const p=this.getSenders().filter(m=>h.indexOf(m)===-1);this._shimmedLocalStreams[l.id]=[l].concat(p)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],r.apply(this,arguments)};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const p=this._shimmedLocalStreams[h].indexOf(l);p!==-1&&this._shimmedLocalStreams[h].splice(p,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),s.apply(this,arguments)}}function JM(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return XM(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const m=n.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(g=>this._reverseStreams[g.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(g=>{if(this.getSenders().find(T=>T.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const g=new e.MediaStream(m.getTracks());this._streams[m.id]=g,this._reverseStreams[g.id]=m,m=g}r.apply(this,[m])};const s=e.RTCPeerConnection.prototype.removeStream;function l(m,g){let v=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(T=>{const C=m._reverseStreams[T],I=m._streams[C.id];v=v.replace(new RegExp(I.id,"g"),C.id)}),new RTCSessionDescription({type:g.type,sdp:v})}e.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},e.RTCPeerConnection.prototype.addTrack=function(m,g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const v=[].slice.call(arguments,1);if(v.length!==1||!v[0].getTracks().find(I=>I===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(I=>I.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const C=this._streams[g.id];if(C)C.addTrack(m),Je.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const I=new e.MediaStream([m]);this._streams[g.id]=I,this._reverseStreams[I.id]=g,this.addStream(I)}return this.getSenders().find(I=>I.track===m)},["createOffer","createAnswer"].forEach(function(m){const g=e.RTCPeerConnection.prototype[m],v={[m](){const T=arguments;return arguments.length&&typeof arguments[0]=="function"?g.apply(this,[C=>{const I=l(this,C);T[0].apply(null,[I])},C=>{T[1]&&T[1].apply(null,C)},arguments[2]]):g.apply(this,arguments).then(C=>l(this,C))}};e.RTCPeerConnection.prototype[m]=v[m]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,g){let v=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(T=>{const C=m._reverseStreams[T],I=m._streams[C.id];v=v.replace(new RegExp(C.id,"g"),I.id)}),new RTCSessionDescription({type:g.type,sdp:v})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const p=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const m=p.get.apply(this);return m.type===""?m:l(this,m)}}),e.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let g;this._streams=this._streams||{},Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(T=>m.track===T)&&(g=this._streams[v])}),g&&(g.getTracks().length===1?this.removeStream(this._reverseStreams[g.id]):g.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function xO(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=s[n]})}function QM(e,t){mm(e,"negotiationneeded",n=>{const r=n.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var $M=Object.freeze({__proto__:null,fixNegotiationNeeded:QM,shimAddTrackRemoveTrack:JM,shimAddTrackRemoveTrackWithNative:XM,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(r=>{const s=n.video&&n.video.width,l=n.video&&n.video.height,h=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:h||3}},s&&(n.video.mandatory.maxWidth=s),l&&(n.video.mandatory.maxHeight=l),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:qM,shimGetStats:KM,shimGetUserMedia:HM,shimMediaStream:zM,shimOnTrack:WM,shimPeerConnection:xO,shimSenderReceiverGetStats:YM});function ZM(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(s,l,h){LO("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(l,h)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])},l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),s(h.audio,"autoGainControl","mozAutoGainControl"),s(h.audio,"noiseSuppression","mozNoiseSuppression")),l(h)},r&&r.prototype.getSettings){const h=r.prototype.getSettings;r.prototype.getSettings=function(){const p=h.apply(this,arguments);return s(p,"mozAutoGainControl","autoGainControl"),s(p,"mozNoiseSuppression","noiseSuppression"),p}}if(r&&r.prototype.applyConstraints){const h=r.prototype.applyConstraints;r.prototype.applyConstraints=function(p){return this.kind==="audio"&&typeof p=="object"&&(p=JSON.parse(JSON.stringify(p)),s(p,"autoGainControl","mozAutoGainControl"),s(p,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[p])}}}}function e2(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function MO(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const l=e.RTCPeerConnection.prototype[s],h={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=h[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[s,l,h]=arguments;return r.apply(this,[s||null]).then(p=>{if(t.version<53&&!l)try{p.forEach(m=>{m.type=n[m.type]||m.type})}catch(m){if(m.name!=="TypeError")throw m;p.forEach((g,v)=>{p.set(v,Object.assign({},g,{type:n[g.type]||g.type}))})}return p}).then(l,h)}}function t2(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(s=>s._pc=this),r});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Je.resolve(new Map)}}function n2(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n}),mm(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function i2(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){LO("removeStream","removeTrack"),this.getSenders().forEach(n=>{var r;n.track&&Ye(r=t.getTracks()).call(r,n.track)&&this.removeTrack(n)})})}function r2(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function s2(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=t.apply(this,arguments);if(r){const{sender:l}=s,h=l.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=n,l.sendEncodings=n,this.setParametersPromises.push(l.setParameters(h).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return s})}function a2(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function o2(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Je.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function c2(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Je.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var l2=Object.freeze({__proto__:null,shimAddTransceiver:s2,shimCreateAnswer:c2,shimCreateOffer:o2,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Je.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:a2,shimGetUserMedia:ZM,shimOnTrack:e2,shimPeerConnection:MO,shimRTCDataChannel:r2,shimReceiverGetStats:n2,shimRemoveStream:i2,shimSenderGetStats:t2});function d2(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var r;this._localStreams||(this._localStreams=[]),Ye(r=this._localStreams).call(r,n)||this._localStreams.push(n),n.getAudioTracks().forEach(s=>t.call(this,s,n)),n.getVideoTracks().forEach(s=>t.call(this,s,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),l=1;l<r;l++)s[l-1]=arguments[l];return s&&s.forEach(h=>{var p;this._localStreams?Ye(p=this._localStreams).call(p,h)||this._localStreams.push(h):this._localStreams=[h]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const r=t.getTracks();this.getSenders().forEach(s=>{Ye(r).call(r,s.track)&&this.removeTrack(s)})})}}function u2(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{var l;if(this._remoteStreams||(this._remoteStreams=[]),Ye(l=this._remoteStreams).call(l,s))return;this._remoteStreams.push(s);const h=new Event("addstream");h.stream=s,this.dispatchEvent(h)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(s)>=0)return;n._remoteStreams.push(s);const l=new Event("addstream");l.stream=s,n.dispatchEvent(l)})}),t.apply(n,arguments)}}}function h2(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,s=t.setLocalDescription,l=t.setRemoteDescription,h=t.addIceCandidate;t.createOffer=function(m,g){const v=arguments.length>=2?arguments[2]:arguments[0],T=n.apply(this,[v]);return g?(T.then(m,g),Je.resolve()):T},t.createAnswer=function(m,g){const v=arguments.length>=2?arguments[2]:arguments[0],T=r.apply(this,[v]);return g?(T.then(m,g),Je.resolve()):T};let p=function(m,g,v){const T=s.apply(this,[m]);return v?(T.then(g,v),Je.resolve()):T};t.setLocalDescription=p,p=function(m,g,v){const T=l.apply(this,[m]);return v?(T.then(g,v),Je.resolve()):T},t.setRemoteDescription=p,p=function(m,g,v){const T=h.apply(this,[m]);return v?(T.then(g,v),Je.resolve()):T},t.addIceCandidate=p}function p2(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=s=>r(f2(s))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,r,s){t.mediaDevices.getUserMedia(n).then(r,s)}).bind(t))}function f2(e){return e&&e.video!==void 0?Object.assign({},e,{video:FM(e.video)}):e}function m2(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const s=[];for(let l=0;l<n.iceServers.length;l++){let h=n.iceServers[l];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(LO("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,s.push(h)):s.push(n.iceServers[l])}n.iceServers=s}return new t(n,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function _2(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function g2(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(l=>l.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const s=this.getTransceivers().find(l=>l.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):n.offerToReceiveVideo!==!0||s||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function E2(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var y2=Object.freeze({__proto__:null,shimAudioContext:E2,shimCallbacksAPI:h2,shimConstraints:f2,shimCreateOfferLegacy:g2,shimGetUserMedia:p2,shimLocalStreamsAPI:d2,shimRTCIceServerUrls:m2,shimRemoteStreamsAPI:u2,shimTrackEventTransceiver:_2}),v2=`	
\v\f\r \u2028\u2029\uFEFF`,jK=yt,VK=Fr,UO=v2,S2=G("".replace),FK=RegExp("^["+UO+"]+"),BK=RegExp("(^|[^"+UO+"])["+UO+"]+$"),GK=function(e){return function(t){var n=VK(jK(t));return 1&e&&(n=S2(n,FK,"")),2&e&&(n=S2(n,BK,"$1")),n}},HK={trim:GK(3)},zK=yu.PROPER,WK=y,T2=v2,qK=HK.trim;dn({target:"String",proto:!0,forced:function(e){return WK(function(){return!!T2[e]()||""[e]()!==""||zK&&T2[e].name!==e})}("trim")},{trim:function(){return qK(this)}});var KK=ba("String","trim"),YK=W,XK=KK,jO=String.prototype,JK=function(e){var t=e.trim;return typeof e=="string"||e===jO||YK(jO,e)&&t===jO.trim?XK:t},_s=f(JK),R2={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(n){return n.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(s=>s.indexOf(r)===0)},t.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const s={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let l=8;l<r.length;l+=2)switch(r[l]){case"raddr":s.relatedAddress=r[l+1];break;case"rport":s.relatedPort=parseInt(r[l+1],10);break;case"tcptype":s.tcpType=r[l+1];break;case"ufrag":s.ufrag=r[l+1],s.usernameFragment=r[l+1];break;default:s[r[l]]===void 0&&(s[r[l]]=r[l+1])}return s},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const s=n.component;s==="rtp"?r.push(1):s==="rtcp"?r.push(2):r.push(s),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const l=n.type;return r.push("typ"),r.push(l),l!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" ");const s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},t.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const r={};let s;const l=n.substring(n.indexOf(" ")+1).split(";");for(let h=0;h<l.length;h++)s=l[h].trim().split("="),r[s[0].trim()]=s[1];return r},t.writeFmtp=function(n){let r="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const l=[];Object.keys(n.parameters).forEach(h=>{n.parameters[h]!==void 0?l.push(h+"="+n.parameters[h]):l.push(h)}),r+="a=fmtp:"+s+" "+l.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(l=>{r+="a=rtcp-fb:"+s+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,r),10)},l=n.indexOf(":",r);return l>-1?(s.attribute=n.substring(r+1,l),s.value=n.substring(l+1)):s.attribute=n.substring(r+1),s},t.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(s=>parseInt(s,10))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let s="a=setup:"+r+`\r
`;return n.fingerprints.forEach(l=>{s+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),s},t.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const s=t.matchPrefix(n+r,"a=ice-ufrag:")[0],l=t.matchPrefix(n+r,"a=ice-pwd:")[0];return s&&l?{usernameFragment:s.substring(12),password:l.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(n)[0].split(" ");r.profile=s[2];for(let h=3;h<s.length;h++){const p=s[h],m=t.matchPrefix(n,"a=rtpmap:"+p+" ")[0];if(m){const g=t.parseRtpMap(m),v=t.matchPrefix(n,"a=fmtp:"+p+" ");switch(g.parameters=v.length?t.parseFmtp(v[0]):{},g.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+p+" ").map(t.parseRtcpFb),r.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(g.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(h=>{r.headerExtensions.push(t.parseExtmap(h))});const l=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(h=>{l.forEach(p=>{h.rtcpFeedback.find(m=>m.type===p.type&&m.parameter===p.parameter)||h.rtcpFeedback.push(p)})}),r},t.writeRtpDescription=function(n,r){let s="";s+="m="+n+" ",s+=r.codecs.length>0?"9":"0",s+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=r.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(h=>{s+=t.writeRtpMap(h),s+=t.writeFmtp(h),s+=t.writeRtcpFb(h)});let l=0;return r.codecs.forEach(h=>{h.maxptime>l&&(l=h.maxptime)}),l>0&&(s+="a=maxptime:"+l+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(h=>{s+=t.writeExtmap(h)}),s},t.parseRtpEncodingParameters=function(n){const r=[],s=t.parseRtpParameters(n),l=s.fecMechanisms.indexOf("RED")!==-1,h=s.fecMechanisms.indexOf("ULPFEC")!==-1,p=t.matchPrefix(n,"a=ssrc:").map(C=>t.parseSsrcMedia(C)).filter(C=>C.attribute==="cname"),m=p.length>0&&p[0].ssrc;let g;const v=t.matchPrefix(n,"a=ssrc-group:FID").map(C=>C.substring(17).split(" ").map(I=>parseInt(I,10)));v.length>0&&v[0].length>1&&v[0][0]===m&&(g=v[0][1]),s.codecs.forEach(C=>{if(C.name.toUpperCase()==="RTX"&&C.parameters.apt){let I={ssrc:m,codecPayloadType:parseInt(C.parameters.apt,10)};m&&g&&(I.rtx={ssrc:g}),r.push(I),l&&(I=JSON.parse(JSON.stringify(I)),I.fec={ssrc:m,mechanism:h?"red+ulpfec":"red"},r.push(I))}}),r.length===0&&m&&r.push({ssrc:m});let T=t.matchPrefix(n,"b=");return T.length&&(T=T[0].indexOf("b=TIAS:")===0?parseInt(T[0].substring(7),10):T[0].indexOf("b=AS:")===0?1e3*parseInt(T[0].substring(5),10)*.95-16e3:void 0,r.forEach(C=>{C.maxBitrate=T})),r},t.parseRtcpParameters=function(n){const r={},s=t.matchPrefix(n,"a=ssrc:").map(p=>t.parseSsrcMedia(p)).filter(p=>p.attribute==="cname")[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);const l=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=l.length>0,r.compound=l.length===0;const h=t.matchPrefix(n,"a=rtcp-mux");return r.mux=h.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const s=t.matchPrefix(n,"a=msid:");if(s.length===1)return r=s[0].substring(7).split(" "),{stream:r[0],track:r[1]};const l=t.matchPrefix(n,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return l.length>0?(r=l[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(n){const r=t.parseMLine(n),s=t.matchPrefix(n,"a=max-message-size:");let l;s.length>0&&(l=parseInt(s[0].substring(19),10)),isNaN(l)&&(l=65536);const h=t.matchPrefix(n,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:r.fmt,maxMessageSize:l};const p=t.matchPrefix(n,"a=sctpmap:");if(p.length>0){const m=p[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:l}}},t.writeSctpDescription=function(n,r){let s=[];return s=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,s){let l;const h=r!==void 0?r:2;return l=n||t.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+l+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const s=t.splitLines(n);for(let l=0;l<s.length;l++)switch(s[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[l].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const r=t.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(n){const r=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},e.exports=t})(R2);var b2=R2.exports,Zg=f(b2),QK=a({__proto__:null,default:Zg},[b2]);function KC(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new t(n),s=Zg.parseCandidate(n.candidate),l=Object.assign(r,s);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,mm(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function VO(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||mm(e,"icecandidate",t=>{if(t.candidate){const n=Zg.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function YC(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(p){if(!p||!p.sdp)return!1;const m=Zg.splitSections(p.sdp);return m.shift(),m.some(g=>{const v=Zg.parseMLine(g);return v&&v.kind==="application"&&v.protocol.indexOf("SCTP")!==-1})},r=function(p){const m=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(m===null||m.length<2)return-1;const g=parseInt(m[1],10);return g!=g?-1:g},s=function(p){let m=65536;return t.browser==="firefox"&&(m=t.version<57?p===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),m},l=function(p,m){let g=65536;t.browser==="firefox"&&t.version===57&&(g=65535);const v=Zg.matchPrefix(p.sdp,"a=max-message-size:");return v.length>0?g=parseInt(v[0].substr(19),10):t.browser==="firefox"&&m!==-1&&(g=2147483637),g},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const p=r(arguments[0]),m=s(p),g=l(arguments[0],p);let v;v=m===0&&g===0?Number.POSITIVE_INFINITY:m===0||g===0?Math.max(m,g):Math.min(m,g);const T={};Object.defineProperty(T,"maxMessageSize",{get:()=>v}),this._sctp=T}return h.apply(this,arguments)}}function XC(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,s){const l=r.send;r.send=function(){const h=arguments[0],p=h.length||h.size||h.byteLength;if(r.readyState==="open"&&s.sctp&&p>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return l.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return t(r,this),r},mm(e,"datachannel",r=>(t(r.channel,r.target),r))}function FO(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const l=s.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const h=new Event("connectionstatechange",s);l.dispatchEvent(h)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function BO(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(l=>_s(l).call(l)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return n.apply(this,arguments)}}function JC(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Je.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Je.resolve())})}function QC(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(s=>n.apply(this,[s]))})}var $K=Object.freeze({__proto__:null,removeExtmapAllowMixed:BO,shimAddIceCandidateNullOrEmpty:JC,shimConnectionState:FO,shimMaxMessageSize:YC,shimParameterlessSetLocalDescription:QC,shimRTCIceCandidate:KC,shimRTCIceCandidateRelayProtocol:VO,shimSendThrowTypeError:XC});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=jM,r=function(l){const h={browser:null,version:null};if(l===void 0||!l.navigator)return h.browser="Not a browser.",h;const{navigator:p}=l;if(p.mozGetUserMedia)h.browser="firefox",h.version=qC(p.userAgent,/Firefox\/(\d+)\./,1);else if(p.webkitGetUserMedia||l.isSecureContext===!1&&l.webkitRTCPeerConnection)h.browser="chrome",h.version=qC(p.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!l.RTCPeerConnection||!p.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=qC(p.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=l.RTCRtpTransceiver&&"currentDirection"in l.RTCRtpTransceiver.prototype}return h}(e),s={browserDetails:r,commonShim:$K,extractVersion:qC,disableLog:MK,disableWarnings:UK,sdp:QK};switch(r.browser){case"chrome":if(!$M||!xO||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=$M,JC(e,r),QC(e),HM(e,r),zM(e),xO(e,r),WM(e),JM(e,r),qM(e),KM(e),YM(e),QM(e,r),KC(e),VO(e),FO(e),YC(e,r),XC(e),BO(e,r);break;case"firefox":if(!l2||!MO||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=l2,JC(e,r),QC(e),ZM(e,r),MO(e,r),e2(e),i2(e),t2(e),n2(e),r2(e),s2(e),a2(e),o2(e),c2(e),KC(e),FO(e),YC(e,r),XC(e);break;case"safari":if(!y2||!t.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=y2,JC(e,r),QC(e),m2(e),g2(e),h2(e),d2(e),u2(e),_2(e),p2(e),E2(e),KC(e),VO(e),YC(e,r),XC(e),BO(e,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var GO=Q;dn({global:!0,forced:GO.globalThis!==GO},{globalThis:GO});var C2=f(Q),HO={exports:{}};(function(e,t){(function(n,r){var s="function",l="undefined",h="object",p="string",m="major",g="model",v="name",T="type",C="vendor",I="version",U="architecture",k="console",M="mobile",F="tablet",B="smarttv",ee="wearable",ue="embedded",de="Amazon",ae="Apple",Te="ASUS",Ae="BlackBerry",We="Browser",tt="Chrome",Ft="Firefox",xt="Google",wt="Huawei",qn="LG",Pn="Microsoft",qs="Motorola",Ie="Opera",Ve="Samsung",ct="Sharp",Ne="Sony",L="Xiaomi",X="Zebra",re="Facebook",Ue="Chromium OS",Lt="Mac OS",Gn=" Browser",Qi=function(zi){for(var $i={},Qn=0;Qn<zi.length;Qn++)$i[zi[Qn].toUpperCase()]=zi[Qn];return $i},Fo=function(zi,$i){return typeof zi===p&&Uc($i).indexOf(Uc(zi))!==-1},Uc=function(zi){return zi.toLowerCase()},MT=function(zi,$i){if(typeof zi===p)return zi=zi.replace(/^\s\s*/,""),typeof $i===l?zi:zi.substring(0,500)},Hm=function(zi,$i){for(var Qn,ha,Al,Pi,Xu,nn,Il=0;Il<$i.length&&!Xu;){var zm=$i[Il],Md=$i[Il+1];for(Qn=ha=0;Qn<zm.length&&!Xu&&zm[Qn];)if(Xu=zm[Qn++].exec(zi))for(Al=0;Al<Md.length;Al++)nn=Xu[++ha],typeof(Pi=Md[Al])===h&&Pi.length>0?Pi.length===2?typeof Pi[1]==s?this[Pi[0]]=Pi[1].call(this,nn):this[Pi[0]]=Pi[1]:Pi.length===3?typeof Pi[1]!==s||Pi[1].exec&&Pi[1].test?this[Pi[0]]=nn?nn.replace(Pi[1],Pi[2]):r:this[Pi[0]]=nn?Pi[1].call(this,nn,Pi[2]):r:Pi.length===4&&(this[Pi[0]]=nn?Pi[3].call(this,nn.replace(Pi[1],Pi[2])):r):this[Pi]=nn||r;Il+=2}},WE=function(zi,$i){for(var Qn in $i)if(typeof $i[Qn]===h&&$i[Qn].length>0){for(var ha=0;ha<$i[Qn].length;ha++)if(Fo($i[Qn][ha],zi))return Qn==="?"?r:Qn}else if(Fo($i[Qn],zi))return Qn==="?"?r:Qn;return $i.hasOwnProperty("*")?$i["*"]:zi},KA={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},YA={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[I,[v,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[I,[v,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[v,I],[/opios[\/ ]+([\w\.]+)/i],[I,[v,Ie+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[I,[v,Ie+" GX"]],[/\bopr\/([\w\.]+)/i],[I,[v,Ie]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[I,[v,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[I,[v,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[v,I],[/quark(?:pc)?\/([-\w\.]+)/i],[I,[v,"Quark"]],[/\bddg\/([\w\.]+)/i],[I,[v,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[I,[v,"UC"+We]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[I,[v,"WeChat"]],[/konqueror\/([\w\.]+)/i],[I,[v,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[I,[v,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[I,[v,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[I,[v,"Smart Lenovo "+We]],[/(avast|avg)\/([\w\.]+)/i],[[v,/(.+)/,"$1 Secure "+We],I],[/\bfocus\/([\w\.]+)/i],[I,[v,Ft+" Focus"]],[/\bopt\/([\w\.]+)/i],[I,[v,Ie+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[I,[v,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[I,[v,"Dolphin"]],[/coast\/([\w\.]+)/i],[I,[v,Ie+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[I,[v,"MIUI"+Gn]],[/fxios\/([\w\.-]+)/i],[I,[v,Ft]],[/\bqihoobrowser\/?([\w\.]*)/i],[I,[v,"360"]],[/\b(qq)\/([\w\.]+)/i],[[v,/(.+)/,"$1Browser"],I],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[v,/(.+)/,"$1"+Gn],I],[/samsungbrowser\/([\w\.]+)/i],[I,[v,Ve+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[I,[v,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[v,"Sogou Mobile"],I],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[v,I],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[v],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[I,v],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[v,re],I],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[v,I],[/\bgsa\/([\w\.]+) .*safari\//i],[I,[v,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[I,[v,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[I,[v,tt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[v,tt+" WebView"],I],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[I,[v,"Android "+We]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[v,I],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[I,[v,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[I,v],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[v,[I,WE,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[v,I],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[v,"Netscape"],I],[/(wolvic|librewolf)\/([\w\.]+)/i],[v,I],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[I,[v,Ft+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[v,[I,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[v,[I,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[U,"amd64"]],[/(ia32(?=;))/i],[[U,Uc]],[/((?:i[346]|x)86)[;\)]/i],[[U,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[U,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[U,"armhf"]],[/windows (ce|mobile); ppc;/i],[[U,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[U,/ower/,"",Uc]],[/(sun4\w)[;\)]/i],[[U,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[U,Uc]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[g,[C,Ve],[T,F]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[g,[C,Ve],[T,M]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[g,[C,ae],[T,M]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[g,[C,ae],[T,F]],[/(macintosh);/i],[g,[C,ae]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[g,[C,ct],[T,M]],[/(?:honor)([-\w ]+)[;\)]/i],[g,[C,"Honor"],[T,M]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[g,[C,wt],[T,F]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[g,[C,wt],[T,M]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[g,/_/g," "],[C,L],[T,M]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[g,/_/g," "],[C,L],[T,F]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[g,[C,"OPPO"],[T,M]],[/\b(opd2\d{3}a?) bui/i],[g,[C,"OPPO"],[T,F]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[g,[C,"Vivo"],[T,M]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[g,[C,"Realme"],[T,M]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[g,[C,qs],[T,M]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[g,[C,qs],[T,F]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[g,[C,qn],[T,F]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[g,[C,qn],[T,M]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[g,[C,"Lenovo"],[T,F]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[g,/_/g," "],[C,"Nokia"],[T,M]],[/(pixel c)\b/i],[g,[C,xt],[T,F]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[g,[C,xt],[T,M]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[g,[C,Ne],[T,M]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[g,"Xperia Tablet"],[C,Ne],[T,F]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[g,[C,"OnePlus"],[T,M]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[g,[C,de],[T,F]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[g,/(.+)/g,"Fire Phone $1"],[C,de],[T,M]],[/(playbook);[-\w\),; ]+(rim)/i],[g,C,[T,F]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[g,[C,Ae],[T,M]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[g,[C,Te],[T,F]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[g,[C,Te],[T,M]],[/(nexus 9)/i],[g,[C,"HTC"],[T,F]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[C,[g,/_/g," "],[T,M]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[g,[C,"TCL"],[T,F]],[/(itel) ((\w+))/i],[[C,Uc],g,[T,WE,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[g,[C,"Acer"],[T,F]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[g,[C,"Meizu"],[T,M]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[g,[C,"Ulefone"],[T,M]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[g,[C,"Energizer"],[T,M]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[g,[C,"Cat"],[T,M]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[g,[C,"Smartfren"],[T,M]],[/droid.+; (a(?:015|06[35]|142p?))/i],[g,[C,"Nothing"],[T,M]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[C,g,[T,M]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[C,g,[T,F]],[/(surface duo)/i],[g,[C,Pn],[T,F]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[g,[C,"Fairphone"],[T,M]],[/(u304aa)/i],[g,[C,"AT&T"],[T,M]],[/\bsie-(\w*)/i],[g,[C,"Siemens"],[T,M]],[/\b(rct\w+) b/i],[g,[C,"RCA"],[T,F]],[/\b(venue[\d ]{2,7}) b/i],[g,[C,"Dell"],[T,F]],[/\b(q(?:mv|ta)\w+) b/i],[g,[C,"Verizon"],[T,F]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[g,[C,"Barnes & Noble"],[T,F]],[/\b(tm\d{3}\w+) b/i],[g,[C,"NuVision"],[T,F]],[/\b(k88) b/i],[g,[C,"ZTE"],[T,F]],[/\b(nx\d{3}j) b/i],[g,[C,"ZTE"],[T,M]],[/\b(gen\d{3}) b.+49h/i],[g,[C,"Swiss"],[T,M]],[/\b(zur\d{3}) b/i],[g,[C,"Swiss"],[T,F]],[/\b((zeki)?tb.*\b) b/i],[g,[C,"Zeki"],[T,F]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[C,"Dragon Touch"],g,[T,F]],[/\b(ns-?\w{0,9}) b/i],[g,[C,"Insignia"],[T,F]],[/\b((nxa|next)-?\w{0,9}) b/i],[g,[C,"NextBook"],[T,F]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[C,"Voice"],g,[T,M]],[/\b(lvtel\-)?(v1[12]) b/i],[[C,"LvTel"],g,[T,M]],[/\b(ph-1) /i],[g,[C,"Essential"],[T,M]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[g,[C,"Envizen"],[T,F]],[/\b(trio[-\w\. ]+) b/i],[g,[C,"MachSpeed"],[T,F]],[/\btu_(1491) b/i],[g,[C,"Rotor"],[T,F]],[/(shield[\w ]+) b/i],[g,[C,"Nvidia"],[T,F]],[/(sprint) (\w+)/i],[C,g,[T,M]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[C,Pn],[T,M]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[g,[C,X],[T,F]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[g,[C,X],[T,M]],[/smart-tv.+(samsung)/i],[C,[T,B]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[C,Ve],[T,B]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[C,qn],[T,B]],[/(apple) ?tv/i],[C,[g,ae+" TV"],[T,B]],[/crkey/i],[[g,tt+"cast"],[C,xt],[T,B]],[/droid.+aft(\w+)( bui|\))/i],[g,[C,de],[T,B]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[g,[C,ct],[T,B]],[/(bravia[\w ]+)( bui|\))/i],[g,[C,Ne],[T,B]],[/(mitv-\w{5}) bui/i],[g,[C,L],[T,B]],[/Hbbtv.*(technisat) (.*);/i],[C,g,[T,B]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[C,MT],[g,MT],[T,B]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[T,B]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[C,g,[T,k]],[/droid.+; (shield) bui/i],[g,[C,"Nvidia"],[T,k]],[/(playstation [345portablevi]+)/i],[g,[C,Ne],[T,k]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[g,[C,Pn],[T,k]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[g,[C,Ve],[T,ee]],[/((pebble))app/i],[C,g,[T,ee]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[g,[C,ae],[T,ee]],[/droid.+; (glass) \d/i],[g,[C,xt],[T,ee]],[/droid.+; (wt63?0{2,3})\)/i],[g,[C,X],[T,ee]],[/droid.+; (glass) \d/i],[g,[C,xt],[T,ee]],[/(pico) (4|neo3(?: link|pro)?)/i],[C,g,[T,ee]],[/; (quest( \d| pro)?)/i],[g,[C,re],[T,ee]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[C,[T,ue]],[/(aeobc)\b/i],[g,[C,de],[T,ue]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[g,[T,M]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[g,[T,F]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[T,F]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[T,M]],[/(android[-\w\. ]{0,9});.+buil/i],[g,[C,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[I,[v,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[v,I],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[I,[v,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[v,I],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[I,v]],os:[[/microsoft (windows) (vista|xp)/i],[v,I],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[v,[I,WE,KA]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[I,WE,KA],[v,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[I,/_/g,"."],[v,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[v,Lt],[I,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[I,v],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[v,I],[/\(bb(10);/i],[I,[v,Ae]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[I,[v,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[I,[v,Ft+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[I,[v,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[I,[v,"watchOS"]],[/crkey\/([\d\.]+)/i],[I,[v,tt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[v,Ue],I],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[v,I],[/(sunos) ?([\w\.\d]*)/i],[[v,"Solaris"],I],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[v,I]]},Bo=function(zi,$i){if(typeof zi===h&&($i=zi,zi=r),!(this instanceof Bo))return new Bo(zi,$i).getResult();var Qn=typeof n!==l&&n.navigator?n.navigator:r,ha=zi||(Qn&&Qn.userAgent?Qn.userAgent:""),Al=Qn&&Qn.userAgentData?Qn.userAgentData:r,Pi=$i?function(nn,Il){var zm={};for(var Md in nn)Il[Md]&&Il[Md].length%2==0?zm[Md]=Il[Md].concat(nn[Md]):zm[Md]=nn[Md];return zm}(YA,$i):YA,Xu=Qn&&Qn.userAgent==ha;return this.getBrowser=function(){var nn={};return nn[v]=r,nn[I]=r,Hm.call(nn,ha,Pi.browser),nn[m]=function(Il){return typeof Il===p?Il.replace(/[^\d\.]/g,"").split(".")[0]:r}(nn[I]),Xu&&Qn&&Qn.brave&&typeof Qn.brave.isBrave==s&&(nn[v]="Brave"),nn},this.getCPU=function(){var nn={};return nn[U]=r,Hm.call(nn,ha,Pi.cpu),nn},this.getDevice=function(){var nn={};return nn[C]=r,nn[g]=r,nn[T]=r,Hm.call(nn,ha,Pi.device),Xu&&!nn[T]&&Al&&Al.mobile&&(nn[T]=M),Xu&&nn[g]=="Macintosh"&&Qn&&typeof Qn.standalone!==l&&Qn.maxTouchPoints&&Qn.maxTouchPoints>2&&(nn[g]="iPad",nn[T]=F),nn},this.getEngine=function(){var nn={};return nn[v]=r,nn[I]=r,Hm.call(nn,ha,Pi.engine),nn},this.getOS=function(){var nn={};return nn[v]=r,nn[I]=r,Hm.call(nn,ha,Pi.os),Xu&&!nn[v]&&Al&&Al.platform&&Al.platform!="Unknown"&&(nn[v]=Al.platform.replace(/chrome os/i,Ue).replace(/macos/i,Lt)),nn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ha},this.setUA=function(nn){return ha=typeof nn===p&&nn.length>500?MT(nn,500):nn,this},this.setUA(ha),this};Bo.VERSION="0.7.40",Bo.BROWSER=Qi([v,I,m]),Bo.CPU=Qi([U]),Bo.DEVICE=Qi([g,C,T,k,M,B,F,ee,ue]),Bo.ENGINE=Bo.OS=Qi([v,I]),e.exports&&(t=e.exports=Bo),t.UAParser=Bo;var Yu=typeof n!==l&&(n.jQuery||n.Zepto);if(Yu&&!Yu.ua){var XA=new Bo;Yu.ua=XA.getResult(),Yu.ua.get=function(){return XA.getUA()},Yu.ua.set=function(zi){XA.setUA(zi);var $i=XA.getResult();for(var Qn in $i)Yu.ua[Qn]=$i[Qn]}}})(typeof window=="object"?window:d)})(HO,HO.exports);var ZK=f(HO.exports),w2=Io.clear;dn({global:!0,bind:!0,forced:Q.clearImmediate!==w2},{clearImmediate:w2});var A2=Q,eY=me,tY=pe,nY=Sh,iY=Me,rY=js,sY=sa,aY=A2.Function,oY=/MSIE .\./.test(iY)||nY==="BUN"&&function(){var e=A2.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),cY=dn,I2=Q,N2=Io.set,lY=function(e,t){var n=1;return oY?function(r,s){var l=sY(arguments.length,1)>n,h=tY(r)?r:aY(r),p=l?rY(arguments,n):[],m=l?function(){eY(h,this,p)}:h;return e(m)}:e},O2=I2.setImmediate?lY(N2):N2;cY({global:!0,bind:!0,forced:I2.setImmediate!==O2},{setImmediate:O2});var D2=f(ui.setImmediate),dY=Q,uY=wu,hY=zn,pY=sa,fY=Fe;dn({global:!0,dontCallGetSet:!0,forced:y(function(){return fY&&Object.getOwnPropertyDescriptor(dY,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){pY(arguments.length,1),uY(hY(e))}});var P2=f(ui.queueMicrotask);function L2(e,t){return function(){return e.apply(t,arguments)}}const{toString:mY}=Object.prototype,{getPrototypeOf:zO}=Object,{iterator:$C,toStringTag:k2}=Symbol,ZC=(WO=Object.create(null),e=>{const t=mY.call(e);return WO[t]||(WO[t]=t.slice(8,-1).toLowerCase())});var WO;const fl=e=>(e=e.toLowerCase(),t=>ZC(t)===e),ew=e=>t=>typeof t===e,{isArray:eE}=Array,PS=ew("undefined"),x2=fl("ArrayBuffer"),_Y=ew("string"),$a=ew("function"),M2=ew("number"),tw=e=>e!==null&&typeof e=="object",nw=e=>{if(ZC(e)!=="object")return!1;const t=zO(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||k2 in e||$C in e)},gY=fl("Date"),EY=fl("File"),yY=fl("Blob"),vY=fl("FileList"),SY=fl("URLSearchParams"),[TY,RY,bY,CY]=["ReadableStream","Request","Response","Headers"].map(fl);function LS(e,t){let n,r,{allOwnKeys:s=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),eE(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const l=s?Object.getOwnPropertyNames(e):Object.keys(e),h=l.length;let p;for(n=0;n<h;n++)p=l[n],t.call(null,e[p],p,e)}}function U2(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,s=n.length;for(;s-- >0;)if(r=n[s],t===r.toLowerCase())return r;return null}const _m=C2!==void 0?C2:typeof self<"u"?self:typeof window<"u"?window:xL,j2=e=>!PS(e)&&e!==_m,wY=(qO=typeof Uint8Array<"u"&&zO(Uint8Array),e=>qO&&e instanceof qO);var qO;const AY=fl("HTMLFormElement"),V2=(e=>{let{hasOwnProperty:t}=e;return(n,r)=>t.call(n,r)})(Object.prototype),IY=fl("RegExp"),F2=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};LS(n,(s,l)=>{let h;(h=t(s,l,e))!==!1&&(r[l]=h||s)}),Object.defineProperties(e,r)},NY=fl("AsyncFunction"),B2=(G2=typeof D2=="function",H2=$a(_m.postMessage),G2?D2:H2?(KO="axios@".concat(Math.random()),iw=[],_m.addEventListener("message",e=>{let{source:t,data:n}=e;t===_m&&n===KO&&iw.length&&iw.shift()()},!1),e=>{iw.push(e),_m.postMessage(KO,"*")}):e=>setTimeout(e));var G2,H2,KO,iw;const OY=P2!==void 0?P2.bind(_m):typeof process<"u"&&process.nextTick||B2;var Xe={isArray:eE,isArrayBuffer:x2,isBuffer:function(e){return e!==null&&!PS(e)&&e.constructor!==null&&!PS(e.constructor)&&$a(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||$a(e.append)&&((t=ZC(e))==="formdata"||t==="object"&&$a(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&x2(e.buffer),t},isString:_Y,isNumber:M2,isBoolean:e=>e===!0||e===!1,isObject:tw,isPlainObject:nw,isReadableStream:TY,isRequest:RY,isResponse:bY,isHeaders:CY,isUndefined:PS,isDate:gY,isFile:EY,isBlob:yY,isRegExp:IY,isFunction:$a,isStream:e=>tw(e)&&$a(e.pipe),isURLSearchParams:SY,isTypedArray:wY,isFileList:vY,forEach:LS,merge:function e(){const{caseless:t}=j2(this)&&this||{},n={},r=(s,l)=>{const h=t&&U2(n,l)||l;nw(n[h])&&nw(s)?n[h]=e(n[h],s):nw(s)?n[h]=e({},s):eE(s)?n[h]=s.slice():n[h]=s};for(let s=0,l=arguments.length;s<l;s++)arguments[s]&&LS(arguments[s],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return LS(t,(s,l)=>{n&&$a(s)?e[l]=L2(s,n):e[l]=s},{allOwnKeys:r}),e},trim:e=>_s(e)?_s(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let s,l,h;const p={};if(t=t||{},e==null)return t;do{for(s=Object.getOwnPropertyNames(e),l=s.length;l-- >0;)h=s[l],r&&!r(h,e,t)||p[h]||(t[h]=e[h],p[h]=!0);e=n!==!1&&zO(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:ZC,kindOfTest:fl,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return r!==-1&&r===n},toArray:e=>{if(!e)return null;if(eE(e))return e;let t=e.length;if(!M2(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[$C]).call(e);let r;for(;(r=n.next())&&!r.done;){const s=r.value;t.call(e,s[0],s[1])}},matchAll:(e,t)=>{let n;const r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},isHTMLForm:AY,hasOwnProperty:V2,hasOwnProp:V2,reduceDescriptors:F2,freezeMethods:e=>{F2(e,(t,n)=>{if($a(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=e[n];$a(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=s=>{s.forEach(l=>{n[l]=!0})};return eE(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,r){return n.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:U2,global:_m,isContextDefined:j2,isSpecCompliantForm:function(e){return!!(e&&$a(e.append)&&e[k2]==="FormData"&&e[$C])},toJSONObject:e=>{const t=new Array(10),n=(r,s)=>{if(tw(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[s]=r;const l=eE(r)?[]:{};return LS(r,(h,p)=>{const m=n(h,s+1);!PS(m)&&(l[p]=m)}),t[s]=void 0,l}}return r};return n(e,0)},isAsyncFn:NY,isThenable:e=>e&&(tw(e)||$a(e))&&$a(e.then)&&$a(e.catch),setImmediate:B2,asap:OY,isIterable:e=>e!=null&&$a(e[$C])};function Nn(e,t,n,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}Xe.inherits(Nn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Xe.toJSONObject(this.config),code:this.code,status:this.status}}});const z2=Nn.prototype,W2={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{W2[e]={value:e}}),Object.defineProperties(Nn,W2),Object.defineProperty(z2,"isAxiosError",{value:!0}),Nn.from=(e,t,n,r,s,l)=>{const h=Object.create(z2);return Xe.toFlatObject(e,h,function(p){return p!==Error.prototype},p=>p!=="isAxiosError"),Nn.call(h,e.message,t,n,r,s),h.cause=e,h.name=e.name,l&&Object.assign(h,l),h};function YO(e){return Xe.isPlainObject(e)||Xe.isArray(e)}function q2(e){return Xe.endsWith(e,"[]")?e.slice(0,-2):e}function K2(e,t,n){return e?e.concat(t).map(function(r,s){return r=q2(r),!n&&s?"["+r+"]":r}).join(n?".":""):t}const DY=Xe.toFlatObject(Xe,{},null,function(e){return/^is[A-Z]/.test(e)});function rw(e,t,n){if(!Xe.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=Xe.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(C,I){return!Xe.isUndefined(I[C])})).metaTokens,s=n.visitor||g,l=n.dots,h=n.indexes,p=(n.Blob||typeof Blob<"u"&&Blob)&&Xe.isSpecCompliantForm(t);if(!Xe.isFunction(s))throw new TypeError("visitor must be a function");function m(C){if(C===null)return"";if(Xe.isDate(C))return C.toISOString();if(!p&&Xe.isBlob(C))throw new Nn("Blob is not supported. Use a Buffer instead.");return Xe.isArrayBuffer(C)||Xe.isTypedArray(C)?p&&typeof Blob=="function"?new Blob([C]):Buffer.from(C):C}function g(C,I,U){let k=C;if(C&&!U&&typeof C=="object"){if(Xe.endsWith(I,"{}"))I=r?I:I.slice(0,-2),C=JSON.stringify(C);else if(Xe.isArray(C)&&function(M){return Xe.isArray(M)&&!M.some(YO)}(C)||(Xe.isFileList(C)||Xe.endsWith(I,"[]"))&&(k=Xe.toArray(C)))return I=q2(I),k.forEach(function(M,F){!Xe.isUndefined(M)&&M!==null&&t.append(h===!0?K2([I],F,l):h===null?I:I+"[]",m(M))}),!1}return!!YO(C)||(t.append(K2(U,I,l),m(C)),!1)}const v=[],T=Object.assign(DY,{defaultVisitor:g,convertValue:m,isVisitable:YO});if(!Xe.isObject(e))throw new TypeError("data must be an object");return function C(I,U){if(!Xe.isUndefined(I)){if(v.indexOf(I)!==-1)throw Error("Circular reference detected in "+U.join("."));v.push(I),Xe.forEach(I,function(k,M){(!(Xe.isUndefined(k)||k===null)&&s.call(t,k,Xe.isString(M)?_s(M).call(M):M,U,T))===!0&&C(k,U?U.concat(M):[M])}),v.pop()}}(e),t}function Y2(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function XO(e,t){this._pairs=[],e&&rw(e,this,t)}const X2=XO.prototype;function PY(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function J2(e,t,n){if(!t)return e;const r=n&&n.encode||PY;Xe.isFunction(n)&&(n={serialize:n});const s=n&&n.serialize;let l;if(l=s?s(t,n):Xe.isURLSearchParams(t)?t.toString():new XO(t,n).toString(r),l){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}X2.append=function(e,t){this._pairs.push([e,t])},X2.toString=function(e){const t=e?function(n){return e.call(this,n,Y2)}:Y2;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var Q2=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Xe.forEach(this.handlers,function(t){t!==null&&e(t)})}},$2={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Z2={exports:{}},LY=dn,kY=Fe,eU=ts.f;LY({target:"Object",stat:!0,forced:Object.defineProperty!==eU,sham:!kY},{defineProperty:eU});var tU=ui.Object,xY=Z2.exports=function(e,t,n){return tU.defineProperty(e,t,n)};tU.defineProperty.sham&&(xY.sham=!0);var nU=f(Z2.exports),MY=TypeError,iU=ac,UY=Ff,jY=kn,VY=hi("species"),rU=Array,FY=function(e){var t;return iU(e)&&(t=e.constructor,(UY(t)&&(t===rU||iU(t.prototype))||jY(t)&&(t=t[VY])===null)&&(t=void 0)),t===void 0?rU:t},sU=function(e,t){return new(FY(e))(t===0?0:t)},BY=y,GY=cr,HY=hi("species"),aU=function(e){return GY>=51||!BY(function(){var t=[];return(t.constructor={})[HY]=function(){return{foo:1}},t[e](Boolean).foo!==1})},zY=dn,WY=y,qY=ac,KY=kn,YY=Sa,XY=Cn,oU=function(e){if(e>9007199254740991)throw MY("Maximum allowed index exceeded");return e},cU=uO,JY=sU,QY=aU,$Y=cr,lU=hi("isConcatSpreadable"),ZY=$Y>=51||!WY(function(){var e=[];return e[lU]=!1,e.concat()[0]!==e}),e7=function(e){if(!KY(e))return!1;var t=e[lU];return t!==void 0?!!t:qY(e)};zY({target:"Array",proto:!0,forced:!ZY||!QY("concat")},{concat:function(e){var t,n,r,s,l,h=YY(this),p=JY(h,0),m=0;for(t=-1,r=arguments.length;t<r;t++)if(e7(l=t===-1?h:arguments[t]))for(s=XY(l),oU(m+s),n=0;n<s;n++,m++)n in l&&cU(p,m,l[n]);else oU(m+1),cU(p,m++,l);return p.length=m,p}});var dU={},t7=Z,n7=Zt,uU=cc.f,i7=js,hU=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];dU.f=function(e){return hU&&t7(e)==="Window"?function(t){try{return uU(t)}catch{return i7(hU)}}(e):uU(n7(e))};var tE={},r7=hi;tE.f=r7;var pU=ui,s7=ki,a7=tE,o7=ts.f,vr=function(e){var t=pU.Symbol||(pU.Symbol={});s7(t,e)||o7(t,e,{value:a7.f(e)})},c7=je,l7=Ti,d7=hi,u7=Gr,fU=function(){var e=l7("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=d7("toPrimitive");t&&!t[r]&&u7(t,r,function(s){return c7(n,this)},{})},h7=Ra,p7=Bt,f7=Sa,m7=Cn,_7=sU,mU=G([].push),g7=function(e){var t=e===1,n=e===2,r=e===3,s=e===4,l=e===6,h=e===7,p=e===5||l;return function(m,g,v,T){for(var C,I,U=f7(m),k=p7(U),M=m7(k),F=h7(g,v),B=0,ee=T||_7,ue=t?ee(m,M):n||h?ee(m,0):void 0;M>B;B++)if((p||B in k)&&(I=F(C=k[B],B,U),e))if(t)ue[B]=I;else if(I)switch(e){case 3:return!0;case 5:return C;case 6:return B;case 2:mU(ue,C)}else switch(e){case 4:return!1;case 7:mU(ue,C)}return l?-1:r||s?s:ue}},_U={forEach:g7(0)},sw=dn,kS=Q,JO=je,E7=G,nE=Fe,iE=ya,y7=y,ws=ki,v7=W,QO=yr,aw=Zt,$O=Zs,S7=Fr,ZO=rt,rE=mu,gU=wh,T7=cc,EU=dU,R7=du,yU=he,vU=ts,b7=uu,SU=nt,TU=Gr,C7=Fi,eD=bs,RU=Br,bU=Eo,w7=hi,A7=tE,I7=vr,N7=fU,O7=Co,CU=bo,ow=_U.forEach,Za=Yi("hidden"),cw="Symbol",xS="prototype",D7=CU.set,wU=CU.getterFor(cw),ml=Object[xS],gm=kS.Symbol,lw=gm&&gm[xS],P7=kS.RangeError,L7=kS.TypeError,tD=kS.QObject,AU=yU.f,Em=vU.f,IU=EU.f,k7=SU.f,NU=E7([].push),ku=eD("symbols"),MS=eD("op-symbols"),x7=eD("wks"),nD=!tD||!tD[xS]||!tD[xS].findChild,OU=function(e,t,n){var r=AU(ml,t);r&&delete ml[t],Em(e,t,n),r&&e!==ml&&Em(ml,t,r)},iD=nE&&y7(function(){return rE(Em({},"a",{get:function(){return Em(this,"a",{value:7}).a}})).a!==7})?OU:Em,rD=function(e,t){var n=ku[e]=rE(lw);return D7(n,{type:cw,tag:e,description:t}),nE||(n.description=t),n},dw=function(e,t,n){e===ml&&dw(MS,t,n),QO(e);var r=$O(t);return QO(n),ws(ku,r)?(n.enumerable?(ws(e,Za)&&e[Za][r]&&(e[Za][r]=!1),n=rE(n,{enumerable:ZO(0,!1)})):(ws(e,Za)||Em(e,Za,ZO(1,rE(null))),e[Za][r]=!0),iD(e,r,n)):Em(e,r,n)},sD=function(e,t){QO(e);var n=aw(t),r=gU(n).concat(kU(n));return ow(r,function(s){nE&&!JO(DU,n,s)||dw(e,s,n[s])}),e},DU=function(e){var t=$O(e),n=JO(k7,this,t);return!(this===ml&&ws(ku,t)&&!ws(MS,t))&&(!(n||!ws(this,t)||!ws(ku,t)||ws(this,Za)&&this[Za][t])||n)},PU=function(e,t){var n=aw(e),r=$O(t);if(n!==ml||!ws(ku,r)||ws(MS,r)){var s=AU(n,r);return!s||!ws(ku,r)||ws(n,Za)&&n[Za][r]||(s.enumerable=!0),s}},LU=function(e){var t=IU(aw(e)),n=[];return ow(t,function(r){ws(ku,r)||ws(RU,r)||NU(n,r)}),n},kU=function(e){var t=e===ml,n=IU(t?MS:aw(e)),r=[];return ow(n,function(s){!ws(ku,s)||t&&!ws(ml,s)||NU(r,ku[s])}),r};iE||(gm=function(){if(v7(lw,this))throw new L7("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?S7(arguments[0]):void 0,t=bU(e),n=function(r){var s=this===void 0?kS:this;s===ml&&JO(n,MS,r),ws(s,Za)&&ws(s[Za],t)&&(s[Za][t]=!1);var l=ZO(1,r);try{iD(s,t,l)}catch(h){if(!(h instanceof P7))throw h;OU(s,t,l)}};return nE&&nD&&iD(ml,t,{configurable:!0,set:n}),rD(t,e)},TU(lw=gm[xS],"toString",function(){return wU(this).tag}),TU(gm,"withoutSetter",function(e){return rD(bU(e),e)}),SU.f=DU,vU.f=dw,b7.f=sD,yU.f=PU,T7.f=EU.f=LU,R7.f=kU,A7.f=function(e){return rD(w7(e),e)},nE&&C7(lw,"description",{configurable:!0,get:function(){return wU(this).description}})),sw({global:!0,wrap:!0,forced:!iE,sham:!iE},{Symbol:gm}),ow(gU(x7),function(e){I7(e)}),sw({target:cw,stat:!0,forced:!iE},{useSetter:function(){nD=!0},useSimple:function(){nD=!1}}),sw({target:"Object",stat:!0,forced:!iE,sham:!nE},{create:function(e,t){return t===void 0?rE(e):sD(rE(e),t)},defineProperty:dw,defineProperties:sD,getOwnPropertyDescriptor:PU}),sw({target:"Object",stat:!0,forced:!iE},{getOwnPropertyNames:LU}),N7(),O7(gm,cw),RU[Za]=!0;var xU=ya&&!!Symbol.for&&!!Symbol.keyFor,M7=dn,U7=Ti,j7=ki,V7=Fr,MU=bs,F7=xU,aD=MU("string-to-symbol-registry"),B7=MU("symbol-to-string-registry");M7({target:"Symbol",stat:!0,forced:!F7},{for:function(e){var t=V7(e);if(j7(aD,t))return aD[t];var n=U7("Symbol")(t);return aD[t]=n,B7[n]=t,n}});var G7=dn,H7=ki,z7=$s,W7=va,q7=xU,UU=bs("symbol-to-string-registry");G7({target:"Symbol",stat:!0,forced:!q7},{keyFor:function(e){if(!z7(e))throw new TypeError(W7(e)+" is not a symbol");if(H7(UU,e))return UU[e]}});var jU=ac,K7=pe,VU=Z,Y7=Fr,FU=G([].push),X7=dn,BU=Ti,GU=me,J7=je,US=G,HU=y,zU=pe,WU=$s,qU=js,Q7=function(e){if(K7(e))return e;if(jU(e)){for(var t=e.length,n=[],r=0;r<t;r++){var s=e[r];typeof s=="string"?FU(n,s):typeof s!="number"&&VU(s)!=="Number"&&VU(s)!=="String"||FU(n,Y7(s))}var l=n.length,h=!0;return function(p,m){if(h)return h=!1,m;if(jU(this))return m;for(var g=0;g<l;g++)if(n[g]===p)return m}}},$7=ya,Z7=String,lp=BU("JSON","stringify"),uw=US(/./.exec),KU=US("".charAt),eX=US("".charCodeAt),tX=US("".replace),nX=US(1 .toString),iX=/[\uD800-\uDFFF]/g,YU=/^[\uD800-\uDBFF]$/,XU=/^[\uDC00-\uDFFF]$/,JU=!$7||HU(function(){var e=BU("Symbol")("stringify detection");return lp([e])!=="[null]"||lp({a:e})!=="{}"||lp(Object(e))!=="{}"}),QU=HU(function(){return lp("\uDF06\uD834")!=='"\\udf06\\ud834"'||lp("\uDEAD")!=='"\\udead"'}),rX=function(e,t){var n=qU(arguments),r=Q7(t);if(zU(r)||e!==void 0&&!WU(e))return n[1]=function(s,l){if(zU(r)&&(l=J7(r,this,Z7(s),l)),!WU(l))return l},GU(lp,null,n)},sX=function(e,t,n){var r=KU(n,t-1),s=KU(n,t+1);return uw(YU,e)&&!uw(XU,s)||uw(XU,e)&&!uw(YU,r)?"\\u"+nX(eX(e,0),16):e};lp&&X7({target:"JSON",stat:!0,forced:JU||QU},{stringify:function(e,t,n){var r=qU(arguments),s=GU(JU?rX:lp,null,r);return QU&&typeof s=="string"?tX(s,iX,sX):s}});var $U=du,aX=Sa;dn({target:"Object",stat:!0,forced:!ya||y(function(){$U.f(1)})},{getOwnPropertySymbols:function(e){var t=$U.f;return t?t(aX(e)):[]}}),vr("asyncIterator"),vr("hasInstance"),vr("isConcatSpreadable"),vr("iterator"),vr("match"),vr("matchAll"),vr("replace"),vr("search"),vr("species"),vr("split");var oX=fU;vr("toPrimitive"),oX();var cX=Ti,lX=Co;vr("toStringTag"),lX(cX("Symbol"),"Symbol"),vr("unscopables"),Co(Q.JSON,"JSON",!0);var dX=ui.Symbol,uX=hi,hX=ts.f,ZU=uX("metadata"),ej=Function.prototype;ej[ZU]===void 0&&hX(ej,ZU,{value:null}),vr("asyncDispose"),vr("dispose"),vr("metadata");var pX=dX,fX=G,oD=Ti("Symbol"),mX=oD.keyFor,_X=fX(oD.prototype.valueOf),tj=oD.isRegisteredSymbol||function(e){try{return mX(_X(e))!==void 0}catch{return!1}};dn({target:"Symbol",stat:!0},{isRegisteredSymbol:tj});for(var gX=bs,nj=Ti,EX=G,yX=$s,vX=hi,hw=nj("Symbol"),ij=hw.isWellKnownSymbol,rj=nj("Object","getOwnPropertyNames"),SX=EX(hw.prototype.valueOf),sj=gX("wks"),cD=0,aj=rj(hw),TX=aj.length;cD<TX;cD++)try{var oj=aj[cD];yX(hw[oj])&&vX(oj)}catch{}var cj=function(e){if(ij&&ij(e))return!0;try{for(var t=SX(e),n=0,r=rj(sj),s=r.length;n<s;n++)if(sj[r[n]]==t)return!0}catch{}return!1};dn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:cj}),vr("customMatcher"),vr("observable"),dn({target:"Symbol",stat:!0},{isRegistered:tj}),dn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:cj}),vr("matcher"),vr("metadataKey"),vr("patternMatch"),vr("replaceAll");var sE=f(pX),lj=f(tE.f("iterator"));function jS(e){return jS=typeof sE=="function"&&typeof lj=="symbol"?function(t){return typeof t}:function(t){return t&&typeof sE=="function"&&t.constructor===sE&&t!==sE.prototype?"symbol":typeof t},jS(e)}var RX=f(tE.f("toPrimitive"));function bX(e){var t=function(n,r){if(jS(n)!="object"||!n)return n;var s=n[RX];if(s!==void 0){var l=s.call(n,r);if(jS(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}(e,"string");return jS(t)=="symbol"?t:t+""}function V(e,t,n){return(t=bX(t))in e?nU(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var dj=f(bq),CX={isBrowser:!0,classes:{URLSearchParams:dj!==void 0?dj:XO,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const lD=typeof window<"u"&&typeof document<"u",dD=typeof navigator=="object"&&navigator||void 0,wX=lD&&(!dD||["ReactNative","NativeScript","NS"].indexOf(dD.product)<0),AX=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",IX=lD&&window.location.href||"http://localhost";function uj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function hj(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?uj(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uj(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var oa=hj(hj({},Object.freeze({__proto__:null,hasBrowserEnv:lD,hasStandardBrowserEnv:wX,hasStandardBrowserWebWorkerEnv:AX,navigator:dD,origin:IX})),CX),NX=yr,OX=je,DX=ki,PX=W,LX=function(){var e=NX(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},pj=RegExp.prototype,fj=function(e){var t=e.flags;return t!==void 0||"flags"in pj||DX(e,"flags")||!PX(pj,e)?t:OX(LX,e)},kX=im.charAt,mj=je,xX=yr,MX=pe,UX=Z,jX=/./.exec,VX=TypeError,FX=dn,_j=je,gj=fe,BX=sg,pw=jh,Ej=yt,yj=$n,VS=Fr,GX=yr,HX=fn,zX=Z,WX=Ly,vj=fj,qX=ks,KX=y,YX=pg,XX=function(e,t,n){return t+(n?kX(e,t).length:1)},JX=function(e,t){var n=e.exec;if(MX(n)){var r=mj(n,e,t);return r!==null&&xX(r),r}if(UX(e)==="RegExp")return mj(jX,e,t);throw new VX("RegExp#exec called on incompatible receiver")},Sj=bo,QX=hi("matchAll"),Tj="RegExp String",Rj=Tj+" Iterator",$X=Sj.set,ZX=Sj.getterFor(Rj),eJ=TypeError,uD=gj("".indexOf),fw=gj("".matchAll),hD=!!fw&&!KX(function(){fw("a",/./)}),tJ=BX(function(e,t,n,r){$X(this,{type:Rj,regexp:e,string:t,global:n,unicode:r,done:!1})},Tj,function(){var e=ZX(this);if(e.done)return pw(void 0,!0);var t=e.regexp,n=e.string,r=JX(t,n);return r===null?(e.done=!0,pw(void 0,!0)):e.global?(VS(r[0])===""&&(t.lastIndex=XX(n,yj(t.lastIndex),e.unicode)),pw(r,!1)):(e.done=!0,pw(r,!1))}),bj=function(e){var t,n,r,s=GX(this),l=VS(e),h=YX(s,RegExp),p=VS(vj(s));return t=new h(h===RegExp?s.source:s,p),n=!!~uD(p,"g"),r=!!~uD(p,"u"),t.lastIndex=yj(s.lastIndex),new tJ(t,l,n,r)};FX({target:"String",proto:!0,forced:hD},{matchAll:function(e){var t,n,r,s,l=Ej(this);if(HX(e)){if(hD)return fw(l,e)}else{if(WX(e)&&(t=VS(Ej(vj(e))),!~uD(t,"g")))throw new eJ("`.matchAll` does not allow non-global regexes");if(hD)return fw(l,e);if((r=qX(e,QX))===void 0&&zX(e)==="RegExp"&&(r=bj),r)return _j(r,e,l)}return n=VS(l),s=new RegExp(e,"g"),_j(bj,s,n)}});var nJ=ba("String","matchAll"),iJ=W,rJ=nJ,pD=String.prototype,sJ=function(e){var t=e.matchAll;return typeof e=="string"||e===pD||iJ(pD,e)&&t===pD.matchAll?rJ:t},aJ=f(sJ);function Cj(e){function t(n,r,s,l){let h=n[l++];if(h==="__proto__")return!0;const p=Number.isFinite(+h),m=l>=n.length;return h=!h&&Xe.isArray(s)?s.length:h,m?(Xe.hasOwnProp(s,h)?s[h]=[s[h],r]:s[h]=r,!p):(s[h]&&Xe.isObject(s[h])||(s[h]=[]),t(n,r,s[h],l)&&Xe.isArray(s[h])&&(s[h]=function(g){const v={},T=Object.keys(g);let C;const I=T.length;let U;for(C=0;C<I;C++)U=T[C],v[U]=g[U];return v}(s[h])),!p)}if(Xe.isFormData(e)&&Xe.isFunction(e.entries)){const n={};return Xe.forEachEntry(e,(r,s)=>{t(function(l){return aJ(Xe).call(Xe,/\w+|\[(\w*)]/g,l).map(h=>h[0]==="[]"?"":h[1]||h[0])}(r),s,n,0)}),n}return null}const fD={transitional:$2,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,s=Xe.isObject(e);if(s&&Xe.isHTMLForm(e)&&(e=new FormData(e)),Xe.isFormData(e))return r?JSON.stringify(Cj(e)):e;if(Xe.isArrayBuffer(e)||Xe.isBuffer(e)||Xe.isStream(e)||Xe.isFile(e)||Xe.isBlob(e)||Xe.isReadableStream(e))return e;if(Xe.isArrayBufferView(e))return e.buffer;if(Xe.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(h,p){return rw(h,new oa.classes.URLSearchParams,Object.assign({visitor:function(m,g,v,T){return oa.isNode&&Xe.isBuffer(m)?(this.append(g,m.toString("base64")),!1):T.defaultVisitor.apply(this,arguments)}},p))}(e,this.formSerializer).toString();if((l=Xe.isFileList(e))||n.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return rw(l?{"files[]":e}:e,h&&new h,this.formSerializer)}}return s||r?(t.setContentType("application/json",!1),function(h,p,m){if(Xe.isString(h))try{return(p||JSON.parse)(h),_s(Xe).call(Xe,h)}catch(g){if(g.name!=="SyntaxError")throw g}return(m||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){const t=this.transitional||fD.transitional,n=t&&t.forcedJSONParsing,r=this.responseType==="json";if(Xe.isResponse(e)||Xe.isReadableStream(e))return e;if(e&&Xe.isString(e)&&(n&&!this.responseType||r)){const s=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(l){if(s)throw l.name==="SyntaxError"?Nn.from(l,Nn.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:oa.classes.FormData,Blob:oa.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Xe.forEach(["delete","get","head","post","put","patch"],e=>{fD.headers[e]={}});var mD=fD;const oJ=Xe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),wj=Symbol("internals");function FS(e){var t;return e&&_s(t=String(e)).call(t).toLowerCase()}function mw(e){return e===!1||e==null?e:Xe.isArray(e)?e.map(mw):String(e)}function _D(e,t,n,r,s){return Xe.isFunction(r)?r.call(this,t,n):(s&&(t=n),Xe.isString(t)?Xe.isString(r)?t.indexOf(r)!==-1:Xe.isRegExp(r)?r.test(t):void 0:void 0)}class _w{constructor(t){t&&this.set(t)}set(t,n,r){const s=this;function l(m,g,v){const T=FS(g);if(!T)throw new Error("header name must be a non-empty string");const C=Xe.findKey(s,T);(!C||s[C]===void 0||v===!0||v===void 0&&s[C]!==!1)&&(s[C||g]=mw(m))}const h=(m,g)=>Xe.forEach(m,(v,T)=>l(v,T,g));if(Xe.isPlainObject(t)||t instanceof this.constructor)h(t,n);else if(Xe.isString(t)&&(t=_s(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(_s(p=t).call(p)))h((m=>{const g={};let v,T,C;return m&&m.split(`
`).forEach(function(I){var U,k;C=I.indexOf(":"),v=_s(U=I.substring(0,C)).call(U).toLowerCase(),T=_s(k=I.substring(C+1)).call(k),!v||g[v]&&oJ[v]||(v==="set-cookie"?g[v]?g[v].push(T):g[v]=[T]:g[v]=g[v]?g[v]+", "+T:T)}),g})(t),n);else if(Xe.isObject(t)&&Xe.isIterable(t)){let m,g,v={};for(const T of t){if(!Xe.isArray(T))throw TypeError("Object iterator must return a key-value pair");v[g=T[0]]=(m=v[g])?Xe.isArray(m)?[...m,T[1]]:[m,T[1]]:T[1]}h(v,n)}else t!=null&&l(n,t,r);var p;return this}get(t,n){if(t=FS(t)){const r=Xe.findKey(this,t);if(r){const s=this[r];if(!n)return s;if(n===!0)return function(l){const h=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let m;for(;m=p.exec(l);)h[m[1]]=m[2];return h}(s);if(Xe.isFunction(n))return n.call(this,s,r);if(Xe.isRegExp(n))return n.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=FS(t)){const r=Xe.findKey(this,t);return!(!r||this[r]===void 0||n&&!_D(0,this[r],r,n))}return!1}delete(t,n){const r=this;let s=!1;function l(h){if(h=FS(h)){const p=Xe.findKey(r,h);!p||n&&!_D(0,r[p],p,n)||(delete r[p],s=!0)}}return Xe.isArray(t)?t.forEach(l):l(t),s}clear(t){const n=Object.keys(this);let r=n.length,s=!1;for(;r--;){const l=n[r];t&&!_D(0,this[l],l,t,!0)||(delete this[l],s=!0)}return s}normalize(t){const n=this,r={};return Xe.forEach(this,(s,l)=>{var h;const p=Xe.findKey(r,l);if(p)return n[p]=mw(s),void delete n[l];const m=t?function(g){return _s(g).call(g).toLowerCase().replace(/([a-z\d])(\w*)/g,(v,T,C)=>T.toUpperCase()+C)}(l):_s(h=String(l)).call(h);m!==l&&delete n[l],n[m]=mw(s),r[m]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return Xe.forEach(this,(r,s)=>{r!=null&&r!==!1&&(n[s]=t&&Xe.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,r]=t;return n+": "+r}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var r=arguments.length,s=new Array(r>1?r-1:0),l=1;l<r;l++)s[l-1]=arguments[l];return s.forEach(h=>n.set(h)),n}static accessor(t){const n=(this[wj]=this[wj]={accessors:{}}).accessors,r=this.prototype;function s(l){const h=FS(l);n[h]||(function(p,m){const g=Xe.toCamelCase(" "+m);["get","set","has"].forEach(v=>{Object.defineProperty(p,v+g,{value:function(T,C,I){return this[v].call(this,m,T,C,I)},configurable:!0})})}(r,l),n[h]=!0)}return Xe.isArray(t)?t.forEach(s):s(t),this}}_w.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Xe.reduceDescriptors(_w.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(s){this[r]=s}}}),Xe.freezeMethods(_w);var _l=_w;function gD(e,t){const n=this||mD,r=t||n,s=_l.from(r.headers);let l=r.data;return Xe.forEach(e,function(h){l=h.call(n,l,s.normalize(),t?t.status:void 0)}),s.normalize(),l}function Aj(e){return!(!e||!e.__CANCEL__)}function aE(e,t,n){Nn.call(this,e??"canceled",Nn.ERR_CANCELED,t,n),this.name="CanceledError"}function Ij(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new Nn("Request failed with status code "+n.status,[Nn.ERR_BAD_REQUEST,Nn.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Xe.inherits(aE,Nn,{__CANCEL__:!0});const gw=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0;const s=function(l,h){l=l||10;const p=new Array(l),m=new Array(l);let g,v=0,T=0;return h=h!==void 0?h:1e3,function(C){const I=Date.now(),U=m[T];g||(g=I),p[v]=C,m[v]=I;let k=T,M=0;for(;k!==v;)M+=p[k++],k%=l;if(v=(v+1)%l,v===T&&(T=(T+1)%l),I-g<h)return;const F=U&&I-U;return F?Math.round(1e3*M/F):void 0}}(50,250);return function(l,h){let p,m,g=0,v=1e3/h;const T=function(C){g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),p=null,m&&(clearTimeout(m),m=null),l.apply(null,C)};return[function(){const C=Date.now(),I=C-g;for(var U=arguments.length,k=new Array(U),M=0;M<U;M++)k[M]=arguments[M];I>=v?T(k,C):(p=k,m||(m=setTimeout(()=>{m=null,T(p)},v-I)))},()=>p&&T(p)]}(l=>{const h=l.loaded,p=l.lengthComputable?l.total:void 0,m=h-r,g=s(m);r=h,e({loaded:h,total:p,progress:p?h/p:void 0,bytes:m,rate:g||void 0,estimated:g&&p&&h<=p?(p-h)/g:void 0,event:l,lengthComputable:p!=null,[t?"download":"upload"]:!0})},n)},Nj=(e,t)=>{const n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},Oj=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe.asap(()=>e(...n))};var cJ=oa.hasStandardBrowserEnv?((e,t)=>n=>(n=new WC(n,oa.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new WC(oa.origin),oa.navigator&&/(msie|trident)/i.test(oa.navigator.userAgent)):()=>!0,lJ=oa.hasStandardBrowserEnv?{write(e,t,n,r,s,l){const h=[e+"="+encodeURIComponent(t)];Xe.isNumber(n)&&h.push("expires="+new Date(n).toGMTString()),Xe.isString(r)&&h.push("path="+r),Xe.isString(s)&&h.push("domain="+s),l===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Dj(e,t,n){let r=!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(t);return e&&(r||n==0)?function(s,l){return l?s.replace(/\/?\/$/,"")+"/"+l.replace(/^\/+/,""):s}(e,t):t}function Pj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}const Lj=e=>e instanceof _l?function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Pj(Object(r),!0).forEach(function(s){V(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Pj(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}({},e):e;function ym(e,t){t=t||{};const n={};function r(g,v,T,C){return Xe.isPlainObject(g)&&Xe.isPlainObject(v)?Xe.merge.call({caseless:C},g,v):Xe.isPlainObject(v)?Xe.merge({},v):Xe.isArray(v)?v.slice():v}function s(g,v,T,C){return Xe.isUndefined(v)?Xe.isUndefined(g)?void 0:r(void 0,g,0,C):r(g,v,0,C)}function l(g,v){if(!Xe.isUndefined(v))return r(void 0,v)}function h(g,v){return Xe.isUndefined(v)?Xe.isUndefined(g)?void 0:r(void 0,g):r(void 0,v)}function p(g,v,T){return T in t?r(g,v):T in e?r(void 0,g):void 0}const m={url:l,method:l,data:l,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:p,headers:(g,v,T)=>s(Lj(g),Lj(v),0,!0)};return Xe.forEach(Object.keys(Object.assign({},e,t)),function(g){const v=m[g]||s,T=v(e[g],t[g],g);Xe.isUndefined(T)&&v!==p||(n[g]=T)}),n}var kj=e=>{const t=ym({},e);let n,{data:r,withXSRFToken:s,xsrfHeaderName:l,xsrfCookieName:h,headers:p,auth:m}=t;if(t.headers=p=_l.from(p),t.url=J2(Dj(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),m&&p.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):""))),Xe.isFormData(r)){if(oa.hasStandardBrowserEnv||oa.hasStandardBrowserWebWorkerEnv)p.setContentType(void 0);else if((n=p.getContentType())!==!1){const[g,...v]=n?n.split(";").map(T=>_s(T).call(T)).filter(Boolean):[];p.setContentType([g||"multipart/form-data",...v].join("; "))}}if(oa.hasStandardBrowserEnv&&(s&&Xe.isFunction(s)&&(s=s(t)),s||s!==!1&&cJ(t.url))){const g=l&&h&&lJ.read(h);g&&p.set(l,g)}return t},dJ=typeof XMLHttpRequest<"u"&&function(e){return new Je(function(t,n){const r=kj(e);let s=r.data;const l=_l.from(r.headers).normalize();let h,p,m,g,v,{responseType:T,onUploadProgress:C,onDownloadProgress:I}=r;function U(){g&&g(),v&&v(),r.cancelToken&&r.cancelToken.unsubscribe(h),r.signal&&r.signal.removeEventListener("abort",h)}let k=new XMLHttpRequest;function M(){if(!k)return;const B=_l.from("getAllResponseHeaders"in k&&k.getAllResponseHeaders());Ij(function(ee){t(ee),U()},function(ee){n(ee),U()},{data:T&&T!=="text"&&T!=="json"?k.response:k.responseText,status:k.status,statusText:k.statusText,headers:B,config:e,request:k}),k=null}k.open(r.method.toUpperCase(),r.url,!0),k.timeout=r.timeout,"onloadend"in k?k.onloadend=M:k.onreadystatechange=function(){k&&k.readyState===4&&(k.status!==0||k.responseURL&&k.responseURL.indexOf("file:")===0)&&setTimeout(M)},k.onabort=function(){k&&(n(new Nn("Request aborted",Nn.ECONNABORTED,e,k)),k=null)},k.onerror=function(){n(new Nn("Network Error",Nn.ERR_NETWORK,e,k)),k=null},k.ontimeout=function(){let B=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const ee=r.transitional||$2;r.timeoutErrorMessage&&(B=r.timeoutErrorMessage),n(new Nn(B,ee.clarifyTimeoutError?Nn.ETIMEDOUT:Nn.ECONNABORTED,e,k)),k=null},s===void 0&&l.setContentType(null),"setRequestHeader"in k&&Xe.forEach(l.toJSON(),function(B,ee){k.setRequestHeader(ee,B)}),Xe.isUndefined(r.withCredentials)||(k.withCredentials=!!r.withCredentials),T&&T!=="json"&&(k.responseType=r.responseType),I&&([m,v]=gw(I,!0),k.addEventListener("progress",m)),C&&k.upload&&([p,g]=gw(C),k.upload.addEventListener("progress",p),k.upload.addEventListener("loadend",g)),(r.cancelToken||r.signal)&&(h=B=>{k&&(n(!B||B.type?new aE(null,e,k):B),k.abort(),k=null)},r.cancelToken&&r.cancelToken.subscribe(h),r.signal&&(r.signal.aborted?h():r.signal.addEventListener("abort",h)));const F=function(B){const ee=/^([-+\w]{1,25})(:?\/\/|:)/.exec(B);return ee&&ee[1]||""}(r.url);F&&oa.protocols.indexOf(F)===-1?n(new Nn("Unsupported protocol "+F+":",Nn.ERR_BAD_REQUEST,e)):k.send(s||null)})},uJ=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let r,s=new AbortController;const l=function(g){if(!r){r=!0,p();const v=g instanceof Error?g:this.reason;s.abort(v instanceof Nn?v:new aE(v instanceof Error?v.message:v))}};let h=t&&setTimeout(()=>{h=null,l(new Nn("timeout ".concat(t," of ms exceeded"),Nn.ETIMEDOUT))},t);const p=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(g=>{g.unsubscribe?g.unsubscribe(l):g.removeEventListener("abort",l)}),e=null)};e.forEach(g=>g.addEventListener("abort",l));const{signal:m}=s;return m.unsubscribe=()=>Xe.asap(p),m}},ED=f(am),xj=tE.f("asyncIterator"),hJ=f(xj);function yD(e,t){this.v=e,this.k=t}function Po(e){return function(){return new BS(e.apply(this,arguments))}}function BS(e){var t,n;function r(l,h){try{var p=e[l](h),m=p.value,g=m instanceof yD;ED.resolve(g?m.v:m).then(function(v){if(g){var T=l==="return"?"return":"next";if(!m.k||v.done)return r(T,v);v=e[T](v).value}s(p.done?"return":"normal",v)},function(v){r("throw",v)})}catch(v){s("throw",v)}}function s(l,h){switch(l){case"return":t.resolve({value:h,done:!0});break;case"throw":t.reject(h);break;default:t.resolve({value:h,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(l,h){return new ED(function(p,m){var g={key:l,arg:h,resolve:p,reject:m,next:null};n?n=n.next=g:(t=n=g,r(l,h))})},typeof e.return!="function"&&(this.return=void 0)}function an(e){return new yD(e,0)}function Ew(e){var t={},n=!1;function r(s,l){return n=!0,l=new ED(function(h){h(e[s](l))}),{done:!1,value:new yD(l,1)}}return t[sE!==void 0&&lj||"@@iterator"]=function(){return this},t.next=function(s){return n?(n=!1,s):r("next",s)},typeof e.throw=="function"&&(t.throw=function(s){if(n)throw n=!1,s;return r("throw",s)}),typeof e.return=="function"&&(t.return=function(s){return n?(n=!1,s):r("return",s)}),t}BS.prototype[typeof sE=="function"&&hJ||"@@asyncIterator"]=function(){return this},BS.prototype.next=function(e){return this._invoke("next",e)},BS.prototype.throw=function(e){return this._invoke("throw",e)},BS.prototype.return=function(e){return this._invoke("return",e)};var vD=f(xj);function SD(e){var t,n,r,s=2;for(typeof Symbol<"u"&&(n=vD,r=Symbol.iterator);s--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new yw(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function yw(e){function t(n){if(Object(n)!==n)return Je.reject(new TypeError(n+" is not an object."));var r=n.done;return Je.resolve(n.value).then(function(s){return{value:s,done:r}})}return yw=function(n){this.s=n,this.n=n.next},yw.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?Je.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?Je.reject(n):t(r.apply(this.s,arguments))}},new yw(e)}const pJ=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,s=0;for(;s<n;)r=s+t,yield e.slice(s,r),s=r},fJ=function(){var e=Po(function*(t,n){var r,s=!1,l=!1;try{for(var h,p=SD(mJ(t));s=!(h=yield an(p.next())).done;s=!1){const m=h.value;yield*Ew(SD(pJ(m,n)))}}catch(m){l=!0,r=m}finally{try{s&&p.return!=null&&(yield an(p.return()))}finally{if(l)throw r}}});return function(t,n){return e.apply(this,arguments)}}(),mJ=function(){var e=Po(function*(t){if(t[vD])return void(yield*Ew(SD(t)));const n=t.getReader();try{for(;;){const{done:r,value:s}=yield an(n.read());if(r)break;yield s}}finally{yield an(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),Mj=(e,t,n,r)=>{const s=fJ(e,t);let l,h=0,p=m=>{l||(l=!0,r&&r(m))};return new ReadableStream({async pull(m){try{const{done:g,value:v}=await s.next();if(g)return p(),void m.close();let T=v.byteLength;if(n){let C=h+=T;n(C)}m.enqueue(new Uint8Array(v))}catch(g){throw p(g),g}},cancel:m=>(p(m),s.return())},{highWaterMark:2})};function Uj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function jj(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Uj(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Uj(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const vw=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Vj=vw&&typeof ReadableStream=="function",_J=vw&&(typeof TextEncoder=="function"?(Fj=new TextEncoder,e=>Fj.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var Fj;const Bj=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch{return!1}},gJ=Vj&&Bj(()=>{let e=!1;const t=new Request(oa.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),TD=Vj&&Bj(()=>Xe.isReadableStream(new Response("").body)),Sw={stream:TD&&(e=>e.body)};var Gj;vw&&(Gj=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Sw[e]&&(Sw[e]=Xe.isFunction(Gj[e])?t=>t[e]():(t,n)=>{throw new Nn("Response type '".concat(e,"' is not supported"),Nn.ERR_NOT_SUPPORT,n)})}));const EJ=async(e,t)=>{const n=Xe.toFiniteNumber(e.getContentLength());return n??(async r=>r==null?0:Xe.isBlob(r)?r.size:Xe.isSpecCompliantForm(r)?(await new Request(oa.origin,{method:"POST",body:r}).arrayBuffer()).byteLength:Xe.isArrayBufferView(r)||Xe.isArrayBuffer(r)?r.byteLength:(Xe.isURLSearchParams(r)&&(r+=""),Xe.isString(r)?(await _J(r)).byteLength:void 0))(t)};var yJ=vw&&(async e=>{let{url:t,method:n,data:r,signal:s,cancelToken:l,timeout:h,onDownloadProgress:p,onUploadProgress:m,responseType:g,headers:v,withCredentials:T="same-origin",fetchOptions:C}=kj(e);g=g?(g+"").toLowerCase():"text";let I,U=uJ([s,l&&l.toAbortSignal()],h);const k=U&&U.unsubscribe&&(()=>{U.unsubscribe()});let M;try{if(m&&gJ&&n!=="get"&&n!=="head"&&(M=await EJ(v,r))!==0){let de,ae=new Request(t,{method:"POST",body:r,duplex:"half"});if(Xe.isFormData(r)&&(de=ae.headers.get("content-type"))&&v.setContentType(de),ae.body){const[Te,Ae]=Nj(M,gw(Oj(m)));r=Mj(ae.body,65536,Te,Ae)}}Xe.isString(T)||(T=T?"include":"omit");const F="credentials"in Request.prototype;I=new Request(t,jj(jj({},C),{},{signal:U,method:n.toUpperCase(),headers:v.normalize().toJSON(),body:r,duplex:"half",credentials:F?T:void 0}));let B=await fetch(I);const ee=TD&&(g==="stream"||g==="response");if(TD&&(p||ee&&k)){const de={};["status","statusText","headers"].forEach(We=>{de[We]=B[We]});const ae=Xe.toFiniteNumber(B.headers.get("content-length")),[Te,Ae]=p&&Nj(ae,gw(Oj(p),!0))||[];B=new Response(Mj(B.body,65536,Te,()=>{Ae&&Ae(),k&&k()}),de)}g=g||"text";let ue=await Sw[Xe.findKey(Sw,g)||"text"](B,e);return!ee&&k&&k(),await new Je((de,ae)=>{Ij(de,ae,{data:ue,headers:_l.from(B.headers),status:B.status,statusText:B.statusText,config:e,request:I})})}catch(F){throw k&&k(),F&&F.name==="TypeError"&&/Load failed|fetch/i.test(F.message)?Object.assign(new Nn("Network Error",Nn.ERR_NETWORK,e,I),{cause:F.cause||F}):Nn.from(F,F&&F.code,e,I)}});const RD={http:null,xhr:dJ,fetch:yJ};Xe.forEach(RD,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const Hj=e=>"- ".concat(e),vJ=e=>Xe.isFunction(e)||e===null||e===!1;var zj={getAdapter:e=>{e=Xe.isArray(e)?e:[e];const{length:t}=e;let n,r;const s={};for(let l=0;l<t;l++){let h;if(n=e[l],r=n,!vJ(n)&&(r=RD[(h=String(n)).toLowerCase()],r===void 0))throw new Nn("Unknown adapter '".concat(h,"'"));if(r)break;s[h||"#"+l]=r}if(!r){const l=Object.entries(s).map(h=>{let[p,m]=h;return"adapter ".concat(p," ")+(m===!1?"is not supported by the environment":"is not available in the build")});throw new Nn("There is no suitable adapter to dispatch the request "+(t?l.length>1?`since :
`+l.map(Hj).join(`
`):" "+Hj(l[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:RD};function bD(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new aE(null,e)}function Wj(e){return bD(e),e.headers=_l.from(e.headers),e.data=gD.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),zj.getAdapter(e.adapter||mD.adapter)(e).then(function(t){return bD(e),t.data=gD.call(e,e.transformResponse,t),t.headers=_l.from(t.headers),t},function(t){return Aj(t)||(bD(e),t&&t.response&&(t.response.data=gD.call(e,e.transformResponse,t.response),t.response.headers=_l.from(t.response.headers))),Je.reject(t)})}const qj="1.9.0",Tw={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Tw[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const Kj={};Tw.transitional=function(e,t,n){function r(s,l){return"[Axios v"+qj+"] Transitional option '"+s+"'"+l+(n?". "+n:"")}return(s,l,h)=>{if(e===!1)throw new Nn(r(l," has been removed"+(t?" in "+t:"")),Nn.ERR_DEPRECATED);return t&&!Kj[l]&&(Kj[l]=!0,console.warn(r(l," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(s,l,h)}},Tw.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var Rw={assertOptions:function(e,t,n){if(typeof e!="object")throw new Nn("options must be an object",Nn.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let s=r.length;for(;s-- >0;){const l=r[s],h=t[l];if(h){const p=e[l],m=p===void 0||h(p,l,e);if(m!==!0)throw new Nn("option "+l+" must be "+m,Nn.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Nn("Unknown option "+l,Nn.ERR_BAD_OPTION)}},validators:Tw};const Ed=Rw.validators;let bw=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Q2,response:new Q2}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const s=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=ym(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:s}=t;n!==void 0&&Rw.assertOptions(n,{silentJSONParsing:Ed.transitional(Ed.boolean),forcedJSONParsing:Ed.transitional(Ed.boolean),clarifyTimeoutError:Ed.transitional(Ed.boolean)},!1),r!=null&&(Xe.isFunction(r)?t.paramsSerializer={serialize:r}:Rw.assertOptions(r,{encode:Ed.function,serialize:Ed.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Rw.assertOptions(t,{baseUrl:Ed.spelling("baseURL"),withXsrfToken:Ed.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let l=s&&Xe.merge(s.common,s[t.method]);s&&Xe.forEach(["delete","get","head","post","put","patch","common"],I=>{delete s[I]}),t.headers=_l.concat(l,s);const h=[];let p=!0;this.interceptors.request.forEach(function(I){typeof I.runWhen=="function"&&I.runWhen(t)===!1||(p=p&&I.synchronous,h.unshift(I.fulfilled,I.rejected))});const m=[];let g;this.interceptors.response.forEach(function(I){m.push(I.fulfilled,I.rejected)});let v,T=0;if(!p){const I=[Wj.bind(this),void 0];for(I.unshift.apply(I,h),I.push.apply(I,m),v=I.length,g=Je.resolve(t);T<v;)g=g.then(I[T++],I[T++]);return g}v=h.length;let C=t;for(T=0;T<v;){const I=h[T++],U=h[T++];try{C=I(C)}catch(k){U.call(this,k);break}}try{g=Wj.call(this,C)}catch(I){return Je.reject(I)}for(T=0,v=m.length;T<v;)g=g.then(m[T++],m[T++]);return g}getUri(e){return J2(Dj((e=ym(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Xe.forEach(["delete","get","head","options"],function(e){bw.prototype[e]=function(t,n){return this.request(ym(n||{},{method:e,url:t,data:(n||{}).data}))}}),Xe.forEach(["post","put","patch"],function(e){function t(n){return function(r,s,l){return this.request(ym(l||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:s}))}}bw.prototype[e]=t(),bw.prototype[e+"Form"]=t(!0)});var Cw=bw;class CD{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Je(function(s){n=s});const r=this;this.promise.then(s=>{if(!r._listeners)return;let l=r._listeners.length;for(;l-- >0;)r._listeners[l](s);r._listeners=null}),this.promise.then=s=>{let l;const h=new Je(p=>{r.subscribe(p),l=p}).then(s);return h.cancel=function(){r.unsubscribe(l)},h},t(function(s,l,h){r.reason||(r.reason=new aE(s,l,h),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=r=>{t.abort(r)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new CD(function(r){t=r}),cancel:t}}}var SJ=CD;const wD={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(wD).forEach(e=>{let[t,n]=e;wD[n]=t});var TJ=wD;const cs=function e(t){const n=new Cw(t),r=L2(Cw.prototype.request,n);return Xe.extend(r,Cw.prototype,n,{allOwnKeys:!0}),Xe.extend(r,n,null,{allOwnKeys:!0}),r.create=function(s){return e(ym(t,s))},r}(mD);cs.Axios=Cw,cs.CanceledError=aE,cs.CancelToken=SJ,cs.isCancel=Aj,cs.VERSION=qj,cs.toFormData=rw,cs.AxiosError=Nn,cs.Cancel=cs.CanceledError,cs.all=function(e){return Je.all(e)},cs.spread=function(e){return function(t){return e.apply(null,t)}},cs.isAxiosError=function(e){return Xe.isObject(e)&&e.isAxiosError===!0},cs.mergeConfig=ym,cs.AxiosHeaders=_l,cs.formToJSON=e=>Cj(Xe.isHTMLForm(e)?new FormData(e):e),cs.getAdapter=zj.getAdapter,cs.HttpStatusCode=TJ,cs.default=cs;var Bs=cs;const RJ=()=>{};function GS(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:RJ};return e.promise=new Je((t,n)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(r))}}),e}const ww=new Map,Aw=new Map,yd=new Map;let ir=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),mn=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const Yj=new ZK;let gl=Yj.getResult(),AD=null;function on(e){if(!AD){gl=Yj.getResult();const t=function(p){if(p.engine.name==="Blink"&&p.browser.name!=="WeChat")return mn.CHROME;switch(p.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return mn.CHROME;case"Safari":case"Mobile Safari":return mn.SAFARI;case"Edge":return mn.EDGE;case"Firefox":return mn.FIREFOX;case"QQ":case"QQBrowser":return mn.QQ;case"Opera":return mn.OPERA;case"WeChat":return mn.WECHAT;default:return p.browser.name||""}}(gl),n=Xj(gl),r=function(p){return p.os.name==="Windows"?p.os.version?p.os.name+" "+p.os.version:p.os.name:p.os.name||""}(gl),s=gl.os.version,l=Xj(gl,!1),h=gl.device.type;if(!(t&&n&&r&&s))return{name:t,version:n,os:r,osVersion:s,browserVersion:l,deviceType:h};AD={name:t,version:n,os:r,osVersion:s,browserVersion:l,deviceType:h}}return AD}function Xj(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function Iw(){return on().os}function Jj(){const e=on();return"".concat(e.os," ").concat(e.osVersion)}function Nw(){const e=on();return!!(gl.engine.name==="WebKit"&&e.os===ir.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==mn.SAFARI||As()&&e.name!==mn.SAFARI)}function xu(){return on().name===mn.CHROME}function Dr(){return on().name===mn.SAFARI}function Qj(){return on().name===mn.EDGE}function _i(){return on().name===mn.FIREFOX}function As(){return on().os===ir.IOS}function HS(e){const t=on();return!(t.name!==mn.CHROME||!t.osVersion)&&Number(t.version)>=e}function $j(e){const t=on();return!(t.name!==mn.CHROME||!t.osVersion)&&Number(t.version)<e}function ID(e,t,n){const r=on();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}function ND(e){const t=on();return!(t.name!==mn.EDGE||!t.osVersion)&&Number(t.version)>=e}function Zj(e){const t=on();return!(t.name!==mn.SAFARI||!t.osVersion)&&Number(t.version)>=e}function eV(e,t,n){const r=on();if(r.os!==ir.IOS||!r.osVersion)return!1;const s=r.osVersion.split(".");return t&&Number(s[0])===e&&Number(s[1])<t||Number(s[0])<e}function tV(e,t,n){const r=on();if(r.name!==mn.SAFARI||!r.osVersion||!r.browserVersion)return!1;const s=r.browserVersion.split(".");return n?t&&Number(s[0])===e&&Number(s[1])<t||Number(s[0])<e:t?Number(s[0])===e&&Number(s[1])<=t||Number(s[0])<e:Number(s[0])<=e}function OD(e){const t=on();return!(t.name!==mn.OPERA||!t.osVersion)&&Number(t.version)>=e}function nV(){const e=on();if(e.os!==ir.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function oE(){const e=on();if(e.os!==ir.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function DD(){const e=on();if(e.os!==ir.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function iV(){const e=on();if(e.os!==ir.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Rc(){return Dr()&&navigator.maxTouchPoints>0}function rV(){return on().name===mn.WECHAT}function sV(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function PD(){const e=Iw();return function(){const{deviceType:t}=on();return t==="mobile"||t==="tablet"}()||e===ir.ANDROID||e===ir.IOS||e===ir.HARMONY_OS}function Mu(){const e=on();return e.name!==mn.EDGE&&e.name!==mn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Ow(){return Iw()===ir.ANDROID}function zS(){const e=on();return Ow()&&(e.name===mn.CHROME||e.name===mn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Ot(e,t,n){return(t=function(r){var s=function(l,h){if(typeof l!="object"||!l)return l;var p=l[Symbol.toPrimitive];if(p!==void 0){var m=p.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(r);return typeof s=="symbol"?s:s+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function aV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function at(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?aV(Object(n),!0).forEach(function(r){Ot(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let H=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Re=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),Ot(this,"code",void 0),Ot(this,"message",void 0),Ot(this,"data",void 0),Ot(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Uu(e,t){if(typeof e!="boolean")throw new Re(H.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function er(e,t,n){if(!Ye(n).call(n,e))throw new Re(H.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function On(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(s){return typeof s=="number"&&s%1==0}(e))throw new Re(H.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function LD(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Re(H.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&On(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&On(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&On(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&On(e.ideal,"".concat(t,".ideal"),1,1/0)}else On(e,t,1,1/0)}function Sr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Re(H.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!oV(e,n,r,s))throw new Re(H.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(s?" ASCII characters only.":""))}function ju(e,t){if(!Array.isArray(e))throw new Re(H.INVALID_PARAMS,"".concat(t," should be an array"))}function gi(e){return e==null}function oV(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!r||function(s){if(typeof s!="string")return!1;for(let l=0;l<s.length;l+=1){const h=s.charCodeAt(l);if(h<0||h>255)return!1}return!0}(e))}var WS=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(WS||{}),kD=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(kD||{});const cV=new class{constructor(){Ot(this,"_clientSize",null),Ot(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Ot(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Ot(this,"getStyle",e=>window.getComputedStyle(e,null)),Ot(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const r=this.getStyle(e),{display:s,visibility:l,opacity:h,filter:p}=r;return(s==="none"||Ye(t=["hidden","collapse"]).call(t,l)||Number(h)<.1)&&(n=!1),!!n&&(p&&p.split(" ").filter(m=>{var g;const v=m.split("(")[0];return Ye(g=["brightness","blur","opacity"]).call(g,v)}).map(m=>{const[g,v]=m.split(/\(|\)/);return[g,Number(v.match(/^[0-9\.]+/))]}).forEach(m=>{const[g,v]=m;switch(g){case"brightness":(v<.1||v>3)&&(n=!1);break;case"blur":v>3&&(n=!1);break;case"opacity":v<.1&&(n=!1)}}),n)}),Ot(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,r=!0;const s=h=>t(h);let l=e;for(;l&&r;)s(l)||(n=!1,r=!1),l=l.parentElement,l||(r=!1);return n}),Ot(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Ot(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:r,right:s,top:l,bottom:h}=e.getBoundingClientRect(),p=this.getClientWidth(),m=this.getClientHeight();return{width:t,height:n,left:r,right:s,top:l,bottom:h,clientWidth:p,clientHeight:m,clientMin:Math.min(p,m)}}),Ot(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),Ot(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),Ot(this,"checkCoverForAPoint",(e,t,n)=>{const r=this.elementFromPoint(e,t);return r!==null&&r!==n}),Ot(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,s=e/6,l=t/6,h=[],p=10**6;for(let m=0;m<5;m++)for(let g=0;g<5;g++){const v=(n*p+(m===0?.1:m===4?(s*m*p-1e5)/p:s*m)*p)/p,T=(r*p+(g===0?.1:g===4?(l*g*p-1e5)/p:l*g)*p)/p;h.push({x:v,y:T})}return[...h]}),Ot(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),Ot(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),Ot(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:s,clientWidth:l,clientMin:h}=this._clientSize;let p,m,g,v;if(e<0)p=0;else{if(!(e<l))return!1;p=e}if(t<0)return!1;if(m=t<l?t:l,n<0)g=0;else{if(!(n<s))return!1;g=n}if(r<0)return!1;v=r<s?r:s;const T=m-p,C=v-g;return this.checkSizeIsVisible(T,C,h)}),Ot(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Ot(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(WS.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(WS.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(WS.SIZE)}}return this.returnHiddenResult(WS.STYLE)}return this.returnHiddenResult(kD.UNMOUNTED)}return this.returnHiddenResult(kD.INVALID_HTML_ELEMENT)}),Ot(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function xD(e){return new TextEncoder().encode(e)}const lV=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},MD=async e=>function(t,n){let r="";return new Uint8Array(t).forEach(s=>{r+=s.toString(n).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",xD(e)),16);let ai=class{constructor(){Ot(this,"_events",{}),Ot(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],r=this._indexOfListener(n,t);r!==-1&&n.splice(r,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(l=>l);for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];for(let l=0;l<t.length;l+=1){const h=t[l];h.once&&this.off(e,h.listener),h.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach(s=>{s.once&&this.off(e,s.listener);try{s.listener.apply(this,n)}catch(l){console.error("safeEmit event:".concat(e," error ").concat(l==null?void 0:l.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},qS=null;function dV(){if(qS)return qS;if(window.electron)return qS=window.electron;if(!window.require)return null;try{return qS=window.require("electron"),qS}catch{return null}}let Mi=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),Ei=function(e){return e.TRACER="tracer",e}({});function uV(e){return On(e.timeout,"config.timeout",0,1e5),On(e.timeoutFactor,"config.timeoutFactor",0,100,!1),On(e.maxRetryCount,"config.maxRetryConfig",0,1/0),On(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let bJ=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),En=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function KS(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function hV(e){return Sr(e.turnServerURL,"turnServerURL"),Sr(e.username,"username"),Sr(e.password,"password"),e.udpport&&On(e.udpport,"udpport",1,99999,!0),e.forceturn&&Uu(e.forceturn,"forceturn"),e.security&&Uu(e.security,"security"),e.tcpport&&On(e.tcpport,"tcpport",1,99999,!0),!0}function UD(e){return e.level!==void 0&&er(e.level,"level",[1,2,3]),e.delay!==void 0&&On(e.delay,"delay",0,3e3,!0),!0}let qt=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Pr=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),ka=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),cE=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Lr(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];return e.getListeners(t).length===0?Je.reject(new Re(H.UNEXPECTED_ERROR,"can not emit promise")):new Je((l,h)=>{e.emit(t,...r,l,h)})}function Mn(e,t){if(e.getListeners(t).length===0)return Je.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];return Lr(e,t,...r)}function eo(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];return YS(e,t,...r)}function YS(e,t){let n=null,r=null;for(var s=arguments.length,l=new Array(s>2?s-2:0),h=2;h<s;h++)l[h-2]=arguments[h];if(e.emit(t,...l,p=>{n=p},p=>{r=p}),r!==null)throw r;if(n===null)throw new Re(H.UNEXPECTED_ERROR,"handler is not sync");return n}const Ui=new class extends ai{set networkState(e){this.emit(cE.NETWORK_STATE_CHANGE,e,this._networkState),e===ka.ONLINE?this.emit(cE.ONLINE):e===ka.OFFLINE&&(this.onlineWaiter=new Je(t=>{this.once(cE.ONLINE,()=>{this.onlineWaiter=void 0,t(ka.ONLINE)})}),this.emit(cE.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===ka.ONLINE}constructor(){super(),Ot(this,"_moduleName","network-indicator"),Ot(this,"_networkState",ka.ONLINE),Ot(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=ka.ONLINE}),window.addEventListener("offline",()=>{this.networkState=ka.OFFLINE})}};function Dw(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function lE(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function Pw(e){Je!==void 0?Je.resolve().then(e):setTimeout(e,0)}function oi(e){return JSON.parse(JSON.stringify(e))}function vm(e){try{return oi(e)}catch{return e}}const pV={};function dp(e,t){pV[t]||(pV[t]=!0,e())}function Sm(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function up(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function fV(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const r=new Uint8Array(t);r.set(n),n=r}return n}function mV(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=na(t).call(t,(h,p)=>h+p.length,0),s=new Uint8Array(new ArrayBuffer(r));let l=0;return t.forEach(h=>{s.set(h,l),l+=h.length}),s}function vd(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function _V(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?vd(n):n.size}),t+138}function CJ(e){const t=new Re(H.TIMEOUT,"timeout");return new Je((n,r)=>{window.setTimeout(()=>r(t),e)})}function Tr(e){return new Je(t=>{window.setTimeout(t,e)})}function Bn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+Bn(e-n.length,"")}function Tm(){return Bn(32,"").toUpperCase()}const Lw=()=>{},gV=new class{constructor(){Ot(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var s=arguments.length,l=new Array(s>4?s-4:0),h=4;h<s;h++)l[h-4]=arguments[h];if(this.fnMap.has(t)){const p=this.fnMap.get(t);if(p.threshold!==n){p.fn(...p.args),clearTimeout(p.timer);const m=window.setTimeout(()=>{const g=this.fnMap.get(t);g&&g.fn(...g.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:m,args:l,skipFn:r})}else p.skipFn&&p.skipFn(...p.args),this.fnMap.set(t,at(at({},p),{},{fn:e,args:l,skipFn:r}))}else{const p=window.setTimeout(()=>{const m=this.fnMap.get(t);m&&m.fn(...m.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:p,args:l,skipFn:r})}}},EV=gV.throttleByKey.bind(gV);function yV(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function jD(e,t){if(!yV(e)||!yV(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=jD(e[r],t[r]);return n}{const n=at({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=jD(e[r],t[r]):n[r]=t[r]);return n}}function vV(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,r!==t););return n}function VD(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function FD(e){return na(e).call(e,(t,n)=>t+n,0)}function SV(e){const t="0123456789abcdef";function n(ee){let ue,de="";for(ue=0;ue<=3;ue++)de+=t.charAt(ee>>8*ue+4&15)+t.charAt(ee>>8*ue&15);return de}function r(ee,ue){const de=(65535&ee)+(65535&ue);return(ee>>16)+(ue>>16)+(de>>16)<<16|65535&de}function s(ee,ue,de,ae,Te,Ae){return r(function(We,tt){return We<<tt|We>>>32-tt}(r(r(ue,ee),r(ae,Ae)),Te),de)}function l(ee,ue,de,ae,Te,Ae,We){return s(ue&de|~ue&ae,ee,ue,Te,Ae,We)}function h(ee,ue,de,ae,Te,Ae,We){return s(ue&ae|de&~ae,ee,ue,Te,Ae,We)}function p(ee,ue,de,ae,Te,Ae,We){return s(ue^de^ae,ee,ue,Te,Ae,We)}function m(ee,ue,de,ae,Te,Ae,We){return s(de^(ue|~ae),ee,ue,Te,Ae,We)}const g=function(ee){let ue;const de=1+(ee.length+8>>6),ae=new Array(16*de);for(ue=0;ue<16*de;ue++)ae[ue]=0;for(ue=0;ue<ee.length;ue++)ae[ue>>2]|=ee.charCodeAt(ue)<<ue%4*8;return ae[ue>>2]|=128<<ue%4*8,ae[16*de-2]=8*ee.length,ae}(e);let v,T,C,I,U,k=1732584193,M=-271733879,F=-1732584194,B=271733878;for(v=0;v<g.length;v+=16)T=k,C=M,I=F,U=B,k=l(k,M,F,B,g[v+0],7,-680876936),B=l(B,k,M,F,g[v+1],12,-389564586),F=l(F,B,k,M,g[v+2],17,606105819),M=l(M,F,B,k,g[v+3],22,-1044525330),k=l(k,M,F,B,g[v+4],7,-176418897),B=l(B,k,M,F,g[v+5],12,1200080426),F=l(F,B,k,M,g[v+6],17,-1473231341),M=l(M,F,B,k,g[v+7],22,-45705983),k=l(k,M,F,B,g[v+8],7,1770035416),B=l(B,k,M,F,g[v+9],12,-1958414417),F=l(F,B,k,M,g[v+10],17,-42063),M=l(M,F,B,k,g[v+11],22,-1990404162),k=l(k,M,F,B,g[v+12],7,1804603682),B=l(B,k,M,F,g[v+13],12,-40341101),F=l(F,B,k,M,g[v+14],17,-1502002290),M=l(M,F,B,k,g[v+15],22,1236535329),k=h(k,M,F,B,g[v+1],5,-165796510),B=h(B,k,M,F,g[v+6],9,-1069501632),F=h(F,B,k,M,g[v+11],14,643717713),M=h(M,F,B,k,g[v+0],20,-373897302),k=h(k,M,F,B,g[v+5],5,-701558691),B=h(B,k,M,F,g[v+10],9,38016083),F=h(F,B,k,M,g[v+15],14,-660478335),M=h(M,F,B,k,g[v+4],20,-405537848),k=h(k,M,F,B,g[v+9],5,568446438),B=h(B,k,M,F,g[v+14],9,-1019803690),F=h(F,B,k,M,g[v+3],14,-187363961),M=h(M,F,B,k,g[v+8],20,1163531501),k=h(k,M,F,B,g[v+13],5,-1444681467),B=h(B,k,M,F,g[v+2],9,-51403784),F=h(F,B,k,M,g[v+7],14,1735328473),M=h(M,F,B,k,g[v+12],20,-1926607734),k=p(k,M,F,B,g[v+5],4,-378558),B=p(B,k,M,F,g[v+8],11,-2022574463),F=p(F,B,k,M,g[v+11],16,1839030562),M=p(M,F,B,k,g[v+14],23,-35309556),k=p(k,M,F,B,g[v+1],4,-1530992060),B=p(B,k,M,F,g[v+4],11,1272893353),F=p(F,B,k,M,g[v+7],16,-155497632),M=p(M,F,B,k,g[v+10],23,-1094730640),k=p(k,M,F,B,g[v+13],4,681279174),B=p(B,k,M,F,g[v+0],11,-358537222),F=p(F,B,k,M,g[v+3],16,-722521979),M=p(M,F,B,k,g[v+6],23,76029189),k=p(k,M,F,B,g[v+9],4,-640364487),B=p(B,k,M,F,g[v+12],11,-421815835),F=p(F,B,k,M,g[v+15],16,530742520),M=p(M,F,B,k,g[v+2],23,-995338651),k=m(k,M,F,B,g[v+0],6,-198630844),B=m(B,k,M,F,g[v+7],10,1126891415),F=m(F,B,k,M,g[v+14],15,-1416354905),M=m(M,F,B,k,g[v+5],21,-57434055),k=m(k,M,F,B,g[v+12],6,1700485571),B=m(B,k,M,F,g[v+3],10,-1894986606),F=m(F,B,k,M,g[v+10],15,-1051523),M=m(M,F,B,k,g[v+1],21,-2054922799),k=m(k,M,F,B,g[v+8],6,1873313359),B=m(B,k,M,F,g[v+15],10,-30611744),F=m(F,B,k,M,g[v+6],15,-1560198380),M=m(M,F,B,k,g[v+13],21,1309151649),k=m(k,M,F,B,g[v+4],6,-145523070),B=m(B,k,M,F,g[v+11],10,-1120210379),F=m(F,B,k,M,g[v+2],15,718787259),M=m(M,F,B,k,g[v+9],21,-343485551),k=r(k,T),M=r(M,C),F=r(F,I),B=r(B,U);return n(k)+n(M)+n(F)+n(B)}let wJ=1,TV=console,Wr=class{static setLogger(e){TV=e}constructor(e,t){Ot(this,"id",void 0),Ot(this,"lockingPromise",Je.resolve()),Ot(this,"locks",0),Ot(this,"name",""),Ot(this,"lockId",void 0),this.lockId=wJ++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");TV.debug("".concat(n," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new Je(s=>{t=()=>{this.locks-=1,this.logger("unlocked",e),s()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),r}};function dE(e,t){return function(n,r,s){const l=s.value;if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const h=this[t];if(!h)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const p=await h.lock("From ".concat(e,".").concat(r));try{for(var m=arguments.length,g=new Array(m),v=0;v<m;v++)g[v]=arguments[v];return await l.apply(this,g)}finally{p()}},s}}const Gi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function BD(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function El(e,t,n,r){const s=Object.assign({},Gi,r);let l=s.timeout;const h=async()=>{await function(g){return new Je(v=>{window.setTimeout(v,g)})}(l),l*=s.timeoutFactor,l=Math.min(s.maxRetryTimeout,l)};let p=!1;const m=new Je(async(g,v)=>{t=t||(()=>!1),n=n||(()=>!0);for(let T=0;T<s.maxRetryCount;T+=1){if(p)return v(new Re(H.OPERATION_ABORTED));try{const C=await e();if(!t(C,T)||T+1===s.maxRetryCount)return g(C);await h()}catch(C){if(!n(C,T)||T+1===s.maxRetryCount)return v(C);await h()}}});return m.cancel=()=>p=!0,m}let kw,RV=class{constructor(e){Ot(this,"input",[]),Ot(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:na(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},xw=0,GD=0;function HD(e,t,n,r){return new Je((s,l)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),xw+=vd(t.data)):n&&(t.data.size?xw+=t.data.size:t.data instanceof FormData?xw+=_V(t.data):xw+=vd(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Bs.request(t).then(h=>{typeof h.data=="string"?GD+=vd(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?GD+=h.data.byteLength:GD+=vd(JSON.stringify(h.data)),s(h.data)}).catch(h=>{Bs.isCancel(h)?l(new Re(H.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?l(new Re(H.NETWORK_TIMEOUT,h.message)):h.response?l(new Re(H.NETWORK_RESPONSE_ERROR,h.response.status)):l(new Re(H.NETWORK_ERROR,h.message))})})}async function AJ(e,t){const n=new Blob([t.data],{type:"buffer"});return await HD(e,at(at({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const bV=()=>window.isSecureContext!==void 0;function bc(e){if(Array.isArray(e))return e.map(n=>n);if(!CV(e))return e;const t={};for(const n in e){const r=e[n];CV(r)||Array.isArray(r)?t[n]=bc(r):t[n]=r}return t}function CV(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let zD=class{constructor(e){Ot(this,"input",[]),Ot(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Sd={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},XS={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Sd,remoteCandidate:Sd},updateInterval:0},wV={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},AV={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},IV={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},NV={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let WD=class{constructor(e,t){Ot(this,"onFirstVideoReceived",void 0),Ot(this,"onFirstVideoDecoded",void 0),Ot(this,"onFirstAudioReceived",void 0),Ot(this,"onFirstVideoDecodedTimeout",void 0),Ot(this,"onFirstAudioDecoded",void 0),Ot(this,"onSelectedLocalCandidateChanged",void 0),Ot(this,"onSelectedRemoteCandidateChanged",void 0),Ot(this,"videoIsReady",!1),Ot(this,"videoIsReady2",{}),Ot(this,"pc",void 0),Ot(this,"options",void 0),Ot(this,"intervalTimer",void 0),Ot(this,"stats",bc(XS)),Ot(this,"isFirstVideoReceived",{}),Ot(this,"isFirstVideoDecoded",{}),Ot(this,"isFirstAudioReceived",{}),Ot(this,"isFirstAudioDecoded",{}),Ot(this,"isFirstVideoDecodedTimeout",{}),Ot(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Je(e=>{e({local:at({},Sd),remote:at({},Sd)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,s=0,l=0,h=0;for(const p of n)e[p].forEach((m,g)=>{if(!this.lossRateWindowStats[t-1][p][g]||!this.lossRateWindowStats[0][p][g])return;const v=this.lossRateWindowStats[t-1][p][g].packets-this.lossRateWindowStats[0][p][g].packets,T=this.lossRateWindowStats[t-1][p][g].packetsLost-this.lossRateWindowStats[0][p][g].packetsLost;p==="videoSend"||p==="audioSend"?(r+=v,l+=T):(s+=v,h+=T),Number.isNaN(v)||Number.isNaN(v)?m.packetLostRate=0:m.packetLostRate=v<=0||T<=0?0:T/(v+T)});e.sendPacketLossRate=r<=0||l<=0?0:l/(r+l),e.recvPacketLossRate=s<=0||h<=0?0:h/(s+h)}},IJ=class extends WD{constructor(){super(...arguments),Ot(this,"_stats",XS),Ot(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=bc(XS);const n=t.filter(s=>s.type==="ssrc");this.processSSRCStats(n);const r=t.find(s=>s.type==="VideoBwe");r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;const r=Ye(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(r?"send":"recv")){case"video_send":{const s=bc(AV);s.codec=t.googCodecName,s.adaptionChangeReason="none",t.googCpuLimitedResolution&&(s.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(s.adaptionChangeReason="bandwidth"),s.avgEncodeMs=Number(t.googAvgEncodeMs),s.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},s.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},s.firsCount=Number(t.googFirReceived),s.nacksCount=Number(t.googNacksReceived),s.plisCount=Number(t.googPlisReceived),s.frameCount=Number(t.framesEncoded),s.bytes=Number(t.bytesSent),s.packets=Number(t.packetsSent),s.packetsLost=Number(t.packetsLost),s.ssrc=Number(t.ssrc),s.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(s),this._stats.rtt=s.rttMs;break}case"video_recv":{const s=bc(wV),l=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(s.codec=t.googCodecName,s.targetDelayMs=Number(t.googTargetDelayMs),s.renderDelayMs=Number(t.googRenderDelayMs),s.currentDelayMs=Number(t.googCurrentDelayMs),s.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),s.decodeMs=Number(t.googDecodeMs),s.maxDecodeMs=Number(t.googMaxDecodeMs),s.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},s.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},s.decodeFrameRate=Number(t.googFrameRateDecoded),s.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},s.jitterBufferMs=Number(t.googJitterBufferMs),s.firsCount=Number(t.googFirsSent),s.nacksCount=Number(t.googNacksSent),s.plisCount=Number(t.googPlisSent),s.framesDecodeCount=Number(t.framesDecoded),s.bytes=Number(t.bytesReceived),s.packets=Number(t.packetsReceived),s.packetsLost=Number(t.packetsLost),s.ssrc=Number(t.ssrc),s.packets>0&&!this.isFirstVideoReceived[s.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(s.ssrc),this.isFirstVideoReceived[s.ssrc]=!0),s.framesDecodeCount>0&&!this.isFirstVideoDecoded[s.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(s.ssrc,s.decodedFrame.width,s.decodedFrame.height),this.isFirstVideoDecoded[s.ssrc]=!0),l){const h=l.stats,p=Date.now()-l.lts;s.framesDecodeFreezeTime=h.framesDecodeFreezeTime,s.framesDecodeInterval=h.framesDecodeInterval,s.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[s.ssrc]?(l.lts=Date.now(),s.framesDecodeInterval=p,s.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?s.framesDecodeFreezeTime+=s.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):s.framesDecodeCount<l.stats.framesDecodeCount&&(s.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(s.ssrc,{stats:at({},s),lts:Date.now()}),this._stats.videoRecv.push(s);break}case"audio_recv":{const s=bc(NV);s.codec=t.googCodecName,s.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,s.decodingCNG=Number(t.googDecodingCNG),s.decodingCTN=Number(t.googDecodingCTN),s.decodingCTSG=Number(t.googDecodingCTSG),s.decodingNormal=Number(t.googDecodingNormal),s.decodingPLC=Number(t.googDecodingPLC),s.decodingPLCCNG=Number(t.googDecodingPLCCNG),s.expandRate=Number(t.googExpandRate),s.accelerateRate=Number(t.googAccelerateRate),s.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),s.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),s.speechExpandRate=Number(t.googSpeechExpandRate),s.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),s.jitterBufferMs=Number(t.googJitterBufferMs),s.jitterMs=Number(t.googJitterReceived),s.bytes=Number(t.bytesReceived),s.packets=Number(t.packetsReceived),s.packetsLost=Number(t.packetsLost),s.ssrc=Number(t.ssrc),s.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),s.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),s.receivedFrames>0&&!this.isFirstAudioReceived[s.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(s.ssrc),this.isFirstAudioReceived[s.ssrc]=!0),s.decodingNormal>0&&!this.isFirstAudioDecoded[s.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(s.ssrc),this.isFirstAudioDecoded[s.ssrc]=!0),this._stats.audioRecv.push(s);break}case"audio_send":{const s=bc(IV);s.codec=t.googCodecName,s.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,s.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),s.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),s.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),s.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),s.bytes=Number(t.bytesSent),s.packets=Number(t.packetsSent),s.packetsLost=Number(t.packetsLost),s.ssrc=Number(t.ssrc),s.rttMs=Number(t.googRtt||0),this._stats.rtt=s.rttMs,this._stats.audioSend.push(s);break}}})}_getStats(){return new Je((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(n=>{const r={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(s=>{r[s]=n.stat(s)}),t.push(r)}),t}},JS=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),Mw=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),qD=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),to=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var uE=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(uE||{});function QS(e,t,n,r){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:uE.kNone;if(!t)return;const l=Number(t[n]);if(typeof l!="number")return;const h=Number(t[r]);if(typeof h!="number")return;if(!e)return h?l/h*s:void 0;const p=Number(e[n]);if(typeof p!="number")return;const m=Number(e[r]);if(typeof m!="number")return;const g=h-m;return g?(l-p)/g*s:void 0}let OV=class extends WD{constructor(){super(...arguments),Ot(this,"_stats",XS),Ot(this,"report",void 0),Ot(this,"lastDecodeVideoReceiverStats",new Map),Ot(this,"lastVideoFramesRecv",new Map),Ot(this,"lastVideoFramesSent",new Map),Ot(this,"lastVideoFramesDecode",new Map),Ot(this,"lastVideoFramesOutput",new Map),Ot(this,"lastVideoJBDelay",new Map),Ot(this,"lastAudioJBDelay",new Map),Ot(this,"mediaBytesSent",new Map),Ot(this,"mediaBytesRetransmit",new Map),Ot(this,"mediaBytesTargetEncode",new Map),Ot(this,"lastDecodeAudioReceiverStats",new Map),Ot(this,"lastAudioConcealment",new Map),Ot(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=bc(XS),this.report.forEach(e=>{switch(e.type){case to.OUTBOUND:case to.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===to.OUTBOUND?t==="audio"||r?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===to.INBOUND&&(t==="audio"||r?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case to.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case to.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:at({},Sd),remote:at({},Sd)};return e.forEach(n=>{let r;if(n.type===to.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===to.CANDIDATE_PAIR&&n.selected&&(r=n),r){const s=(l,h)=>{l.type=h.type,l.id=h.id,h.address&&(l.address=h.address),h.candidateType&&(l.candidateType=h.candidateType),h.port&&(l.port=h.port),h.priority&&(l.priority=h.priority),h.protocol&&(l.protocol=h.protocol),h.relayProtocol&&(l.relayProtocol=h.relayProtocol)};if(r.localCandidateId){const l=e.get(r.localCandidateId);l&&s(t.local,l)}if(r.remoteCandidateId){const l=e.get(r.remoteCandidateId);l&&s(t.remote,l)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===to.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===to.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===to.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(at({},t),at({},this.stats.selectedCandidatePair.localCandidate)),e.type===to.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(at({},t),at({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);t||(t=bc(NV),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=QS(n,t,"totalProcessingDelay","jitterBufferEmittedCount",uE.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,at({},t))}calculateAudioFreeze(e,t,n){const r=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&r!=null){const s=r.lts,l=n.timestamp,h=l-s;if(h<=0)return;const p=e.concealedSamples-t.concealedSamples-0,m=r.nonSilent+p,g=e.totalSamplesReceived-t.totalSamplesReceived;if(g<=0)return;const v=80*g/h,T=200*g/h,C=h/g;let I=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,m>v&&(r.plc80>0?(e.freezeSamples80+=p,e.freezeMs80+=Math.round(p*C)):(e.freezeSamples80+=m,e.freezeMs80+=Math.round(m*C)),I=r.plc80+1);let U=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,m>T&&(r.plc200>0?(e.freezeSamples200+=p,e.freezeMs200+=Math.round(p*C)):(e.freezeSamples200+=m,e.freezeMs200+=Math.round(m*C)),U=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:p,lts:l,plc80:I,plc200:U})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);t||(t=bc(wV),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),s=this.lastVideoFramesOutput.get(t.ssrc),l=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const h=t.decodedFrame?t.decodedFrame.width:0,p=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,h,p),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const h=n.stats,p=l-n.lts;t.framesDecodeFreezeTime=h.framesDecodeFreezeTime,t.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&p>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=p,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<h.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=QS(n==null?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=QS(n==null?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",uE.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=QS(n==null?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",uE.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=QS(n==null?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",uE.kMillisecondsFromSeconds),r&&l-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((l-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:0}),t.framesDroppedCount&&e.framesReceived&&(s&&l-s.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-s.count)/((l-s.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:Math.max(t.outputFrameRate,0)})):s?t.outputFrameRate=s.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:at({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(r=>r.ssrc===e.ssrc);t||(t=bc(AV),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const r=new zD(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(e.retransmittedBytesSent!==void 0){const r=this.mediaBytesRetransmit.get(e.ssrc);if(r)r.add(e.retransmittedBytesSent);else{const s=new zD(10);s.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,s)}}if(e.totalEncodedBytesTarget){const r=this.mediaBytesTargetEncode.get(e.ssrc);if(r)r.add(e.totalEncodedBytesTarget);else{const s=new zD(10);s.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,s)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const s=e.framesEncoded-r.lastFrameCount,l=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*l/s}}if(e.framesEncoded&&e.qpSum){const r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,to.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=bc(IV),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,to.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(Fs(n=this.report).call(n)).find(s=>s.type===t&&s.ssrc===e);return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,s,l,h;const p=t?this.report.get(t):void 0,m=(r=p==null?void 0:p.framesSent)!==null&&r!==void 0?r:e.framesSent;if(typeof m!="number")return;let g=(s=p==null?void 0:p.frameWidth)!==null&&s!==void 0?s:e.frameWidth,v=(l=p==null?void 0:p.frameHeight)!==null&&l!==void 0?l:e.frameHeight,T=(h=p==null?void 0:p.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof g=="number"&&typeof v=="number"||(g=0,v=0),T==null){const C=Date.now(),I=this.lastVideoFramesSent.get(n.ssrc);I&&C-I.lts>=800?(T=Math.round((m-I.count)/((C-I.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:m,lts:C,rate:T})):I?T=I.rate:this.lastVideoFramesSent.set(n.ssrc,{count:m,lts:C,rate:0})}n.sentFrame={width:g,height:v,frameRate:Math.max(0,T)}}processVideoTrackReceiverStats(e,t,n){var r,s,l,h,p;const m=t?this.report.get(t):void 0,g=(r=m==null?void 0:m.framesReceived)!==null&&r!==void 0?r:e.framesReceived,v=(s=m==null?void 0:m.frameWidth)!==null&&s!==void 0?s:e.frameWidth,T=(l=m==null?void 0:m.frameHeight)!==null&&l!==void 0?l:e.frameHeight,C=(h=m==null?void 0:m.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,I=(p=m==null?void 0:m.jitterBufferEmittedCount)!==null&&p!==void 0?p:e.jitterBufferEmittedCount;if(typeof g=="number"){const U=this.lastVideoFramesRecv.get(n.ssrc),k=Date.now();n.framesReceivedCount=g;let M=0;U&&k-U.lts>=800?(M=Math.round((g-U.count)/((k-U.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:g,lts:k,rate:M})):U?M=U.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:g,lts:k,rate:0}),n.receivedFrame={width:v||0,height:T||0,frameRate:M||0},n.decodedFrame={width:v||0,height:T||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:v||0,height:T||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(C&&I){const U=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let k=U.jitterBufferMs;const M=I-U.jitterBufferEmittedCount;M>0&&(k=1e3*(C-U.jitterBufferDelay)/M),n.jitterBufferMs=k,n.currentDelayMs=Math.round(k),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:C,jitterBufferEmittedCount:I,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,s,l,h;const p=t?this.report.get(t):void 0,m=(r=(s=p==null?void 0:p.echoReturnLoss)!==null&&s!==void 0?s:e.echoReturnLoss)!==null&&r!==void 0?r:0,g=(l=(h=p==null?void 0:p.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&l!==void 0?l:0;n.aecReturnLoss=m,n.aecReturnLossEnhancement=g}processAudioTrackReceiverStats(e,t,n){var r,s,l,h,p,m,g,v,T;const C=t?this.report.get(t):void 0,I=(r=C==null?void 0:C.removedSamplesForAcceleration)!==null&&r!==void 0?r:e.removedSamplesForAcceleration,U=(s=C==null?void 0:C.totalSamplesReceived)!==null&&s!==void 0?s:e.totalSamplesReceived,k=(l=C==null?void 0:C.jitterBufferDelay)!==null&&l!==void 0?l:e.jitterBufferDelay,M=(h=C==null?void 0:C.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,F=(p=C==null?void 0:C.audioLevel)!==null&&p!==void 0?p:e==null?void 0:e.audioLevel,B=(m=C==null?void 0:C.totalSamplesDuration)!==null&&m!==void 0?m:e==null?void 0:e.totalSamplesDuration,ee=(g=C==null?void 0:C.concealedSamples)!==null&&g!==void 0?g:e.concealedSamples,ue=(v=C==null?void 0:C.silentConcealedSamples)!==null&&v!==void 0?v:e.silentConcealedSamples,de=(T=C==null?void 0:C.concealmentEvents)!==null&&T!==void 0?T:e.concealmentEvents;if(typeof U=="number"&&(n.totalSamplesReceived=U),typeof ue=="number"&&(n.silentConcealedSamples=ue),typeof de=="number"&&(n.concealmentEvents=de),typeof ee=="number"&&(n.concealedSamples=ee),I&&U&&(n.accelerateRate=I/U),k&&M){const Te=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Ae=Te.jitterBufferMs;const We=M-Te.jitterBufferEmittedCount;We>0&&(Ae=1e3*(k-Te.jitterBufferDelay)/We),n.jitterBufferMs=Math.round(Ae),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:k,jitterBufferEmittedCount:M,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=F;let ae=1920;B&&U&&(ae=U/B/50,n.receivedFrames=Math.round(U/ae)),ee&&(n.droppedFrames=Math.round(ee/ae))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(s=>{e+=s.diffMean()}),this.mediaBytesRetransmit.forEach(s=>{t=t===null?s.diffMean():t+s.diffMean()}),this.mediaBytesTargetEncode.forEach(s=>{n=n===null?s.diffMean():n+s.diffMean()});const r=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},NJ=class extends WD{updateStats(){return Je.resolve()}};function KD(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const l=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return l?l<76?new IJ(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:s}):new OV(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:s}):function(h){if(!window.RTCStatsReport)return!1;const p=h.getStats();return!!(p instanceof Je||function(m){return!!m&&(typeof m=="object"||typeof m=="function")&&typeof m.then=="function"}(p))}(e)?new OV(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:s}):new NJ(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:s})}const DV="websdk_ng_install_id";function YD(){try{if(Y("INSTALL_ID"))return Y("INSTALL_ID");let e=window.localStorage.getItem(DV);return e||(e=Tm(),window.localStorage.setItem(DV,e)),wn("INSTALL_ID",e),e}catch{return}}const Lo=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],r=t[2];return"".concat(n,".").concat(r)}return"4.0.0.999"}("4.23.3"),XD=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Rm=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const kr=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),s=[];for(let p=0;p<6;p++)s.push("1");const l=s.join(""),h={};return h[e]=r,h[t]=l,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=kr;const Uw={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},JD={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},QD="v4.23.3-0-g83bb9b5a-dirty(4/29/2025, 5:16:52 PM)",$D={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1},Zn=at(at(at(at({},$D),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:JD,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Uw),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:void 0,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function wn(e,t,n){var r,s,l;Ye(r=Object.keys(Zn)).call(r,e)&&(!n&&Ye(s=Object.keys(yl)).call(s,e)||(Zn[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||t!==!0||(Zn.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(Zn.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&t&&(l=!!t,Zn.USE_NEW_NETWORK_CONFIG=l,l&&(Zn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Zn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Zn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Zn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Zn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Zn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Zn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Zn.ENABLE_INSTANT_VIDEO=!0,Zn.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Zn.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(Zn.NEW_TURN_MODE||(Zn.NEW_TURN_MODE=4))))}function Y(e){return Zn[e]}XD||(Zn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Zn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Zn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Zn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Zn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Zn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Zn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Zn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Zn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Zn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Zn.AREAS=["NORTH_AMERICA","OVERSEA"]);let PV=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const yl={};var Jt=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(Jt||{});let jw=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const LV=128,OJ=96,kV=1e3,hE=10;let DJ=0;var xV=(()=>{var e={8:(r,s,l)=>{l.r(s),l.d(s,{Parser:()=>We,Printer:()=>qn,parse:()=>Ve,print:()=>ct});const h=`
`,p="".concat("\r").concat(h),m=" ";let g;function v(Ne){return Ne>="0"&&Ne<="9"}function T(Ne){return Ne>="!"&&Ne<="~"}function C(Ne){return T(Ne)||Ne>=""&&Ne<=""}function I(Ne){return Ne==="!"||Ne>="#"&&Ne<="'"||Ne>="*"&&Ne<="+"||Ne>="-"&&Ne<="."||Ne>="0"&&Ne<="9"||Ne>="A"&&Ne<="Z"||Ne>="^"&&Ne<="~"}function U(Ne){return Ne>="1"&&Ne<="9"}function k(Ne){return Ne>="A"&&Ne<="Z"||Ne>="a"&&Ne<="z"}function M(Ne){return Ne==="d"||Ne==="h"||Ne==="m"||Ne==="s"}function F(Ne){return Ne>""&&Ne<"	"||Ne>"\v"&&Ne<"\f"||Ne>""&&Ne<""}function B(Ne){return k(Ne)||v(Ne)||Ne==="+"||Ne==="/"}function ee(Ne){return v(Ne)||k(Ne)||Ne==="+"||Ne==="/"||Ne==="-"||Ne==="_"}function ue(Ne){return k(Ne)||v(Ne)||Ne==="+"||Ne==="/"}function de(Ne,L){var X=Object.keys(Ne);if(Object.getOwnPropertySymbols){var re=Object.getOwnPropertySymbols(Ne);L&&(re=re.filter(function(Ue){return Object.getOwnPropertyDescriptor(Ne,Ue).enumerable})),X.push.apply(X,re)}return X}function ae(Ne){for(var L=1;L<arguments.length;L++){var X=arguments[L]!=null?arguments[L]:{};L%2?de(Object(X),!0).forEach(function(re){Te(Ne,re,X[re])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ne,Object.getOwnPropertyDescriptors(X)):de(Object(X)).forEach(function(re){Object.defineProperty(Ne,re,Object.getOwnPropertyDescriptor(X,re))})}return Ne}function Te(Ne,L,X){return L in Ne?Object.defineProperty(Ne,L,{value:X,enumerable:!0,configurable:!0,writable:!0}):Ne[L]=X,Ne}(function(Ne){Ne.VERSION="v",Ne.ORIGIN="o",Ne.SESSION_NAME="s",Ne.INFORMATION="i",Ne.URI="u",Ne.EMAIL="e",Ne.PHONE="p",Ne.CONNECTION="c",Ne.BANDWIDTH="b",Ne.TIME="t",Ne.REPEAT="r",Ne.ZONE_ADJUSTMENTS="z",Ne.KEY="k",Ne.ATTRIBUTE="a",Ne.MEDIA="m"})(g||(g={}));class Ae{consumeText(L,X){let re=X;for(;re<L.length;){const Ue=L[re];if(Ue==="\0"||Ue==="\r"||Ue===h)break;re+=1}if(re-X==0)throw new Error("Invalid text, at ".concat(L));return re}consumeUnicastAddress(L,X,re){return this.consumeTill(L,X,m)}consumeOneOrMore(L,X,re){let Ue=X;for(;re(L[Ue]);)Ue++;if(Ue-X==0)throw new Error("Invalid rule at ".concat(X,"."));return Ue}consumeSpace(L,X){if(L[X]===m)return X+1;throw new Error("Invalid space at ".concat(X,"."))}consumeIP4Address(L,X){let re=X;for(let Ue=0;Ue<4;Ue++)if(re=this.consumeDecimalUChar(L,re),Ue!==3){if(L[re]!==".")throw new Error("Invalid IP4 address.");re++}return re}consumeDecimalUChar(L,X){let re=X;for(let Lt=0;Lt<3&&v(L[re]);Lt++,re++);if(re-X==0)throw new Error("Invalid decimal uchar.");const Ue=parseInt(L.slice(X,re));if(Ue>=0&&Ue<=255)return re;throw new Error("Invalid decimal uchar")}consumeIP6Address(L,X){let re=this.consumeHexpart(L,X);return L[re]===":"&&(re+=1,re=this.consumeIP4Address(L,re)),re}consumeHexpart(L,X){let re=X;if(L[re]===":"&&L[re+1]===":"){re+=2;try{re=this.consumeHexseq(L,re)}catch{}return re}if(re=this.consumeHexseq(L,re),L[re]===":"&&L[re+1]===":"){re+=2;try{re=this.consumeHexseq(L,re)}catch{}return re}return re}consumeHexseq(L,X){let re=X;for(;re=this.consumeHex4(L,re),L[re]===":"&&L[re+1]!==":";)re+=1;return re}consumeHex4(L,X){let re=0;for(;re<4;re++)if(!((Ue=L[X+re])>="0"&&Ue<="9"||Ue>="a"&&Ue<="f"||Ue>="A"&&Ue<="F")){if(re===0)throw new Error("Invalid hex 4");break}var Ue;return X+re}consumeFQDN(L,X){let re=X;for(;v(L[re])||k(L[re])||L[re]==="-"||L[re]===".";)re+=1;if(re-X<4)throw new Error("Invalid FQDN");return re}consumeExtnAddr(L,X){return this.consumeOneOrMore(L,X,C)}consumeMulticastAddress(L,X,re){switch(re){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(L,X);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(L,X);default:try{return this.consumeFQDN(L,X)}catch{return this.consumeExtnAddr(L,X)}}}consumeIP6MulticastAddress(L,X){const re=this.consumeHexpart(L,X);return L[re]==="/"?this.consumeInteger(L,re+1):re}consumeIP4MulticastAddress(L,X){let re=X+3;const Ue=L.slice(X,re),Lt=parseInt(Ue);if(Lt<224||Lt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Gn=0;Gn<3;Gn++){if(L[re]!==".")throw new Error("Invalid IP4 multicast address.");re+=1,re=this.consumeDecimalUChar(L,re)}return L[re]==="/"&&(re+=1),re=this.consumeTTL(L,re),L[re]==="/"&&(re=this.consumeInteger(L,re)),re}consumeInteger(L,X){if(!U(L[X]))throw new Error("Invalid integer.");for(X+=1;v(L[X]);)X+=1;return X}consumeTTL(L,X){if(L[X]==="0")return X+1;if(!U(L[X]))throw new Error("Invalid TTL.");X+=1;for(let re=0;re<2&&v(L[X]);re++)X+=1;return X}consumeToken(L,X){return this.consumeOneOrMore(L,X,I)}consumeTime(L,X){let re=X;if(L[re]==="0")return re+1;for(U(L[re])&&(re+=1);v(L[re]);)re++;if(re-X<10)throw new Error("Invalid time");return re}consumeAddress(L,X){return this.consumeTill(L,X,m)}consumeTypedTime(L,X){let re=X;return re=this.consumeOneOrMore(L,re,v),M(L[re])?re+1:re}consumeRepeatInterval(L,X){if(!U(L[X]))throw new Error("Invalid repeat interval");for(X+=1;v(L[X]);)X+=1;return M(L[X])&&(X+=1),X}consumePort(L,X){return this.consumeOneOrMore(L,X,v)}consume(L,X,re){for(let Ue=0;Ue<re.length;Ue++){if(X+Ue>=L.length)throw new Error("consume exceeding value length");if(L[X+Ue]!==re[Ue])throw new Error("consume ".concat(re," failed at ").concat(Ue))}return X+re.length}consumeTill(L,X,re){let Ue=X;for(;Ue<L.length&&(typeof re!="string"||L[Ue]!==re)&&(typeof re!="function"||!re(L[Ue]));)Ue++;return Ue}}class We extends Ae{constructor(){super(),Te(this,"records",[]),Te(this,"currentLine",0)}parse(L){const X=this.probeEOL(L);this.records=L.split(X).filter(Yu=>!!_s(Yu).call(Yu)).map(this.parseLine),this.currentLine=0;const re=this.parseVersion(),Ue=this.parseOrigin(),Lt=this.parseSessionName(),Gn=this.parseInformation(),Qi=this.parseUri(),Fo=this.parseEmail(),Uc=this.parsePhone(),MT=this.parseConnection(),Hm=this.parseBandWidth(),WE=this.parseTimeFields(),KA=this.parseKey(),YA=this.parseSessionAttribute(),Bo=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:re,origin:Ue,sessionName:Lt,information:Gn,uri:Qi,emails:Fo,phones:Uc,connection:MT,bandwidths:Hm,timeFields:WE,key:KA,attributes:YA,mediaDescriptions:Bo}}getCurrentRecord(){const L=this.records[this.currentLine];if(!L)throw new Error("Record doesn't exit.");return L}probeEOL(L){for(let X=0;X<L.length;X++)if(L[X]===h)return L[X-1]==="\r"?p:h;throw new Error("Invalid newline character.")}parseLine(L,X){if(L.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const re=L[0];if(L[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:re,value:L.slice(2),line:X,cur:0}}parseSessionAttribute(){const L=new Ft;for(;this.currentLine<this.records.length;){const X=this.getCurrentRecord();if(X.type!==g.ATTRIBUTE)break;const re={attField:this.extractOneOrMore(X,Ue=>I(Ue)&&Ue!==":"),_cur:0};X.value[X.cur]===":"&&(X.cur+=1,re.attValue=this.extractOneOrMore(X,F)),L.parse(re),this.currentLine++}return L.digest()}parseMediaAttributes(L){const X=new xt(L);for(;this.currentLine<this.records.length;){const re=this.getCurrentRecord();if(re.type!==g.ATTRIBUTE)break;const Ue={attField:this.extractOneOrMore(re,Lt=>I(Lt)&&Lt!==":"),_cur:0};re.value[re.cur]===":"&&(re.cur+=1,Ue.attValue=this.extractOneOrMore(re,F)),X.parse(Ue),this.currentLine++}return X.digest()}parseKey(){const L=this.getCurrentRecord();if(L.type===g.KEY){if(L.value==="prompt"||L.value==="clear:"||L.value==="base64:"||L.value==="uri:")return L.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const L=this.getCurrentRecord();if(L.type===g.ZONE_ADJUSTMENTS){const X=[];for(;;)try{const re=this.extract(L,this.consumeTime);this.consumeSpaceForRecord(L);let Ue=!1;L.value[L.cur]==="-"&&(Ue=!0,L.cur+=1);const Lt=this.extract(L,this.consumeTypedTime);X.push({time:re,typedTime:Lt,back:Ue})}catch{break}if(X.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,X}return[]}parseRepeat(){const L=[];for(;;){const X=this.getCurrentRecord();if(X.type!==g.REPEAT)break;{const re=this.extract(X,this.consumeRepeatInterval),Ue=this.parseTypedTime(X);L.push({repeatInterval:re,typedTimes:Ue}),this.currentLine++}}return L}parseTypedTime(L){const X=[];for(;;)try{this.consumeSpaceForRecord(L),X.push(this.extract(L,this.consumeTypedTime))}catch{break}if(X.length===0)throw new Error("Invalid typed time.");return X}parseTime(){const L=this.getCurrentRecord(),X=this.extract(L,this.consumeTime);this.consumeSpaceForRecord(L);const re=this.extract(L,this.consumeTime);return this.currentLine++,{startTime:X,stopTime:re}}parseBandWidth(){const L=[];for(;this.currentLine<this.records.length;){const X=this.getCurrentRecord();if(X.type!==g.BANDWIDTH)break;{const re=this.extractOneOrMore(X,I);if(X.value[X.cur]!==":")throw new Error("Invalid bandwidth field.");X.cur++;const Ue=this.extractOneOrMore(X,v);L.push({bwtype:re,bandwidth:Ue}),this.currentLine++}}return L}parseVersion(){const L=this.getCurrentRecord();if(L.type!==g.VERSION)throw new Error("first sdp record must be version");const X=L.value.slice(0,this.consumeOneOrMore(L.value,0,v));if(X.length!==L.value.length)throw new Error('invalid proto version, "v='.concat(L.value,'"'));return this.currentLine++,X}parseOrigin(){const L=this.getCurrentRecord();if(L.type!==g.ORIGIN)throw new Error("second line of sdp must be origin");const X=this.extractOneOrMore(L,C);this.consumeSpaceForRecord(L);const re=this.extractOneOrMore(L,v);this.consumeSpaceForRecord(L);const Ue=this.extractOneOrMore(L,v);this.consumeSpaceForRecord(L);const Lt=this.extractOneOrMore(L,I);this.consumeSpaceForRecord(L);const Gn=this.extractOneOrMore(L,I);this.consumeSpaceForRecord(L);const Qi=this.extract(L,this.consumeUnicastAddress);return this.currentLine++,{username:X,sessId:re,sessVersion:Ue,nettype:Lt,addrtype:Gn,unicastAddress:Qi}}parseSessionName(){const L=this.getCurrentRecord();if(L.type===g.SESSION_NAME){const X=this.extract(L,this.consumeText);return this.currentLine++,X}}parseInformation(){const L=this.getCurrentRecord();if(L.type!==g.INFORMATION)return;const X=this.extract(L,this.consumeText);return this.currentLine++,X}parseUri(){const L=this.getCurrentRecord();if(L.type===g.URI)return this.currentLine++,L.value}parseEmail(){const L=[];for(;;){const X=this.getCurrentRecord();if(X.type!==g.EMAIL)break;L.push(X.value),this.currentLine++}return L}parsePhone(){const L=[];for(;;){const X=this.getCurrentRecord();if(X.type!==g.PHONE)break;L.push(X.value),this.currentLine++}return L}parseConnection(){const L=this.getCurrentRecord();if(L.type===g.CONNECTION){const X=this.extractOneOrMore(L,I);this.consumeSpaceForRecord(L);const re=this.extractOneOrMore(L,I);this.consumeSpaceForRecord(L);const Ue=this.extract(L,this.consumeAddress);return this.currentLine++,{nettype:X,addrtype:re,address:Ue}}}parseMedia(){const L=this.getCurrentRecord(),X=this.extract(L,this.consumeToken);this.consumeSpaceForRecord(L);let re=this.extract(L,this.consumePort);L.value[L.cur]==="/"&&(L.cur+=1,re+=this.extract(L,this.consumeInteger)),this.consumeSpaceForRecord(L);const Ue=[];for(Ue.push(this.extract(L,this.consumeToken));L.value[L.cur]==="/";)L.cur+=1,Ue.push(this.extract(L,this.consumeToken));if(Ue.length===0)throw new Error("Invalid proto");const Lt=this.parseFmt(L);return this.currentLine++,{mediaType:X,port:re,protos:Ue,fmts:Lt}}parseTimeFields(){const L=[];for(;this.getCurrentRecord().type===g.TIME;){const X=this.parseTime(),re=this.parseRepeat(),Ue=this.parseZone();L.push({time:X,repeats:re,zones:Ue})}return L}parseMediaDescription(){const L=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===g.MEDIA;){const X=this.parseMedia(),re=this.parseInformation(),Ue=this.parseConnections(),Lt=this.parseBandWidth(),Gn=this.parseKey(),Qi=this.parseMediaAttributes(X);L.push({media:X,information:re,connections:Ue,bandwidths:Lt,key:Gn,attributes:Qi})}return L}parseConnections(){const L=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===g.CONNECTION;)L.push(this.parseConnection());return L}parseFmt(L){const X=[];for(;;)try{this.consumeSpaceForRecord(L),X.push(this.extract(L,this.consumeToken))}catch{break}if(X.length===0)throw new Error("Invalid fmts");return X}extract(L,X){for(var re=arguments.length,Ue=new Array(re>2?re-2:0),Lt=2;Lt<re;Lt++)Ue[Lt-2]=arguments[Lt];const Gn=X.call(this,L.value,L.cur,...Ue),Qi=L.value.slice(L.cur,Gn);return L.cur=Gn,Qi}extractOneOrMore(L,X){const re=this.consumeOneOrMore(L.value,L.cur,X),Ue=L.value.slice(L.cur,re);return L.cur=re,Ue}consumeSpaceForRecord(L){if(L.value[L.cur]!==m)throw new Error("Invalid space at ".concat(L.cur,"."));L.cur+=1}}class tt extends Ae{constructor(){super(...arguments),Te(this,"attributes",void 0),Te(this,"digested",!1)}extractOneOrMore(L,X,re){const Ue=this.consumeOneOrMore(L.attValue,L._cur,X),Lt=L.attValue.slice(L._cur,Ue),[Gn,Qi]=re||[];if(typeof Gn=="number"&&Lt.length<Gn)throw new Error("error in length, should be more or equal than ".concat(Gn," characters."));if(typeof Qi=="number"&&Lt.length>Qi)throw new Error("error in length, should be less or equal than ".concat(Qi," characters."));return L._cur=Ue,Lt}consumeAttributeSpace(L){if(L.attValue[L._cur]!==m)throw new Error("Invalid space at ".concat(L._cur,"."));L._cur+=1}extract(L,X){if(!L.attValue)throw new Error("Nothing to extract from attValue.");for(var re=arguments.length,Ue=new Array(re>2?re-2:0),Lt=2;Lt<re;Lt++)Ue[Lt-2]=arguments[Lt];const Gn=X.call(this,L.attValue,L._cur,...Ue),Qi=L.attValue.slice(L._cur,Gn);return L._cur=Gn,Qi}atEnd(L){if(!L.attValue)throw new Error;return L._cur>=L.attValue.length}peekChar(L){if(!L.attValue)throw new Error;return L.attValue[L._cur]}peek(L,X){if(!L.attValue)throw new Error;for(let re=0;re<X.length;re++)if(X[re]!==L.attValue[L._cur+re])return!1;return!0}parseIceUfrag(L){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(L,B,[4,256])}parseIcePwd(L){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(L,B,[22,256])}parseIceOptions(L){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const X=[];for(;!this.atEnd(L);){X.push(this.extractOneOrMore(L,B));try{this.consumeAttributeSpace(L)}catch(re){if(this.atEnd(L))break;throw re}}this.attributes.iceOptions=X}parseFingerprint(L){const X=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const re=this.extract(L,this.consumeTill);this.attributes.fingerprints.push({hashFunction:X,fingerprint:re})}parseExtmap(L){const X=this.extractOneOrMore(L,v);let re;this.peekChar(L)==="/"&&(this.extract(L,this.consume,"/"),re=this.extract(L,this.consumeToken)),this.consumeAttributeSpace(L);const Ue=this.extract(L,this.consumeTill,m),Lt=ae(ae({entry:parseInt(X,10)},re&&{direction:re}),{},{extensionName:Ue});this.peekChar(L)===m&&(this.consumeAttributeSpace(L),Lt.extensionAttributes=this.extract(L,this.consumeTill)),this.attributes.extmaps.push(Lt)}parseSetup(L){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const X=this.extract(L,this.consumeTill);if(X!=="active"&&X!=="passive"&&X!=="actpass"&&X!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=X}}class Ft extends tt{constructor(){super(...arguments),Te(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(L){if(this.digested)throw new Error("already digested");try{switch(L.attField){case"group":this.parseGroup(L);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(L);break;case"ice-pwd":this.parseIcePwd(L);break;case"ice-options":this.parseIceOptions(L);break;case"fingerprint":this.parseFingerprint(L);break;case"setup":this.parseSetup(L);break;case"tls-id":this.parseTlsId(L);break;case"identity":this.parseIdentity(L);break;case"extmap":this.parseExtmap(L);break;case"msid-semantic":this.parseMsidSemantic(L);break;default:L.ignored=!0,this.attributes.unrecognized.push(L)}}catch(X){throw console.error("parsing session attribute ".concat(L.attField,' error, "a=').concat(L.attField,":").concat(L.attValue,'"')),X}if(!L.ignored&&L.attValue&&!this.atEnd(L))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(L){const X=this.extract(L,this.consumeToken),re=[];for(;!this.atEnd(L)&&this.peekChar(L)===m;)this.consumeAttributeSpace(L),re.push(this.extract(L,this.consumeToken));this.attributes.groups.push({semantic:X,identificationTag:re})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(L){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(L,ee)}parseIdentity(L){const X=this.extractOneOrMore(L,ue),re=[];for(;!this.atEnd(L)&&this.peekChar(L)===m;){this.consumeAttributeSpace(L);const Ue=this.extract(L,this.consumeToken);this.extract(L,this.consume,"=");const Lt=this.extractOneOrMore(L,Gn=>Gn!==m&&F(Gn));re.push({name:Ue,value:Lt})}this.attributes.identities.push({assertionValue:X,extensions:re})}parseMsidSemantic(L){this.peekChar(L)===m&&this.consumeAttributeSpace(L);const X={semantic:this.extract(L,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(L)}catch{break}if(this.peekChar(L)==="*"){this.extract(L,this.consume,"*"),X.applyForAll=!0;break}{const re=this.extract(L,this.consumeTill,m);X.identifierList.push(re)}}this.attributes.msidSemantic=X}}class xt extends tt{constructor(L){super(),Te(this,"attributes",void 0),L.protos.indexOf("RTP")!==-1||L.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(L){if(this.digested)throw new Error("already digested");try{switch(L.attField){case"extmap":this.parseExtmap(L);break;case"setup":this.parseSetup(L);break;case"ice-ufrag":this.parseIceUfrag(L);break;case"ice-pwd":this.parseIcePwd(L);break;case"ice-options":this.parseIceOptions(L);break;case"candidate":this.parseCandidate(L);break;case"remote-candidate":this.parseRemoteCandidate(L);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(L);break;case"rtpmap":this.parseRtpmap(L);break;case"ptime":this.parsePtime(L);break;case"maxptime":this.parseMaxPtime(L);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(L);break;case"ssrc":this.parseSSRC(L);break;case"fmtp":this.parseFmtp(L);break;case"rtcp-fb":this.parseRtcpFb(L);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(L);break;case"mid":this.parseMid(L);break;case"msid":this.parseMsid(L);break;case"imageattr":this.parseImageAttr(L);break;case"rid":this.parseRid(L);break;case"simulcast":this.parseSimulcast(L);break;case"sctp-port":this.parseSctpPort(L);break;case"max-message-size":this.parseMaxMessageSize(L);break;case"ssrc-group":this.parseSSRCGroup(L);break;default:L.ignored=!0,this.attributes.unrecognized.push(L)}}catch(X){throw console.error("parsing media attribute ".concat(L.attField,' error, "a=').concat(L.attField,":").concat(L.attValue,'"')),X}if(!L.ignored&&L.attValue&&!this.atEnd(L))throw new Error("attribute parsing error")}parseCandidate(L){const X=this.extractOneOrMore(L,B,[1,32]);this.consumeAttributeSpace(L);const re=this.extractOneOrMore(L,v,[1,5]);this.consumeAttributeSpace(L);const Ue=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const Lt=this.extractOneOrMore(L,v,[1,10]);this.consumeAttributeSpace(L);const Gn=this.extract(L,this.consumeAddress);this.consumeAttributeSpace(L);const Qi=this.extract(L,this.consumePort);this.consumeAttributeSpace(L),this.extract(L,this.consume,"typ"),this.consumeAttributeSpace(L);const Fo={foundation:X,componentId:re,transport:Ue,priority:Lt,connectionAddress:Gn,port:Qi,type:this.extract(L,this.consumeToken),extension:{}};for(this.peek(L," raddr")&&(this.extract(L,this.consume," raddr"),this.consumeAttributeSpace(L),Fo.relAddr=this.extract(L,this.consumeAddress)),this.peek(L," rport")&&(this.extract(L,this.consume," rport"),this.consumeAttributeSpace(L),Fo.relPort=this.extract(L,this.consumePort));this.peekChar(L)===m;){this.consumeAttributeSpace(L);const Uc=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L),Fo.extension[Uc]=this.extractOneOrMore(L,T)}this.attributes.candidates.push(Fo)}parseRemoteCandidate(L){const X=[];for(;;){const re=this.extractOneOrMore(L,v,[1,5]);this.consumeAttributeSpace(L);const Ue=this.extract(L,this.consumeAddress);this.consumeAttributeSpace(L);const Lt=this.extract(L,this.consumePort);X.push({componentId:re,connectionAddress:Ue,port:Lt});try{this.consumeAttributeSpace(L)}catch{break}}this.attributes.remoteCandidatesList.push(X)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(L){const X=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const re=this.extract(L,this.consumeTill,"/");this.extract(L,this.consume,"/");const Ue={encodingName:re,clockRate:this.extractOneOrMore(L,v)};this.atEnd(L)||this.peekChar(L)!=="/"||(this.extract(L,this.consume,"/"),Ue.encodingParameters=parseInt(this.extract(L,this.consumeTill),10));const Lt=this.attributes.payloads.find(Gn=>Gn.payloadType===parseInt(X,10));Lt?Lt.rtpMap=Ue:this.attributes.payloads.push({payloadType:parseInt(X,10),rtpMap:Ue,rtcpFeedbacks:[]})}parsePtime(L){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(L,this.consumeTill)}parseMaxPtime(L){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(L,this.consumeTill)}parseDirection(L){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=L.attField}parseSSRC(L){const X=this.extractOneOrMore(L,v);this.consumeAttributeSpace(L);const re=this.extract(L,this.consumeTill,":");let Ue;this.peekChar(L)===":"&&(this.extract(L,this.consume,":"),Ue=this.extract(L,this.consumeTill));const Lt=this.attributes.ssrcs.find(Gn=>Gn.ssrcId===parseInt(X,10));Lt?Lt.attributes[re]=Ue:this.attributes.ssrcs.push({ssrcId:parseInt(X,10),attributes:{[re]:Ue}})}parseFmtp(L){const X=this.extract(L,this.consumeTill,m);this.consumeAttributeSpace(L);const re=this.extract(L,this.consumeTill),Ue={};re.split(";").forEach(Gn=>{let[Qi,Fo]=Gn.split("=");Qi=_s(Qi).call(Qi);const Uc=typeof Fo=="string"?_s(Fo).call(Fo):null;typeof Qi=="string"&&Qi.length>0&&(Ue[Qi]=Uc)});const Lt=this.attributes.payloads.find(Gn=>Gn.payloadType===parseInt(X,10));Lt?Lt.fmtp={parameters:Ue}:this.attributes.payloads.push({payloadType:parseInt(X,10),rtcpFeedbacks:[],fmtp:{parameters:Ue}})}parseFmtParameters(L){const X={},re=this.extract(L,this.consumeTill,"=");L._cur++;const Ue=this.extract(L,this.consumeTill,";");for(X[re]=Ue;L.attValue[L._cur]===";";){const Lt=this.extract(L,this.consumeTill,"=");L._cur++;const Gn=this.extract(L,this.consumeTill,";");X[Lt]=Gn}return X}parseRtcpFb(L){let X="";X=this.peekChar(L)==="*"?this.extract(L,this.consume,"*"):this.extract(L,this.consumeTill,m),this.consumeAttributeSpace(L);const re=this.extract(L,this.consumeTill,m);let Ue;if(re==="trr-int")Ue={type:re,interval:this.extract(L,this.consumeTill)};else{const Lt={type:re};this.peekChar(L)===m&&(this.consumeAttributeSpace(L),Lt.parameter=this.extract(L,this.consumeToken),this.peekChar(L)===m&&(Lt.additional=this.extract(L,this.consumeTill))),Ue=Lt}if(X==="*")this.attributes.rtcpFeedbackWildcards.push(Ue);else{const Lt=this.attributes.payloads.find(Gn=>Gn.payloadType===parseInt(X,10));Lt?Lt.rtcpFeedbacks.push(Ue):this.attributes.payloads.push({payloadType:parseInt(X,10),rtcpFeedbacks:[Ue]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(L){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const X={port:this.extract(L,this.consumePort)};this.peekChar(L)===m&&(this.consumeAttributeSpace(L),X.netType=this.extractOneOrMore(L,I),this.consumeAttributeSpace(L),X.addressType=this.extractOneOrMore(L,I),this.consumeAttributeSpace(L),X.address=this.extract(L,this.consumeAddress)),this.attributes.rtcp=X}parseMsid(L){const X={id:this.extractOneOrMore(L,I,[1,64])};this.peekChar(L)===m&&(this.consumeAttributeSpace(L),X.appdata=this.extractOneOrMore(L,I,[1,64])),this.attributes.msids.push(X)}parseImageAttr(L){this.attributes.imageattr.push(L.attValue)}parseRid(L){const X=this.extractOneOrMore(L,Ue=>k(Ue)||v(Ue)||Ue==="_"||Ue==="-");this.consumeAttributeSpace(L);const re={id:X,direction:this.extract(L,this.consumeToken),params:[]};if(this.peekChar(L)===m){if(this.consumeAttributeSpace(L),this.peek(L,"pt=")){this.extract(L,this.consume,"pt=");const Ue=[];for(;;){const Lt=this.extract(L,this.consumeToken);Ue.push(Lt);try{this.extract(L,this.consume,",")}catch{break}}re.payloads=Ue,this.peekChar(L)===m&&this.extract(L,this.consume,m)}for(;;){const Ue=this.extract(L,this.consumeToken);switch(Ue){case"depend":{const Lt={type:Ue,rids:this.extract(L,this.consume,"=").split(",")};re.params.push(Lt);break}default:{const Lt={type:Ue};this.peekChar(L)==="="&&(this.extract(L,this.consume,"="),Lt.val=this.extract(L,this.consumeTill,";")),re.params.push(Lt)}}try{this.extract(L,this.consume,";")}catch{break}}}this.attributes.rids.push(re)}parseSimulcast(L){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=L.attValue,this.extract(L,this.consumeTill)}parseSctpPort(L){this.attributes.sctpPort=this.extractOneOrMore(L,v,[1,5])}parseMaxMessageSize(L){this.attributes.maxMessageSize=this.extractOneOrMore(L,v,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(L){this.attributes.mid=this.extract(L,this.consumeToken)}parseSSRCGroup(L){const X=this.extract(L,this.consumeToken),re=[];for(;;)try{this.consumeAttributeSpace(L);const Ue=this.extract(L,this.consumeInteger);re.push(parseInt(Ue,10))}catch{break}this.attributes.ssrcGroups.push({semantic:X,ssrcIds:re})}}function wt(Ne,L,X){return L in Ne?Object.defineProperty(Ne,L,{value:X,enumerable:!0,configurable:!0,writable:!0}):Ne[L]=X,Ne}class qn{constructor(){wt(this,"eol",p)}print(L,X){let re="";return X&&(this.eol=X),re+=this.printVersion(L.version),re+=this.printOrigin(L.origin),re+=this.printSessionName(L.sessionName),re+=this.printInformation(L.information),re+=this.printUri(L.uri),re+=this.printEmail(L.emails),re+=this.printPhone(L.phones),re+=this.printConnection(L.connection),re+=this.printBandwidth(L.bandwidths),re+=this.printTimeFields(L.timeFields),re+=this.printKey(L.key),re+=this.printSessionAttributes(L.attributes),re+=this.printMediaDescription(L.mediaDescriptions),re}printVersion(L){return"v=".concat(L).concat(this.eol)}printOrigin(L){return"o=".concat(L.username," ").concat(L.sessId," ").concat(L.sessVersion," ").concat(L.nettype," ").concat(L.addrtype," ").concat(L.unicastAddress).concat(this.eol)}printSessionName(L){return L?"s=".concat(L).concat(this.eol):""}printInformation(L){return L?"i=".concat(L).concat(this.eol):""}printUri(L){return L?"u=".concat(L).concat(this.eol):""}printEmail(L){let X="";for(const re of L)X+="e=".concat(re).concat(this.eol);return X}printPhone(L){let X="";for(const re of L)X+="e=".concat(re).concat(this.eol);return X}printConnection(L){return L?"c=".concat(L.nettype," ").concat(L.addrtype," ").concat(L.address).concat(this.eol):""}printBandwidth(L){let X="";for(const re of L)X+="b=".concat(re.bwtype,":").concat(re.bandwidth).concat(this.eol);return X}printTimeFields(L){let X="";for(const re of L){X+="t=".concat(re.time.startTime," ").concat(re.time.startTime).concat(this.eol);for(const Ue of re.repeats)X+="r=".concat(Ue.repeatInterval," ").concat(Ue.typedTimes.join(" ")).concat(this.eol);re.zoneAdjustments&&(X+="z=",X+="z=".concat(re.zoneAdjustments.map(Ue=>"".concat(Ue.time," ").concat(Ue.back?"-":""," ").concat(Ue.typedTime)).join(" ")).concat(this.eol),X+=this.eol)}return X}printKey(L){return L?"k=".concat(L).concat(this.eol):""}printAttributes(L){let X="";for(const re of L)X+="a=".concat(re.attField).concat(re.attValue?":".concat(re.attValue):"").concat(this.eol);return X}printMediaDescription(L){let X="";for(const re of L)X+=this.printMedia(re.media),X+=this.printInformation(re.information),X+=this.printConnections(re.connections),X+=this.printBandwidth(re.bandwidths),X+=this.printKey(re.key),X+=this.printMediaAttributes(re);return X}printConnections(L){let X="";for(const re of L)X+=this.printConnection(re);return X}printMedia(L){return"m=".concat(L.mediaType," ").concat(L.port," ").concat(L.protos.join("/")," ").concat(L.fmts.join(" ")).concat(this.eol)}printSessionAttributes(L){return new qs(this.eol).print(L)}printMediaAttributes(L){return new Ie(this.eol).print(L)}}class Pn{constructor(L){wt(this,"eol",void 0),this.eol=L}printIceUfrag(L){return L===void 0?"":"a=ice-ufrag:".concat(L).concat(this.eol)}printIcePwd(L){return L===void 0?"":"a=ice-pwd:".concat(L).concat(this.eol)}printIceOptions(L){return L===void 0?"":"a=ice-options:".concat(L.join(m)).concat(this.eol)}printFingerprints(L){return L.length>0?L.map(X=>"a=fingerprint:".concat(X.hashFunction).concat(m).concat(X.fingerprint)).join(this.eol)+this.eol:""}printExtmap(L){return L.map(X=>"a=extmap:".concat(X.entry).concat(X.direction?"/".concat(X.direction):"").concat(m).concat(X.extensionName).concat(X.extensionAttributes?"".concat(m).concat(X.extensionAttributes):"").concat(this.eol)).join("")}printSetup(L){return L===void 0?"":"a=setup:".concat(L).concat(this.eol)}printUnrecognized(L){return L.map(X=>"a=".concat(X.attField).concat(X.attValue?":".concat(X.attValue):"").concat(this.eol)).join("")}}class qs extends Pn{print(L){let X="";return X+=this.printGroups(L.groups),X+=this.printMsidSemantic(L.msidSemantic),X+=this.printIceLite(L.iceLite),X+=this.printIceUfrag(L.iceUfrag),X+=this.printIcePwd(L.icePwd),X+=this.printIceOptions(L.iceOptions),X+=this.printFingerprints(L.fingerprints),X+=this.printSetup(L.setup),X+=this.printTlsId(L.tlsId),X+=this.printIdentity(L.identities),X+=this.printExtmap(L.extmaps),X+=this.printUnrecognized(L.unrecognized),X}printGroups(L){let X="";return L.length>0&&(X+=L.map(re=>"a=group:".concat(re.semantic).concat(re.identificationTag.map(Ue=>"".concat(m).concat(Ue)).join("")).concat(this.eol)).join("")),X}printIceLite(L){return L===void 0?"":"a=ice-lite"+this.eol}printTlsId(L){return L?"a=tls-id:".concat(L).concat(this.eol):""}printIdentity(L){return L.length===0?"":L.map(X=>"a=identity:".concat(X.assertionValue).concat(X.extensions.map(re=>"".concat(m).concat(re.name).concat(re.value?"=".concat(re.value):"")))).join(this.eol)+this.eol}printMsidSemantic(L){if(!L)return"";let X="a=msid-semantic:".concat(L.semantic);return L.applyForAll?X+="".concat(m,"*"):L.identifierList.length>0&&(X+=L.identifierList.map(re=>"".concat(m).concat(re))),X+this.eol}}class Ie extends Pn{print(L){const X=L.attributes;let re="";return re+=this.printRTCP(X.rtcp),re+=this.printIceUfrag(X.iceUfrag),re+=this.printIcePwd(X.icePwd),re+=this.printIceOptions(X.iceOptions),re+=this.printCandidates(X.candidates),re+=this.printRemoteCandidatesList(X.remoteCandidatesList),re+=this.printEndOfCandidates(X.endOfCandidates),re+=this.printFingerprints(X.fingerprints),re+=this.printSetup(X.setup),re+=this.printMid(X.mid),re+=this.printExtmap(X.extmaps),re+=this.printRTPRelated(X),re+=this.printPtime(X.ptime),re+=this.printMaxPtime(X.maxPtime),re+=this.printDirection(X.direction),re+=this.printSSRCGroups(X.ssrcGroups),re+=this.printSSRC(X.ssrcs),re+=this.printRTCPMux(X.rtcpMux),re+=this.printRTCPMuxOnly(X.rtcpMuxOnly),re+=this.printRTCPRsize(X.rtcpRsize),re+=this.printMSId(X.msids),re+=this.printImageattr(X.imageattr),re+=this.printRid(X.rids),re+=this.printSimulcast(X.simulcast),re+=this.printSCTPPort(X.sctpPort),re+=this.printMaxMessageSize(X.maxMessageSize),re+=this.printUnrecognized(X.unrecognized),re}printCandidates(L){return L.map(X=>"a=candidate:".concat(X.foundation).concat(m).concat(X.componentId).concat(m).concat(X.transport).concat(m).concat(X.priority).concat(m).concat(X.connectionAddress).concat(m).concat(X.port).concat(m,"typ").concat(m).concat(X.type).concat(X.relAddr?"".concat(m,"raddr").concat(m).concat(X.relAddr):"").concat(X.relPort?"".concat(m,"rport").concat(m).concat(X.relPort):"").concat(Object.keys(X.extension).map(re=>"".concat(m).concat(re).concat(m).concat(X.extension[re])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(L){return L.map(X=>"a=remote-candidates:".concat(X.join(m)).concat(this.eol)).join("")}printEndOfCandidates(L){return L===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(L){if(!L.payloads)return"";const X=L.payloads;let re="";re+=L.rtcpFeedbackWildcards.map(Ue=>this.printRTCPFeedback("*",Ue)).join("");for(const Ue of X)re+=this.printRtpMap(Ue.payloadType,Ue.rtpMap),re+=this.printFmtp(Ue.payloadType,Ue.fmtp),re+=Ue.rtcpFeedbacks.map(Lt=>this.printRTCPFeedback(Ue.payloadType,Lt)).join("");return re}printFmtp(L,X){if(!X)return"";const re=Object.keys(X.parameters);return re.length===1&&X.parameters[re[0]]===null?"a=fmtp:".concat(L).concat(m).concat(re[0]).concat(this.eol):"a=fmtp:".concat(L).concat(m).concat(Object.keys(X.parameters).map(Ue=>"".concat(Ue,"=").concat(X.parameters[Ue])).join(";")).concat(this.eol)}printRtpMap(L,X){return X?"a=rtpmap:".concat(L).concat(m).concat(X.encodingName,"/").concat(X.clockRate).concat(X.encodingParameters?"/".concat(X.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(L,X){let re="a=rtcp-fb:".concat(L).concat(m),Ue=X;return Ue.type==="trr-int"?re+="ttr-int".concat(m).concat(Ue.interval):(re+="".concat(Ue.type),Ue.parameter&&(re+="".concat(m).concat(Ue.parameter),Ue.additional&&(re+="".concat(m).concat(Ue.additional)))),re+this.eol}printPtime(L){return L===void 0?"":"a=ptime:".concat(L).concat(this.eol)}printMaxPtime(L){return L===void 0?"":"a=maxptime:".concat(L).concat(this.eol)}printDirection(L){return L===void 0?"":"a=".concat(L).concat(this.eol)}printSSRC(L){return L.map(X=>Object.keys(X.attributes).map(re=>"a=ssrc:".concat(X.ssrcId.toString(10)).concat(m).concat(re).concat(X.attributes[re]?":".concat(X.attributes[re]):"").concat(this.eol)).join("")).join("")}printRTCPMux(L){return L===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(L){return L===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(L){return L===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(L){if(L===void 0)return"";let X="a=rtcp:".concat(L.port);return L.netType&&(X+="".concat(m).concat(L.netType)),L.addressType&&(X+="".concat(m).concat(L.addressType)),L.address&&(X+="".concat(m).concat(L.address)),X+this.eol}printMSId(L){return L.map(X=>"a=msid:".concat(X.id).concat(X.appdata?"".concat(m).concat(X.appdata):"").concat(this.eol)).join("")}printImageattr(L){return L.map(X=>"a=imageattr:".concat(X).concat(this.eol)).join("")}printRid(L){return L.map(X=>{let re="a=rid:".concat(X.id).concat(m).concat(X.direction);return X.payloads&&(re+="".concat(m,"pt=").concat(X.payloads.join(","))),X.params.length>0&&(re+="".concat(m).concat(X.params.map(Ue=>Ue.type==="depend"?"depend=".concat(Ue.rids.join(",")):"".concat(Ue.type,"=").concat(Ue.val)).join(";"))),re+this.eol}).join("")}printSimulcast(L){return L===void 0?"":"a=simulcast:".concat(L).concat(this.eol)}printSCTPPort(L){return L===void 0?"":"a=sctp-port:".concat(L).concat(this.eol)}printMaxMessageSize(L){return L===void 0?"":"a=max-message-size:".concat(L).concat(this.eol)}printMid(L){return L===void 0?"":"a=mid:".concat(L).concat(this.eol)}printSSRCGroups(L){return L.map(X=>"a=ssrc-group:".concat(X.semantic).concat(X.ssrcIds.map(re=>"".concat(m).concat(re.toString(10))).join("")).concat(this.eol)).join("")}}function Ve(Ne){return new We().parse(Ne)}function ct(Ne,L){return new qn().print(Ne,L)}}},t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}return n.d=(r,s)=>{for(var l in s)n.o(s,l)&&!n.o(r,l)&&Object.defineProperty(r,l,{enumerable:!0,get:s[l]})},n.o=(r,s)=>Object.prototype.hasOwnProperty.call(r,s),n.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n(8)})();function ca(e){return xV.parse(e)}function hp(e,t){return xV.print(e,t)}var PJ=ba("Array","keys"),LJ=Zc,kJ=ki,xJ=W,MJ=PJ,ZD=Array.prototype,UJ={DOMTokenList:!0,NodeList:!0},jJ=function(e){var t=e.keys;return e===ZD||xJ(ZD,e)&&t===ZD.keys||kJ(UJ,LJ(e))?MJ:t},no=f(jJ);function yi(e,t,n){return(t=function(r){var s=function(l,h){if(typeof l!="object"||!l)return l;var p=l[Symbol.toPrimitive];if(p!==void 0){var m=p.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(r);return typeof s=="symbol"?s:s+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function MV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function jt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?MV(Object(n),!0).forEach(function(r){yi(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const UV=new class extends ai{constructor(){super(...arguments),yi(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class VJ{constructor(t){yi(this,"logger",void 0),yi(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function eP(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function jV(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const ko={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Vw=Date.now(),$S=e=>{for(const t in ko)if(Object.prototype.hasOwnProperty.call(ko,t)&&ko[t]===e)return t;return"DEFAULT"},D=new class{constructor(){yi(this,"proxyServerURL",void 0),yi(this,"logLevel",ko.DEBUG),yi(this,"uploadState","collecting"),yi(this,"uploadLogWaitingList",[]),yi(this,"uploadLogUploadingList",[]),yi(this,"uploadErrorCount",0),yi(this,"currentLogID",0),yi(this,"url",void 0),yi(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[ko.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[ko.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[ko.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[ko.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[ko.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){wn("UPLOAD_LOG",!0)}disableLogUpload(){wn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new VJ(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-Vw<100)return void setTimeout(()=>{this.log(...t)},Date.now()-Vw);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=eP()+" Agora-SDK [".concat($S(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const s=eP()+" %cAgora-SDK [".concat($S(r),"]:");let l=[];if(!Y("USE_NEW_LOG"))switch(r){case ko.DEBUG:l=[s,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,l);break;case ko.INFO:l=[s,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,l);break;case ko.WARNING:l=[s,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,l);break;case ko.ERROR:l=[s,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,l)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-Vw<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-Vw);const r=Math.max(0,Math.min(4,t[0]));t[0]=eP()+" Agora-SDK [".concat($S(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!Y("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=jV()+" Agora-SDK [".concat($S(e),"]:"):n[0]=jV()+" Agora-SDK [".concat($S(e),"]:");let s="";n.forEach(l=>{typeof l=="object"&&(l=JSON.stringify(l)),s+="".concat(l," ")}),this.uploadLogWaitingList.push({payload_str:s,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:Lo,process_id:Y("PROCESS_ID"),payload:JSON.stringify(e)};return El(async()=>{const n=await Bs.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(Y("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(Y("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=n,r}},()=>(this.uploadLogUploadingList=[],!1),n=>{const r={status:-1,message:n.message,errorRange:e.map(s=>s.log_item_id)};return n.response?(r.status=n.response.status,r.data=n.response.data,r.headers=n.response.headers):n.request&&(r.status=n.request.status),UV.reportLogUploadError(r),!0},{timeout:Y("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:Y("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,Y("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),Y("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),Y("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),Y("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var VV;function FJ(e){return Sr(e.reportId,"params.reportId",0,100,!1),Sr(e.category,"params.category",0,100,!1),Sr(e.event,"params.event",0,100,!1),Sr(e.label,"params.label",0,100,!1),On(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(VV={}).FREE="free",VV.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const BJ={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let rr=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),ii=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let GJ=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Rt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,r){const s=r.value;if(typeof s=="function"){const l=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var h,p=arguments.length,m=new Array(p),g=0;g<p;g++)m[g]=arguments[g];let v=m;if(e.argsMap)try{v=e.argsMap(this,...m)}catch(C){D.warning(C),v=[]}try{JSON.stringify(v)}catch{D.warning("arguments for method ".concat(l,".").concat(String(n)," not serializable for apiInvoke.")),v=[]}const T=(e.report||ft).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(l,".").concat(String(n)),options:v,tag:Ei.TRACER,reportResult:e.reportResult},e.throttleTime);try{const C=s.apply(this,m);return C instanceof Je?C.then(I=>(T.onSuccess(e.reportResult&&I),I)).catch(I=>{throw T.onError(I),I}):(T.onSuccess(e.reportResult&&C),C)}catch(C){throw T.onError(C),C}}}return r}}const ft=new class{constructor(){yi(this,"baseInfoMap",new Map),yi(this,"proxyServer",void 0),yi(this,"eventUploadTimer",void 0),yi(this,"setSessionIdTimer",void 0),yi(this,"url",void 0),yi(this,"sids",new Set),yi(this,"backupUrl",void 0),yi(this,"_appId",void 0),yi(this,"_aid",0),yi(this,"keyEventUploadPendingItems",[]),yi(this,"normalEventUploadPendingItems",[]),yi(this,"apiInvokeUploadPendingItems",[]),yi(this,"apiInvokeCount",0),yi(this,"apiInvokeLoggedCount",0),yi(this,"ltsList",[]),yi(this,"lastSendNormalEventTime",Date.now()),yi(this,"customReportCounterTimer",void 0),yi(this,"customReportCount",0),yi(this,"extApiInvoke",async e=>{for(const t of e){const n=jt(jt({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Ei.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),Y("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),Y("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,r]=t;return n+r}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const s=this.apiInvokeCount,l=!!Y("SHOW_REPORT_INVOKER_LOG"),h=!!Y("SHOW_REPORT_USER_INVOKER_LOG"),p=l||h&&t.id;p&&(this.apiInvokeLoggedCount+=1);const m=this.apiInvokeLoggedCount;function g(I,U){if(p){let k="[apiInvoke-".concat(m,"]");if(t.id&&(k+="[".concat(t.id,"]")),t.name&&(k+="[".concat(t.name,"]"),t.name===Mi.JOIN))return D.info("".concat(k," ").concat(I));D.info("".concat(k," ").concat(I),I==="start"?t.options:U||"")}}const v=()=>({tag:t.tag,invokeId:s,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});g("start");let T=!1;Tr(t.timeout).then(()=>{T||(this.sendApiInvoke(jt(jt({},v()),{},{error:H.API_INVOKE_TIMEOUT,success:!1})),g("timeout"))});const C=new Re(H.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:I=>{const U=()=>{if(T)throw C;return T=!0,this.sendApiInvoke(jt(jt({},v()),{},{success:!0},t.reportResult&&{result:I})),g("onSuccess"),I};return n?EV(U,t.name+"Success",n,()=>T=!0):U()},onError:I=>{const U=()=>{if(T)throw I;T=!0,this.sendApiInvoke(jt(jt({},v()),{},{success:!1,error:I})),g("onFailure",I.toString())};return n?EV(U,t.name+"Error",n,()=>T=!0):U()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const s=Object.assign({},{willUploadConsoleLog:Y("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:XD?"global":"oversea",areas:Y("AREAS")&&Y("AREAS").join(",")},t.extend),{stringUid:l,channelProfile:h,channelMode:p,isABTestSuccess:m,lsid:g,clientRole:v}=t,T=Date.now(),C=jt(jt({},r),{},{eventType:rr.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:QD,lts:T,elapse:T-n,extend:JSON.stringify(s),mode:t.mode,process:Y("PROCESS_ID"),appType:Y("APP_TYPE"),success:!0,version:Lo,stringUid:l,channelProfile:h,channelMode:p,isABTestSuccess:m,lsid:g,clientType:Ye(I=window.navigator.userAgent).call(I,"AgoraWebView")?42:20,clientRole:v,serviceId:Y("PROCESS_ID"),extensionID:Y("PLUGIN_INFO").join(",")||""});var I;this.send({type:ii.SESSION,data:C},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,s=Date.now(),l=jt(jt({},r),{},{role:t.role,eventType:rr.JOIN_CHOOSE_SERVER,lts:s,eventElapse:t.elapse||s-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:s-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:ii.JOIN_CHOOSE_SERVER,data:l},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,s=Date.now(),l=jt(jt({},r),{},{eventType:rr.REQ_USER_ACCOUNT,lts:s,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||s-n.startTime,eventElapse:s-t.lts,extend:JSON.stringify(t.extend)});this.send({type:ii.REQ_USER_ACCOUNT,data:l},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const s=Date.now(),{firstSuccess:l,addr:h,isProxy:p}=t,m=s-n.startTime,g=jt(jt({},r),{},{eventType:rr.JOIN_GATEWAY,lts:s,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:m,eventElapse:s-t.lts,firstSuccess:l,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:YD(),isABTestSuccess:t.isABTestSuccess?1:0}),v=g.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=s),l)this.send({type:ii.JOIN_GATEWAY,data:g},!0);else{let T;if(h)if(p){const I=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),U=h.match(/p=[0-9]{1,6}/g);T={isSuccess:v,gatewayIp:I&&I.length?I[0].split("=")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split("=")[1]:"",isProxy:p?1:0}}else{const I=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),U=h.match(/(:|p=)[0-9]{1,6}/g);T={isSuccess:v,gatewayIp:I&&I.length?I[0].split("//")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split(/:|p=/g)[1]:"",isProxy:p?1:0}}else T={isSuccess:v,gatewayIp:"",port:"",isProxy:p?1:0};delete g.success,delete g.eventType,delete g.firstSuccess,g.vid=Number(g.vid);const C=Object.assign({},g,T,{eventType:rr.REJOIN_GATEWAY});this.send({type:ii.RE_JOIN_GATEWAY,data:C},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),s=jt(jt({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:ii.JOIN_CHANNEL_TIMEOUT,data:s},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,s=Date.now(),l=jt(jt({},r),{},{eventType:rr.PUBLISH,lts:s,eventElapse:t.eventElapse,elapse:s-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:ii.PUBLISH,data:l},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,l=Date.now(),h=jt(jt({},s),{},{eventType:rr.SUBSCRIBE,lts:l,eventElapse:t.eventElapse,elapse:l-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?h.peerSuid=t.peerid:h.peer=t.peerid,this.send({type:ii.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var t;const n=[...no(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",s=this.baseInfoMap.get(r);if(!s)return;const l=s.info,h=Date.now(),p=jt(jt({},l),{},{eventType:rr.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-s.startTime,status:e.status?1:2});this.send({type:ii.WS_COMPRESSOR_INIT,data:p},!0)}firstRemoteVideoDecode(e,t,n,r){const s=this.baseInfoMap.get(e);if(!s)return;const l=s.info,h=Date.now(),p=jt(jt(jt({},l),r),{},{elapse:h-s.startTime,eventType:t,lts:h,firstDecodeFrame:Math.max((r.firstFrame||h)-s.startTime,0),apEnd:Math.max(r.apEnd-s.startTime,0),apStart:Math.max(r.apStart-s.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-s.startTime,0),joinGwStart:Math.max(r.joinGwStart-s.startTime,0),pcEnd:Math.max(r.pcEnd-s.startTime,0),pcStart:Math.max(r.pcStart-s.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-s.startTime,0),subscriberStart:Math.max(r.subscriberStart-s.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-s.startTime,0)});this.send({type:n,data:p},!0)}firstRemoteFrame(e,t,n,r){const s=this.baseInfoMap.get(e);if(!s)return;const l=s.info,h=Date.now(),p=jt(jt(jt({},l),r),{},{elapse:h-s.startTime,eventType:t,lts:h});this.send({type:n,data:p},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,s=Date.now(),l=jt(jt(jt({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:s-n.startTime,eventType:rr.AB_TEST,lts:s});this.send({type:ii.AB_TEST,data:l},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,s=Date.now(),l=jt(jt(jt({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:s-n.startTime,eventType:rr.PC_STATS,lts:s,preallocation:t.preallocation?1:0});this.send({type:ii.PC_STATS,data:l},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,s=Date.now(),l=jt(jt(jt({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),eventType:rr.UPDATE_REMOTE_RTPCAPABILITIES,lts:s});this.send({type:ii.UPDATE_REMOTE_RTPCAPABILITIES,data:l},!0)}}onGatewayStream(e,t,n,r){const s=this.baseInfoMap.get(e);if(!s)return;const l=s.info,h=Date.now(),p=jt(jt(jt({},l),r),{},{eventType:t,lts:h});this.send({type:n,data:p},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,s=Date.now(),l=jt(jt({},r),{},{eventType:rr.STREAM_SWITCH,lts:s,isDual:t.isdual,elapse:s-n.startTime,success:t.succ});this.send({type:ii.STREAM_SWITCH,data:l},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,s=Date.now(),l=jt(jt({},r),{},{eventType:rr.REQUEST_PROXY_APPCENTER,lts:s,eventElapse:s-t.lts,elapse:s-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:ii.REQUEST_PROXY_APPCENTER,data:l},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,s=Date.now(),l=jt(jt({},r),{},{eventType:rr.REQUEST_PROXY_WORKER_MANAGER,lts:s,eventElapse:s-t.lts,elapse:s-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:ii.REQUEST_PROXY_WORKER_MANAGER,data:l},!0)}setProxyServer(e){this.proxyServer=e,e?D.debug("reportProxyServerurl: ".concat(e)):D.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,s=Date.now(),l=jt(jt({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:s,elapse:s-n.startTime,joinChannelSuccessElapse:s-(n.lastJoinSuccessTime||s),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:ii.PEER_PUBLISH_STATUS,data:l},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,s=Date.now();(function(l,h,p){const m=l[h];if(!m||typeof m!="string")return[l];l[h]="";const g=vd(JSON.stringify(l));let v=0;const T=[];let C=0;for(let I=0;I<m.length;I++)C+=m.charCodeAt(I)<=127?1:3,C<=p-g||(T[T.length]=at(at({},l),{},{[h]:m.substring(v,I)}),v=I,C=m.charCodeAt(I)<=127?1:3);return v!==m.length-1&&(T[T.length]=at(at({},l),{},{[h]:m.substring(v)})),T})(jt(jt(jt({},r),t),{},{elapse:s-n.startTime,lts:s,productType:"WebRTC"}),"payload",1300).forEach(l=>this.send({type:ii.WORKER_EVENT,data:l},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,s=Date.now(),l=jt(jt(jt({},r),t),{},{elapse:s-n.startTime,lts:s});this.send({type:ii.AP_WORKER_EVENT,data:l},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,s=Date.now(),l=jt(jt(jt({},r),t),{},{elapse:s-n.startTime,lts:s,extend:t.extend||void 0});this.send({type:ii.JOIN_WEB_PROXY_AP,data:l},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,s=Date.now(),l=jt(jt(jt({},r),t),{},{elapse:s-n.startTime,lts:s});this.send({type:ii.WEBSOCKET_QUIT,data:l},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>Y("CUSTOM_REPORT_LIMIT"))throw new Re(H.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),r=t.map(s=>({type:ii.USER_ANALYTICS,data:jt(jt({sid:e},s),{},{lts:n})}));try{Y("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(s){throw D.error("send custom report message failed",s.toString()),new Re(H.CUSTOM_REPORT_SEND_FAILED,s.message)}}sendApiInvoke(e){const t=Y("NOT_REPORT_EVENT");if(e.tag&&Ye(t)&&Ye(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:s,cid:l}=n.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Re){const{code:m,message:g}=e.error;h=m||g||e.error.toString()}else h=e.error.toString();const p={invokeId:e.invokeId,sid:e.sid,cname:r,cid:l,uid:s,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:ii.API_INVOKE,data:p},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>Y("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const l=e.shift();n.length<20?n.push(l):r.push(l)}e.push(...r);for(const l of[...n]){var s;this.ltsList.indexOf(l.data.lts)!==-1?(l.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(l.data.lts)):(this.ltsList.push(l.data.lts),Pt(s=this.ltsList).call(s,(h,p)=>h-p))}return t||(this.lastSendNormalEventTime=Date.now()),Y("ENABLE_EVENT_REPORT")&&n.length&&(Y("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((l=>h=>{Y("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(l):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(l),this.normalEventUploadPendingItems.length>Y("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-Y("NORMAL_EVENT_QUEUE_CAPACITY")),D.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Ui.networkState===ka.OFFLINE&&await Je.race([Ui.onlineWaiter,Tr(2*Gi.maxRetryTimeout)]);const t=s=>{let l=new Uint8Array;return s.forEach(h=>{const p=xD(JSON.stringify(h.data)),m=new ArrayBuffer(5),g=(T=>{let C=0;return Object.entries(ii).forEach(I=>{let[U,k]=I;k===T.type&&(C=GJ[U])}),C})(h),v=new DataView(m);v.setUint16(0,p.byteLength,!0),v.setUint8(2,255&g),v.setUint8(3,g>>>8&255),v.setUint8(4,g>>>16&255),l=lV(l,new Uint8Array(m)),l=lV(l,p)}),l},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Y("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(Y("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let s=0;s<2;s+=1){s===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Y("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(Y("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await HD(r,{timeout:1e4,data:t(e),headers:jt(jt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(l){if(s===1)throw l;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(p=>{const m=p&&p.data.sid&&this.baseInfoMap.get(p.data.sid);return m&&m.info.vid&&+m.info.vid||0})(e[0]),r=n?void 0:this._aid,s={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(p=>JSON.stringify(p)),vid:n,aid:r};Ui.networkState===ka.OFFLINE&&await Je.race([Ui.onlineWaiter,Tr(2*Gi.maxRetryTimeout)]);const l=t?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Y("EVENT_REPORT_DOMAIN"),"&p=").concat(Y("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(Y("EVENT_REPORT_DOMAIN"),":").concat(Y("STATS_COLLECTOR_PORT")).concat(l));for(let p=0;p<2;p+=1){p===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Y("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(Y("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(Y("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(Y("STATS_COLLECTOR_PORT")).concat(l)));try{t?await AJ(h,{timeout:1e4,data:s}):await HD(h,{timeout:1e4,data:s})}catch(m){if(p===1)throw m;continue}return}}createBaseInfo(e,t){const n=Object.assign({},BJ);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:Ei.TRACER}).onSuccess()}};UV.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Ui.networkState,ft.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Ei.TRACER}).onSuccess("logUploadError")});class ye extends Re{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),yi(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,D)}throw(){super.throw(D)}}const Rr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function cn(){return Rr}function FV(){return"setSinkId"in HTMLAudioElement.prototype&&(!Y("RESTRICTION_SET_PLAYBACK_DEVICE")||(xu()||Qj())&&!PD())}function BV(){return!Rr.supportUnifiedPlan||Y("CHROME_FORCE_PLAN_B")&&Mu()}let br=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function pE(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function ln(e,t,n,r,s){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:s}}function Cc(e,t,n,r,s){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:s}}function tP(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const HJ={"90p":ln(160,90),"90p_1":ln(160,90),"120p":ln(160,120,15,30,65),"120p_1":ln(160,120,15,30,65),"120p_3":ln(120,120,15,30,50),"120p_4":ln(212,120),"180p":ln(320,180,15,30,140),"180p_1":ln(320,180,15,30,140),"180p_3":ln(180,180,15,30,100),"180p_4":ln(240,180,15,30,120),"240p":ln(320,240,15,40,200),"240p_1":ln(320,240,15,40,200),"240p_3":ln(240,240,15,40,140),"240p_4":ln(424,240,15,40,220),"360p":ln(640,360,15,80,400),"360p_1":ln(640,360,15,80,400),"360p_3":ln(360,360,15,80,260),"360p_4":ln(640,360,30,80,600),"360p_6":ln(360,360,30,80,400),"360p_7":ln(480,360,15,80,320),"360p_8":ln(480,360,30,80,490),"360p_9":ln(640,360,15,80,800),"360p_10":ln(640,360,24,80,800),"360p_11":ln(640,360,24,80,1e3),"480p":ln(640,480,15,100,500),"480p_1":ln(640,480,15,100,500),"480p_2":ln(640,480,30,100,1e3),"480p_3":ln(480,480,15,100,400),"480p_4":ln(640,480,30,100,750),"480p_6":ln(480,480,30,100,600),"480p_8":ln(848,480,15,100,610),"480p_9":ln(848,480,30,100,930),"480p_10":ln(640,480,10,100,400),"720p":ln(1280,720,15,120,1130),"720p_auto":ln(1280,720,30,900,3e3),"720p_1":ln(1280,720,15,120,1130),"720p_2":ln(1280,720,30,120,2e3),"720p_3":ln(1280,720,30,120,1710),"720p_5":ln(960,720,15,120,910),"720p_6":ln(960,720,30,120,1380),"1080p":ln(1920,1080,15,120,2080),"1080p_1":ln(1920,1080,15,120,2080),"1080p_2":ln(1920,1080,30,120,3e3),"1080p_3":ln(1920,1080,30,120,3150),"1080p_5":ln(1920,1080,60,120,4780),"1440p":ln(2560,1440,30,120,4850),"1440p_1":ln(2560,1440,30,120,4850),"1440p_2":ln(2560,1440,60,120,7350),"4k":ln(3840,2160,30,120,8910),"4k_1":ln(3840,2160,30,120,8910),"4k_3":ln(3840,2160,60,120,13500)},zJ={"480p":Cc(640,480,5),"480p_1":Cc(640,480,5),"480p_2":Cc(640,480,30),"480p_3":Cc(640,480,15),"720p":Cc(1280,720,5),"720p_auto":ln(1280,720,30,900,3e3),"720p_1":Cc(1280,720,5),"720p_2":Cc(1280,720,30),"720p_3":Cc(1280,720,15),"1080p":Cc(1920,1080,5),"1080p_1":Cc(1920,1080,5),"1080p_2":Cc(1920,1080,30),"1080p_3":Cc(1920,1080,15)},WJ={"1SL1TL":tP(1,1),"3SL3TL":tP(3,3),"2SL3TL":tP(2,3)};function wc(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},HJ[e]):e}function nP(e){return typeof e=="string"?Object.assign({},zJ[e]):e}function Fw(e){return typeof e=="string"?Object.assign({},WJ[e]):e}const qJ={speech_low_quality:pE(16e3,!1),speech_standard:pE(32e3,!1,18),music_standard:pE(48e3,!1),standard_stereo:pE(48e3,!0,56),high_quality:pE(48e3,!1,128),high_quality_stereo:pE(48e3,!0,192)};function Bw(e){return typeof e=="string"?Object.assign({},qJ[e]):e}const fE=[];function GV(e){return er(e,"mediaSource",["screen","window","application"]),!0}let lt=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Dn=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),mE=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),KJ=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),YJ=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),bm=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),_E=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),gE=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),EE=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),io=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const iP={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},rP={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},HV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},XJ={uplinkNetworkQuality:0,downlinkNetworkQuality:0},zV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Is=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),ro=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),ZS=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Cm=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),ls=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Td=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const sP={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Gw=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function en(e,t,n,r,s){var l,h,p={};return Object.keys(r).forEach(function(m){p[m]=r[m]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=na(l=U_(h=n.slice()).call(h)).call(l,function(m,g){return g(e,t,m)||m},p),s&&p.initializer!==void 0&&(p.value=p.initializer?p.initializer.call(s):void 0,p.initializer=void 0),p.initializer===void 0?(Object.defineProperty(e,t,p),null):p}function Ee(e,t,n){return(t=function(r){var s=function(l,h){if(typeof l!="object"||!l)return l;var p=l[Symbol.toPrimitive];if(p!==void 0){var m=p.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(r);return typeof s=="symbol"?s:s+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function WV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function ri(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?WV(Object(n),!0).forEach(function(r){Ee(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class qV extends ai{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(bm.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),Ee(this,"trackMediaType",void 0),Ee(this,"_ID",void 0),Ee(this,"_rtpTransceiver",void 0),Ee(this,"_lowRtpTransceiver",void 0),Ee(this,"_hints",[]),Ee(this,"_isClosed",!1),Ee(this,"_originMediaStreamTrack",void 0),Ee(this,"mediaStreamTrack",void 0),Ee(this,"_external",{}),this._ID=n||Bn(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(r){Ye(fE).call(fE,r)||fE.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||dp(()=>{var n;ft.reportApiInvoke(null,{name:Mi.GET_MEDIA_STREAM_TRACK,options:[],tag:Ei.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===mE.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=fE.indexOf(t);n!==-1&&fE.splice(n,1)}(this),this.emit(_E.CLOSED),this.removeAllListeners(bm.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===mE.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(bm.TRANSCEIVER_UPDATED,t,n)}}class yE extends qV{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),Ee(this,"_enabled",!0),Ee(this,"_muted",!1),Ee(this,"_isExternalTrack",!1),Ee(this,"_isClosed",!1),Ee(this,"_enabledMutex",void 0),Ee(this,"processor",void 0),Ee(this,"_processorContext",void 0),Ee(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Wr("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,D.debug("[".concat(this.getTrackId(),"] close")),this.emit(lt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Mn(this,lt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(_E.TRACK_ENDED)}stateCheck(t,n){if(D.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),Uu(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new Re(H.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",D);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new Re(H.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",D)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Je.resolve([])}}const KV=window.AudioContext||window.webkitAudioContext;let so=null;const An=new class extends ai{constructor(){super(...arguments),Ee(this,"prevState",void 0),Ee(this,"curState",void 0),Ee(this,"currentTime",void 0),Ee(this,"currentTimeStuckAt",void 0),Ee(this,"interruptDetectorTrack",void 0),Ee(this,"onLocalAudioTrackMute",()=>{D.info("ios15-interruption-start"),this.emit(br.IOS_15_16_INTERRUPTION_START)}),Ee(this,"onLocalAudioTrackUnmute",async()=>{D.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?D.info("ios15-interruption-end-canceled"):(so&&await so.suspend(),this.emit(br.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){D.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){D.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function vE(){if(!so){if(function(){if(!KV)return void D.error("your browser is not support web audio");D.info("create audio context");const e=ri({},Y("WEBAUDIO_INIT_OPTIONS"));D.debug("audio context init option:",JSON.stringify(e)),so=new KV(e),An.curState=so.state,so.onstatechange=()=>{An.prevState=An.curState,An.curState=so?so.state:void 0;const{prevState:t,curState:n}=An,r=n==="running",s=n==="interrupted",l=t==="running",h=t==="suspended",p=t==="interrupted",m=on().osVersion;(As()||Rc())&&l&&s&&(D.info("ios".concat(m,"-interruption-start")),An.emit(br.IOS_INTERRUPTION_START)),(As()||Rc())&&(h||p)&&r&&(D.info("ios".concat(m,"-interruption-end")),An.emit(br.IOS_INTERRUPTION_END)),t!==n&&An.emit(br.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=so)===null||t===void 0?void 0:t.currentTime;An.currentTime!==n?(An.currentTimeStuckAt&&(D.debug("AudioContext current time resume at ".concat(n)),An.currentTimeStuckAt=void 0),An.currentTime=n):(n!==An.currentTimeStuckAt&&(ft.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Ei.TRACER}).onSuccess(),D.warning("AudioContext current time stuck at ".concat(n))),An.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,s=!1,l=!1,h=!1;function p(k){t.state==="running"?m(!1):As()||Rc()?t.state==="suspended"&&(m(!0),k&&t.resume().then(g,g)):t.state!=="closed"&&(m(!0),k&&t.resume().then(g,g))}function m(k){if(s!==k){s=k;for(let M=0,F=n;M<F.length;M+=1){const B=F[M];k?window.addEventListener(B,v,{capture:!0,passive:!0}):window.removeEventListener(B,v,{capture:!0,passive:!0})}}}function g(){p(!1)}function v(){p(!0)}function T(k){if(!h)if(r.paused)if(k){let M;C(!1),h=!0;try{M=r.play(),M?M.then(I,I):(r.addEventListener("playing",I),r.addEventListener("abort",I),r.addEventListener("error",I))}catch{I()}}else C(!0);else C(!1)}function C(k){if(l!==k){l=k;for(let M=0,F=n;M<F.length;M++){const B=F[M];k?window.addEventListener(B,U,{capture:!0,passive:!0}):window.removeEventListener(B,U,{capture:!0,passive:!0})}}}function I(){r.removeEventListener("playing",I),r.removeEventListener("abort",I),r.removeEventListener("error",I),h=!1,T(!1)}function U(){T(!0)}if(As()){const k=t.createMediaStreamDestination(),M=document.createElement("div");M.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=M.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=k.stream,T(!0)}An.on(br.STATE_CHANGE,function(){p(!0)}),p(!1)}(so)}(),!so)throw new Re(H.NOT_SUPPORTED,"can not create audio context");return so}return so}function wm(e){if(function(){if(aP!==null)return aP;const r=vE(),s=r.createBufferSource(),l=r.createGain(),h=r.createGain();s.connect(l),s.connect(h),s.disconnect(l);let p=!1;try{s.disconnect(l)}catch{p=!0}return s.disconnect(),aP=p,p}())return;const t=e.connect,n=e.disconnect;e.connect=(r,s,l)=>{var h;return e._inputNodes||(e._inputNodes=[]),Ye(h=e._inputNodes).call(h,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,s,l)):t.call(e,r,s)),e},e.disconnect=(r,s,l)=>{n.call(e),r?Dw(e._inputNodes,r):e._inputNodes=[];for(const h of e._inputNodes)t.call(e,h)}}let aP=null;function oP(e,t){let n=!1;const r=1/t;if(Y("DISABLE_WEBAUDIO")){const s=window.setInterval(()=>{n?window.clearInterval(s):e(performance.now()/1e3)},1e3*r)}else{const s=vE();let l=s.createGain();l.gain.value=0,l.connect(s.destination);const h=()=>{if(n)return void(l=null);const p=s.createOscillator();p.onended=h,p.connect(l),p.start(0),p.stop(s.currentTime+r),e(s.currentTime)};h()}return()=>{n=!0}}class YV{constructor(){Ee(this,"context",void 0),Ee(this,"analyserNode",void 0),Ee(this,"sourceNode",void 0),this.context=vE(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||As()||Rc()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let s=0;s<t.length;++s)t[s]=r[s]/128-1}const n=na(t).call(t,(r,s)=>r+s*s,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{D.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class XV extends ai{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Ee(this,"outputNode",void 0),Ee(this,"outputTrack",void 0),Ee(this,"isPlayed",!1),Ee(this,"sourceNode",void 0),Ee(this,"context",void 0),Ee(this,"audioBufferNode",void 0),Ee(this,"destNode",void 0),Ee(this,"audioOutputLevel",0),Ee(this,"volumeLevelAnalyser",void 0),Ee(this,"_processedNode",void 0),Ee(this,"playNode",void 0),Ee(this,"isDestroyed",!1),Ee(this,"onNoAudioInput",void 0),Ee(this,"isNoAudioInput",!1),Ee(this,"_noAudioInputCount",0),this.context=vE(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),wm(this.outputNode),this.volumeLevelAnalyser=new YV}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(io.ON_AUDIO_BUFFER,function(r){for(let s=0;s<r.outputBuffer.numberOfChannels;s+=1){const l=r.outputBuffer.getChannelData(s);for(let h=0;h<l.length;h+=1)l[h]=0}return r.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!cn().webAudioMediaStreamDest)throw new Re(H.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&Pw(()=>{An.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;As()||Rc()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let s=!1;for(let l=0;l<r.length;l++)r[l]!==0&&(s=!0);return s?(this.isNoAudioInput=!1,!0):(await Tr(200),await this.checkHasAudioInput(t?t+1:1)&&s)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class JV extends XV{get isFreeze(){return!1}constructor(t,n,r){var s;if(super(),Ee(this,"sourceNode",void 0),Ee(this,"track",void 0),Ee(this,"clonedTrack",void 0),Ee(this,"audioElement",void 0),Ee(this,"isCurrentTrackCloned",!1),Ee(this,"isRemoteTrack",!1),Ee(this,"originVolumeLevelAnalyser",void 0),Ee(this,"rebuildWebAudio",async()=>{if(D.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void D.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>D.info("resume success")),D.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const p=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?p.stop():this.isCurrentTrackCloned=!0;const m=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(m),wm(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const g=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(g,this.context.currentTime),wm(this.outputNode),this.emit(io.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=m,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new Re(H.UNEXPECTED_ERROR);this.track=t;const l=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(l),wm(this.sourceNode),r){const p=r.clone();p.enabled=!0,this.clonedTrack=p,D.debug("create an unmuted track ".concat(p.id," from the original track ").concat(r.id," to get the volume"));const m=this.context.createMediaStreamSource(new MediaStream([p]));wm(m),this.originVolumeLevelAnalyser=new YV,this.originVolumeLevelAnalyser.updateSource(m)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=l;const h=on();n&&h.os===ir.IOS&&Number((s=h.osVersion)===null||s===void 0?void 0:s.split(".")[0])<15&&(An.on(br.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(p=>{p||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),wm(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(io.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),An.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),D.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([n]));wm(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function QV(e,t,n){const r=(l,h)=>l?typeof l!="number"?l.max||l.exact||l.ideal||l.min||h:l:h,s={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(s.video.mandatory.maxFrameRate=t.frameRate.max,s.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(s.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(s)}async function JJ(e,t){const n=await $V(e.mediaSource),{sourceId:r,audio:s}=await function(l){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Je((p,m)=>{const g=document.createElement("div");g.innerText="share screen",g.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const v=document.createElement("div");v.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const T=document.createElement("div");T.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",T.setAttribute("style","height: 12%;");const C=document.createElement("div");C.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const I=document.createElement("div");I.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const U=document.createElement("button");U.innerHTML="cancel",U.setAttribute("style","width: 85px;"),U.onclick=()=>{document.body.removeChild(F);const B=new Error("NotAllowedError");B.name="NotAllowedError",m(B)};let k=h;const M=document.createElement("div");if(h){const B=document.createElement("input");B.setAttribute("type","checkbox");const ee=document.createElement("span");B.setAttribute("style","margin-right: 6px;"),ee.innerText="Share audio",B.checked=k,B.onchange=()=>{k=B.checked},M.appendChild(B),M.appendChild(ee)}I.appendChild(M),I.appendChild(U),v.appendChild(T),v.appendChild(C),v.appendChild(I);const F=document.createElement("div");F.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),F.appendChild(g),F.appendChild(v),document.body.appendChild(F),l.map(B=>{if(B.id){const ee=document.createElement("div");ee.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ue=B.thumbnail;try{const{width:de}=ue.getSize();de>1920&&(ue=ue.resize({width:1920}))}catch(de){throw de&&de.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),de}ee.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ue.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+B.name.replace(/[\u00A0-\u9999<>\&]/g,function(de){return"&#"+de.charCodeAt(0)+";"})+"</span>",ee.onclick=()=>{document.body.removeChild(F),p({sourceId:B.id,audio:k})},C.appendChild(ee)}})})}(n,t);return await QV(r,e,s)}async function $V(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=dV();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new Re(H.ELECTRON_IS_NULL);let r=null;try{var s;r=((s=n.desktopCapturer)===null||s===void 0?void 0:s.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new Je((l,h)=>{n.desktopCapturer.getSources({types:t},(p,m)=>{p?h(p):l(m)})}));try{return await r}catch(l){throw new Re(H.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,l.toString())}}const cP=new Wr("safari");let ZV=!1,eF=!1;async function ao(e,t){let n=0,r=null;for(;n<2;)try{r=await QJ(e,t,n>0);break}catch(s){if(s instanceof Re)throw D.error("[".concat(t,"] ").concat(s.toString())),s;const l=Hw(s.name||s.code||s,s.message);if(l.code===H.MEDIA_OPTION_INVALID){D.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Tr(500);continue}throw D.error("[".concat(t,"] ").concat(l.toString())),l}if(!r)throw new Re(H.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function QJ(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Re(H.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=cn(),s=new MediaStream;if(e.audioSource&&s.addTrack(e.audioSource),e.videoSource&&s.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return D.debug("Using Video Source/ Audio Source"),s;if(e.screen)if(dV())e.screen.sourceId?SE(s,await QV(e.screen.sourceId,e.screen,!!e.screenAudio)):SE(s,await JJ(e.screen,!!e.screenAudio));else if(xu()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new Re(H.NOT_SUPPORTED,"This browser does not support screen sharing");D.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const C=await(h=e.screen.extensionId,p=t,new Je((I,U)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},k=>{if(!k||!k.streamId)return D.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),k),void U(new Re(H.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));I(k.streamId)})}catch(k){D.error("[".concat(p,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),k.toString()),U(new Re(H.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=C,SE(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var l;e.screen.mediaSource&&GV(e.screen.mediaSource);const C={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(l=e.screen.displaySurface)!==null&&l!==void 0?l:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:I,surfaceSwitching:U,systemAudio:k,preferCurrentTab:M}=e.screen,F={selfBrowserSurface:I,surfaceSwitching:U,systemAudio:k,preferCurrentTab:M};!I&&delete F.selfBrowserSurface,!U&&delete F.surfaceSwitching,!k&&delete F.systemAudio,!M&&delete F.preferCurrentTab,D.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:C,audio:e.screenAudio,controls:F})),SE(s,await navigator.mediaDevices.getDisplayMedia(ri({video:C,audio:e.screenAudio},F)))}else{if(!_i())throw D.error("[".concat(t,"] This browser does not support screenSharing")),new Re(H.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&GV(e.screen.mediaSource);const C={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};D.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(C))),SE(s,await navigator.mediaDevices.getUserMedia(C))}}var h,p;if(!e.video&&!e.audio)return s;let m={video:e.video,audio:e.audio},g=Y("MEDIA_DEVICE_CONSTRAINTS");if(g)try{typeof g=="string"&&(g=JSON.parse(g)),m=jD(m,g)}catch{}D.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(m)),on();let v,T=null;(Dr()||As()||Nw())&&(T=await cP.lock());try{v=await navigator.mediaDevices.getUserMedia(m)}catch(C){throw T&&T(),C}return m.audio&&(ZV=!0),m.video&&(eF=!0),SE(s,v),T&&T(),s}function Hw(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Re(H.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new Re(H.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new Re(H.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new Re(H.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Re(H.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new Re(H.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return D.error("getUserMedia unexpected error",e),new Re(H.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function SE(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],s=t.getVideoTracks()[0],l=t.getAudioTracks()[0];l&&(r&&e.removeTrack(r),e.addTrack(l)),s&&(n&&e.removeTrack(n),e.addTrack(s))}const oo=new class extends ai{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Cm.STATE_CHANGE,e),this._state=e)}constructor(){super(),Ee(this,"_state",ZS.IDLE),Ee(this,"isAccessMicrophonePermission",!1),Ee(this,"isAccessCameraPermission",!1),Ee(this,"lastAccessMicrophonePermission",!1),Ee(this,"lastAccessCameraPermission",!1),Ee(this,"checkdeviceMatched",!1),Ee(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(Y("ENUMERATE_DEVICES_INTERVAL")||(Ow()||Iw()===ir.HARMONY_OS)&&Mu())&&this.updateDevicesInfo()},Y("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>D.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Re(H.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),s=this.checkMediaDeviceInfoIsOk(r);let l=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&t;s.audio&&(l=!1),s.video&&(h=!1);let p=null,m=null,g=null;if(!n&&(l||h)){if(cP.isLocked&&(D.debug("[device manager] wait GUM lock"),(await cP.lock())(),D.debug("[device manager] GUM unlock")),ZV&&(l=!1,this.isAccessMicrophonePermission=!0),eF&&(h=!1,this.isAccessCameraPermission=!0),D.debug("[device manager] check media device permissions",e,t,l,h),l&&h){try{g=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(v){const T=Hw(v.name||v.code||v,v.message);if(T.code===H.PERMISSION_DENIED)throw T;D.warning("getUserMedia failed in getDevices",T)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(l){try{p=await navigator.mediaDevices.getUserMedia({audio:e})}catch(v){const T=Hw(v.name||v.code||v,v.message);if(T.code===H.PERMISSION_DENIED)throw T;D.warning("getUserMedia failed in getDevices",T)}this.isAccessMicrophonePermission=!0}else if(h){try{m=await navigator.mediaDevices.getUserMedia({video:t})}catch(v){const T=Hw(v.name||v.code||v,v.message);if(T.code===H.PERMISSION_DENIED)throw T;D.warning("getUserMedia failed in getDevices",T)}this.isAccessCameraPermission=!0}D.debug("[device manager] mic permission",e,"cam permission",t)}try{const v=await navigator.mediaDevices.enumerateDevices();return p&&p.getTracks().forEach(T=>T.stop()),m&&m.getTracks().forEach(T=>T.stop()),g&&g.getTracks().forEach(T=>T.stop()),p=null,m=null,g=null,v}catch(v){return p&&p.getTracks().forEach(T=>T.stop()),m&&m.getTracks().forEach(T=>T.stop()),g&&g.getTracks().forEach(T=>T.stop()),p=null,m=null,g=null,new Re(H.ENUMERATE_DEVICES_FAILED,v.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new Re(H.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=ZS.INITING;try{await this.updateDevicesInfo(),this.state=ZS.INITEND}catch(e){throw D.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=ZS.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Re(H.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const s=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),l=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");s&&l?l.groupId===s.groupId?D.debug("[device-check] default input ".concat(s.label," and output ").concat(l.label," is the same group")):D.debug("[device-check] default input ".concat(s.label," and output ").concat(l.label," is not the same group")):D.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(s=>{if(!s.deviceId)return;const l=this.deviceInfoMap.get("".concat(s.kind,"_").concat(s.deviceId));if((l?l.state:"INACTIVE")!=="ACTIVE"){const h={initAt:t,updateAt:t,device:s,state:"ACTIVE"};this.deviceInfoMap.set("".concat(s.kind,"_").concat(s.deviceId),h),n.push(h)}l&&(l.updateAt=t)}),this.deviceInfoMap.forEach((s,l)=>{s.state==="ACTIVE"&&s.updateAt!==t&&(s.state="INACTIVE",n.push(s))}),this.state!==ZS.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(s=>{switch(s.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Cm.RECORDING_DEVICE_CHANGED,s);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Cm.CAMERA_DEVICE_CHANGED,s);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Cm.PLAYOUT_DEVICE_CHANGED,s)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(s=>s.kind==="audioinput"),n=e.filter(s=>s.kind==="videoinput"),r={audio:!1,video:!1};for(const s of t)if(s.label&&s.deviceId){r.audio=!0;break}for(const s of n)if(s.label&&s.deviceId){r.video=!0;break}return r}};let lP=!1;const co=new class extends ai{constructor(){super(...arguments),Ee(this,"onAutoplayFailed",void 0),Ee(this,"onAudioAutoplayFailed",void 0)}};function tF(){if(on(),!lP){const e=t=>{t.preventDefault(),lP=!1,zS()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};lP=!0,zS()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),D.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),co.onAutoplayFailed?co.onAutoplayFailed():co.onAudioAutoplayFailed?D.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):D.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),co.emit("autoplay-failed")}}function nF(e,t,n,r){if(!e)return;const s=ft.getBaseInfoBySessionId(e);if(!s)return;const l=s.info,h=Date.now(),p=ri(ri({},l),{},{vid:l.vid===void 0?0:Number(l.vid),lts:h,elapse:h-s.startTime,cbRegistered:co.onAutoplayFailed||co.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});ft.send({type:ii.AUTOPLAY_FAILED,data:p},!0)}const $J=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Gs=new class{constructor(){Ee(this,"onAutoplayFailed",void 0),Ee(this,"elementMap",new Map),Ee(this,"elementStateMap",new Map),Ee(this,"elementsNeedToResume",[]),Ee(this,"sinkIdMap",new Map),Ee(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,r]=t;const s=this.elementStateMap.get(n),l=r.srcObject.getAudioTracks()[0],h=l&&l.readyState;if(D.debug("resume after interrupted, ele: ".concat(s," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return r.pause(),void r.play();if(An.curState==="running")return oE()?(r.pause(),void r.play()):void(s&&s==="paused"&&r.play())}})}),Ee(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(D.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),An.on(br.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),An.on(br.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),An.on(br.STATE_CHANGE,()=>{As()&&An.prevState==="suspended"&&An.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(r){throw new Re(H.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const s=document.createElement("audio");s.autoplay=!0,s.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,s),this.elementMap.set(t,s),this.elementStateMap.set(t,ls.INIT),this.setVolume(t,n);const l=this.sinkIdMap.get(t);if(l)try{s.setSinkId(l).catch(p=>{D.warning("[".concat(t,"] set sink id failed"),p.toString())})}catch(p){D.warning("[".concat(t,"] set sink id failed"),p.toString())}const h=s.play();h&&h.then&&h.catch(p=>{r&&nF(r,"audio",p.message,t),D.warning("audio element play warning",p.toString()),this.elementMap.has(t)&&p.name==="NotAllowedError"&&(D.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(s),Pw(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),tF()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){$J.forEach(n=>{t.addEventListener(n,r=>{const s=this.elementStateMap.get(e),l=r.type==="pause"?"paused":r.type;if(D.debug("[".concat(e,"] audio-element-status change ").concat(s," => ").concat(l)),r.type==="error"){const h=t==null?void 0:t.error;h&&D.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,l)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{D.debug("Auto resume audio element success")}).catch(n=>{D.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new Je(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{zS()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Ci(){return function(e,t,n){const r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new Re(H.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",D);for(var s=arguments.length,l=new Array(s),h=0;h<s;h++)l[h]=arguments[h];const p=r.apply(this,l);return p instanceof Je?new Je((m,g)=>{p.then(m).catch(g)}):p}),n}}class iF extends ai{constructor(t){super(),Ee(this,"name","VideoProcessorDestination"),Ee(this,"ID","0"),Ee(this,"_source",void 0),Ee(this,"videoContext",void 0),Ee(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Re(H.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Re(H.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Is.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Is.ON_TRACK,void 0)}}class rF extends ai{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),Ee(this,"constraintsMap",new Map),Ee(this,"statsRegistry",[]),Ee(this,"usageRegistry",[]),Ee(this,"trackId",void 0),Ee(this,"direction",void 0),Ee(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await Lr(this,ro.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var r;return D.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Mn(this,ro.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fs(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return D.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Mn(this,ro.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fs(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:s,cb:l}of this.statsRegistry)try{const h=l();t.push({processorID:n,processorName:r,type:s,stats:h})}catch(h){D.error(new Re(H.UNEXPECTED_ERROR,h.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof Je&&(r=await r),t.push(ri(ri({},r),{},{direction:this.direction}))}catch(r){D.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class sF extends ai{constructor(t){super(),Ee(this,"name","AudioProcessorDestination"),Ee(this,"ID","0"),Ee(this,"inputTrack",void 0),Ee(this,"inputNode",void 0),Ee(this,"audioProcessorContext",void 0),Ee(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Re(H.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Re(H.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Is.ON_TRACK,void 0),this.emit(Is.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Is.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Is.ON_NODE,this.inputNode))}}class aF extends ai{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,r){super(),Ee(this,"constraintsMap",new Map),Ee(this,"statsRegistry",[]),Ee(this,"audioContext",void 0),Ee(this,"trackId",void 0),Ee(this,"direction",void 0),Ee(this,"usageRegistry",[]),Ee(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=r}async getConstraints(){return Lr(this,ro.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var r;return D.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Mn(this,ro.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fs(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),Mn(this,ro.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fs(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:s,cb:l}of this.statsRegistry)try{const h=l();t.push({processorID:n,processorName:r,type:s,stats:h})}catch(h){D.error(new Re(H.UNEXPECTED_ERROR,h.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof Je&&(r=await r),t.push(ri(ri({},r),{},{direction:this.direction}))}catch(r){D.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class dP extends ai{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Ee(this,"context",void 0),Ee(this,"processSourceNode",void 0),Ee(this,"outputTrack",void 0),Ee(this,"processedNode",void 0),Ee(this,"clonedTrack",void 0),Ee(this,"outputNode",void 0),this.outputNode=new ZJ}setVolume(){}createOutputTrack(){throw new Re(H.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class ZJ{disconnect(){}connect(){}}function oF(e){return new Je((t,n)=>{let r=!1;const s=document.createElement("video");s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.muted=!0,s.autoplay=!0,s.setAttribute("playsinline",""),s.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(s);const l=As()?"canplay":"playing";s.addEventListener(l,()=>{const h=s.videoWidth,p=s.videoHeight;!h&&_i()||(r=!0,s.srcObject=null,s.remove(),t([h,p]))}),s.srcObject=new MediaStream([e]),s.play().catch(Lw),setTimeout(()=>{r||(s.srcObject=null,s.remove(),t([s.videoWidth,s.videoHeight]))},4e3)})}function zw(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=wc(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!sV()&&n.frameRate&&(t.frameRate=n.frameRate),Qj()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),_i()&&(t.frameRate={ideal:30,max:30}),t}function cF(e){const t={};return sV()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,xu()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function lF(e){const t=cF(e);if(e.encoderConfig){const n=Bw(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Ow()&&(t.sampleRate=void 0),t}const eQ=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:s}=e.getMediaStreamTrackSettings();let{frameRate:l=n,width:h=r,height:p=s}=t;if(!l||!h||!p)return;h=VD(h),p=VD(p),l=VD(l);const{max:m,min:g}=function(I,U,k){const M=200*Math.pow(k/15,.6)*Math.pow(I*U/640/360,.75);return{min:Math.floor(M),max:Math.floor(4*M)}}(h,p,l),{bitrateMax:v,bitrateMin:T}=t||{};v||D.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(p,", fps: ").concat(l,"] => [brMax: ").concat(v,", brMin: ").concat(T,"]"));const{maxFramerate:C}=Y("ENCODER_CONFIG_LIMIT");return C&&typeof C=="number"&&(l=Math.min(l,C)),{frameRate:l,bitrateMax:v||m,bitrateMin:T||g,scaleResolutionDownBy:1,scale:0}},dF=async(e,t,n)=>await(async(r,s,l)=>{const h=function(g){const v=[];for(let T=0;T<g.length;T+=2)v.push(parseInt(g.slice(T,T+2),16));return Uint8Array.from(v)}(SV(""+s+l)).slice(0,16),p=h.slice(0,12),m=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:p},m,r))})(e.buffer,t,n),uP=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new Je((n,r)=>{t.toBlob(async s=>{if(t.remove(),s){const l=await uF(s);n({buffer:l,width:t.width,height:t.height})}else r(new Re(H.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},uF=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var hF,pF,fF,mF,_F,gF,EF,yF,vF,SF,TF,RF,bF,CF,wF,AF,IF,NF,ci,OF,DF,PF,LF,kF,xF,Rd,MF,UF,jF,VF,FF,BF,GF,HF,zF,WF,qF,KF,YF,xr;let Si=(hF=Rt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),pF=Rt({argsMap:(e,t)=>[e.getTrackId(),t]}),fF=Ci(),mF=dE("LocalAudioTrack","_enabledMutex"),_F=Rt({argsMap:(e,t)=>[e.getTrackId(),t]}),gF=Ci(),EF=dE("LocalAudioTrack","_enabledMutex"),yF=Rt({argsMap:(e,t)=>[e.getTrackId(),t]}),vF=Ci(),SF=Ci(),TF=Ci(),RF=Rt({argsMap:e=>[e.getTrackId()]}),bF=Ci(),CF=Rt({argsMap:e=>[e.getTrackId()]}),wF=Ci(),AF=Rt({argsMap:e=>[e.getTrackId()]}),IF=Rt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),NF=Rt({argsMap:e=>[e.getTrackId()]}),en((ci=class extends yE{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Gs.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),Ee(this,"trackMediaType",EE.AUDIO),Ee(this,"_encoderConfig",void 0),Ee(this,"_trackSource",void 0),Ee(this,"metadata",[]),Ee(this,"_enabled",!0),Ee(this,"_volume",100),Ee(this,"_useAudioElement",!0),Ee(this,"_bypassWebAudio",!1),Ee(this,"processor",void 0),Ee(this,"_processorContext",void 0),Ee(this,"_processorDestination",void 0),Ee(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new dP,Y("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),Y("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Dr()&&!so?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){On(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Gs.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void D.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Mn(this,lt.NEED_REPLACE_TRACK,this).then(()=>{D.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{D.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!FV())throw new Re(H.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Gs.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Mn(this,lt.NEED_ENABLE_TRACK,this),D.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(this._enabled=!1),D.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Mn(this,lt.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,D.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Mn(this,lt.NEED_MUTE_TRACK,this):await Mn(this,lt.NEED_UNMUTE_TRACK,this))}getStats(){return dp(()=>{D.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),eo(this,lt.GET_STATS)||ri({},iP)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(io.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(io.ON_AUDIO_BUFFER),this._source.on(io.ON_AUDIO_BUFFER,n=>e(n))}play(){D.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(D.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Gs.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){D.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Gs.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];D.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Gs.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Mn(this,lt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Je.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Re(H.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Re(H.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Is.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await Mn(this,lt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Mn(this,lt.NEED_REPLACE_TRACK,this))}),e.on(Is.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Is.ON_TRACK),e.removeAllListeners(Is.ON_NODE)}bindProcessorContextEvents(e){e.on(ro.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(ro.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof dP&&(this._trackSource=new JV(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new aF(this._source.context,this.getTrackId(),"local"),t=new sF(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(io.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Gs.stop(this.getTrackId()),this._source.play()),Mn(this,lt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{D.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{D.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[hF],Object.getOwnPropertyDescriptor(ci.prototype,"setVolume"),ci.prototype),en(ci.prototype,"setPlaybackDevice",[pF,fF],Object.getOwnPropertyDescriptor(ci.prototype,"setPlaybackDevice"),ci.prototype),en(ci.prototype,"setEnabled",[mF,_F,gF],Object.getOwnPropertyDescriptor(ci.prototype,"setEnabled"),ci.prototype),en(ci.prototype,"setMuted",[EF,yF,vF],Object.getOwnPropertyDescriptor(ci.prototype,"setMuted"),ci.prototype),en(ci.prototype,"getStats",[SF],Object.getOwnPropertyDescriptor(ci.prototype,"getStats"),ci.prototype),en(ci.prototype,"setAudioFrameCallback",[TF],Object.getOwnPropertyDescriptor(ci.prototype,"setAudioFrameCallback"),ci.prototype),en(ci.prototype,"play",[RF,bF],Object.getOwnPropertyDescriptor(ci.prototype,"play"),ci.prototype),en(ci.prototype,"stop",[CF,wF],Object.getOwnPropertyDescriptor(ci.prototype,"stop"),ci.prototype),en(ci.prototype,"close",[AF],Object.getOwnPropertyDescriptor(ci.prototype,"close"),ci.prototype),en(ci.prototype,"pipe",[IF],Object.getOwnPropertyDescriptor(ci.prototype,"pipe"),ci.prototype),en(ci.prototype,"unpipe",[NF],Object.getOwnPropertyDescriptor(ci.prototype,"unpipe"),ci.prototype),ci),eT=(OF=Rt({argsMap:(e,t)=>[e.getTrackId(),t]}),DF=Ci(),PF=dE("MicrophoneAudioTrack","_enabledMutex"),LF=Rt({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),kF=Ci(),xF=Rt({argsMap:e=>[e.getTrackId()]}),en((Rd=class extends Si{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?Bw(t.encoderConfig):{},r,Y("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Ee(this,"_config",void 0),Ee(this,"_deviceName","default"),Ee(this,"_constraints",void 0),Ee(this,"_originalConstraints",void 0),Ee(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(oE()||DD())&&An.bindInterruptDetectorTrack(this)}async setDevice(e){if(D.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await oo.getDeviceById(e),n={};n.audio=ri({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await ao(n,this.getTrackId())}catch(s){throw D.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),r=await ao({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await oo.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}D.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return D.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),e),Y("AUTO_RESET_AUDIO_ROUTE")&&(As()||Rc())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),n||(this._enabled=!1);try{await Mn(this,lt.NEED_DISABLE_TRACK,this)}catch(h){throw D.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const s=ri({},this._constraints),l=oo.searchDeviceIdByName(this._deviceName);l&&!s.deviceId&&(s.deviceId=l);try{n||(this._enabled=!0);const h=await ao({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await Mn(this,lt.NEED_ENABLE_TRACK,this)}catch(h){throw n||(this._enabled=!1),D.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}D.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(oE()||DD())&&An.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((As()||Rc())&&this._enabled&&!this._isClosed&&An.duringInterruption){const e=async()=>{An.off(br.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};An.on(br.IOS_INTERRUPTION_END,e)}else D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(_E.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=oo.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const r=await ao({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(ro.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const s=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(s),n()}catch(s){r(s)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(ro.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[OF,DF],Object.getOwnPropertyDescriptor(Rd.prototype,"setDevice"),Rd.prototype),en(Rd.prototype,"setEnabled",[PF,LF,kF],Object.getOwnPropertyDescriptor(Rd.prototype,"setEnabled"),Rd.prototype),en(Rd.prototype,"close",[xF],Object.getOwnPropertyDescriptor(Rd.prototype,"close"),Rd.prototype),Rd),tQ=(MF=Rt({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),UF=Ci(),jF=Rt({argsMap:e=>[e.getTrackId()]}),VF=Ci(),FF=Rt({argsMap:e=>[e.getTrackId()]}),BF=Ci(),GF=Rt({argsMap:e=>[e.getTrackId()]}),HF=Ci(),zF=Rt({argsMap:e=>[e.getTrackId()]}),WF=Ci(),qF=Rt({argsMap:e=>[e.getTrackId()]}),KF=Rt({argsMap:e=>[e.getTrackId()]}),YF=Ci(),en((xr=class extends Si{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),Ee(this,"source",void 0),Ee(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(io.AUDIO_SOURCE_STATE_CHANGE,s=>{this.safeEmit(_E.SOURCE_STATE_CHANGE,s)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){On(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[MF,UF],Object.getOwnPropertyDescriptor(xr.prototype,"startProcessAudioBuffer"),xr.prototype),en(xr.prototype,"pauseProcessAudioBuffer",[jF,VF],Object.getOwnPropertyDescriptor(xr.prototype,"pauseProcessAudioBuffer"),xr.prototype),en(xr.prototype,"seekAudioBuffer",[FF,BF],Object.getOwnPropertyDescriptor(xr.prototype,"seekAudioBuffer"),xr.prototype),en(xr.prototype,"resumeProcessAudioBuffer",[GF,HF],Object.getOwnPropertyDescriptor(xr.prototype,"resumeProcessAudioBuffer"),xr.prototype),en(xr.prototype,"stopProcessAudioBuffer",[zF,WF],Object.getOwnPropertyDescriptor(xr.prototype,"stopProcessAudioBuffer"),xr.prototype),en(xr.prototype,"close",[qF],Object.getOwnPropertyDescriptor(xr.prototype,"close"),xr.prototype),en(xr.prototype,"setAudioBufferPlaybackSpeed",[KF,YF],Object.getOwnPropertyDescriptor(xr.prototype,"setAudioBufferPlaybackSpeed"),xr.prototype),xr);class Xi extends Si{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=vE().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Bn(8,"track-mix-")),Ee(this,"trackList",void 0),Ee(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(D.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):D.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){D.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}Dw(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof Xi?n.emit(bm.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class nQ extends XV{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(io.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Ee(this,"audioBuffer",void 0),Ee(this,"sourceNode",void 0),Ee(this,"startPlayTime",0),Ee(this,"startPlayOffset",0),Ee(this,"pausePlayTime",0),Ee(this,"options",void 0),Ee(this,"currentLoopCount",0),Ee(this,"currentPlaybackSpeed",100),Ee(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):D.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const XF=new Map;function JF(e,t){if(e.length===0||t.length===0)return 1/0;const n=FD(e),r=FD(t);return Math.floor(r/n)}class hP{get rendFrameRate(){const t=Math.max(1,JF(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(D.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){Ee(this,"trackId",void 0),Ee(this,"config",void 0),Ee(this,"onFirstVideoFrameDecoded",void 0),Ee(this,"onVideoStateChanged",void 0),Ee(this,"freezeTimeCounterList",[]),Ee(this,"renderFreezeAccTime",0),Ee(this,"renderFreezeAccTime2",0),Ee(this,"isKeepLastFrame",!1),Ee(this,"timeUpdatedCount",0),Ee(this,"freezeTime",0),Ee(this,"playbackTime",0),Ee(this,"lastTimeUpdatedTime",0),Ee(this,"autoplayFailed",!1),Ee(this,"videoTrack",void 0),Ee(this,"videoElement",void 0),Ee(this,"cacheVideoElement",void 0),Ee(this,"_render_interframe_delays",[]),Ee(this,"_render_interframe_delays_sizes",[]),Ee(this,"_videoState",Td.VideoStateStopped),Ee(this,"videoElementCheckInterval",void 0),Ee(this,"videoElementFreezeTimeout",void 0),Ee(this,"_videoElementStatus",ls.NONE),Ee(this,"isGettingVideoDimensions",!1),Ee(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return D.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),Ee(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&An.curState==="running"&&(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Jj())),iV()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Ee(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=ls.PLAYING;break;case"loadeddata":if(this.videoState=Td.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=ls.CANPLAY;break;case"stalled":this.videoElementStatus=ls.STALLED;break;case"suspend":this.videoElementStatus=ls.SUSPEND;break;case"pause":this.videoElementStatus=ls.PAUSED,As()||Rc()||Dr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=ls.WAITING;break;case"abort":this.videoElementStatus=ls.ABORT;break;case"ended":this.videoElementStatus=ls.ENDED;break;case"emptied":this.videoElementStatus=ls.EMPTIED;break;case"error":{const r=this.videoElement.error;r&&(this.videoElementStatus=ls.ERROR,D.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")")));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const s=r-this.lastTimeUpdatedTime,l=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,bd.lastVisibleTime<bd.lastHiddenTime||l<bd.lastHiddenTime||l<bd.lastVisibleTime)return;for(s>Y("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=s),this.playbackTime+=s;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Ee(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Jj())),iV()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),An.on(br.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),An.on(br.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(s=>{t&&nF(t,"video",s.message,this.trackId),s.name==="NotAllowedError"?(D.warning("detected video element autoplay failed",s),this.autoplayFailed=!0,this.handleAutoPlayFailed()):D.warning("[".concat(this.trackId,"] play warning: "),s)});const r=on();if((r.name==="Safari"&&Number(r.version)===15||oE())&&n&&n.then){const s=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(s).catch(s)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return D.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const s=r.getContext("2d");return s?(s.drawImage(this.videoElement,0,0,r.width,r.height),new Je((l,h)=>{r.toBlob(async p=>{if(r.remove(),p){const m=await uF(p);l({buffer:m,width:r.width,height:r.height})}else h(new Re(H.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await uP(t)}destroy(){An.off(br.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),An.off(br.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Td.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=ls.INIT,!this.videoElementCheckInterval&&(QF.forEach(l=>{this.videoElement.addEventListener(l,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(l){return l!==document.body&&document.body.contains(l)})(this.videoElement)||(this.videoElementStatus=ls.DESTROYED)},1e3),Y("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let l;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(p,Y("VIDEO_FREEZE_DURATION")))},p=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Td.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Td.VideoStateFrozen:document.addEventListener("visibilitychange",h))},m=(g,v)=>{if(this.videoElementStatus===ls.PLAYING){if(l){const I=v.presentationTime-l.presentationTime,U=v.presentedFrames-l.presentedFrames;this._render_interframe_delays_sizes.push(U),this._render_interframe_delays.push(I);const k=FD(this._render_interframe_delays_sizes),M=k-this._render_interframe_delays_sizes[0];if(k>30&&M>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Td.VideoStateStarting&&(this.videoState=Td.VideoStateDecoding),this.videoState===Td.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(p,Y("VIDEO_FREEZE_DURATION"))),I<Y("VIDEO_FREEZE_DURATION")&&this.videoState===Td.VideoStateFrozen&&(this.videoState=Td.VideoStateDecoding),I>Y("VIDEO_FREEZE_DURATION")&&bd.lastVisibleTime>=bd.lastHiddenTime&&l.timestamp>bd.lastVisibleTime&&l.timestamp>bd.lastHiddenTime){const F=Math.min(66,JF(this._render_interframe_delays_sizes,this._render_interframe_delays)),B=Math.max(0,I-(U-1)*F);this.renderFreezeAccTime2+=B>F?B:0,this.renderFreezeAccTime+=I}}l=ri(ri({},v),{},{timestamp:g})}var T,C;Y("ENABLE_VIDEO_FRAME_CALLBACK")&&((T=(C=this.videoElement).requestVideoFrameCallback)===null||T===void 0||T.call(C,m))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,m)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Ow()&&!Y("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=on();r.name==="Safari"&&Number(r.version)===15||oE()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,_i()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,_i()&&this.videoElement.load());const s=this.videoElement.play();s!==void 0&&s.catch(l=>{D.debug("[".concat(this.trackId,"] playback interrupted"),l.toString())})}resetVideoElement(){QF.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=ls.NONE}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{D.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{D.error(r)}),this.autoplayFailed=!1,zS()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};zS()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),tF()}}const QF=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class $F extends hP{constructor(t){super(t),Ee(this,"container",void 0),Ee(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await uP(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",Y("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var ZF,eB,tB,nB,iB,rB,sB,aB,oB,cB,lB,dB,uB,hB,pB,fB,mB,_B,gB,EB,yB,vB,SB,TB,RB,bB,Kt,CB,wB,AB,IB,NB,OB,DB,PB,lo;let Xn=(ZF=Rt({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),eB=Ci(),tB=Rt({argsMap:e=>[e.getTrackId()]}),nB=dE("LocalVideoTrack","_enabledMutex"),iB=Rt({argsMap:(e,t)=>[e.getTrackId(),t]}),rB=Ci(),sB=dE("LocalVideoTrack","_enabledMutex"),aB=Rt({argsMap:(e,t)=>[e.getTrackId(),t]}),oB=Ci(),cB=Rt({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),lB=Ci(),dB=Rt({argsMap:(e,t)=>[e.getTrackId(),t]}),uB=Ci(),hB=Ci(),pB=Rt({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),fB=Ci(),mB=Ci(),_B=Ci(),gB=Ci(),EB=Ci(),yB=Ci(),vB=Ci(),SB=Rt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),TB=Rt({argsMap:e=>[e.getTrackId()]}),RB=Rt({argsMap:e=>[e.getTrackId()]}),bB=Rt({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),Kt=class FW extends yE{get videoHeight(){if(Dr()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Dr()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ls.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,r,s,l,h){if(super(t,l),Ee(this,"trackMediaType",EE.VIDEO),Ee(this,"_player",void 0),Ee(this,"isUseScaleResolutionDownBy",!1),Ee(this,"_videoVisibleTimer",null),Ee(this,"_previousVideoVisibleStatus",void 0),Ee(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ee(this,"_encoderConfig",void 0),Ee(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Ee(this,"_optimizationMode",void 0),Ee(this,"_saveEncodeBitrateRatio",1),Ee(this,"_videoHeight",void 0),Ee(this,"_videoWidth",void 0),Ee(this,"_forceBitrateLimit",void 0),Ee(this,"_enabled",!0),Ee(this,"_processorDestination",void 0),Ee(this,"_processorContext",void 0),Dr()){const{width:p,height:m}=t.getSettings();this._videoWidth=p,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=r,this._optimizationMode=s,this._hints=h||[],n&&this._hints.indexOf(Dn.CUSTOM_TRACK)!==-1?this._encoderConfig=oi(n):this._encoderConfig=n,this._hints.indexOf(Dn.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(ID(mn.CHROME,115)&&Iw().indexOf("Windows")!==-1){const p=function(m,g){if("VideoFrame"in window&&"TransformStream"in window&&cn().supportWebRTCInsertableStream){const v=new MediaStreamTrackProcessor(m),T=new MediaStreamTrackGenerator({kind:"video"});let C,I,U=Date.now();const k=()=>{M&&(clearInterval(M),M=void 0),C&&(C.close(),C=void 0),m.stop(),I=void 0,T.removeEventListener("ended",k)};let M=window.setInterval(()=>{if(I&&C&&Date.now()-U>1e3)try{T.readyState==="live"?I.enqueue(C.clone()):k()}catch{k()}},1e3);const F=new TransformStream({transform:(B,ee)=>{T.readyState==="live"?(I=ee,U=Date.now(),C===void 0?(C=B,ee.enqueue(B.clone())):(ee.enqueue(C),C=B)):B.close()}});return T.addEventListener("ended",k),v.readable.pipeThrough(F).pipeTo(T.writable),T}}(t);p&&(D.info("local screen video track begin to inject frame"),this._mediaStreamTrack=p)}n&&this._hints.indexOf(Dn.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new rF(this.getTrackId(),"local"),this._processorDestination=new iF(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const s=document.getElementById(t);s?t=s:(D.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}D.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const r=ri(ri(ri({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new hP(r):this._player=new $F(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(_E.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},Y("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,D.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Mn(this,lt.NEED_DISABLE_TRACK,this)}catch(r){throw D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void D.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Mn(this,lt.NEED_ENABLE_TRACK,this)}catch(r){throw D.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}D.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,D.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Mn(this,lt.NEED_MUTE_TRACK,this):await Mn(this,lt.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),D.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await Mn(this,lt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(D)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new Re(H.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=wc(t),Y("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=zw({encoderConfig:t});(Dr()||As()||Rc())&&(r.deviceId=void 0),D.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(s){const l=new Re(H.UNEXPECTED_ERROR,s.toString());throw D.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}}this._encoderConfig=t,this._hints.indexOf(Dn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Mn(this,lt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(D)}}getStats(){return dp(()=>{D.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),eo(this,lt.GET_STATS)||ri({},rP)}async setBeautyEffect(t){D.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await uP(t)}async setBitrateLimit(t){D.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void D.error(H.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await Mn(this,lt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=n,D.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}D.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return D.error(H.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,D.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){oF(this._originMediaStreamTrack).then(t=>{let[n,r]=t;this._videoHeight=r,this._videoWidth=n}).catch(Lw)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new Re(H.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");D.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=wc(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Dn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Mn(this,lt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(D)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!n||!r)return;const{bitrateMax:s,bitrateMin:l}=this._encoderConfig;if(l==null||s==null){const{max:h,min:p}=function(m,g,v,T,C){const I=Y("BITRATE_ADAPTER_TYPE");if(I==="DEFAULT_BITRATE")return{min:T,max:C};if(C===void 0){const U=Math.floor(200*Math.pow(v/15,.6)*Math.pow(m*g/640/360,.75));C=I==="STANDARD_BITRATE"?4*U:2*U,T=T??U}else T=T??Math.floor(C/10);return{min:T,max:C}}(t,n,r,l,s);if(this._encoderConfig.bitrateMin=p,this._encoderConfig.bitrateMax=h,Y("VIDEO_STANDARD_BITRATE_VERSION")&&l==null&&s==null){const[m,g]=function(v,T,C){const I=4*Math.floor(2e5*Math.pow(C/15,.6)*Math.pow(v*T/230400,.75)),U=v*T,k=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),M=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let F=Fs(k).call(k).next().value,B=1;if(k.has(U))F=k.get(U);else{var ee;const tt=Pt(ee=Array.from(k.entries())).call(ee,(xt,wt)=>{let[qn]=xt,[Pn]=wt;return qn-Pn}),Ft=tt.find(xt=>{let[wt]=xt;return wt>U});if(Ft){const xt=tt.indexOf(Ft);if(xt>0){const wt=tt[xt-1],qn=(U-wt[0])/(Ft[0]-wt[0]);F=wt[1]+qn*(Ft[1]-wt[1])}else F=Ft[1]}else F=tt[tt.length-1][1]}if(M.has(U))B=M.get(U);else{var ue;const tt=Pt(ue=Array.from(M.entries())).call(ue,(xt,wt)=>{let[qn]=xt,[Pn]=wt;return qn-Pn}),Ft=tt.find(xt=>{let[wt]=xt;return wt>U});if(Ft){const xt=tt.indexOf(Ft);if(xt>0){const wt=tt[xt-1],qn=(U-wt[0])/(Ft[0]-wt[0]);B=wt[1]+qn*(Ft[1]-wt[1])}else B=Ft[1]}else B=tt[tt.length-1][1]}const de=Y("VIDEO_NEW_BITRATE_RATIO");de&&de>0&&(F=de/100);const ae=Math.floor(I*F),Te=Math.floor(65e4*Math.pow(v*T/230400,.5)*Math.pow(C/15,.69));let Ae=ae;const We=Y("VIDEO_STANDARD_BITRATE_VERSION");return We&&We>0&&(We===1?Ae=I:We===2?Ae=ae:We===3&&(Ae=Te)),[Math.floor(Ae/1e3),B]}(t,n,r);this._encoderConfig.bitrateMax=m,this._encoderConfig.bitrateMin=p?Math.min(p,m):m,this._saveEncodeBitrateRatio=g,D.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else D.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(h,", brMin: ").concat(p,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:l,slot:h}=s;if(this.isPlaying&&l instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=cV.checkOneElementVisible(l),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const g=ft.reportApiInvoke(null,{tag:Ei.TRACER,name:Mi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(r){throw new Re(H.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new Re(H.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=ri(ri({},r),wc(t))),r=vm(r);const s=Bn(8,"track-video-cloned-"),l=new FW(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,vm(this._scalabilityMode),this._optimizationMode,s,vm(this._hints));return t&&r&&l.setEncoderConfiguration(r),D.debug("clone video track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(n)),l}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new Re(H.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new Re(H.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(dp(()=>{ft.reportApiInvoke(null,{name:Mi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Ei.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!Y("ENABLE_VIDEO_SEI")||!Y("ENABLE_ENCODED_TRANSFORM"))return void D.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new Re(H.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void D.warning("Video track is not published, SEI can not be send");const r=n.sender.getParameters();if(r.codecs.length===0)return;const s=r.codecs[0].mimeType.toLocaleLowerCase();s==="video/h264"?this.safeEmit("sei-to-send",t):D.warning("SEI is not supported by ".concat(s))}bindProcessorDestinationEvents(){this.processorDestination.on(Is.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await Mn(this,lt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Mn(this,lt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Is.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ro.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ro.REQUEST_CONSTRAINTS)}},en(Kt.prototype,"play",[ZF,eB],Object.getOwnPropertyDescriptor(Kt.prototype,"play"),Kt.prototype),en(Kt.prototype,"stop",[tB],Object.getOwnPropertyDescriptor(Kt.prototype,"stop"),Kt.prototype),en(Kt.prototype,"setEnabled",[nB,iB,rB],Object.getOwnPropertyDescriptor(Kt.prototype,"setEnabled"),Kt.prototype),en(Kt.prototype,"setMuted",[sB,aB,oB],Object.getOwnPropertyDescriptor(Kt.prototype,"setMuted"),Kt.prototype),en(Kt.prototype,"setSaveEncodeBitrateRatio",[cB,lB],Object.getOwnPropertyDescriptor(Kt.prototype,"setSaveEncodeBitrateRatio"),Kt.prototype),en(Kt.prototype,"setEncoderConfiguration",[dB,uB],Object.getOwnPropertyDescriptor(Kt.prototype,"setEncoderConfiguration"),Kt.prototype),en(Kt.prototype,"getStats",[hB],Object.getOwnPropertyDescriptor(Kt.prototype,"getStats"),Kt.prototype),en(Kt.prototype,"setBeautyEffect",[pB,fB],Object.getOwnPropertyDescriptor(Kt.prototype,"setBeautyEffect"),Kt.prototype),en(Kt.prototype,"getCurrentFrameData",[mB],Object.getOwnPropertyDescriptor(Kt.prototype,"getCurrentFrameData"),Kt.prototype),en(Kt.prototype,"getCurrentFrameImage",[_B],Object.getOwnPropertyDescriptor(Kt.prototype,"getCurrentFrameImage"),Kt.prototype),en(Kt.prototype,"setBitrateLimit",[gB],Object.getOwnPropertyDescriptor(Kt.prototype,"setBitrateLimit"),Kt.prototype),en(Kt.prototype,"setOptimizationMode",[EB],Object.getOwnPropertyDescriptor(Kt.prototype,"setOptimizationMode"),Kt.prototype),en(Kt.prototype,"setScalabiltyMode",[yB],Object.getOwnPropertyDescriptor(Kt.prototype,"setScalabiltyMode"),Kt.prototype),en(Kt.prototype,"updateMediaStreamTrackResolution",[vB],Object.getOwnPropertyDescriptor(Kt.prototype,"updateMediaStreamTrackResolution"),Kt.prototype),en(Kt.prototype,"pipe",[SB],Object.getOwnPropertyDescriptor(Kt.prototype,"pipe"),Kt.prototype),en(Kt.prototype,"unpipe",[TB],Object.getOwnPropertyDescriptor(Kt.prototype,"unpipe"),Kt.prototype),en(Kt.prototype,"close",[RB],Object.getOwnPropertyDescriptor(Kt.prototype,"close"),Kt.prototype),en(Kt.prototype,"replaceTrack",[bB],Object.getOwnPropertyDescriptor(Kt.prototype,"replaceTrack"),Kt.prototype),Kt),pP=(CB=Rt({argsMap:(e,t)=>[e.getTrackId(),t]}),wB=Ci(),AB=dE("CameraVideoTrack","_enabledMutex"),IB=Rt({argsMap:(e,t)=>[e.getTrackId(),t]}),NB=Ci(),OB=Rt({argsMap:(e,t)=>[e.getTrackId(),t]}),DB=Ci(),PB=Rt({argsMap:e=>[e.getTrackId()]}),lo=class BW extends Xn{get __className__(){return"CameraVideoTrack"}constructor(t,n,r,s,l,h){super(t,wc(n.encoderConfig),s,l,h),Ee(this,"_config",void 0),Ee(this,"_originalConstraints",void 0),Ee(this,"_constraints",void 0),Ee(this,"_enabled",!0),Ee(this,"_deviceName","default"),Ee(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(oE()||DD())&&!function(){const p=on();if(p.os!==ir.IOS||!p.osVersion)return!1;const m=p.osVersion.split(".");return Number(m[0])===15&&Number(m[1])>=2}()&&rV()&&this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=wc(this._config.encoderConfig),An.on(br.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),An.on(br.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(D.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await oo.getDeviceById(t),r={};r.video=ri({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let s=null;try{s=await ao(r,this.getTrackId())}catch(l){throw D.error("[".concat(this.getTrackId(),"] setDevice failed"),l.toString()),s=await ao({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),l}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await oo.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}D.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){D.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:ri(ri({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await ao(n,this.getTrackId())}catch(s){throw D.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),s.toString()),r=await ao({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=ri({},n.video),D.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await ao({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await Mn(this,lt.NEED_ENABLE_TRACK,this)}catch(r){throw D.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),D.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Mn(this,lt.NEED_DISABLE_TRACK,this)}catch(r){throw D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}D.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new Re(H.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=wc(t),Y("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const r=oi(this._config);r.encoderConfig=t;const s=zw(r);(Dr()||As()||Rc())&&(s.deviceId=void 0),D.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(l){const h=new Re(H.UNEXPECTED_ERROR,l.toString());throw D.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=r,this._constraints=s,this._originalConstraints=s,this._encoderConfig=t,this._hints.indexOf(Dn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Mn(this,lt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(l){return l.throw(D)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((As()||Rc())&&this._enabled&&!this._isClosed&&An.duringInterruption){const t=async()=>{An.off(br.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};An.on(br.IOS_INTERRUPTION_END,t)}else D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(_E.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,r=oo.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId={exact:r}),this._enabled){const s=await ao({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),An.off(br.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),An.off(br.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=ri(ri({},r),wc(t))),r=vm(r);const s=Bn(8,"track-cam-cloned-"),l=new BW(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,vm(ri(ri({},this._config),{},{encoderConfig:r})),vm(this._constraints),vm(this._scalabilityMode),this._optimizationMode,s);return t&&r&&l.setEncoderConfiguration(r),D.debug("clone track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(n)),l}bindProcessorContextEvents(){this.processorContext.on(ro.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const s=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(s),n()}catch(s){r(s)}}),this.processorContext.on(ro.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},en(lo.prototype,"setDevice",[CB,wB],Object.getOwnPropertyDescriptor(lo.prototype,"setDevice"),lo.prototype),en(lo.prototype,"setEnabled",[AB,IB,NB],Object.getOwnPropertyDescriptor(lo.prototype,"setEnabled"),lo.prototype),en(lo.prototype,"setEncoderConfiguration",[OB,DB],Object.getOwnPropertyDescriptor(lo.prototype,"setEncoderConfiguration"),lo.prototype),en(lo.prototype,"close",[PB],Object.getOwnPropertyDescriptor(lo.prototype,"close"),lo.prototype),lo);function fP(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=ri(ri({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?D.debug("[".concat(e,"] set content hint to"),n.optimizationMode):D.debug("[".concat(e,"] set content hint failed")))):D.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var LB,kB,xB,MB,xo,UB,jB,VB,FB,BB,GB,gs;class HB extends qV{getUserId(){return this._userId}constructor(t,n,r,s){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(s.clientId,"_").concat(Bn(5,""))),Ee(this,"_userId",void 0),Ee(this,"_uintId",void 0),Ee(this,"_isDestroyed",!1),Ee(this,"store",void 0),Ee(this,"processor",void 0),Ee(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=s}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,D.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let TE=(LB=Rt({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),kB=Rt({argsMap:e=>[e.getTrackId()]}),xB=Rt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),MB=Rt({argsMap:e=>[e.getTrackId()]}),en((xo=class extends HB{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ls.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r){super(e,t,n,r),Ee(this,"_videoVisibleTimer",null),Ee(this,"_previousVideoVisibleStatus",void 0),Ee(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ee(this,"trackMediaType",EE.VIDEO),Ee(this,"_videoWidth",void 0),Ee(this,"_videoHeight",void 0),Ee(this,"_player",void 0),Ee(this,"processorDestination",void 0),Ee(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new rF(this.getTrackId(),"remote"),this.processorDestination=new iF(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return dp(()=>{D.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),eo(this,lt.GET_STATS)||ri({},zV)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const r=document.getElementById(e);r?e=r:(D.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}D.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=ri(ri({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new hP(n):this._player=new $F(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(gE.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=r=>{this.safeEmit(gE.VIDEO_STATE_CHANGED,r)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(gE.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},Y("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,D.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){oF(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(Lw)}_updatePlayerSource(){D.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:s,slot:l}=r;if(this.isPlaying&&s instanceof HTMLVideoElement&&l instanceof HTMLElement){const h=cV.checkOneElementVisible(s),p=Object.assign({},h);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;const m=ft.reportApiInvoke(null,{tag:Ei.TRACER,name:Mi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});p.visible?m.onSuccess("Video is visible"):m.onSuccess("Invisible because of ".concat(p.reason))}return p}return}catch(n){throw new Re(H.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Re(H.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Is.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Is.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(bm.SEI_RECEIVED,e)}}).prototype,"play",[LB],Object.getOwnPropertyDescriptor(xo.prototype,"play"),xo.prototype),en(xo.prototype,"stop",[kB],Object.getOwnPropertyDescriptor(xo.prototype,"stop"),xo.prototype),en(xo.prototype,"pipe",[xB],Object.getOwnPropertyDescriptor(xo.prototype,"pipe"),xo.prototype),en(xo.prototype,"unpipe",[MB],Object.getOwnPropertyDescriptor(xo.prototype,"unpipe"),xo.prototype),xo),RE=(UB=Rt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),jB=Rt({argsMap:(e,t)=>[e.getTrackId(),t]}),VB=Rt({argsMap:e=>[e.getTrackId()]}),FB=Rt({argsMap:e=>[e.getTrackId()]}),BB=Rt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),GB=Rt({argsMap:e=>[e.getTrackId()]}),en((gs=class extends HB{get isPlaying(){return this._useAudioElement?Gs.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),Ee(this,"trackMediaType",EE.AUDIO),Ee(this,"_source",void 0),Ee(this,"_useAudioElement",!0),Ee(this,"_volume",100),Ee(this,"processorContext",void 0),Ee(this,"processorDestination",void 0),Ee(this,"_played",!1),Ee(this,"_bypassWebAudio",!1),Y("DISABLE_WEBAUDIO")?(this._source=new dP,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new JV(e,!0),Y("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(io.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(gE.FIRST_FRAME_DECODED)}),this.processorContext=new aF(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new sF(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(io.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(io.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(io.ON_AUDIO_BUFFER),this._source.on(io.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?Gs.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!FV())throw new Re(H.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Gs.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return dp(()=>{D.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),eo(this,lt.GET_STATS)||ri({},HV)}play(){D.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(D.debug("[".concat(this.getTrackId(),"] use audio element to play")),Gs.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){D.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Gs.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];D.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Gs.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Re(H.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Re(H.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Re(H.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Is.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Is.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Is.ON_TRACK),this.processorDestination.removeAllListeners(Is.ON_NODE)}}).prototype,"setVolume",[UB],Object.getOwnPropertyDescriptor(gs.prototype,"setVolume"),gs.prototype),en(gs.prototype,"setPlaybackDevice",[jB],Object.getOwnPropertyDescriptor(gs.prototype,"setPlaybackDevice"),gs.prototype),en(gs.prototype,"play",[VB],Object.getOwnPropertyDescriptor(gs.prototype,"play"),gs.prototype),en(gs.prototype,"stop",[FB],Object.getOwnPropertyDescriptor(gs.prototype,"stop"),gs.prototype),en(gs.prototype,"pipe",[BB],Object.getOwnPropertyDescriptor(gs.prototype,"pipe"),gs.prototype),en(gs.prototype,"unpipe",[GB],Object.getOwnPropertyDescriptor(gs.prototype,"unpipe"),gs.prototype),gs);const bd=new class extends ai{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Ee(this,"_lastHiddenTime",0),Ee(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),D.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class zB extends ai{constructor(t,n){super(),Ee(this,"trackMediaType",EE.DATA),Ee(this,"_version",1),Ee(this,"_type",3),Ee(this,"_config",void 0),Ee(this,"_originDataChannel",void 0),Ee(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Ee(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),Ee(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return Y("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Je((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const r=setTimeout(()=>{var s;n(new Re(H.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((s=this._originDataChannel)===null||s===void 0?void 0:s.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new Re(H.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new Re(H.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[Gw.OPEN,Gw.CLOSE,Gw.ERROR].forEach(n=>{const r=()=>{this.emit(n)};this._datachannelEventMap.set(n,r),t.addEventListener(n,r)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[r,s]=n;t.removeEventListener(r,s)}),this._datachannelEventMap.clear()}}class iQ extends zB{constructor(t){super(t),Ee(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=n.data.slice(0,this._dataStreamPacketHeader.byteLength),s=new DataView(r).getUint8(3);if(s!==this.id)return void(Y("SHOW_DATASTREAM2_LOG")&&D.debug("invalid datachannel id: ".concat(s," !== ").concat(this.id)));let l=n.data.slice(this._dataStreamPacketHeader.byteLength);l=this._dataStreamPacketHandler.deserialize(l),this.emit(Gw.MESSAGE,l)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class rQ extends zB{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function Ww(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>WC.revokeObjectURL(e),0),new Worker(WC.createObjectURL(e))}const WB=71,mP=1,_P=2,gP=1,qB=2;var Vu=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Vu||{});function KB(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==WB)return;const r=e.getUint16(1),s=mP+_P+r,l=new Uint8Array(e.byteLength-s);l.set(new Uint8Array(e.buffer,s,e.byteLength-s));const h={m:n,tlvLen:r,tlv:[],frame:l};let p=mP+_P;for(;p<s;){const m=e.getUint8(p),g=e.getUint16(p+gP),v=gP+qB;if(m===Vu.AUDIO_LEVEL){let T=e.getUint8(p+v);for(let C=1;C<g;C++)T=T<<8|e.getUint8(p+v+C);h.tlv.push({tag:m,length:g,value:t?127^T>>1:127&T})}else if(m===Vu.METADATA||m===Vu.AUDIO_64_BIT_PTS){const T=new Uint8Array(g);for(let C=0;C<g;C++)T[C]=e.getUint8(p+v+C);h.tlv.push({tag:m,length:g,value:T})}p+=v+g}return h}const qw=new Map,Kw=127,Am=1e-10,EP=139/13,Yw=new Map;function yP(e,t,n){const r="".concat(e,"-").concat(t,"-").concat(n);let s=0;return Yw.has(r)?s=Yw.get(r):(s=Math.log(function(h,p){const m=h-p;p<m&&(p=m);let g=1;for(let v=h,T=1;v>p;v--,T++)g=g*v/T;return g}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,Yw.set(r,s)),s<Am&&(s=Am),s}function YB(e,t,n){const r=t.length,s=e.length/r;let l=!1;for(let h=0,p=0;h<r;h++){let m=0;for(let g=p+s;p<g;p++)e[p]>n&&m++;t[h]!==m&&(t[h]=m,l=!0)}return l}window.cache=Yw;let sQ=0;class XB{constructor(t){Ee(this,"id",void 0),Ee(this,"immediates",[]),Ee(this,"lastNonSilence",-1),Ee(this,"immediateSpeechActivityScore",Am),Ee(this,"lastLevelChangedTime",Date.now()),Ee(this,"levels",[]),Ee(this,"longs",[]),Ee(this,"longSpeechActivityScore",Am),Ee(this,"mediums",[]),Ee(this,"mediumSpeechActivityScore",Am),Ee(this,"minLevel",0),Ee(this,"nextMinLevel",0),Ee(this,"nextMinLevelWindowLength",0),Ee(this,"energyScore",0),this.id=t||"".concat(sQ++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,r=this.minLevel+EP;let s=!1;for(let l=0;l<t.length;++l){let h=n[l];h<r&&(h=0);const p=Math.floor(h/EP);t[l]!==p&&(t[l]=p,s=!0)}return s}computeLongs(){return YB(this.mediums,this.longs,4)}computeMediums(){return YB(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=yP(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=yP(this.longs[0],10,47),this.longSpeechActivityScore>Am&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=yP(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(U_(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let r=t;return t<0&&(r=0),t>Kw&&(r=Kw),this.levels.unshift(r),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(r),r>=this.minLevel+EP?r:r/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>Kw&&(n=Kw),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class aQ{constructor(t){Ee(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class vP{constructor(t,n,r){Ee(this,"isDominant",void 0),Ee(this,"energyRanking",void 0),Ee(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=r}}class oQ extends ai{constructor(t){super(),Ee(this,"dominantId",null),Ee(this,"lastDecisionTime",0),Ee(this,"lastLevelChangedTime",0),Ee(this,"lastLevelIdleTime",0),Ee(this,"relativeSpeechActivities",[]),Ee(this,"speakers",new Map),Ee(this,"enableSilence",!1),Ee(this,"timeoutToSilenceInterval",0),Ee(this,"decisionMaker",null),Ee(this,"loudest",[]),Ee(this,"numLoudestToTrack",3),Ee(this,"energyExpireTimeMs",250),Ee(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),r!=null&&(this.energyAlphaPct=r),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){const r=Date.now(),s=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<r&&(this.lastLevelChangedTime=r,this.maybeStartDecisionMaker());const l=s.levelChanged(n,r);return this.updateLoudestList(s,l,r)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new XB(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,r){const s=t.id===this.dominantId;if(n<0){let m=0;for(;m<this.loudest.length&&this.loudest[m]!==t;)++m;return new vP(s,m,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new vP(s,0,t.energyScore);const l=r-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const m=this.loudest[h];if(m.getLastLevelChangedTime()<l&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(m.id!==t.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let p=0;for(;p<this.loudest.length&&!(this.loudest[p].energyScore<t.energyScore);)++p;return p<this.numLoudestToTrack&&(this.loudest.splice(p,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new vP(s,p,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new aQ(this),this.decisionMaker.execute())}makeDecision(t){let n=null,r=null;const s=this.speakers.size;let l=null;if(s===0)l=null;else if(s===1){var h;const p=Fs(h=this.speakers).call(h).next().value;this.enableSilence&&p&&(l=p.id,p.evaluateSpeechActivityScores(t),t-p.lastNonSilence>this.timeoutToSilenceInterval&&(l=null))}else{let p=this.dominantId==null?null:this.speakers.get(this.dominantId);if(p==null){const v=this.speakers.entries().next();v.value&&(l=v.value[0],p=v.value[1])}else l=p.id;p!=null&&p.evaluateSpeechActivityScores(t);const m=this.relativeSpeechActivities;let g=2;for(const v of this.speakers.entries()){const[T,C]=v;if(C===p)continue;C.evaluateSpeechActivityScores(t);for(let M=0;M<m.length;++M){const F=p==null?Am:p.getSpeechActivityScore(M);m[M]=Math.log(C.getSpeechActivityScore(M)/F)}const I=m[0],U=m[1],k=m[2];I>3&&U>2&&k>0&&U>g&&(g=U,l=T)}this.enableSilence&&p!=null&&l===p.id&&t-p.lastNonSilence>this.timeoutToSilenceInterval&&(l=null)}l==null&&!this.enableSilence||l===this.dominantId||(n=this.dominantId,this.dominantId=l,r=this.dominantId),r==null&&!this.enableSilence||r===n||this.emit("ActiveSpeakerChanged",r)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let r=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):r=n;let s=300-(t-this.lastDecisionTime);return s<=0&&(this.lastDecisionTime=t,this.makeDecision(t),s=300-(Date.now()-t)),s>0&&r>s&&(r=s),r}timeoutIdleLevels(t){const n=[];for(const s of Fs(r=this.speakers).call(r)){var r;const l=t-s.getLastLevelChangedTime();36e5<l&&(this.dominantId==null||s.id!==this.dominantId)?n.push(s.id):300<l&&s.levelTimedOut()}n.forEach(s=>this.speakers.delete(s))}}const bE=new Map;let vl=null,Xw=null;const JB=3;let Im=[];const Sl=new Map,Jw=new Map;class cQ{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){Ee(this,"id",void 0),Ee(this,"track",void 0),Ee(this,"score",0),Ee(this,"active",!0),Ee(this,"muted",!1),Ee(this,"timer",0),Ee(this,"actives",0),Ee(this,"inactives",0),this.id=t,this.track=n,this.setActive(Sl.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:r}=function(){const s=[],l=[];return Array.from(Fs(Sl).call(Sl)).forEach(h=>{h.active?s.push(h):l.push(h)}),{actives:s,inactives:l}}();if(n.length>3){let s;n.forEach(l=>{(!s||s.score>l.score)&&(s=l)}),s&&s.setActive(!1)}if(n.length<3&&r.length>0){let s;r.forEach(l=>{(!s||s.score<l.score)&&l.id!==this.id&&(s=l)}),s&&t&&!this.active&&(s.samples>40&&s.activeRate-this.activeRate>.4?s.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(n){let r;return Array.from(Fs(Sl).call(Sl)).forEach(s=>{!s.active||s.id===n||s.samples<40||(!r||s.score<r.score)&&(r=s)}),r}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(n){let r;return Array.from(Fs(Sl).call(Sl)).forEach(s=>{s.active||s.id===n||s.samples<40||(!r||s.score>r.score)&&(r=s)}),r}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Qw;function QB(e){const t=Sl.get(e);t&&(Sl.delete(e),t.clearTimer())}const $w=new Map,lQ=new Map;function dQ(e,t,n){let r=new Uint8Array(e,t,n),s=[],l=0;for(;s.length<n;)l+3<n&&r[l]===0&&r[l+1]===0&&r[l+2]===3&&(r[l+3]===0||r[l+3]===1||r[l+3]===2||r[l+3]===3)?(s.push(r[l],r[l+1],r[l+3]),l+=4):(s.push(r[l]),l++);return new Uint8Array(s)}const Zw=new Map,tT=new Map;(function(){const e=on();Rr.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Rr.getStreamFromExtension=e.name===mn.CHROME&&Number(e.version)>34,Rr.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),Rr.supportMinBitrate=e.name===mn.CHROME||e.name===mn.EDGE,Rr.supportSetRtpSenderParameters=function(){const t=on();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Mu()||!(!Dr()&&!Nw())||t.name===mn.FIREFOX&&Number(t.version)>=64)}(),e.name===mn.SAFARI&&(Number(e.version)>=14?Rr.supportDualStream=!0:Rr.supportDualStream=!1),Rr.webAudioMediaStreamDest=function(){const t=on();return!(t.name===mn.SAFARI&&Number(t.version)<12)}(),Rr.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Rr.supportWebGL=typeof WebGLRenderingContext<"u",Rr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Mu()||(Rr.webAudioWithAEC=!0),Rr.supportShareAudio=function(){const t=on();return(t.os===ir.WIN_10||t.os===ir.WIN_81||t.os===ir.WIN_7||t.os===ir.LINUX||t.os===ir.MAC_OS||t.os===ir.CHROMIUM_OS)&&t.name===mn.CHROME&&Number(t.version)>=74}(),Rr.supportDataChannel=!!(HS(76)||function(t){const n=on();return!(n.name!==mn.FIREFOX||!n.osVersion)&&Number(n.version)>=t}(68)||Zj(14)),Rr.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!_i()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Rr.supportWebRTCEncodedTransform=function(){const t=on();return t.name==="Chrome"&&Number(t.version)>=87||t.name==="Safari"&&Number(t.version)>=15}(),Rr.supportWebRTCInsertableStream=function(){const t=on();return(t.name===mn.CHROME||t.name===mn.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Rr.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Rr.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Pw(()=>{Rr.supportDualStreamEncoding=function(){const t=on();return!!Y("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&Y("CHROME_DUAL_STREAM_USE_ENCODING"))}(),D.debug("browser ua: ",navigator.userAgent),D.info("browser info: ",e),D.info("browser compatibility: ",Rr)})})();const uQ=["CHINA","GLOBAL"],$B=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Nm=[],CE=[];function Om(e,t){return!!t&&Nm.some(n=>n.uid===e&&n.channelName===t)}function SP(){return CE.length>0}var hQ=_U.forEach,ZB=iu("forEach")?[].forEach:function(e){return hQ(this,e,arguments.length>1?arguments[1]:void 0)};dn({target:"Array",proto:!0,forced:[].forEach!==ZB},{forEach:ZB});var pQ=ba("Array","forEach"),fQ=Zc,mQ=ki,_Q=W,gQ=pQ,TP=Array.prototype,EQ={DOMTokenList:!0,NodeList:!0},yQ=function(e){var t=e.forEach;return e===TP||_Q(TP,e)&&t===TP.forEach||mQ(EQ,fQ(e))?gQ:t},vQ=f(yQ),SQ=Sa,e3=wh;dn({target:"Object",stat:!0,forced:y(function(){e3(1)})},{keys:function(e){return e3(SQ(e))}});var TQ=f(ui.Object.keys),RQ=f(Yl),bQ=f(qy),CQ=dn,t3=ac,wQ=Ff,AQ=kn,n3=Pe,IQ=Cn,NQ=Zt,OQ=uO,DQ=hi,PQ=js,LQ=aU("slice"),kQ=DQ("species"),RP=Array,xQ=Math.max;CQ({target:"Array",proto:!0,forced:!LQ},{slice:function(e,t){var n,r,s,l=NQ(this),h=IQ(l),p=n3(e,h),m=n3(t===void 0?h:t,h);if(t3(l)&&(n=l.constructor,(wQ(n)&&(n===RP||t3(n.prototype))||AQ(n)&&(n=n[kQ])===null)&&(n=void 0),n===RP||n===void 0))return PQ(l,p,m);for(r=new(n===void 0?RP:n)(xQ(m-p,0)),s=0;p<m;p++,s++)p in l&&OQ(r,s,l[p]);return r.length=s,r}});var MQ=ba("Array","slice"),UQ=W,jQ=MQ,bP=Array.prototype,VQ=function(e){var t=e.slice;return e===bP||UQ(bP,e)&&t===bP.slice?jQ:t},FQ=f(VQ);function ut(e,t,n,r,s){var l,h,p,m={};return vQ(l=TQ(r)).call(l,function(g){m[g]=r[g]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=RQ(h=bQ(p=FQ(n).call(n)).call(p)).call(h,function(g,v){return v(e,t,g)||g},m),s&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(s):void 0,m.initializer=void 0),m.initializer===void 0?(nU(e,t,m),null):m}let eA=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),CP=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Ac=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),Ns=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),vt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Wn=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),At=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Ct=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),nT=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Yt=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Os=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),kt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function tA(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw D.error("Invalid Channel Name ".concat(e)),new ye(H.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function nA(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||oV(e,1,255)))throw new ye(H.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&D.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Fu=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const BQ={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},wP={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function AP(e,t){Sr(e.url,"".concat(t,".url"),1,1e3,!1),gi(e.x)||On(e.x,"".concat(t,".x"),0,1e4),gi(e.y)||On(e.y,"".concat(t,".y"),0,1e4),gi(e.width)||On(e.width,"".concat(t,".width"),0,1e4),gi(e.height)||On(e.height,"".concat(t,".height"),0,1e4),gi(e.zOrder)||On(e.zOrder,"".concat(t,".zOrder"),0,255),gi(e.alpha)||On(e.alpha,"".concat(t,".alpha"),0,1,!1)}const GQ={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let pp=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),IP=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Ji=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function i3(e){if(!e.channelName)throw new ye(H.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new ye(H.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Sr(e.token,"info.token",1,2047),nA(e.uid),tA(e.channelName),!0}let Ds=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Bu=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),la=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),wE=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Sn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),hr=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),iA=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),sr=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),_n=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const r3=[_n.AFRICA,_n.ASIA,_n.CHINA,_n.EUROPE,_n.GLOBAL,_n.INDIA,_n.JAPAN,_n.NORTH_AMERICA,_n.OCEANIA,_n.OVERSEA,_n.SOUTH_AMERICA];let qr=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const rA={CHINA:{},ASIA:{CODE:qr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:qr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:qr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:qr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:qr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:qr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:qr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:qr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:qr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:qr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:qr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:qr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:qr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};XD&&(rA.CHINA={CODE:qr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let iT=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function s3(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class a3 extends ai{constructor(t,n){super(),V(this,"onICEConnectionStateChange",void 0),V(this,"onConnectionStateChange",void 0),V(this,"onDTLSTransportStateChange",void 0),V(this,"onDTLSTransportError",void 0),V(this,"onICETransportStateChange",void 0),V(this,"onFirstAudioReceived",void 0),V(this,"onFirstVideoReceived",void 0),V(this,"onFirstAudioDecoded",void 0),V(this,"onFirstVideoDecoded",void 0),V(this,"onFirstVideoDecodedTimeout",void 0),V(this,"onSelectedLocalCandidateChanged",void 0),V(this,"onSelectedRemoteCandidateChanged",void 0),V(this,"onICECandidateError",void 0),V(this,"getLocalVideoStats",void 0)}}class o3 extends a3{constructor(t,n){super(t,n),V(this,"establishPromise",void 0)}}let it=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Kr=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),Gu=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const c3=["disconnected","failed"];let Le=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),yn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),_t=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Ic=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Nc=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),pr=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),l3=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Cd=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Mo=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Tl=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),AE=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Di=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),IE=function(e){return e.ABORT="abort",e}({}),fp=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),HQ=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const zQ={[eA.ACCESS_POINT]:{[Ns.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ns.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ns.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ns.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ns.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ns.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ns.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ns.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ns.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ns.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ns.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ns.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ns.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ns.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ns.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ns.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ns.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ns.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[eA.UNILBS]:{[Ac.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Ac.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Ac.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Ac.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Ac.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Ac.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Ac.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Ac.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Ac.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Ac.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Ac.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Ac.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[eA.STRING_UID_ALLOCATOR]:{[CP.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[CP.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[CP.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function NE(e){const t=zQ[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===eA.ACCESS_POINT){const r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const WQ={[vt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[vt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[vt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[vt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[vt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[vt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[vt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[vt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[vt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[vt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[vt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[vt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[vt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[vt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[vt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[vt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[vt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[vt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[vt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[vt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[vt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[vt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[vt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[vt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[vt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[vt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[vt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[vt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[vt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[vt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[vt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[vt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[vt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[vt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[vt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[vt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[vt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[vt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[vt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[vt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[vt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[vt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[vt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[vt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[vt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[vt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[vt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[vt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[vt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[vt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[vt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[vt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[vt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[vt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[vt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[vt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[vt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[vt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[vt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[vt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[vt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[vt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[vt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[vt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function rT(e){return WQ[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function d3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function NP(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?d3(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d3(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function OP(e,t){if(typeof e=="string")return e;const{proxy:n,host:r,port:s}=e;if(t){const l=Y("JOIN_GATEWAY_FALLBACK_PORT")||443;return l===443?"wss://".concat(r,"/ws/?p=").concat(Number(s)+150):"wss://".concat(r,":").concat(l,"/ws/?p=").concat(Number(s)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(s):"wss://".concat(r,":").concat(s)}const qQ=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,KQ=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,YQ=/wss:\/\/(.+):([0-9]+)\/?/,XQ=/wss:\/\/(.[^\/]+)\/?/;let JQ=0;class QQ{constructor(t,n){V(this,"id",0),V(this,"store",void 0),V(this,"recordIndex",void 0),V(this,"websockets",[]),V(this,"try443PortDuration",2e3),V(this,"forceCloseWSDuration",5e3),V(this,"try443PortTimeout",null),V(this,"forceCloseTimeout",null),V(this,"isTry443PortFailed",!1),V(this,"isNormalPortFailed",!1),V(this,"useDoubleDomain",!1),V(this,"useProxy",!1),V(this,"startTime",Date.now()),this.id=++JQ,this.try443PortDuration=Y("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var r=arguments.length,s=new Array(r),l=0;l<r;l++)s[l]=arguments[l];D.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...s)}createWebSocket(t,n,r){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:r});const s=Y("GATEWAY_DOMAINS"),l=Date.now(),h=[],p=s.find(C=>{var I;return Ye(I=t.host).call(I,C)});p||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)s.forEach(C=>{m.push(OP(NP(NP({},t),{},{host:t.host.replace(p,C)}),n))});else{const C=NP({},t);if(n&&p){const I=s.find(U=>U!==p);I&&(C.host=C.host.replace(p,I))}m.push(OP(C,n))}try{m.forEach(C=>{const I=new WebSocket(C);I.binaryType="arraybuffer",h.push(I),this.logger("ws is connecting:",I.url)})}catch(C){if(this.logger("ws create failed"),h.forEach(I=>I.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,r);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new ye(H.WS_ERR,"init websocket failed! Error: ".concat(C.toString()))}const g=GS();this.store&&this.store.recordJoinChannelService({urls:h.map(C=>C.url),service:"gateway"},this.recordIndex),h.forEach(C=>{C.onopen=()=>{this.logger("onopen: ws ".concat(C.url," open cost ").concat(Date.now()-l,"ms")),this.websockets.forEach(I=>{I!==C&&(I.onopen=null,I.onclose=null,I.onmessage=null,I.close(),this.logger("close backup websocket: ".concat(I.url)))}),this.websockets.length=0,g.resolve(C)},C.onclose=I=>{this.logger("onclose: ws ".concat(C.url," closed cost ").concat(Date.now()-l,"ms state: ").concat(C.readyState));const U=h.every(k=>k.readyState===WebSocket.CLOSED||k.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(U)),U&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(I.reason)),g.reject({code:I.code,reason:iA.A_ROUND_WS_FAILED})):!n&&U&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),T()),n?this.isTry443PortFailed=U:this.isNormalPortFailed=U},C.onmessage=I=>this.logger("".concat(C.url," onmessage: ").concat(I.data))}),this.websockets.push(...h);const v=()=>{this.websockets.forEach(C=>C.readyState!==WebSocket.OPEN&&C.close())},T=()=>{if(g.isResolved)return v();on().os===ir.MAC_OS&&_i()&&v(),this.createWebSocket(t,!0,!0).then(C=>{g.resolve(C)}).catch(C=>{this.isNormalPortFailed&&g.reject(C),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",g.isResolved),this.forceCloseTimeout=null,v()},this.forceCloseWSDuration)};return r||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,v()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",g.isResolved),this.try443PortTimeout=null,T()},this.try443PortDuration)})(),g.promise}chooseBestWebsocket(t,n,r,s){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(l){let h,p,m;return[,h,p,m]=l.match(qQ)||[],h||([,p,m]=l.match(KQ)||[]),p&&m||([,p,m]=l.match(YQ)||[]),p&&m||([,p]=l.match(XQ)||[]),p||D.warning("un-destructible url: ",l),{proxy:h,host:p,port:m||"443"}}(t)),this.recordIndex=s,this.useProxy=!!t.proxy,r&&this.useProxy&&(D.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally(()=>this.clearTimeout())}}function u3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}class h3 extends ai{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;Ye(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(kt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(kt.CONNECTED):this._state==="closed"?this.emit(kt.CLOSED):this._state==="failed"&&this.emit(kt.FAILED))}resetReconnectCount(t){D.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3],l=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),V(this,"_websocketUrl",null),V(this,"connectionID",0),V(this,"currentURLIndex",0),V(this,"urls",[]),V(this,"_reconnectMode","tryNext"),V(this,"reconnectReason",void 0),V(this,"_initMutex",void 0),V(this,"name",void 0),V(this,"_state","closed"),V(this,"reconnectInterrupter",void 0),V(this,"websocket",void 0),V(this,"retryConfig",void 0),V(this,"reconnectCount",0),V(this,"forceCloseTimeout",5e3),V(this,"onlineReconnectListener",void 0),V(this,"useCompress",void 0),V(this,"tryDoubleDomain",!1),V(this,"use443PortOnly",!1),V(this,"wsInflateLength",0),V(this,"wsDeflateLength",0),V(this,"closeEstablishingWs",()=>{}),V(this,"store",void 0),V(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=t,this.retryConfig=function(T){for(var C=1;C<arguments.length;C++){var I=arguments[C]!=null?arguments[C]:{};C%2?u3(Object(I),!0).forEach(function(U){V(T,U,I[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(T,Object.getOwnPropertyDescriptors(I)):u3(Object(I)).forEach(function(U){Object.defineProperty(T,U,Object.getOwnPropertyDescriptor(I,U))})}return T}({},n),this.useCompress=r,this.tryDoubleDomain=s,this.use443PortOnly=l,this._initMutex=new Wr("websocket",h?h.clientId:void 0);const{timeout:p,timeoutFactor:m}=n,g=Math.max(300,Math.floor(3*p/5)),v=Math.max(1.2,Math.floor(8*m)/10);ka.ONLINE&&(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=v),Ui.on(cE.NETWORK_STATE_CHANGE,(T,C)=>{T!==C&&(this.resetReconnectCount("network state change: ".concat(C," -> ").concat(T)),T===ka.ONLINE?(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=v):(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{const s=GS(),l=this.urls[this.currentURLIndex];Y("ENABLE_PREALLOC_PC")&&this.emit(l3.PRE_CONNECT_PC),this.createWebSocketConnection(l).then(s.resolve).catch(s.reject),this.once(kt.CLOSED,()=>{s.reject(new Re(H.WS_DISCONNECT))}),this.once(kt.CONNECTED,s.resolve),await s.promise}catch{}finally{r()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;n?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void D.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),D.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Re(H.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new Re(H.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const r=GS();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const s=v=>{var T;(T=this.store)===null||T===void 0||T.signalChannelOpen(),D.debug("[".concat(this.name,"] websocket opened:"),v),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},l=async v=>{var T;if(D.debug("[".concat(this.name,"] websocket close ").concat((T=this.websocket)===null||T===void 0?void 0:T.url,", code: ").concat(v.code,", reason: ").concat(v.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new Re(H.WS_DISCONNECT,"websocket close: ".concat(v.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=v.reason,this.state="reconnecting");const C=eo(this,kt.WILL_RECONNECT,this.reconnectMode,v.reason)||this.reconnectMode,I=await this.reconnectWithAction(C);if(this.state==="closed")return void D.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!I)return r.reject(new Re(H.WS_DISCONNECT,"websocket reconnect failed: ".concat(v.code))),this.close(!0);r.resolve()}},h=v=>{this.emit(kt.ON_MESSAGE,v)},p=v=>{D.warn("[".concat(this.connectionID,"] ws open error ").concat(v))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),Y("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=Y("GATEWAY_WSS_ADDRESS")),D.debug("[".concat(this.name,"] start connect, url:"),t);const m=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var g;this._websocketUrl=OP(t);const v=await this.chooseBestWebsocketConnection(t);this.websocket=v,s&&s(this.websocket.url),this.websocket.onclose=l,this.websocket.onmessage=h,this.websocket.onerror=p,(g=this.store)===null||g===void 0||g.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this.joinGatewayRecordIndex=m}catch(v){const T=this.state==="closed",C=v instanceof Re,I=C&&v.code===H.WS_ABORT,U=C&&v.code===H.WS_ERR,k=C?v.message:v&&(v.reason||v.toString());D.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(k)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:I?"aborted":"error",errors:[v]},m),T||U?(r.reject(T?new Re(H.WS_DISCONNECT,"websocket is closed: ".concat(k)):new Re(H.WS_ERR,"init websocket failed: ".concat(k))),U&&D.error("[".concat(this.name,"] init websocket failed: ").concat(k))):l&&l(v)}return r.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;D.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Ui.isOnline||!Ui.onlineWaiter||(this.onlineReconnectListener=Ui.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,n){const h=BD(this.reconnectCount,this.retryConfig);D.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(t)),await Je.race([Tr(h),this.onlineReconnectListener||new Je(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const s=async(h,p)=>{this.emit(kt.RECONNECT_CREATE_CONNECTION,p),await this.createWebSocketConnection(h)};try{if(t==="retry")await s(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);D.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await s(this.urls[this.currentURLIndex],t)}else t==="recover"&&(D.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Lr(this,kt.REQUEST_NEW_URLS),this.currentURLIndex=0,await s(this.urls[this.currentURLIndex],t))}catch(h){var l;D.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const p=h==null||(l=h.data)===null||l===void 0?void 0:l.desc;return Array.isArray(p)&&Ye(p).call(p,"dynamic key expired")?(this.emit(kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class DP extends h3{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const r=GS(),s=function(h,p){return new QQ(h,p)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{D.debug("[choose-best-ws] close establishing websockets"),s.closeAllWebsockets(),r.reject(new Re(H.WS_ABORT,"choose best websocket aborted"))};const l=Y("GATEWAY_DOMAINS");return D.debug("[choose-best-ws] currentDomain: ",t,", domains: ",l,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),s.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class sT extends h3{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new Je((r,s)=>{let l=!1;const h=[];this.closeEstablishingWs=()=>{D.debug("[choose-best-ws] close establishing websockets"),h.forEach(U=>{U.onclose=null,U.onopen=null,U.onmessage=null,U.close()}),s(new Re(H.WS_ABORT,"choose best websocket aborted"))};const p=Y("GATEWAY_DOMAINS");let m;const g=t.indexOf("?h="),v=p.find(U=>g!==-1?Ye(t).call(t,U,g):Ye(t).call(t,U));D.debug("[choose-best-ws] currentDomain: ",v,", domains: ",p);let T=!this.tryDoubleDomain||!v;if(!T&&v){var C;const U=Date.now();try{p.forEach(k=>{const M=g===-1?t.replace(v,k):t.substr(0,g)+t.substr(g).replace(v,k),F=new WebSocket(M);F.binaryType="arraybuffer",h.push(F),D.debug("[choose-best-ws] ws is connecting:",F.url)})}catch{for(D.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(M=>M.close());h.length;)h.pop();T=!0}(C=this.store)===null||C===void 0||C.recordJoinChannelService({urls:h.map(k=>k.url),service:"gateway"},n),h.forEach(k=>{k.onopen=()=>{if(l)return;const M=Date.now()-U;D.debug("[choose-best-ws] ws open cost ".concat(M,"ms")),h.filter(F=>F!==k).forEach(F=>{D.debug("[choose-best-ws]close backup websocket: ".concat(F.url)),F.close()}),l=!0,r(k)},k.onclose=M=>{m=M,!l&&(h.find(F=>!(F.readyState===WebSocket.CLOSED||F.readyState===WebSocket.CLOSING))||(D.debug("[choose-best-ws] all websocket is closed"),l=!0,s(m)))},k.onmessage=M=>{D.debug("[choose-best-ws]".concat(k.url," onmessage: ").concat(M.data))}}),Tr(this.forceCloseTimeout).then(()=>{h.forEach(k=>{k.readyState!==WebSocket.OPEN&&k.close()})})}if(T){var I;let U;D.debug("[choose-best-ws] use single url: ",t),(I=this.store)===null||I===void 0||I.recordJoinChannelService({urls:[t],service:"gateway"},n);try{U=new WebSocket(t),h.push(U),U.binaryType="arraybuffer"}catch(k){const M=new Re(H.WS_ERR,"init websocket failed! Error: ".concat(k.toString()));return D.error("[".concat(this.name,"]").concat(M)),void s(M)}U.onopen=()=>{r(U)},U.onclose=k=>{s(k)},U.onmessage=k=>{D.debug("[choose-best-ws]".concat(U.url," onmessage: ").concat(k.data))},Tr(this.forceCloseTimeout).then(()=>{U&&U.readyState!==WebSocket.OPEN&&U.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}}class $Q extends ai{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Wn.CONNECTED?this.emit(At.WS_CONNECTED):t===Wn.RECONNECTING?this.emit(At.WS_RECONNECTING,this._websocketReconnectReason):t===Wn.CLOSED&&this.emit(At.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),V(this,"_disconnectedReason",void 0),V(this,"_websocketReconnectReason",void 0),V(this,"_connectionState",Wn.CLOSED),V(this,"reconnectToken",void 0),V(this,"websocket",void 0),V(this,"openConnectionTime",void 0),V(this,"clientId",void 0),V(this,"lastMsgTime",Date.now()),V(this,"uploadCache",[]),V(this,"uploadCacheInterval",void 0),V(this,"rttRolling",new RV(5)),V(this,"pingpongTimer",void 0),V(this,"wsInflateDataTimer",void 0),V(this,"pingpongTimeoutCount",0),V(this,"joinResponse",void 0),V(this,"multiIpOption",void 0),V(this,"initError",void 0),V(this,"spec",void 0),V(this,"store",void 0),V(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(At.ON_BINARY_DATA,r.data);const s=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const l="res-@".concat(s._id);this.emit(l,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){if(this.emit(s._type,s._message),s._type===Yt.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===Yt.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(En.UID_BANNED);break;case 15:this.close(En.IP_BANNED);break;case 16:this.close(En.CHANNEL_BANNED)}if(s._type===Yt.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case vt.ERR_LICENSE_MISSING:this.close(En.LICENSE_MISSING);break;case vt.ERR_LICENSE_EXPIRED:this.close(En.LICENSE_EXPIRED);break;case vt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(En.LICENSE_MINUTES_EXCEEDED);break;case vt.ERR_LICENSE_PERIOD_INVALID:this.close(En.LICENSE_PERIOD_INVALID);break;case vt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(En.LICENSE_MULTIPLE_SDK_SERVICE);break;case vt.ERR_LICENSE_ILLEGAL:this.close(En.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new DP("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Y("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Y("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Wn.CONNECTED&&this.reconnect("retry",Pr.OFFLINE)})}async request(t,n,r,s){const l=Bn(6,""),h={_id:l,_type:t,_message:n},p=this.websocket.connectionID,m=()=>new Je((U,k)=>{if(this.connectionState===Wn.CONNECTED)return U();const M=()=>{this.off(At.WS_CLOSED,F),U()},F=()=>{this.off(At.WS_CONNECTED,M),k(new ye(H.WS_ABORT))};this.once(At.WS_CONNECTED,M),this.once(At.WS_CLOSED,F),t!==Ct.PUBLISH&&t!==Ct.PUBLISH_DATASTREAM&&t!==Ct.SUBSCRIBE&&t!==Ct.SUBSCRIBE_DATASTREAM&&t!==Ct.UNSUBSCRIBE&&t!==Ct.UNSUBSCRIBE_DATASTREAM&&t!==Ct.UNPUBLISH&&t!==Ct.UNPUBLISH_DATASTREAM&&t!==Ct.CONTROL&&t!==Ct.RESTART_ICE||this.once(At.DISCONNECT_P2P,()=>{k(new ye(H.DISCONNECT_P2P))}),t!==Ct.PUBLISH&&t!==Ct.RESTART_ICE||this.once(At.ABORT_P2P_EXECUTION,()=>{k(new ye(H.DISCONNECT_P2P))})});if(this.connectionState!==Wn.CONNECTING&&this.connectionState!==Wn.RECONNECTING||t===Ct.JOIN||t===Ct.REJOIN||await m(),this.websocket.sendMessage(h,!0),s)return;const g=new Je((U,k)=>{let M=!1;const F=(ee,ue)=>{M=!0,U({isSuccess:ee==="success",message:ue||{}}),this.off(At.WS_CLOSED,B),this.off(At.WS_RECONNECTING,B),this.emit(At.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(l),F);const B=()=>{k(new ye(H.WS_ABORT,"type: ".concat(t))),this.off(At.WS_CLOSED,B),this.off(At.WS_RECONNECTING,B),this.off("res-@".concat(l),F)};this.once(At.WS_CLOSED,B),this.once(At.WS_RECONNECTING,B),Tr(Y("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||M||(D.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(At.REQUEST_TIMEOUT,t,n))})});let v=null;try{v=await g}catch(U){if(this.connectionState===Wn.CLOSED||t===Ct.LEAVE)throw new ye(H.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?U.throw():t===Ct.JOIN||t===Ct.REJOIN?null:(await m(),await this.request(t,n))}if(v.isSuccess)return v.message;const T=Number(v.message.error_code||v.message.code),C=rT(T),I=new ye(H.UNEXPECTED_RESPONSE,"".concat(C.desc,": ").concat(v.message.error_str),{code:T,data:v.message,desc:C.desc});return C.action==="success"?v.message:(D.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(T,", message: ").concat(C.desc,", action: ").concat(C.action)),T===vt.ERR_TOO_MANY_BROADCASTERS?((t===Ct.JOIN||t===Ct.REJOIN)&&(this.initError=I,this.close()),I.throw()):C.action==="failed"?I.throw():C.action==="quit"?(this.initError=I,this.close(),I.throw()):(T===vt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=v.message.option,D.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Pr.MULTI_IP)):this.reconnect(C.action,Pr.SERVER_ERROR),t===Ct.JOIN||t===Ct.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Je(r=>{const s=l=>{(!n||n(l))&&(this.off(t,s),r(l))};this.on(t,s)})}uploadWRTCStats(t){if(!this.store.sessionId)return void D.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(nT.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const l=Y("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Wn.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},Y("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Je((n,r)=>{this.once(At.WS_CONNECTED,()=>n(this.joinResponse)),this.once(At.WS_CLOSED,s=>r(this.initError||new ye(H.WS_ABORT,s))),this.connectionState=Wn.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||En.LEAVE,this.connectionState=Wn.CLOSED,D.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(At.ABORT_P2P_EXECUTION);const t=await Lr(this,At.REQUEST_JOIN_INFO),n=await this.request(Ct.JOIN,t);if(!n)return this.emit(At.REPORT_JOIN_GATEWAY,iA.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(At.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Wn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ye(H.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=YS(this,At.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Ct.REJOIN,t);return!!n&&(this.connectionState=Wn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(Yt.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Yt.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Yt.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Yt.MUTE_AUDIO,{uid:r.uid}):this.emit(Yt.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Yt.MUTE_VIDEO,{uid:r.uid}):this.emit(Yt.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Yt.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Yt.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Yt.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Yt.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Yt.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){D.debug("[".concat(this.clientId,"] receive notification: "),t);const n=rT(t.code);if(t.code===28&&"detail"in t&&(D.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(At.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(En.UID_BANNED),void this.close()):void this.reconnect(n.action,Pr.SERVER_ERROR);D.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=Y("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(D.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>Y("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Pr.TIMEOUT):this.request(Ct.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),Y("REPORT_STATS")&&this.send(Ct.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(nT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(kt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(At.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(kt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(kt.CLOSED,()=>{this.connectionState=Wn.CLOSED}),this.websocket.on(kt.FAILED,()=>{this._disconnectedReason=En.NETWORK_ERROR,this.connectionState=Wn.CLOSED}),this.websocket.on(kt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Wn.CONNECTED?this.connectionState=Wn.RECONNECTING:this.connectionState=Wn.CONNECTING}),this.websocket.on(kt.WILL_RECONNECT,(t,n,r)=>{const s=YS(this,At.IS_P2P_DISCONNECTED),l=s||t!=="retry";s&&t==="retry"&&(D.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=iA.P2P_DISCONNECTED),l&&(D.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(At.REPORT_JOIN_GATEWAY,n||iA.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(At.DISCONNECT_P2P)),r(t)}),this.websocket.on(kt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{D.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Pr.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(At.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ye){if(t.code===H.UNEXPECTED_RESPONSE&&t.data.code===vt.ERR_NO_AUTHORIZED)return this.initError=new ye(H.TOKEN_EXPIRE,"dynamic key expired"),void this.close(En.TOKEN_EXPIRE);D.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Pr.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(kt.REQUEST_NEW_URLS,(t,n)=>{Lr(this,At.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(l3.PRE_CONNECT_PC,()=>{this.emit(At.PRE_CONNECT_PC)})}}let ZQ=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),ji=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function p3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function sA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?p3(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p3(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function mp(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(Y("TURN_DOMAIN")):(D.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function PP(e,t){e.addresses||(e.addresses=[]);const n=function(p,m){if(Y("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return p.map(T=>{let{ip:C,port:I}=T;return{address:"".concat(C,":").concat(I)}});const g=Y("GATEWAY_DOMAINS");let v=g[1]&&Ye(m).call(m,g[1])?1:0;return p.map(T=>{let{domain_prefix:C,port:I,ip:U}=T;if(C)return{address:"".concat(C,".").concat(g[v++%g.length],":").concat(I)};const k=/^[\.\:\d]+$/.test(U),M=k?"".concat(U.replace(/[^\d]/g,"-"),".").concat(g[v++%g.length],":").concat(I):"".concat(U,":").concat(I);return k||D.debug("Cannot recognized as ip address: ".concat(U,", use as host")),{ip:U,port:I,address:M}})}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){const p=r.split(";");for(let m=0;m<p.length;m++){var s;const g=_s(s=p[m]).call(s);n[m]&&g&&(n[m].ip6=g)}}const l=e.detail&&e.detail.candidate;let h;if(l){const[p,m]=l.split(":");p&&m&&(h={port:Number(m),ip:p,address:"".concat(p,":").concat(m)})}return{gatewayAddrs:n,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function xa(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function f3(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(xa(t.width),"x").concat(xa(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function m3(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function aT(e,t){let n,r,s;switch(t){case ji.CHOOSE_SERVER:r=4096,s="choose server";break;case ji.CLOUD_PROXY:r=1048576,s="proxy";break;case ji.CLOUD_PROXY_5:r=4194304,s="proxy5";break;case ji.CLOUD_PROXY_FALLBACK:r=4194310,s="proxy fallback";break;default:throw new ye(H.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(l=>{l.buffer&&l.buffer.flag===r&&(n={code:l.buffer.code,addresses:(l.buffer.edges_services||[]).map(h=>sA(sA({},h),{},{ticket:l.buffer.cert})),server_ts:e.enter_ts,uid:l.buffer.uid,cid:l.buffer.cid,cname:l.buffer.cname,detail:sA(sA({},l.buffer.detail),e.detail),flag:l.buffer.flag,opid:e.opid,cert:l.buffer.cert})}),!n)throw new ye(H.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(s," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function _3(e,t){return await Je.all(e.addresses.map(async n=>({address:Y("USE_TURN_IP")?n.ip:mp(n.ip),tcpport:n.port,udpport:n.port,username:t&&Y("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():kr.username,password:t&&Y("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await MD(t.toString()):kr.password})))}function LP(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,s=t.videoWidth||n.width;return r&&s?Math.max(Math.min(r,s)/Math.min(xa(e.height),xa(e.width)),1):(D.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function _p(e){let{candidateType:t,relayProtocol:n,type:r,address:s,port:l,protocol:h}=e;const p={candidateType:t,relayProtocol:n,protocol:h};if(r!=="local-candidate"){const m=s.split(".");m.length>=4&&(m[1]="*",m[2]="*"),p.address=m.join("."),p.port=l}return p}function aA(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Y("SVC_MODE");if(Y("ENABLE_SVC"))return function(t){return t in Mw}(e)?e:Mw.L1T3}const g3={[it.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[it.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function oA(e,t,n){t.forEach(r=>{var s;const l=g3[e].find(p=>{var m;let{key:g}=p;return Ye(m=r.extensionName).call(m,g)});if(!l)return;const h=n.find(p=>{let{extensionName:m}=p;return Ye(m).call(m,l.key)});h&&Ye(s=h.extensionName).call(s,"gdpr_forbidden")&&(r.extensionName=h.extensionName)})}function OE(e,t){t.forEach(n=>{var r;const s=g3[e].find(l=>{var h;let{key:p}=l;return Ye(h=n.extensionName).call(h,p)});Ye(r=n.extensionName).call(r,"gdpr_forbidden")&&s&&(n.extensionName=s.extensionName)})}function E3(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Ye(e).call(e,"abs-send-time")}function cA(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Ye(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function y3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function v3(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?y3(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y3(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function oT(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:s,filterVideoFec:l,filterAudioFec:h,filterAudioCodec:p,filterVideoCodec:m}=t,{useXR:g}=n;let v=[],T=[],C=[],I=[],U=!1,k=!1;if(ca(e).mediaDescriptions.forEach(F=>{r&&r!==F.attributes.direction||(F.media.mediaType!=="video"||U||(T=F.attributes.payloads,I=F.attributes.extmaps,U=!0),F.media.mediaType!=="audio"||k||(v=F.attributes.payloads,C=F.attributes.extmaps,k=!0))}),!I||T.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!C||v.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(T.forEach(F=>{var B;(B=F.rtpMap)!==null&&B!==void 0&&B.clockRate&&(F.rtpMap.clockRate=parseInt(F.rtpMap.clockRate)),g&&F.rtcpFeedbacks.push({type:"rrtr"})}),v.forEach(F=>{var B;(B=F.rtpMap)!==null&&B!==void 0&&B.clockRate&&(F.rtpMap.clockRate=parseInt(F.rtpMap.clockRate)),g&&F.rtcpFeedbacks.push({type:"rrtr"})}),s&&(v=v.filter(F=>{var B;return((B=F.rtpMap)===null||B===void 0?void 0:B.encodingName.toLowerCase())!=="rtx"}),T=T.filter(F=>{var B;return((B=F.rtpMap)===null||B===void 0?void 0:B.encodingName.toLowerCase())!=="rtx"})),l&&(T=T.filter(F=>{var B;return!/(red)|(ulpfec)|(flexfec)/i.test(((B=F.rtpMap)===null||B===void 0?void 0:B.encodingName)||"")})),h&&(v=v.filter(F=>{var B;return!/(red)|(ulpfec)|(flexfec)/i.test(((B=F.rtpMap)===null||B===void 0?void 0:B.encodingName)||"")})),p&&(p==null?void 0:p.length)>0&&(v=v.filter(F=>{var B;return Ye(p).call(p,((B=F.rtpMap)===null||B===void 0?void 0:B.encodingName.toLowerCase())||"")})),m&&(m==null?void 0:m.length)>0){const F=T.filter(B=>{var ee;return Ye(m).call(m,((ee=B.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())||"")});T=F.concat(s?[]:MP(F,T))}const M=Y("UNSUPPORTED_VIDEO_CODEC");return M&&M.length>0&&(T=T.filter(F=>!(F.rtpMap&&Ye(M).call(M,F.rtpMap.encodingName.toLowerCase())))),{audioCodecs:v,videoCodecs:T,audioExtensions:C,videoExtensions:I}}function gp(e){const t=ca(e);let n,r;for(const s of t.mediaDescriptions){if(!n){const l=s.attributes.iceUfrag,h=s.attributes.icePwd;if(!l||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:l,icePwd:h}}if(!r){const l=s.attributes.fingerprints;l.length>0&&(r={fingerprints:l})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function S3(e,t){const n=[],r=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),s=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),l=e.attributes.ssrcs;if(s)s.ssrcIds.forEach(h=>{var p;const m=(p=r.find(g=>g.ssrcIds[0]===h))===null||p===void 0?void 0:p.ssrcIds[1];n.push({ssrcId:h,rtx:t?m:void 0})});else if(r.length>0){const h=r[0].ssrcIds[0],p=r[0].ssrcIds[1];n.push({ssrcId:h,rtx:t?p:void 0})}else{if(l.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:l[0].ssrcId})}return n}function T3(e,t,n){const{cname:r}=e;let s=[];t&&(s=R3(t)),s.length===0&&(s=e.iceParameters.candidates.map(v=>({foundation:v.foundation,componentId:"1",transport:v.protocol,priority:v.priority.toString(),connectionAddress:v.ip,port:v.port.toString(),type:v.type,extension:{}})),D.debug("Using candidates from gateway."));const l={fingerprints:e.dtlsParameters.fingerprints.map(v=>({hashFunction:v.algorithm,fingerprint:v.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let p;switch(e.dtlsParameters.role){case"server":p="passive";break;case"client":p="active";break;case"auto":p="actpass"}const m=dA(e.rtpCapabilities),g=[];return Array.isArray(n)&&n.length>0&&n.forEach(v=>{g.push({kind:it.VIDEO,ssrcId:v.v,rtx:v.v_rtx,mslabel:"".concat(v.v,"_").concat(v.a)},{kind:it.AUDIO,ssrcId:v.a,mslabel:"".concat(v.v,"_").concat(v.a)})}),{dtlsParameters:l,iceParameters:h,candidates:s,rtpCapabilities:m,setup:p,cname:r,preSSRCs:g}}function R3(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],D.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),D.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function Dm(e,t,n){const r=[],s=[];return e.forEach(l=>{let{ssrcId:h,rtx:p}=l;const m=Bn(8,"track-"),g={ssrcId:h,attributes:v3({label:m,mslabel:n=n||Bn(10,""),msid:"".concat(n," ").concat(m)},t&&{cname:t})};if(r.push(g),p!==void 0){const v={ssrcId:p,attributes:v3({label:m,mslabel:n,msid:"".concat(n," ").concat(m)},t&&{cname:t})};r.push(v),s.push({semantic:"FID",ssrcIds:[h,p]})}}),e.length>1&&s.push({semantic:"SIM",ssrcIds:e.map(l=>{let{ssrcId:h}=l;return h})}),{ssrcs:r,ssrcGroups:s}}function DE(e,t){t instanceof Si&&e.attributes.payloads.forEach(n=>{var r;const s=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!s||["opus","pcmu","pcma","g722"].indexOf(s)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),s==="opus"&&typeof Y("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=Y("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const l=t._encoderConfig;l&&(s!=="pcmu"&&s!=="pcma"&&s!=="g722"&&(l.bitrate&&!_i()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*l.bitrate))),l.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(l.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(l.sampleRate)),l.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof eT&&s==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function kP(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function xP(e,t){var n;if(!(t instanceof Xn&&t._encoderConfig&&t._hints.indexOf(Dn.SCREEN_TRACK)===-1))return;const r=t._encoderConfig;cn().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(s=>{var l,h;Ye(l=["h264","h265","vp8","vp9","av1"]).call(l,((h=s.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),cn().supportMinBitrate&&!Ye(n=t._hints).call(n,Dn.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(s=>{var l,h;Ye(l=["h264","h265","vp8","vp9","av1"]).call(l,((h=s.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-start-bitrate"]="".concat(Y("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function b3(e){if(e.media.mediaType!=="video")return;const t=on();if(t.name!==mn.SAFARI&&t.os!==ir.IOS)return;const n=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function lA(e,t,n){if(!t)return;let r,s;if(e.media.mediaType==="video"?(r=n.videoExtensions,s=n.videoCodecs):(r=n.audioExtensions,s=n.audioCodecs),t.twcc===!0){const l=r.find(h=>cA(h.extensionName));if(l){const h=l.extensionName;e.attributes.extmaps.find(m=>cA(m.extensionName))||e.attributes.extmaps.push({entry:l.entry,extensionName:h}),function(m,g){return g.filter(v=>!!m.find(T=>T.payloadType===v.payloadType&&!!T.rtcpFeedbacks.find(C=>C.type==="transport-cc")))}(s,e.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(g=>g.type==="transport-cc")||m.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const l=e.attributes.extmaps.findIndex(h=>cA(h.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");p!==-1&&h.rtcpFeedbacks.splice(p,1)})}if(t.remb===!0){const l=r.find(h=>E3(h.extensionName));if(l){const h=l.extensionName;e.attributes.extmaps.find(m=>m.extensionName===h)||e.attributes.extmaps.push({entry:l.entry,extensionName:h}),function(m,g){return g.filter(v=>!!m.find(T=>T.payloadType===v.payloadType&&!!T.rtcpFeedbacks.find(C=>C.type==="goog-remb")))}(s,e.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(g=>g.type==="goog-remb")||m.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const l=e.attributes.extmaps.findIndex(h=>E3(h.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>m.type==="goog-remb");p!==-1&&h.rtcpFeedbacks.splice(p,1)})}}function C3(e,t,n){if(_i()||e.media.mediaType!=="video"||!(t instanceof Xn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!Y("SIMULCAST")||n==="vp9"&&Y("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const r=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,s=e.attributes.ssrcs[0],l=e.attributes.ssrcGroups.find(p=>p.semantic==="FID"&&p.ssrcIds[0]===s.ssrcId),h={semantic:"SIM",ssrcIds:[s.ssrcId]};for(let p=1;p<r;p++)e.attributes.ssrcs.push({ssrcId:s.ssrcId+p,attributes:oi(s.attributes)}),h.ssrcIds.push(s.ssrcId+p),l&&(e.attributes.ssrcs.push({ssrcId:l.ssrcIds[1]+p,attributes:oi(s.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[s.ssrcId+p,l.ssrcIds[1]+p]}));e.attributes.ssrcGroups.unshift(h)}async function w3(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:s,recv:l,sendrecv:h}=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;const v=oT(g,p,m,"sendonly"),T=oT(g,p,m,"recvonly"),C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},U={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Oc(v,T,"videoExtensions",C,I,U),Oc(v,T,"videoCodecs",C,I,U),Oc(v,T,"audioExtensions",C,I,U),Oc(v,T,"audioCodecs",C,I,U),Y("RAISE_H264_BASELINE_PRIORITY")){const k=[],M=[];U.videoCodecs.forEach((F,B)=>{var ee;if(((ee=F.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"){var ue,de;const ae=U.videoCodecs[B+1],Te=ae&&D3(F,ae),Ae=(ue=F.fmtp)===null||ue===void 0?void 0:ue.parameters["profile-level-id"],We=(de=F.fmtp)===null||de===void 0?void 0:de.parameters["packetization-mode"];!Ae||Ae!==Y("FIRST_H264_PROFILE_LEVEL_ID")||Y("FIRST_PACKETIZATION_MODE")&&We!==Y("FIRST_PACKETIZATION_MODE")?Te?M.push([F,ae]):M.push([F]):Te?k.push([F,ae]):k.push([F])}}),k.length>0&&M.length>0&&(D.debug("raising H264 baseline profile priority"),U.videoCodecs.forEach((F,B)=>{var ee;if(((ee=F.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"){const ue=D3(F,U.videoCodecs[B+1]),de=k.shift()||M.shift()||[];de.length>0&&(ue?U.videoCodecs.splice(B,2,...de):U.videoCodecs.splice(B,1,...de))}}),I.videoCodecs=I.videoCodecs.filter(F=>{var B,ee;return!(((B=F.rtpMap)===null||B===void 0?void 0:B.encodingName.toLocaleLowerCase())==="h264"&&((ee=F.fmtp)===null||ee===void 0?void 0:ee.parameters["profile-level-id"])!==Y("FIRST_H264_PROFILE_LEVEL_ID"))}),Y("FILTER_SEND_H264_BASELINE")&&(C.videoCodecs=C.videoCodecs.filter(F=>{var B,ee;return!(((B=F.rtpMap)===null||B===void 0?void 0:B.encodingName.toLocaleLowerCase())==="h264"&&((ee=F.fmtp)===null||ee===void 0?void 0:ee.parameters["profile-level-id"])!==Y("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:C,recv:I,sendrecv:U}}(e,t,r);try{n.close()}catch{}return{send:s,recv:l,sendrecv:h}}function A3(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=oT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Oc(e,t,"videoExtensions",n,r,s),Oc(e,t,"videoCodecs",n,r,s),Oc(e,t,"audioExtensions",n,r,s),Oc(e,t,"audioCodecs",n,r,s),Y("RAISE_H264_BASELINE_PRIORITY")){const l=s.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(l!==-1){const h=s.videoCodecs.findIndex(p=>p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<l){D.debug("raising H264 baseline profile priority");const p=s.videoCodecs[l];s.videoCodecs.splice(l,1),s.videoCodecs.splice(h,0,p)}h!==-1&&(r.videoCodecs=r.videoCodecs.filter(p=>!(p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&p.fmtp&&p.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:r,sendrecv:s}}function Oc(e,t,n,r,s,l){if(n==="videoExtensions"||n==="audioExtensions"){const h=[];return e[n].forEach(p=>{t[n].some((m,g)=>{if(p.entry===m.entry&&p.extensionName===m.extensionName)return h.push(g),!0})?l[n].push(p):r[n].push(p)}),void t[n].forEach((p,m)=>{h.indexOf(m)===-1&&s[n].push(p)})}if(n==="videoCodecs"||n==="audioCodecs"){const h=[];return e[n].forEach(p=>{t[n].some((m,g)=>{if(p.payloadType===m.payloadType&&JSON.stringify(p)===JSON.stringify(m))return h.push(g),!0})?l[n].push(p):r[n].push(p)}),void t[n].forEach((p,m)=>{h.indexOf(m)===-1&&s[n].push(p)})}}function dA(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let s,l;return t?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...t.audioCodecs,...r.audioCodecs],s.videoCodecs=[...t.videoCodecs,...r.videoCodecs],s.audioExtensions=[...t.audioExtensions,...r.audioExtensions],s.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):s=r,n?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...n.audioCodecs,...r.audioCodecs],l.videoCodecs=[...n.videoCodecs,...r.videoCodecs],l.audioExtensions=[...n.audioExtensions,...r.audioExtensions],l.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):l=r,{send:s,recv:l}}function PE(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function cT(e,t,n,r){let s=[];if(e===it.VIDEO){if(Y("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(s=t.videoCodecs.filter(l=>{var h;return Ye(h=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(h,r)&&l&&l.fmtp&&l.fmtp.parameters["profile-level-id"]===Y("H264_PROFILE_LEVEL_ID")})),!Array.isArray(s)||s.length===0){let l=[];const h=[],p=[],m=[];if(n.videoCodecs.forEach(g=>{const v=g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"";Ye(v).call(v,r)?l.push(g):Ye(v).call(v,"vp9")?h.push(g):Ye(v).call(v,"vp8")?p.push(g):Ye(v).call(v,"h264")&&m.push(g)}),l.length===0){let g="";h.length!==0?(l=h,g="vp9"):p.length!==0?(l=p,g="vp8"):m.length!==0&&(l=m,g="h264"),D.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(g))}l.length!==0&&(s=t.videoCodecs.filter(g=>l.some(v=>v.payloadType===g.payloadType)))}if(s.length===0&&(D.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),s=t.videoCodecs),Y("USE_PUB_RTX")||Y("USE_SUB_RTX")){const l=MP(s,t.videoCodecs);s=[...s,...l]}}else{s=t.audioCodecs.filter(h=>{var p;return Ye(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,r)});const l=t.audioCodecs.filter(h=>{var p;return Ye(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,"red")});s.length===0&&(D.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),s=t.audioCodecs.filter(h=>{var p;return Ye(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,"opus")})),Y("ENABLE_AUDIO_RED")&&l.length!==0&&(s=[...l,...s])}return s}function MP(e,t){const n=e.map(r=>r.payloadType.toString());return t.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&Ye(n).call(n,r.fmtp&&r.fmtp.parameters.apt))}async function lT(e,t,n){const r=t.toString(),s=N3(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const l=await e.createAnswer();if(!l.sdp)throw new Error("cannot get answer sdp");let h=l.sdp;h=I3(h,n||{}),s==null||s(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function I3(e,t,n){const r=ca(e),{useXR:s}=t;return r.mediaDescriptions.forEach(l=>{var h;l.attributes.mid&&(Array.isArray(n)&&!Ye(n).call(n,l.attributes.mid)||(l.media.mediaType==="audio"&&PE(l),s&&Ye(h=["audio","video"]).call(h,l.media.mediaType)&&l.attributes.payloads.forEach(p=>{p.rtcpFeedbacks.findIndex(m=>m.type==="rrtr")===-1&&p.rtcpFeedbacks.push({type:"rrtr"})})))}),hp(r)}function N3(e,t,n,r){if(Y("SDP_LOGGING"))return D.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?s=>{N3(s,"answer",n==="local"?"remote":"local",r)}:void 0}function O3(e){const t=Y("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>Ye(e).call(e,n))}function D3(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function P3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function Ma(e,t){return typeof Y(e)===t?Y(e):void 0}function e$(){try{const e=Y("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?P3(Object(r),!0).forEach(function(s){V(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):P3(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}({},e)}catch(e){return D.debug("handle gateway attributes failed: ",e),{}}}const L3={};function Ep(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&D.debug("install service ".concat(e.name)),L3[e.name]=e}function Hu(e){const t=L3[e];if(!t)throw new Re(H.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function k3(e,t){return Hu("DataStream").create(e,t)}function uA(){return Hu("InterceptFrame").create()}function x3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function wd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?x3(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x3(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const UP=new Map;class t$ extends ai{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(hr.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(hr.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){D.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var r,s,l;super(),V(this,"store",void 0),V(this,"joinInfo",void 0),V(this,"key",void 0),V(this,"ntpOffset",0),V(this,"signal",void 0),V(this,"role",void 0),V(this,"inChannelInfo",{joinAt:null,duration:0}),V(this,"spec",void 0),V(this,"_state","DISCONNECTED"),V(this,"_statsCollector",void 0),V(this,"_disconnectedReason",void 0),V(this,"isSignalRecover",!1),V(this,"hasChangeBGPAddress",!1),V(this,"trafficStatsInterval",void 0),V(this,"networkQualityInterval",void 0),V(this,"_joinGatewayStartTime",0),V(this,"_signalTimeout",!1),V(this,"_clientRoleOptions",void 0),V(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(r={spec:wd(wd({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(s=(l=Hu("P2PChannel")).createSubmodule)===null||s===void 0?void 0:s.call(l,r)):new $Q(wd(wd({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,r){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const s=Date.now();let l=UP.get(t.cname);if(l||(l=new Map,UP.set(t.cname,l)),this._isProactiveJoin=!0,l.has(t.uid)){const g=new ye(H.UID_CONFLICT);throw ft.joinGateway(t.sid,{lts:s,succ:!1,ec:g.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),g}l.set(t.uid,!0),this.joinInfo=t,this.key=n;let h=0;this.joinGatewayStartTime=s;const p=t.proxyServer;try{D.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const g=t.gatewayAddrs.map(v=>{let{address:T}=v;const[C,I]=T.split(":"),U={host:C,port:I};return t.proxyServer&&(U.proxy=t.proxyServer),U});h=(await this.signal.init(g)).uid,D.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(g){var m;throw D.error("[".concat(this.store.clientId,"] User join failed"),g.toString()),ft.joinGateway(t.sid,{lts:s,succ:!1,ec:((m=g.data)===null||m===void 0?void 0:m.desc)||g.code,errorMsg:g.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!p,signalChannel:"0",preload:t.preload}),l.delete(t.uid),this.signal.close(),g}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),D.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(g=>{D.warning("[".concat(this.store.clientId,"] get traffic stats error"),g.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(hr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(hr.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(hr.NETWORK_QUALITY,{uplinkNetworkQuality:m3(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:m3(this._statsCollector.trafficStats.B_dnq)}):this.emit(hr.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==En.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Wn.CONNECTED||await function(r,s){return s===1/0?r:Je.race([r,CJ(s)])}(this.signal.request(Ct.LEAVE,void 0,!0),3e3)}catch(r){D.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==En.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:Y("PUB_EXTEND"),twcc:!!Y("PUBLISH_TWCC"),rtx:!!Y("USE_PUB_RTX")};try{return(await this.signal.request(Ct.PUBLISH,s,!0))._message}catch(l){if(r&&l.data&&l.data.code===vt.ERR_PUBLISH_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),l.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw l}}async publishDataChannel(t,n,r){var s;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const l={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(s=n.maxRetransmits)!==null&&s!==void 0?s:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(Ct.PUBLISH_DATASTREAM,l,!0)}catch(h){if(r&&h.data&&h.data.code===vt.ERR_PUBLISH_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw h}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Ct.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(r){D.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Je.all(t.map(n=>this.signal.request(Ct.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){D.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const s={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Y("SUBSCRIBE_TWCC"),rtx:!!Y("USE_SUB_RTX")||void 0,extend:Y("SUB_EXTEND"),svc:Array.isArray(Y("SVC"))&&Y("SVC").length!==0?Y("SVC"):void 0};try{return await this.signal.request(Ct.PRE_SUBSCRIBE,s,!0)}catch(l){if(r&&l.data&&l.data.code===vt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),l.toString()),this.presubscribe(t,n,!1);throw l}}async subscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const s={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Y("SUBSCRIBE_TWCC"),rtx:!!Y("USE_SUB_RTX"),extend:Y("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(Y("SVC"))&&Y("SVC").length!==0?Y("SVC"):void 0};try{return(await this.signal.request(Ct.SUBSCRIBE,s,!0))._message}catch(l){if(r&&l.data&&l.data.code===vt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),l.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw l}}async subscribeDataChannel(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const s={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(Ct.SUBSCRIBE_DATASTREAM,s,!0)}catch(l){if(r&&l.data&&l.data.code===vt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),l.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw l}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!Y("USE_SUB_RTX"),twcc:!!Y("SUBSCRIBE_TWCC"),svc:Array.isArray(Y("SVC"))&&Y("SVC").length!==0?Y("SVC"):void 0};try{return await this.signal.request(Ct.SUBSCRIBE_STREAMS,r,!0)}catch(s){if(n&&s.data&&s.data.code===vt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),s.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw s}}async setVideoProfile(t){const n=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let s=r.frameRate,l=r.width,h=r.height,p=!0;return typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(p=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,l||(p=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,s||(p=!1)),p?{stream_type:0,width:l,height:h,fps:s,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(t);if(n)return this.signal.request(Ct.SET_VIDEO_PROFILE,n);D.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(Ct.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(r){D.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Je.all(t.map(r=>this.signal.request(Ct.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0)))}catch(r){D.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(t){try{await this.signal.request(Ct.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){D.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:r,rtpCapabilities:s}=t;return{gatewayEstablishParams:await this.signal.request(Ct.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:s}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Ct.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Ct.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),Y("CLIENT_ROLE_OPTIONS")&&(D.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Y("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},Y("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),Y("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},Y("CLIENT_ROLE_OPTIONS")),D.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Y("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let r,s=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,s=1):s=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:s=0,await this.signal.request(Ct.SET_CLIENT_ROLE,{role:t,level:s,delay:r,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(Ct.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Ct.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(Ct.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(Ct.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Ct.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,r){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),wd({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Ct.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=UP.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:kr.username,password:kr.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(wd(wd({},kr),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Ct.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(s=>s.peer_uid===n.peer_uid);r&&r.B_st!==n.B_st&&Pw(()=>{this.emit(hr.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n;if(!this.joinInfo||!this.key)throw new ye(H.UNEXPECTED_ERROR,"can not generate join message, no join info");const r=Object.assign({},this.joinInfo.apResponse);let s=Y("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=JSON.stringify(s)}catch{s=void 0}var l;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(hr.UPDATE_GATEWAY_CONFIG),l=this.store.clientId,Ye(CE).call(CE,l)||CE.push(l);const h=!(_i()||$j(87)||BV())&&typeof Y("ENABLE_PRE_SUB")=="boolean"&&Y("ENABLE_PRE_SUB"),p=!BV()&&Ma("ENABLE_PREALLOC_PC","boolean"),m=e$(),g=HS(87)||function(){const T=on();if(T.name!==mn.SAFARI||!T.browserVersion)return!1;const C=T.browserVersion.split(".");return Number(C[0])>15||Number(C[0])===15&&Number(C[1])>=4}(),v=wd({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Lo,browser:navigator.userAgent,process_id:Y("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:Y("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:wd(wd({enableEncodedTransform:!!Y("ENABLE_AUDIO_METADATA")&&g||!!Y("ENABLE_AUDIO_TOPN")&&ID(mn.CHROME,87,116)||void 0,enableAudioMetadata:!!Y("ENABLE_AUDIO_METADATA")&&g,enableAudioPts:!!Y("ENABLE_AUDIO_PTS_METADATA")&&g,topnSmoothLevel:Y("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:Y("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:Y("TOPN_SWITCH_HOLD_MS"),topnAudioGain:Y("TOPN_AUDIO_GAIN"),enablePublishedUserList:Y("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:Y("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Ma("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Ma("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Ma("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:Y("USE_PUB_RTX")===!0||Y("USE_SUB_RTX")===!0||void 0,disableFEC:Y("DISABLE_FEC"),enableNTPReport:!!Y("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!Y("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!Y("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Ma("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!Y("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!Y("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Ma("USE_XR","boolean"),enableLossbasedBwe:Ma("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!Y("ENABLE_AUT_CC")||void 0,enableCCFallback:Ma("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:p,preSubNum:h?Ma("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Ma("PUBLISH_TWCC","boolean"),enableSubTWCC:Ma("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Ma("USE_PUB_RTX","boolean"),enableSubRTX:Ma("USE_SUB_RTX","boolean"),enableSubSVC:Y("ENABLE_SVC")?Y("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(Y("SVC"))&&Y("SVC").length!==0?Y("SVC"):void 0,enableSvcExtended:Y("ENABLE_SVC")&&Array.isArray(Y("SVC_EXTENDED"))&&Y("SVC_EXTENDED").length!==0?Y("SVC_EXTENDED"):void 0},m),{},{audioDuplicate:Ma("ENABLE_AUDIO_RED","boolean")?(n=Ma("AUDIO_DUPLICATE_NUM","number"))!==null&&n!==void 0?n:2:void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(v.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(v.aes_mode=this.joinInfo.aesmode,Y("ENCRYPT_AES")?(v.aes_secret=this.joinInfo.aespassword,v.aes_encrypt=!0):v.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(v.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(v.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),this.joinInfo.defaultVideoStream!==void 0&&(v.default_video_stream=this.joinInfo.defaultVideoStream),v}getRejoinMessage(){if(!this.joinInfo)throw new ye(H.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(At.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(At.WS_RECONNECTING,t=>{this.joinInfo&&ft.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Pr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",ft.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(At.WS_CLOSED,t=>{let n;switch(t){case En.LEAVE:n=Pr.LEAVE;break;case En.UID_BANNED:case En.IP_BANNED:case En.CHANNEL_BANNED:case En.SERVER_ERROR:n=Pr.SERVER_ERROR;break;case En.FALLBACK:n=Pr.FALLBACK;break;case En.LICENSE_MISSING:case En.LICENSE_EXPIRED:case En.LICENSE_MINUTES_EXCEEDED:case En.LICENSE_PERIOD_INVALID:case En.LICENSE_MULTIPLE_SDK_SERVICE:case En.LICENSE_ILLEGAL:case En.TOKEN_EXPIRE:n=t;break;default:n=Pr.NETWORK_ERROR}D.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Pr.NETWORK_ERROR)),this.joinInfo&&ft.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===En.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==En.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(At.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=Y("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(D.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(ft.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void D.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));wn("EVENT_REPORT_DOMAIN",t[1]),wn("EVENT_REPORT_BACKUP_DOMAIN",t[1]),wn("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(Yt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(At.REQUEST_RECOVER,(t,n,r)=>{if(!this.joinInfo)return r(new ye(H.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Lr(this,hr.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)}),this.signal.on(At.REQUEST_JOIN_INFO,async(t,n,r)=>{var s;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const l=oi((s=this.joinInfo)===null||s===void 0?void 0:s.turnServer);if(Y("NEW_TURN_MODE")&&l){let g=l.servers,v=l.serversFromGateway;const T=this.signal.currentURLIndex;g.length>0&&(g=[g[T%g.length]],l.servers=g),Array.isArray(v)&&v.length>0&&(v=[v[0]],l.serversFromGateway=v),D.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(T))}const{iceParameters:h,dtlsParameters:p,rtpCapabilities:m}=await Lr(this,hr.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:l});try{t(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:p,rtpCapabilities:m,version:"2"}}))}catch(g){n(g)}}),this.signal.on(At.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(At.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let r,s="";var l;t instanceof ye?(r=((l=t.data)===null||l===void 0?void 0:l.desc)||t.code,s=t.message):r=t,ft.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:s,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(At.IS_P2P_DISCONNECTED,t=>{t(YS(this,hr.IS_P2P_DISCONNECTED))}),this.signal.on(At.DISCONNECT_P2P,()=>{this.emit(hr.DISCONNECT_P2P)}),this.signal.on(At.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(At.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(At.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(hr.JOIN_RESPONSE,t,n)}),this.signal.on(At.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const t=this.getCurrentGatewayAddress(),n=Y("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(t&&n){const r=R3(t);this.emit(hr.PRE_CONNECT_PC,{candidates:r,fingerprint:n})}}}),this.signal.on(At.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof Y("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(Y("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(Ct.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(r){throw D.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(Ct.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw D.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(Ct.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(r){throw D.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(Ct.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw D.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(t){const n={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(Ct.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw D.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,n){const r={action:t.find(s=>s.stream_type===Sn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ct.CONTROL,r,!0,!0)}catch(s){throw D.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),s),s}}async unmuteLocal(t,n){const r={action:t.find(s=>s.stream_type===Sn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ct.CONTROL,r,!0,!0)}catch(s){throw D.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),s),s}}async muteRemote(t,n){const r={action:t===it.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Ct.CONTROL,r,!0,!0)}catch(s){throw D.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),s),s}}async unmuteRemote(t,n){const r={action:t===it.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Ct.CONTROL,r,!0,!0)}catch(s){throw D.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),s),s}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Ct.RESTART_ICE,n,!0)}catch(r){throw D.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||Pr.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!Y("GATEWAY_WSS_ADDRESS"))return Y("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(D.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Ct.SET_PARAMETER,{enablePublishAudioFilter:t})}}let hA=0,jP=0;function Rl(e,t,n,r){return new Je((s,l)=>{t.timeout=t.timeout||Y("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),hA+=vd(t.data)):n&&(t.data.size?hA+=t.data.size:t.data instanceof FormData?hA+=_V(t.data):hA+=vd(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Bs.request(t).then(h=>{typeof h.data=="string"?jP+=vd(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?jP+=h.data.byteLength:jP+=vd(JSON.stringify(h.data)),r&&s({data:h.data,headers:h.headers}),s(h.data)}).catch(h=>{Bs.isCancel(h)?l(new ye(H.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?l(new ye(H.NETWORK_TIMEOUT,h.message)):h.response?l(new ye(H.NETWORK_RESPONSE_ERROR,h.response.status)):l(new ye(H.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(Ie){var Ve=0;return function(){return Ve<Ie.length?{done:!1,value:Ie[Ve++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(Ie,Ve,ct){return Ie==Array.prototype||Ie==Object.prototype||(Ie[Ve]=ct.value),Ie},r,s=function(Ie){Ie=[typeof globalThis=="object"&&globalThis,Ie,typeof window=="object"&&window,typeof self=="object"&&self,typeof d=="object"&&d];for(var Ve=0;Ve<Ie.length;++Ve){var ct=Ie[Ve];if(ct&&ct.Math==Math)return ct}throw Error("Cannot find global object")}(this);function l(Ie,Ve){if(Ve)e:{var ct=s;Ie=Ie.split(".");for(var Ne=0;Ne<Ie.length-1;Ne++){var L=Ie[Ne];if(!(L in ct))break e;ct=ct[L]}(Ve=Ve(Ne=ct[Ie=Ie[Ie.length-1]]))!=Ne&&Ve!=null&&n(ct,Ie,{configurable:!0,writable:!0,value:Ve})}}function h(Ie){return(Ie={next:Ie})[Symbol.iterator]=function(){return this},Ie}function p(Ie){var Ve=typeof Symbol<"u"&&Symbol.iterator&&Ie[Symbol.iterator];return Ve?Ve.call(Ie):{next:t(Ie)}}if(l("Symbol",function(Ie){function Ve(L,X){this.A=L,n(this,"description",{configurable:!0,writable:!0,value:X})}if(Ie)return Ie;Ve.prototype.toString=function(){return this.A};var ct="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ne=0;return function L(X){if(this instanceof L)throw new TypeError("Symbol is not a constructor");return new Ve(ct+(X||"")+"_"+Ne++,X)}}),l("Symbol.iterator",function(Ie){if(Ie)return Ie;Ie=Symbol("Symbol.iterator");for(var Ve="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ct=0;ct<Ve.length;ct++){var Ne=s[Ve[ct]];typeof Ne=="function"&&typeof Ne.prototype[Ie]!="function"&&n(Ne.prototype,Ie,{configurable:!0,writable:!0,value:function(){return h(t(this))}})}return Ie}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var m;e:{var g={};try{g.__proto__={a:!0},m=g.a;break e}catch{}m=!1}r=m?function(Ie,Ve){if(Ie.__proto__=Ve,Ie.__proto__!==Ve)throw new TypeError(Ie+" is not extensible");return Ie}:null}var v=r;function T(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function C(Ie){if(Ie.m)throw new TypeError("Generator is already running");Ie.m=!0}function I(Ie,Ve){return Ie.h=3,{value:Ve}}function U(Ie){this.g=new T,this.G=Ie}function k(Ie,Ve,ct,Ne){try{var L=Ve.call(Ie.g.j,ct);if(!(L instanceof Object))throw new TypeError("Iterator result "+L+" is not an object");if(!L.done)return Ie.g.m=!1,L;var X=L.value}catch(re){return Ie.g.j=null,Ie.g.s(re),M(Ie)}return Ie.g.j=null,Ne.call(Ie.g,X),M(Ie)}function M(Ie){for(;Ie.g.h;)try{var Ve=Ie.G(Ie.g);if(Ve)return Ie.g.m=!1,{value:Ve.value,done:!1}}catch(ct){Ie.g.v=void 0,Ie.g.s(ct)}if(Ie.g.m=!1,Ie.g.l){if(Ve=Ie.g.l,Ie.g.l=null,Ve.F)throw Ve.D;return{value:Ve.return,done:!0}}return{value:void 0,done:!0}}function F(Ie){this.next=function(Ve){return Ie.o(Ve)},this.throw=function(Ve){return Ie.s(Ve)},this.return=function(Ve){return function(ct,Ne){C(ct.g);var L=ct.g.j;return L?k(ct,"return"in L?L.return:function(X){return{value:X,done:!0}},Ne,ct.g.return):(ct.g.return(Ne),M(ct))}(Ie,Ve)},this[Symbol.iterator]=function(){return this}}function B(Ie,Ve){return Ve=new F(new U(Ve)),v&&Ie.prototype&&v(Ve,Ie.prototype),Ve}if(T.prototype.o=function(Ie){this.v=Ie},T.prototype.s=function(Ie){this.l={D:Ie,F:!0},this.h=this.C||this.u},T.prototype.return=function(Ie){this.l={return:Ie},this.h=this.u},U.prototype.o=function(Ie){return C(this.g),this.g.j?k(this,this.g.j.next,Ie,this.g.o):(this.g.o(Ie),M(this))},U.prototype.s=function(Ie){return C(this.g),this.g.j?k(this,this.g.j.throw,Ie,this.g.o):(this.g.s(Ie),M(this))},l("Array.prototype.entries",function(Ie){return Ie||function(){return function(Ve,ct){Ve instanceof String&&(Ve+="");var Ne=0,L=!1,X={next:function(){if(!L&&Ne<Ve.length){var re=Ne++;return{value:ct(re,Ve[re]),done:!1}}return L=!0,{done:!0,value:void 0}}};return X[Symbol.iterator]=function(){return X},X}(this,function(Ve,ct){return[Ve,ct]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ee=function(Ie,Ve){for(var ct=0;ct<Ie.length;ct++)Ve(Ie[ct])},ue=function(Ie){return Ie.replace(/\r?\n|\r/g,`\r
`)},de=function(Ie,Ve,ct){return Ve instanceof Blob?(ct=ct!==void 0?ct+"":typeof Ve.name=="string"?Ve.name:"blob",Ve.name===ct&&Object.prototype.toString.call(Ve)!=="[object Blob]"||(Ve=new File([Ve],ct)),[String(Ie),Ve]):[String(Ie),String(Ve)]},ae=function(Ie,Ve){if(Ie.length<Ve)throw new TypeError(Ve+" argument required, but only "+Ie.length+" present.")},Te=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ae=Te.FormData,We=Te.XMLHttpRequest&&Te.XMLHttpRequest.prototype.send,tt=Te.Request&&Te.fetch,Ft=Te.navigator&&Te.navigator.sendBeacon,xt=Te.Element&&Te.Element.prototype,wt=Te.Symbol&&Symbol.toStringTag;wt&&(Blob.prototype[wt]||(Blob.prototype[wt]="Blob"),"File"in Te&&!File.prototype[wt]&&(File.prototype[wt]="File"));try{new File([],"")}catch{Te.File=function(Ve,ct,Ne){return Ve=new Blob(Ve,Ne||{}),Object.defineProperties(Ve,{name:{value:ct},lastModified:{value:+(Ne&&Ne.lastModified!==void 0?new Date(Ne.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),wt&&Object.defineProperty(Ve,wt,{value:"File"}),Ve}}var qn=function(Ie){return Ie.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Pn=function(Ie){this.i=[];var Ve=this;Ie&&ee(Ie.elements,function(ct){if(ct.name&&!ct.disabled&&ct.type!=="submit"&&ct.type!=="button"&&!ct.matches("form fieldset[disabled] *"))if(ct.type==="file"){var Ne=ct.files&&ct.files.length?ct.files:[new File([],"",{type:"application/octet-stream"})];ee(Ne,function(L){Ve.append(ct.name,L)})}else ct.type==="select-multiple"||ct.type==="select-one"?ee(ct.options,function(L){!L.disabled&&L.selected&&Ve.append(ct.name,L.value)}):ct.type==="checkbox"||ct.type==="radio"?ct.checked&&Ve.append(ct.name,ct.value):(Ne=ct.type==="textarea"?ue(ct.value):ct.value,Ve.append(ct.name,Ne))})};if((e=Pn.prototype).append=function(Ie,Ve,ct){ae(arguments,2),this.i.push(de(Ie,Ve,ct))},e.delete=function(Ie){ae(arguments,1);var Ve=[];Ie=String(Ie),ee(this.i,function(ct){ct[0]!==Ie&&Ve.push(ct)}),this.i=Ve},e.entries=function Ie(){var Ve,ct=this;return B(Ie,function(Ne){if(Ne.h==1&&(Ve=0),Ne.h!=3)return Ve<ct.i.length?Ne=I(Ne,ct.i[Ve]):(Ne.h=0,Ne=void 0),Ne;Ve++,Ne.h=2})},e.forEach=function(Ie,Ve){ae(arguments,1);for(var ct=p(this),Ne=ct.next();!Ne.done;Ne=ct.next()){var L=p(Ne.value);Ne=L.next().value,L=L.next().value,Ie.call(Ve,L,Ne,this)}},e.get=function(Ie){ae(arguments,1);var Ve=this.i;Ie=String(Ie);for(var ct=0;ct<Ve.length;ct++)if(Ve[ct][0]===Ie)return Ve[ct][1];return null},e.getAll=function(Ie){ae(arguments,1);var Ve=[];return Ie=String(Ie),ee(this.i,function(ct){ct[0]===Ie&&Ve.push(ct[1])}),Ve},e.has=function(Ie){ae(arguments,1),Ie=String(Ie);for(var Ve=0;Ve<this.i.length;Ve++)if(this.i[Ve][0]===Ie)return!0;return!1},e.keys=function Ie(){var Ve,ct,Ne,L,X=this;return B(Ie,function(re){if(re.h==1&&(Ve=p(X),ct=Ve.next()),re.h!=3)return ct.done?void(re.h=0):(Ne=ct.value,L=p(Ne),I(re,L.next().value));ct=Ve.next(),re.h=2})},e.set=function(Ie,Ve,ct){ae(arguments,2),Ie=String(Ie);var Ne=[],L=de(Ie,Ve,ct),X=!0;ee(this.i,function(re){re[0]===Ie?X&&(X=!Ne.push(L)):Ne.push(re)}),X&&Ne.push(L),this.i=Ne},e.values=function Ie(){var Ve,ct,Ne,L,X=this;return B(Ie,function(re){if(re.h==1&&(Ve=p(X),ct=Ve.next()),re.h!=3)return ct.done?void(re.h=0):(Ne=ct.value,(L=p(Ne)).next(),I(re,L.next().value));ct=Ve.next(),re.h=2})},Pn.prototype._asNative=function(){for(var Ie=new Ae,Ve=p(this),ct=Ve.next();!ct.done;ct=Ve.next()){var Ne=p(ct.value);ct=Ne.next().value,Ne=Ne.next().value,Ie.append(ct,Ne)}return Ie},Pn.prototype._blob=function(){var Ie="----formdata-polyfill-"+Math.random(),Ve=[],ct="--"+Ie+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Ne,L){return typeof Ne=="string"?Ve.push(ct+qn(ue(L))+`"\r
\r
`+ue(Ne)+`\r
`):Ve.push(ct+qn(ue(L))+'"; filename="'+qn(Ne.name)+`"\r
Content-Type: `+(Ne.type||"application/octet-stream")+`\r
\r
`,Ne,`\r
`)}),Ve.push("--"+Ie+"--"),new Blob(Ve,{type:"multipart/form-data; boundary="+Ie})},Pn.prototype[Symbol.iterator]=function(){return this.entries()},Pn.prototype.toString=function(){return"[object FormData]"},xt&&!xt.matches&&(xt.matches=xt.matchesSelector||xt.mozMatchesSelector||xt.msMatchesSelector||xt.oMatchesSelector||xt.webkitMatchesSelector||function(Ie){for(var Ve=(Ie=(this.document||this.ownerDocument).querySelectorAll(Ie)).length;0<=--Ve&&Ie.item(Ve)!==this;);return-1<Ve}),wt&&(Pn.prototype[wt]="FormData"),We){var qs=Te.XMLHttpRequest.prototype.setRequestHeader;Te.XMLHttpRequest.prototype.setRequestHeader=function(Ie,Ve){qs.call(this,Ie,Ve),Ie.toLowerCase()==="content-type"&&(this.B=!0)},Te.XMLHttpRequest.prototype.send=function(Ie){Ie instanceof Pn?(Ie=Ie._blob(),this.B||this.setRequestHeader("Content-Type",Ie.type),We.call(this,Ie)):We.call(this,Ie)}}tt&&(Te.fetch=function(Ie,Ve){return Ve&&Ve.body&&Ve.body instanceof Pn&&(Ve.body=Ve.body._blob()),tt.call(this,Ie,Ve)}),Ft&&(Te.navigator.sendBeacon=function(Ie,Ve){return Ve instanceof Pn&&(Ve=Ve._asNative()),Ft.call(this,Ie,Ve)}),Te.FormData=Pn}})();const dT=()=>{const e=Y("AREAS");return e.length===0&&e.push(_n.GLOBAL),na(e).call(e,(t,n,r)=>{const s=M3(n);return s?r===0?s:"".concat(t,",").concat(s):t},"")},M3=e=>e===_n.OVERSEA?"".concat(qr.ASIA,",").concat(qr.EUROPE,",").concat(qr.AFRICA,",").concat(qr.NORTH_AMERICA,",").concat(qr.SOUTH_AMERICA,",").concat(qr.OCEANIA):qr[e],n$=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const r=rA[n],s=Object.keys(r);s&&s.map(l=>{l!=="CODE"&&(t[l]=t[l].concat(r[l]))})}),t},pA={GLOBAL:{ASIA:[_n.CHINA,_n.JAPAN,_n.INDIA,_n.KOREA,_n.HKMC],EUROPE:[],NORTH_AMERICA:[_n.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},fA=Object.keys(pA[_n.GLOBAL]),VP=[_n.CHINA,_n.NORTH_AMERICA,_n.EUROPE,_n.ASIA,_n.JAPAN,_n.INDIA,_n.OCEANIA,_n.SOUTH_AMERICA,_n.AFRICA,_n.KOREA,_n.HKMC,_n.US],i$=function(e,t){let n=[];if(Ye(e).call(e,_n.GLOBAL)){const l=[_n.GLOBAL,_n.OVERSEA],h=Object.keys(rA);if(t===_n.GLOBAL)throw new ye(H.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===_n.CHINA)n=[_n.OVERSEA];else if(s=t,Ye(fA).call(fA,s)){const p=(r=t,pA[_n.GLOBAL][r]||[]),m=[...l,t,...p];n=h.filter(g=>!Ye(m).call(m,g))}else if(function(p){let m=!1;return fA.forEach(g=>{var v;Ye(v=pA[_n.GLOBAL][g]).call(v,p)&&(m=!0)}),m}(t)){const p=function(g){let v;return fA.forEach(T=>{var C;Ye(C=pA[_n.GLOBAL][T]).call(C,g)&&(v=T)}),v}(t),m=[...l,p,t];n=h.filter(g=>!Ye(m).call(m,g))}else n=e;n=function(p){const m=[];return VP.forEach(g=>{Ye(p).call(p,g)&&m.push(g)}),m.concat(p.filter(g=>!Ye(VP).call(VP,g)))}(n)}else n=e;var r,s;return n};function U3(e){var t,n;if(!e&&Ye(t=Y("AREAS")).call(t,_n.EXTENSIONS))return D.debug("update area from ap : reset"),void FP(uQ,!0);if(!Ye(n=Y("AREAS")).call(n,_n.GLOBAL)||!e)return;let r=rA.EXTENSIONS;r&&(r={CODE:M3(_n.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},D.debug("update area from ap success: ".concat(e,",config is "),r),wn("AREAS",[_n.EXTENSIONS],!0),Object.keys(r).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?wn(s,r[s][0]):wn(s,r[s])}))}function FP(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=ft.reportApiInvoke(null,{name:Mi.SET_AREA,options:e,tag:Ei.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(l=>{if(!Ye(r3).call(r3,l))throw new ye(H.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:l,excludedArea:h}=e;if(!l)throw new ye(H.INVALID_PARAMS,"area code is needed");let p=l;typeof l=="string"&&(p=[l]),r=h?i$(p,h):p}if(!t){if(yl.AREAS){const l=new ye(H.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(l),void D.warning("setArea is prohibited because of config-distribute")}if(Ye(r).call(r,_n.GLOBAL)&&Y("AREAS")===_n.EXTENSIONS){const l=new ye(H.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(l),void D.warning("setArea is prohibited because of ap extensions")}}wn("AREAS",r,t);const s=n$(r);Object.keys(s).map(l=>{l==="LOG_UPLOAD_SERVER"||l==="EVENT_REPORT_DOMAIN"||l==="EVENT_REPORT_BACKUP_DOMAIN"||l==="PROXY_SERVER_TYPE3"?wn(l,s[l][0]):wn(l,s[l])}),D.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function j3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function Ad(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?j3(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j3(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let BP=1;function r$(e,t,n,r,s){BP+=1;const l={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:BP,requestId:BP,version:Lo,cname:n.cname},h={service_name:t,json_body:JSON.stringify(l)};let p,m,g=e[0];return El(async()=>{p=Date.now();const v=await Rl(g,{data:h,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-p,v.code!==0){const I=new ye(H.UNEXPECTED_RESPONSE,"live streaming ap error, code"+v.code,{retry:!0,responseTime:m});throw D.error(I.toString()),I}const T=JSON.parse(v.json_body);if(T.code!==200){const I=new ye(H.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(T.code,", reason: ").concat(T.reason),{code:T.code,responseTime:m});throw D.error(I.toString()),I}if(!T.servers||T.servers.length===0){const I=new ye(H.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:T.code,responseTime:m});throw D.error(I.toString()),I}const C=function(I,U){return{addressList:I.servers.map(k=>"wss://".concat(k.address.replace(/\./g,"-"),".").concat(Y("WORKER_DOMAIN"),":").concat(k.wss,"?serviceName=").concat(encodeURIComponent(U))),workerToken:I.workerToken,vid:I.vid}}(T,t);return Y("LIVE_STREAMING_ADDRESS")&&(C.addressList=Y("LIVE_STREAMING_ADDRESS")instanceof Array?Y("LIVE_STREAMING_ADDRESS"):[Y("LIVE_STREAMING_ADDRESS")]),Ad(Ad({},C),{},{responseTime:m})},(v,T)=>(ft.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(v.addressList),firstSuccess:T===0,responseTime:m,serverIp:e[T%e.length]}),!1),(v,T)=>(ft.apworkerEvent(n.sid,{success:!1,sc:v.data&&v.data.code||200,serviceName:t,responseTime:m,serverIp:e[T%e.length]}),!!(v.code!==H.OPERATION_ABORTED&&v.code!==H.UNEXPECTED_RESPONSE||v.data&&v.data.retry)&&(g=e[(T+1)%e.length],!0)),s)}let GP=1;function V3(e,t,n,r){let{url:s,areaCode:l}=e;const{clientId:h,sid:p}=t,m=Date.now();let g;const v=t.role,[T,C]=zP(t,l,[ji.CHOOSE_SERVER]);let I=Ui.networkState;return El(async()=>{I&&Ui.networkState===ka.OFFLINE&&Ui.onlineWaiter&&await Je.race([Ui.onlineWaiter,Tr(r&&r.maxRetryTimeout||Gi.maxRetryTimeout)]),I=Ui.networkState;const{data:U,headers:k}=await Rl(s,{data:T,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=k.http3==="1"?1:-1,ft.reportResourceTiming(s,p),B3(U,s,t,m,[ji.CHOOSE_SERVER],g);const M=aT(U,ji.CHOOSE_SERVER);return HP(M),PP(M,s)},U=>(U&&ft.joinChooseServer(p,{role:v,lts:m,succ:!0,csAddr:s,opid:C,serverList:U.gatewayAddrs.map(k=>k.address),ec:null,cid:U.cid.toString(),uid:U.uid.toString(),csIp:U.csIp,unilbsServerIds:[ji.CHOOSE_SERVER].toString(),isHttp3:g,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:U.res.detail&&U.res.detail[38]}),!1),U=>U.code!==H.OPERATION_ABORTED&&(U.code===H.CAN_NOT_GET_GATEWAY_SERVER?U.data.retry:(ft.joinChooseServer(p,{role:v,lts:m,succ:!1,csAddr:s,serverList:null,opid:C,ec:U.code,csIp:U.data&&U.data.csIp,unilbsServerIds:[ji.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:I}),isHttp3:g,corssRegionTagReq:t.apRequestDetail}),D.warning("[".concat(h||"sid-".concat(p.slice(0,6)),"] Choose server network error, retry"),U),!0)),r)}function F3(e,t,n,r){let s,{url:l,areaCode:h,serviceIds:p}=e;const m=Date.now(),g=t.role,[v,T]=zP(t,h,p);let C;return El(async()=>{C&&Ui.networkState===ka.OFFLINE&&Ui.onlineWaiter&&await Je.race([Ui.onlineWaiter,Tr(r&&r.maxRetryTimeout||Gi.maxRetryTimeout)]),C=Ui.networkState;const{data:I,headers:U}=await Rl(l,{data:v,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s=U.http3==="1"?1:-1,ft.reportResourceTiming(l,t.sid),B3(I,l,t,m,p,s);const k=aT(I,ji.CHOOSE_SERVER),M=aT(I,t.cloudProxyServer==="proxy5"?ji.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?ji.CLOUD_PROXY:ji.CLOUD_PROXY_FALLBACK);return HP(k),{gatewayInfo:PP(k,l),proxyInfo:M,url:l}},I=>(I.gatewayInfo&&ft.joinChooseServer(t.sid,{role:g,lts:m,succ:!0,csAddr:l,serverList:I.gatewayInfo.gatewayAddrs.map(U=>U.address),ec:null,opid:T,cid:I.gatewayInfo.cid.toString(),uid:I.gatewayInfo.uid.toString(),csIp:I.gatewayInfo.csIp,unilbsServerIds:p.toString(),isHttp3:s,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:I.gatewayInfo.res.detail&&I.gatewayInfo.res.detail[38]}),I.proxyInfo&&ft.joinWebProxyAP(t.sid,{lts:m,sucess:1,apServerAddr:l,turnServerAddrList:I.proxyInfo.addresses.map(U=>U.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:p.toString()}),!1),I=>I.code!==H.OPERATION_ABORTED&&(I.code===H.CAN_NOT_GET_GATEWAY_SERVER?I.data.retry:(ft.joinWebProxyAP(t.sid,{lts:m,sucess:0,apServerAddr:l,turnServerAddrList:null,errorCode:I.code,eventType:t.cloudProxyServer,unilbsServerIds:p.toString(),extend:JSON.stringify({networkState:C})}),D.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),I),!0)),r)}const B3=(e,t,n,r,s,l)=>{const{sid:h,clientId:p,cloudProxyServer:m}=n,g=[],v=T=>{T.flag===4096?ft.joinChooseServer(h,{role:n.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:T.error.message,csIp:T.error.data&&T.error.data.csIp,unilbsServerIds:s.toString(),isHttp3:l,corssRegionTagReq:n.apRequestDetail}):T.flag!==1048576&&T.flag!==4194304&&T.flag!==4194310||ft.joinWebProxyAP(h,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:T.error.code,eventType:m,unilbsServerIds:s.toString()})};if(e.response_body.forEach(T=>{const C=T.buffer.code;if(T.uri===23&&C===0&&!T.buffer.edges_services)if(T.buffer.flag===4194310)D.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),T.buffer.edges_services=[];else{const I={error:new ye(H.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:T.buffer.flag};g.push(I),v(I)}if(C!==0){const I=NE(C),U={error:new ye(H.CAN_NOT_GET_GATEWAY_SERVER,I.desc,{desc:I.desc,retry:I.retry,csIp:e.detail[502]}),flag:T.buffer.flag};T.buffer.flag===4194310?D.warning(U.error.toString()):g.push(U),v(U)}}),g.length)throw D.warning("[".concat(p||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(g.map(T=>"flag: ".concat(T.flag,", message: ").concat(T.error.message,", retry: ").concat(T.error.data.retry)).join(" | "))),new ye(H.CAN_NOT_GET_GATEWAY_SERVER,g.map(T=>"flag: ".concat(T.flag,", message: ").concat(T.error.message)).join(" | "),{retry:!!g.find(T=>T.error.data.retry),csIp:e.detail[502],desc:[...new Set(g.map(T=>{var C;return T==null||(C=T.error)===null||C===void 0||(C=C.data)===null||C===void 0?void 0:C.desc}).filter(T=>!!T))]})},HP=e=>{var t,n,r,s;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new ye(H.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(Y("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((s=e.detail)===null||s===void 0?void 0:s[23])=="string"?U3(e.detail[23].toLowerCase()):U3()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const h=e.detail[19],p=h==null?void 0:h.split(";");for(let m=0;m<p.length;m++){var l;const g=_s(l=p[m]).call(l);e.addresses[m]&&p&&(e.addresses[m].fingerprint=g)}}if(Y("GATEWAY_ADDRESS")&&Y("GATEWAY_ADDRESS").length>0){D.debug("assign gateway address to",Y("GATEWAY_ADDRESS"));const h=Y("GATEWAY_ADDRESS").map(p=>{var m,g;const v=(m=(g=e.addresses.find(T=>T.ip===p.ip&&T.port===p.port))===null||g===void 0?void 0:g.fingerprint)!==null&&m!==void 0?m:"";return{ip:p.ip,port:p.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:v}});e.addresses=h}},s$=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const r=NE(n.buffer.code);throw new ye(H.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw D.debug("update ticket request received ap response without response body:",t),new ye(H.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},zP=(e,t,n)=>{const r=Math.floor(Math.random()*1e12),s=e.role==="host"?"1":e.role==="audience"?"2":void 0,l={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Ad(Ad(Ad({6:e.stringUid,11:t,12:Y("USE_NEW_TOKEN")?"1":void 0},s?{17:s}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};l.request_bodies.forEach(p=>{e.multiIP&&e.multiIP.gateway_ip&&(p.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(l)),[h,r]},a$=(e,t)=>{const n=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(l=>({ip:l.ip,port:l.port}))}}]},s=new FormData;return s.append("request",JSON.stringify(r)),[s,n]};let LE=0;function kE(e){return Je.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const uT=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:s,promisesCollector:l}=e,h=0;const p=t;let m,g=0;const v=async()=>{const T=(()=>{const C=h*p,I=C+p;return n.slice(C,I).map(r)})();l&&l.push(...T);try{m=await kE(T)}catch(C){if(g+=p,h++,!(g>=n.length))return void await v();s(C)}T.forEach(C=>C.cancel())};return await v(),m},G3=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const s=t.length;let l=0;const h=async()=>{const p=n(t.shift());try{return await p}catch(m){if(l++,l>=s||r!=null&&r(m))throw m;return h()}};return h()};async function WP(e,t,n,r){return{gatewayInfo:await async function(l,h,p,m){let g=null;const v=[],T=async()=>{const I=Y("WEBCS_DOMAIN").slice(0,Y("AJAX_REQUEST_CONCURRENT")).map(M=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(M+"/api/v2/transpond/webrtc?v=2"):"https://".concat(M,"/api/v2/transpond/webrtc?v=2"),areaCode:dT()})),U=m.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:I.map(M=>M.url)}),k=await uT({fragementLength:Y("FRAGEMENT_LENGTH"),referenceList:I,asyncMapHandler:M=>(D.debug("[".concat(l.clientId,"] Connect to choose_server:"),M.url),V3(M,l,h,p)),allFailedhandler:M=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},U),M[0]},promisesCollector:v});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},U),k},C=async()=>{if(await Tr(1e3),g!==null)return g;const I=Y("WEBCS_DOMAIN_BACKUP_LIST").map(M=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(M+"/api/v2/transpond/webrtc?v=2"):"https://".concat(M,"/api/v2/transpond/webrtc?v=2"),areaCode:dT()})),U=m.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:I.map(M=>M.url)}),k=await uT({fragementLength:Y("FRAGEMENT_LENGTH"),referenceList:I,asyncMapHandler:M=>(D.debug("[".concat(l.clientId,"] Connect to backup choose_server:"),M.url),V3(M,l,h,p)),allFailedhandler:M=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},U),M[0]},promisesCollector:v});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},U),k};try{return g=await kE([T(),C()]),v.length&&v.forEach(I=>I.cancel&&typeof I.cancel=="function"&&I.cancel()),g}catch(I){throw I[0]}}(e,t,n,r)}}async function H3(e,t,n,r,s){const l=e.cloudProxyServer;if(l==="disabled"){if(e.useLocalAccessPoint)return await WP(e,t,n,s);if(Y("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:C,proxyInfo:I}=await q3(e,t,n,s);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:C};const U=I.map(k=>({turnServerURL:k.address,tcpport:k.tcpport||kr.tcpport,udpport:k.udpport||kr.udpport,username:k.username||kr.username,password:k.password||kr.password,forceturn:!1,security:!0}));if(s.useP2P){var h;const k=(h=e.uid)!==null&&h!==void 0?h:C.uid,M="glb:".concat(k.toString()),F=await MD(M),B=I.map(ee=>({turnServerURL:ee.address,tcpport:ee.tcpport||kr.tcpport,udpport:ee.udpport||kr.udpport,username:M,password:F,forceturn:!1,security:!0}));U.push(...B)}return e.turnServer={mode:"manual",servers:U},{gatewayInfo:C}}return await WP(e,t,n,s)}const{proxyInfo:p,gatewayInfo:m}=await q3(e,t,n,s),g={gatewayInfo:m},v=p.map(C=>({turnServerURL:C.address,tcpport:l==="proxy3"?void 0:C.tcpport?C.tcpport:kr.tcpport,udpport:l==="proxy4"?void 0:C.udpport?C.udpport:kr.udpport,username:C.username||kr.username,password:C.password||kr.password,forceturn:l!=="proxy4",security:l==="proxy5"}));if(s.useP2P){var T;const C=(T=e.uid)!==null&&T!==void 0?T:m.uid,I="glb:".concat(C.toString()),U=await MD(I),k=p.map(M=>({turnServerURL:M.address,tcpport:l==="proxy3"?void 0:M.tcpport||kr.tcpport,udpport:l==="proxy4"?void 0:M.udpport||kr.udpport,username:I,password:U,forceturn:l!=="proxy4",security:l==="proxy5"}));v.push(...k)}return e.turnServer={mode:"manual",servers:v},D.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(l)),g}async function z3(e,t,n,r,s){const l=Y("ACCOUNT_REGISTER").slice(0,Y("AJAX_REQUEST_CONCURRENT"));let h=[];h=t.proxyServer?l.map(m=>"https://".concat(t.proxyServer,"/ap/?url=").concat(m+"/api/v1")):l.map(m=>"https://".concat(m,"/api/v1"));const p=s==null?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const m=await async function(g,v,T,C,I){const U=Date.now(),k={sid:T.sid,opid:10,appid:T.appId,string_uid:v};let M=g[0];const F=await El(()=>Rl(M+"".concat(M.indexOf("?")===-1?"?":"&","action=stringuid"),{data:k,cancelToken:C,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(B,ee)=>{if(B.code===0){if(B.uid<=0||B.uid>=Math.pow(2,32))throw D.error("Invalid Uint Uid ".concat(v," => ").concat(B.uid),B),ft.reqUserAccount(k.sid,{lts:U,success:!1,serverAddr:M,stringUid:k.string_uid,uid:B.uid,errorCode:H.INVALID_UINT_UID_FROM_STRING_UID,extend:k}),new ye(H.INVALID_UINT_UID_FROM_STRING_UID);return ft.reqUserAccount(k.sid,{lts:U,success:!0,serverAddr:M,stringUid:k.string_uid,uid:B.uid,errorCode:null,extend:k}),!1}const ue=NE(B.code);return ue.retry&&(M=g[(ee+1)%g.length]),ft.reqUserAccount(k.sid,{lts:U,success:!1,serverAddr:M,stringUid:k.string_uid,uid:B.uid,errorCode:ue.desc,extend:k}),ue.retry},(B,ee)=>B.code!==H.OPERATION_ABORTED&&(ft.reqUserAccount(k.sid,{lts:U,success:!1,serverAddr:M,stringUid:k.string_uid,uid:null,errorCode:B.code,extend:k}),M=g[(ee+1)%g.length],!0),I);if(F.code!==0){const B=NE(F.code);throw new ye(H.UNEXPECTED_RESPONSE,B.desc)}return F}(h,e,t,n,r);return s==null||s.recordJoinChannelService({status:"success",endTs:Date.now()},p),m.uid}catch(m){throw s==null||s.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},p),m}}async function o$(e,t,n){const r=Y("ACCOUNT_REGISTER");let s=[];s=t.proxyServer?r.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):r.map(l=>"https://".concat(l,"/api/v1"));try{return await G3({referenceList:s,asyncMapHandler:h=>async function(p,m,g,v){const T=Date.now(),C={sid:g.sid,opid:10,appid:g.appId,string_uid:m};try{const I=await Rl(p+"".concat(p.indexOf("?")===-1?"?":"&","action=stringuid"),{data:C,cancelToken:v,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(I.code!==0){const U=NE(I.code);throw new ye(H.UNEXPECTED_RESPONSE,"preload sua error:".concat(U.desc),U)}if(I.uid<=0||I.uid>=Math.pow(2,32))throw new ye(H.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:T,url:p,req:C,uid:I.uid,elapse:Date.now()-T}}catch(I){throw I}}(h,e,t,n),closeFn:h=>h.code===H.OPERATION_ABORTED||h.code===H.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(l){throw l}}async function c$(e,t,n){const r=Y("CDS_AP").slice(0,Y("AJAX_REQUEST_CONCURRENT")).map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1?action=config")),s=r.map(m=>function(g,v,T,C){const I=on(),U={flag:64,cipher_method:0,features:Ad(Ad(Ad(Ad(Ad({install_id:YD(),device:I.name,system:I.os,system_general:navigator.userAgent,vendor:v.appId,version:Lo,cname:v.cname,session_id:v.sid,proxyServer:v.proxyServer,sdk_type:ZQ.WEB_RTC,browser_name:I.name,browser_version:I.version,user_agent:navigator.userAgent,channel_name:v.cname},v.stringUid&&{string_uid:v.stringUid}),v.uid&&{uid:v.uid+""}),I.os&&{os_name:I.os}),I.osVersion&&{os_version:I.osVersion}),{},{detail:""})};return El(()=>Rl(g,{data:U,timeout:1e3,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,k=>k.code!==H.OPERATION_ABORTED,C)}(m,e,t,n));let l=null,h=null,p={};try{l=await kE(s)}catch(m){if(m.code===H.OPERATION_ABORTED)throw m;h=m}if(s.forEach(m=>m.cancel()),ft.reportApiInvoke(e.sid,{name:Mi.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:l}}).onSuccess(),l&&l.test_tags)try{p=function(m){if(!m.test_tags)return{};const g=m.test_tags,v=Object.keys(g),T={};return v.forEach(C=>{var I;const U=_s(I=C.slice(4)).call(I),k=JSON.parse(g[C]),M=k[1];T[U]={tag:k[0]||"",value:M}}),T}(l)}catch{}return p}async function W3(e,t){const n=Y("WEBCS_DOMAIN").concat(Y("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:dT(),serviceIds:[ji.CHOOSE_SERVER,ji.CLOUD_PROXY_FALLBACK]}));try{return await G3({referenceList:n,asyncMapHandler:s=>async function(l,h,p){let m,{url:g,areaCode:v,serviceIds:T}=l;const C=Date.now(),[I,U]=zP(h,v,T);let k=Ui.networkState;try{k&&Ui.networkState===ka.OFFLINE&&Ui.onlineWaiter&&await Je.race([Ui.onlineWaiter,Tr(Gi.maxRetryTimeout)]),k=Ui.networkState;const{data:M,headers:F}=await Rl(g,{data:I,cancelToken:p,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);m=F.http3==="1"?1:-1,(de=>{const ae=[];if(de.response_body.forEach(Te=>{const Ae=Te.buffer.code;if(Te.uri===23&&Ae===0&&!Te.buffer.edges_services)if(Te.buffer.flag===4194310)Te.buffer.edges_services=[];else{const We={error:new ye(H.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:de.detail[502]}),flag:Te.buffer.flag};ae.push(We)}if(Ae!==0){const We=NE(Ae),tt={error:new ye(H.CAN_NOT_GET_GATEWAY_SERVER,We.desc,{desc:We.desc,retry:We.retry,csIp:de.detail[502]}),flag:Te.buffer.flag};Te.buffer.flag===4194310?D.warning(tt.error.toString()):ae.push(tt)}}),ae.length)throw new ye(H.CAN_NOT_GET_GATEWAY_SERVER,ae.map(Te=>"flag: ".concat(Te.flag,", message: ").concat(Te.error.message)).join(" | "),{retry:!!ae.find(Te=>Te.error.data.retry),csIp:de.detail[502],desc:[...new Set(ae.map(Te=>{var Ae;return Te==null||(Ae=Te.error)===null||Ae===void 0||(Ae=Ae.data)===null||Ae===void 0?void 0:Ae.desc}).filter(Te=>!!Te))]})})(M);const ee=aT(M,ji.CHOOSE_SERVER),ue=aT(M,ji.CLOUD_PROXY_FALLBACK);return HP(ee),{gatewayInfo:PP(ee,g),proxyInfo:ue,opid:U,requestTime:C,url:g,isHttp3:m,elapse:Date.now()-C}}catch(M){throw M}}(s,e,t),closeFn:s=>s.code===H.OPERATION_ABORTED||s.code===H.CAN_NOT_GET_GATEWAY_SERVER&&!s.data.retry})}catch(r){throw r}}async function q3(e,t,n,r){const s=Y("PROXY_SERVER_TYPE3"),l=(I,U,k)=>{let M=k||s;return Array.isArray(M)&&(M=U%2==0?s[1]:s[0]),"https://".concat(M,"/ap/?url=").concat(I)};let h=null;const p=[],m=async()=>{const I=Y("WEBCS_DOMAIN").slice(0,Y("AJAX_REQUEST_CONCURRENT")).map((M,F)=>{let B;return B=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(M,"/api/v2/transpond/webrtc?v=2"),F,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(M,"/api/v2/transpond/webrtc?v=2"):l("".concat(M,"/api/v2/transpond/webrtc?v=2"),F),{url:B,areaCode:dT(),serviceIds:[ji.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ji.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ji.CLOUD_PROXY:ji.CLOUD_PROXY_FALLBACK]}}),U=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:I.map(M=>M.url)}),k=await uT({fragementLength:Y("FRAGEMENT_LENGTH"),referenceList:I,asyncMapHandler:M=>(D.debug("[".concat(e.clientId,"] Connect to choose_server:"),M.url),F3(M,e,t,n)),allFailedhandler:M=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},U),M[0]},promisesCollector:p});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},U),k},g=async()=>{if(await Tr(1e3),h!==null)return h;const I=Y("WEBCS_DOMAIN_BACKUP_LIST").map((M,F)=>{let B;return B=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(M,"/api/v2/transpond/webrtc?v=2"),F,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(M,"/api/v2/transpond/webrtc?v=2"):l("".concat(M,"/api/v2/transpond/webrtc?v=2"),F),{url:B,areaCode:dT(),serviceIds:[ji.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ji.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ji.CLOUD_PROXY:ji.CLOUD_PROXY_FALLBACK]}}),U=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:I.map(M=>M.url)}),k=await uT({fragementLength:Y("FRAGEMENT_LENGTH"),referenceList:I,asyncMapHandler:M=>(D.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),M.url),F3(M,e,t,n)),allFailedhandler:M=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},U),M[0]},promisesCollector:p});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},U),k};let v,T,C;try{({gatewayInfo:v,proxyInfo:T,url:C}=await kE([m(),g()]))}catch(I){throw I[0]}if(p.length&&p.forEach(I=>I.cancel&&typeof I.cancel=="function"&&I.cancel()),!v||!T)throw new ye(H.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=C,e.cloudProxyServer!=="disabled"&&Array.isArray(s)&&C){const I=/^https?:\/\/(.+?)(\/.*)?$/.exec(C)[1];Ye(s).call(s,I)&&(e.proxyServer=I,D.setProxyServer(I),ft.setProxyServer(I))}return h={gatewayInfo:v,proxyInfo:await _3(T,v.uid)},h}async function l$(e,t,n){const r=Y("UAP_AP").slice(0,Y("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap")),s=r.map(l=>function(h,p,m,g){const v={command:"convergeAllocateEdge",sid:p.sid,appId:p.appId,token:p.token,ts:Date.now(),version:Lo,cname:p.cname,uid:p.uid.toString(),requestId:GP,seq:GP};GP+=1;const T={service_name:"tele_channel",json_body:JSON.stringify(v)};return El(async()=>{const C=await Rl(h,{data:T,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(C.code!==0){const U=new ye(H.UNEXPECTED_RESPONSE,"cross channel ap error, code"+C.code,{retry:!0});throw D.error(U.toString()),U}const I=JSON.parse(C.json_body);if(I.code!==200){const U=new ye(H.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(I.code,", reason: ").concat(I.reason));throw D.error(U.toString()),U}if(!I.servers||I.servers.length===0){const U=new ye(H.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw D.error(U.toString()),U}return{vid:I.vid,workerToken:I.workerToken,addressList:(Y("CHANNEL_MEDIA_RELAY_SERVERS")||I.servers).map(U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat(Y("WORKER_DOMAIN"),":").concat(U.wss))}},void 0,C=>!!(C.code!==H.OPERATION_ABORTED&&C.code!==H.UNEXPECTED_RESPONSE||C.data&&C.data.retry),g)}(l,e,t,n));try{const l=await kE(s);return s.forEach(h=>h.cancel()),l}catch(l){throw l[0]}}async function d$(e,t,n){let r=null;const s=[],l=async h=>{const p=Y(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v2/transpond/webrtc?v=2"):"https://".concat(m,"/api/v2/transpond/webrtc?v=2"));return h&&(await Tr(1e3),r!==null)?r:await uT({fragementLength:Y("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:m=>(D.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),m),function(g,v,T,C){const[I]=a$(v,[ji.CHOOSE_SERVER]);let U=Ui.networkState;return El(async()=>{U&&Ui.networkState===ka.OFFLINE&&Ui.onlineWaiter&&await Je.race([Ui.onlineWaiter,Tr(C&&C.maxRetryTimeout||Gi.maxRetryTimeout)]),U=Ui.networkState;const k=await Rl(g,{data:I,cancelToken:T,headers:{"Content-Type":"multipart/form-data;"}},!0);return s$(k,g)},()=>!1,k=>k.code!==H.OPERATION_ABORTED&&(k.code===H.UPDATE_TICKET_FAILED?k.data.retry:(D.warning("[".concat(v.clientId,"] update ticket network error, retry"),k),!0)),C)}(m,e,t,n)),allFailedhandler:m=>{throw m[0]},promisesCollector:s})};try{return r=await kE([l(!1),l(!0)]),s.length&&s.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),r}catch(h){throw h[0]}}function K3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function qP(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?K3(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K3(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class u$ extends ai{get isSuccess(){return!!this.configs}constructor(t,n){super(),V(this,"configs",void 0),V(this,"store",void 0),V(this,"joinInfo",void 0),V(this,"cancelToken",void 0),V(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),V(this,"interval",void 0),V(this,"mutex",void 0),V(this,"mutableParamsRead",!1),V(this,"configCache",{}),V(this,"limit_bitrate",void 0),this.mutex=new Wr("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),Y("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},Y("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,ft.reportApiInvoke(null,{options:void 0,name:Mi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Ei.TRACER}).onSuccess(JSON.stringify(yl))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void D.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await c$(this.joinInfo,this.cancelToken,this.retryConfig),D.debug("[config-distribute] get config distribute",JSON.stringify(t));const r=function(s){var l;const h=Pt(l=Object.keys(s).filter(g=>/^webrtc_ng_global_parameter/.test(g))).call(l);for(let g=0;g<h.length;g++)for(let v=h.length-1;v>g;v--){const T=h[v],C=s[T].value;if(typeof C.__priority=="number"){const I=C.__priority,U=h[v-1],k=s[U].value;if(typeof k.__priority=="number"){if(!(I>k.__priority))continue;{const M=T;h[v]=h[v-1],h[v-1]=M}}else{const M=T;h[v]=h[v-1],h[v-1]=M}}}const p=Date.now();let m={};return h.forEach(g=>{const v=s[g].value.__expires;v&&v<=p||(m[g]=s[g])}),m}(t);this.cacheGlobalParameterConfig(r),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=r}catch(r){const s=new ye(H.NETWORK_RESPONSE_ERROR,r);D.warning("[config-distribute] ".concat(s.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){s3(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(iT.UPDATE_BITRATE_LIMIT,t):this.emit(iT.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&qP({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},r=Object.keys(t),s=[];r.forEach(l=>{const h=t[l].value;n[l]=h;const p=h.__id;if(p&&this.configCache[l]&&this.configCache[l].__id===p)return;const m=h.__type,g=t[l].value,v=t[l].tag;let T=0;m?m===PV.REALTIME&&(T=1):Object.keys(g).some(C=>Object.prototype.hasOwnProperty.call($D,C)||!SP()&&Object.prototype.hasOwnProperty.call(Uw,C)?(T=1,!0):void 0),s.push({tag:v,isApplied:T,feature:l,params:JSON.stringify(h)})}),s.forEach(l=>{let{tag:h,feature:p,params:m,isApplied:g}=l;this.store.sessionId&&ft.abTest(this.store.sessionId,{intSucc:1,isApplied:g,tag:h,feature:p,params:m,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){D.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=function(s){const l={};return Object.keys(s).forEach(h=>{const p=s[h].value,m=p.__expires,g=p.__type;Object.keys(p).forEach(v=>{v==="__id"||v==="__type"||v==="__priority"||v==="__expires"||Object.prototype.hasOwnProperty.call(l,v)||(l[v]=qP(qP({value:p[v]},m&&{expires:m}),g&&{type:g}))})}),l}(t);try{var r;const s=(r=n.LIMIT_BITRATE)===null||r===void 0?void 0:r.value;delete n.LIMIT_BITRATE,s&&s3(s)&&this.handleBitrateLimit(s),this.limit_bitrate=s,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(p){try{const m=Date.now();Object.keys(p).forEach(g=>{const{value:v,type:T,expires:C}=p[g];C&&C<=m||((T===PV.REALTIME||Object.prototype.hasOwnProperty.call($D,g))&&(yl[g]=v,Zn[g]=v,D.debug("Update realtime parameters from config distribute",g,v)),T||SP()||!Object.prototype.hasOwnProperty.call(Uw,g)||(yl[g]=v,Zn[g]=v,D.debug("Update gateway parameters from config distribute",g,v)))})}catch(m){D.error("Error update config immediately: ".concat(p),m.message)}}(n);const l=JSON.stringify(n),h=window.btoa(l);window.localStorage.setItem("websdk_ng_global_parameter",h),D.debug("Caching global parameters ".concat(l))}catch(s){D.error("Error caching global parameters:",s.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach(r=>{if(r==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Zn,r)){const{value:s,expires:l}=t[r];if(l&&l<=n)return;(function(h,p){try{return typeof h=="object"&&typeof p=="object"&&JSON.stringify(h)===JSON.stringify(p)}catch{return!1}})(Zn[r],s)||(yl[r]=s,Zn[r]=s,this.emit(iT.UPDATE_CLIENT_ROLE_OPTIONS,s),D.debug("Updating client role options: ".concat(JSON.stringify(s))))}})}catch(n){D.error("Error handling global parameter config:",n.message)}}}class h$ extends ai{constructor(){super(...arguments),V(this,"resultStorage",new Map)}setLocalAudioStats(t,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(t,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r))}setRemoteAudioStats(t,n){const r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(t,n,r){if(Y("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const s=this.resultStorage.get(t);if(s&&(s.result.push(r),s.result.length>=5)){var l;const h=Ye(l=s.result).call(l,!0);s.isPrevNormal&&!h&&this.emit("exception",Y3[t],t,n),!s.isPrevNormal&&h&&this.emit("exception",Y3[t]+2e3,t+"_RECOVER",n),s.isPrevNormal=h,s.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof Xi&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=xa(n._encoderConfig.frameRate));const s=t.captureFrameRate;return!r||!s||!(r>10&&s<5||r<10&&r>=5&&s<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof Xi&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const Y3={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Yr=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function X3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function Pm(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?X3(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X3(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class hT{constructor(t){V(this,"store",void 0),V(this,"onStatsException",void 0),V(this,"onUploadPublishDuration",void 0),V(this,"onStatsChanged",void 0),V(this,"onVideoCodecChanged",void 0),V(this,"localStats",new Map),V(this,"remoteStats",new Map),V(this,"updateStatsInterval",void 0),V(this,"trafficStats",void 0),V(this,"trafficStatsPeerList",[]),V(this,"uplinkStats",void 0),V(this,"exceptionMonitor",void 0),V(this,"p2pChannel",void 0),V(this,"scalabilityMode",Mw.L1T1),V(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new h$,this.exceptionMonitor.on("exception",(n,r,s)=>{this.onStatsException&&this.onStatsException(n,r,s)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Le.LocalAudioTrack)||Pm({},iP)}getLocalVideoTrackStats(){return this.localStats.get(Le.LocalVideoTrack)||Pm({},rP)}getRemoteAudioTrackStats(t){const n=(l,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===l);return p&&(h.publishDuration=p.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},r={};if(t){var s;const l=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.audioStats;l&&(r[t]=n(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[h,{audioStats:p}]=l;p&&(r[h]=n(h,p))});return r}getRemoteNetworkQualityStats(t){const n={};if(t){var r;const s=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;s&&(n[t]=s)}else Array.from(this.remoteStats.entries()).forEach(s=>{let[l,{networkStats:h}]=s;h&&(n[l]=h)});return n}getRemoteVideoTrackStats(t){const n=(l,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===l);return p&&(h.publishDuration=p.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},r={};if(t){var s;const l=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.videoStats;l&&(r[t]=n(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[h,{videoStats:p}]=l;p&&(r[h]=n(h,p))});return r}getRTCStats(){let t=0,n=0,r=0,s=0;const l=this.localStats.get(Le.LocalAudioTrack);l&&(t+=l.sendBytes,n+=l.sendBitrate);const h=this.localStats.get(Le.LocalVideoTrack);h&&(t+=h.sendBytes,n+=h.sendBitrate);const p=this.localStats.get(Le.LocalVideoLowTrack);p&&(t+=p.sendBytes,n+=p.sendBitrate),this.remoteStats.forEach(g=>{let{audioStats:v,videoStats:T}=g;v&&(r+=v.receiveBytes,s+=v.receiveBitrate),T&&(r+=T.receiveBytes,s+=T.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:n,SendBytes:t,RecvBytes:r,RecvBitrate:s,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var r;const s=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),l=s!=null&&s.videoSSRC?Yr.measureFromSubscribeStart(this.store.clientId,s.videoSSRC):0,h=s!=null&&s.audioSSRC?Yr.measureFromSubscribeStart(this.store.clientId,s.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,l>h?l:h),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&D.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,r){if(!t)return!1;const s=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,l=!r||n.framesDecodeCount>r.framesDecodeCount;return s||!l}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[r,s]=n;switch(r){case Le.LocalVideoTrack:case Le.LocalVideoLowTrack:{const p=s,m=Pm({},rP),g=t.getStats(),v=t.getLocalMedia(r);if(g){const T=g.videoSend.find(C=>C.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(T){const C=t.getLocalVideoSize(),I=t.getEncoderConfig(Le.LocalVideoTrack);var l;(T.codec==="H264"||T.codec==="H265"||T.codec==="VP8"||T.codec==="VP9"||T.codec==="AV1X"||T.codec==="AV1")&&(m.codecType=T.codec,(p==null?void 0:p.codecType)!==T.codec&&((l=this.onVideoCodecChanged)===null||l===void 0||l.call(this,T.codec.toLocaleLowerCase()))),m.sendBytes=T.bytes,m.sendBitrate=p?8*Math.max(0,m.sendBytes-p.sendBytes):0,T.inputFrame?(m.captureFrameRate=T.inputFrame.frameRate,m.captureResolutionHeight=T.inputFrame.height,m.captureResolutionWidth=T.inputFrame.width):C&&(m.captureResolutionWidth=C.width,m.captureResolutionHeight=C.height),T.sentFrame?(m.sendFrameRate=T.sentFrame.frameRate,m.sendResolutionHeight=T.sentFrame.height,m.sendResolutionWidth=T.sentFrame.width):C&&(m.sendResolutionWidth=C.width,m.sendResolutionHeight=C.height),T.avgEncodeMs&&(m.encodeDelay=T.avgEncodeMs),I&&I.bitrateMax?m.targetSendBitrate=1e3*I.bitrateMax:T.targetBitrate&&(m.targetSendBitrate=T.targetBitrate),m.sendPackets=T.packets,m.sendPacketsLost=T.packetsLost,m.sendJitterMs=T.jitterMs,m.sendRttMs=T.rttMs,m.totalDuration=p?p.totalDuration+1:1,m.totalFreezeTime=p?p.totalFreezeTime:0,this.isLocalVideoFreeze(T)&&(m.totalFreezeTime+=1),T.scalabilityMode&&this.scalabilityMode!==T.scalabilityMode&&(D.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(T.scalabilityMode)),this.scalabilityMode=T.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var h;this.localStats.set(r,m),((p==null?void 0:p.sendResolutionWidth)!==m.sendResolutionWidth||(p==null?void 0:p.sendResolutionHeight)!==m.sendResolutionHeight)&&((h=this.onStatsChanged)===null||h===void 0||h.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&v&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,v.track,m);break}case Le.LocalAudioTrack:{const p=s,m=Pm({},iP),g=t.getStats(),v=t.getLocalMedia(r);if(g){const T=g.audioSend.find(C=>C.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(T){if(T.codec!=="opus"&&T.codec!=="aac"&&T.codec!=="PCMU"&&T.codec!=="PCMA"&&T.codec!=="G722"||(m.codecType=T.codec),T.inputLevel)m.sendVolumeLevel=Math.round(32767*T.inputLevel);else{const C=t.getLocalAudioVolume();C&&(m.sendVolumeLevel=Math.round(32767*C))}m.sendBytes=T.bytes,m.sendPackets=T.packets,m.sendPacketsLost=T.packetsLost,m.sendJitterMs=T.jitterMs,m.sendRttMs=T.rttMs,m.sendBitrate=p?8*Math.max(0,m.sendBytes-p.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Le.LocalAudioTrack,m),m&&v&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,v.track,m);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var r,s;let[l,{videoStats:h,audioStats:p,videoPcStats:m}]=n;const g=p,v=h,T=m,C=Pm({},HV),I=Pm({},zV),U=Pm({},XJ),{audioTrack:k,videoTrack:M,audioSSRC:F,videoSSRC:B}=t.getRemoteMedia(l);let ee;ee=this.store.useP2P?t.getStats(!0):t.getStats();const ue=(r=ee)===null||r===void 0?void 0:r.audioRecv.find(Ae=>Ae.ssrc===F),de=(s=ee)===null||s===void 0?void 0:s.videoRecv.find(Ae=>Ae.ssrc===B),ae=this.trafficStats&&this.trafficStats.peer_delay.find(Ae=>Ae.peer_uid===l);if(ue&&(ue.codec!=="opus"&&ue.codec!=="aac"&&ue.codec!=="PCMU"&&ue.codec!=="PCMA"&&ue.codec!=="G722"||(C.codecType=ue.codec),ue.outputLevel?C.receiveLevel=Math.round(32767*ue.outputLevel):k&&(C.receiveLevel=Math.round(32767*k.getVolumeLevel())),C.receiveBytes=ue.bytes,C.receivePackets=ue.packets,C.receivePacketsLost=ue.packetsLost,C.receivePacketsDiscarded=ue.packetsDiscarded,C.packetLossRate=C.receivePacketsLost/(C.receivePackets+C.receivePacketsLost),C.receiveBitrate=g?8*Math.max(0,C.receiveBytes-g.receiveBytes):0,C.totalDuration=g?g.totalDuration+1:1,C.totalFreezeTime=g?g.totalFreezeTime:0,C.freezeRate=C.totalFreezeTime/C.totalDuration,C.receiveDelay=ue.jitterBufferMs,C.totalDuration>10&&hT.isRemoteAudioFreeze(k)&&(C.totalFreezeTime+=1)),de){var Te;de.codec!=="H264"&&de.codec!=="H265"&&de.codec!=="VP8"&&de.codec!=="VP9"&&de.codec!=="AV1X"&&de.codec!=="AV1"||(I.codecType=de.codec),I.receiveBytes=de.bytes,I.receiveBitrate=v?8*Math.max(0,I.receiveBytes-v.receiveBytes):0,I.decodeFrameRate=de.decodeFrameRate<0?0:de.decodeFrameRate,I.renderFrameRate=de.decodeFrameRate<0?0:de.decodeFrameRate,de.outputFrame&&(I.renderFrameRate=de.outputFrame.frameRate),de.receivedFrame?(I.receiveFrameRate=de.receivedFrame.frameRate,I.receiveResolutionHeight=de.receivedFrame.height,I.receiveResolutionWidth=de.receivedFrame.width):M&&(I.receiveResolutionHeight=M._videoHeight||0,I.receiveResolutionWidth=M._videoWidth||0),de.framesRateFirefox!==void 0&&(I.receiveFrameRate=Math.round(de.framesRateFirefox)),I.receivePackets=de.packets,I.receivePacketsLost=de.packetsLost,I.packetLossRate=I.receivePacketsLost/(I.receivePackets+I.receivePacketsLost);const Ae=v?v.totalFreezeTime:0,We=v?v.totalDuration:0;I.totalDuration=v?v.totalDuration+1:1,I.totalFreezeTime=(Te=de.totalFreezesDuration)!==null&&Te!==void 0?Te:Ae||0,I.receiveDelay=de.jitterBufferMs||0;const tt=!!B&&t.getRemoteVideoIsReady(B);de.totalFreezesDuration===void 0&&M&&tt&&hT.isRemoteVideoFreeze(M,de,T)&&(I.totalFreezeTime+=1),I.freezeRate=Math.max(0,Math.min((I.totalFreezeTime-Ae)/(I.totalDuration-We),1))}ae&&(C.end2EndDelay=ae.B_ad,I.end2EndDelay=ae.B_vd,C.transportDelay=ae.B_ed,I.transportDelay=ae.B_ed,C.currentPacketLossRate=ae.B_ealr4/100,I.currentPacketLossRate=ae.B_evlr4/100,U.uplinkNetworkQuality=ae.B_punq?ae.B_punq:0,U.downlinkNetworkQuality=ae.B_pdnq?ae.B_pdnq:0),this.remoteStats.set(l,{audioStats:C,videoStats:I,videoPcStats:de,networkStats:U}),k&&this.exceptionMonitor.setRemoteAudioStats(k,C),M&&this.exceptionMonitor.setRemoteVideoStats(M,I)})}}class J3{constructor(){V(this,"destChannelMediaInfos",new Map),V(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){i3(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){i3(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){tA(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function Q3(e){if(!(e instanceof J3))return new ye(H.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new ye(H.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new ye(H.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class yp{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){V(this,"uid",void 0),V(this,"_uintid",void 0),V(this,"_trust_in_room_",!0),V(this,"_trust_audio_enabled_state_",!0),V(this,"_trust_video_enabled_state_",!0),V(this,"_trust_audio_mute_state_",!0),V(this,"_trust_video_mute_state_",!0),V(this,"_audio_muted_",!1),V(this,"_video_muted_",!1),V(this,"_audio_enabled_",!0),V(this,"_video_enabled_",!0),V(this,"_audio_added_",!1),V(this,"_video_added_",!1),V(this,"_is_pre_created",!1),V(this,"_video_pre_subscribed",!1),V(this,"_audio_pre_subscribed",!1),V(this,"_trust_video_stream_added_state_",!0),V(this,"_trust_audio_stream_added_state_",!0),V(this,"_audioTrack",void 0),V(this,"_videoTrack",void 0),V(this,"_dataChannels",[]),V(this,"_audioSSRC",void 0),V(this,"_videoSSRC",void 0),V(this,"_audioOrtc",void 0),V(this,"_videoOrtc",void 0),V(this,"_cname",void 0),V(this,"_rtxSsrcId",void 0),V(this,"_videoMid",void 0),V(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function $3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function Z3(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$3(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$3(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const pT="9",e4=4e4;function t4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function zu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?t4(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t4(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var xE=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(xE||{});const mA=new Map;function n4(e,t,n,r){let{scale:s}=e;if(s===0&&r===xE.UP||s>=t.length-1&&r===xE.DOWN)return e;let l=zu(zu({},e),{},{scale:r===xE.DOWN?++s:--s});switch(n){case"maintain-framerate":l=zu(zu({},l),t[s].motion);break;case"maintain-resolution":l=zu(zu({},l),t[s].detail);break;case"balanced":l=zu(zu({},l),t[s].balanced)}return l}function i4(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:r4(t)};mA.set(e,n)}else mA.delete(e)}function r4(e){const t=zu({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:s,bitrateMin:l}=t,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:p,MAX_SCALE:m,BITRATE_MIN_THRESHOLD:g,BITRATE_MAX_THRESHOLD:v,BWE_SCALE_UP_THRESHOLD:T,BWE_SCALE_DOWN_THRESHOLD:C,PERF_SCALE_DOWN_THRESHOLD:I,PERF_SCALE_UP_THRESHOLD:U,BALANCE_BITRATE_FACTOR:k,BALANCE_FRAMERATE_FACTOR:M,BALANCE_RESOLUTION_FACTOR:F,MOTION_RESOLUTION_FACTOR:B,MOTION_BITRATE_FACTOR:ee,DETAIL_FRAMERATE_FACTOR:ue,DETAIL_BITRATE_FACTOR:de}=JD,ae=Math.min(t.frameRate,p),Te=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(C,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(I,1)*ae),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:l},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:l},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:l}}];for(let Ae=1;Ae<=m;Ae++){const We={bwe_up:Math.round(Math.pow(T,Ae)*n),bwe_down:Math.round(Math.pow(C,Ae+1)*n),fps_up:Math.round(Math.pow(U,Ae)*ae),fps_down:Math.round(Math.pow(I,Ae+1)*ae)},tt={scaleResolutionDownBy:s/Math.pow(F,Ae),frameRate:Math.max(Math.round(Math.pow(M,Ae)*r),h),bitrateMax:Math.max(Math.round(Math.pow(k,Ae)*n),v),bitrateMin:Math.max(Math.round(Math.pow(k,Ae)*l),g)},Ft={scaleResolutionDownBy:s/Math.pow(B,Ae),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(ee,Ae)*n),v),bitrateMin:Math.max(Math.round(Math.pow(ee,Ae)*l),g)},xt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ue,Ae)*r),h),bitrateMax:Math.max(Math.round(Math.pow(de,Ae)*n),v),bitrateMin:Math.max(Math.round(Math.pow(de,Ae)*l),g)};Te.push({scale:Ae,threshold:We,balanced:tt,motion:Ft,detail:xt})}return Te}function p$(e,t,n,r,s,l){const h=mA.get(e)||{overUse:0,underUse:0,adaptationList:r4(s)},{adaptationList:p}=h;mA.set(e,h);const{OVERUSE_TIMES_THRESHOLD:m,UNDERUSE_TIMES_THRESHOLD:g}=JD,{scale:v}=r;let T,C;return typeof t=="number"&&t>0&&function(I,U,k,M){if(U>=k.length)return!1;let{threshold:{fps_down:F}}=k[U];return Y("FORCE_AG_HIGH_FRAMERATE")&&M==="maintain-framerate"&&(F=k[0].threshold.fps_down),I<F}(t,v,p,l)&&(h.overUse++,C=JS.CPU,h.overUse>m)||typeof n=="number"&&n>0&&function(I,U,k){if(U>=k.length)return!1;const{threshold:{bwe_down:M}}=k[U];return I<M}(n,v,p)&&(h.overUse++,C=JS.BANDWIDTH,h.overUse>m)?(h.overUse=0,h.underUse=0,T=n4(r,p,l,xE.DOWN),[T,C]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(I,U,k,M){if(U===0)return;let{threshold:{fps_up:F}}=k[U];return Y("FORCE_AG_HIGH_FRAMERATE")&&M==="maintain-framerate"&&(F=k[1].threshold.fps_up),I>F}(t,v,p,l)&&function(I,U,k){if(U===0)return;const{threshold:{bwe_up:M}}=k[U];return I>M}(n,v,p)&&(h.underUse++,h.underUse>g&&(h.overUse=0,h.underUse=0,T=n4(r,p,l,xE.UP),T.scale===0&&(C=JS.NONE))),[T,C])}function s4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function KP(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?s4(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s4(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function f$(e){var t;return!!Y("ENABLE_AG_ADAPTATION")&&!!(e instanceof pP||Ye(t=e._hints).call(t,Dn.CUSTOM_TRACK))&&(!!Y("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const r=on();if(r.os!==ir.IOS||!r.osVersion)return!1;const s=r.osVersion.split(".");return Number(s[0])>=n}(14)&&eV(17,4)||Zj(14)&&tV(17,4,!0)))}const _A=new Map;function gA(e,t){const n=_A.get(e);if(n){const{timer:r}=n;window.clearTimeout(r),_A.delete(e)}t.qualityLimitationReason=JS.NONE,i4(e)}function m$(e,t){var n;let r;switch(t){case Le.LocalAudioTrack:r=Sn.Audio;break;case Le.LocalVideoTrack:r=Ye(n=e._hints).call(n,Dn.SCREEN_TRACK)?Sn.Screen:Sn.High;break;case Le.LocalVideoLowTrack:r=Sn.Low}return r}function YP(e){const t=cn();if(e.some(n=>n._bypassWebAudio))throw new Re(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new Re(H.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function XP(e,t){YP(e);const n=new Xi;return e.forEach(r=>n.addAudioTrack(r)),n}const _$=!cn().supportUnifiedPlan||Y("CHROME_FORCE_PLAN_B")&&Mu();function EA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return _$?(n={spec:t,store:e},Hu("PlanBConnection").create(n)):new Id(t,e)}function JP(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function a4(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(KS(e.turnServer.servers))return!1;if(Y("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var tn;function o4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function bl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?o4(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o4(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Id=(tn=class Ym extends o3{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Ye(n=Object.keys(jw)).call(n,t)}))]}constructor(t,n){super(t,n),V(this,"id",Bn(5,"connection-")),V(this,"store",void 0),V(this,"peerConnection",void 0),V(this,"forceTurn",!1),V(this,"remoteSDP",void 0),V(this,"initialOffer",void 0),V(this,"transportEventReceiver",void 0),V(this,"statsFilter",void 0),V(this,"extension",{useXR:Y("USE_XR")}),V(this,"localCapabilities",void 0),V(this,"remoteCodecs",void 0),V(this,"localCandidateCount",0),V(this,"allCandidatesReceived",!1),V(this,"isPreallocation",!1),V(this,"preSSRCMap",new Map),V(this,"dataStreamChannelMap",new Map),V(this,"establishPromise",void 0),V(this,"recoveredDataChannelIds",[]),V(this,"currentDataChannelId",1),V(this,"supportAV1RtpSpec",!1),V(this,"mutex",void 0),V(this,"qualityLimitationReason",JS.NONE),V(this,"isFirstConnected",!1),this.store=n,this.forceTurn=a4(t),this.mutex=new Wr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Ym.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=KD(this.peerConnection,Y("STATS_UPDATE_INTERVAL"),void 0,_i()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t){const n=this.preSSRCMap.get(t);if(n!==void 0){const r=this.peerConnection.getTransceivers().find(s=>s.mid===n);if(r)return{transceiver:r,track:r.receiver.track,id:n}}}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void D.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const r=await this.peerConnection.createOffer(),s=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const l=this.remoteSDP.toString();s==null||s(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else D.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=gp(r.sdp),l=await w3({filterRTX:!Y("USE_PUB_RTX")&&!Y("USE_SUB_RTX"),filterVideoFec:Y("FILTER_VIDEO_FEC"),filterAudioFec:Y("FILTER_AUDIO_FEC"),filterVideoCodec:Y("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=dA(l),this.initialOffer=r,Y("ENABLE_SVC")&&this.store.codec=="av1"){const p=await async function(){try{const m=new RTCPeerConnection;m.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Mw.L1T3}]});const g=await m.createOffer();if(!g.sdp)return void m.close();const v=ca(g.sdp).mediaDescriptions[0];if(!v)return;const T=v.attributes.extmaps.find(C=>C.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return m.close(),T}catch{return}}();var t;p&&(this.supportAV1RtpSpec=!0,(t=l.send)===null||t===void 0||t.videoExtensions.push(p))}let h;return r.sdp&&O3(r.sdp)&&(h=oi(l),(n=h).send&&(OE(it.VIDEO,n.send.videoExtensions),OE(it.AUDIO,n.send.audioExtensions)),n.recv&&(OE(it.VIDEO,n.recv.videoExtensions),OE(it.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(OE(it.VIDEO,n.sendrecv.videoExtensions),OE(it.AUDIO,n.sendrecv.audioExtensions))),bl(bl({},s),{},{rtpCapabilities:h||l,offerSDP:r.sdp})}catch(r){throw new Re(H.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}var n}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&O3(this.initialOffer.sdp)&&(n=t.rtpCapabilities,r=this.localCapabilities,n.send&&(oA(it.VIDEO,n.send.videoExtensions,r.send.videoExtensions),oA(it.AUDIO,n.send.audioExtensions,r.send.audioExtensions)),n.recv&&(oA(it.VIDEO,n.recv.videoExtensions,r.recv.videoExtensions),oA(it.AUDIO,n.recv.audioExtensions,r.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return oi(this._localCapabilities)}get rtpCapabilities(){return oi(this._rtpCapabilities)}get candidates(){return oi(this._candidates)}get iceParameters(){return oi(this._iceParameters)}get dtlsParameters(){return oi(this._dtlsParameters)}constructor(g){let v=arguments.length>1&&arguments[1]!==void 0&&arguments[1];V(this,"sessionDesc",void 0),V(this,"_localCapabilities",void 0),V(this,"_rtpCapabilities",void 0),V(this,"_candidates",void 0),V(this,"_originCandidates",void 0),V(this,"_iceParameters",void 0),V(this,"_isUseExtmapAllowMixed",void 0),V(this,"_dtlsParameters",void 0),V(this,"setup",void 0),V(this,"currentMidIndex",void 0),V(this,"cname",void 0),V(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=v,g=oi(g);const{iceParameters:T,dtlsParameters:C,candidates:I,rtpCapabilities:U,setup:k,localCapabilities:M,cname:F}=g;this._rtpCapabilities=U,this._candidates=I,this._originCandidates=oi(I),this._iceParameters=T,this._dtlsParameters=C,this._localCapabilities=M,this.setup=k,this.cname=F,this.sessionDesc=this.updateRemoteRTPCapabilities(U),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(g){const v=this.candidates,T=this.dtlsParameters,C=this.iceParameters,I=this.rtpCapabilities.send;let U=this.sessionDesc.mediaDescriptions.length-1;for(let k=1;k<g;k++){const M=2*k+2e4,F=2*k+e4,{ssrcs:B,ssrcGroups:ee}=Dm([{ssrcId:M}],this.cname),{ssrcs:ue,ssrcGroups:de}=Dm([{ssrcId:F,rtx:Y("USE_SUB_RTX")?F+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:pT,protos:["UDP","TLS","RTP","SAVPF"],fmts:I.videoCodecs.map(ae=>ae.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:C.iceUfrag,icePwd:C.icePwd,unrecognized:[],candidates:v,extmaps:I.videoExtensions,fingerprints:T.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ue,ssrcGroups:de,rtcpFeedbackWildcards:[],payloads:I.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++U)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:pT,protos:["UDP","TLS","RTP","SAVPF"],fmts:I.audioCodecs.map(ae=>ae.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:C.iceUfrag,icePwd:C.icePwd,unrecognized:[],candidates:v,extmaps:I.audioExtensions,fingerprints:T.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:B,ssrcGroups:ee,rtcpFeedbackWildcards:[],payloads:I.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++U)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return hp(this.sessionDesc)}send(g,v,T,C){const{ssrcs:I,ssrcGroups:U}=Dm(v,this.cname,Y("SYNC_GROUP")?T:void 0),k=this.findPreloadMediaDesc(I);if(k){if(_i()&&this.firefoxSsrcMidMap.set(I[0].ssrcId,k.attributes.mid),C&&(C.twcc||C.remb)){const M=this.sessionDesc.mediaDescriptions.indexOf(k);return this.sessionDesc.mediaDescriptions[M]=this.mungSendMediaDesc(k,C),{mid:k.attributes.mid,needExchangeSDP:!0}}return{mid:k.attributes.mid,needExchangeSDP:!1}}{const M=this.findAvailableMediaIndex(g,I);let F;return M===-1||M===1&&(Dr()||function(){const B=on();return!(B.name!==mn.CHROME||!B.osVersion)&&Number(B.version)<=90}()||Y("ENABLE_ENCODED_TRANSFORM")&&xu())||M===0&&Y("USE_SUB_RTX")||nV()?(F=this.createOrRecycleSendMedia(g,I,U,"sendonly",C),this.updateBundleMids()):(F=oi(this.sessionDesc.mediaDescriptions[M]),F.attributes.direction="sendonly",F.attributes.ssrcs=I,F.attributes.ssrcGroups=U,this.sessionDesc.mediaDescriptions[M]=this.mungSendMediaDesc(F,C)),_i()&&this.firefoxSsrcMidMap.set(I[0].ssrcId,F.attributes.mid),{mid:F.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:g,needExchangeSDP:v}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:g.attributes.mid,needExchangeSDP:v}}batchSend(g){const v=g.map(I=>{let{kind:U,ssrcMsg:k,mslabel:M}=I;return this.send(U,k,M)}),T=[];let C=!1;return v.forEach(I=>{let{mid:U,needExchangeSDP:k}=I;k&&(C=!0),T.push(U)}),{mids:T,needExchangeSDP:C}}stopSending(g){const v=this.sessionDesc.mediaDescriptions.filter(T=>T.attributes.mid&&g.indexOf(T.attributes.mid)!==-1);if(v.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");v.forEach(T=>{T.attributes.mid==="0"||_i()||nV()?T.attributes.ssrcs=[]:(T.attributes.ssrcs=[],T.attributes.direction="inactive",T.media.port="0")}),this.updateBundleMids()}mute(g){const v=this.sessionDesc.mediaDescriptions.find(T=>T.attributes.mid===g);if(!v)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.mute."));v.attributes.direction="inactive"}unmute(g){const v=this.sessionDesc.mediaDescriptions.find(T=>T.attributes.mid===g);if(!v)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.unmute."));v.attributes.direction="sendonly"}muteRemote(g){const v=this.sessionDesc.mediaDescriptions.filter(T=>Ye(g).call(g,T.attributes.mid||""));if(v.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");v.forEach(T=>{T.attributes.direction="inactive"})}unmuteRemote(g){const v=this.sessionDesc.mediaDescriptions.filter(T=>Ye(g).call(g,T.attributes.mid||""));if(v.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");v.forEach(T=>{T.attributes.direction="recvonly"})}receive(g,v,T,C){g.forEach((I,U)=>{this.createOrRecycleRecvMedia(I,[],"recvonly",v,T,C[U])}),this.updateBundleMids()}stopReceiving(g){const v=this.sessionDesc.mediaDescriptions.filter(T=>g.indexOf(T.attributes.mid)!==-1);if(v.length!==g.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");v.forEach(T=>{T.media.port="0",T.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(g){const v=this.sessionDesc||ca((T=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(T?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var T;this._rtpCapabilities=g;const C=this.rtpCapabilities.send,I=this.localCapabilities.send;for(const U of v.mediaDescriptions){if(U.attributes.iceUfrag=this._iceParameters.iceUfrag,U.attributes.icePwd=this._iceParameters.icePwd,U.attributes.fingerprints=this._dtlsParameters.fingerprints,U.attributes.candidates=this._candidates,U.attributes.setup=this.setup,U.media.mediaType==="application"&&(U.attributes.sctpPort="5000"),U.media.mediaType==="video"){if(C.videoCodecs.length===0){const k=I.videoCodecs.filter(M=>{var F,B;return(F=M.rtpMap)===null||F===void 0?void 0:Ye(B=F.encodingName.toLowerCase()).call(B,"vp8")})||[I.videoCodecs[0]];U.media.fmts=k.map(M=>M.payloadType.toString(10)),U.attributes.payloads=k,U.attributes.extmaps=[]}else if(U.media.fmts=C.videoCodecs.map(k=>k.payloadType.toString(10)),U.attributes.payloads=C.videoCodecs,U.attributes.extmaps=C.videoExtensions,Y("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:k,ssrcGroups:M}=Dm([{ssrcId:e4,rtx:Y("USE_SUB_RTX")?40001:void 0}],this.cname);U.attributes.ssrcs=k,U.attributes.ssrcGroups=M}}if(U.media.mediaType==="audio"){if(C.audioCodecs.length===0){const k=I.audioCodecs.filter(M=>{var F,B;return(F=M.rtpMap)===null||F===void 0?void 0:Ye(B=F.encodingName.toLowerCase()).call(B,"opus")})||[I.audioCodecs[0]];U.media.fmts=k.map(M=>M.payloadType.toString(10)),U.attributes.payloads=k,U.attributes.extmaps=[]}else if(U.media.fmts=C.audioCodecs.map(k=>k.payloadType.toString(10)),U.attributes.payloads=C.audioCodecs,U.attributes.extmaps=C.audioExtensions,PE(U),Y("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:k,ssrcGroups:M}=Dm([{ssrcId:2e4}],this.cname);U.attributes.ssrcs=k,U.attributes.ssrcGroups=M}}}return this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(g){const v=this._originCandidates.filter(C=>C.transport==="udp"),T=[];if(v.forEach(C=>{T.push(Z3(Z3({},C),{},{foundation:"tcpcandidate",priority:Number(C.priority)-1+"",transport:"tcp",port:Number(C.port)+90+""}))}),v.length!==0){switch(g){case Kr.TCP_RELAY:this._candidates=T;break;case Kr.UDP_TCP_RELAY:case Kr.RELAY:this._candidates=[...v,...T];break;default:this._candidates=v}for(const C of this.sessionDesc.mediaDescriptions)C.attributes.candidates=this.candidates}}restartICE(g){g=oi(g),this._iceParameters=g,this.sessionDesc.mediaDescriptions.forEach(v=>{v.attributes.iceUfrag=g.iceUfrag,v.attributes.icePwd=g.icePwd})}predictReceivingMids(g){const v=[];for(let T=0;T<g;T++)v.push((this.currentMidIndex+T+1).toString(10));return v}findAvailableMediaIndex(g,v){return this.sessionDesc.mediaDescriptions.findIndex(T=>{const C=T.media.mediaType===g&&T.media.port!=="0"&&(T.attributes.direction==="sendonly"||T.attributes.direction==="sendrecv")&&T.attributes.ssrcs.length===0;if(_i()){if(C){const I=this.firefoxSsrcMidMap.get(v[0].ssrcId);return!(I||T.attributes.mid!=="0"&&T.attributes.mid!=="1")||!(!I||I!==T.attributes.mid)}return!1}return C})}createOrRecycleDataChannel(){for(const T of this.sessionDesc.mediaDescriptions)if(T.media.mediaType==="application")return{mediaDesc:T,needExchangeSDP:!1};this.currentMidIndex+=1;const g="".concat(this.currentMidIndex),v={media:{mediaType:"application",port:pT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(g),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(v),{mediaDesc:v,needExchangeSDP:!0}}createOrRecycleRecvMedia(g,v,T,C,I,U){const k=g._mediaStreamTrack.kind,M=this.rtpCapabilities.recv,F=cT(k,M,this.localCapabilities.send,k===it.VIDEO?C:I),B=k===it.VIDEO?M.videoExtensions:M.audioExtensions;this.currentMidIndex+=1;const ee="".concat(this.currentMidIndex);let ue={media:{mediaType:k,port:pT,protos:["UDP","TLS","RTP","SAVPF"],fmts:F.map(ae=>ae.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:B,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:v,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:F,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:T,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ee)}};ue=this.mungRecvMediaDsec(ue,g,U);const de=this.findFirstClosedMedia(k);if(de){const ae=this.sessionDesc.mediaDescriptions.indexOf(de);this.sessionDesc.mediaDescriptions[ae]=ue}else this.sessionDesc.mediaDescriptions.push(ue);return ue}updateRemoteCodec(g,v,T){const C=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(ue=>ue.rtpMap&&ue.rtpMap.encodingName.toLowerCase()||"").filter(ue=>{var de;return Ye(de=Object.keys(jw)).call(de,ue)}))],I=new Set(v);if(C.every(ue=>I.has(ue)))return D.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(v)),!1;const U=this._rtpCapabilities.recv.videoCodecs.filter(ue=>v.some(de=>{var ae;return Ye(ae=ue.rtpMap&&ue.rtpMap.encodingName.toLowerCase()||"").call(ae,de)}));if(U.length===0)return D.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(C," codecs: ").concat(v)),!1;const k=[...new Set(U.map(ue=>ue.rtpMap&&ue.rtpMap.encodingName.toLowerCase()||""))];let M;if(D.debug("updateRemoteCodec, from ".concat(C," to ").concat(k)),g.length===0)M=this.sessionDesc.mediaDescriptions.filter(ue=>ue.media.mediaType==="video"&&ue.attributes.direction==="recvonly");else if(M=this.sessionDesc.mediaDescriptions.filter(ue=>ue.attributes.mid&&Ye(g).call(g,ue.attributes.mid)&&ue.attributes.direction==="recvonly"),M.length!==g.length)return D.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(g,", codecs: ").concat(v)),!1;if(Y("USE_PUB_RTX")||Y("USE_SUB_RTX")){const ue=MP(U,this.rtpCapabilities.recv.videoCodecs);U.push(...ue)}this._rtpCapabilities.recv.videoCodecs=U;const F=this.localCapabilities.send,B=this.rtpCapabilities.recv,ee=cT(it.VIDEO,B,F,T);return M.forEach(ue=>{const de=ee.map(ae=>ae.payloadType.toString(10));D.debug("updateRemoteCodec mid: ".concat(ue.attributes.mid,", from"),ue.attributes.payloads,"to",ee),ue.attributes.payloads=ee,ue.media.fmts=de}),!0}createOrRecycleSendMedia(g,v,T,C,I){const U=this.rtpCapabilities.send,k=g===it.VIDEO?U.videoCodecs:U.audioCodecs,M=g===it.VIDEO?U.videoExtensions:U.audioExtensions;this.currentMidIndex+=1;const F="".concat(this.currentMidIndex);let B={media:{mediaType:g,port:pT,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.map(ue=>ue.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:M,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:v,ssrcGroups:T,rtcpFeedbackWildcards:[],payloads:k,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:C,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(F)}};B=this.mungSendMediaDesc(B,I);const ee=this.findFirstClosedMedia(g);if(ee){const ue=this.sessionDesc.mediaDescriptions.indexOf(ee);this.sessionDesc.mediaDescriptions[ue]=B}else this.sessionDesc.mediaDescriptions.push(B);return B}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(g=>g.media.port!=="0").map(g=>g.attributes.mid)}mungRecvMediaDsec(g,v,T){const C=oi(g);return kP(C),DE(C,v),xP(C,v),b3(C),lA(C,T,this.localCapabilities.send),C}mungSendMediaDesc(g,v){const T=oi(g);return lA(T,v,this.localCapabilities.recv),PE(T),T}updateRecvMedia(g,v){const T=this.sessionDesc.mediaDescriptions.findIndex(C=>C.attributes.mid===g);if(T!==-1){const C=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[T],v);this.sessionDesc.mediaDescriptions[T]=C}}bumpMid(g){this.currentMidIndex+=g}findFirstClosedMedia(g){return this.sessionDesc.mediaDescriptions.find(v=>_i()?v.media.port==="0"&&v.media.mediaType===g:v.media.port==="0")}findPreloadMediaDesc(g){return this.sessionDesc.mediaDescriptions.find(v=>{var T;return((T=v.attributes)===null||T===void 0||(T=T.ssrcs[0])===null||T===void 0?void 0:T.ssrcId)===g[0].ssrcId})}getSSRC(g){var v;return(v=this.sessionDesc.mediaDescriptions.find(T=>T.attributes.mid===g))===null||v===void 0?void 0:v.attributes.ssrcs}}(bl(bl({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString(),l=I3(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(l||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:l}),h==null||h(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s});const p=this.peerConnection.getTransceivers()[0];if(p!=null&&p.receiver&&this.tryBindTransportEvents(p.receiver),Y("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(Y("PRELOAD_MEDIA_COUNT"));const g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const v=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(v)}const{preSSRCs:m}=t;if(Array.isArray(m)&&m.length>0){const{mids:g}=this.remoteSDP.batchSend(m.map(v=>({kind:v.kind,ssrcMsg:[{ssrcId:v.ssrcId,rtx:v.rtx}],mslabel:v.mslabel})));g.forEach((v,T)=>{this.preSSRCMap.set(m[T].ssrcId,v)}),await lT(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(s){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}var n,r}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=t;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:r}=t;if(Array.isArray(r)&&r.length>0){const{mids:s}=this.remoteSDP.batchSend(r.map(l=>Object.assign({},{kind:l.kind,ssrcMsg:[{ssrcId:l.ssrcId,rtx:l.rtx}],mslabel:l.mslabel})));s.forEach((l,h)=>{this.preSSRCMap.set(r[h].ssrcId,l)})}await lT(this.peerConnection,this.remoteSDP,this.extension),D.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,r){var s=this;return Po(function*(){const l=yield an(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],p=aA();t.forEach(M=>{const F=s.peerConnection.addTransceiver(M._mediaStreamTrack,bl({direction:"sendonly"},M.trackMediaType==="video"&&s.supportAV1RtpSpec&&p?{sendEncodings:[{scalabilityMode:p}]}:{}));h.push(F),M._updateRtpTransceiver(F)}),_i()&&Y("SIMULCAST")===!0&&(yield an(s.applySimulcastForFirefox(h,t)));const m=yield an(s.peerConnection.createOffer()),g=s.remoteSDP.predictReceivingMids(t.length),v=s.mungSendOfferSDP(m.sdp,t,g),T=ca(v),C=g.map(M=>{const F=T.mediaDescriptions.find(B=>B.attributes.mid===M);if(!F)throw new Error("Cannot extract ssrc from mediaDescription.");return S3(F,Y("USE_PUB_RTX"))});let I;try{I=yield C}catch(M){I=[],s.remoteSDP.receive(t,n,r,I);const F=s.remoteSDP.toString();throw yield an(s.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield an(s.peerConnection.setRemoteDescription({type:"answer",sdp:F})),yield an(s.stopSending(g,!0)),M}s.remoteSDP.receive(t,n,r,I);const U=s.remoteSDP.toString(),k=s.logSDPExchange(v,"offer","local","send");return yield an(s.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield an(s.applySimulcastEncodings(h,t)),yield an(s.applySendEncodings(h,t)),k==null||k(U),yield an(s.peerConnection.setRemoteDescription({type:"answer",sdp:U})),h.map((M,F)=>{const B=g[F];return{localSSRC:C[F],id:B,transceiver:M}})}catch(h){throw h instanceof Re?h:new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{l()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")D.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const l=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof l!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:l,negotiated:!0,ordered:!1,maxRetransmits:Y("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}n.forEach(l=>{l._updateOriginDataChannel(r)});const{needExchangeSDP:s}=this.remoteSDP.sendDataChannel();if(s){const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),D.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else D.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof Re?r:new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof Re?n:new Re(H.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(m=>{var g;gA(this.id+m.mid,this),m.direction="inactive",(g=m.stop)===null||g===void 0||g.call(m)});const l=await this.peerConnection.createOffer(),h=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const p=this.remoteSDP.toString();h==null||h(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(s){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{r&&r()}}async receive(t,n,r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:h}=this.remoteSDP.send(t,n,r,s);h&&(await lT(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const p=this.peerConnection.getTransceivers().find(m=>m.mid===l);if(!p)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,id:l,transceiver:p}}catch(l){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await lT(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(s=>{const l=this.peerConnection.getTransceivers().find(h=>h.mid===s);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:s,transceiver:l}})}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(l=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[p,m]=h;if(m===l)return this.preSSRCMap.delete(p),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();r==null||r(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();r==null||r(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();r==null||r(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(h=>{h.direction="inactive"});const r=await this.peerConnection.createOffer(),s=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();s==null||s(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(h,p)=>{h.direction="sendonly"});const r=await this.peerConnection.createOffer(),s=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString();s==null||s(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Po(function*(){const r=yield an(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const s=cn().supportPCSetConfiguration,l=Y("FORCE_TURN_TCP")||n.forceTurn;if(t===Kr.RELAY&&!s)return;if(s&&!l){const T=t===Kr.RELAY?"relay":"all",C=n.peerConnection.getConfiguration();C.iceTransportPolicy!==T&&(D.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(C.iceTransportPolicy,"] to [").concat(T,"]")),C.iceTransportPolicy=T,n.peerConnection.setConfiguration(C))}n.remoteSDP.updateCandidates(t);const h=yield an(n.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const p=gp(h.sdp),{remoteIceParameters:m}=yield p.iceParameters;n.remoteSDP.restartICE(m);const g=n.remoteSDP.toString(),v=n.logSDPExchange(h.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield an(n.peerConnection.setLocalDescription(h)),v==null||v(g),yield an(n.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(s){D.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),s)}finally{r()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Kr.TCP_RELAY),await lT(this.peerConnection,this.remoteSDP,this.extension)}catch(n){D.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{gA(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return bl(bl({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const l=this.remoteSDP.toString(),h=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),h==null||h(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new Re(H.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(s=>s.mid===t);r.length===1&&(this.isVP8Simulcast(n)?_i()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(s=>s.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:s}=n.getSelectedCandidatePair();return{local:bl(bl({},Sd),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:bl(bl({},Sd),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),s=t.port?"local: ".concat(t.port):"";D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(t.url||"",", host_candidate:").concat(s)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Y("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(KS(t.turnServer.servers)?n.iceServers=t.turnServer.servers:Y("NEW_TURN_MODE")&&n.iceServers?(Y("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...Ym.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...Ym.newTurnServerConfigToIceServers(t.turnServer.servers)),Y("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Ym.turnServerConfigToIceServers(t.turnServer.servers)),Y("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Ym.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),Y("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),Y("ENABLE_ENCODED_TRANSFORM")&&cn().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(mp(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!Y("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{const s=Y("NEW_TURN_MODE");s===1?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):s===2?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):s===3?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(mp(r.turnServerURL),":443?transport=tcp")}):s===4&&(n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(mp(r.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var s;n!=null&&n.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,n.state))},n.onerror=s=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in s?s.error:s)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const s=n==null?void 0:n.iceTransport.state;var l;s&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,s))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:s,remote:l}=r.getSelectedCandidatePair();D.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r,s;if(n||(n=this.peerConnection.getSenders().find(M=>M.track===t._mediaStreamTrack)),!n)return D.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return D.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!cn().supportSetRtpSenderParameters)return D.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},h={};switch(t._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}const p=function(k,M){return k.getTransceivers().find(F=>F.sender.track===M||F.receiver.track===M)}(this.peerConnection,t._mediaStreamTrack),m=eQ(t);if(f$(t)&&p&&n&&m&&this.getLocalVideoStats&&Ye(r=["vp8","vp9"]).call(r,this.store.codec)){var g;const k=l.degradationPreference||(Ye(g=t._hints).call(g,Dn.CUSTOM_TRACK)?Y("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(M,F,B,ee,ue,de){if(gA(M,B),ue(F),ee!=="balanced"&&ee!=="maintain-framerate"&&ee!=="maintain-resolution")return;let ae=-1;i4(M,F);const Te=window.setInterval(()=>{const We=_A.get(M);if(!Y("ENABLE_AG_ADAPTATION")||!We)return gA(M,B),void ue(F);const tt=de();if(tt.sendPackets>0&&tt.OutgoingAvailableBandwidth>0){if(ae===-1)return void(ae=Date.now());if(Date.now()-ae<1e3)return;const Ft=tt.sendFrameRate,xt=tt.OutgoingAvailableBandwidth,[wt,qn]=p$(M,Ft,xt,We.adaptationConfig,F,ee);qn&&(B.qualityLimitationReason=qn),wt&&We.adaptationConfig.scale!==wt.scale&&(D.debug("[".concat(M,"] applyAdaptation: ").concat(B.qualityLimitationReason,`
           sendFps `).concat(Ft,", bwe ").concat(xt,", switch from ").concat(We.adaptationConfig.scale," to ").concat(wt.scale," ")),We.adaptationConfig=KP(KP({},We.adaptationConfig),wt),ue(wt))}},Y("CHECK_LOCAL_STATS_INTERVAL")),Ae=KP({},F);_A.set(M,{timer:Te,adaptationConfig:Ae,originConfig:F,adaptationFunc:ue}),D.debug("[".concat(M,"] start adaptation, originConfig: ").concat(JSON.stringify(F),", degradationPreference: ").concat(ee))})(this.id+p.mid,m,this,k,M=>{n&&this.updateAdaptation(n,M)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var v;const{bitrateMax:k,frameRate:M,scaleResolutionDownBy:F}=t._encoderConfig;k&&(h.maxBitrate=1e3*k),(Ye(v=t._hints).call(v,Dn.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(M&&(h.maxFramerate=xa(M)),F&&F>=1&&(h.scaleResolutionDownBy=F))}const{maxFramerate:T}=Y("ENCODER_CONFIG_LIMIT");if(T&&typeof T=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,T):T),Y("DSCP_TYPE")&&Mu()){var C;const k=Y("DSCP_TYPE");Ye(C=["very-low","low","medium","high"]).call(C,k)&&(h.networkPriority=k)}const I=n.getParameters(),U=(s=I.encodings)===null||s===void 0?void 0:s[0];_i()&&!U&&(l.encodings=[h]),U&&Object.assign(U,h),Object.assign(I,l),D.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(I.encodings))),await n.setParameters(I),await async function(k,M,F){try{var B;if(!cn().supportSetRtpSenderParameters||!function(Te){return Te==="vp9"||Te==="av1"}(k)||!Y("ENABLE_SVC"))return;const ee={},ue={},de=M.getParameters(),ae=(B=de.encodings)===null||B===void 0?void 0:B[0];ue.scalabilityMode=aA(F),ae&&Object.assign(ae,ue),Object.assign(de,ee),await M.setParameters(de),D.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(de.encodings)))}catch(ee){D.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ee)}}(this.store.codec,n,Y("SVC_MODE"))}async updateAdaptation(t,n){var r,s;if(!t)return D.debug("[updateAdaptation] no rtpSender found");if(!cn().supportSetRtpSenderParameters)return D.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const l={},{bitrateMax:h,frameRate:p,scaleResolutionDownBy:m}=n;h&&(l.maxBitrate=1e3*h),p&&(l.maxFramerate=xa(p)),m&&m>=1&&Ye(r=["vp8","vp9"]).call(r,this.store.codec)&&(l.scaleResolutionDownBy=m);const g=t.getParameters(),v=(s=g.encodings)===null||s===void 0?void 0:s[0];v&&Object.assign(v,l),Object.assign(g,{});try{await t.setParameters(g),D.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(g.encodings)))}catch(T){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?D.debug("[updateAdaptation] peerConnection not connected}"):D.debug("[updateAdaptation] updateRtpSenderEncodings failed",T):D.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!cn().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const s=t[r],l=n[r];l instanceof Xn&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,s.sender)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const s=ca(t);return n.forEach((l,h)=>{const p=r[h],m=s.mediaDescriptions.find(g=>g.attributes.mid===p);m&&(DE(m,l),C3(m,l,this.store.codec))}),hp(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let m=0;m<t.length;m++){var r,s,l,h,p;const g=t[m],v=n[m];if(v instanceof Xn&&!Ye(r=v._hints).call(r,Dn.LOW_STREAM)&&(s=v._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((l=v._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(h=v._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((p=v._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){const T={},C={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};T.encodings=[{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:C.high}];const I=g.sender.getParameters();await g.sender.setParameters(Object.assign(I,T))}}}async applySimulcastEncodings(t,n){if(!_i()&&t.length===n.length)for(let r=0;r<t.length;r++){const s=n[r];if(s instanceof Xn&&this.isVP8Simulcast(s)){const l=t[r],h={},p={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];const m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,h))}}}isVP8Simulcast(t){var n,r,s,l,h;return!!(t instanceof Xn&&Y("SIMULCAST")&&this.store.codec==="vp8"&&!Ye(n=t._hints).call(n,Dn.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,n,r,s){if(Y("SDP_LOGGING"))return D.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(s,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",r==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(cn().supportPCSetConfiguration){const n=Ym.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},ut(tn.prototype,"updateRemoteRTPCapabilities",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"updateRemoteRTPCapabilities"),tn.prototype),ut(tn.prototype,"connect",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"connect"),tn.prototype),ut(tn.prototype,"updateRemoteConnect",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"updateRemoteConnect"),tn.prototype),ut(tn.prototype,"createDataChannels",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"createDataChannels"),tn.prototype),ut(tn.prototype,"receive",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"receive"),tn.prototype),ut(tn.prototype,"batchReceive",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"batchReceive"),tn.prototype),ut(tn.prototype,"stopReceiving",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"stopReceiving"),tn.prototype),ut(tn.prototype,"muteRemote",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"muteRemote"),tn.prototype),ut(tn.prototype,"unmuteRemote",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"unmuteRemote"),tn.prototype),ut(tn.prototype,"muteLocal",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"muteLocal"),tn.prototype),ut(tn.prototype,"unmuteLocal",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"unmuteLocal"),tn.prototype),ut(tn.prototype,"close",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"close"),tn.prototype),ut(tn.prototype,"updateEncoderConfig",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"updateEncoderConfig"),tn.prototype),ut(tn.prototype,"updateSendParameters",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"updateSendParameters"),tn.prototype),ut(tn.prototype,"replaceTrack",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"replaceTrack"),tn.prototype),ut(tn.prototype,"updateAdaptation",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"updateAdaptation"),tn.prototype),ut(tn.prototype,"getRemoteSSRC",[Hs],Object.getOwnPropertyDescriptor(tn.prototype,"getRemoteSSRC"),tn.prototype),tn);function Hs(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,l=await s.lock("From P2PConnection.".concat(t));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return await r.apply(this,p)}finally{l()}},n}function QP(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=xa(t.width),r.height=xa(t.height);const s=xa(t.framerate||15);document.body.append(n),document.body.append(r);let l=e._mediaStreamTrack;n.srcObject=new MediaStream([l]),n.play();const h=r.getContext("2d");if(!h)throw new ye(H.UNEXPECTED_ERROR,"can not get canvas context");const p=cn(),m=r.captureStream(p.supportRequestFrame?0:s).getVideoTracks()[0];m.canvas||(m.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const v=n.videoWidth,T=n.videoHeight/v,C=r.width*T;Math.abs(C-r.height)>=2&&(D.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(C)),r.height=C)}h.drawImage(n,0,0,r.width,r.height),m.requestFrame&&m.requestFrame(),l!==e._mediaStreamTrack&&(l=e._mediaStreamTrack,n.srcObject=new MediaStream([l]))},r.stopCapture=oP(()=>r.startCapture&&r.startCapture(),s);const g=m.stop;return m.stop=()=>{g.call(m),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),D.debug("clean low stream renderer")},m}var Dc=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e[e.Video_Send_Type=2225]="Video_Send_Type",e}(Dc||{}),Dt=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(Dt||{}),Cr=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(Cr||{}),zs=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(zs||{}),yA=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(yA||{});const Lm=1e3,vA=6,fT=3,g$=Math.max(vA,fT);function St(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function c4(e){const t={[zs.CONN_TYPE]:0,[zs.RTT]:e.rtt,[zs.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[zs.CONN_TYPE]=1),n==="tcp"&&(t[zs.CONN_TYPE]=3),n==="tls"&&(t[zs.CONN_TYPE]=4);break}case"srflx":t[zs.CONN_TYPE]=2;break;case"unknown":t[zs.CONN_TYPE]=5;break;default:t[zs.CONN_TYPE]=0}return t}function l4(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class d4 extends ai{constructor(t){super(),V(this,"store",void 0),V(this,"uploadWRTCStatsTimer",void 0),V(this,"uploadOutboundDenoiserStatsTimer",void 0),V(this,"uploadExtStatsTimer",void 0),V(this,"uploadExtUsageStatsTimer",void 0),V(this,"uploadInboundExtStatsTimer",void 0),V(this,"requestStats",void 0),V(this,"requestTransportStats",void 0),V(this,"requestLocalMedia",void 0),V(this,"requestRemoteMedia",void 0),V(this,"requestAllTracks",void 0),V(this,"requestVideoIsReady",void 0),V(this,"requestUploadStats",void 0),V(this,"requestUpload",void 0),V(this,"uploadOutboundStarted",!1),V(this,"uploadInboundStarted",!1),V(this,"uploadTransportStarted",!1),V(this,"uploadBaseStatsStarted",!1),V(this,"uploadExtensionUsageStarted",!1),V(this,"lastRecvStats",void 0),V(this,"lastSendStats",void 0),V(this,"lastRefRecvStats",void 0),V(this,"lastRefSendStats",void 0),V(this,"lastNormalRecvStats",void 0),V(this,"lastNormalSendStats",void 0),V(this,"needUploadRenderFreezeTime",!0),V(this,"lastUploadCompensateTime",-1),V(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%fT==0,r=t%vA==0;let s,l;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(l=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!l&&this.uploadInboundStarted&&(l=this.requestStats(!0)),s||l){var h;const p={};if(this.uploadTransportStarted&&s){const g=this.getTransportStats(s,l,n);g&&(p.misc=[g])}if(this.uploadOutboundStarted&&s){const g=this.getOutboundStats(s,r?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats);g&&(p.outbound=[g])}if(this.uploadInboundStarted&&l){this.uploadCompensateStats(t);const g=this.getInboundStats(l,r?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);g&&(p.inbound=g)}const m=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;m&&(Array.isArray(p.misc)?p.misc[0]&&p.misc[0].addition&&(p.misc[0].addition[yA.RTC_PEER_CONNECTION_STATE]=qD[m]):p.misc=[{addition:{[yA.RTC_PEER_CONNECTION_STATE]:qD[m]}}]),this.requestUploadStats(p)}this.lastRecvStats=l,this.lastSendStats=s,r&&(this.lastNormalRecvStats=l,this.lastNormalSendStats=s),n&&(this.lastRefRecvStats=l,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,r;const s=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(s&&((r=this.requestUploadStats)===null||r===void 0||r.call(this,{misc:[{addition:{[yA.RTC_PEER_CONNECTION_STATE]:qD[s.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===g$+1&&(t=1)},Lm)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=t%fT==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const r=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=r,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const s=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*s;const l=this.requestStats(!0);new Array(s).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const h={};if(this.uploadInboundStarted&&l){const p=this.requestRemoteMedia()||[],m=[];p.forEach(g=>{let[v,T]=g;const C={peer:v.uid};if(v._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(v._videoSSRC)&&T.has(it.VIDEO)&&v.videoTrack){const I=function(U,k,M){if(!k.videoRecv.find(B=>B.ssrc===U))return;const F={};if(M&&M._player){const B=M._player,{renderFreezeAccTime2:ee,videoElementStatus:ue}=B;if(bd.visibility==="visible"&&ue===ls.PLAYING&&cn().supportRequestVideoFrameCallback){const de=Math.min(6e3,ee);B.renderFreezeAccTime2=Math.max(0,ee-de),St(F,Dc.Video_Render_Freeze_Time_Render2,de),Y("USE_NEW_RENDER_FREEZE_TIME")&&St(F,Dc.Video_Render_Freeze_Time_Render,de)}}return F}(v._videoSSRC,l,v.videoTrack);I&&(C.video=I)}C.video&&m.push(C)}),m.length>0&&(h.inbound=m,this.requestUploadStats(h))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,r){if(!this.requestStats)return;if(!r)return t.rtt==null?void 0:{addition:{[zs.RTT]:t.rtt,[zs.CONN_TYPE]:void 0,[zs.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const s=c4(t);if(this.store.useP2P){if(n){const l=c4(n);s[zs.CONN_TYPE]+=l[zs.CONN_TYPE]<<3}s[zs.CONN_TYPE]+=110}else s[zs.CONN_TYPE]+=100;return{addition:s}}getOutboundStats(t,n,r,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;const l=this.requestLocalMedia();if(!l||l.length===0)return;let h,p,m;return l.forEach(g=>{let[v,{track:T,ssrcs:C}]=g;switch(v){case Le.LocalVideoLowTrack:case Le.LocalVideoTrack:if(v===Le.LocalVideoTrack){const I=function(M,F,B,ee,ue,de){const ae=F.videoSend.find(Ft=>Ft.ssrc===M);if(!ae)return;const Te={},{sentFrame:Ae,inputFrame:We}=ae;if(ee&&(St(Te,Dc.Video_Send_Qp_Sum,ae.qpSumPerFrame),We&&Ae)){var tt;const Ft=We.frameRate,xt=Ae.frameRate;Te[Dc.Video_Send_Freeze]=function(wt,qn){let Pn=!0;return Pn=!(wt<=5)&&(wt<=10?qn<3:wt<=20?qn<4:qn<5),Pn}(Ft,xt)?1:0,Te[Dc.Video_Send_Type]=B.__className__==="CameraVideoTrack"?0:Ye(tt=B._hints).call(tt,Dn.SCREEN_TRACK)?1:2}if(ue){switch(Ae&&(St(Te,Dt.Video_Send_Height,Ae.height),St(Te,Dt.Video_Send_Width,Ae.width),St(Te,Dt.Video_Send_Frame_Rate,Ae.frameRate)),Te[Dt.Video_Send_Disabled]=B._originMediaStreamTrack&&!B._originMediaStreamTrack.enabled||B._mediaStreamTrack&&!B._mediaStreamTrack.enabled?1:0,ae.adaptionChangeReason){case"none":Te[Dt.Video_Send_Adaptation]=0;break;case"cpu":Te[Dt.Video_Send_Adaptation]=1;break;case"bandwidth":Te[Dt.Video_Send_Adaptation]=2;break;case"other":Te[Dt.Video_Send_Adaptation]=3}let Ft=0;ae.adaptionChangeReason&&(Ft+=l4(ae.adaptionChangeReason)),F.qualityLimitationReason&&(Ft+=l4(F.qualityLimitationReason)<<3),Te[Dt.Video_Send_Adaptation]=Ft,Te[Dt.Video_Send_Player_Status]=sP[B._player?B._player.videoElementStatus:"uninit"],St(Te,Dt.Video_Send_Nacks,ae.nacksCount),St(Te,Dt.Video_Send_Plis,ae.plisCount),St(Te,Dt.Video_Send_Firs,ae.firsCount),St(Te,Dt.Video_Send_Avg_Encode,ae.avgEncodeMs),St(Te,Dt.Video_Send_Huge_Frame_Sent,ae.hugeFramesSent),St(Te,Dt.Video_Send_Bytes_Retransmit,ae.retransmittedBytesSent),St(Te,Dt.Video_Send_Packages_Retransmit,ae.retransmittedPacketsSent),St(Te,Dt.Video_Send_Key_Frames_Encoded,ae.keyFramesEncoded);const xt=ue.videoSend.find(wt=>wt.ssrc===M);if(xt){let wt=Lm*fT;xt.timestamp&&ae.timestamp&&(wt=ae.timestamp-xt.timestamp),xt.packets!=null&&ae.packets!=null&&St(Te,Dt.Video_Send_Package_Rate,1e3*(ae.packets-xt.packets)/wt),ae.packetsLost!=null&&xt.packetsLost!=null&&St(Te,Dt.Video_Send_Package_Lost,ae.packetsLost-xt.packetsLost),xt.bytes!=null&&ae.bytes!=null&&St(Te,Dt.Video_Send_Bitrate,8*(ae.bytes-xt.bytes)/wt)}}return Te}(C[0].ssrcId,t,T,n,r),U=T&&function(M,F,B,ee){const ue=F.videoSend.find(ae=>ae.ssrc===M);if(!ue)return null;const de={};if(ee){const ae=ue.inputFrame,Te=ae&&ae.height||B.videoHeight||0,Ae=ae&&ae.width||B.videoWidth||0,We=ae&&ae.frameRate||0;St(de,Dt.Video_Capture_Height,Te),St(de,Dt.Video_Capture_Width,Ae),St(de,Dt.Video_Capture_Frame_Rate,We)}return de}(C[0].ssrcId,t,T,!!r),k=function(M,F){const B={};return F&&(St(B,Dt.Video_Send_Retransmit,M.bitrate.retransmit),St(B,Dt.Video_Send_Target_Encoded,M.bitrate.targetEncoded),St(B,Dt.Video_Send_Actual_Encoded,M.bitrate.actualEncoded),St(B,Dt.Video_Send_Transmit,M.bitrate.transmit),St(B,Dt.Video_Send_Bandwidth,M.sendBandwidth)),B}(t,!!r);p=Object.assign({},I,U,k)}else m=function(I,U,k,M,F){const B=U.videoSend.find(ue=>ue.ssrc===I);if(!B)return;const ee={};if(M){const ue=B.sentFrame;ue&&(St(ee,Dt.Video_Send_Low_Height,ue.height),St(ee,Dt.Video_Send_Low_Width,ue.width),St(ee,Dt.Video_Send_Low_Frame_Rate,ue.frameRate));const de=M.videoSend.find(ae=>ae.ssrc===I);if(de){let ae=Lm*vA;de.timestamp&&B.timestamp&&(ae=B.timestamp-de.timestamp),de.packets!=null&&B.packets!=null&&St(ee,Dt.Video_Send_Low_Package_Rate,1e3*(B.packets-de.packets)/ae),B.packetsLost!=null&&de.packetsLost!=null&&St(ee,Dt.Video_Send_Low_Package_Lost,B.packetsLost-de.packetsLost),de.bytes!=null&&B.bytes!=null&&St(ee,Dt.Video_Send_Low_Bitrate,8*(B.bytes-de.bytes)/ae)}}return ee}(C[0].ssrcId,t,0,r);break;case Le.LocalAudioTrack:h=T&&function(I,U,k,M,F,B){const ee=U.audioSend.find(de=>de.ssrc===I);if(!ee)return;const ue={};if(F){ue[Dt.Audio_Send_Disabled]=k._originMediaStreamTrack&&!k._originMediaStreamTrack.enabled||k._mediaStreamTrack&&!k._mediaStreamTrack.enabled?1:0;const de=100*k._source.getAccurateVolumeLevel(),ae=ee.inputLevel;if(ae!=null){const Ae=Math.ceil(50*Math.log10(100*ae+1));St(ue,Dt.Audio_Send_Level,Ae)}St(ue,Dt.Audio_Capture_PCM_Level,de),St(ue,Dt.Audio_Send_AEC_Return_Loss,ee.aecReturnLoss),St(ue,Dt.Audio_Send_AEC_Return_Loss_Enhancement,ee.aecReturnLossEnhancement),St(ue,Dt.Audio_Send_Bytes_Retransmit,ee.retransmittedBytesSent),St(ue,Dt.Audio_Send_Packages_Retransmit,ee.retransmittedPacketsSent),ue[Dt.Audio_Send_Freeze]=0;const Te=F.audioSend.find(Ae=>Ae.ssrc===I);if(Te){let Ae=Lm*vA;Te.timestamp&&ee.timestamp&&(Ae=ee.timestamp-Te.timestamp),Te.bytes!=null&&ee.bytes!=null&&St(ue,Dt.Audio_Send_Bitrate,8*(ee.bytes-Te.bytes)/Ae),Te.packets!=null&&ee.packets!=null&&St(ue,Dt.Audio_Send_Package_Rate,1e3*(ee.packets-Te.packets)/Ae)}}return ue}(C[0].ssrcId,t,T,0,r)}}),{high:p,low:m,audio:h}}getInboundStats(t,n,r,s){if(!this.requestRemoteMedia)return;const l=this.requestRemoteMedia()||[],h=[];return l.forEach(p=>{let[m,g]=p;const v={peer:m.uid};if(g.has(it.VIDEO)&&m.videoTrack){const T=m._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(m._videoSSRC)||!1,C=m.videoTrack?function(I,U,k,M,F,B,ee,ue){const de=U.videoRecv.find(wt=>wt.ssrc===I);if(!de)return;const ae={},{receivedFrame:Te,outputFrame:Ae,decodeFrameRate:We}=de;St(ae,Cr.Video_Render_Frame_Rate_Decode,We),de.framesRateFirefox&&St(ae,Cr.Video_Recv_Frame_Rate,de.framesRateFirefox),Te&&St(ae,Cr.Video_Recv_Frame_Rate,Te.frameRate),St(ae,Cr.Video_Recv_Frame_Dropped,de.framesDroppedCount),St(ae,Cr.Video_Recv_Bytes_Retransmit,de.retransmittedBytesReceived),St(ae,Cr.Video_Recv_Packages_Retransmit,de.retransmittedPacketsReceived),St(ae,Cr.Video_Recv_Packages_Discarded,de.packetsDiscarded),St(ae,Cr.Video_Recv_Avg_Decode,de.avgDecodeMs),St(ae,Cr.Video_Recv_Avg_Processing_Delay,de.avgProcessingDelayMs),St(ae,Cr.Video_Recv_Avg_Assembly_Time,de.avgFramesAssembledFromMultiplePacketsMs),St(ae,Cr.Video_Recv_Avg_Inter_Frame_Delay,de.avgInterFrameDelayMs),St(ae,Cr.Video_Recv_Key_Frames_Decoded,de.keyFramesDecoded);const tt=ue&&ue.videoRecv.find(wt=>wt.ssrc===I);if(tt){const wt=U.timestamp-ue.timestamp||Lm;de.packetsLost!=null&&tt.packetsLost!=null&&St(ae,Cr.Video_Recv_Package_Lost,de.packetsLost-tt.packetsLost),tt.bytes!=null&&de.bytes!=null&&St(ae,Cr.Video_Recv_Bitrate,8*(de.bytes-tt.bytes)/wt),tt.packets!=null&&de.packets!=null&&St(ae,Cr.Video_Recv_Package_Rate,1e3*(de.packets-tt.packets)/wt)}const Ft=B&&B.videoRecv.find(wt=>wt.ssrc===I);if(Ft&&(St(ae,Dc.Video_Recv_Qp_Sum,de.qpSumPerFrame),ae[Dc.Video_Recv_Freeze]=M&&hT.isRemoteVideoFreeze(k,de,Ft)?1:0),ee){var xt;const wt=ee.videoRecv.find(Pn=>Pn.ssrc===I);Te?(St(ae,Dt.Video_Recv_Height,Te.height),St(ae,Dt.Video_Recv_Width,Te.width)):k&&(St(ae,Dt.Video_Recv_Height,k._videoHeight||0),St(ae,Dt.Video_Recv_Width,k._videoWidth||0)),Ae&&St(ae,Dt.Video_Recv_Frame_Rate_Output,Ae.frameRate);const qn=(xt=k._player)===null||xt===void 0?void 0:xt.rendFrameRate.toFixed(0);if(qn&&St(ae,Dt.Video_Render_Frame_Rate_Render,+qn),St(ae,Dt.Video_Recv_Jitter_Buffer,de.jitterBufferMs),St(ae,Dt.Video_Recv_Current_Delay,de.currentDelayMs),St(ae,Dt.Video_Recv_Firs,de.firsCount),St(ae,Dt.Video_Recv_Nacks,de.nacksCount),St(ae,Dt.Video_Recv_Plis,de.plisCount),k){ae[Dt.Video_Recv_Disabled]=k._originMediaStreamTrack.enabled&&k._mediaStreamTrack.enabled?0:1;const Pn=k._player;if(Pn){const{freezeTimeCounterList:qs,renderFreezeAccTime:Ie,renderFreezeAccTime2:Ve,videoElementStatus:ct}=Pn;if(qs&&qs.length>0&&St(ae,Dc.Video_Render_Freeze_Time,qs.splice(0,1)[0]),F&&bd.visibility==="visible"&&ct===ls.PLAYING&&cn().supportRequestVideoFrameCallback){const Ne=Math.min(6e3,Ve);Pn.renderFreezeAccTime2=Math.max(0,Ve-Ne),St(ae,Dc.Video_Render_Freeze_Time_Render2,Ne);const L=Math.min(6e3,Ie);Pn.renderFreezeAccTime=Math.max(0,Ie-L),St(ae,Dc.Video_Render_Freeze_Time_Render,Y("USE_NEW_RENDER_FREEZE_TIME")?Ne:L)}if(typeof de.totalFreezesDuration=="number"){const Ne=wt&&wt.totalFreezesDuration?de.totalFreezesDuration-wt.totalFreezesDuration:de.totalFreezesDuration;St(ae,Dt.Video_Render_Freeze_Duration,1e3*Ne)}}}if(ae[Dt.Video_Recv_Player_Status]=sP[k._player?k._player.videoElementStatus:"uninit"],wt&&de.totalInterFrameDelay!==void 0&&de.totalSquaredInterFrameDelay!==void 0&&wt.totalInterFrameDelay!==void 0&&wt.totalSquaredInterFrameDelay!==void 0){const Pn=de.totalInterFrameDelay-wt.totalInterFrameDelay,qs=de.totalSquaredInterFrameDelay-wt.totalSquaredInterFrameDelay,Ie=de.framesDecodeCount-wt.framesDecodeCount,Ve=Pn/Ie*1e3,ct=Math.round(1e3*Math.sqrt((qs-Math.pow(Pn,2)/Ie)/Ie));!isNaN(ct)&&Ve+ct>Math.max(3*Ve,Ve+150)&&(ae[Dt.Video_Recv_I_Frame_Delay]=ct)}}return ae}(m._videoSSRC,t,m.videoTrack,T===!0,this.needUploadRenderFreezeTime,n,r,s):void 0;C&&(v.video=C)}if(g.has(it.AUDIO)&&m.audioTrack){const T=m.audioTrack?function(C,I,U,k,M,F){const B=I.audioRecv.find(ae=>ae.ssrc===C);if(!B)return;const ee={};St(ee,Cr.Audio_Recv_Jitter,B.jitterMs),St(ee,Cr.Audio_Recv_Bytes_Retransmit,B.retransmittedBytesReceived),St(ee,Cr.Audio_Recv_Packages_Retransmit,B.retransmittedPacketsReceived),St(ee,Cr.Audio_Recv_Packages_Discarded,B.packetsDiscarded),St(ee,Cr.Audio_Recv_Avg_Processing_Delay,B.avgProcessingDelayMs);const ue=F&&F.audioRecv.find(ae=>ae.ssrc===C);if(ue){const ae=Lm;B.packets!=null&&ue.packets!=null&&St(ee,Cr.Audio_Recv_Package_Rate,1e3*(B.packets-ue.packets)/ae),B.packetsLost!=null&&ue.packetsLost!=null&&St(ee,Cr.Audio_Recv_Package_Lost,B.packetsLost-ue.packetsLost)}if(k){const{receivedFrames:ae,droppedFrames:Te}=B;ae!=null&&Te!=null&&(ee[Dc.Audio_Recv_Freeze]=(de=ae)===0||100*Te/de>20?1:0)}var de;if(M){const ae=100*U._source.getAccurateVolumeLevel(),Te=B.outputLevel;if(Te!=null){const We=Math.ceil(50*Math.log10(100*Te+1));St(ee,Dt.Audio_Render_Level,We)}St(ee,Dt.Audio_Recv_PCM_Level,ae),U&&(ee[Dt.Audio_Recv_Disabled]=U._originMediaStreamTrack.enabled&&U._mediaStreamTrack.enabled?0:1),St(ee,Dt.Audio_Recv_Jitter_Buffer,B.jitterBufferMs),St(ee,Dt.Audio_Recv_Current_Delay,B.jitterBufferMs),ee[Dt.Audio_Recv_Player_Status]=sP[Gs.getPlayerState(U.getTrackId())];const Ae=M.audioRecv.find(We=>We.ssrc===C);if(Ae){Ae.bytes!=null&&B.bytes!=null&&St(ee,Dt.Audio_Recv_Bitrate,8*(B.bytes-Ae.bytes)/(Lm*fT));const We=B.concealedSamples-Ae.concealedSamples;We>0&&St(ee,Dt.Audio_Recv_Concealed_Samples,We);const tt=B.totalSamplesReceived-Ae.totalSamplesReceived;tt>0&&St(ee,Dt.Audio_Recv_Total_Samples_Received,tt);const Ft=B.freezeSamples80-Ae.freezeSamples80;Ft>0&&St(ee,Dt.Audio_Render_Freeze_Samples_80ms,Ft);const xt=B.freezeSamples200-Ae.freezeSamples200;xt>0&&St(ee,Dt.Audio_Render_Freeze_Samples_200ms,xt);const wt=B.freezeMs80-Ae.freezeMs80;St(ee,Dt.Audio_Render_Freeze_Time_80ms,wt<0?0:wt);const qn=B.freezeMs200-Ae.freezeMs200;St(ee,Dt.Audio_Render_Freeze_Time_200ms,qn<0?0:qn)}}return ee}(m._audioSSRC,t,m.audioTrack,n,r,s):void 0;T&&(v.audio=T)}(v.video||v.audio)&&h.push(v)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof eT);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(nT.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,r]=t;r.has(it.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)}),r.has(it.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),r={connectionInterval:Y("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let s=[];const l=this.requestAllTracks&&this.requestAllTracks()||[];for(const g of l)!g.muted&&g.enabled&&(s=s.concat(await g.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[g,v]of h)v.has(it.VIDEO)&&g.videoTrack&&(s=s.concat(await g.videoTrack.getProcessorUsage())),v.has(it.AUDIO)&&g.audioTrack&&(s=s.concat(await g.audioTrack.getProcessorUsage()));if(s.length===0)return;r.details=function(g,v){const T={};for(const{id:k,value:M,level:F,direction:B}of g){var C;const ee=(C=v.get(k))!==null&&C!==void 0?C:0,ue=M===2?ee+Y("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ee;var I,U;v.set(k,ue),T[k]?(M===2&&(T[k].value=M),F>T[k].level&&(T[k].level=F),B==="remote"&&(T[k].remoteUidCount+=1),T[k].totalTs=(I=v.get(k))!==null&&I!==void 0?I:0):T[k]={value:M,level:F,remoteUidCount:B==="local"?0:1,totalTs:(U=v.get(k))!==null&&U!==void 0?U:0}}return Object.keys(T).map(k=>{const{level:M,value:F,totalTs:B}=T[k];return{id:k,level:M,value:F,totalTs:B}})}(s,t);const p=Date.now(),m=p>n?p:n+1;this.requestUpload&&this.requestUpload(nT.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:m})},Y("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const E$=Y("ICE_RESTART_INTERVAL");let SA=new Map,ME=new Map,vp=[Kr.UDP_TCP_RELAY,Kr.TCP_RELAY,Kr.RELAY],$P=Y("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&cn().supportPCSetConfiguration;function u4(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=SA.get(e.id);n&&(window.clearTimeout(n),SA.delete(e.id));const r=ME.get(e.id);t&&r&&r.index===vp.length-1&&(D.debug("[".concat(e.id,"] reset ICE restart policy")),ME.delete(e.id))}function h4(e,t,n){if(SA.size===0&&ME.size===0&&(Array.isArray(Y("RESTART_SEQUENCE"))&&Y("RESTART_SEQUENCE").length>0&&!function(p,m){if(p.length!==m.length)return!1;for(let g=0;g<p.length;g+=1){const v=p[g];if(p.filter(T=>T===v).length!==m.filter(T=>T===v).length)return!1}return!0}(vp,Y("RESTART_SEQUENCE"))&&(vp=Y("RESTART_SEQUENCE").filter(p=>{var m;if(Ye(m=Object.values(Kr)).call(m,p))return!0}),D.debug("use reconnection policy from config distribution, queues: ".concat(vp.join(" => ")))),$P=Y("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&cn().supportPCSetConfiguration),vp.length===0)return void n();let r,{index:s=0,type:l}=ME.get(e.id)||{};if($P&&l===Kr.RELAY)return void n();let h=l&&s>=vp.length-1;if($P)l=Kr.RELAY;else{if(h)return void n();l?(s++,l=vp[s]):(l=vp[0],s=0)}D.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(l,", index: ").concat(s)),t(l),ME.set(e.id,{index:s,type:l}),r=window.setTimeout(()=>h4(e,t,n),E$),SA.set(e.id,r)}var zt;function p4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function Nd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?p4(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p4(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function f4(e){var t,n,r,s=2;for(typeof Symbol<"u"&&(n=vD,r=Symbol.iterator);s--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new TA(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function TA(e){function t(n){if(Object(n)!==n)return Je.reject(new TypeError(n+" is not an object."));var r=n.done;return Je.resolve(n.value).then(function(s){return{value:s,done:r}})}return TA=function(n){this.s=n,this.n=n.next},TA.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?Je.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?Je.reject(n):t(r.apply(this.s,arguments))}},new TA(e)}let mT=(zt=class extends ai{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(_t.StateChange,t,this._state)}constructor(e,t){super(),V(this,"isPlanB",void 0),V(this,"store",void 0),V(this,"statsUploader",void 0),V(this,"connection",void 0),V(this,"localTrackMap",new Map),V(this,"remoteUserMap",new Map),V(this,"localDataChannels",[]),V(this,"remoteDataChannelMap",new Map),V(this,"pendingLocalTracks",[]),V(this,"pendingRemoteTracks",[]),V(this,"pendingLocalDataChannels",[]),V(this,"pendingRemoteDataChannels",[]),V(this,"statsCollector",void 0),V(this,"shouldForwardP2PCreation",void 0),V(this,"iceFailedCount",0),V(this,"dtlsFailedCount",0),V(this,"mutex",void 0),V(this,"_state",yn.Disconnected),V(this,"_pcStatsUploadType",Y("NEW_ICE_RESTART")?Gu.FIRST_CONNECTION:Gu.OLD_FIRST_CONNECTION),V(this,"_isStartRestartIce",!1),V(this,"_restartTimer",void 0),V(this,"_isTryConnecting",!1),V(this,"_iceError",null),V(this,"_forceTurn",!1),V(this,"_isWaitPcToRePub",!1),V(this,"handleMuteLocalTrack",async(n,r,s)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==yn.Connected)return void s(new Re(H.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(n);if(h.length===0)return void r();const p=h.find(g=>g[0]==="videoLowTrack");p&&p[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(g=>{let[,{id:v}]=g;return v}));const m=this.createMuteMessage(h);await Mn(this,_t.RequestMuteLocal,m),r()}catch(h){s(h)}finally{l()}}),V(this,"handleUnmuteLocalTrack",async(n,r,s)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==yn.Connected)return void s(new Re(H.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(n);if(h.length===0)return void r();const p=h.find(g=>g[0]==="videoLowTrack");if(p){const g=p[1];if(g.track._originMediaStreamTrack.stop(),!Y("DISABLE_DUAL_STREAM_USE_ENCODING")&&cn().supportDualStreamEncoding){const v=n._mediaStreamTrack.clone();g.track._mediaStreamTrack=v,g.track._originMediaStreamTrack=v}else{const v=QP(n,YS(this,_t.RequestLowStreamParameter));g.track._mediaStreamTrack=v,g.track._originMediaStreamTrack=v}await new Je((v,T)=>{this.handleReplaceTrack(g.track,v,T,!0)})}await this.connection.unmuteLocal(h.map(g=>{let[,{id:v}]=g;return v}));const m=this.createUnmuteMessage(h);await Mn(this,_t.RequestUnmuteLocal,m),r()}catch(h){s(h)}finally{l()}}),V(this,"handleUpdateVideoEncoder",async(n,r,s,l)=>{let h;l||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const m=this.localTrackMap.get(Le.LocalVideoTrack);if(!this.connection||!m||m.track!==n||this.state!==yn.Connected)return void r();const{id:g,track:v}=m;await this.connection.updateSendParameters(g,v),await this.connection.updateEncoderConfig(g,v),this.emit(_t.UpdateVideoEncoder,v),r()}catch(m){s(m)}finally{var p;(p=h)===null||p===void 0||p()}}),V(this,"handleUpdateVideoSendParameters",async(n,r,s)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Le.LocalVideoTrack);if(!this.connection||!h||h.track!==n||this.state!==yn.Connected)return void r();const{id:p,track:m}=h;await this.connection.updateSendParameters(p,m),r()}catch(h){s(h)}finally{l()}}),V(this,"handleReplaceMixingTrack",async(n,r,s,l)=>{if(!this.connection||this.state!==yn.Connected)return void r();const h=XP([n]);let p;D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof l=="boolean"&&l||(p=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,h),r()}catch(g){s(g)}finally{var m;(m=p)===null||m===void 0||m()}}),V(this,"handleReplaceTrack",async(n,r,s,l)=>{let h;D.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof l=="boolean"&&l||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var p;const g=Array.from(this.localTrackMap.entries()).find(v=>{let[,{track:T}]=v;return n===T});if(!this.connection||!g||this.state!==yn.Connected)return void r();if(await((p=this.connection)===null||p===void 0?void 0:p.replaceTrack(n,g[1].id)),this.isPlanB){const v=g[1];v.id=n._mediaStreamTrack.id,this.localTrackMap.set(g[0],v)}if(g[0]===Le.LocalVideoTrack&&!Y("DISABLE_DUAL_STREAM_USE_ENCODING")&&cn().supportDualStreamEncoding){const v=this.localTrackMap.get(Le.LocalVideoLowTrack);if(v){const T=n._mediaStreamTrack.clone();v.track._originMediaStreamTrack.stop(),v.track._mediaStreamTrack=T,v.track._originMediaStreamTrack=T,await new Je((C,I)=>{this.handleReplaceTrack(v.track,C,I,!0)})}}r()}catch(g){s(g)}finally{var m;(m=h)===null||m===void 0||m()}}),V(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),V(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),V(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),V(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),V(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new d4(this.store),this.bindStatsUploaderEvents(),this.mutex=new Wr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!cn().supportUnifiedPlan||Y("CHROME_FORCE_PLAN_B")&&Mu(),this.shouldForwardP2PCreation=Y("FORWARD_P2P_CREATION")&&cn().supportPCSetConfiguration&&PD(),this.shouldForwardP2PCreation&&(this.connection=EA(this.store),this.emit(_t.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=yn.New,this._forceTurn=a4(e),D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=EA(this.store,e),this.emit(_t.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Re(H.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=Y("NEW_ICE_RESTART")?Gu.FIRST_CONNECTION:Gu.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Re(H.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");Y("ENABLE_PREALLOC_PC")&&this.state===yn.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=yn.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(s=>{var l;let[h]=s;return Ye(l=[Le.LocalVideoLowTrack,Le.LocalVideoTrack]).call(l,h)}),n=t.map(s=>{let[,{id:l}]=s;return l}),r=t.map(s=>{let[l]=s;return l});if(this.connection instanceof Id){if(ft.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Ye(e).call(e,this.store.codec)){const s=["vp9","vp8","h264"].find(l=>Ye(e).call(e,l));s&&(this.store.codec=s,D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(s,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof Id&&this.connection.peerConnectionState!=="closed"&&Ye(e=[yn.New,yn.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==yn.Connected){if(this.state===yn.Disconnected)throw new Re(H.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var r;Ye(r=this.pendingLocalDataChannels).call(r,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const r=Date.now();this.store.publish(n.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const r=Date.now();this.store.publish(n.id+"","datachannel",void 0,r)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var r=this;return Po(function*(){const s=yield an(r.mutex.lock("From P2PChannel.publish"));try{var l;const h=r.connection&&Ye(l=["disconnected","failed"]).call(l,r.connection.peerConnectionState);if(!r.connection||r.state!==yn.Connected||h){if(r.state===yn.Disconnected)throw new Re(H.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const m=e.filter(g=>r.pendingLocalTracks.indexOf(g)===-1);return r.pendingLocalTracks=r.pendingLocalTracks.concat(m),void(h&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,Yr.markPublishStart(r.store.clientId,r.store.pubId);const p=r.filterTobePublishedTracks(e,t,n);if(p.length===0)return void(yield an(r.tryToUnmuteAudio(e)));yield*Ew(f4(r.doPublish(r.connection,p)))}finally{s()}})()}doPublish(e,t){var n=this;return Po(function*(){t.forEach(C=>{let{track:I,type:U}=C;const k=Date.now();n.store.publish(I.getTrackId(),U===Le.LocalAudioTrack?"audio":"video",k)}),n.bindLocalTrackEvents(t);const r=t.map(C=>{let{track:I}=C;return I}),s=yield an(e.send(r,n.store.codec,n.store.audioCodec)),l=(yield an(s.next())).value,h=n.createGatewayPublishMessage(t,l);let p;try{p=yield h}catch(C){throw s.throw(C),(C==null?void 0:C.code)===H.WS_ABORT&&t.forEach(I=>{let{track:U}=I;n.pendingLocalTracks.indexOf(U)===-1&&n.pendingLocalTracks.push(U)}),n.unbindLocalTrackEvents(t),C}const m=n.mapPubResToRemoteConfig(h,p,r),g=(yield an(s.next(m))).value;if(n.state===yn.Disconnected)throw new Re(H.UNEXPECTED_ERROR,"PeerConnection already disconnected.");Y("ENABLE_VIDEO_SEI");const v=Y("ENABLE_ENCODED_TRANSFORM"),T=Y("ENABLE_AUDIO_METADATA");r.forEach(async C=>{const I=C.getRTCRtpTransceiver();if(!I||!v)return;const{interceptLocalVideoFrame:U,interceptLocalAudioFrame:k}=uA();C.trackMediaType===it.VIDEO?await U(I.sender,C):C.trackMediaType===it.AUDIO&&await k(I.sender,{metadata:T?()=>{const M=C.metadata.shift();return M&&M.value}:void 0})}),t.forEach(C=>{let{type:I}=C;n.statsCollector.addLocalStats(I)}),n.assignLocalTracks(t,g),n.statsUploader.startUploadOutboundStats(),t.forEach(C=>{let{track:I,type:U}=C;const k=Date.now();n.store.publish(I.getTrackId(),U===Le.LocalAudioTrack?"audio":"video",void 0,k)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof Xn))return D.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:r}=n,s=function(l,h){const p={};return l.height&&l.width&&(p.scaleResolutionDownBy=LP(l,h)),p.maxFramerate=l.framerate?xa(l.framerate):void 0,p.maxBitrate=l.bitrate?1e3*l.bitrate:void 0,p}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==Le.LocalVideoLowTrack||!Y("DISABLE_DUAL_STREAM_USE_ENCODING")&&cn().supportDualStreamEncoding)s.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=s.scaleResolutionDownBy);else{const l=r._originMediaStreamTrack;if(!l.canvas)return D.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(h,p){const m=h.canvas;p.width&&(m.width=xa(p.width)),p.height&&(m.height=xa(p.height)),p.framerate&&(m.stopCapture&&m.stopCapture(),m.stopCapture=oP(()=>{!m.startCapture&&m.stopCapture&&m.stopCapture(),m.startCapture&&m.startCapture()},xa(p.framerate)))})(l,e)}s.maxBitrate!=null&&(r._encoderConfig.bitrateMax=s.maxBitrate/1e3),s.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=s.maxFramerate:r._encoderConfig.frameRate={max:s.maxFramerate}),D.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return Po(function*(){if(!t.connection||t.state!==yn.Connected)return;const n=yield an(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const s=t.localTrackMap.get(Le.LocalVideoTrack);if(!s)throw new Re(H.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Le.LocalVideoLowTrack))throw new Re(H.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const l=[{track:t.getLowVideoTrack(s.track,e),type:Le.LocalVideoLowTrack}];if(yield*Ew(f4(t.doPublish(t.connection,l))),s.track.muted||!s.track.enabled){var r;const h=(r=t.localTrackMap.get(Le.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;h!==void 0&&(yield an(t.connection.muteLocal([h])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(D.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Lr(this,_t.RequestRePublish,this.pendingLocalTracks),this.emit(_t.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(D.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Lr(this,_t.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:r}=this.pendingRemoteTracks[t];(r!==it.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==it.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Lr(this,_t.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===it.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(_t.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==yn.Connected)return void e.forEach(r=>{const s=this.pendingLocalTracks.indexOf(r);s!==-1&&this.pendingLocalTracks.splice(s,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(r=>r[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==yn.Connected)return void e.forEach(n=>{const r=this.pendingLocalDataChannels.indexOf(n);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const r=this.localDataChannels.indexOf(n);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==yn.Connected)return;const e=this.localTrackMap.get(Le.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[Le.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(r=>{let[,{id:s}]=r;return s})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[s,{track:l}]=r;return{type:s,track:l}})),t.forEach(r=>{let[s]=r;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==yn.Connected)throw new Re(H.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(r=>{var s;return!((s=this.remoteDataChannelMap.get(e))!==null&&s!==void 0&&s.get(r.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(r=>{var s;this.remoteDataChannelMap.has(e)?(s=this.remoteDataChannelMap.get(e))===null||s===void 0||s.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));const l=this.pendingRemoteDataChannels.findIndex(h=>{let{user:p,id:m}=h;return p.uid===e.uid&&m===r.id});l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),n.map(r=>r.id)}async subscribe(e,t,n,r,s){var l;if(!this.connection||this.state!==yn.Connected)throw new Re(H.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((l=this.remoteUserMap.get(e))!==null&&l!==void 0&&l.has(t))return;let h,p,m;const g=this.connection.getPreMedia(n);if(g)D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),m=g.transceiver,h=g.track,p=g.id;else if(s){const C=s.find(U=>{let{stream_type:k}=U;return k===t});if(!C)throw new Re(H.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const I=await this.connection.receive(t,C.ssrcs,String(e._uintid),C.attributes);this.connection instanceof Id&&(m=I.transceiver),h=I.track,p=I.id}else{const C=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof Id&&(m=C.transceiver),h=C.track,p=C.id}if(t===it.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new RE(h,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new TE(h,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack)),m&&Y("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:C,interceptRemoteAudioFrame:I}=uA();t==it.VIDEO?await C(m.receiver,{onSei:Y("ENABLE_VIDEO_SEI")&&(U=>{var k;return(k=e._videoTrack)===null||k===void 0?void 0:k._onSei(U)})}):t==it.AUDIO&&await I(m.receiver,{enableTopn:!!Y("ENABLE_AUDIO_TOPN"),enableMetadata:!!Y("ENABLE_AUDIO_METADATA"),onMetadata:U=>{this.safeEmit(_t.AudioMetadata,U)}})}const v=this.remoteUserMap.get(e);v?v.set(t,p):this.remoteUserMap.set(e,new Map([[t,p]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const T=this.pendingRemoteTracks.findIndex(C=>{let{user:I,kind:U}=C;return I.uid===e.uid&&t===U});T!==-1&&(this.pendingRemoteTracks.splice(T,1),this.emit(_t.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==yn.Connected)throw new Re(H.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(s=>{var l;let{user:h,mediaType:p}=s;return!((l=this.remoteUserMap.get(h))!==null&&l!==void 0&&l.has(p))});const t=[],n=new Map;e.forEach(s=>{if(!this.connection)return;const l=this.connection.getPreMedia(s.ssrcId);l?n.set(s.ssrcId,l):t.push(s)});const r=await this.connection.batchReceive(t.map(s=>{let{user:l,mediaType:h,ssrcId:p,rtxSsrcId:m}=s;return{kind:h,ssrcMsg:[{ssrcId:p,rtx:m}],mslabel:String(l._uintid)}}));t.forEach((s,l)=>{n.set(s.ssrcId,r[l])});for(const{user:s,mediaType:l,ssrcId:h}of e){const p=n.get(h);if(!p)return void D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(s.uid," subscribe data,").concat(l,", ").concat(h));const{track:m,id:g,transceiver:v}=p;if(v&&Y("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:I,interceptRemoteAudioFrame:U}=uA();l==it.VIDEO?await I(v.receiver,{onSei:Y("ENABLE_VIDEO_SEI")&&(k=>{var M;return(M=s._videoTrack)===null||M===void 0?void 0:M._onSei(k)})}):l==it.AUDIO&&await U(v.receiver,{enableTopn:!!Y("ENABLE_AUDIO_TOPN"),enableMetadata:!!Y("ENABLE_AUDIO_METADATA"),onMetadata:k=>{this.safeEmit(_t.AudioMetadata,k)}})}if(l===it.AUDIO?(s._audioTrack?s._audioTrack._updateOriginMediaStreamTrack(m):(s._audioTrack=new RE(m,s.uid,s._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(s._audioTrack.getTrackId()))),v&&s._audioTrack._updateRtpTransceiver(v),this.bindRemoteTrackEvents(s,s._audioTrack)):(s._videoTrack?s._videoTrack._updateOriginMediaStreamTrack(m):(s._videoTrack=new TE(m,s.uid,s._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(s._videoTrack.getTrackId()))),v&&s._videoTrack._updateRtpTransceiver(v),this.bindRemoteTrackEvents(s,s._videoTrack)),Y("ENABLE_VIDEO_SEI")&&v){const{interceptRemoteVideoFrame:I,interceptRemoteAudioFrame:U}=uA();l==it.VIDEO?await I(v.receiver,{onSei:k=>{var M;(M=s._videoTrack)===null||M===void 0||M._onSei(k)}}):l==it.AUDIO&&await U(v.receiver)}const T=this.remoteUserMap.get(s);T?T.set(l,g):this.remoteUserMap.set(s,new Map([[l,g]])),this.statsCollector.addRemoteStats(s.uid),this.statsUploader.startUploadInboundStats();const C=this.pendingRemoteTracks.findIndex(I=>{let{user:U,kind:k}=I;return U.uid===s.uid&&l===k});C!==-1&&(this.pendingRemoteTracks.splice(C,1),this.emit(_t.MediaReconnectEnd,s.uid))}}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(h=>{let{user:p,kind:m}=h;return t!==void 0?p.uid===e.uid&&t===m:p.uid===e.uid});if(r.forEach(h=>{const p=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(p,1)}),this.connection&&this.state===yn.Connected||n||r.forEach(h=>{let{kind:p}=h;var m;if(p===it.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(p===it.VIDEO){var g;(g=e._videoTrack)===null||g===void 0||g._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==yn.Connected)return;const s=this.filterTobeUnSubscribedTracks(e,t);if(s.length===0)return;await this.connection.stopReceiving(s.map(h=>{let[,{id:p}]=h;return p}));const l=this.createUnsubscribeMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(h=>{let[p,{kind:m}]=h;var g,v;if(m===it.VIDEO&&p._videoSSRC&&((g=this.connection)===null||g===void 0||g.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),m===it.VIDEO)this.unbindRemoteTrackEvents(p._videoTrack),n||((v=p._videoTrack)===null||v===void 0||v._destroy(),p._videoTrack=void 0);else if(m===it.AUDIO){var T;this.unbindRemoteTrackEvents(p._audioTrack),!n&&((T=p._audioTrack)===null||T===void 0||T._destroy(),p._audioTrack=void 0)}}),l}async unsubscribeDataChannel(e,t){if(t.forEach(s=>{const l=this.pendingRemoteDataChannels.findIndex(h=>h.id===s.id);l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(s=>{s._close()});const r=this.remoteDataChannelMap.get(e);return n.forEach(s=>{r&&r.delete(s.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(s=>s.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:s,mediaType:l}of e){const h=this.pendingRemoteTracks.filter(p=>{let{user:m,kind:g}=p;return l!==void 0?m.uid===s.uid&&l===g:m.uid===s.uid});h.forEach(p=>{const m=this.pendingRemoteTracks.indexOf(p);this.pendingRemoteTracks.splice(m,1)}),t=t.concat(h)}if(!this.connection||this.state!==yn.Connected)return void t.forEach(s=>{let{user:l,kind:h}=s;var p;if(h===it.AUDIO)(p=l._audioTrack)===null||p===void 0||p._destroy(),l._audioTrack=void 0;else if(h===it.VIDEO){var m;(m=l._videoTrack)===null||m===void 0||m._destroy(),l._videoTrack=void 0}});const n=na(e).call(e,(s,l)=>{let{user:h,mediaType:p}=l;const m=this.filterTobeUnSubscribedTracks(h,p);return s.concat(m)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(s=>{let[,{id:l}]=s;return l}));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(s=>{let[l,{kind:h}]=s;var p,m;if(h===it.VIDEO&&l._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),h===it.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),(m=l._videoTrack)===null||m===void 0||m._destroy(),l._videoTrack=void 0;else if(h===it.AUDIO){var g;this.unbindRemoteTrackEvents(l._audioTrack),(g=l._audioTrack)===null||g===void 0||g._destroy(),l._audioTrack=void 0}}),r}isPreSubScribe(e){return!this.connection||this.state!==yn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void D.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void D.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===it.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void D.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||D.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(Le.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(Le.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Xi){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[s]=r;return s!==Le.LocalAudioTrack}).filter(r=>{let[s]=r;return!(e&&s===Le.LocalVideoLowTrack)}).map(r=>{let[,{track:s}]=r;return s}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===Le.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,s){if(e){const h=this.localTrackMap.get(Le.LocalAudioTrack),p=r?this.localTrackMap.get(Le.LocalVideoLowTrack):this.localTrackMap.get(Le.LocalVideoTrack);ft.publish(this.store.sessionId,{eventElapse:Yr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:p==null?void 0:p.track.getTrackLabel(),screenshare:(p==null?void 0:p.track._hints.indexOf(Dn.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var l;n||(n=[]);const h=n.find(m=>m instanceof Si),p=r?(l=this.localTrackMap.get(Le.LocalVideoTrack))===null||l===void 0?void 0:l.track:n.find(m=>m instanceof Xn);ft.publish(this.store.sessionId,{eventElapse:Yr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.getTrackLabel(),videoName:p==null?void 0:p.getTrackLabel(),screenshare:(p==null?void 0:p._hints.indexOf(Dn.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(e,t,n,r){const s=r===it.VIDEO?n._videoSSRC:n._audioSSRC;s&&ft.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===it.VIDEO,audio:r===it.AUDIO,peerid:n.uid,subscribeRequestid:s,p2pid:this.store.p2pId,eventElapse:Yr.measureFromSubscribeStart(this.store.clientId,s),preSsrc:this.isPreSubScribe(s)})}reset(){D.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Wr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=EA(this.store),this.emit(_t.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Le.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Xi){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=yn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Le.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Le.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Xn||t&&t.track instanceof Si?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(no(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Le.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Pt(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.connection&&(D.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=yn.Reconnecting,Y("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=EA(this.store),this.emit(_t.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case Le.LocalVideoTrack:Ye(t=r._hints).call(t,Dn.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Le.LocalAudioTrack:r instanceof Xi?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Le.LocalVideoLowTrack:}}),this.emit(_t.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(no(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(_t.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(no(n).call(n)).forEach(r=>{this.setPendingRemoteDataChannel(t,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),D.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:s}=n;if((e instanceof yp?e.uid:e)===r.uid&&s===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:s}=n;if((e instanceof yp?e.uid:e)===r.uid&&t===s)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Po(function*(){if(!t.connection||t.state!==yn.Connected)return;const n=yield an(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield an(t.connection.restartICE(e));const l=yield an(r.next());if(l.done)return;const h=l.value,p=yield h;switch(JP(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Kr.UDP_TCP_RELAY:t._pcStatsUploadType=Gu.UDP_TCP_RESTART;break;case Kr.TCP_RELAY:t._pcStatsUploadType=Gu.TCP_RESTART;break;case Kr.RELAY:t._pcStatsUploadType=Gu.RELAY_RESTART;break;default:t._pcStatsUploadType=Gu.OLD_RESTART}t._isTryConnecting=!0,r.next(p)}catch(l){var s;(s=r)===null||s===void 0||s.throw(l)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(Le.LocalVideoTrack),n=this.localTrackMap.get(Le.LocalAudioTrack),r=e.videoSend.find(I=>I.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),s=e.audioSend.find(I=>I.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!r||!s)return 1;const l=eo(this,_t.NeedSignalRTT),h=r?r.rttMs:void 0,p=s?s.rttMs:void 0,m=h&&p?(h+p)/2:h||p,g=(m&&l?(m+l)/2:m||l)||0,v=100*e.sendPacketLossRate*.7/50+.3*g/1500,T=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,C=t==null?void 0:t.track;if(C&&C._encoderConfig&&C._hints.indexOf(Dn.SCREEN_TRACK)===-1){const I=C._encoderConfig.bitrateMax,U=e.bitrate.actualEncoded;if(I&&U){const k=(1e3*I-U)/(1e3*I);return $B[k<.15?0:k<.3?1:k<.45?2:k<.6?3:4][T]}}return T}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const s=r._audioSSRC,l=r._videoSSRC,h=e.audioRecv.find(U=>U.ssrc===s),p=e.videoRecv.find(U=>U.ssrc===l);if(!h&&!p)return void(t+=1);const m=eo(this,_t.NeedSignalRTT),g=e.rtt,v=(g&&m?(g+m)/2:g||m)||0,T=h?h.jitterMs:void 0,C=e.recvPacketLossRate;let I=.7*C*100/50+.3*v/1500;T&&(I=.6*C*100/50+.2*v/1500+.2*T/400),t+=I<.1?1:I<.17?2:I<.36?3:I<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Je((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(D.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==yn.Connected)return;const r=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:h}]=l;return e===h});if(!r)return;const s=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:s}]),this.bindLocalTrackEvents([{track:t,type:s}]),r[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const l=r[1];l.id=t._mediaStreamTrack.id,this.localTrackMap.set(s,l)}if(s===Le.LocalVideoTrack&&!Y("DISABLE_DUAL_STREAM_USE_ENCODING")&&cn().supportDualStreamEncoding){const l=this.localTrackMap.get(Le.LocalVideoLowTrack);if(l){const h=e._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=h,l.track._originMediaStreamTrack=h,await new Je((p,m)=>{this.handleReplaceTrack(l.track,p,m,!0)})}}}filterTobePublishedTracks(e,t,n){const r=[],s=this.getAllTracks();e=lE(e=e.filter(m=>s.indexOf(m)===-1));let l,h=!1;const p=this.localTrackMap.get(Le.LocalAudioTrack);for(const m of e){if(m instanceof Xn&&(this.localTrackMap.has(Le.LocalVideoTrack)||h?new Re(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:m,type:Le.LocalVideoTrack}),h=!0),t)){const g=this.getLowVideoTrack(m,n);r.push({track:g,type:Le.LocalVideoLowTrack})}if(m instanceof Si)if(p){const g=p.track;if(g instanceof Xi)YP([m]),g.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0);else{const v=XP([g,m]);D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(v.getTrackId(),"]")),this.replaceTrack(g,v)}}else l instanceof Xi?(YP([m]),l.addAudioTrack(m)):l||!m._useAudioElement&&cn().webAudioMediaStreamDest&&!m._bypassWebAudio?l=XP(l?[m,l]:[m]):l=m}return l&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(l.getTrackId(),"]")),r.push({track:l,type:Le.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=lE(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof Si){const s=this.localTrackMap.get(Le.LocalAudioTrack);if(!s)continue;s.track instanceof Xi?(s.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),s.track.trackList.length===0&&(t.push([Le.LocalAudioTrack,s]),s.track.close())):t.push([Le.LocalAudioTrack,s])}if(r instanceof Xn){const s=this.localTrackMap.get(Le.LocalVideoTrack);if(!s)continue;t.push([Le.LocalVideoTrack,s]);const l=this.localTrackMap.get(Le.LocalVideoLowTrack);l&&t.push([Le.LocalVideoLowTrack,l])}}return t}filterTobePublishedDataChannels(e){return e=(e=lE(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=lE(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Le.LocalVideoTrack:n.addListener(lt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(lt.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(lt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(lt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(lt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Le.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Le.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Xi?e.trackList.forEach(n=>{n.addListener(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(lt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(lt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(lt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(lt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Le.LocalVideoTrack:n.off(lt.GET_STATS,this.handleGetLocalVideoStats),n.off(lt.GET_RTC_STATS,this.handleGetRTCStats),n.off(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(lt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(lt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(lt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Le.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Le.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Xi?e.trackList.forEach(t=>{t.off(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(lt.GET_STATS,this.handleGetLocalAudioStats),t.off(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(lt.GET_STATS,this.handleGetLocalAudioStats),e.off(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(lt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(lt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof TE&&t.addListener(lt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof RE&&t.addListener(lt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(lt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(it.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(it.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var s;let l,h,{track:p,type:m}=n;switch(m){case Le.LocalAudioTrack:l=Sn.Audio,h={dtx:p instanceof eT&&p._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Le.LocalVideoTrack:l=Ye(s=p._hints).call(s,Dn.SCREEN_TRACK)?Sn.Screen:Sn.High,h=Nd(Nd({},f3(p)),{},{codec:this.store.codec,svc_mode:aA()});break;case Le.LocalVideoLowTrack:l=Sn.Low,h=Nd(Nd({},f3(p)),{},{codec:this.store.codec,svc_mode:aA()})}return{stream_type:l,attributes:h,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[s,{track:l,ssrcs:h,id:p}]=t;switch(s){case Le.LocalVideoTrack:r=Ye(n=l._hints).call(n,Dn.SCREEN_TRACK)?Sn.Screen:Sn.High;break;case Le.LocalAudioTrack:r=Sn.Audio;break;case Le.LocalVideoLowTrack:r=Sn.Low}return{stream_type:r,ssrcs:h,mid:p}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:s,type:l}=n;this.localTrackMap.set(l,{track:s,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(_t.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Id&&!_i()&&Y("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},Y("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Id&&u4(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Gu.DISCONNECTED_OR_FAILED,eo(this,_t.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(s=>s.getTrackId()),r=this.pendingLocalDataChannels.map(s=>"dc_".concat(s.id));ft.reportApiInvoke(this.store.sessionId,{name:Mi.REPUB_AFTER_PC_CONNECTED,options:n.concat(r),tag:Ei.TRACER}).onSuccess(),this.republish()}if(Y("NEW_ICE_RESTART")&&e instanceof Id&&!_i()&&!this._forceTurn){if(Ye(c3).call(c3,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=s=>{JP(e)&&(D.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(s)),eo(this,_t.QueryClientConnectionState)==="CONNECTED"&&this.emit(_t.RequestRestartICE,s))},r=()=>{JP(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),D.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(_t.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{h4(e,n,r)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&Y("ICE_RESTART")&&eo(this,_t.QueryClientConnectionState)==="CONNECTED"&&this.emit(_t.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(_t.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(_t.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),ft.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Ei.TRACER}).onSuccess(),this.emit(_t.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(no(n=this.remoteUserMap).call(n)).find(l=>l._audioSSRC===t);var s;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(s=r.audioTrack)===null||s===void 0||s.emit(gE.FIRST_FRAME_DECODED),ft.firstRemoteFrame(this.store.sessionId,rr.FIRST_AUDIO_DECODE,ii.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Yr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(no(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);r&&ft.firstRemoteFrame(this.store.sessionId,rr.FIRST_AUDIO_RECEIVED,ii.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Yr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from(no(n=this.remoteUserMap).call(n)).find(s=>s._videoSSRC===t);r&&ft.firstRemoteFrame(this.store.sessionId,rr.FIRST_VIDEO_RECEIVED,ii.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Yr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",s=n.candidateType==="relay";n.candidateType!=="unknown"&&r===s||this.emit(_t.ConnectionTypeChange,r),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(_p(n))," -> ").concat(JSON.stringify(_p(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(_p(n))," -> ").concat(JSON.stringify(_p(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Nd(Nd({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof Id&&function(t){ME.delete(t.id),u4(t)}(e),e.close(),this.emit(_t.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(Le.LocalAudioTrack);if(e instanceof Si&&(n==null?void 0:n.track)instanceof Xi)return n.track.isActive||t.push([Le.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:l}]=s;return e===l});if(r&&(t.push(r),r[0]===Le.LocalVideoTrack)){const s=this.localTrackMap.get(Le.LocalVideoLowTrack);s&&t.push([Le.LocalVideoLowTrack,s])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(Le.LocalAudioTrack);if(e instanceof Si&&(n==null?void 0:n.track)instanceof Xi)return n.track.isActive&&t.push([Le.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:l}]=s;return e===l});if(r)if(r[0]===Le.LocalVideoTrack){t.push(r);const s=this.localTrackMap.get(Le.LocalVideoLowTrack);s&&t.push([Le.LocalVideoLowTrack,s])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[s,{track:l,ssrcs:h,id:p}]=t;switch(s){case Le.LocalAudioTrack:r=Sn.Audio;break;case Le.LocalVideoTrack:r=Ye(n=l._hints).call(n,Dn.SCREEN_TRACK)?Sn.Screen:Sn.High;break;case Le.LocalVideoLowTrack:r=Sn.Low}return{stream_type:r,ssrcs:h,mid:p}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[s,{track:l,ssrcs:h,id:p}]=t;switch(s){case Le.LocalAudioTrack:r=Sn.Audio;break;case Le.LocalVideoTrack:r=Ye(n=l._hints).call(n,Dn.SCREEN_TRACK)?Sn.Screen:Sn.High;break;case Le.LocalVideoLowTrack:r=Sn.Low}return{stream_type:r,ssrcs:h,mid:p}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const s=r.get(t);if(!s)return n;n.push([e,{kind:t,id:s}])}else Array.from(r.entries()).forEach(s=>{let[l,h]=s;n.push([e,{kind:l,id:h}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(r=>{var s;(s=this.remoteDataChannelMap.get(e))!==null&&s!==void 0&&s.has(r.id)&&n.push(r)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:s,id:l}]=n;switch(s){case it.VIDEO:return void(r._videoSSRC&&t.push({stream_type:it.VIDEO,ssrcId:r._videoSSRC}));case it.AUDIO:return void(r._audioSSRC&&t.push({stream_type:it.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[r,{kind:s}]=n;if(t.has(r)){let l=t.get(r);s===it.VIDEO?l|=sr.Video:l|=sr.Audio,t.set(r,l)}else s===it.VIDEO?t.set(r,sr.Video):t.set(r,sr.Audio)}),{users:Array.from(t.entries()).map(n=>{let[r,s]=n;return{stream_id:r.uid,stream_type:s}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const s=this.remoteUserMap.get(n);s&&(s.delete(r),Array.from(s.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Le.LocalVideoTrack),n=this.localTrackMap.get(Le.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Je((r,s)=>{this.handleUpdateVideoEncoder(t.track,r,s,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Je((r,s)=>{this.handleUpdateVideoEncoder(n.track,r,s,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t,n){return e.map((r,s)=>{var l;let{stream_type:h}=r;const p=(l=t.find(m=>{let{stream_type:g}=m;return h===g}))===null||l===void 0?void 0:l.attributes;if(p&&Y("DISABLE_SCREEN_SHARE_REMB")){const m=n[s]._hints;(Ye(m).call(m,Dn.SCREEN_TRACK)||Ye(m).call(m,Dn.SCREEN_LOW_TRACK))&&(p.remb=!1,D.debug("disable remb for screen share, hints:",m))}return p})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Si){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(l=>{let[,{id:h}]=l;return h})));const s=this.createUnmuteMessage(r);return void await Mn(this,_t.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(_t.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(_t.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Tr(BD(this.dtlsFailedCount,Gi)),this.emit(_t.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Lr(this,_t.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(_t.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Le.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Xn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Xn).length>1)throw new Re(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Si).length>1&&(e.some(t=>t instanceof Si&&t._bypassWebAudio)||!cn().webAudioMediaStreamDest))throw new Re(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Xn&&this.pendingLocalTracks.some(n=>n instanceof Xn))throw new Re(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Si&&this.pendingLocalTracks.some(n=>n instanceof Si)&&(!cn().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Si&&n._bypassWebAudio)))throw new Re(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const r=!Y("DISABLE_DUAL_STREAM_USE_ENCODING")&&cn().supportDualStreamEncoding,s=Nd(Nd({},{width:160,height:120,framerate:15,bitrate:50}),t);let l;l=r?e._mediaStreamTrack.clone():QP(e,s);const h=Bn(8,"track-low-"),p=new Xn(l,Nd(Nd({},r&&{scaleResolutionDownBy:LP(s,e)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,h);return p.on(bm.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,mE.LOW_STREAM)}),p._hints.push(Dn.LOW_STREAM),Ye(n=e._hints).call(n,Dn.SCREEN_TRACK)&&p._hints.push(Dn.SCREEN_LOW_TRACK),e.on("sei-to-send",m=>{p.emit("sei-to-send",m)}),e.addListener(lt.NEED_CLOSE,()=>{p.close()}),p}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Id){var s,l,h,p;const m=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:g,dtlsTransportState:v,peerConnectionState:T}=this.connection,{local:C,remote:I}=await this.connection.getSelectedCandidatePair();ft.pcStats(this.store.sessionId,{startTime:m,eventElapse:e-m||0,iceconnectionsate:g,dtlsstate:v,connectionstate:T,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:(s=C==null?void 0:C.protocol)!==null&&s!==void 0?s:"",selectedLocalCandidateType:(l=C.candidateType)!==null&&l!==void 0?l:"",selectedLocalCandidateAddress:"".concat(C.address,":").concat(C.port),selectedRemoteCandidateProtocol:(h=I.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(p=I.candidateType)!==null&&p!==void 0?p:"",selectedRemoteCandidateAddress:"".concat(I.address,":").concat(I.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,t,n,r){var s;const l=Array.from(no(s=this.remoteUserMap).call(s)).find(h=>h._videoSSRC===e);if(l){r||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,p=h.subscribe.find(m=>m.userId===l.uid&&m.type==="video");ft.firstRemoteVideoDecode(this.store.sessionId,rr.FIRST_VIDEO_DECODE,ii.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:n,subscribeElapse:Yr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(p==null?void 0:p.subscribeEnd)||0,subscriberStart:(p==null?void 0:p.subscribeStart)||0,videoAddNotify:(p==null?void 0:p.streamAdded)||0,state:r?1:0,firstFrame:(p==null?void 0:p.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const s=r.get(t);if(!s)return!1;const l=await this.connection.getRemoteSSRC(s);return l!==void 0&&l!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===Le.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,mE.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},ut(zt.prototype,"startP2PConnection",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"startP2PConnection"),zt.prototype),ut(zt.prototype,"connect",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"connect"),zt.prototype),ut(zt.prototype,"updateRemoteRTPCapabilities",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"updateRemoteRTPCapabilities"),zt.prototype),ut(zt.prototype,"publishDataChannel",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"publishDataChannel"),zt.prototype),ut(zt.prototype,"unpublish",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"unpublish"),zt.prototype),ut(zt.prototype,"unpublishDataChannel",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"unpublishDataChannel"),zt.prototype),ut(zt.prototype,"unpublishLowStream",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"unpublishLowStream"),zt.prototype),ut(zt.prototype,"subscribeDataChannel",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"subscribeDataChannel"),zt.prototype),ut(zt.prototype,"subscribe",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"subscribe"),zt.prototype),ut(zt.prototype,"massSubscribe",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"massSubscribe"),zt.prototype),ut(zt.prototype,"unsubscribe",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"unsubscribe"),zt.prototype),ut(zt.prototype,"unsubscribeDataChannel",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"unsubscribeDataChannel"),zt.prototype),ut(zt.prototype,"massUnsubscribe",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"massUnsubscribe"),zt.prototype),ut(zt.prototype,"muteRemote",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"muteRemote"),zt.prototype),ut(zt.prototype,"unmuteRemote",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"unmuteRemote"),zt.prototype),ut(zt.prototype,"hasRemoteMediaWithLock",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"hasRemoteMediaWithLock"),zt.prototype),ut(zt.prototype,"disconnectForReconnect",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"disconnectForReconnect"),zt.prototype),ut(zt.prototype,"updateBitrateLimit",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"updateBitrateLimit"),zt.prototype),ut(zt.prototype,"remoteMediaSsrcChanged",[Es],Object.getOwnPropertyDescriptor(zt.prototype,"remoteMediaSsrcChanged"),zt.prototype),zt);function Es(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,l=await s.lock("From P2PChannel.".concat(t));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return await r.apply(this,p)}finally{l()}},n}function m4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function _4(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?m4(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m4(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const y$=Date.now(),v$=20,ZP=new Map,RA=new Map;async function g4(e){const t=ZP.get(e),n=Array.isArray(t)&&t[t.length-1],r=RA.get(e);if(!n)return void(r.isSyncing=!1);const s={uid:n.uid,payload:n.payload};r.firstRecvTs===0&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const l=n.sendTs-r.firstSendTs,h=l-(Date.now()-r.firstRecvTs);h>0&&(r.firstRecvTs=Date.now()-l);let p=n.mediaDelay+h;p<=0?(t.pop(),E4(n.context,s),p=0):p=Math.min(p,v$),setTimeout(()=>t.length&&g4(e),p)}function E4(e,t){e.safeEmit(qt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function S$(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return E4(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),s=ZP.get(r)||[],l=s.findIndex(g=>e.sendTs>=g.sendTs),h=_4(_4({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});l===-1?s.push(h):s.splice(l,0,h),ZP.set(r,s);let p=!1;var m;RA.has(r)?p=!((m=RA.get(r))===null||m===void 0||!m.isSyncing):RA.set(r,{isSyncing:p,firstRecvTs:0,firstSendTs:0}),p||g4(r)}const T$=on().name;function y4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function v4(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?y4(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y4(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const UE="websdk_ng_cache_parameter",R$=Y("MAX_PRELOAD_ASYNC_LENGTH"),b$=1e4,km=new Map,xm=[];let eL=null,tL=0,nL=0;const bA=new Map,C$=function(e,t){const n=[];let r=0;const s=async()=>{const l=n.shift();l&&await l(),n.length>0&&r<t?s():r--};return async function(){for(var l=arguments.length,h=new Array(l),p=0;p<l;p++)h[p]=arguments[p];return new Je(async(m,g)=>{n.push(async()=>{try{const v=await e(...h);m(v)}catch(v){g(v)}}),r<t&&(r++,s())})}}(S4,R$),iL=Bs.CancelToken.source();async function S4(e,t,n,r,s,l){try{if(!Y("ENABLE_PRELOAD"))return;if(!cn().supportWebCrypto)return void dp(()=>{D.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new Re(H.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Sr(n,"token",1,2047),Sr(e,"appid",1,2047),tA(t),r&&nA(r);const h=Tm();D.debug("preload channel ".concat(t,", uid is ").concat(r));const p={appId:e,cname:t,token:n||e,uid:typeof r!="string"?r:null,sid:h,proxyServer:s};let m,g;typeof r=="string"?(p.stringUid=r,[g,m]=await Je.all([o$(r,{sid:h,appId:e},iL.token),W3(v4(v4({},p),{},{token:n||e,uid:0}),iL.token)]),p.uid=g.uid,m.gatewayInfo.uid=p.uid,m.gatewayInfo.res.uid=p.uid):(l&&(p.stringUid=l),m=await W3(p,iL.token));const v={sid:h,appId:e,cname:t,token:n||e,uid:p.stringUid||r,intUid:p.uid||m.gatewayInfo.uid,stringUid:p.stringUid,ts:Date.now(),sua:g,ap:m};await async function(T){let C;try{T.uid&&R4({appId:T.appId,cname:T.cname,token:T.token,uid:T.uid,stringUid:T.stringUid});const I=A4(T),U=await async function(M,F){try{const B=await window.crypto.subtle.importKey("raw",fV(F),"AES-GCM",!1,["encrypt"]),ee=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},B,Sm(window.btoa(JSON.stringify(M))));return up(new Uint8Array(ee))}catch{return}}(T,T.token||T.appId);if(!U)return;C=w4(UE);const k=C?JSON.parse(C):[];k.push({[I]:U}),k.length>Y("AP_CACHE_NUM")&&k.shift(),CA(UE,JSON.stringify(k))}catch(I){D.warn("Error caching server parameters:",I.message),CA(UE,"")}}(v),tL++}catch(h){throw nL++,function(p){eL||(eL=window.setTimeout(()=>{let g="";bA.forEach((v,T)=>{g+="".concat(T,": ").concat(v," ;")}),ft.reportApiInvoke(null,{name:Mi.PRELOAD,options:{success:tL,failed:nL,err:g}}).onError(p),tL=0,nL=0,bA.clear(),eL=null},b$));const m=bA.get(p.code)||0;bA.set(p.code,m+1)}(h),h}}async function T4(e){try{if(Y("AP_REQUEST_DETAIL")||Y("ENABLE_ROLE_SELECT_EDGE"))return;const t=R4(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(r,s){try{const l=await window.crypto.subtle.importKey("raw",fV(s),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},l,Sm(r));return JSON.parse(window.atob(up(new Uint8Array(h))))}catch{return}}(t,e.token||e.appId);if(!n||!function(r,s){return r.cname===s.cname&&r.appId===s.appId&&r.token===s.token?s.stringUid?r.stringUid===s.stringUid:typeof s.uid=="number"?r.uid===s.uid:r.uid==s.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<Y("AP_CACHE_LIFETIME"))return n}catch(t){D.warn("Error get preloadInfo",t.message)}}function R4(e){let t;try{if(t=w4(UE),!t)return;const n=JSON.parse(t),r=A4(e),s=function(h,p){for(let m=h.length-1;m>=0;m--)if(p(h[m]))return m;return-1}(n,h=>r in h);if(s===-1)return;const l=n.splice(s,1)[0];return CA(UE,JSON.stringify(n)),l[r]}catch(n){D.warn("Error delete preload info: ".concat(t),n.message),CA(UE,"")}}function rL(e){if(e){let t=km.get(e);t&&(window.clearTimeout(t),t=null,km.delete(e)),Ye(xm).call(xm,e)||e.cloudProxyServer!=="disabled"||xm.push(e)}if(km.size<Y("AP_CACHE_NUM")&&xm.length>0){const t=xm.shift();km.set(t,window.setTimeout(async()=>{const{appId:n,cname:r,token:s,stringUid:l,uid:h,proxyServer:p}=t;try{await C$(n,r,s,h,p,l),km.has(t)&&rL(t)}catch(m){D.warn("update preload failed",m.message),b4(t)}},Y("AP_UPDATE_INTERVAL")))}}function b4(e){const t=xm.indexOf(e);t!==-1&&xm.splice(t,1);let n=km.get(e);n&&(window.clearTimeout(n),n=null,km.delete(e),rL())}function C4(e,t){const n=e.sua,r=e.ap;t&&n&&ft.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),ft.reportResourceTiming(e.ap.url,e.sid),ft.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(s=>s.ip).join(","),eventType:"disabled",unilbsServerIds:[ji.CHOOSE_SERVER,ji.CLOUD_PROXY_FALLBACK].toString()}),ft.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(s=>s.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[ji.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function w4(e){return window.atob(window.localStorage.getItem(e)||"")}function CA(e,t){window.localStorage.setItem(e,window.btoa(t))}function A4(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),SV(t)}function w$(e){let t=function(){const n=N$.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,r){let s=n.appId;s!==void 0&&(Vi(r,10),Sp(r,s));let l=n.cid;l!==void 0&&(Vi(r,16),Vi(r,l));let h=n.cname;h!==void 0&&(Vi(r,26),Sp(r,h));let p=n.deviceId;p!==void 0&&(Vi(r,34),Sp(r,p));let m=n.elapse;m!==void 0&&(Vi(r,40),Tp(r,m));let g=n.fileSize;g!==void 0&&(Vi(r,48),Tp(r,jE(g)));let v=n.height;v!==void 0&&(Vi(r,56),Tp(r,jE(v)));let T=n.jpg;T!==void 0&&(Vi(r,66),Vi(r,T.length),N4(r,T));let C=n.networkType;C!==void 0&&(Vi(r,72),Tp(r,jE(C)));let I=n.osType;I!==void 0&&(Vi(r,80),Tp(r,jE(I)));let U=n.requestId;U!==void 0&&(Vi(r,90),Sp(r,U));let k=n.sdkVersion;k!==void 0&&(Vi(r,98),Sp(r,k));let M=n.sequence;M!==void 0&&(Vi(r,104),Tp(r,jE(M)));let F=n.sid;F!==void 0&&(Vi(r,114),Sp(r,F));let B=n.timestamp;B!==void 0&&(Vi(r,120),Tp(r,B));let ee=n.uid;ee!==void 0&&(Vi(r,128),Vi(r,ee));let ue=n.vid;ue!==void 0&&(Vi(r,136),Vi(r,ue));let de=n.width;de!==void 0&&(Vi(r,144),Tp(r,jE(de)));let ae=n.service;ae!==void 0&&(Vi(r,152),Vi(r,ae));let Te=n.callbackData;Te!==void 0&&(Vi(r,162),Vi(r,Te.length),N4(r,Te));let Ae=n.ticket;Ae!==void 0&&(Vi(r,170),Sp(r,Ae));let We=n.vendorConfigs;We!==void 0&&(Vi(r,178),Sp(r,We))}(e,t),function(n){let r=n.bytes,s=n.limit;return r.length===s?r:r.subarray(0,s)}(t)}function A$(e){return function(n){let r={};e:for(;!O$(n);){let s=_T(n);switch(s>>>3){case 0:break e;case 1:r.code=_T(n);break;case 2:r.msg=O4(n,_T(n));break;case 3:r.requestId=O4(n,_T(n));break;case 4:r.timestamp=D$(n,!1);break;default:I$(n,7&s)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function I$(e,t){switch(t){case 0:for(;128&Pc(e););break;case 2:sL(e,_T(e));break;case 5:sL(e,4);break;case 1:sL(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function jE(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let N$=[];function sL(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function O$(e){return e.offset>=e.limit}function wA(e,t){let n=e.bytes,r=e.offset,s=e.limit,l=r+t;if(l>n.length){let h=new Uint8Array(2*l);h.set(n),e.bytes=h}return e.offset=l,l>s&&(e.limit=l),r}function I4(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function N4(e,t){let n=wA(e,t.length);e.bytes.set(t,n)}function O4(e,t){let n=I4(e,t),r=String.fromCharCode,s=e.bytes,l="",h="";for(let p=0;p<t;p++){let m,g,v,T,C=s[p+n];(128&C)==0?h+=r(C):(224&C)==192?p+1>=t?h+=l:(m=s[p+n+1],(192&m)!=128?h+=l:(T=(31&C)<<6|63&m,T<128?h+=l:(h+=r(T),p++))):(240&C)==224?p+2>=t?h+=l:(m=s[p+n+1],g=s[p+n+2],(49344&(m|g<<8))!=32896?h+=l:(T=(15&C)<<12|(63&m)<<6|63&g,T<2048||T>=55296&&T<=57343?h+=l:(h+=r(T),p+=2))):(248&C)==240?p+3>=t?h+=l:(m=s[p+n+1],g=s[p+n+2],v=s[p+n+3],(12632256&(m|g<<8|v<<16))!=8421504?h+=l:(T=(7&C)<<18|(63&m)<<12|(63&g)<<6|63&v,T<65536||T>1114111?h+=l:(T-=65536,h+=r(55296+(T>>10),56320+(1023&T)),p+=3))):h+=l}return h}function Sp(e,t){let n=t.length,r=0;for(let h=0;h<n;h++){let p=t.charCodeAt(h);p>=55296&&p<=56319&&h+1<n&&(p=(p<<10)+t.charCodeAt(++h)-56613888),r+=p<128?1:p<2048?2:p<65536?3:4}Vi(e,r);let s=wA(e,r),l=e.bytes;for(let h=0;h<n;h++){let p=t.charCodeAt(h);p>=55296&&p<=56319&&h+1<n&&(p=(p<<10)+t.charCodeAt(++h)-56613888),p<128?l[s++]=p:(p<2048?l[s++]=p>>6&31|192:(p<65536?l[s++]=p>>12&15|224:(l[s++]=p>>18&7|240,l[s++]=p>>12&63|128),l[s++]=p>>6&63|128),l[s++]=63&p|128)}}function Pc(e){return e.bytes[I4(e,1)]}function D4(e,t){let n=wA(e,1);e.bytes[n]=t}function _T(e){let t,n=0,r=0;do t=Pc(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function Vi(e,t){for(t>>>=0;t>=128;)D4(e,127&t|128),t>>>=7;D4(e,t)}function D$(e,t){let n,r=0,s=0,l=0;return n=Pc(e),r=127&n,128&n&&(n=Pc(e),r|=(127&n)<<7,128&n&&(n=Pc(e),r|=(127&n)<<14,128&n&&(n=Pc(e),r|=(127&n)<<21,128&n&&(n=Pc(e),s=127&n,128&n&&(n=Pc(e),s|=(127&n)<<7,128&n&&(n=Pc(e),s|=(127&n)<<14,128&n&&(n=Pc(e),s|=(127&n)<<21,128&n&&(n=Pc(e),l=127&n,128&n&&(n=Pc(e),l|=(127&n)<<7))))))))),{low:r|s<<28,high:s>>>4|l<<24,unsigned:t}}function Tp(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,l=s===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:s<128?9:10,h=wA(e,l),p=e.bytes;switch(l){case 10:p[h+9]=s>>>7&1;case 9:p[h+8]=l!==9?128|s:127&s;case 8:p[h+7]=l!==8?r>>>21|128:r>>>21&127;case 7:p[h+6]=l!==7?r>>>14|128:r>>>14&127;case 6:p[h+5]=l!==6?r>>>7|128:r>>>7&127;case 5:p[h+4]=l!==5?128|r:127&r;case 4:p[h+3]=l!==4?n>>>21|128:n>>>21&127;case 3:p[h+2]=l!==3?n>>>14|128:n>>>14&127;case 2:p[h+1]=l!==2?n>>>7|128:n>>>7&127;case 1:p[h]=l!==1?128|n:127&n}}const P4={},L4={},AA=4294967296,P$=AA*AA,L$=P$/2;x4(0,!0);const k4=x4(0),k$=gT(0,-2147483648,!1),x$=gT(-1,2147483647,!1);function x4(e,t){let n,r,s;return t?(s=0<=(e>>>=0)&&e<256)&&(r=L4[e],r)?r:(n=gT(e,0,!0),s&&(L4[e]=n),n):(s=-128<=(e|=0)&&e<128)&&(r=P4[e],r)?r:(n=gT(e,e<0?-1:0,!1),s&&(P4[e]=n),n)}function gT(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function M4(e,t){if(isNaN(e))return k4;{if(e<=-9223372036854776e3)return k$;if(e+1>=L$)return x$}return e<0?k4:gT(e%AA|0,e/AA|0,t)}function U4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}class aL extends ai{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Tl.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),V(this,"name","AgoraRTCImageModeration"),V(this,"_connectionState",Mo.CONNECTING),V(this,"_sequence",0),V(this,"_moderationStartTime",void 0),V(this,"_workerConnection",void 0),V(this,"_workerMessageLengthLimit",void 0),V(this,"_qualityRatio",void 0),V(this,"_connectInfo",void 0),V(this,"_cancelTokenSource",Bs.CancelToken.source()),V(this,"_retryConfig",void 0),V(this,"_moderationInterval",void 0),V(this,"_moderationTimer",null),V(this,"_moderationMode",1),V(this,"_quality",1),V(this,"_qualityTimer",null),V(this,"_ticket",void 0),V(this,"_moderationIntervalMinimum",void 0),V(this,"_uploadFailedNum",0),V(this,"_uploadNum",0),V(this,"_uploadTimer",null),V(this,"_extraInfo",void 0),V(this,"_vendor",""),V(this,"_encoder",new TextEncoder),V(this,"_moderationId",void 0),V(this,"inspectImage",()=>{if(this.connectionState!==Mo.CONNECTED)throw new ye(H.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Mo.CONNECTED?this.requestToInspectImage():D.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Bn(5,"image-moderation-"),this._workerMessageLengthLimit=Y("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=Y("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=Y("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new sT("worker-"+this._moderationId,Gi),this.on(Tl.STATE_CHANGE,(r,s)=>{D.debug("[".concat(this._moderationId,"] Moderation operation :").concat(AE[r]," ").concat(s||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(Tl.STATE_CHANGE,AE.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new Je((s,l)=>{this.on(Tl.CONNECTION_STATE_CHANGE,(h,p)=>{h===Mo.CONNECTED&&s()}),this.requestAP(t,r,n).then(h=>{this.connectWorker(h)}).catch(h=>{l(h)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),D.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===Mo.CONNECTED&&this.inspectImage()}async requestAP(t,n,r){const s=Y("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),l=await function(m,g,v,T){let{appId:C,areaCode:I,cname:U,sid:k,token:M,uid:F}=g;LE++;const B="moderation_plugin",ee={service_name:B,json_body:JSON.stringify({appId:C,areaCode:I,cname:U,command:"allocateEdge",requestId:LE,seq:LE,sid:k,appToken:M,ts:Date.now(),uid:F+""})};let ue,de,ae=m[0];return El(async()=>{ue=Date.now();const Te=await Rl(ae,{data:ee,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(de=Date.now()-ue,Te.code!==0){const tt=new ye(H.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Te.code,{retry:!0,responseTime:de});throw D.error(tt.toString()),tt}const Ae=JSON.parse(Te.json_body);if(Ae.code!==200){const tt=new ye(H.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ae.code,", reason: ").concat(Ae.reason),{code:Ae.code,responseTime:de});throw D.error(tt.toString()),tt}if(!Ae.servers||!Array.isArray(Ae.servers)||Ae.servers.length===0){const tt=new ye(H.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ae.code,responseTime:de});throw D.error(tt.toString()),tt}if(!Ae.servers.some(tt=>!!tt.wss)){const tt=new ye(H.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ae.code,responseTime:de});throw D.error(tt.toString()),tt}const We=Y("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ae.servers.map(tt=>{let{address:Ft,wss:xt}=tt;if(Ft&&xt)return"wss://".concat(Ft.replace(/\./g,"-"),".").concat(We,":").concat(xt,"/moderation")}).filter(tt=>!!tt),workerToken:Ae.workerToken,vid:Ae.vid,ticket:Ae.appTicket,responseTime:de}},(Te,Ae)=>(ft.apworkerEvent(k,{success:!0,sc:200,serviceName:B,responseDetail:JSON.stringify(Te.addressList),firstSuccess:Ae===0,responseTime:de,serverIp:m[Ae%m.length]}),!1),(Te,Ae)=>(ft.apworkerEvent(k,{success:!1,sc:Te.data&&Te.data.code||200,serviceName:B,responseTime:de,serverIp:m[Ae%m.length]}),!!(Te.code!==H.OPERATION_ABORTED&&Te.code!==H.UNEXPECTED_RESPONSE||Te.data&&Te.data.retry)&&(ae=m[(Ae+1)%m.length],!0)),T)}(s,t,n,r);this.emit(Tl.STATE_CHANGE,AE.AP_CONNECTED);const{addressList:h,ticket:p}=l;return this._ticket=p,h}async connectWorker(t){this.emit(Tl.STATE_CHANGE,AE.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(kt.CONNECTED,async()=>{this.emit(Tl.STATE_CHANGE,AE.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Mo.CONNECTED}),this._workerConnection.on(kt.CLOSED,()=>{this.connectionState=Mo.CLOSED}),this._workerConnection.on(kt.FAILED,()=>{this.connectionState=Mo.CLOSED}),this._workerConnection.on(kt.RECONNECTING,()=>{this.connectionState=this.connectionState===Mo.CONNECTED?Mo.RECONNECTING:Mo.CONNECTING}),this._workerConnection.on(kt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=A$(new Uint8Array(t.data));Y("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,D.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{ft.reportApiInvoke(this._connectInfo.sid||null,{name:Mi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Ei.TRACER}).onError(new ye(H.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},Y("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else D.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(kt.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this._workerConnection.on(kt.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=eo(this,Tl.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(Y("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(t,n);this._workerConnection.sendMessage(r,!0,!0)}else Y("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:r,cname:s,cid:l,vid:h,sid:p,uid:m}=n;const g=Date.now(),v=await t.getCurrentFrameImage("image/jpeg",this.quality),T=await dF(v,r,s),C=this._sequence+"-"+l+"-"+m+"-"+g+"-"+Bn(12,""),I={appId:r,cid:l,cname:s,deviceId:"",elapse:aL.intToLong(Number(g-this._moderationStartTime)),fileSize:v.buffer.byteLength,height:v.height,width:v.width,jpg:T,networkType:6,osType:7,requestId:C,sdkVersion:"4.23.3",sequence:this._sequence,sid:p,timestamp:M4(g),uid:m,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete I.callbackData;const U=w$(I);if(U.byteLength<this._workerMessageLengthLimit){if(Y("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const k=function(M){for(var F=1;F<arguments.length;F++){var B=arguments[F]!=null?arguments[F]:{};F%2?U4(Object(B),!0).forEach(function(ee){V(M,ee,B[ee])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(B)):U4(Object(B)).forEach(function(ee){Object.defineProperty(M,ee,Object.getOwnPropertyDescriptor(B,ee))})}return M}({},I);delete k.jpg,D.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(k))}return U}{const k=this.quality*this._qualityRatio;return this.quality=k,await this.generateRequestData(t,{appId:r,cname:s,cid:l,vid:h,sid:p,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Bs.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Mo.CLOSED,this.emit(Tl.STATE_CHANGE,AE.CLOSED)}}function j4(e){if(On(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new ye(H.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new ye(H.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const M$={name:"ImageModeration",create:function(e){let{config:t}=e;return j4(t),new aL(t)}};var V4,F4,B4,G4,H4,z4,W4,q4,K4,Y4,X4,J4,Q4,$4,Z4,e5,t5,n5,i5,r5,s5,a5,o5,c5,l5,d5,u5,h5,p5,f5,m5,_5,g5,E5,y5,v5,S5,T5,R5,b5,C5,et;function w5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function Lc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?w5(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}Wr.setLogger(D);let U$=(V4=Rt(),F4=Rt({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof yE))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),B4=Rt({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==EE.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),G4=Rt({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),H4=Rt({argsMap:(e,t,n)=>[t,n]}),z4=Rt({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:s}=n;return[r==null?void 0:r.uid,s]})}),W4=Rt({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),q4=Rt({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:s}=n;return{uid:r==null?void 0:r.uid,mediaType:s}})}),K4=Rt(),Y4=Rt(),X4=Rt(),J4=Rt(),Q4=Rt(),$4=Rt(),Z4=Rt(),e5=Rt(),t5=Rt(),n5=Rt(),i5=Rt(),r5=Rt(),s5=Rt(),a5=Rt(),o5=Rt(),c5=Rt({argsMap:(e,t)=>[t]}),l5=Rt(),d5=Rt(),u5=Rt(),h5=Rt(),p5=Rt(),f5=Rt(),m5=Rt(),_5=Rt(),g5=Rt({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),E5=Rt(),y5=Rt(),v5=Rt(),S5=Rt(),T5=Rt(),R5=Rt(),b5=Rt({reportResult:!0}),C5=Rt(),et=class extends ai{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),V(this,"store",void 0),V(this,"_uid",void 0),V(this,"_channelName",void 0),V(this,"_uintUid",void 0),V(this,"_users",[]),V(this,"_config",void 0),V(this,"_clientId",void 0),V(this,"_appId",void 0),V(this,"_sessionId",null),V(this,"_key",void 0),V(this,"_rtmConfig",{}),V(this,"_joinInfo",void 0),V(this,"_gateway",void 0),V(this,"_statsCollector",void 0),V(this,"_configDistribute",void 0),V(this,"_leaveMutex",void 0),V(this,"_publishMutex",void 0),V(this,"_renewTokenMutex",void 0),V(this,"_subscribeMutex",void 0),V(this,"_encryptionMode","none"),V(this,"_encryptionSecret",null),V(this,"_encryptionSalt",null),V(this,"_encryptDataStream",!1),V(this,"_encryptDataStreamKey",null),V(this,"_encryptDataStreamIv",null),V(this,"_proxyServer",void 0),V(this,"_turnServer",{servers:[],mode:"auto"}),V(this,"_cloudProxyServerMode","disabled"),V(this,"_isDualStreamEnabled",!1),V(this,"_defaultStreamFallbackType",void 0),V(this,"_lowStreamParameter",void 0),V(this,"_streamFallbackTypeCacheMap",new Map),V(this,"_remoteStreamTypeCacheMap",new Map),V(this,"_axiosCancelSource",Bs.CancelToken.source()),V(this,"_audioVolumeIndicationInterval",void 0),V(this,"_networkQualityInterval",void 0),V(this,"_userOfflineTimeout",void 0),V(this,"_streamRemovedTimeout",void 0),V(this,"_liveTranscodeStreamingClient",void 0),V(this,"_liveRawStreamingClient",void 0),V(this,"_channelMediaRelayClient",void 0),V(this,"_networkQualitySensitivity","normal"),V(this,"_p2pChannel",void 0),V(this,"_useLocalAccessPoint",!1),V(this,"_setLocalAPVersion",void 0),V(this,"_joinAndNotLeaveYet",!1),V(this,"_numberOfJoinCount",0),V(this,"_remoteDefaultVideoStreamType",void 0),V(this,"_inspect",void 0),V(this,"_moderation",void 0),V(this,"_license",void 0),V(this,"_pendingPublishedUsers",[]),V(this,"ntpAlignErrorCount",0),V(this,"remoteInboundOffset",0),V(this,"_peerConnectionState",void 0),V(this,"_handleLocalTrackEnable",(s,l,h)=>{this.publish(s,!1).then(l).catch(h)}),V(this,"_handleLocalTrackDisable",(s,l,h)=>{this.unpublish(s).then(l).catch(h)}),V(this,"_handleUserOnline",s=>{if(Y("BLOCK_LOCAL_CLIENT")&&Om(s.uid,this.channelName))return void D.debug("[".concat(s.uid,"] will be ignored in local"));this.isStringUID&&typeof s.uid!="string"&&D.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const l=this._users.find(h=>h.uid===s.uid);if(l)l._trust_in_room_=!0,l._is_pre_created&&(l._is_pre_created=!1,this.safeEmit(qt.USER_JOINED,l));else{const h=new yp(s.uid,s.uint_id||s.uid);this._users.push(h),D.debug("[".concat(this._clientId,"] user online"),s.uid),this.safeEmit(qt.USER_JOINED,h)}}),V(this,"_handleUserOffline",s=>{if(Y("BLOCK_LOCAL_CLIENT")&&Om(s.uid,this.channelName))return;const l=this._users.find(h=>h.uid===s.uid);l&&(this._handleRemoveStream(s),this._handleRemoveDataChannels(s),l._audio_pre_subscribed||l._video_pre_subscribed?l._is_pre_created=!0:Dw(this._users,l),this._remoteStreamTypeCacheMap.delete(l.uid),this._streamFallbackTypeCacheMap.delete(l.uid),D.debug("[".concat(this._clientId,"] user offline"),s.uid,"reason:",s.reason),this.safeEmit(qt.USER_LEAVED,l,s.reason))}),V(this,"_handleAddAudioOrVideoStream",(s,l,h,p,m,g,v)=>{if(Y("BLOCK_LOCAL_CLIENT")&&Om(l,this.channelName))return;const T=this._users.find(I=>I.uid===l);if(!T)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));D.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(s)),this.store.subscribe(T.uid,s,void 0,void 0,void 0,Date.now());const C=s==="audio"?T.hasAudio:T.hasVideo;T._uintid||(T._uintid=m||l),s==="audio"?T._trust_audio_stream_added_state_=!0:T._trust_video_stream_added_state_=!0,s==="audio"?(T._audio_added_=!0,h!==void 0&&(T._audioSSRC=h),p!==void 0&&(T._cname=p),g&&(T._audioOrtc=g)):(T._video_added_=!0,h!==void 0&&(T._videoSSRC=h),p!==void 0&&(T._cname=p),v!==void 0&&(T._rtxSsrcId=v),g&&(T._videoOrtc=g)),(s==="audio"?T.hasAudio:T.hasVideo)&&!C&&(D.info("[".concat(this._clientId,"] remote user ").concat(T.uid," published ").concat(s)),this.safeEmit(qt.USER_PUBLISHED,T,s)),s==="video"?ft.onGatewayStream(this._sessionId,rr.ON_ADD_VIDEO_STREAM,ii.ON_ADD_VIDEO_STREAM,{peer:m||l,ssrc:T._videoSSRC}):ft.onGatewayStream(this._sessionId,rr.ON_ADD_AUDIO_STREAM,ii.ON_ADD_AUDIO_STREAM,{peer:m||l,ssrc:T._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(T,s,h).then(I=>{if(I&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(T.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof mT))return this._p2pChannel.unsubscribe(T,s,!0).then(()=>this._subscribe(T,s,!0).catch(U=>{D.error("[".concat(this._clientId,"] resubscribe error"),U.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(T,s)&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(T.uid," after reconnect.")),this._subscribe(T,s,!0).catch(I=>{D.error("[".concat(this._clientId,"] resubscribe error"),I.toString())}))}),V(this,"_handleRemoveStream",s=>{if(Y("BLOCK_LOCAL_CLIENT")&&Om(s.uid,this.channelName))return;const l=this._users.find(p=>p.uid===s.uid);if(!l)return void D.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));D.debug("[".concat(this._clientId,"] stream removed with uid ").concat(s.uid));let h=()=>{};l.hasAudio&&l.hasVideo?h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(qt.USER_UNPUBLISHED,l,"audio"),D.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(qt.USER_UNPUBLISHED,l,"video")}:l.hasVideo?h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(qt.USER_UNPUBLISHED,l,"video")}:l.hasAudio&&(h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(qt.USER_UNPUBLISHED,l,"audio")}),l._video_pre_subscribed||l._audio_pre_subscribed||(l._trust_audio_stream_added_state_=!0,l._trust_video_stream_added_state_=!0,l._audio_added_=!1,l._video_added_=!1,this._p2pChannel instanceof mT&&this._p2pChannel.unsubscribe(l).then(p=>{if(p)return this._gateway.unsubscribe(p,l.uid)}),l._audioSSRC=void 0,l._videoSSRC=void 0,l._audioOrtc=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),ft.onGatewayStream(this._sessionId,rr.ON_REMOVE_STREAM,ii.ON_REMOVE_STREAM,{peer:s.uint_id||s.uid}),h()}),V(this,"_handleSetStreamLocalEnable",(s,l,h)=>{if(Y("BLOCK_LOCAL_CLIENT")&&Om(l,this.channelName))return;const p=this._users.find(v=>v.uid===l);if(!p)return void D.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));D.debug("[".concat(this._clientId,"] local ").concat(s," ").concat(h?"enabled":"disabled"," with uid ").concat(l));const m=s==="audio"?p.hasAudio:p.hasVideo;if(s==="audio"){p._trust_audio_enabled_state_=!0;const v=p._audio_enabled_;if(p._audio_enabled_=h,p._audio_enabled_===v)return;{const T=p._audio_enabled_?"enable-local-audio":"disable-local-audio";D.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(l,", msg: ").concat(T)),this.safeEmit(qt.USER_INFO_UPDATED,l,T)}}else{p._trust_video_enabled_state_=!0;const v=p._video_enabled_;if(p._video_enabled_=h,p._video_enabled_===v)return;{const T=p._video_enabled_?"enable-local-video":"disable-local-video";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(T)),this.safeEmit(qt.USER_INFO_UPDATED,l,T)}}const g=s==="audio"?p.hasAudio:p.hasVideo;return m!==g?!m&&g?(D.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(s)),void this.safeEmit(qt.USER_PUBLISHED,p,s)):(s==="video"&&p._videoTrack&&p._videoTrack._destroy(),s==="audio"&&p._audioTrack,this._p2pChannel.muteRemote(p,s),D.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(s)),void this.safeEmit(qt.USER_UNPUBLISHED,p,s)):void 0}),V(this,"_handleMuteStream",(s,l,h)=>{if(Y("BLOCK_LOCAL_CLIENT")&&Om(s,this.channelName))return;D.debug("[".concat(this._clientId,"] receive mute message"),s,l,h);const p=this._users.find(v=>v.uid===s);if(!p)return void D.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s));const m=l==="audio"?p.hasAudio:p.hasVideo;if(l==="audio"){p._trust_audio_mute_state_=!0;const v=p._audio_muted_;if(p._audio_muted_=h,p._audio_muted_===v)return;{const T=p._audio_muted_?"mute-audio":"unmute-audio";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(T)),this.safeEmit(qt.USER_INFO_UPDATED,s,T)}}else{p._trust_video_mute_state_=!0;const v=p._video_muted_;if(p._video_muted_=h,p._video_muted_===v)return;{const T=p._video_muted_?"mute-video":"unmute-video";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(T)),this.safeEmit(qt.USER_INFO_UPDATED,s,T)}}const g=l==="audio"?p.hasAudio:p.hasVideo;if(m!==g){if(!m&&g)return(l==="audio"?p._audioSSRC:p._videoSSRC)?(D.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(l)),void this.safeEmit(qt.USER_PUBLISHED,p,l)):void D.warning("[".concat(this._clientId,"] remote user ").concat(s," receive ").concat(l," unmute message  before add stream message, ").concat(l," SSRC doesn't exist yet."));l==="video"&&p._videoTrack&&!p._video_pre_subscribed&&p._videoTrack._destroy(),l==="audio"&&p._audioTrack,this._p2pChannel.muteRemote(p,l),D.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(l)),this.safeEmit(qt.USER_UNPUBLISHED,p,l)}}),V(this,"_handleP2PLost",async s=>{D.debug("[".concat(this._clientId,"] receive p2p lost"),s),parseInt(s.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():D.warning("[".concat(this._clientId,"] P2PLost stream not found"),s)}),V(this,"_handleTokenWillExpire",()=>{D.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(qt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),V(this,"_handleBeforeUnload",s=>{s.type==="beforeunload"&&s.returnValue!==void 0&&s.returnValue!==""||(this.leave(),D.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),V(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(qt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const s={downlinkNetworkQuality:0,uplinkNetworkQuality:0};s.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),s.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(qt.NETWORK_QUALITY,s)}),V(this,"_handleP2PAddAudioOrVideoStream",(s,l,h,p)=>{const m=this._users.find(v=>v.uid===l);if(!m)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));D.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(s)),this.store.subscribe(m.uid,s,void 0,void 0,void 0,Date.now());const g=s==="audio"?m.hasAudio:m.hasVideo;s==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,s==="audio"?(m._audio_added_=!0,h!==void 0&&(m._audioSSRC=h),p!==void 0&&(m._audioMid=p)):(m._video_added_=!0,h!==void 0&&(m._videoSSRC=h),p!==void 0&&(m._videoMid=p)),(s==="audio"?m.hasAudio:m.hasVideo)&&!g&&(D.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(s)),this.safeEmit(qt.USER_PUBLISHED,m,s)),this._p2pChannel.hasPendingRemoteMedia(m,s)&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,s,!0).catch(v=>{D.error("[".concat(this._clientId,"] resubscribe error"),v.toString())}))}),this._config=e,this._clientId=t||Bn(5,"client-"),this.store=new class{constructor(s,l,h,p){Ot(this,"state",void 0),this.state={codec:s,audioCodec:l,mode:h,clientId:p,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Rm.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(s){this.state=function(l,h){switch(h.type){case Jt.SET_SESSION_ID:return at(at({},l),{},{sessionId:h.sessionId});case Jt.SET_P2P_ID:return at(at({},l),{},{p2pId:h.p2pId});case Jt.SET_UID:return at(at({},l),{},{uid:h.uid});case Jt.SET_INT_UID:return at(at({},l),{},{intUid:h.intUid});case Jt.SET_PUB_ID:return at(at({},l),{},{pubId:h.pubId});case Jt.KEY_METRIC_CLIENT_CREATED:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{clientCreated:h.metric})});case Jt.KEY_METRIC_JOIN_START:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{joinStart:h.metric})});case Jt.KEY_METRIC_JOIN_END:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{joinEnd:h.metric})});case Jt.KEY_METRIC_REQUEST_AP_START:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{requestAPStart:h.metric})});case Jt.KEY_METRIC_REQUEST_AP_END:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{requestAPEnd:h.metric})});case Jt.KEY_METRIC_JOIN_GATEWAY_START:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{joinGatewayStart:h.metric})});case Jt.KEY_METRIC_JOIN_GATEWAY_END:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{joinGatewayEnd:h.metric})});case Jt.KEY_METRIC_PEER_CONNECTION_START:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{peerConnectionStart:h.metric})});case Jt.KEY_METRIC_PEER_CONNECTION_END:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{peerConnectionEnd:h.metric})});case Jt.KEY_METRIC_DESCRIPTION_START:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{descriptionStart:h.metric})});case Jt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{signalChannelOpen:h.metric})});case Jt.KEY_METRIC_ICE_CONNECTION_END:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{iceConnectionEnd:h.metric})});case Jt.KEY_METRIC_PUBLISH:{const p=l.keyMetrics.publish,m=p.findIndex(g=>g.trackId===h.metric.trackId);return m!==-1?(p[m]=at(at({},p[m]),h.metric),at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{publish:[...p]})})):at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{publish:[...l.keyMetrics.publish,h.metric]})})}case Jt.KEY_METRIC_SUBSCRIBE:{const p=l.keyMetrics.subscribe,m=p.findIndex(g=>g.userId===h.metric.userId&&g.type===h.metric.type);return m!==-1?(p[m]=at(at({},p[m]),h.metric),at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{subscribe:[...p]})})):at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{subscribe:[...l.keyMetrics.subscribe,h.metric]})})}case Jt.SET_CLOUD_PROXY_SERVER_MODE:return l.cloudProxyServerMode=h.mode,l;case Jt.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?l.joinChannelServiceRecords=[...l.joinChannelServiceRecords,h.record]:(l.joinChannelServiceRecords[h.index]=at(at({},l.joinChannelServiceRecords[h.index]),h.record),l.joinChannelServiceRecords=[...l.joinChannelServiceRecords]),l;case Jt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return l.joinChannelServiceRecords=[],l;case Jt.RESET_KEY_METRICS:return l.keyMetrics={publish:[],subscribe:[]},l;case Jt.SET_USE_P2P:return at(at({},l),{},{useP2P:h.val});case Jt.SET_TRANSPORT_TYPE:return at(at({},l),{},{p2pTransport:h.val});default:return l}}(this.state,s)}set sessionId(s){this.dispatch({type:Jt.SET_SESSION_ID,sessionId:s})}get sessionId(){return this.state.sessionId}set cid(s){this.state.cid=s}get cid(){return this.state.cid}set codec(s){this.state.codec=s}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(s){this.dispatch({type:Jt.SET_P2P_ID,p2pId:s})}get p2pId(){return this.state.p2pId}set dcId(s){this.dispatch({type:Jt.SET_DC_ID,dcId:s})}get dcId(){return this.state.dcId}set uid(s){this.dispatch({type:Jt.SET_UID,uid:s})}get uid(){return this.state.uid}set intUid(s){this.dispatch({type:Jt.SET_INT_UID,intUid:s})}get intUid(){return this.state.intUid}set pubId(s){this.dispatch({type:Jt.SET_PUB_ID,pubId:s})}get pubId(){return this.state.pubId}set cloudProxyServerMode(s){this.dispatch({type:Jt.SET_CLOUD_PROXY_SERVER_MODE,mode:s})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(s){this.dispatch({type:Jt.SET_USE_P2P,val:s})}get useP2P(){return this.state.useP2P}set p2pTransport(s){this.dispatch({type:Jt.SET_TRANSPORT_TYPE,val:s})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(s){this.state.hasStartJoinChannel=s}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(s){this.state.isABTestSuccess=s}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Jt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Jt.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Jt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Jt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Jt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Jt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Jt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Jt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Jt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Jt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Jt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Jt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(s,l,h,p){this.dispatch({type:Jt.KEY_METRIC_PUBLISH,metric:at(at({trackId:s,type:l},h&&{publishStart:h}),p&&{publishEnd:p})})}subscribe(s,l,h,p,m,g,v){this.dispatch({type:Jt.KEY_METRIC_SUBSCRIBE,metric:at(at(at(at(at({userId:s,type:l},h&&{subscribeStart:h}),p&&{subscribeEnd:p}),m&&{firstFrame:m}),g&&{streamAdded:g}),v&&{firstDecoded:v})})}massSubscribe(s,l,h,p){s.forEach(m=>{this.dispatch({type:Jt.KEY_METRIC_SUBSCRIBE,metric:at(at(at({userId:m.userId,type:m.type},l&&{subscribeStart:l}),h&&{subscribeEnd:h}),p&&{firstFrame:p})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(s,l){s.service==="gateway"&&Array.isArray(s.urls)&&(s.urls=s.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof l!="number"?(this.dispatch({type:Jt.RECORD_JOIN_CHANNEL_SERVICE,record:at(at({},s),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(l<0||l>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Jt.RECORD_JOIN_CHANNEL_SERVICE,record:s,index:l}),l)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Jt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Jt.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Wr("client-leave",this._clientId),this._publishMutex=new Wr("client-publish",this._clientId),this._renewTokenMutex=new Wr("client-renewtoken",this._clientId),this._subscribeMutex=new Wr("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),D.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Lo," build: ").concat(QD,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{UD(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(s){D.warning("[".concat(this._clientId,"] ").concat(s.toString()))}var r;this._statsCollector=new hT(this.store),this._statsCollector.onStatsException=(s,l,h)=>{D.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(s,", msg: ").concat(l,", uid: ").concat(h)),this.safeEmit(qt.EXCEPTION,{code:s,msg:l,uid:h})},this._statsCollector.onUploadPublishDuration=(s,l,h,p)=>{const m=this._users.find(g=>g.uid===s);m&&ft.peerPublishStatus(this._sessionId,{subscribeElapse:p,audioPublishDuration:l,videoPublishDuration:h,peer:m._uintid})},this._statsCollector.onVideoCodecChanged=s=>{if(Y("VIDEO_STANDARD_BITRATE_VERSION")&&(s==="av1"||s==="h265"||s==="h264")){const l=this.localTracks.find(h=>h instanceof Xn);l&&l._saveEncodeBitrateRatio!==1&&l.setSaveEncodeBitrateRatio(s==="h264"?Y("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new t$(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Gi,httpRetryConfig:e.httpRetryConfig||Gi,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new u$(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},Hu("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new mT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,s){let l=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];wn("JOIN_GATEWAY_USE_443PORT_ONLY",l),wn("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const p=this._gateway.signal.websocket;return p instanceof DP&&(p.use443PortOnly=l,p.tryDoubleDomain=h),async function(m,g,v){ww.get(m)||ww.set(m,[]),Aw.get(m)||Aw.set(m,g),yd.get(m)||yd.set(m,0);const T=ww.get(m),C=Aw.get(m);if(!T||!C)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(yd.get(m)===C){const F=GS();T.push(F),await F.promise}yd.set(m,yd.get(m)+1);for(var I=arguments.length,U=new Array(I>3?I-3:0),k=3;k<I;k++)U[k-3]=arguments[k];const M=await v(...U);return yd.set(m,yd.get(m)-1),yd.get(m)===C-1&&T.length>0&&(T[0].resolve(),T.shift()),yd.get(m)===0&&(ww.set(m,[]),Aw.set(m,0),yd.set(m,0)),M}("client.join",Y("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,s)}async join(e,t,n,r,s){const l=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const h=(kw||kw||(kw=(window.location.protocol.split(":")[0]||"").toUpperCase(),kw))==="HTTPS",p=bV()?window.isSecureContext:"Browser Not Support";(!bV()&&!h||!window.isSecureContext)&&D.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),ft.setAppId(e);try{if(!n&&n!==null)throw new ye(H.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Sr(n,"token",1,2047),Sr(e,"appid",1,2047),tA(t),r&&nA(r),s&&Sr(s,"optionalInfo",1,2047)}catch(k){throw ft.reportApiInvoke(Tm(),{name:Mi.JOIN,options:[e,t,n,r],states:{isHttps:h,isSecureContext:p},tag:Ei.TRACER}).onError(k),k}if(this._leaveMutex.isLocked&&(D.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),D.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const k=new ye(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw ft.reportApiInvoke(Tm(),{name:Mi.JOIN,options:[e,t,n,r],states:{isHttps:h,isSecureContext:p},tag:Ei.TRACER}).onError(k),k}this._gateway.state="CONNECTING";const m=await T4({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new ye(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const g=(m==null?void 0:m.sid)||Tm();D.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(l)),this._sessionId||(this._sessionId=g,this.store.sessionId=this._sessionId);const v=ft.reportApiInvoke(g,{id:this._clientId,name:Mi.JOIN,options:[e,t,n,r],states:{isHttps:h,isSecureContext:p},tag:Ei.TRACER}),T=Lc(Lc(Lc({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:s,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!m},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:Y("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(T.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(T.stringUid=r,this._uintUid?(T.uid=this._uintUid,this._uintUid=void 0):T.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(T.aesmode=this._encryptionMode,T.aespassword=await(async k=>{const M=function(ue){const de=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ae=new Uint8Array(new ArrayBuffer(de.length));for(let Te=0;Te<de.length;Te+=1)ae[Te]=de.charCodeAt(Te);return ae}(),F=await window.crypto.subtle.importKey("spki",M,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),B=xD(k),ee=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},F,B);return function(ue){let de="";for(let ae=0;ae<ue.length;ae+=1)de+=String.fromCharCode(ue[ae]);return window.btoa(de)}(new Uint8Array(ee))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ye(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(T.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const k=new TextEncoder,M=Y("USE_PURE_ENCRYPTION_MASTER_KEY")?k.encode(T.appId+this._encryptionSecret+this._encryptionSecret):k.encode(T.appId+T.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(F,B,ee){const ue=await window.crypto.subtle.importKey("raw",B,"PBKDF2",!1,["deriveBits","deriveKey"]),de=F==="aes-128-gcm2"?128:256,ae=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:kV,hash:"SHA-256",salt:ee},ue,de+OJ);return new Uint8Array(ae).subarray(de/8)}(this._encryptionMode,M,Sm(this._encryptionSalt)),this._encryptDataStreamKey=await async function(F,B,ee){const ue=await window.crypto.subtle.importKey("raw",B,"PBKDF2",!1,["deriveBits","deriveKey"]),de=F==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:kV,hash:"SHA-256",salt:ee},ue,{name:"AES-GCM",length:de},!0,["encrypt","decrypt"])}(this._encryptionMode,M,Sm(this._encryptionSalt))}else p?D.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):D.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,D.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:T.stringUid});const C=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&C===this._sessionId&&ft.joinChannelTimeout(this._sessionId,5)},5e3);try{var I;let k;const M=T.cloudProxyServer;if(Ye(I=["proxy3","proxy4","proxy5"]).call(I,M)){const de=Y("PROXY_SERVER_TYPE3");Array.isArray(de)?T.proxyServer=de[0]:T.proxyServer=de}if(ft.setProxyServer(T.proxyServer),D.setProxyServer(T.proxyServer),this.store.requestAPStart(),m){if(D.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(T.stringUid?", ".concat(T.stringUid," => ").concat(m.intUid):""," ")),T.stringUid&&!T.uid&&(T.uid=m.intUid),k={gatewayInfo:m.ap.gatewayInfo},Y("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&T.turnServer.mode==="auto")if(m.ap.proxyInfo.addresses.length===0)D.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const de=(await _3(m.ap.proxyInfo,m.ap.gatewayInfo.uid)).map(ae=>({turnServerURL:ae.address,tcpport:ae.tcpport||kr.tcpport,udpport:ae.udpport||kr.udpport,username:ae.username||kr.username,password:ae.password||kr.password,forceturn:!1,security:!0}));T.turnServer={mode:"manual",servers:de}}C4(m,T.stringUid)}else{if(T.stringUid&&!T.uid){let de;[de,k]=await Je.all([z3(T.stringUid,T,this._axiosCancelSource.token,this._config.httpRetryConfig||Gi,this.store),H3(T,this._axiosCancelSource.token,this._config.httpRetryConfig||Gi,!0,this.store)]),D.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(T.stringUid," => ").concat(de)),T.uid=de,k.gatewayInfo.uid=de,k.gatewayInfo.res.uid=de}else k=await H3(T,this._axiosCancelSource.token,this._config.httpRetryConfig||Gi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ye(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(T,this._axiosCancelSource.token),this._configDistribute.on(iT.UPDATE_BITRATE_LIMIT,de=>{this._p2pChannel.updateBitrateLimit(de)}),this._configDistribute.on(iT.UPDATE_CLIENT_ROLE_OPTIONS,de=>{this._setClientRoleOptions(de)})},0),this._key=n||e;const F=k.gatewayInfo,B=T.uid?T.uid:F.uid;this._joinInfo=Lc(Lc({},T),{},{cid:F.cid,uid:B,vid:F.vid,apResponse:F.res,apGatewayAddress:F.apGatewayAddress,uni_lbs_ip:F.uni_lbs_ip,gatewayAddrs:F.gatewayAddrs}),this.store.intUid=B,this.store.cid=F.cid;const ee=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ye(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));v.onSuccess(ee),this._appId=e,this._channelName=T.cname,this._uid=ee,this.store.uid=ee,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Dr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const ue=T.stringUid?"string uid: ".concat(T.stringUid,",uid: ").concat(T.uid):"uid: ".concat(this._uid);return D.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(ue)),setTimeout(()=>{D.startUpload()},5e3),this.store.joinEnd(),U=this,Ye(Nm).call(Nm,U)||Nm.push(U),this._cloudProxyServerMode==="disabled"&&cn().supportWebCrypto&&Y("ENABLE_PRELOAD")&&rL(this._joinInfo),ee}catch(k){const M=Array.isArray(k)?k[0]:k;throw M&&M.code===H.OPERATION_ABORTED?D.warning("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),M):D.error("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),M),M.code!==H.OPERATION_ABORTED&&this._numberOfJoinCount===l&&(this._gateway.state="DISCONNECTED",this._reset()),v.onError(M),M}var U}_joinGateway(){if(!this._joinInfo||!this._key)throw new ye(H.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!Y("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){D.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Dr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=Nm.indexOf(t);n!==-1&&Nm.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return D.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",En.LEAVE),D.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof yE))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new ye(H.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new ye(H.INVALID_OPERATION,"audience can not publish stream");for(const s of n){if(!(s instanceof yE))throw new ye(H.INVALID_PARAMS,"parameter is not local track");if(!s._enabled&&t)throw new ye(H.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(s.getTrackId()))}D.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(s=>"".concat(s.getTrackId()," "))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(s=>{const l=this._configDistribute.getBitrateLimit();s instanceof Xn&&l&&s.setBitrateLimit(l.uplink)});try{await this._publishHighStream(n),D.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(s=>"".concat(s.getTrackId()," "))))}catch(s){throw D.error("[".concat(this._clientId,"] publish error"),s.toString()),s}finally{r()}}async _publishDataChannel(e){On(e.id,"id",0,65535,!0),Uu(e.ordered,"ordered"),Sr(e.metadata,"metadata",0,512),D.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(s=>s.id===e.id)!==-1)throw new ye(H.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new ye(H.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Y("FORCE_TURN")&&!Y("TURN_ENABLE_TCP")&&!Y("TURN_ENABLE_UDP"))throw new ye(H.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(s){return k3(s,!1)}(e),r=await this._p2pChannel.publishDataChannel([n]);if(r.length>0){if(typeof n._originDataChannelId!="number")throw D.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new ye(H.CREATE_DATACHANNEL_ERROR);try{await Je.all(r.map(s=>this._uid&&this._gateway.publishDataChannel(this._uid,s,!0))),await n._waitTillOpen()}catch(s){if(s.code!==H.DISCONNECT_P2P)throw s}}return D.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw D.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new ye(H.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof yE))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);D.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(r=>"".concat(r.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage(Di.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),D.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(s=>"".concat(s.getTrackId()))))}}catch(r){throw D.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),D.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),D.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(n){throw D.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof yp)){const r=this.remoteUsers.find(s=>s.uid===e);if(!r)throw new ye(H.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(er(t,"mediaType",["audio","video"]),this.store.useP2P)throw new ye(H.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new ye(H.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===it.AUDIO,r=t===it.VIDEO,s=await this._subscribeMutex.lock();try{const{ssrcId:l,ortc:h,rtxSsrcId:p,cname:m,uint_id:g}=await this._gateway.presubscribe(e,t,!0);if(l==null)throw new ye(H.UNEXPECTED_RESPONSE,"no ssrc id");let v=this._users.find(C=>C.uid===e);v||(v=new yp(e,g||e),v._is_pre_created=!0,this._users.push(v)),m&&(v._cname=m),v._uintid||(v._uintid=g||e),n&&(v._audioSSRC=l,v._audio_pre_subscribed=!0,h&&(v._audioOrtc=h)),r&&(v._videoSSRC=l,v._video_pre_subscribed=!0,h&&(v._videoOrtc=h),p!=null&&(v._rtxSsrcId=p)),D.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(l)),await this._p2pChannel.subscribe(v,t,l,p,h);const T=n?v._audioTrack:v._videoTrack;if(!T)throw new ye(H.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(v._trust_audio_stream_added_state_=!0,v._audio_added_=!0),r&&(v._trust_video_stream_added_state_=!0,v._video_added_=!0),T}catch(l){throw D.error("[".concat(this._clientId,"] presub user ").concat(e," error"),l),l}finally{s()}}async _subscribeDataChannel(e,t){var n;if(On(t,"channelId",0,65535,!0),!this._joinInfo)throw new ye(H.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(p=>p===e))throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new ye(H.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new ye(H.INVALID_REMOTE_USER,"user is not published");const s=(n=e._dataChannels)===null||n===void 0?void 0:n.find(p=>p.id===t);if(!s)throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new ye(H.REMOTE_USER_IS_NOT_PUBLISHED);const l=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const p=await this._p2pChannel.subscribeDataChannel(e,[s]);if(p&&Ye(p).call(p,s.id))try{var h;if(typeof s._originDataChannelId!="number")throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new ye(H.CREATE_DATACHANNEL_ERROR);const m={id:s.id,datachannelId:s._originDataChannelId,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:(h=s.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,m,!0),await s._waitTillOpen()}catch(m){if((m==null?void 0:m.code)!==H.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[s]),m;await this._p2pChannel.unsubscribeDataChannel(e,[s]),this._p2pChannel.setPendingRemoteDataChannel(e,s.id)}return D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),s}finally{l()}}async _p2pSubscribe(e,t,n){if(er(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ye(H.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===e)){const l=new ye(H.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),l}if(!e.hasAudio&&!e.hasVideo){const l=new ye(H.INVALID_REMOTE_USER,"user is not published");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),l}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const l=new ye(H.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),l}const s=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const h=t==="audio"?e._audioSSRC:e._videoSSRC,p=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,h,p)}catch(h){throw h}D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{D.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const l=t==="audio"?e._audioTrack:e._videoTrack;if(!l)throw new ye(H.UNEXPECTED_ERROR,"can not find remote track in user object");return l}catch(l){throw D.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),l),l}finally{s()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(er(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ye(H.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(g=>g===e)){const g=new ye(H.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),g}if(!e.hasAudio&&!e.hasVideo){const g=new ye(H.INVALID_REMOTE_USER,"user is not published");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),g}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const g=new ye(H.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),g}let s=t==="audio"?e._audioSSRC:e._videoSSRC,l=t==="audio"?e._audioOrtc:e._videoOrtc,h=t==="video"?e._rtxSsrcId:void 0,p={stream_type:t==="audio"?it.AUDIO:it.VIDEO,ssrcId:s};const m=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const v=t==="audio"?e._audioSSRC:e._videoSSRC;v!==void 0&&v!==s&&(s=v,l=t==="audio"?e._audioOrtc:e._videoOrtc,h=t==="video"?e._rtxSsrcId:void 0,p={stream_type:t==="audio"?it.AUDIO:it.VIDEO,ssrcId:s}),Yr.markSubscribeStart(this.store.clientId,s),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,s,h,l);try{this._p2pChannel.isPreSubScribe(s)||await this._gateway.subscribe(e.uid,p,!0)}catch(T){if((T==null?void 0:T.code)!==H.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),T;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(v){throw this._p2pChannel.reportSubscribeEvent(!1,v==null?void 0:v.code,e,t),v}D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(v=>{D.warning("[".concat(this._clientId,"] auto set fallback failed"),v)});const g=t==="audio"?e._audioTrack:e._videoTrack;if(!g)throw new ye(H.UNEXPECTED_ERROR,"can not find remote track in user object");return g}catch(g){throw D.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),g),g}finally{m()}}async massSubscribe(e){if(ju(e,"subscribeList"),!this._joinInfo)throw new ye(H.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(p=>{let{user:m,mediaType:g}=p;return"user: ".concat(m==null?void 0:m.uid,", mediaType: ").concat(g)}).join("; ")));const s=(e=[...e]).map(p=>{let{user:m,mediaType:g}=p;return{user:m,mediaType:g}}),l=await this._p2pChannel.globalLock();try{var h;for(let m=e.length-1;m>=0;m--){const g=e[m],{user:v,mediaType:T}=g;if(er(T,"mediaType",["audio","video"]),!v){const k=new ye(H.INVALID_PARAMS,"user property does not exist in subscribeList item");throw D.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),k}if(!this._users.find(k=>k===v)){const k=new ye(H.INVALID_REMOTE_USER,"user is not in the channel");D.error("[".concat(this._clientId,"] can not massSubscribe ").concat(v.uid,", this user is not in the channel")),s[m].error=k,e.splice(m,1);continue}if(T==="audio"&&(!v.hasAudio||v._audioSSRC===void 0)||T==="video"&&(!v.hasVideo||v._videoSSRC===void 0)){const k=new ye(H.REMOTE_USER_IS_NOT_PUBLISHED);D.error("[".concat(this._clientId,"] can not subscribe ").concat(v.uid," with mediaType ").concat(T,", remote user is not published")),s[m].error=k,e.splice(m,1);continue}const I=sr.Video|sr.LwoVideo,U=n.get(v);if(U){if(T==="video"?U&I:U&sr.Audio){e.splice(m,1),D.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(v.uid,", mediaType:").concat(T," twice"));continue}n.set(v,U|(T==="video"?I:sr.Audio))}else n.set(v,T==="video"?I:sr.Audio)}for(let m=e.length-1;m>=0;m--){const g=e[m],{user:v,mediaType:T}=g,C=sr.Video|sr.LwoVideo;if(this._p2pChannel.hasRemoteMedia(v,T)){await this._p2pChannel.unmuteRemoteNoLock(v,T);const I=n.get(v);n.set(v,T==="video"?I^C:I^sr.Audio),e.splice(m,1)}}this.store.massSubscribe(e.map(m=>({userId:m.user.uid,type:m.mediaType})),t);let p=na(h=Array.from(n.entries())).call(h,(m,g)=>{let[v,T]=g;if(T===0)return m;const C={stream_id:v.uid,stream_type:T};return T&sr.Audio&&(C.audio_ssrc=v._audioSSRC),T&sr.Video&&(C.video_ssrc=v._videoSSRC),m.push(C),m},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(g=>{let{user:v,mediaType:T}=g;return{user:v,mediaType:T,ssrcId:T===it.VIDEO?v._videoSSRC:v._audioSSRC,rtxSsrcId:T===it.VIDEO?v._rtxSsrcId:void 0}}));const m=new Map;if(p=p.filter(g=>g.video_ssrc&&!this._p2pChannel.isPreSubScribe(g.video_ssrc)||g.audio_ssrc&&!this._p2pChannel.isPreSubScribe(g.audio_ssrc)||!g.video_ssrc&&!g.audio_ssrc),p.length>0){const g=await this._gateway.subscribeAll(p,!0);((g==null?void 0:g.users)||[]).forEach(v=>{let{stream_id:T,video_error_code:C,audio_error_code:I,error_code:U}=v;(C||I||U)&&m.set(T,{video_error_code:C,audio_error_code:I,error_code:U})})}if(Array.from(m.entries()).length>0){const g=[];Array.from(m.entries()).forEach(v=>{let[T,C]=v;const I=this.remoteUsers.find(U=>U.uid===T);if(I){let U;C.error_code||C.video_error_code&&C.audio_error_code?U=void 0:C.video_error_code?U=it.VIDEO:C.audio_error_code&&(U=it.AUDIO),g.push({user:I,mediaType:U})}}),g.length>0&&await this._p2pChannel.massUnsubscribeNoLock(g)}for(const g of s){const v=m.get(g.user.uid);if(v){const T=v.error_code||g.mediaType==="audio"&&v.audio_error_code||g.mediaType==="video"&&v.video_error_code;if(T){const C=rT(T);D.error("user:".concat(g.user.uid," mediaType:").concat(g.mediaType," has massSubscribe error ").concat(C.desc)),g.error=new ye(H.SUBSCRIBE_FAILED,"code ".concat(T,": ").concat(C.desc))}}g.error||(g.mediaType==="video"?g.track=g.user.videoTrack:g.track=g.user.audioTrack)}return this.store.massSubscribe(s.filter(g=>!g.error).map(g=>({userId:g.user.uid,type:g.mediaType})),void 0,Date.now()),s.forEach(g=>{var v;ft.subscribe(this.store.sessionId,{succ:!!g.error,ec:((v=g.error)===null||v===void 0?void 0:v.code)||null,video:g.mediaType===it.VIDEO,audio:g.mediaType===it.AUDIO,peerid:g.user.uid,subscribeRequestid:g.mediaType===it.VIDEO?g.user._videoSSRC:g.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(g.user._videoSSRC)},!0)}),D.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(g=>{let{user:v,mediaType:T}=g;return"user: ".concat(v==null?void 0:v.uid,", mediaType: ").concat(T)}).join("; "))),s}catch(m){throw await this._p2pChannel.massUnsubscribeNoLock(e),m}}finally{l(),r()}}async unsubscribe(e,t,n){if(!(e instanceof yp)){const l=this.remoteUsers.find(h=>h.uid===e);if(!l)throw new ye(H.INVALID_REMOTE_USER,"user is not in the channel");e=l}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&er(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ye(H.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(l=>l===e)){const l=new ye(H.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),l}D.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const s=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const l=await this._p2pChannel.unsubscribe(e,t);l&&await this._gateway.unsubscribe(l,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&Dw(this._users,e),D.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(l){if(l.code===H.DISCONNECT_P2P)return void D.warning("disconnecting p2p, abort unsubscribe request.");throw D.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),l.toString()),l}finally{s()}}async _unsubscribeDataChannel(e,t){if(t&&On(t,"id",0,65535,!0),!this._joinInfo)throw new ye(H.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(s=>s===e)){const s=new ye(H.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}let r;if(typeof t=="number"){const s=e._dataChannels.find(l=>l.id===t);s&&(r=[s])}else r=e._dataChannels;if(r===void 0){const s=new ye(H.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),s}D.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(s=>s.id)));try{const s=await this._p2pChannel.unsubscribeDataChannel(e,r);s&&await this._gateway.unsubscribeDataChannel(s,e.uid),D.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(s))}catch(s){if(s.code===H.DISCONNECT_P2P)return void D.warning("disconnecting p2p, abort unsubscribe request.");throw D.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}}async massUnsubscribe(e){if(ju(e,"unsubscribeList"),!this._joinInfo)throw new ye(H.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");D.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:r,mediaType:s}=n;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(s,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:s}=e[n];if(!r){const p=new ye(H.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw D.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),p}if(er(s,"mediaType",["video","audio",void 0]),!this._users.find(p=>p===r)){D.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const h=sr.Video|sr.LwoVideo;if(t.has(r)){const p=t.get(r);let m;switch(s){case"video":m=p&h;break;case"audio":m=p&sr.Audio;break;default:m=p&(sr.Audio|h)}if(m){D.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(s," twice.")),e.splice(n,1);continue}s?s==="audio"?t.set(r,p|sr.Audio):s==="video"&&t.set(r,p|h):t.set(r,p|sr.Audio|h)}else s?s==="audio"?t.set(r,sr.Audio):s==="video"&&t.set(r,h):t.set(r,sr.Audio|h)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),D.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:s,mediaType:l}=r;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(l,";")}).join()))}catch(n){if(n.code===H.DISCONNECT_P2P)return void D.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw D.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new Re(H.INVALID_PARAMS);gi(n.width)||LD(n.width,"streamParameter.width"),gi(n.height)||LD(n.height,"streamParameter.height"),gi(n.framerate)||LD(n.framerate,"streamParameter.framerate"),gi(n.bitrate)||On(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&D.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),D.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Le.LocalVideoLowTrack)}async enableDualStream(){if(!cn().supportDualStream)throw ft.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ye(H.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ye(H.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw ft.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,ft.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),D.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new ye(H.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Le.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw ft.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,ft.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),D.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(r){er(r,"role",["audience","host"])}(e),t&&UD(t),this.mode==="rtc"||this.mode==="p2p")throw D.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new ye(H.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new ye(H.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new ye(H.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&Y("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Pr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),D.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&UD(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{D.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Sr(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new ye(H.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ye(H.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,ft.setProxyServer(this._proxyServer),D.setProxyServer(this._proxyServer),D.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new ye(H.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ye(H.INVALID_OPERATION,"You have already set the proxy")}if(KS(e))return this._turnServer={servers:e,mode:"original-manual"},void D.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>hV(n)),this._turnServer={servers:e,mode:"manual"},D.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new ye(H.INVALID_OPERATION,"you should set license before join channel");if(Sr(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new ye(H.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,D.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new ye(H.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new ye(H.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new ye(H.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new ye(H.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,D.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new ye(H.INVALID_OPERATION,"Stop proxy server after leave channel");ft.setProxyServer(),D.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",D.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new ye(H.INVALID_PARAMS,"accessPoints is required.");ju(e.accessPoints.serverList,"accessPoints.serverList"),Sr(e.accessPoints.domain,"accessPoints.domain");const t=(C,I)=>{On(C,I,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ye(H.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");Y("CLOSE_AFB_FOR_LOCAL_AP")&&(wn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),wn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,s=e.accessPoints.domain,l=e.accessPoints.serverList.map(C=>r.test(C)?"".concat(C.replace(/\./g,"-"),".").concat(s):C),h=l.map(C=>"".concat(C,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,wn("WEBCS_DOMAIN",h),wn("WEBCS_DOMAIN_BACKUP_LIST",h),wn("GATEWAY_DOMAINS",[s]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(ju(e.report.hostname,"report.hostname"),wn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),wn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(wn("EVENT_REPORT_DOMAIN",l[0]),wn("EVENT_REPORT_BACKUP_DOMAIN",l[1]||l[0]));let p=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),p=e.report.port),wn("STATS_COLLECTOR_PORT",p),e.report?wn("ENABLE_EVENT_REPORT",!0):wn("ENABLE_EVENT_REPORT",!1);let m="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(ju(e.log.hostname,"log.hostname"),m=e.log.hostname[0]):m=l[0];let g=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),g=e.log.port),wn("LOG_UPLOAD_SERVER","".concat(m,":").concat(g));let v=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(ju(e.cds.hostname,"cds.hostname"),v=e.cds.hostname):v=l;let T=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),T=e.cds.port),wn("CDS_AP",v.map(C=>"".concat(C,":").concat(T))),e.cds?wn("ENABLE_CONFIG_DISTRIBUTE",!0):wn("ENABLE_CONFIG_DISTRIBUTE",!1),D.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(ju(e,"serverList"),Sr(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ye(H.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,wn("WEBCS_DOMAIN",e),wn("WEBCS_DOMAIN_BACKUP_LIST",e),wn("GATEWAY_DOMAINS",[t]),wn("EVENT_REPORT_DOMAIN",e[0]),wn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),wn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),D.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(er(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw D.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else D.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){er(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(r=>r.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw D.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}D.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){er(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw D.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}D.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){(function(l){er(l,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Sr(t,"secret");const s=["aes-128-gcm2","aes-256-gcm2"];if(Ye(s).call(s,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new ye(H.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new ye(H.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(Uu(r,"encryptDataStream"),!Ye(s).call(s,e))throw new ye(H.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||D.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=up(n))}async renewToken(e){if(Sr(e,"token",1,2047),!this._key||!this._joinInfo)throw new ye(H.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(Y("USE_NEW_TOKEN")){D.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await d$(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Gi);D.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else D.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});D.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,D.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?D.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(qt.VOLUME_INDICATOR,e)},Y("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new ye(H.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ye(H.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new ye(H.LIVE_STREAMING_TASK_CONFLICT);const n=t?Fu.TRANSCODE:Fu.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(Fu.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new ye(H.INVALID_PARAMS,"can not find live streaming url to stop");await Je.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){Q3(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){Q3(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof mT&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new ye(H.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const s=new TextEncoder;e.payload=s.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ye(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(s,l,h){var p;const m=na(p=Array.from(h)).call(p,(k,M)=>k+M,0),g={serverTs:0,seq:DJ++,length:h.length,checkSum:m},v=new Uint8Array(vV(m,2)),T=new ArrayBuffer(hE),C=new DataView(T);C.setUint32(0,g.serverTs),C.setUint16(4,g.seq),C.setUint16(6,g.length),C.setUint16(8,g.checkSum);const I=16-h.length%16;h=mV(h,new Uint8Array(I));const U=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s,tagLength:LV,additionalData:v},l,h);return mV(new Uint8Array(T),new Uint8Array(U))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new ye(H.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Ct.DATA_STREAM,{payload:up(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-y$},!n)}sendMetadata(e){if(!this._joinInfo)throw new ye(H.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new ye(H.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ct.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:up(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(FJ),!this._joinInfo)throw new ye(H.INVALID_OPERATION,"can not send custom report, not joined");await ft.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){er(t.spatialLayer,"spatialLayer",[0,1,2,3]),er(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw D.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(Uu(t,"apRTM"),On(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,D.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(D.debug("[".concat(this._clientId,"] reset client")),function(e){const t=CE.indexOf(e);t!==-1&&CE.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Bs.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&b4(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&ft.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Wr("client-publish",this._clientId),this._subscribeMutex=new Wr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const r=e||Tm();e?D.debug("[".concat(this._clientId,"] new Session ").concat(r)):D.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const s=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,ft.addSid(r);const l={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:s,clientRole:this.role==="audience"?2:1};ft.sessionInit(this._sessionId,Lc({cname:t.channel,appid:t.appId},l)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new ye(H.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Y("FORCE_TURN")&&!Y("TURN_ENABLE_TCP")&&!Y("TURN_ENABLE_UDP"))throw new ye(H.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");D.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const r=(await n.next()).value;if(r){try{await this._gateway.sendExtensionMessage(Di.PUBLISH,r,!0)}catch(s){throw n.throw(s),s}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let s;try{s=await this._gateway.publish(this._uid,r,!0)}catch(l){if(l.code!==H.DISCONNECT_P2P)throw n.throw(l),l}await n.next(((t=s)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const s of e)s instanceof Xn&&s._encoderConfig&&this._gateway.setVideoProfile(s._encoderConfig).catch(l=>{D.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!s.muted&&s.enabled||await this._p2pChannel.muteLocalTrack(s)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===H.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new ye(H.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ye(H.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));D.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let s;try{s=await this._gateway.publish(this._uid,r,!0)}catch(l){if(l.code!==H.DISCONNECT_P2P)throw n.throw(l),l}n.next(((t=s)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===H.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new ye(H.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Hu("LiveStreaming").create(r));var r;return n.onLiveStreamError=(s,l)=>{ft.reportApiInvoke(this._sessionId,{name:Mi.ON_LIVE_STREAM_ERROR,options:[s,l],tag:Ei.TRACER}).onSuccess(),this.safeEmit(qt.LIVE_STREAMING_ERROR,s,l)},n.onLiveStreamWarning=(s,l)=>{ft.reportApiInvoke(this._sessionId,{name:Mi.ON_LIVE_STREAM_WARNING,options:[s,l],tag:Ei.TRACER}).onSuccess(),this.safeEmit(qt.LIVE_STREAMING_WARNING,s,l)},n.on(IP.REQUEST_WORKER_MANAGER_LIST,(s,l,h)=>{if(!this._joinInfo)return h(new ye(H.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(p,m,g,v){const T=Y("UAP_AP").slice(0,Y("AJAX_REQUEST_CONCURRENT")).map(C=>m.proxyServer?"https://".concat(m.proxyServer,"/ap/?url=").concat(C+"/api/v1?action=uap"):"https://".concat(C,"/api/v1?action=uap"));return await r$(T,p,m,g,v)})(s,this._joinInfo,this._axiosCancelSource.token,Gi).then(l).catch(h)}),n};return e===Fu.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ye(H.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},Hu("ChannelMediaRelay").create(e));r.on("state",s=>{s===la.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(qt.CHANNEL_MEDIA_RELAY_STATE,s)}),r.on("event",s=>{this.safeEmit(qt.CHANNEL_MEDIA_RELAY_EVENT,s)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(s,l)=>{var h;s==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(l))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,s=[];if(t){const l=[];this._users.forEach(h=>{h._dataChannels.forEach(p=>{n.every(m=>m.uid!==h._uintid||m.stream_id!==p.id)&&l.push({uid:h._uintid,stream_id:p.id,ordered:p.ordered,max_retrans_times:p.maxRetransmits,metadata:p.metadata})})}),l.length>0&&this._handleUpdateDataChannel({added:[],deleted:l})}Array.isArray(n)&&n.length>0&&n.forEach(l=>{const{uid:h,stream_id:p,ordered:m,max_retrans_times:g,metadata:v}=l,T=this._users.find(C=>C._uintid===h);if(!T)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(D.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),Ye(s).call(s,T)||s.push(T),T._uintid||(T._uintid=h),T._dataChannels.findIndex(C=>C.id===l.stream_id)===-1){const C={id:p,ordered:!!m,maxRetransmits:g,metadata:v},I=function(U){return k3(U,!0)}(C);T._dataChannels.push(I),D.info("[".concat(this._clientId,"] remote user ").concat(T.uid," published datachannel")),t||this.safeEmit(qt.USER_PUBLISHED,T,"datachannel",C)}this._p2pChannel.hasPendingRemoteDataChannel(T,l.stream_id)&&(D.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(T.uid," after reconnect.")),this._subscribeDataChannel(T,l.stream_id).catch(C=>{D.error("[".concat(this._clientId,"] resubscribe datachannel error"),C.toString())}))}),t&&(this.safeEmit(qt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(l=>{const{uid:h,stream_id:p}=l,m=this._users.find(v=>v._uintid===h);if(!m)return void D.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const g=m._dataChannels.find(v=>v.id===l.stream_id);g&&(D.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(m,[g]).then(v=>{if(m._dataChannels=m._dataChannels.filter(T=>T!==g),v)return this._gateway.unsubscribeDataChannel(v,m.uid)}),D.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(g.id)),this.safeEmit(qt.USER_UNPUBLISHED,m,"datachannel",g._config))})}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){D.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(r=>{this.safeEmit(qt.USER_UNPUBLISHED,t,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)}),n()}}else D.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(hr.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void D.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(r=>{const{value:s,type:l,expires:h}=t[r];h&&h<=n||l||SP()||!Object.prototype.hasOwnProperty.call(Uw,r)||(yl[r]=s,Zn[r]=s,D.debug("Update gateway parameters from config distribute",r,s))})}catch(t){D.error("Error update config from local cache",t.message)}})()}),this._gateway.on(hr.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(hr.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r;if(n===En.FALLBACK)return;const s=()=>{this.safeEmit(qt.CONNECTION_STATE_CHANGE,e,t,n)};if(ft.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:Mi.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Ei.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),D.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void s();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var l;this._streamFallbackTypeCacheMap.forEach((h,p)=>{this._gateway.setStreamFallbackOption(p,h).catch(m=>{D.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),m)})}),this._remoteStreamTypeCacheMap.forEach((h,p)=>{this._gateway.setRemoteVideoStreamType(p,h).catch(m=>{D.warning("[".concat(this._clientId,"] auto set remote stream type failed"),m)})}),this._remoteDefaultVideoStreamType!==void 0&&((l=this._joinInfo)===null||l===void 0?void 0:l.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{D.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{D.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{D.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(D.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,it.AUDIO,!1)),h._trust_video_mute_state_||(D.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,it.VIDEO,!1)),h._trust_audio_enabled_state_||(D.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(D.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(D.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(D.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(D.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}s()}),this._gateway.on(hr.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new ye(H.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const r=await T4(Lc(Lc({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(n=r.ap,C4(r),this._joinInfo.preload=!0):(n=await WP(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Gi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const s=[];n.gatewayInfo.gatewayAddrs.forEach(l=>{let{address:h}=l;const[p,m]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?s.push({proxy:this._joinInfo.proxyServer,host:p,port:m}):s.push({host:p,port:m})}),e(s)}catch(n){t(n)}}),this._gateway.on(hr.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(qt.NETWORK_QUALITY,e)}),this._gateway.on(hr.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(qt.STREAM_TYPE_CHANGED,e,t),ft.reportApiInvoke(this._sessionId,{name:Mi.STREAM_TYPE_CHANGE,options:[e,t],tag:Ei.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(hr.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(hr.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let r=await this._p2pChannel.getEstablishParams();Y("ENABLE_PREALLOC_PC")&&r||(r=await this._p2pChannel.startP2PConnection(e)),t(r)}catch(r){n(r)}}),this._gateway.on(hr.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;e.attributes?n=e.attributes.userAttributes.preSubSsrcs:D.debug("no attributes in joinResponse");const r=T3(e.ortc,t,n);this._p2pChannel.connect(r)}),this._gateway.on(hr.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:n}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var r;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:s,cid:l}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(l,"_").concat(s),icePwd:"".concat(l,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(r=Y("FINGERPRINT"))!==null&&r!==void 0?r:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Yt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Yt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Yt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(Yt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Yt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Yt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Yt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Yt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Yt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,it.AUDIO,!0)),this._gateway.signal.on(Yt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,it.AUDIO,!1)),this._gateway.signal.on(Yt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,it.VIDEO,!0)),this._gateway.signal.on(Yt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,it.VIDEO,!1)),this._gateway.signal.on(Yt.RECEIVE_METADATA,e=>{const t=Sm(e.metadata);this.safeEmit(qt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Yt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=Sm(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ye(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<hE)throw new ye(H.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(hE));n=await async function(l,h,p){const m=p.subarray(0,hE),g=m.slice(8,hE),v=(g[0]<<8)+g[1],T=(m[6]<<8)+m[7],C=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:l,tagLength:LV,additionalData:new Uint8Array(vV(v,2))},h,p.subarray(hE));return new Uint8Array(C).subarray(0,T)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(e.ordered||e.syncWithAudio){const s=this._p2pChannel.getStats(),l=this.remoteUsers.find(p=>p.uid===e.uid),h=s==null?void 0:s.audioRecv.find(p=>p.ssrc===(l==null?void 0:l._audioSSRC));r=h==null?void 0:h.jitterBufferMs}(r==null||Number.isNaN(r))&&(r=0),S$(Lc(Lc({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Yt.ON_CRYPT_ERROR,()=>{dp(()=>{D.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(qt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Yt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{D.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,En.TOKEN_EXPIRE),this.safeEmit(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Yt.ON_STREAM_FALLBACK_UPDATE,e=>{D.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(qt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Yt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),D.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Yt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Yt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(At.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Ct.PUBLISH:{if(!t)return;const s=t.ortc;if(s){var n,r;const l=s.some(m=>{let{stream_type:g}=m;return g===Sn.Audio}),h=s.some(m=>{let{stream_type:g}=m;return g!==Sn.Audio}),p=s.some(m=>{let{stream_type:g}=m;return g===Sn.Screen||g===Sn.ScreenLow});t.state==="offer"&&ft.publish(this._joinInfo.sid,{eventElapse:Yr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:H.TIMEOUT,audio:l,video:h,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:p,audioName:l?(n=s.find(m=>{let{stream_type:g}=m;return g===Sn.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:h?(r=s.find(m=>{let{stream_type:g}=m;return g!==Sn.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case Ct.SUBSCRIBE:t&&ft.subscribe(this._joinInfo.sid,{succ:!1,ec:H.TIMEOUT,audio:t.stream_type===it.AUDIO,video:t.stream_type===it.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Yr.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(Yt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Yt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;Y("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!Om(r.string_id||r.stream_id,this.channelName)));const t=[],n=[];for(const r of e.users){let s=this._users.find(v=>v._uintid===r.stream_id);s?s._trust_in_room_=!0:(s=new yp(r.string_id||r.stream_id,r.stream_id),this._users.push(s),this.getListeners(qt.PUBLISHED_USER_LIST).length===0&&(D.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(qt.USER_JOINED,s)));const l=sr.Audio&r.stream_type,h=(sr.Video|sr.LwoVideo)&r.stream_type,p=(65280&r.stream_type)!=0,m=l&&s.hasAudio,g=h&&s.hasVideo;h&&(s._trust_video_stream_added_state_=!0,s._video_added_=!0,s._videoSSRC=r.video_ssrc,s._rtxSsrcId=r.video_rtx),l&&(s._trust_audio_stream_added_state_=!0,s._audio_added_=!0,s._audioSSRC=r.audio_ssrc),l&&!m&&this.getListeners(qt.PUBLISHED_USER_LIST).length===0&&(D.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published audio")),this.safeEmit(qt.USER_PUBLISHED,s,"audio")),h&&!g&&this.getListeners(qt.PUBLISHED_USER_LIST).length===0&&(D.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published video")),this.safeEmit(qt.USER_PUBLISHED,s,"video")),(l&&!m||h&&!g||p)&&t.push(s),h&&this._p2pChannel.hasPendingRemoteMedia(s,"video")&&n.push({user:s,mediaType:"video"}),l&&this._p2pChannel.hasPendingRemoteMedia(s,"audio")&&n.push({user:s,mediaType:"audio"})}n.length>0&&(D.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(r=>{D.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(qt.PUBLISHED_USER_LIST).length>0?Y("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(D.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(qt.PUBLISHED_USER_LIST,t)):D.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(Yt.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof mT&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var r;return Ye(r=Object.keys(jw)).call(r,n)}))})}_handleP2PEvents(){this._gateway.signal.on(Yt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Di.PUBLISH,(e,t,n)=>{const{uid:r}=e;e.forEach(s=>{const{kind:l,ssrcs:h,mid:p,isMuted:m}=s;this._handleP2PAddAudioOrVideoStream(l,r,h[0].ssrcId,p);const g=this._users.find(v=>v.uid===r);return g&&this.store.useP2P?this._p2pChannel.mockSubscribe(g,l,h[0].ssrcId,p).then(()=>{t()}).catch(n):t(),this._handleMuteStream(r,l,!!m)})}),this._gateway.signal.on(Di.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(s){n(s)}}),this._gateway.signal.on(At.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Di.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:r,uid:s}=e,l=this._users.find(h=>h.uid===s);if(!l)return D.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s)),void t();try{r.forEach(async h=>{let{stream_type:p}=h;const m=p===Sn.Audio?it.AUDIO:it.VIDEO;await this._p2pChannel.unsubscribe(l,m),this._handleMuteStream(s,m,!0)}),t()}catch(h){n(h)}}}),this._gateway.signal.on(Di.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case fp.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,it.VIDEO,!0);break;case fp.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,it.AUDIO,!0);break;case fp.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,it.VIDEO,!1);break;case fp.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,it.AUDIO,!1)}}),this._gateway.signal.on(Di.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:r,iceParameter:s}=e;r!==Os.SEND_ONLY||s?t(await this._p2pChannel.restartICE(r,s)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){n(r)}}),this._gateway.signal.on(Di.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(_t.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:r}=e;t(await this._gateway.sendExtensionMessage(Di.RESTART_ICE,e,r===Os.SEND_ONLY))}catch(r){n(r)}}),this._p2pChannel.on(_t.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Di.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(_t.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Di.CONTROL,e,!0),t()}catch(r){n(r)}}),this._p2pChannel.on(_t.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===H.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(_t.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===H.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(_t.StateChange,(e,t)=>{t===yn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(_t.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(qt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(_t.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===H.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(_t.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===H.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(_t.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(_t.RequestRePublishDataChannel,(e,t,n)=>{Je.all(e.map(async r=>{const s=await this._p2pChannel.publishDataChannel([r]);try{s.forEach(l=>{this._uid&&this._gateway.publishDataChannel(this._uid,l,!0)})}catch(l){if(l.code!==H.DISCONNECT_P2P)throw l}})).then(t).catch(n)}),this._p2pChannel.on(_t.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:r,kind:s}of e)s===it.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){n(r)}}),this._p2pChannel.on(_t.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(_t.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(_t.MediaReconnectStart,e=>{this.safeEmit(qt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(_t.MediaReconnectEnd,e=>{this.safeEmit(qt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(_t.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(_t.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let s;try{s=await this._gateway.restartICE({iceParameters:r})}catch(h){return void t.throw(h)}const{iceParameters:l}=function(h){const p=h.iceParameters;return{iceParameters:{iceUfrag:p.iceUfrag,icePwd:p.icePwd}}}(s);await t.next({remoteIceParameters:l})}),this._p2pChannel.on(_t.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(_t.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:s,gatewayAddress:l}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),h=T3(s,l);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(_t.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(_t.P2PLost,()=>{this.safeEmit(qt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(_t.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(_t.ConnectionTypeChange,e=>{this.safeEmit(qt.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(_t.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(_t.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(_t.AudioMetadata,e=>{this.safeEmit(qt.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new ye(H.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new ye(H.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},Hu("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:s,sid:l,token:h,uid:p,cid:m,vid:g}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:s,sid:l,token:h,uid:p,cid:m,vid:g?Number(g):0},Gi)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(pr.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(qt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Ic.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(qt.CONTENT_INSPECT_ERROR,new ye(H.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(pr.INSPECT_RESULT,(t,n)=>{var r;if((n==null?void 0:n.code)===H.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return D.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(qt.CONTENT_INSPECT_RESULT,t,n)}),e.on(pr.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new ye(H.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Uu(e,"enabled"),e){if(!t)throw new ye(H.INVALID_PARAMS,"config is required");if(j4(t),!this._joinInfo)throw new ye(H.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const r=(n={config:t},Hu("ImageModeration").create(n));this._moderation=r,this.handleImageModerationEvents(r);const{appId:s,cname:l,sid:h,token:p,uid:m,cid:g,vid:v}=this._joinInfo;await r.init({appId:s,areaCode:"",cname:l,sid:h,token:p,uid:m,cid:g,vid:v?Number(v):0},Gi)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var n;if(!this._moderation)throw new ye(H.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(e){e.on(Tl.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(qt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===Mo.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new ye(H.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Tl.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){er(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new ye(H.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,D.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return D.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Uu(e,"enabled"),wn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},ut(et.prototype,"leave",[V4],Object.getOwnPropertyDescriptor(et.prototype,"leave"),et.prototype),ut(et.prototype,"publish",[F4],Object.getOwnPropertyDescriptor(et.prototype,"publish"),et.prototype),ut(et.prototype,"unpublish",[B4],Object.getOwnPropertyDescriptor(et.prototype,"unpublish"),et.prototype),ut(et.prototype,"subscribe",[G4],Object.getOwnPropertyDescriptor(et.prototype,"subscribe"),et.prototype),ut(et.prototype,"presubscribe",[H4],Object.getOwnPropertyDescriptor(et.prototype,"presubscribe"),et.prototype),ut(et.prototype,"massSubscribe",[z4],Object.getOwnPropertyDescriptor(et.prototype,"massSubscribe"),et.prototype),ut(et.prototype,"unsubscribe",[W4],Object.getOwnPropertyDescriptor(et.prototype,"unsubscribe"),et.prototype),ut(et.prototype,"massUnsubscribe",[q4],Object.getOwnPropertyDescriptor(et.prototype,"massUnsubscribe"),et.prototype),ut(et.prototype,"setLowStreamParameter",[K4],Object.getOwnPropertyDescriptor(et.prototype,"setLowStreamParameter"),et.prototype),ut(et.prototype,"enableDualStream",[Y4],Object.getOwnPropertyDescriptor(et.prototype,"enableDualStream"),et.prototype),ut(et.prototype,"disableDualStream",[X4],Object.getOwnPropertyDescriptor(et.prototype,"disableDualStream"),et.prototype),ut(et.prototype,"setClientRole",[J4],Object.getOwnPropertyDescriptor(et.prototype,"setClientRole"),et.prototype),ut(et.prototype,"_setClientRoleOptions",[Q4],Object.getOwnPropertyDescriptor(et.prototype,"_setClientRoleOptions"),et.prototype),ut(et.prototype,"setProxyServer",[$4],Object.getOwnPropertyDescriptor(et.prototype,"setProxyServer"),et.prototype),ut(et.prototype,"setTurnServer",[Z4],Object.getOwnPropertyDescriptor(et.prototype,"setTurnServer"),et.prototype),ut(et.prototype,"setLicense",[e5],Object.getOwnPropertyDescriptor(et.prototype,"setLicense"),et.prototype),ut(et.prototype,"startProxyServer",[t5],Object.getOwnPropertyDescriptor(et.prototype,"startProxyServer"),et.prototype),ut(et.prototype,"stopProxyServer",[n5],Object.getOwnPropertyDescriptor(et.prototype,"stopProxyServer"),et.prototype),ut(et.prototype,"setLocalAccessPointsV2",[i5],Object.getOwnPropertyDescriptor(et.prototype,"setLocalAccessPointsV2"),et.prototype),ut(et.prototype,"setLocalAccessPoints",[r5],Object.getOwnPropertyDescriptor(et.prototype,"setLocalAccessPoints"),et.prototype),ut(et.prototype,"setRemoteDefaultVideoStreamType",[s5],Object.getOwnPropertyDescriptor(et.prototype,"setRemoteDefaultVideoStreamType"),et.prototype),ut(et.prototype,"setRemoteVideoStreamType",[a5],Object.getOwnPropertyDescriptor(et.prototype,"setRemoteVideoStreamType"),et.prototype),ut(et.prototype,"setStreamFallbackOption",[o5],Object.getOwnPropertyDescriptor(et.prototype,"setStreamFallbackOption"),et.prototype),ut(et.prototype,"setEncryptionConfig",[c5],Object.getOwnPropertyDescriptor(et.prototype,"setEncryptionConfig"),et.prototype),ut(et.prototype,"renewToken",[l5],Object.getOwnPropertyDescriptor(et.prototype,"renewToken"),et.prototype),ut(et.prototype,"enableAudioVolumeIndicator",[d5],Object.getOwnPropertyDescriptor(et.prototype,"enableAudioVolumeIndicator"),et.prototype),ut(et.prototype,"startLiveStreaming",[u5],Object.getOwnPropertyDescriptor(et.prototype,"startLiveStreaming"),et.prototype),ut(et.prototype,"setLiveTranscoding",[h5],Object.getOwnPropertyDescriptor(et.prototype,"setLiveTranscoding"),et.prototype),ut(et.prototype,"stopLiveStreaming",[p5],Object.getOwnPropertyDescriptor(et.prototype,"stopLiveStreaming"),et.prototype),ut(et.prototype,"startChannelMediaRelay",[f5],Object.getOwnPropertyDescriptor(et.prototype,"startChannelMediaRelay"),et.prototype),ut(et.prototype,"updateChannelMediaRelay",[m5],Object.getOwnPropertyDescriptor(et.prototype,"updateChannelMediaRelay"),et.prototype),ut(et.prototype,"stopChannelMediaRelay",[_5],Object.getOwnPropertyDescriptor(et.prototype,"stopChannelMediaRelay"),et.prototype),ut(et.prototype,"sendCustomReportMessage",[g5],Object.getOwnPropertyDescriptor(et.prototype,"sendCustomReportMessage"),et.prototype),ut(et.prototype,"pickSVCLayer",[E5],Object.getOwnPropertyDescriptor(et.prototype,"pickSVCLayer"),et.prototype),ut(et.prototype,"setRTMConfig",[y5],Object.getOwnPropertyDescriptor(et.prototype,"setRTMConfig"),et.prototype),ut(et.prototype,"enableContentInspect",[v5],Object.getOwnPropertyDescriptor(et.prototype,"enableContentInspect"),et.prototype),ut(et.prototype,"disableContentInspect",[S5],Object.getOwnPropertyDescriptor(et.prototype,"disableContentInspect"),et.prototype),ut(et.prototype,"setImageModeration",[T5],Object.getOwnPropertyDescriptor(et.prototype,"setImageModeration"),et.prototype),ut(et.prototype,"setP2PTransport",[R5],Object.getOwnPropertyDescriptor(et.prototype,"setP2PTransport"),et.prototype),ut(et.prototype,"getJoinChannelServiceRecords",[b5],Object.getOwnPropertyDescriptor(et.prototype,"getJoinChannelServiceRecords"),et.prototype),ut(et.prototype,"setPublishAudioFilterEnabled",[C5],Object.getOwnPropertyDescriptor(et.prototype,"setPublishAudioFilterEnabled"),et.prototype),et);class ET{constructor(t,n){V(this,"id",0),V(this,"element",void 0),V(this,"peerPair",void 0),V(this,"context",void 0),V(this,"audioPlayerElement",void 0),V(this,"audioTrack",void 0),ET.count+=1,this.id=ET.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(r,s)=>{const l=s==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(l),r.iceGatheringState==="complete"?r.localDescription:new Je(h=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&h(r.localDescription)}})},n=async(r,s)=>await r.setRemoteDescription(s);try{const r=await t(this.peerPair[0],"offer");await n(this.peerPair[1],r);const s=await t(this.peerPair[1],"answer");await n(this.peerPair[0],s)}catch(r){throw new ye(H.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(s){throw new ye(H.LOCAL_AEC_ERROR,s.toString()).print()}if(!n)throw new ye(H.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){D.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var A5,IA;V(ET,"count",0);const j$=window.AudioContext||window.webkitAudioContext,V$=new(A5=Rt({report:ft}),ut((IA=class{constructor(){V(this,"units",[]),V(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return D.debug("the system does not need to process local aec"),-1;this.context||(this.context=new j$);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new ET(e,this.context),this.units.push(t)),t.startEchoCancellation(),D.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return on().name!==mn.SAFARI}}).prototype,"processExternalMediaAEC",[A5],Object.getOwnPropertyDescriptor(IA.prototype,"processExternalMediaAEC"),IA.prototype),IA);function I5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function N5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?I5(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const oL=window||document;function O5(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!oL)return;const n=Hi._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=s=>{if(!(s&&s.blockedURI&&(Hi.onSecurityPolicyViolation||Hi.getListeners(Cd.SECURITY_POLICY_VIOLATION).length>0)))return;const l=s.blockedURI;Y("CSP_DETECTED_HOSTNAME_LIST").some(h=>Ye(l).call(l,h))&&(Hi.onSecurityPolicyViolation&&typeof Hi.onSecurityPolicyViolation=="function"&&Hi.onSecurityPolicyViolation(s),Hi.getListeners(Cd.SECURITY_POLICY_VIOLATION).length>0&&Hi.safeEmit(Cd.SECURITY_POLICY_VIOLATION,s))};n&&oL.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||Hi.getListeners(Cd.SECURITY_POLICY_VIOLATION).length>0)&&oL.addEventListener("securitypolicyviolation",r),Hi._cspEventHandlerPointer=r}var F$=W,B$=fj,D5=RegExp.prototype,G$=function(e){return e===D5||F$(D5,e)?B$(e):e.flags},ys=f(G$);function VE(e){let t=e.length;for(;--t>=0;)e[t]=0}const cL=256,P5=286,yT=30,vT=15,lL=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),NA=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),H$=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),L5=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Wu=new Array(576);VE(Wu);const ST=new Array(60);VE(ST);const TT=new Array(512);VE(TT);const RT=new Array(256);VE(RT);const dL=new Array(29);VE(dL);const OA=new Array(yT);function uL(e,t,n,r,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=s,this.has_stree=e&&e.length}let k5,x5,M5;function hL(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}VE(OA);const U5=e=>e<256?TT[e]:TT[256+(e>>>7)],bT=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},uo=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,bT(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},Od=(e,t,n)=>{uo(e,n[2*t],n[2*t+1])},j5=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},V5=(e,t,n)=>{const r=new Array(16);let s,l,h=0;for(s=1;s<=vT;s++)h=h+n[s-1]<<1,r[s]=h;for(l=0;l<=t;l++){let p=e[2*l+1];p!==0&&(e[2*l]=j5(r[p]++,p))}},F5=e=>{let t;for(t=0;t<P5;t++)e.dyn_ltree[2*t]=0;for(t=0;t<yT;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},B5=e=>{e.bi_valid>8?bT(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},G5=(e,t,n,r)=>{const s=2*t,l=2*n;return e[s]<e[l]||e[s]===e[l]&&r[t]<=r[n]},pL=(e,t,n)=>{const r=e.heap[n];let s=n<<1;for(;s<=e.heap_len&&(s<e.heap_len&&G5(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!G5(t,r,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=r},H5=(e,t,n)=>{let r,s,l,h,p=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+p++],r+=(255&e.pending_buf[e.sym_buf+p++])<<8,s=e.pending_buf[e.sym_buf+p++],r===0?Od(e,s,t):(l=RT[s],Od(e,l+cL+1,t),h=lL[l],h!==0&&(s-=dL[l],uo(e,s,h)),r--,l=U5(r),Od(e,l,n),h=NA[l],h!==0&&(r-=OA[l],uo(e,r,h)));while(p<e.sym_next);Od(e,256,t)},fL=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems;let h,p,m,g=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<l;h++)n[2*h]!==0?(e.heap[++e.heap_len]=g=h,e.depth[h]=0):n[2*h+1]=0;for(;e.heap_len<2;)m=e.heap[++e.heap_len]=g<2?++g:0,n[2*m]=1,e.depth[m]=0,e.opt_len--,s&&(e.static_len-=r[2*m+1]);for(t.max_code=g,h=e.heap_len>>1;h>=1;h--)pL(e,n,h);m=l;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pL(e,n,1),p=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=p,n[2*m]=n[2*h]+n[2*p],e.depth[m]=(e.depth[h]>=e.depth[p]?e.depth[h]:e.depth[p])+1,n[2*h+1]=n[2*p+1]=m,e.heap[1]=m++,pL(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((v,T)=>{const C=T.dyn_tree,I=T.max_code,U=T.stat_desc.static_tree,k=T.stat_desc.has_stree,M=T.stat_desc.extra_bits,F=T.stat_desc.extra_base,B=T.stat_desc.max_length;let ee,ue,de,ae,Te,Ae,We=0;for(ae=0;ae<=vT;ae++)v.bl_count[ae]=0;for(C[2*v.heap[v.heap_max]+1]=0,ee=v.heap_max+1;ee<573;ee++)ue=v.heap[ee],ae=C[2*C[2*ue+1]+1]+1,ae>B&&(ae=B,We++),C[2*ue+1]=ae,ue>I||(v.bl_count[ae]++,Te=0,ue>=F&&(Te=M[ue-F]),Ae=C[2*ue],v.opt_len+=Ae*(ae+Te),k&&(v.static_len+=Ae*(U[2*ue+1]+Te)));if(We!==0){do{for(ae=B-1;v.bl_count[ae]===0;)ae--;v.bl_count[ae]--,v.bl_count[ae+1]+=2,v.bl_count[B]--,We-=2}while(We>0);for(ae=B;ae!==0;ae--)for(ue=v.bl_count[ae];ue!==0;)de=v.heap[--ee],de>I||(C[2*de+1]!==ae&&(v.opt_len+=(ae-C[2*de+1])*C[2*de],C[2*de+1]=ae),ue--)}})(e,t),V5(n,g,e.bl_count)},z5=(e,t,n)=>{let r,s,l=-1,h=t[1],p=0,m=7,g=4;for(h===0&&(m=138,g=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)s=h,h=t[2*(r+1)+1],++p<m&&s===h||(p<g?e.bl_tree[2*s]+=p:s!==0?(s!==l&&e.bl_tree[2*s]++,e.bl_tree[32]++):p<=10?e.bl_tree[34]++:e.bl_tree[36]++,p=0,l=s,h===0?(m=138,g=3):s===h?(m=6,g=3):(m=7,g=4))},W5=(e,t,n)=>{let r,s,l=-1,h=t[1],p=0,m=7,g=4;for(h===0&&(m=138,g=3),r=0;r<=n;r++)if(s=h,h=t[2*(r+1)+1],!(++p<m&&s===h)){if(p<g)do Od(e,s,e.bl_tree);while(--p!=0);else s!==0?(s!==l&&(Od(e,s,e.bl_tree),p--),Od(e,16,e.bl_tree),uo(e,p-3,2)):p<=10?(Od(e,17,e.bl_tree),uo(e,p-3,3)):(Od(e,18,e.bl_tree),uo(e,p-11,7));p=0,l=s,h===0?(m=138,g=3):s===h?(m=6,g=3):(m=7,g=4)}};let q5=!1;const K5=(e,t,n,r)=>{uo(e,0+(r?1:0),3),B5(e),bT(e,n),bT(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var z$=e=>{q5||((()=>{let t,n,r,s,l;const h=new Array(16);for(r=0,s=0;s<28;s++)for(dL[s]=r,t=0;t<1<<lL[s];t++)RT[r++]=s;for(RT[r-1]=s,l=0,s=0;s<16;s++)for(OA[s]=l,t=0;t<1<<NA[s];t++)TT[l++]=s;for(l>>=7;s<yT;s++)for(OA[s]=l<<7,t=0;t<1<<NA[s]-7;t++)TT[256+l++]=s;for(n=0;n<=vT;n++)h[n]=0;for(t=0;t<=143;)Wu[2*t+1]=8,t++,h[8]++;for(;t<=255;)Wu[2*t+1]=9,t++,h[9]++;for(;t<=279;)Wu[2*t+1]=7,t++,h[7]++;for(;t<=287;)Wu[2*t+1]=8,t++,h[8]++;for(V5(Wu,287,h),t=0;t<yT;t++)ST[2*t+1]=5,ST[2*t]=j5(t,5);k5=new uL(Wu,lL,257,P5,vT),x5=new uL(ST,NA,0,yT,vT),M5=new uL(new Array(0),H$,0,19,7)})(),q5=!0),e.l_desc=new hL(e.dyn_ltree,k5),e.d_desc=new hL(e.dyn_dtree,x5),e.bl_desc=new hL(e.bl_tree,M5),e.bi_buf=0,e.bi_valid=0,F5(e)},W$=(e,t,n,r)=>{let s,l,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(p=>{let m,g=4093624447;for(m=0;m<=31;m++,g>>>=1)if(1&g&&p.dyn_ltree[2*m]!==0)return 0;if(p.dyn_ltree[18]!==0||p.dyn_ltree[20]!==0||p.dyn_ltree[26]!==0)return 1;for(m=32;m<cL;m++)if(p.dyn_ltree[2*m]!==0)return 1;return 0})(e)),fL(e,e.l_desc),fL(e,e.d_desc),h=(p=>{let m;for(z5(p,p.dyn_ltree,p.l_desc.max_code),z5(p,p.dyn_dtree,p.d_desc.max_code),fL(p,p.bl_desc),m=18;m>=3&&p.bl_tree[2*L5[m]+1]===0;m--);return p.opt_len+=3*(m+1)+5+5+4,m})(e),s=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=s&&(s=l)):s=l=n+5,n+4<=s&&t!==-1?K5(e,t,n,r):e.strategy===4||l===s?(uo(e,2+(r?1:0),3),H5(e,Wu,ST)):(uo(e,4+(r?1:0),3),((p,m,g,v)=>{let T;for(uo(p,m-257,5),uo(p,g-1,5),uo(p,v-4,4),T=0;T<v;T++)uo(p,p.bl_tree[2*L5[T]+1],3);W5(p,p.dyn_ltree,m-1),W5(p,p.dyn_dtree,g-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),H5(e,e.dyn_ltree,e.dyn_dtree)),F5(e),r&&B5(e)},q$=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(RT[n]+cL+1)]++,e.dyn_dtree[2*U5(t)]++),e.sym_next===e.sym_end),K$=e=>{uo(e,2,3),Od(e,256,Wu),(t=>{t.bi_valid===16?(bT(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},Y$={_tr_init:z$,_tr_stored_block:K5,_tr_flush_block:W$,_tr_tally:q$,_tr_align:K$},CT=(e,t,n,r)=>{let s=65535&e|0,l=e>>>16&65535|0,h=0;for(;n!==0;){h=n>2e3?2e3:n,n-=h;do s=s+t[r++]|0,l=l+s|0;while(--h);s%=65521,l%=65521}return s|l<<16|0};const X$=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Ps=(e,t,n,r)=>{const s=X$,l=r+n;e^=-1;for(let h=r;h<l;h++)e=e>>>8^s[255&(e^t[h])];return-1^e},Mm={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},DA={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:J$,_tr_stored_block:mL,_tr_flush_block:Q$,_tr_tally:Rp,_tr_align:$$}=Y$,{Z_NO_FLUSH:bp,Z_PARTIAL_FLUSH:Z$,Z_FULL_FLUSH:eZ,Z_FINISH:kc,Z_BLOCK:Y5,Z_OK:Ws,Z_STREAM_END:X5,Z_STREAM_ERROR:Dd,Z_DATA_ERROR:tZ,Z_BUF_ERROR:_L,Z_DEFAULT_COMPRESSION:nZ,Z_FILTERED:iZ,Z_HUFFMAN_ONLY:PA,Z_RLE:rZ,Z_FIXED:sZ,Z_DEFAULT_STRATEGY:aZ,Z_UNKNOWN:oZ,Z_DEFLATED:LA}=DA,gL=286,cZ=30,lZ=19,dZ=2*gL+1,uZ=15,Um=258,Pd=262,FE=42,jm=113,wT=666,Vm=(e,t)=>(e.msg=Mm[t],t),J5=e=>2*e-(e>4?9:0),Cp=e=>{let t=e.length;for(;--t>=0;)e[t]=0},hZ=e=>{let t,n,r,s=e.w_size;t=e.hash_size,r=t;do n=e.head[--r],e.head[r]=n>=s?n-s:0;while(--t);t=s,r=t;do n=e.prev[--r],e.prev[r]=n>=s?n-s:0;while(--t)};let wp=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const Uo=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},jo=(e,t)=>{Q$(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Uo(e.strm)},wi=(e,t)=>{e.pending_buf[e.pending++]=t},AT=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},EL=(e,t,n,r)=>{let s=e.avail_in;return s>r&&(s=r),s===0?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),n),e.state.wrap===1?e.adler=CT(e.adler,t,s,n):e.state.wrap===2&&(e.adler=Ps(e.adler,t,s,n)),e.next_in+=s,e.total_in+=s,s)},Q5=(e,t)=>{let n,r,s=e.max_chain_length,l=e.strstart,h=e.prev_length,p=e.nice_match;const m=e.strstart>e.w_size-Pd?e.strstart-(e.w_size-Pd):0,g=e.window,v=e.w_mask,T=e.prev,C=e.strstart+Um;let I=g[l+h-1],U=g[l+h];e.prev_length>=e.good_match&&(s>>=2),p>e.lookahead&&(p=e.lookahead);do if(n=t,g[n+h]===U&&g[n+h-1]===I&&g[n]===g[l]&&g[++n]===g[l+1]){l+=2,n++;do;while(g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&l<C);if(r=Um-(C-l),l=C-Um,r>h){if(e.match_start=t,h=r,r>=p)break;I=g[l+h-1],U=g[l+h]}}while((t=T[t&v])>m&&--s!=0);return h<=e.lookahead?h:e.lookahead},BE=e=>{const t=e.w_size;let n,r,s;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Pd)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),hZ(e),r+=t),e.strm.avail_in===0)break;if(n=EL(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=wp(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=wp(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Pd&&e.strm.avail_in!==0)},$5=(e,t)=>{let n,r,s,l=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,p=e.strm.avail_in;do{if(n=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s||(s=e.strm.avail_out-s,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>s&&(n=s),n<l&&(n===0&&t!==kc||t===bp||n!==r+e.strm.avail_in)))break;h=t===kc&&n===r+e.strm.avail_in?1:0,mL(e,0,0,h),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,Uo(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(EL(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(h===0);return p-=e.strm.avail_in,p&&(p>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=p&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-p,e.strm.next_in),e.strstart),e.strstart+=p,e.insert+=p>e.w_size-e.insert?e.w_size-e.insert:p),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:t!==bp&&t!==kc&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(EL(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,l=s>e.w_size?e.w_size:s,r=e.strstart-e.block_start,(r>=l||(r||t===kc)&&t!==bp&&e.strm.avail_in===0&&r<=s)&&(n=r>s?s:r,h=t===kc&&e.strm.avail_in===0&&n===r?1:0,mL(e,e.block_start,n,h),e.block_start+=n,Uo(e.strm)),h?3:1)},yL=(e,t)=>{let n,r;for(;;){if(e.lookahead<Pd){if(BE(e),e.lookahead<Pd&&t===bp)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=wp(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-Pd&&(e.match_length=Q5(e,n)),e.match_length>=3)if(r=Rp(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=wp(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=wp(e,e.ins_h,e.window[e.strstart+1]);else r=Rp(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(jo(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===kc?(jo(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(jo(e,!1),e.strm.avail_out===0)?1:2},GE=(e,t)=>{let n,r,s;for(;;){if(e.lookahead<Pd){if(BE(e),e.lookahead<Pd&&t===bp)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=wp(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Pd&&(e.match_length=Q5(e,n),e.match_length<=5&&(e.strategy===iZ||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,r=Rp(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=wp(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(jo(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=Rp(e,0,e.window[e.strstart-1]),r&&jo(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Rp(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===kc?(jo(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(jo(e,!1),e.strm.avail_out===0)?1:2};function Ld(e,t,n,r,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=s}const IT=[new Ld(0,0,0,0,$5),new Ld(4,4,8,4,yL),new Ld(4,5,16,8,yL),new Ld(4,6,32,32,yL),new Ld(4,4,16,16,GE),new Ld(8,16,32,32,GE),new Ld(8,16,128,128,GE),new Ld(8,32,128,256,GE),new Ld(32,128,258,1024,GE),new Ld(32,258,258,4096,GE)];function pZ(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=LA,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*dZ),this.dyn_dtree=new Uint16Array(2*(2*cZ+1)),this.bl_tree=new Uint16Array(2*(2*lZ+1)),Cp(this.dyn_ltree),Cp(this.dyn_dtree),Cp(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(uZ+1),this.heap=new Uint16Array(2*gL+1),Cp(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*gL+1),Cp(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const NT=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==FE&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==jm&&t.status!==wT?1:0},Z5=e=>{if(NT(e))return Vm(e,Dd);e.total_in=e.total_out=0,e.data_type=oZ;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?FE:jm,e.adler=t.wrap===2?0:1,t.last_flush=-2,J$(t),Ws},e6=e=>{const t=Z5(e);return t===Ws&&(n=>{n.window_size=2*n.w_size,Cp(n.head),n.max_lazy_match=IT[n.level].max_lazy,n.good_match=IT[n.level].good_length,n.nice_match=IT[n.level].nice_length,n.max_chain_length=IT[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},t6=(e,t,n,r,s,l)=>{if(!e)return Dd;let h=1;if(t===nZ&&(t=6),r<0?(h=0,r=-r):r>15&&(h=2,r-=16),s<1||s>9||n!==LA||r<8||r>15||t<0||t>9||l<0||l>sZ||r===8&&h!==1)return Vm(e,Dd);r===8&&(r=9);const p=new pZ;return e.state=p,p.strm=e,p.status=FE,p.wrap=h,p.gzhead=null,p.w_bits=r,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=s+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<s+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=3*(p.lit_bufsize-1),p.level=t,p.strategy=l,p.method=n,e6(e)};var fZ=(e,t)=>{if(NT(e)||t>Y5||t<0)return e?Vm(e,Dd):Dd;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===wT&&t!==kc)return Vm(e,e.avail_out===0?_L:Dd);const r=n.last_flush;if(n.last_flush=t,n.pending!==0){if(Uo(e),e.avail_out===0)return n.last_flush=-1,Ws}else if(e.avail_in===0&&J5(t)<=J5(r)&&t!==kc)return Vm(e,_L);if(n.status===wT&&e.avail_in!==0)return Vm(e,_L);if(n.status===FE&&n.wrap===0&&(n.status=jm),n.status===FE){let s=LA+(n.w_bits-8<<4)<<8,l=-1;if(l=n.strategy>=PA||n.level<2?0:n.level<6?1:n.level===6?2:3,s|=l<<6,n.strstart!==0&&(s|=32),s+=31-s%31,AT(n,s),n.strstart!==0&&(AT(n,e.adler>>>16),AT(n,65535&e.adler)),e.adler=1,n.status=jm,Uo(e),n.pending!==0)return n.last_flush=-1,Ws}if(n.status===57){if(e.adler=0,wi(n,31),wi(n,139),wi(n,8),n.gzhead)wi(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),wi(n,255&n.gzhead.time),wi(n,n.gzhead.time>>8&255),wi(n,n.gzhead.time>>16&255),wi(n,n.gzhead.time>>24&255),wi(n,n.level===9?2:n.strategy>=PA||n.level<2?4:0),wi(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(wi(n,255&n.gzhead.extra.length),wi(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Ps(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(wi(n,0),wi(n,0),wi(n,0),wi(n,0),wi(n,0),wi(n,n.level===9?2:n.strategy>=PA||n.level<2?4:0),wi(n,3),n.status=jm,Uo(e),n.pending!==0)return n.last_flush=-1,Ws}if(n.status===69){if(n.gzhead.extra){let s=n.pending,l=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+l>n.pending_buf_size;){let p=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+p),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>s&&(e.adler=Ps(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex+=p,Uo(e),n.pending!==0)return n.last_flush=-1,Ws;s=0,l-=p}let h=new Uint8Array(n.gzhead.extra);n.pending_buf.set(h.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending+=l,n.gzhead.hcrc&&n.pending>s&&(e.adler=Ps(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let s,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=Ps(e.adler,n.pending_buf,n.pending-l,l)),Uo(e),n.pending!==0)return n.last_flush=-1,Ws;l=0}s=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,wi(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>l&&(e.adler=Ps(e.adler,n.pending_buf,n.pending-l,l)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let s,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=Ps(e.adler,n.pending_buf,n.pending-l,l)),Uo(e),n.pending!==0)return n.last_flush=-1,Ws;l=0}s=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,wi(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>l&&(e.adler=Ps(e.adler,n.pending_buf,n.pending-l,l))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Uo(e),n.pending!==0))return n.last_flush=-1,Ws;wi(n,255&e.adler),wi(n,e.adler>>8&255),e.adler=0}if(n.status=jm,Uo(e),n.pending!==0)return n.last_flush=-1,Ws}if(e.avail_in!==0||n.lookahead!==0||t!==bp&&n.status!==wT){let s=n.level===0?$5(n,t):n.strategy===PA?((l,h)=>{let p;for(;;){if(l.lookahead===0&&(BE(l),l.lookahead===0)){if(h===bp)return 1;break}if(l.match_length=0,p=Rp(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,p&&(jo(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,h===kc?(jo(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(jo(l,!1),l.strm.avail_out===0)?1:2})(n,t):n.strategy===rZ?((l,h)=>{let p,m,g,v;const T=l.window;for(;;){if(l.lookahead<=Um){if(BE(l),l.lookahead<=Um&&h===bp)return 1;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=3&&l.strstart>0&&(g=l.strstart-1,m=T[g],m===T[++g]&&m===T[++g]&&m===T[++g])){v=l.strstart+Um;do;while(m===T[++g]&&m===T[++g]&&m===T[++g]&&m===T[++g]&&m===T[++g]&&m===T[++g]&&m===T[++g]&&m===T[++g]&&g<v);l.match_length=Um-(v-g),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=3?(p=Rp(l,1,l.match_length-3),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(p=Rp(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),p&&(jo(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,h===kc?(jo(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(jo(l,!1),l.strm.avail_out===0)?1:2})(n,t):IT[n.level].func(n,t);if(s!==3&&s!==4||(n.status=wT),s===1||s===3)return e.avail_out===0&&(n.last_flush=-1),Ws;if(s===2&&(t===Z$?$$(n):t!==Y5&&(mL(n,0,0,!1),t===eZ&&(Cp(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),Uo(e),e.avail_out===0))return n.last_flush=-1,Ws}return t!==kc?Ws:n.wrap<=0?X5:(n.wrap===2?(wi(n,255&e.adler),wi(n,e.adler>>8&255),wi(n,e.adler>>16&255),wi(n,e.adler>>24&255),wi(n,255&e.total_in),wi(n,e.total_in>>8&255),wi(n,e.total_in>>16&255),wi(n,e.total_in>>24&255)):(AT(n,e.adler>>>16),AT(n,65535&e.adler)),Uo(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Ws:X5)},mZ=(e,t)=>{let n=t.length;if(NT(e))return Dd;const r=e.state,s=r.wrap;if(s===2||s===1&&r.status!==FE||r.lookahead)return Dd;if(s===1&&(e.adler=CT(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){s===0&&(Cp(r.head),r.strstart=0,r.block_start=0,r.insert=0);let m=new Uint8Array(r.w_size);m.set(t.subarray(n-r.w_size,n),0),t=m,n=r.w_size}const l=e.avail_in,h=e.next_in,p=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,BE(r);r.lookahead>=3;){let m=r.strstart,g=r.lookahead-2;do r.ins_h=wp(r,r.ins_h,r.window[m+3-1]),r.prev[m&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=m,m++;while(--g);r.strstart=m,r.lookahead=2,BE(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=h,e.input=p,e.avail_in=l,r.wrap=s,Ws},OT={deflateInit:(e,t)=>t6(e,t,LA,15,8,aZ),deflateInit2:t6,deflateReset:e6,deflateResetKeep:Z5,deflateSetHeader:(e,t)=>NT(e)||e.state.wrap!==2?Dd:(e.state.gzhead=t,Ws),deflate:fZ,deflateEnd:e=>{if(NT(e))return Dd;const t=e.state.status;return e.state=null,t===jm?Vm(e,tZ):Ws},deflateSetDictionary:mZ,deflateInfo:"pako deflate (from Nodeca project)"};const _Z=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var kA={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)_Z(n,r)&&(e[r]=n[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,s=e.length;r<s;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,s=0,l=e.length;r<l;r++){let h=e[r];n.set(h,s),s+=h.length}return n}};let n6=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{n6=!1}const DT=new Uint8Array(256);for(let e=0;e<256;e++)DT[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;DT[254]=DT[254]=1;var PT={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,r,s,l,h=e.length,p=0;for(s=0;s<h;s++)n=e.charCodeAt(s),(64512&n)==55296&&s+1<h&&(r=e.charCodeAt(s+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),s++)),p+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(p),l=0,s=0;l<p;s++)n=e.charCodeAt(s),(64512&n)==55296&&s+1<h&&(r=e.charCodeAt(s+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),s++)),n<128?t[l++]=n:n<2048?(t[l++]=192|n>>>6,t[l++]=128|63&n):n<65536?(t[l++]=224|n>>>12,t[l++]=128|n>>>6&63,t[l++]=128|63&n):(t[l++]=240|n>>>18,t[l++]=128|n>>>12&63,t[l++]=128|n>>>6&63,t[l++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,s;const l=new Array(2*n);for(s=0,r=0;r<n;){let h=e[r++];if(h<128){l[s++]=h;continue}let p=DT[h];if(p>4)l[s++]=65533,r+=p-1;else{for(h&=p===2?31:p===3?15:7;p>1&&r<n;)h=h<<6|63&e[r++],p--;p>1?l[s++]=65533:h<65536?l[s++]=h:(h-=65536,l[s++]=55296|h>>10&1023,l[s++]=56320|1023&h)}}return((h,p)=>{if(p<65534&&h.subarray&&n6)return String.fromCharCode.apply(null,h.length===p?h:h.subarray(0,p));let m="";for(let g=0;g<p;g++)m+=String.fromCharCode(h[g]);return m})(l,s)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+DT[e[n]]>t?n:t}},i6=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const r6=Object.prototype.toString,{Z_NO_FLUSH:gZ,Z_SYNC_FLUSH:EZ,Z_FULL_FLUSH:yZ,Z_FINISH:vZ,Z_OK:xA,Z_STREAM_END:SZ,Z_DEFAULT_COMPRESSION:TZ,Z_DEFAULT_STRATEGY:RZ,Z_DEFLATED:bZ}=DA;function MA(e){this.options=kA.assign({level:TZ,method:bZ,chunkSize:16384,windowBits:15,memLevel:8,strategy:RZ},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i6,this.strm.avail_out=0;let n=OT.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==xA)throw new Error(Mm[n]);if(t.header&&OT.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?PT.string2buf(t.dictionary):r6.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=OT.deflateSetDictionary(this.strm,r),n!==xA)throw new Error(Mm[n]);this._dict_set=!0}}function CZ(e,t){const n=new MA(t);if(n.push(e,!0),n.err)throw n.msg||Mm[n.err];return n.result}MA.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let s,l;if(this.ended)return!1;for(l=t===~~t?t:t===!0?vZ:gZ,typeof e=="string"?n.input=PT.string2buf(e):r6.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(l===EZ||l===yZ)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(s=OT.deflate(n,l),s===SZ)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=OT.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===xA;if(n.avail_out!==0){if(l>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},MA.prototype.onData=function(e){this.chunks.push(e)},MA.prototype.onEnd=function(e){e===xA&&(this.result=kA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var wZ={deflate:CZ};const UA=16209;var AZ=function(e,t){let n,r,s,l,h,p,m,g,v,T,C,I,U,k,M,F,B,ee,ue,de,ae,Te,Ae,We;const tt=e.state;n=e.next_in,Ae=e.input,r=n+(e.avail_in-5),s=e.next_out,We=e.output,l=s-(t-e.avail_out),h=s+(e.avail_out-257),p=tt.dmax,m=tt.wsize,g=tt.whave,v=tt.wnext,T=tt.window,C=tt.hold,I=tt.bits,U=tt.lencode,k=tt.distcode,M=(1<<tt.lenbits)-1,F=(1<<tt.distbits)-1;e:do{I<15&&(C+=Ae[n++]<<I,I+=8,C+=Ae[n++]<<I,I+=8),B=U[C&M];t:for(;;){if(ee=B>>>24,C>>>=ee,I-=ee,ee=B>>>16&255,ee===0)We[s++]=65535&B;else{if(!(16&ee)){if((64&ee)==0){B=U[(65535&B)+(C&(1<<ee)-1)];continue t}if(32&ee){tt.mode=16191;break e}e.msg="invalid literal/length code",tt.mode=UA;break e}ue=65535&B,ee&=15,ee&&(I<ee&&(C+=Ae[n++]<<I,I+=8),ue+=C&(1<<ee)-1,C>>>=ee,I-=ee),I<15&&(C+=Ae[n++]<<I,I+=8,C+=Ae[n++]<<I,I+=8),B=k[C&F];n:for(;;){if(ee=B>>>24,C>>>=ee,I-=ee,ee=B>>>16&255,!(16&ee)){if((64&ee)==0){B=k[(65535&B)+(C&(1<<ee)-1)];continue n}e.msg="invalid distance code",tt.mode=UA;break e}if(de=65535&B,ee&=15,I<ee&&(C+=Ae[n++]<<I,I+=8,I<ee&&(C+=Ae[n++]<<I,I+=8)),de+=C&(1<<ee)-1,de>p){e.msg="invalid distance too far back",tt.mode=UA;break e}if(C>>>=ee,I-=ee,ee=s-l,de>ee){if(ee=de-ee,ee>g&&tt.sane){e.msg="invalid distance too far back",tt.mode=UA;break e}if(ae=0,Te=T,v===0){if(ae+=m-ee,ee<ue){ue-=ee;do We[s++]=T[ae++];while(--ee);ae=s-de,Te=We}}else if(v<ee){if(ae+=m+v-ee,ee-=v,ee<ue){ue-=ee;do We[s++]=T[ae++];while(--ee);if(ae=0,v<ue){ee=v,ue-=ee;do We[s++]=T[ae++];while(--ee);ae=s-de,Te=We}}}else if(ae+=v-ee,ee<ue){ue-=ee;do We[s++]=T[ae++];while(--ee);ae=s-de,Te=We}for(;ue>2;)We[s++]=Te[ae++],We[s++]=Te[ae++],We[s++]=Te[ae++],ue-=3;ue&&(We[s++]=Te[ae++],ue>1&&(We[s++]=Te[ae++]))}else{ae=s-de;do We[s++]=We[ae++],We[s++]=We[ae++],We[s++]=We[ae++],ue-=3;while(ue>2);ue&&(We[s++]=We[ae++],ue>1&&(We[s++]=We[ae++]))}break}}break}}while(n<r&&s<h);ue=I>>3,n-=ue,I-=ue<<3,C&=(1<<I)-1,e.next_in=n,e.next_out=s,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=s<h?h-s+257:257-(s-h),tt.hold=C,tt.bits=I};const jA=15,IZ=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),NZ=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),OZ=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),DZ=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var LT=(e,t,n,r,s,l,h,p)=>{const m=p.bits;let g,v,T,C,I,U,k=0,M=0,F=0,B=0,ee=0,ue=0,de=0,ae=0,Te=0,Ae=0,We=null;const tt=new Uint16Array(16),Ft=new Uint16Array(16);let xt,wt,qn,Pn=null;for(k=0;k<=jA;k++)tt[k]=0;for(M=0;M<r;M++)tt[t[n+M]]++;for(ee=m,B=jA;B>=1&&tt[B]===0;B--);if(ee>B&&(ee=B),B===0)return s[l++]=20971520,s[l++]=20971520,p.bits=1,0;for(F=1;F<B&&tt[F]===0;F++);for(ee<F&&(ee=F),ae=1,k=1;k<=jA;k++)if(ae<<=1,ae-=tt[k],ae<0)return-1;if(ae>0&&(e===0||B!==1))return-1;for(Ft[1]=0,k=1;k<jA;k++)Ft[k+1]=Ft[k]+tt[k];for(M=0;M<r;M++)t[n+M]!==0&&(h[Ft[t[n+M]]++]=M);if(e===0?(We=Pn=h,U=20):e===1?(We=IZ,Pn=NZ,U=257):(We=OZ,Pn=DZ,U=0),Ae=0,M=0,k=F,I=l,ue=ee,de=0,T=-1,Te=1<<ee,C=Te-1,e===1&&Te>852||e===2&&Te>592)return 1;for(;;){xt=k-de,h[M]+1<U?(wt=0,qn=h[M]):h[M]>=U?(wt=Pn[h[M]-U],qn=We[h[M]-U]):(wt=96,qn=0),g=1<<k-de,v=1<<ue,F=v;do v-=g,s[I+(Ae>>de)+v]=xt<<24|wt<<16|qn|0;while(v!==0);for(g=1<<k-1;Ae&g;)g>>=1;if(g!==0?(Ae&=g-1,Ae+=g):Ae=0,M++,--tt[k]==0){if(k===B)break;k=t[n+h[M]]}if(k>ee&&(Ae&C)!==T){for(de===0&&(de=ee),I+=F,ue=k-de,ae=1<<ue;ue+de<B&&(ae-=tt[ue+de],!(ae<=0));)ue++,ae<<=1;if(Te+=1<<ue,e===1&&Te>852||e===2&&Te>592)return 1;T=Ae&C,s[T]=ee<<24|ue<<16|I-l|0}}return Ae!==0&&(s[I+Ae]=k-de<<24|64<<16|0),p.bits=ee,0};const{Z_FINISH:s6,Z_BLOCK:PZ,Z_TREES:VA,Z_OK:Fm,Z_STREAM_END:LZ,Z_NEED_DICT:kZ,Z_STREAM_ERROR:xc,Z_DATA_ERROR:a6,Z_MEM_ERROR:o6,Z_BUF_ERROR:xZ,Z_DEFLATED:c6}=DA,FA=16180,BA=16190,qu=16191,vL=16192,SL=16194,GA=16199,HA=16200,TL=16206,fr=16209,l6=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function MZ(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Bm=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<FA||t.mode>16211?1:0},d6=e=>{if(Bm(e))return xc;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=FA,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Fm},u6=e=>{if(Bm(e))return xc;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,d6(e)},h6=(e,t)=>{let n;if(Bm(e))return xc;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?xc:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,u6(e))},p6=(e,t)=>{if(!e)return xc;const n=new MZ;e.state=n,n.strm=e,n.window=null,n.mode=FA;const r=h6(e,t);return r!==Fm&&(e.state=null),r};let RL,bL,f6=!0;const UZ=e=>{if(f6){RL=new Int32Array(512),bL=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(LT(1,e.lens,0,288,RL,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;LT(2,e.lens,0,32,bL,0,e.work,{bits:5}),f6=!1}e.lencode=RL,e.lenbits=9,e.distcode=bL,e.distbits=5},m6=(e,t,n,r)=>{let s;const l=e.state;return l.window===null&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),r>=l.wsize?(l.window.set(t.subarray(n-l.wsize,n),0),l.wnext=0,l.whave=l.wsize):(s=l.wsize-l.wnext,s>r&&(s=r),l.window.set(t.subarray(n-r,n-r+s),l.wnext),(r-=s)?(l.window.set(t.subarray(n-r,n),0),l.wnext=r,l.whave=l.wsize):(l.wnext+=s,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=s))),0};var jZ=(e,t)=>{let n,r,s,l,h,p,m,g,v,T,C,I,U,k,M,F,B,ee,ue,de,ae,Te,Ae=0;const We=new Uint8Array(4);let tt,Ft;const xt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Bm(e)||!e.output||!e.input&&e.avail_in!==0)return xc;n=e.state,n.mode===qu&&(n.mode=vL),h=e.next_out,s=e.output,m=e.avail_out,l=e.next_in,r=e.input,p=e.avail_in,g=n.hold,v=n.bits,T=p,C=m,Te=Fm;e:for(;;)switch(n.mode){case FA:if(n.wrap===0){n.mode=vL;break}for(;v<16;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}if(2&n.wrap&&g===35615){n.wbits===0&&(n.wbits=15),n.check=0,We[0]=255&g,We[1]=g>>>8&255,n.check=Ps(n.check,We,2,0),g=0,v=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&g)<<8)+(g>>8))%31){e.msg="incorrect header check",n.mode=fr;break}if((15&g)!==c6){e.msg="unknown compression method",n.mode=fr;break}if(g>>>=4,v-=4,ae=8+(15&g),n.wbits===0&&(n.wbits=ae),ae>15||ae>n.wbits){e.msg="invalid window size",n.mode=fr;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&g?16189:qu,g=0,v=0;break;case 16181:for(;v<16;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}if(n.flags=g,(255&ys(n))!==c6){e.msg="unknown compression method",n.mode=fr;break}if(57344&ys(n)){e.msg="unknown header flags set",n.mode=fr;break}n.head&&(n.head.text=g>>8&1),512&ys(n)&&4&n.wrap&&(We[0]=255&g,We[1]=g>>>8&255,n.check=Ps(n.check,We,2,0)),g=0,v=0,n.mode=16182;case 16182:for(;v<32;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}n.head&&(n.head.time=g),512&ys(n)&&4&n.wrap&&(We[0]=255&g,We[1]=g>>>8&255,We[2]=g>>>16&255,We[3]=g>>>24&255,n.check=Ps(n.check,We,4,0)),g=0,v=0,n.mode=16183;case 16183:for(;v<16;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}n.head&&(n.head.xflags=255&g,n.head.os=g>>8),512&ys(n)&&4&n.wrap&&(We[0]=255&g,We[1]=g>>>8&255,n.check=Ps(n.check,We,2,0)),g=0,v=0,n.mode=16184;case 16184:if(1024&ys(n)){for(;v<16;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}n.length=g,n.head&&(n.head.extra_len=g),512&ys(n)&&4&n.wrap&&(We[0]=255&g,We[1]=g>>>8&255,n.check=Ps(n.check,We,2,0)),g=0,v=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&ys(n)&&(I=n.length,I>p&&(I=p),I&&(n.head&&(ae=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(l,l+I),ae)),512&ys(n)&&4&n.wrap&&(n.check=Ps(n.check,r,I,l)),p-=I,l+=I,n.length-=I),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&ys(n)){if(p===0)break e;I=0;do ae=r[l+I++],n.head&&ae&&n.length<65536&&(n.head.name+=String.fromCharCode(ae));while(ae&&I<p);if(512&ys(n)&&4&n.wrap&&(n.check=Ps(n.check,r,I,l)),p-=I,l+=I,ae)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&ys(n)){if(p===0)break e;I=0;do ae=r[l+I++],n.head&&ae&&n.length<65536&&(n.head.comment+=String.fromCharCode(ae));while(ae&&I<p);if(512&ys(n)&&4&n.wrap&&(n.check=Ps(n.check,r,I,l)),p-=I,l+=I,ae)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&ys(n)){for(;v<16;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}if(4&n.wrap&&g!==(65535&n.check)){e.msg="header crc mismatch",n.mode=fr;break}g=0,v=0}n.head&&(n.head.hcrc=ys(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=qu;break;case 16189:for(;v<32;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}e.adler=n.check=l6(g),g=0,v=0,n.mode=BA;case BA:if(n.havedict===0)return e.next_out=h,e.avail_out=m,e.next_in=l,e.avail_in=p,n.hold=g,n.bits=v,kZ;e.adler=n.check=1,n.mode=qu;case qu:if(t===PZ||t===VA)break e;case vL:if(n.last){g>>>=7&v,v-=7&v,n.mode=TL;break}for(;v<3;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}switch(n.last=1&g,g>>>=1,v-=1,3&g){case 0:n.mode=16193;break;case 1:if(UZ(n),n.mode=GA,t===VA){g>>>=2,v-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=fr}g>>>=2,v-=2;break;case 16193:for(g>>>=7&v,v-=7&v;v<32;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}if((65535&g)!=(g>>>16^65535)){e.msg="invalid stored block lengths",n.mode=fr;break}if(n.length=65535&g,g=0,v=0,n.mode=SL,t===VA)break e;case SL:n.mode=16195;case 16195:if(I=n.length,I){if(I>p&&(I=p),I>m&&(I=m),I===0)break e;s.set(r.subarray(l,l+I),h),p-=I,l+=I,m-=I,h+=I,n.length-=I;break}n.mode=qu;break;case 16196:for(;v<14;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}if(n.nlen=257+(31&g),g>>>=5,v-=5,n.ndist=1+(31&g),g>>>=5,v-=5,n.ncode=4+(15&g),g>>>=4,v-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=fr;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;v<3;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}n.lens[xt[n.have++]]=7&g,g>>>=3,v-=3}for(;n.have<19;)n.lens[xt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,tt={bits:n.lenbits},Te=LT(0,n.lens,0,19,n.lencode,0,n.work,tt),n.lenbits=tt.bits,Te){e.msg="invalid code lengths set",n.mode=fr;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;Ae=n.lencode[g&(1<<n.lenbits)-1],M=Ae>>>24,F=Ae>>>16&255,B=65535&Ae,!(M<=v);){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}if(B<16)g>>>=M,v-=M,n.lens[n.have++]=B;else{if(B===16){for(Ft=M+2;v<Ft;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}if(g>>>=M,v-=M,n.have===0){e.msg="invalid bit length repeat",n.mode=fr;break}ae=n.lens[n.have-1],I=3+(3&g),g>>>=2,v-=2}else if(B===17){for(Ft=M+3;v<Ft;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}g>>>=M,v-=M,ae=0,I=3+(7&g),g>>>=3,v-=3}else{for(Ft=M+7;v<Ft;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}g>>>=M,v-=M,ae=0,I=11+(127&g),g>>>=7,v-=7}if(n.have+I>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=fr;break}for(;I--;)n.lens[n.have++]=ae}}if(n.mode===fr)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=fr;break}if(n.lenbits=9,tt={bits:n.lenbits},Te=LT(1,n.lens,0,n.nlen,n.lencode,0,n.work,tt),n.lenbits=tt.bits,Te){e.msg="invalid literal/lengths set",n.mode=fr;break}if(n.distbits=6,n.distcode=n.distdyn,tt={bits:n.distbits},Te=LT(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,tt),n.distbits=tt.bits,Te){e.msg="invalid distances set",n.mode=fr;break}if(n.mode=GA,t===VA)break e;case GA:n.mode=HA;case HA:if(p>=6&&m>=258){e.next_out=h,e.avail_out=m,e.next_in=l,e.avail_in=p,n.hold=g,n.bits=v,AZ(e,C),h=e.next_out,s=e.output,m=e.avail_out,l=e.next_in,r=e.input,p=e.avail_in,g=n.hold,v=n.bits,n.mode===qu&&(n.back=-1);break}for(n.back=0;Ae=n.lencode[g&(1<<n.lenbits)-1],M=Ae>>>24,F=Ae>>>16&255,B=65535&Ae,!(M<=v);){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}if(F&&(240&F)==0){for(ee=M,ue=F,de=B;Ae=n.lencode[de+((g&(1<<ee+ue)-1)>>ee)],M=Ae>>>24,F=Ae>>>16&255,B=65535&Ae,!(ee+M<=v);){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}g>>>=ee,v-=ee,n.back+=ee}if(g>>>=M,v-=M,n.back+=M,n.length=B,F===0){n.mode=16205;break}if(32&F){n.back=-1,n.mode=qu;break}if(64&F){e.msg="invalid literal/length code",n.mode=fr;break}n.extra=15&F,n.mode=16201;case 16201:if(n.extra){for(Ft=n.extra;v<Ft;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}n.length+=g&(1<<n.extra)-1,g>>>=n.extra,v-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;Ae=n.distcode[g&(1<<n.distbits)-1],M=Ae>>>24,F=Ae>>>16&255,B=65535&Ae,!(M<=v);){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}if((240&F)==0){for(ee=M,ue=F,de=B;Ae=n.distcode[de+((g&(1<<ee+ue)-1)>>ee)],M=Ae>>>24,F=Ae>>>16&255,B=65535&Ae,!(ee+M<=v);){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}g>>>=ee,v-=ee,n.back+=ee}if(g>>>=M,v-=M,n.back+=M,64&F){e.msg="invalid distance code",n.mode=fr;break}n.offset=B,n.extra=15&F,n.mode=16203;case 16203:if(n.extra){for(Ft=n.extra;v<Ft;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}n.offset+=g&(1<<n.extra)-1,g>>>=n.extra,v-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=fr;break}n.mode=16204;case 16204:if(m===0)break e;if(I=C-m,n.offset>I){if(I=n.offset-I,I>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=fr;break}I>n.wnext?(I-=n.wnext,U=n.wsize-I):U=n.wnext-I,I>n.length&&(I=n.length),k=n.window}else k=s,U=h-n.offset,I=n.length;I>m&&(I=m),m-=I,n.length-=I;do s[h++]=k[U++];while(--I);n.length===0&&(n.mode=HA);break;case 16205:if(m===0)break e;s[h++]=n.length,m--,n.mode=HA;break;case TL:if(n.wrap){for(;v<32;){if(p===0)break e;p--,g|=r[l++]<<v,v+=8}if(C-=m,e.total_out+=C,n.total+=C,4&n.wrap&&C&&(e.adler=n.check=ys(n)?Ps(n.check,s,C,h-C):CT(n.check,s,C,h-C)),C=m,4&n.wrap&&(ys(n)?g:l6(g))!==n.check){e.msg="incorrect data check",n.mode=fr;break}g=0,v=0}n.mode=16207;case 16207:if(n.wrap&&ys(n)){for(;v<32;){if(p===0)break e;p--,g+=r[l++]<<v,v+=8}if(4&n.wrap&&g!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=fr;break}g=0,v=0}n.mode=16208;case 16208:Te=LZ;break e;case fr:Te=a6;break e;case 16210:return o6;default:return xc}return e.next_out=h,e.avail_out=m,e.next_in=l,e.avail_in=p,n.hold=g,n.bits=v,(n.wsize||C!==e.avail_out&&n.mode<fr&&(n.mode<TL||t!==s6))&&m6(e,e.output,e.next_out,C-e.avail_out),T-=e.avail_in,C-=e.avail_out,e.total_in+=T,e.total_out+=C,n.total+=C,4&n.wrap&&C&&(e.adler=n.check=ys(n)?Ps(n.check,s,C,e.next_out-C):CT(n.check,s,C,e.next_out-C)),e.data_type=n.bits+(n.last?64:0)+(n.mode===qu?128:0)+(n.mode===GA||n.mode===SL?256:0),(T===0&&C===0||t===s6)&&Te===Fm&&(Te=xZ),Te},Ku={inflateReset:u6,inflateReset2:h6,inflateResetKeep:d6,inflateInit:e=>p6(e,15),inflateInit2:p6,inflate:jZ,inflateEnd:e=>{if(Bm(e))return xc;let t=e.state;return t.window&&(t.window=null),e.state=null,Fm},inflateGetHeader:(e,t)=>{if(Bm(e))return xc;const n=e.state;return(2&n.wrap)==0?xc:(n.head=t,t.done=!1,Fm)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,s,l;return Bm(e)?xc:(r=e.state,r.wrap!==0&&r.mode!==BA?xc:r.mode===BA&&(s=1,s=CT(s,t,n,0),s!==r.check)?a6:(l=m6(e,t,n,n),l?(r.mode=16210,o6):(r.havedict=1,Fm)))},inflateInfo:"pako inflate (from Nodeca project)"},VZ=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const _6=Object.prototype.toString,{Z_NO_FLUSH:FZ,Z_FINISH:BZ,Z_OK:kT,Z_STREAM_END:CL,Z_NEED_DICT:wL,Z_STREAM_ERROR:GZ,Z_DATA_ERROR:g6,Z_MEM_ERROR:HZ}=DA;function zA(e){this.options=kA.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i6,this.strm.avail_out=0;let n=Ku.inflateInit2(this.strm,t.windowBits);if(n!==kT)throw new Error(Mm[n]);if(this.header=new VZ,Ku.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=PT.string2buf(t.dictionary):_6.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Ku.inflateSetDictionary(this.strm,t.dictionary),n!==kT)))throw new Error(Mm[n])}function zZ(e,t){const n=new zA(t);if(n.push(e),n.err)throw n.msg||Mm[n.err];return n.result}zA.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,s=this.options.dictionary;let l,h,p;if(this.ended)return!1;for(h=t===~~t?t:t===!0?BZ:FZ,_6.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),l=Ku.inflate(n,h),l===wL&&s&&(l=Ku.inflateSetDictionary(n,s),l===kT?l=Ku.inflate(n,h):l===g6&&(l=wL));n.avail_in>0&&l===CL&&n.state.wrap>0&&e[n.next_in]!==0;)Ku.inflateReset(n),l=Ku.inflate(n,h);switch(l){case GZ:case g6:case wL:case HZ:return this.onEnd(l),this.ended=!0,!1}if(p=n.avail_out,n.next_out&&(n.avail_out===0||l===CL))if(this.options.to==="string"){let m=PT.utf8border(n.output,n.next_out),g=n.next_out-m,v=PT.buf2string(n.output,m);n.next_out=g,n.avail_out=r-g,g&&n.output.set(n.output.subarray(m,m+g),0),this.onData(v)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(l!==kT||p!==0){if(l===CL)return l=Ku.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},zA.prototype.onData=function(e){this.chunks.push(e)},zA.prototype.onEnd=function(e){e===kT&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=kA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var WZ={inflate:zZ};const{deflate:qZ}=wZ,{inflate:KZ}=WZ;var YZ=qZ,XZ=KZ,E6=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(E6||{});class JZ{constructor(){V(this,"_sequence",0),V(this,"_startTime",Date.now()),V(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const p=new Uint8Array(4);p.set([1,0,0,0]);const m={id:0,length:4,data:p.buffer},g={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[m]};n.commonPacketHeader.extension=1,n.extension=g,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;Y("SHOW_DATASTREAM2_LOG")&&D.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const r=new ArrayBuffer(n.commonPacketHeader.length),s=new Uint8Array(r),l=new DataView(r);let h=0;if(l.setUint16(h,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),h+=2,l.setUint32(h,n.commonPacketHeader.sequence,!0),h+=4,l.setUint16(h,n.commonStreamHeader,!0),h+=2,n.extension){const p=this.serializeExtension(n.extension);s.set(new Uint8Array(p),h),h+=p.byteLength}if(s.set(new Uint8Array(n.payload),h),h+=n.payload.byteLength,h!==n.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let r=0;const s=n.getUint16(r,!0);r+=2;const l={length:16383&s,reserved:(16384&s)>>14,extension:(32768&s)>>15,sequence:n.getUint16(r+2,!0)<<16|n.getUint16(r,!0)};let h,p;if(r+=4,Y("SHOW_DATASTREAM2_LOG")&&D.debug("receive data header: ".concat(JSON.stringify(l))),n.getUint16(r,!0),r+=2,l.extension){p=this.deserializeExtension(t.slice(r)),r+=2+p.length,h=t.slice(r);let m=!1;if(p.datas.length>0){const g=p.datas.find(v=>v.id===0);g&&(m=(1&new DataView(g.data).getUint32(0,!0))==1)}h=m?this.decompress(h):h}else h=t.slice(8);return h}serializeExtension(t){const{profile:n,length:r,datas:s}=t,l=new ArrayBuffer(r+2),h=new Uint8Array(l),p=new DataView(l);let m=0;if(p.setUint8(m++,n),p.setUint8(m++,r),s.forEach(g=>{n?(p.setUint8(m++,g.id),p.setUint8(m++,g.length),h.set(new Uint8Array(g.data),m),m+=g.data.byteLength):(p.setUint8(m++,g.id|g.length<<4),h.set(new Uint8Array(g.data),m),m+=g.data.byteLength)}),m!==r+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(r+2));return l}deserializeExtension(t){const n=new DataView(t);let r=0;const s=n.getUint8(r);r++;const l=n.getUint8(r);r++;const h=s===E6.TWO_BYTE,p=[],m=new DataView(t,2);let g=0;for(;g<l;){let v=0,T=0,C=new ArrayBuffer(0);h?(v=m.getUint8(g),g++,T=m.getUint8(g),g++):(v=15&m.getUint8(g),T=m.getUint8(g)>>4,g++),T>0&&(C=m.buffer.slice(g+2,g+2+T),g+=C.byteLength),p.push({id:v,length:T,data:C})}if(g!==l)throw Error("parse error");return{profile:s,length:l,datas:p}}decompress(t){return XZ(new Uint8Array(t))}compress(t){return YZ(new Uint8Array(t))}}const QZ={name:"DataStream",create:(e,t)=>{const n=t?new iQ(e):new rQ(e);return n.useDataStream(new JZ),n}};class $Z extends ai{constructor(t,n,r){super(),V(this,"ws",void 0),V(this,"requestId",1),V(this,"heartBeatTimer",void 0),V(this,"joinInfo",void 0),V(this,"clientId",void 0),V(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),V(this,"onClose",s=>{this.emit("close"),this.dispose()}),V(this,"onMessage",s=>{const l=JSON.parse(s.data);if(!l||l.command!=="serverResponse"||!l.requestId)return l&&l.command==="serverStatus"&&l.serverStatus&&l.serverStatus.command?(this.emit("status",l.serverStatus),void this.emit(l.serverStatus.command,l.serverStatus)):void 0;this.emit("req_".concat(l.requestId),l)}),this.joinInfo=t,this.clientId=n,this.ws=new sT("cross-channel-".concat(this.clientId),r),this.ws.on(kt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(kt.CONNECTED,this.onOpen),this.ws.on(kt.ON_MESSAGE,this.onMessage),this.ws.on(kt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new Je((n,r)=>{const s=window.setTimeout(()=>{r(new ye(H.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,l=>{window.clearTimeout(s),l.state&&l.state!==0?r(new ye(H.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(s),r(new ye(H.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new ye(H.WS_DISCONNECT);const n=()=>new Je((h,p)=>{this.ws.once(kt.CLOSED,()=>p(new ye(H.WS_ABORT))),this.ws.once(kt.CONNECTED,h)});this.ws.state!=="connected"&&await n();const r=this.sendMessage(t),s=new Je((h,p)=>{const m=()=>{p(new ye(H.WS_ABORT))};this.ws.once(kt.RECONNECTING,m),this.ws.once(kt.CLOSED,m),this.once("req_".concat(r),h),Tr(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(kt.RECONNECTING,m),this.ws.off(kt.CLOSED,m),p(new ye(H.TIMEOUT,"cross channel ws request timeout"))})}),l=await s;if(!l||l.code!==200)throw new ye(H.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(l)));return l}async connect(t){this.ws.removeAllListeners(kt.REQUEST_NEW_URLS),this.ws.on(kt.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class ZZ extends ai{set state(t){t!==this._state&&(t!==la.RELAY_STATE_FAILURE&&(this.errorCode=wE.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,r,s,l){super(),V(this,"joinInfo",void 0),V(this,"sid",void 0),V(this,"clientId",void 0),V(this,"cancelToken",Bs.CancelToken.source()),V(this,"workerToken",void 0),V(this,"requestId",0),V(this,"signal",void 0),V(this,"prevChannelMediaConfig",void 0),V(this,"httpRetryConfig",void 0),V(this,"_resolution",void 0),V(this,"_state",la.RELAY_STATE_IDLE),V(this,"errorCode",wE.RELAY_OK),V(this,"onStatus",h=>{D.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",Bu.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",Bu.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=wE.SRC_TOKEN_EXPIRED,this.state=la.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=wE.DEST_TOKEN_EXPIRED,this.state=la.RELAY_STATE_FAILURE))}),V(this,"onReconnect",async()=>{D.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Bu.NETWORK_DISCONNECTED),this.state=la.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==la.RELAY_STATE_IDLE&&(D.error("auto restart channel media relay failed",h.toString()),this.errorCode=wE.SERVER_CONNECTION_LOST,this.state=la.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=Tm(),this.signal=new $Z(this.joinInfo,this.clientId,r),this.httpRetryConfig=s,this._resolution=l}async startChannelMediaRelay(t){if(this.state!==la.RELAY_STATE_IDLE)throw new ye(H.INVALID_OPERATION);this.state=la.RELAY_STATE_CONNECTING,await this.connect(),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new ye(H.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new ye(H.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new ye(H.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==la.RELAY_STATE_RUNNING)throw new ye(H.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==la.RELAY_STATE_RUNNING)throw new ye(H.INVALID_OPERATION);const n=this.genMessage(Ds.SetVideoProfile);await this.signal.request(n),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),D.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=la.RELAY_STATE_IDLE,this.dispose()}dispose(){D.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Bs.CancelToken.source(),this.state=la.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await l$(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Bu.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(Ds.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=this.genMessage(Ds.SetSdkProfile,t);await this.signal.request(r),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const s=this.genMessage(Ds.SetSourceChannel,t);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Bu.PACKET_JOINED_SRC_CHANNEL),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const l=this.genMessage(Ds.SetSourceUserId,t);await this.signal.request(l),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(Ds.SetDestChannel,t);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Bu.PACKET_JOINED_DEST_CHANNEL),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const p=this.genMessage(Ds.StartPacketTransfer,t);await this.signal.request(p),this.emit("event",Bu.PACKET_SENT_TO_DEST_CHANNEL),this.state=la.RELAY_STATE_RUNNING,D.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(Ds.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",Bu.PACKET_UPDATE_DEST_CHANNEL),D.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Ds.StopPacketTransfer);await this.signal.request(t),D.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const r=[],s=[],l=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Lo,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.3"&&(h.sdkVersion="0.0.1");let p=null,m=null;switch(t){case Ds.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Ds.SetSourceChannel:if(m=n&&n.getSrcChannelMediaInfo(),!m)throw new ye(H.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},h;case Ds.SetSourceUserId:if(m=n&&n.getSrcChannelMediaInfo(),!m)throw new ye(H.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:m.uid+""},h;case Ds.SetDestChannel:if(p=n&&n.getDestChannelMediaInfo(),!p)throw new ye(H.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(g=>{r.push(g.channelName),s.push(g.uid+""),l.push(g.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:r,uid:s,token:l},h;case Ds.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Ds.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Ds.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Ds.UpdateDestChannel:if(p=n&&n.getDestChannelMediaInfo(),!p)throw new ye(H.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(g=>{r.push(g.channelName),s.push(g.uid+""),l.push(g.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:r,uid:s,token:l},h;case Ds.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const eee={name:"ChannelMediaRelay",create:function(e){return new ZZ(e.joinInfo,e.clientId,e.websocketRetryConfig||Gi,e.httpRetryConfig||Gi,e.resolution)}};function y6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function xT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?y6(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class tee extends ai{constructor(t,n,r,s){super(),V(this,"spec",void 0),V(this,"token",void 0),V(this,"websocket",void 0),V(this,"pingpongTimer",void 0),V(this,"reconnectMode","retry"),V(this,"serviceMode",void 0),V(this,"reqId",0),V(this,"commandReqId",0),V(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),V(this,"handleWebSocketMessage",l=>{if(!l.data)return;const h=JSON.parse(l.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(ft.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Fu.TRANSCODE?1:2}),this.emit(pp.PUBLISH_STREAM_STATUS,h))}),this.spec=n,this.token=t,this.serviceMode=s,this.websocket=new sT("live-streaming",r),this.websocket.on(kt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(kt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(kt.REQUEST_NEW_URLS,(l,h)=>{Lr(this,pp.REQUEST_NEW_ADDRESS).then(l).catch(h)}),this.websocket.on(kt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,r,s){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const l=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new ye(H.UNEXPECTED_ERROR);const p=xT({command:t,sdkVersion:Lo==="4.23.3"?"0.0.1":Lo,seq:h,requestId:h,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new ye(H.WS_DISCONNECT);const m=()=>new Je((C,I)=>{this.websocket.once(kt.CLOSED,()=>I(new ye(H.WS_ABORT))),this.websocket.once(kt.CONNECTED,C)});this.websocket.state!=="connected"&&await m(),p.clientRequest&&(p.clientRequest.workerToken=this.token);const g=new Je((C,I)=>{const U=()=>{I(new ye(H.WS_ABORT))};this.websocket.once(kt.RECONNECTING,U),this.websocket.once(kt.CLOSED,U),this.once("@".concat(h,"-").concat(this.spec.sid),k=>{C(k)})});s&&ft.workerEvent(this.spec.sid,xT(xT({},s),{},{requestId:l,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const v=Date.now();this.websocket.sendMessage(p);let T=null;try{T=await g}catch(C){if(this.websocket.state==="closed")throw C;return await m(),await this.request(t,n,r)}return s&&ft.workerEvent(this.spec.sid,xT(xT({},s),{},{requestId:l,actionType:"response",payload:JSON.stringify(T.serverResponse),serverCode:T.code,success:T.code===200,responseTime:Date.now()-v})),T.code!==200&&this.handleResponseError(T),T}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Lo==="4.23.3"?"0.0.1":Lo;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Ji.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void D.warning("live stream response already exists stream");case Ji.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Ji.LIVE_STREAM_RESPONSE_BAD_STREAM:case Ji.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ye(H.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Ji.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new ye(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ji.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ye(H.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Ji.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new ye(H.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(pp.WARNING,n,t.serverResponse.url)}case Ji.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new ye(H.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(pp.WARNING,n,t.serverResponse.url)}case Ji.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ye(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ji.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ye(H.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Ji.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new ye(H.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(pp.WARNING,n,t.serverResponse.url)}case Ji.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ye(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Ji.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ye(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Ji.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ji.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new ye(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ji.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new ye(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new ye(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ji.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ji.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ji.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ji.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ye(H.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Lw)},6e3)}}function v6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function da(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?v6(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class nee extends ai{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Gi,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Gi;super(),V(this,"onLiveStreamWarning",void 0),V(this,"onLiveStreamError",void 0),V(this,"spec",void 0),V(this,"retryTimeout",1e4),V(this,"connection",void 0),V(this,"httpRetryConfig",void 0),V(this,"wsRetryConfig",void 0),V(this,"streamingTasks",new Map),V(this,"isStartingStreamingTask",!1),V(this,"taskMutex",new Wr("live-streaming")),V(this,"cancelToken",Bs.CancelToken.source()),V(this,"transcodingConfig",void 0),V(this,"uapResponse",void 0),V(this,"lastTaskId",1),V(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=da(da({},GQ),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(D.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(h=>da(da(da({},BQ),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){gi(h.width)||On(h.width,"config.width",0,1e4),gi(h.height)||On(h.height,"config.height",0,1e4),gi(h.videoBitrate)||On(h.videoBitrate,"config.videoBitrate",1,1e6),gi(h.videoFrameRate)||On(h.videoFrameRate,"config.videoFrameRate"),gi(h.lowLatency)||Uu(h.lowLatency,"config.lowLatency"),gi(h.audioSampleRate)||er(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),gi(h.audioBitrate)||On(h.audioBitrate,"config.audioBitrate",1,128),gi(h.audioChannels)||er(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),gi(h.videoGop)||On(h.videoGop,"config.videoGop"),gi(h.videoCodecProfile)||er(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),gi(h.userCount)||On(h.userCount,"config.userCount",0,17),gi(h.backgroundColor)||On(h.backgroundColor,"config.backgroundColor",0,16777215),gi(h.userConfigExtraInfo)||Sr(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!gi(h.transcodingUsers)&&(ju(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((p,m)=>{nA(p.uid),gi(p.x)||On(p.x,"transcodingUser[".concat(m,"].x"),0,1e4),gi(p.y)||On(p.y,"transcodingUser[".concat(m,"].y"),0,1e4),gi(p.width)||On(p.width,"transcodingUser[".concat(m,"].width"),0,1e4),gi(p.height)||On(p.height,"transcodingUser[".concat(m,"].height"),0,1e4),gi(p.zOrder)||On(p.zOrder-1,"transcodingUser[".concat(m,"].zOrder"),0,100),gi(p.alpha)||On(p.alpha,"transcodingUser[".concat(m,"].alpha"),0,1,!1)})),gi(h.watermark)||AP(h.watermark,"watermark"),gi(h.backgroundImage)||AP(h.backgroundImage,"backgroundImage"),h.images&&!gi(h.images)&&(ju(h.images,"config.images"),h.images.forEach((p,m)=>{AP(p,"images[".concat(m,"]"))}))}(n);const r=[];n.images&&r.push(...n.images.map(h=>da(da(da({},wP),h),{},{zOrder:255}))),n.backgroundImage&&(r.push(da(da(da({},wP),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(da(da(da({},wP),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(h=>da({},h)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const s=(n.userConfigs||[]).map(h=>typeof h.uid=="number"?Je.resolve(h.uid):z3(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Je.all(s)).forEach((h,p)=>{n.userConfigs&&n.userConfigs[p]&&(n.userConfigs[p].uid=h)}),this.transcodingConfig=n,this.connection)try{var l;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Fs(l=this.streamingTasks).call(l)).map(p=>p.taskId).join("#")});D.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(p=>{D.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,h).then(()=>{D.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(p.url," success"))}).catch(m=>{D.error("[".concat(this.spec.clientId,"] live streaming republish failed"),p.url,m.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,m)})})}}async startLiveStreamingTask(t,n,r){if(!this.transcodingConfig&&n===Fu.TRANSCODE)throw new ye(H.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const s={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};D.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const l=await this.taskMutex.lock();if(!this.connection&&r)return void l();if(this.streamingTasks.get(t)&&!r)return l(),new ye(H.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(p){throw l(),p}switch(n){case Fu.TRANSCODE:s.transcodingConfig=da({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(s.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const p=new Je((g,v)=>{Tr(this.retryTimeout).then(()=>{if(r)return v(r);const T=this.statusError.get(t);return T?(this.statusError.delete(t),v(T)):void 0})}),m=await Je.race([this.connection.request("request",{clientRequest:s},!0,{url:t,command:"PublishStream",workerType:n===Fu.TRANSCODE?1:2,requestByUser:!r,tid:h.toString()}),p]);this.isStartingStreamingTask=!1,D.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(m.code)),this.streamingTasks.set(t,{clientRequest:s,mode:n,url:t,taskId:h}),l()}catch(p){if(l(),this.isStartingStreamingTask=!1,!p.data||!p.data.retry||r)throw p;return p.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,p)):await this.startLiveStreamingTask(t,n,p)}}stopLiveStreamingTask(t){return new Je((n,r)=>{const s=this.streamingTasks.get(t);if(!s||!this.connection)return new ye(H.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const l=s.mode;s.abortTask=()=>{D.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:s.url}},!1,{url:t,command:"UnPublishStream",workerType:l===Fu.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{D.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(r)})}resetAllTask(){var t;const n=Array.from(Fs(t=this.streamingTasks).call(t));this.terminate();for(const r of n)this.startLiveStreamingTask(r.url,r.mode).catch(s=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,s)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Bs.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new ye(H.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Lr(this,IP.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new tee(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(pp.WARNING,(r,s)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(s,r)),this.connection.on(pp.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(pp.REQUEST_NEW_ADDRESS,(r,s)=>{if(!this.connection)return s(new ye(H.UNEXPECTED_ERROR,"can not get new live streaming address list"));Lr(this,IP.REQUEST_WORKER_MANAGER_LIST,t).then(l=>{this.uapResponse=l,r(l.addressList)}).catch(s)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),s=t.reason;switch(t.code){case Ji.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ji.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ji.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ji.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new ye(H.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return D.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,h);if(!this.isStartingStreamingTask)return;this.statusError.set(n,h)}case Ji.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new ye(H.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,s);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,h)}case Ji.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ji.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var l;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Fs(l=this.streamingTasks).call(l));for(const p of h)p.abortTask?p.abortTask():(D.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new ye(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{D.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(m=>{D.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,m)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const iee={name:"LiveStreaming",create:function(e){return new nee(e.joinInfo,e.websocketRetryConfig||Gi,e.httpRetryConfig||Gi)}};function ree(e){let t=R6();return function(n,r){let s=n.appId;s!==void 0&&(Rn(r,10),kd(r,s));let l=n.cid;l!==void 0&&(Rn(r,16),Rn(r,l));let h=n.cname;h!==void 0&&(Rn(r,26),kd(r,h));let p=n.deviceId;p!==void 0&&(Rn(r,34),kd(r,p));let m=n.elapse;m!==void 0&&(Rn(r,40),Ap(r,m));let g=n.fileSize;g!==void 0&&(Rn(r,48),Ap(r,HE(g)));let v=n.height;v!==void 0&&(Rn(r,56),Ap(r,HE(v)));let T=n.jpg;T!==void 0&&(Rn(r,66),Rn(r,T.length),function(qs,Ie){let Ve=zE(qs,Ie.length);qs.bytes.set(Ie,Ve)}(r,T));let C=n.networkType;C!==void 0&&(Rn(r,72),Ap(r,HE(C)));let I=n.osType;I!==void 0&&(Rn(r,80),Ap(r,HE(I)));let U=n.requestId;U!==void 0&&(Rn(r,90),kd(r,U));let k=n.sdkVersion;k!==void 0&&(Rn(r,98),kd(r,k));let M=n.sequence;M!==void 0&&(Rn(r,104),Ap(r,HE(M)));let F=n.sid;F!==void 0&&(Rn(r,114),kd(r,F));let B=n.timestamp;B!==void 0&&(Rn(r,120),Ap(r,B));let ee=n.uid;ee!==void 0&&(Rn(r,128),Rn(r,ee));let ue=n.vid;ue!==void 0&&(Rn(r,136),Rn(r,ue));let de=n.width;de!==void 0&&(Rn(r,144),Ap(r,HE(de)));let ae=n.service;ae!==void 0&&(Rn(r,152),Rn(r,ae));let Te=n.callbackData;Te!==void 0&&(Rn(r,162),kd(r,Te));let Ae=n.jpgEncryption;Ae!==void 0&&(Rn(r,168),Rn(r,Ae));let We=n.requestType;We!==void 0&&(Rn(r,176),Rn(r,We));let tt=n.scorePorn;tt!==void 0&&(Rn(r,185),DL(r,tt));let Ft=n.scoreSexy;Ft!==void 0&&(Rn(r,193),DL(r,Ft));let xt=n.scoreNeutral;xt!==void 0&&(Rn(r,201),DL(r,xt));let wt=n.scene;wt!==void 0&&(Rn(r,208),Rn(r,wt));let qn=n.ossFilePrefix;qn!==void 0&&(Rn(r,218),kd(r,qn));let Pn=n.serviceVendor;if(Pn!==void 0)for(let qs of Pn){Rn(r,226);let Ie=R6();oee(qs,Ie),Rn(r,Ie.limit),uee(r,Ie),dee(Ie)}}(e,t),function(n){let r=n.bytes,s=n.limit;return r.length===s?r:r.subarray(0,s)}(t)}function see(e){return function(n){let r={};e:for(;!b6(n);){let s=xd(n);switch(s>>>3){case 0:break e;case 1:r.code=xd(n);break;case 2:r.msg=C6(n,xd(n));break;case 3:{let l=cee(n);r.data=aee(n),n.limit=l;break}default:S6(n,7&s)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function aee(e){let t={};e:for(;!b6(e);){let n=xd(e);switch(n>>>3){case 0:break e;case 1:t.requestId=C6(e,xd(e));break;case 2:t.requestType=xd(e)>>>0;break;case 3:t.scorePorn=OL(e);break;case 4:t.scoreSexy=OL(e);break;case 5:t.scoreNeutral=OL(e);break;case 6:t.requestScene=xd(e)>>>0;break;case 7:t.scene=xd(e)>>>0;break;default:S6(e,7&n)}}return t}function oee(e,t){let n=e.service;n!==void 0&&(Rn(t,8),Rn(t,n));let r=e.vendor;r!==void 0&&(Rn(t,16),Rn(t,r));let s=e.token;s!==void 0&&(Rn(t,26),kd(t,s));let l=e.callbackUrl;l!==void 0&&(Rn(t,34),kd(t,l))}function cee(e){let t=xd(e),n=e.limit;return e.limit=e.offset+t,n}function S6(e,t){switch(t){case 0:for(;128&w6(e););break;case 2:IL(e,xd(e));break;case 5:IL(e,4);break;case 1:IL(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let lee=new Float32Array(1);new Uint8Array(lee.buffer);let AL=new Float64Array(1),ua=new Uint8Array(AL.buffer);function HE(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let T6=[];function R6(){const e=T6.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function dee(e){T6.push(e)}function IL(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function b6(e){return e.offset>=e.limit}function zE(e,t){let n=e.bytes,r=e.offset,s=e.limit,l=r+t;if(l>n.length){let h=new Uint8Array(2*l);h.set(n),e.bytes=h}return e.offset=l,l>s&&(e.limit=l),r}function NL(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function C6(e,t){let n=NL(e,t),r=String.fromCharCode,s=e.bytes,l="",h="";for(let p=0;p<t;p++){let m,g,v,T,C=s[p+n];(128&C)==0?h+=r(C):(224&C)==192?p+1>=t?h+=l:(m=s[p+n+1],(192&m)!=128?h+=l:(T=(31&C)<<6|63&m,T<128?h+=l:(h+=r(T),p++))):(240&C)==224?p+2>=t?h+=l:(m=s[p+n+1],g=s[p+n+2],(49344&(m|g<<8))!=32896?h+=l:(T=(15&C)<<12|(63&m)<<6|63&g,T<2048||T>=55296&&T<=57343?h+=l:(h+=r(T),p+=2))):(248&C)==240?p+3>=t?h+=l:(m=s[p+n+1],g=s[p+n+2],v=s[p+n+3],(12632256&(m|g<<8|v<<16))!=8421504?h+=l:(T=(7&C)<<18|(63&m)<<12|(63&g)<<6|63&v,T<65536||T>1114111?h+=l:(T-=65536,h+=r(55296+(T>>10),56320+(1023&T)),p+=3))):h+=l}return h}function kd(e,t){let n=t.length,r=0;for(let h=0;h<n;h++){let p=t.charCodeAt(h);p>=55296&&p<=56319&&h+1<n&&(p=(p<<10)+t.charCodeAt(++h)-56613888),r+=p<128?1:p<2048?2:p<65536?3:4}Rn(e,r);let s=zE(e,r),l=e.bytes;for(let h=0;h<n;h++){let p=t.charCodeAt(h);p>=55296&&p<=56319&&h+1<n&&(p=(p<<10)+t.charCodeAt(++h)-56613888),p<128?l[s++]=p:(p<2048?l[s++]=p>>6&31|192:(p<65536?l[s++]=p>>12&15|224:(l[s++]=p>>18&7|240,l[s++]=p>>12&63|128),l[s++]=p>>6&63|128),l[s++]=63&p|128)}}function uee(e,t){let n=zE(e,t.limit),r=e.bytes,s=t.bytes;for(let l=0,h=t.limit;l<h;l++)r[l+n]=s[l]}function w6(e){return e.bytes[NL(e,1)]}function A6(e,t){let n=zE(e,1);e.bytes[n]=t}function OL(e){let t=NL(e,8),n=e.bytes;return ua[0]=n[t++],ua[1]=n[t++],ua[2]=n[t++],ua[3]=n[t++],ua[4]=n[t++],ua[5]=n[t++],ua[6]=n[t++],ua[7]=n[t++],AL[0]}function DL(e,t){let n=zE(e,8),r=e.bytes;AL[0]=t,r[n++]=ua[0],r[n++]=ua[1],r[n++]=ua[2],r[n++]=ua[3],r[n++]=ua[4],r[n++]=ua[5],r[n++]=ua[6],r[n++]=ua[7]}function xd(e){let t,n=0,r=0;do t=w6(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function Rn(e,t){for(t>>>=0;t>=128;)A6(e,127&t|128),t>>>=7;A6(e,t)}function Ap(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,l=s===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:s<128?9:10,h=zE(e,l),p=e.bytes;switch(l){case 10:p[h+9]=s>>>7&1;case 9:p[h+8]=l!==9?128|s:127&s;case 8:p[h+7]=l!==8?r>>>21|128:r>>>21&127;case 7:p[h+6]=l!==7?r>>>14|128:r>>>14&127;case 6:p[h+5]=l!==6?r>>>7|128:r>>>7&127;case 5:p[h+4]=l!==5?128|r:127&r;case 4:p[h+3]=l!==4?n>>>21|128:n>>>21&127;case 3:p[h+2]=l!==3?n>>>14|128:n>>>14&127;case 2:p[h+1]=l!==2?n>>>7|128:n>>>7&127;case 1:p[h]=l!==1?128|n:127&n}}function I6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}const hee=new Map([["moderation",1],["supervise",2]]);class pee extends ai{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(pr.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=na(n=t.map(r=>hee.get(r)||0)).call(n,(r,s)=>r+s),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),V(this,"name","AgoraRTCVideoContentInspect"),V(this,"_connectionState",Ic.CONNECTING),V(this,"_innerConnectionState",void 0),V(this,"sequence",0),V(this,"inspectStartTime",void 0),V(this,"workerManagerConnection",void 0),V(this,"workerConnection",void 0),V(this,"workerMessageLengthLimit",void 0),V(this,"inspectIntervalMinimum",void 0),V(this,"qualityRatio",void 0),V(this,"_connectInfo",void 0),V(this,"_cancelTokenSource",Bs.CancelToken.source()),V(this,"_retryConfig",void 0),V(this,"wmSequence",0),V(this,"inspectInterval",void 0),V(this,"inspectTimer",null),V(this,"ossFilePrefix",void 0),V(this,"extraInfo",void 0),V(this,"_inspectType",void 0),V(this,"_inspectMode",void 0),V(this,"_quality",1),V(this,"qualityTimer",null),V(this,"_inspectId",void 0),V(this,"_needWorkUrlOnly",!1),V(this,"inspectImage",()=>{if(this.connectionState!==Ic.CONNECTED)throw new ye(H.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Ic.CONNECTED?this.requestToInspectImage():D.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Bn(5,"inspect-"),this.workerMessageLengthLimit=Y("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=Y("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=Y("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new sT("worker-manager-"+this._inspectId,Gi),this.on(pr.STATE_CHANGE,(n,r)=>{this._innerConnectionState=n,D.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Nc[n]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new sT("worker-"+this._inspectId,Gi),this.handleWorkerEvents()}async init(t,n){this.emit(pr.STATE_CHANGE,Nc.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new Je((s,l)=>{this.on(pr.CONNECTION_STATE_CHANGE,(h,p)=>{p===Ic.CONNECTED&&s()}),this.requestAP(t,r,n).then(h=>{this.connectWorkerManager(h)}).catch(h=>{l(h)})})}async requestAP(t,n,r){const s=Y("WEBCS_DOMAIN").map(p=>"https://".concat(p,"/api/v1")),l=await function(p,m,g,v){let{appId:T,areaCode:C,cname:I,sid:U,token:k,uid:M}=m;LE++;const F="image_moderation_api",B={service_name:F,json_body:JSON.stringify({appId:T,areaCode:C,cname:I,command:"allocateEdge",requestId:LE,seq:LE,sid:U,token:k,ts:Date.now(),uid:M+""})};let ee,ue,de=p[0];return El(async()=>{ee=Date.now();const ae=await Rl(de,{data:B,cancelToken:g,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ue=Date.now()-ee,ae.code!==0){const tt=new ye(H.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ae.code,{retry:!0,responseTime:ue});throw D.error(tt.toString()),tt}const Te=JSON.parse(ae.json_body);if(Te.code!==200){const tt=new ye(H.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Te.code,", reason: ").concat(Te.reason),{code:Te.code,responseTime:ue});throw D.error(tt.toString()),tt}if(!Te.servers||!Array.isArray(Te.servers)||Te.servers.length===0){const tt=new ye(H.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Te.code,responseTime:ue});throw D.error(tt.toString()),tt}const Ae=Y("VIDEO_INSPECT_WORKER_MANAGER_HOST"),We=Y("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Te.servers.map(tt=>{let{address:Ft,wss:xt}=tt;if(Ft&&xt)return"wss://".concat(Ft.replace(/\./g,"-"),".").concat(Ae,":").concat(We||xt)}).filter(tt=>!!tt),workerToken:Te.workerToken,vid:Te.vid,responseTime:ue}},(ae,Te)=>(ft.apworkerEvent(U,{success:!0,sc:200,serviceName:F,responseDetail:JSON.stringify(ae.addressList),firstSuccess:Te===0,responseTime:ue,serverIp:p[Te%p.length]}),!1),(ae,Te)=>(ft.apworkerEvent(U,{success:!1,sc:ae.data&&ae.data.code||200,serviceName:F,responseTime:ue,serverIp:p[Te%p.length]}),!!(ae.code!==H.OPERATION_ABORTED&&ae.code!==H.UNEXPECTED_RESPONSE||ae.data&&ae.data.retry)&&(de=p[(Te+1)%p.length],!0)),v)}(s,t,n,r);this.emit(pr.STATE_CHANGE,Nc.AP_CONNECTED);const{addressList:h}=l;return this.wmSequence++,h}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(pr.STATE_CHANGE,Nc.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(kt.CONNECTED,async()=>{this.emit(pr.STATE_CHANGE,Nc.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.3",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(kt.CLOSED,()=>{this._innerConnectionState<Nc.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(kt.FAILED,()=>{this._innerConnectionState<Nc.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(kt.RECONNECTING,()=>{this._innerConnectionState<Nc.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(kt.ON_MESSAGE,async t=>{this.emit(pr.STATE_CHANGE,Nc.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(t.data);if(r.code!==200)throw D.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new ye(H.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw D.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new ye(H.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const s=Y("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,l=n.replace(/:\d+\/?$/,":".concat(s));this.emit(pr.STATE_CHANGE,Nc.CONNECT_WORKER,l),this._needWorkUrlOnly?this.emit(pr.REQUEST_NEW_WORKER_URL,l):await this.connectWorker(l)}}),this.workerManagerConnection.on(kt.WILL_RECONNECT,(t,n,r)=>{r(t)}),this.workerManagerConnection.on(kt.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(kt.CONNECTED,async()=>{this.emit(pr.STATE_CHANGE,Nc.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ic.CONNECTED}),this.workerConnection.on(kt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=see(new Uint8Array(t.data));if(Y("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&D.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(pr.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;const s={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},l=na(n=Object.keys(s)).call(n,(p,m)=>s[p]>s[m]?p:m,"porn"),h=Object.keys(s).find(p=>p===l);this.emit(pr.INSPECT_RESULT,h)}else this.emit(pr.INSPECT_RESULT,void 0,new ye(H.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(pr.INSPECT_RESULT,void 0,new ye(H.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else D.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(pr.INSPECT_RESULT,void 0,new ye(H.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(kt.CLOSED,()=>{this.connectionState=Ic.CLOSED}),this.workerConnection.on(kt.FAILED,()=>{this.connectionState=Ic.CLOSED}),this.workerConnection.on(kt.RECONNECTING,()=>{this.connectionState=this.connectionState===Ic.CONNECTED?Ic.RECONNECTING:Ic.CONNECTING}),this.workerConnection.on(kt.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this.workerConnection.on(kt.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(pr.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{n(r)})})}async requestToInspectImage(){this.sequence++;const t=eo(this,pr.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(pr.INSPECT_RESULT,void 0,new ye(H.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(t,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(pr.INSPECT_RESULT,void 0,new ye(H.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:r,cname:s,cid:l,vid:h,sid:p,uid:m}=n;const g=Date.now(),v=await t.getCurrentFrameImage("image/jpeg",this.quality),T=await dF(v,r,s),C=this.sequence+"-"+l+"-"+m+"-"+g+"-"+Bn(12,""),I={appId:r,cid:l,cname:s,deviceId:"",elapse:(U=Number(g-this.inspectStartTime),{low:U|=0,high:U>>31,unsigned:U>=0}),fileSize:T.byteLength,jpgEncryption:2,height:v.height,width:v.width,jpg:T,networkType:6,osType:7,requestId:C,sdkVersion:"4.23.3",sequence:this.sequence,sid:p,timestamp:M4(g),uid:m,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var U;this.extraInfo===void 0&&delete I.callbackData,this.ossFilePrefix===void 0&&delete I.ossFilePrefix;const k=ree(I);if(k.byteLength<this.workerMessageLengthLimit){if(Y("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const M=function(F){for(var B=1;B<arguments.length;B++){var ee=arguments[B]!=null?arguments[B]:{};B%2?I6(Object(ee),!0).forEach(function(ue){V(F,ue,ee[ue])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(ee)):I6(Object(ee)).forEach(function(ue){Object.defineProperty(F,ue,Object.getOwnPropertyDescriptor(ee,ue))})}return F}({},I);delete M.jpg,D.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(M))}return k}{const M=this.quality*this.qualityRatio;return this.quality=M,await this.generateRequestData(t,{appId:r,cname:s,cid:l,vid:h,sid:p,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Bs.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ic.CLOSED,this.emit(pr.STATE_CHANGE,Nc.CLOSED)}}const fee={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new ye(H.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new ye(H.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const r=[...new Set(n.inspectType)];r.forEach(s=>{var l;if(!Ye(l=["supervise","moderation"]).call(l,s))throw new ye(H.INVALID_PARAMS,"".concat(s," is not a valid inspect type."))}),n.inspectType=r}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new ye(H.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new pee(t)}};var N6=f(ui.Object.getOwnPropertySymbols),mee=dn,_ee=Wa.indexOf,gee=iu,PL=fe([].indexOf),O6=!!PL&&1/PL([1],1,-0)<0;mee({target:"Array",proto:!0,forced:O6||!gee("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return O6?PL(this,e,t)||0:_ee(this,e,t)}});var Eee=ba("Array","indexOf"),yee=W,vee=Eee,LL=Array.prototype,See=function(e){var t=e.indexOf;return e===LL||yee(LL,e)&&t===LL.indexOf?vee:t},D6=f(See);function Tee(e,t){if(e==null)return{};var n,r,s=function(h,p){if(h==null)return{};var m={};for(var g in h)if({}.hasOwnProperty.call(h,g)){if(D6(p).call(p,g)!==-1)continue;m[g]=h[g]}return m}(e,t);if(N6){var l=N6(e);for(r=0;r<l.length;r++)n=l[r],D6(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}let P6=class{get localCapabilities(){return oi(this._localCapabilities)}get rtpCapabilities(){return oi(this._rtpCapabilities)}get candidates(){return oi(this._candidates)}get iceParameters(){return oi(this._iceParameters)}get dtlsParameters(){return oi(this._dtlsParameters)}constructor(e){V(this,"sessionDesc",void 0),V(this,"_localCapabilities",void 0),V(this,"_rtpCapabilities",void 0),V(this,"_candidates",void 0),V(this,"_iceParameters",void 0),V(this,"_dtlsParameters",void 0),V(this,"setup",void 0),V(this,"currentMidIndex",void 0),V(this,"cname","o/i14u9pJrxRKAsu"),V(this,"firefoxSsrcMidMap",new Map),e=oi(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:s,localCapabilities:l,direction:h,setup:p,videoCodec:m,audioCodec:g}=e;let v;this.setup=p,v=h===Os.RECEIVE_ONLY?ca(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ca(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=s,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=l;const T=h===Os.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,C=h===Os.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,I=h===Os.RECEIVE_ONLY?s.send.videoCodecs:cT(it.VIDEO,T,C,m),U=h===Os.RECEIVE_ONLY?s.send.audioCodecs:cT(it.AUDIO,T,C,g);for(const k of v.mediaDescriptions)k.attributes.iceUfrag=t.iceUfrag,k.attributes.icePwd=t.icePwd,k.attributes.fingerprints=n.fingerprints,k.attributes.candidates=r,k.attributes.setup=this.setup,k.media.mediaType==="application"&&(k.attributes.sctpPort="5000"),k.media.mediaType==="video"&&(k.media.fmts=I.map(M=>M.payloadType.toString(10)),k.attributes.payloads=I,k.attributes.extmaps=T.videoExtensions),k.media.mediaType==="audio"&&(k.media.fmts=U.map(M=>M.payloadType.toString(10)),k.attributes.payloads=U,k.attributes.extmaps=T.audioExtensions,PE(k));this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}toString(){return hp(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,r,s){n=n.replace(/ /g,"-");const{ssrcs:l,ssrcGroups:h}=Dm(t,this.cname,Y("SYNC_GROUP")?n:void 0),p=this.findPreloadMediaDesc(l);if(p){if(_i()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,p.attributes.mid),s&&(s.twcc||s.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(p,s),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(e,l,r);let g;return m===-1?(g=this.createOrRecycleSendMedia(e,l,h,"sendonly",r,s),this.updateBundleMids()):(g=oi(this.sessionDesc.mediaDescriptions[m]),g.attributes.direction="sendonly",g.attributes.ssrcs=l,g.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(g,s)),_i()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,g.attributes.mid),{needExchangeSDP:!0,mid:g.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach(s=>{const l=s._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(l);let p,m=!1;h===-1?(m=!0,p=this.createOrRecycleRecvMedia(s,[],"recvonly",t,n),this.updateBundleMids()):(p=oi(this.sessionDesc.mediaDescriptions[h]),p.attributes.direction="recvonly"),r.push({mid:p.attributes.mid,needCreateTransceiver:m})}),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:s,type:l,relatedAddress:h,relatedPort:p,priority:m}=new RTCIceCandidate(e),g={foundation:t??"",componentId:"1",transport:n??"",priority:m?m+"":"",connectionAddress:r??"",port:s?s+"":"",type:l?l+"":"",relAddr:h??"",relPort:p?p+"":"",extension:{}};this.candidates.some(v=>v.priority===g.priority&&v.connectionAddress===g.connectionAddress&&v.port===g.port)||(this._candidates.push(g),this.sessionDesc.mediaDescriptions.forEach(v=>{v.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,s){const l=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,p=cT(l,h,this.localCapabilities.send,l===it.AUDIO?s:r),m=l===it.VIDEO?h.videoExtensions:h.audioExtensions,g="".concat(++this.currentMidIndex);let v={media:{mediaType:l,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};v=this.mungRecvMediaDsec(v,e);const T=this.findFirstClosedMedia(l);if(T){const C=this.sessionDesc.mediaDescriptions.indexOf(T);this.sessionDesc.mediaDescriptions[C]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Ye(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Ye(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const s=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(_i()){if(s){const l=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(l||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!l||l!==r.attributes.mid)}return!1}return s&&r.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=oi(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,r,s,l){const h=this.rtpCapabilities.send,p=e===it.VIDEO?h.videoCodecs:h.audioCodecs,m=e===it.VIDEO?h.videoExtensions:h.audioExtensions;_i()&&(s="".concat(++this.currentMidIndex));let g={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:s}};g=this.mungSendMediaDesc(g,l);const v=this.findFirstClosedMedia(e);if(v){const T=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[T]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}mungRecvMediaDsec(e,t,n){const r=oi(e);return kP(r),DE(r,t),xP(r,t),b3(r),lA(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=oi(e);return lA(n,t,this.localCapabilities.recv),PE(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(n!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>_i()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const Ree=["sdp"];var Jn;function L6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function Ip(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?L6(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let k6=(Jn=class ZE extends a3{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),V(this,"direction",void 0),V(this,"name",void 0),V(this,"store",void 0),V(this,"spec",void 0),V(this,"peerConnection",void 0),V(this,"initialOffer",void 0),V(this,"transport",void 0),V(this,"statsFilter",void 0),V(this,"localCandidateCount",0),V(this,"_isInRestartIce",!1),V(this,"mutex",void 0),V(this,"onLocalCandidate",void 0),V(this,"remoteSDP",void 0),V(this,"pendingCandidates",[]),V(this,"localCapabilities",void 0),V(this,"isReady",!1),V(this,"restartCnt",0),V(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new Wr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(ZE.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??Os.SEND_ONLY,this.name=this.direction===Os.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=KD(this.peerConnection,Y("STATS_UPDATE_INTERVAL"),void 0,_i()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await w3();if(this.localCapabilities=dA(n),t){const{sdp:r}=t,s=Tee(t,Ree),l=function(){const v={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},T=oT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},U={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Oc(T,v,"videoExtensions",C,I,U),Oc(T,v,"videoCodecs",C,I,U),Oc(T,v,"audioExtensions",C,I,U),Oc(T,v,"audioCodecs",C,I,U),Y("RAISE_H264_BASELINE_PRIORITY")){const k=U.videoCodecs.findIndex(M=>M.rtpMap&&M.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&M.fmtp&&M.fmtp.parameters["profile-level-id"]==="42001f");if(k!==-1){const M=U.videoCodecs.findIndex(F=>F.rtpMap&&F.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(M<k){D.debug("raising H264 baseline profile priority");const F=U.videoCodecs[k];U.videoCodecs.splice(k,1),U.videoCodecs.splice(M,0,F)}M!==-1&&Y("FILTER_SEND_H264_BASELINE")&&(C.videoCodecs=C.videoCodecs.filter(F=>!(F.rtpMap&&F.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&F.fmtp&&F.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:C,recv:I,sendrecv:U}}({},{},r);this.remoteSDP=new P6({remoteIceParameters:s.iceParameters,remoteDtlsParameters:s.dtlsParameters,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const p=gp(h.sdp);await this.peerConnection.setLocalDescription(h);const m=await A3({},{},h.sdp);this.localCapabilities=dA(m);const g=this.peerConnection.getTransceivers()[0];return g!=null&&g.receiver&&g.receiver.transport&&this.tryBindTransportEvents(g.receiver.transport),Ip(Ip({},p),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=gp(r.sdp);return this.initialOffer=r,Ip(Ip({},s),{},{sdp:r.sdp})}}catch(n){throw new Re(H.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:r,dtlsParameters:s}=t,l=await A3({},{},n);this.remoteSDP=new P6({remoteIceParameters:r,remoteDtlsParameters:s,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new Re(H.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,r){var s=this;return Po(function*(){const l=yield an(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],p=s.remoteSDP.receive(t,n,r);t.forEach((M,F)=>{if(p[F].needCreateTransceiver){const B=s.peerConnection.addTransceiver(M._mediaStreamTrack,{direction:"sendonly"});h.push(B),M._updateRtpTransceiver(B)}else{const B=s.peerConnection.getTransceivers().find(ee=>ee.mid===p[F].mid);if(!B)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(p[F].mid));h.push(B),M._updateRtpTransceiver(B)}}),_i()&&Y("SIMULCAST")===!0&&(yield an(s.applySimulcastForFirefox(h,t)));const m=p.map(M=>M.mid),g=yield an(s.peerConnection.createOffer()),v=s.mungSendOfferSDP(g.sdp,t,m),T=ca(v),C=m.map(M=>{const F=T.mediaDescriptions.find(B=>B.attributes.mid===M);if(!F)throw new Error("Cannot extract ssrc from mediaDescription.");return S3(F,Y("USE_PUB_RTX"))}),I=h.map((M,F)=>{const B=m[F];return{localSSRC:C[F],id:B}});yield an(s.peerConnection.setLocalDescription({type:"offer",sdp:v}));try{yield I}catch(M){const F=s.remoteSDP.toString();throw yield an(s.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield an(s.peerConnection.setRemoteDescription({type:"answer",sdp:F})),yield an(s.stopSending(m,!0)),M}yield an(s.applySimulcastEncodings(h,t)),yield an(s.applySendEncodings(h,t));const U=s.remoteSDP.toString(),k=s.logSDPExchange(v,"offer","local","send");return k==null||k(U),yield an(s.setRemoteDescription({type:"answer",sdp:U})),h.map((M,F)=>{const B=m[F];return{localSSRC:C[F],id:B}})}catch(h){throw h instanceof Re?h:new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{l()}})()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length (".concat(s.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));s.map(m=>{var g;m.direction="inactive",(g=m.stop)===null||g===void 0||g.call(m)});const l=await this.peerConnection.createOffer(),h=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const p=this.remoteSDP.toString();h==null||h(p),await this.setRemoteDescription({type:"answer",sdp:p})}catch(s){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{r&&r()}}async receive(t,n,r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:h}=this.remoteSDP.send(t,n,r,s);if(h){const m=this.remoteSDP.toString(),g=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const v=await this.peerConnection.createAnswer(),T=this.mungReceiveAnswerSDP(v.sdp,l,t);g==null||g(T||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:T}),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const p=this.peerConnection.getTransceivers().find(m=>m.mid===l);if(!p||p.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,mid:p.mid,transceiver:p}}catch(l){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async mockReceive(t,n,r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:h}=this.remoteSDP.send(t,n,r,s);if(h){const p=this.remoteSDP.toString(),m=this.logSDPExchange(p,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:p});const g=await this.peerConnection.createAnswer(),v=this.mungReceiveAnswerSDP(g.sdp,l,t);m==null||m(v||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:v}),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(l){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();r==null||r(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Rm.Auto&&(this.store.p2pTransport=Rm.SdRtn,cn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(ZE.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,cn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(ZE.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=gp(n.sdp);return this.store.descriptionStart(),this.direction===Os.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Os.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=gp(n.sdp);return await this.peerConnection.setLocalDescription(n),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const l=this.remoteSDP.toString(),h=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),h==null||h(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new Re(H.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(s=>s.mid===t);r.length===1&&(this.isVP8Simulcast(n)?_i()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(s=>s.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:s}=n.getSelectedCandidatePair();return{local:Ip(Ip({},Sd),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Ip(Ip({},Sd),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;Ye(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s={iceServers:[]};var l;return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(KS(t.turnServer.servers)?s.iceServers=t.turnServer.servers:(s.iceServers&&s.iceServers.push(...ZE.turnServerConfigToIceServers(t.turnServer.servers,n,r)),Y("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...ZE.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),Ye(l=[Rm.Relay,Rm.SdRtn]).call(l,n)&&(s.iceTransportPolicy="relay"),Y("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(s.iceTransportPolicy="relay")}))),Y("ENABLE_ENCODED_TRANSFORM")&&cn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),D.debug("P2PConnection p2pTransport is ".concat(n)),s}static turnServerConfigToIceServers(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=[],l=t.filter(p=>p.tcpport);D.debug("P2PConnection turnServers is ".concat(l,", current index is ").concat(r));const h=l.length>r?l[r]:l[0];switch(n){case Rm.SdRtn:const p=t.filter(g=>{var v;return Ye(v=g.username).call(v,"glb:")&&g.turnServerURL==g.turnServerURL}),m=p.length>r?p[r]:p[0];m&&(s.push({username:m.username,credential:m.password,credentialType:"password",urls:"turn:".concat(mp(m.turnServerURL),":").concat(m.tcpport,"?transport=udp")}),s.push({username:m.username,credential:m.password,credentialType:"password",urls:"turns:".concat(mp(m.turnServerURL),":").concat(m.tcpport,"?transport=tcp")}));break;case Rm.Relay:h&&(s.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),s.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(mp(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(s.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),s.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(mp(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),s.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return s}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in r?r.error:r)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const r=t==null?void 0:t.iceTransport.state;var s;r&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:r,remote:s}=n.getSelectedCandidatePair();D.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(v=>v.track===t._mediaStreamTrack)),!n)return D.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return D.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!cn().supportSetRtpSenderParameters)return D.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},l={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(t._encoderConfig){var h;const{bitrateMax:v,frameRate:T,scaleResolutionDownBy:C}=t._encoderConfig;v&&(l.maxBitrate=1e3*v),Ye(h=t._hints).call(h,Dn.LOW_STREAM)&&(T&&(l.maxFramerate=xa(T)),C&&C>=1&&(l.scaleResolutionDownBy=C))}if(Y("DSCP_TYPE")&&Mu()){var p;const v=Y("DSCP_TYPE");Ye(p=["very-low","low","medium","high"]).call(p,v)&&(l.networkPriority=v)}const m=n.getParameters(),g=(r=m.encodings)===null||r===void 0?void 0:r[0];_i()&&!g&&(s.encodings=[l]),g&&Object.assign(g,l),Object.assign(m,s),D.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await n.setParameters(m)}async applySendEncodings(t,n){try{if(!cn().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const s=t[r],l=n[r];l instanceof Xn&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,s.sender)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const s=ca(t);return n.forEach((l,h)=>{const p=r[h],m=s.mediaDescriptions.find(g=>g.attributes.mid===p);m&&(DE(m,l),C3(m,l,this.store.codec))}),hp(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let m=0;m<t.length;m++){var r,s,l,h,p;const g=t[m],v=n[m];if(v instanceof Xn&&!Ye(r=v._hints).call(r,Dn.LOW_STREAM)&&(s=v._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((l=v._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(h=v._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((p=v._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){const T={},C={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};T.encodings=[{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:C.high}];const I=g.sender.getParameters();await g.sender.setParameters(Object.assign(I,T))}}}async applySimulcastEncodings(t,n){if(!_i()&&t.length===n.length)for(let r=0;r<t.length;r++){const s=n[r];if(s instanceof Xn&&this.isVP8Simulcast(s)){const l=t[r],h={},p={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];const m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,h))}}}isVP8Simulcast(t){var n,r,s,l,h;return!!(t instanceof Xn&&Y("SIMULCAST")&&this.store.codec==="vp8"&&!Ye(n=t._hints).call(n,Dn.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,n,r,s){if(Y("SDP_LOGGING"))return D.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(s,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",r==="local"?"remote":"local",s)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(h=>{h.direction="inactive"});const r=await this.peerConnection.createOffer(),s=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();s==null||s(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async h=>{h.direction="sendonly"});const r=await this.peerConnection.createOffer(),s=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const l=this.remoteSDP.toString();s==null||s(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var r;if(n=n??((r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp)){var s;const l=(s=ca(n).mediaDescriptions.find(h=>h.attributes.mid===t))===null||s===void 0?void 0:s.attributes.ssrcs;return l==null?void 0:l[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),Ye(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,r){const s=ca(t),l=s.mediaDescriptions.find(h=>h.attributes.mid===n);return l&&r===it.AUDIO&&l.media.mediaType==="audio"&&PE(l),hp(s)}},ut(Jn.prototype,"establish",[Mc],Object.getOwnPropertyDescriptor(Jn.prototype,"establish"),Jn.prototype),ut(Jn.prototype,"connect",[Mc],Object.getOwnPropertyDescriptor(Jn.prototype,"connect"),Jn.prototype),ut(Jn.prototype,"receive",[Mc],Object.getOwnPropertyDescriptor(Jn.prototype,"receive"),Jn.prototype),ut(Jn.prototype,"mockReceive",[Mc],Object.getOwnPropertyDescriptor(Jn.prototype,"mockReceive"),Jn.prototype),ut(Jn.prototype,"stopReceiving",[Mc],Object.getOwnPropertyDescriptor(Jn.prototype,"stopReceiving"),Jn.prototype),ut(Jn.prototype,"restartICE",[Mc],Object.getOwnPropertyDescriptor(Jn.prototype,"restartICE"),Jn.prototype),ut(Jn.prototype,"close",[Mc],Object.getOwnPropertyDescriptor(Jn.prototype,"close"),Jn.prototype),ut(Jn.prototype,"updateEncoderConfig",[Mc],Object.getOwnPropertyDescriptor(Jn.prototype,"updateEncoderConfig"),Jn.prototype),ut(Jn.prototype,"updateSendParameters",[Mc],Object.getOwnPropertyDescriptor(Jn.prototype,"updateSendParameters"),Jn.prototype),ut(Jn.prototype,"replaceTrack",[Mc],Object.getOwnPropertyDescriptor(Jn.prototype,"replaceTrack"),Jn.prototype),ut(Jn.prototype,"muteLocal",[Mc],Object.getOwnPropertyDescriptor(Jn.prototype,"muteLocal"),Jn.prototype),ut(Jn.prototype,"unmuteLocal",[Mc],Object.getOwnPropertyDescriptor(Jn.prototype,"unmuteLocal"),Jn.prototype),Jn);function Mc(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,l=await s.lock("From P2PConnection.".concat(t));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return await r.apply(this,p)}finally{l()}},n}let Cl=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var x6,M6,U6,j6,V6,F6,B6,G6,H6,z6,W6,si;function q6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function WA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?q6(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let bee=(x6=wl(Cl.SEND_ONLY),M6=wl(Cl.SEND_ONLY),U6=wl(),j6=wl(Cl.RECEIVE_ONLY),V6=wl(Cl.RECEIVE_ONLY),F6=wl(Cl.RECEIVE_ONLY),B6=wl(Cl.RECEIVE_ONLY),G6=wl(Cl.RECEIVE_ONLY),H6=wl(Cl.RECEIVE_ONLY),z6=wl(),W6=wl(Cl.RECEIVE_ONLY),si=class extends ai{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(_t.StateChange,t,this._state)}constructor(e,t){super(),V(this,"isPlanB",!1),V(this,"store",void 0),V(this,"statsUploader",void 0),V(this,"sendConnection",void 0),V(this,"recvConnection",void 0),V(this,"localTrackMap",new Map),V(this,"remoteUserMap",new Map),V(this,"localDataChannels",[]),V(this,"pendingLocalTracks",[]),V(this,"pendingRemoteTracks",[]),V(this,"statsCollector",void 0),V(this,"dtlsFailedCount",0),V(this,"sendMutex",void 0),V(this,"recvMutex",void 0),V(this,"_state",yn.Disconnected),V(this,"_restartStates",["disconnected","failed"]),V(this,"reconnectInterval",void 0),V(this,"uploadUnplinkStarted",!1),V(this,"uploadDownlinkStarted",!1),V(this,"uplinkStateUploadInterval",void 0),V(this,"downlinkStatsUploadInterval",void 0),V(this,"handleMuteLocalTrack",async(n,r,s)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==yn.Connected)return void s(new Re(H.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const m=this.filterTobeMutedTracks(n);if(m.length===0)return void r();const g=m.find(I=>I[0]==="videoLowTrack");g&&g[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(m.map(I=>{let[,{id:U}]=I;return U}));let v=!1;var h,p;n.trackMediaType==="video"?v=!((h=this.localTrackMap.get(Le.LocalAudioTrack))===null||h===void 0||!h.track._muted):v=((p=this.localTrackMap.get(Le.LocalVideoTrack))===null||p===void 0?void 0:p.id)===void 0;const T=this.createMuteMessage(m);await Mn(this,_t.RequestMuteLocal,T);const C=n.trackMediaType==="video"?fp.MUTE_LOCAL_VIDEO:fp.MUTE_LOCAL_AUDIO;await Mn(this,_t.RequestP2PMuteLocal,{action:C,message:T,isMuteAll:v}),r()}catch(m){s(m)}finally{l()}}),V(this,"handleUnmuteLocalTrack",async(n,r,s)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==yn.Connected)return void s(new Re(H.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(n);if(h.length===0)return void r();await this.sendConnection.unmuteLocal(h.map(g=>{let[,{id:v}]=g;return v}));const p=this.createUnmuteMessage(h),m=n.trackMediaType==="video"?fp.UNMUTE_LOCAL_VIDEO:fp.UNMUTE_LOCAL_AUDIO;await Mn(this,_t.RequestP2PMuteLocal,{action:m,message:p}),r()}catch(h){s(h)}finally{l()}}),V(this,"handleUpdateVideoEncoder",async(n,r,s,l)=>{let h;typeof l=="boolean"&&l||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const m=this.localTrackMap.get(Le.LocalVideoTrack);if(!this.sendConnection||!m||m.track!==n||this.state!==yn.Connected)return void r();const{id:g,track:v}=m;g&&(await this.sendConnection.updateSendParameters(g,v),await this.sendConnection.updateEncoderConfig(g,v),this.emit(_t.UpdateVideoEncoder,v)),r()}catch(m){s(m)}finally{var p;(p=h)===null||p===void 0||p()}}),V(this,"handleUpdateVideoSendParameters",async(n,r,s)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Le.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==n||this.state!==yn.Connected)return void r();const{id:p,track:m}=h;p&&await this.sendConnection.updateSendParameters(p,m),r()}catch(h){s(h)}finally{l()}}),V(this,"handleReplaceTrack",async(n,r,s,l)=>{let h;D.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof l=="boolean"&&l||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var p;const g=Array.from(this.localTrackMap.entries()).find(v=>{let[,{track:T}]=v;return n===T});if(!this.sendConnection||!g||g[1].id===void 0||this.state!==yn.Connected)return void r();if(await((p=this.sendConnection)===null||p===void 0?void 0:p.replaceTrack(n,g[1].id)),g[0]===Le.LocalVideoTrack&&cn().supportDualStreamEncoding){const v=this.localTrackMap.get(Le.LocalVideoLowTrack);if(v){const T=n._mediaStreamTrack.clone();v.track._originMediaStreamTrack.stop(),v.track._mediaStreamTrack=T,v.track._originMediaStreamTrack=T,await new Je((C,I)=>{this.handleReplaceTrack(v.track,C,I,!0)})}}r()}catch(g){s(g)}finally{var m;(m=h)===null||m===void 0||m()}}),V(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),V(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),V(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),V(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new d4(e),this.bindStatsUploaderEvents(),this.sendMutex=new Wr("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Wr("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},Y("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new Re(H.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Re(H.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new k6(e,this.store,Os.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=yn.New,this.sendConnection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new k6(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new Re(H.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=yn.Connected}async addRemoteCandidate(e,t){if(t===Os.RECEIVE_ONLY){if(!this.sendConnection)throw new Re(H.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Re(H.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return Po(function*(){const s=yield an(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==yn.Connected){r.throwIfTrackTypeNotMatch(e);const g=e.filter(v=>r.pendingLocalTracks.indexOf(v)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(g))}r.store.pubId=r.store.pubId+1,Yr.markPublishStart(r.store.clientId,r.store.pubId);const l=r.filterTobePublishedTracks(e,t,n);if(l.length===0)return void(yield an(r.tryToUnmuteAudio(e)));l.forEach(g=>{let{track:v,type:T}=g;const C=Date.now();r.store.publish(v.getTrackId(),T===Le.LocalAudioTrack?"audio":"video",C)}),r.bindLocalTrackEvents(l);const h=yield an(r.sendConnection.send(l.map(g=>{let{track:v}=g;return v}),r.store.codec,r.store.audioCodec)),p=(yield an(h.next())).value,m=r.createGatewayPublishMessage(l,p);try{yield m}catch(g){throw h.throw(g),(g==null?void 0:g.code)===H.WS_ABORT&&l.forEach(v=>{let{track:T}=v;r.pendingLocalTracks.indexOf(T)===-1&&r.pendingLocalTracks.push(T)}),r.unbindLocalTrackEvents(l),g}yield an(h.next()),l.forEach(g=>{let{type:v}=g;r.statsCollector.addLocalStats(v)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(l,p),l.forEach(g=>{let{track:v,type:T}=g;const C=Date.now();r.store.publish(v.getTrackId(),T===Le.LocalAudioTrack?"audio":"video",void 0,C)}),r.startUploadUplinkState()}finally{s()}})()}async unpublish(e){if(!this.sendConnection||this.state!==yn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(s=>!Ye(e).call(e,s)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(s=>s[0]==="videoLowTrack");n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(s=>{let[,{id:l}]=s;return l})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(s=>{let[l,{track:h}]=s;return{type:l,track:h}})),t.forEach(s=>{let[l]=s;this.statsCollector.removeLocalStats(l)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===yn.Connected)return n&&n[1].track.close(),r;e.forEach(s=>{const l=this.pendingLocalTracks.indexOf(s);l!==-1&&this.pendingLocalTracks.splice(l,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[s,{track:l,ssrcs:h}]=r;const p={stream_type:m$(l,s),ssrcs:h};l._muted||!l._enabled?t.push(p):n.push(p)}),t.length>0&&t.forEach(r=>{Mn(this,_t.RequestMuteLocal,[r])}),n.length>0&&n.forEach(r=>{Mn(this,_t.RequestUnmuteLocal,[r])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Po(function*(){throw new Re(H.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(D.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Lr(this,_t.RequestRePublish,this.pendingLocalTracks),this.emit(_t.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Re(H.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var s;if(!this.recvConnection)throw new Re(H.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;const{track:l,mid:h,transceiver:p}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===it.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new RE(l,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),p&&e._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new TE(l,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),p&&e._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._videoTrack));const m=this.remoteUserMap.get(e);m?m.set(t,h):this.remoteUserMap.set(e,new Map([[t,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const g=this.pendingRemoteTracks.findIndex(v=>{let{user:T,kind:C}=v;return T.uid===e.uid&&t===C});g!==-1&&(this.pendingRemoteTracks.splice(g,1),this.emit(_t.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new Re(H.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(l=>{let{user:h,kind:p}=l;return t!==void 0?h.uid===e.uid&&t===p:h.uid===e.uid});if(r.forEach(l=>{const h=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||n||r.forEach(l=>{let{kind:h}=l;var p;if(h===it.AUDIO)(p=e._audioTrack)===null||p===void 0||p._destroy(),e._audioTrack=void 0;else if(h===it.VIDEO){var m;(m=e._videoTrack)===null||m===void 0||m._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const s=this.filterTobeUnSubscribedTracks(e,t);s.length!==0&&(await this.recvConnection.stopReceiving(s.map(l=>{let[,{id:h}]=l;return h})),this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),s.forEach(l=>{let[h,{kind:p}]=l;var m,g;if(p===it.VIDEO&&h._videoSSRC&&((m=this.recvConnection)===null||m===void 0||m.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),p===it.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),n||((g=h._videoTrack)===null||g===void 0||g._destroy(),h._videoTrack=void 0);else if(p===it.AUDIO){var v;this.unbindRemoteTrackEvents(h._audioTrack),!n&&((v=h._audioTrack)===null||v===void 0||v._destroy(),h._audioTrack=void 0)}}),s.forEach(l=>{let[,{kind:h}]=l;Mn(this,_t.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[it.VIDEO,it.AUDIO].forEach(r=>{n.has(r)?Mn(this,_t.RequestP2PUnmuteRemote,r):Mn(this,_t.RequestP2PMuteRemote,r)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Re(H.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Re(H.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Re(H.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Re(H.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===it.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||D.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(Le.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Xi){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[s]=r;return s!==Le.LocalAudioTrack}).filter(r=>{let[s]=r;return!(e&&s===Le.LocalVideoLowTrack)}).map(r=>{let[,{track:s}]=r;return s}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===Le.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}reportPublishEvent(e,t,n,r,s){if(e){const h=this.localTrackMap.get(Le.LocalAudioTrack),p=r?this.localTrackMap.get(Le.LocalVideoLowTrack):this.localTrackMap.get(Le.LocalVideoTrack);ft.publish(this.store.sessionId,{eventElapse:Yr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:p==null?void 0:p.track.getTrackLabel(),screenshare:(p==null?void 0:p.track._hints.indexOf(Dn.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var l;n||(n=[]);const h=n.find(m=>m instanceof Si),p=r?(l=this.localTrackMap.get(Le.LocalVideoTrack))===null||l===void 0?void 0:l.track:n.find(m=>m instanceof Xn);ft.publish(this.store.sessionId,{eventElapse:Yr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.getTrackLabel(),videoName:p==null?void 0:p.getTrackLabel(),screenshare:(p==null?void 0:p._hints.indexOf(Dn.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(e,t,n,r){const s=r===it.VIDEO?n._videoSSRC:n._audioSSRC;s&&ft.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===it.VIDEO,audio:r===it.AUDIO,peerid:n.uid,subscribeRequestid:r===it.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Yr.measureFromSubscribeStart(this.store.clientId,s)})}reset(){D.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Wr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Wr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Le.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Xi){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=yn.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Le.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Le.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Xn||t&&t.track instanceof Si?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(no(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Le.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Pt(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(D.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=yn.Reconnecting,Y("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case Le.LocalVideoTrack:Ye(t=r._hints).call(t,Dn.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Le.LocalAudioTrack:r instanceof Xi?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Le.LocalVideoLowTrack:}}),this.emit(_t.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(no(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(_t.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),D.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:s}=n;if((e instanceof yp?e.uid:e)===r.uid&&t===s)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===Os.SEND_ONLY){if(!this.sendConnection)throw new Re(H.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new Re(H.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const s=await r.restartICE(t);return r.isInRestartIce=!1,s}{const s=await r.restartICE();if(s){const l=await Lr(this,_t.RequestP2PRestartICE,{direction:Os.RECEIVE_ONLY,iceParameter:s});await r.restartICE(l),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(Le.LocalVideoTrack),n=this.localTrackMap.get(Le.LocalAudioTrack),r=e.videoSend.find(I=>{var U;return I.ssrc===(t==null||(U=t.ssrcs)===null||U===void 0?void 0:U[0].ssrcId)}),s=e.audioSend.find(I=>{var U;return I.ssrc===(n==null||(U=n.ssrcs)===null||U===void 0?void 0:U[0].ssrcId)});if(!r||!s)return 1;const l=eo(this,_t.NeedSignalRTT),h=r?r.rttMs:void 0,p=s?s.rttMs:void 0,m=h&&p?(h+p)/2:h||p,g=(m&&l?(m+l)/2:m||l)||0,v=100*e.sendPacketLossRate*.7/50+.3*g/1500,T=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,C=t==null?void 0:t.track;if(C&&C._encoderConfig&&C._hints.indexOf(Dn.SCREEN_TRACK)===-1){const I=C._encoderConfig.bitrateMax,U=e.bitrate.actualEncoded;if(I&&U){const k=(1e3*I-U)/(1e3*I);return $B[k<.15?0:k<.3?1:k<.45?2:k<.6?3:4][T]}}return T}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const s=r._audioSSRC,l=r._videoSSRC,h=e.audioRecv.find(U=>U.ssrc===s),p=e.videoRecv.find(U=>U.ssrc===l);if(!h&&!p)return void(t+=1);const m=eo(this,_t.NeedSignalRTT),g=e.rtt,v=(g&&m?(g+m)/2:g||m)||0,T=h?h.jitterMs:void 0,C=e.recvPacketLossRate;let I=.7*C*100/50+.3*v/1500;T&&(I=.6*C*100/50+.2*v/1500+.2*T/400),t+=I<.1?1:I<.17?2:I<.36?3:I<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Je((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const r=[],s=cn(),l=this.getAllTracks();e=lE(e=e.filter(m=>l.indexOf(m)===-1));let h=!1,p=!1;for(const m of e){if(m instanceof Xn&&(this.localTrackMap.has(Le.LocalVideoTrack)||h?new Re(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:m,type:Le.LocalVideoTrack}),h=!0),t)){const g=this.getLowVideoTrack(m,n);r.push({track:g,type:Le.LocalVideoLowTrack})}if(m instanceof Si){const g=this.localTrackMap.get(Le.LocalAudioTrack);if(g){if(!(g.track instanceof Xi))throw new Re(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new Re(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");g.track.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0)}else if(p){const v=r.find(T=>{let{type:C}=T;return C===Le.LocalAudioTrack});if(!(v.track instanceof Xi))throw new Re(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new Re(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(m)}else{if(!s.webAudioMediaStreamDest||m instanceof Xi||m._bypassWebAudio)r.push({track:m,type:Le.LocalAudioTrack});else{const v=new Xi;v.addAudioTrack(m),r.push({track:v,type:Le.LocalAudioTrack})}p=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=lE(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof Si){const s=this.localTrackMap.get(Le.LocalAudioTrack);if(!s)continue;s.track instanceof Xi?(s.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),s.track.trackList.length===0&&(t.push([Le.LocalAudioTrack,s]),s.track.close())):t.push([Le.LocalAudioTrack,s])}if(r instanceof Xn){const s=this.localTrackMap.get(Le.LocalVideoTrack);if(!s)continue;t.push([Le.LocalVideoTrack,s]);const l=this.localTrackMap.get(Le.LocalVideoLowTrack);l&&t.push([Le.LocalVideoLowTrack,l])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Le.LocalVideoTrack:n.addListener(lt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(lt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(lt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(lt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Le.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Le.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Xi?e.trackList.forEach(n=>{n.addListener(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(lt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(lt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(lt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Le.LocalVideoTrack:n.off(lt.GET_STATS,this.handleGetLocalVideoStats),n.off(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(lt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(lt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(lt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Le.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Le.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Xi?e.trackList.forEach(t=>{t.off(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(lt.GET_STATS,this.handleGetLocalAudioStats),t.off(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(lt.GET_STATS,this.handleGetLocalAudioStats),e.off(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(lt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof TE&&t.addListener(lt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof RE&&t.addListener(lt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(lt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(it.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(it.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var s;let l,{track:h,type:p}=n;switch(p){case Le.LocalAudioTrack:l=Sn.Audio;break;case Le.LocalVideoTrack:l=Ye(s=h._hints).call(s,Dn.SCREEN_TRACK)?Sn.Screen:Sn.High;break;case Le.LocalVideoLowTrack:l=Sn.Low}return{kind:p===Le.LocalAudioTrack?it.AUDIO:it.VIDEO,stream_type:l,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[s,{track:l,ssrcs:h,id:p}]=t;switch(s){case Le.LocalVideoTrack:r=Ye(n=l._hints).call(n,Dn.SCREEN_TRACK)?Sn.Screen:Sn.High;break;case Le.LocalAudioTrack:r=Sn.Audio;break;case Le.LocalVideoLowTrack:r=Sn.Low}return{stream_type:r,ssrcs:h,mid:p}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:s,type:l}=n;this.localTrackMap.set(l,{track:s,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(_t.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Ye(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Tr(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),ft.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Ei.TRACER}).onSuccess(),this.emit(_t.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(no(n=this.remoteUserMap).call(n)).find(l=>l._audioSSRC===t);var s;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(s=r.audioTrack)===null||s===void 0||s.emit(gE.FIRST_FRAME_DECODED),ft.firstRemoteFrame(this.store.sessionId,rr.FIRST_AUDIO_DECODE,ii.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Yr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(no(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);r&&ft.firstRemoteFrame(this.store.sessionId,rr.FIRST_AUDIO_RECEIVED,ii.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Yr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from(no(n=this.remoteUserMap).call(n)).find(s=>s._videoSSRC===t);r&&ft.firstRemoteFrame(this.store.sessionId,rr.FIRST_VIDEO_RECEIVED,ii.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Yr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",s=n.candidateType==="relay";n.candidateType!=="unknown"&&r===s||this.emit(_t.ConnectionTypeChange,r),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(_p(n))," -> ").concat(JSON.stringify(_p(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(_p(n))," -> ").concat(JSON.stringify(_p(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(_t.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Os.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,D.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Os.SEND_ONLY?this.restartICE(e):Lr(this,_t.RequestP2PRestartICE,{direction:Os.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(Le.LocalAudioTrack);if(e instanceof Si&&(n==null?void 0:n.track)instanceof Xi)return n.track.isActive||t.push([Le.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:l}]=s;return e===l});if(r&&(t.push(r),r[0]===Le.LocalVideoTrack)){const s=this.localTrackMap.get(Le.LocalVideoLowTrack);s&&t.push([Le.LocalVideoLowTrack,s])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(Le.LocalAudioTrack);if(e instanceof Si&&(n==null?void 0:n.track)instanceof Xi)return n.track.isActive&&t.push([Le.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:l}]=s;return e===l});if(r)if(r[0]===Le.LocalVideoTrack){t.push(r);const s=this.localTrackMap.get(Le.LocalVideoLowTrack);s&&t.push([Le.LocalVideoLowTrack,s])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[s,{track:l,ssrcs:h,id:p}]=t;switch(s){case Le.LocalAudioTrack:r=Sn.Audio;break;case Le.LocalVideoTrack:r=Ye(n=l._hints).call(n,Dn.SCREEN_TRACK)?Sn.Screen:Sn.High;break;case Le.LocalVideoLowTrack:r=Sn.Low}return{stream_type:r,ssrcs:h,mid:p}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[s,{track:l,ssrcs:h,id:p}]=t;switch(s){case Le.LocalAudioTrack:r=Sn.Audio;break;case Le.LocalVideoTrack:r=Ye(n=l._hints).call(n,Dn.SCREEN_TRACK)?Sn.Screen:Sn.High;break;case Le.LocalVideoLowTrack:r=Sn.Low}return{stream_type:r,ssrcs:h,mid:p}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const s=r.get(t);if(!s)return n;n.push([e,{kind:t,id:s}])}else Array.from(r.entries()).forEach(s=>{let[l,h]=s;n.push([e,{kind:l,id:h}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:s,id:l}]=n;switch(s){case it.VIDEO:return void(r._videoSSRC&&t.push({stream_type:it.VIDEO,ssrcId:r._videoSSRC}));case it.AUDIO:return void(r._audioSSRC&&t.push({stream_type:it.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const s=this.remoteUserMap.get(n);s&&(s.delete(r),Array.from(s.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Le.LocalVideoTrack),n=this.localTrackMap.get(Le.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Je((r,s)=>{this.handleUpdateVideoEncoder(t.track,r,s,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Je((r,s)=>{this.handleUpdateVideoEncoder(n.track,r,s,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Si){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const r=this.createUnmuteMessage(n);return void await Mn(this,_t.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(_t.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(_t.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Tr(BD(this.dtlsFailedCount,Gi)),this.emit(_t.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Le.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Xn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Xn).length>1)throw new Re(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Si).length>1&&(e.some(t=>t instanceof Si&&t._bypassWebAudio)||!cn().webAudioMediaStreamDest))throw new Re(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Xn&&this.pendingLocalTracks.some(n=>n instanceof Xn))throw new Re(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Si&&this.pendingLocalTracks.some(n=>n instanceof Si)&&(!cn().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Si&&n._bypassWebAudio)))throw new Re(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!Y("DISABLE_DUAL_STREAM_USE_ENCODING")&&cn().supportDualStreamEncoding,r=WA(WA({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=n?e._mediaStreamTrack.clone():QP(e,r);const l=Bn(8,"track-low-"),h=new Xn(s,WA(WA({},n&&{scaleResolutionDownBy:LP(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,l);return h.on(bm.TRANSCEIVER_UPDATED,p=>{e._updateRtpTransceiver(p,mE.LOW_STREAM)}),h._hints.push(Dn.LOW_STREAM),e.addListener(lt.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var s;const l=Array.from(no(s=this.remoteUserMap).call(s)).find(h=>h._videoSSRC===e);if(l){r||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,p=h.subscribe.find(m=>m.userId===l.uid&&m.type==="video");ft.firstRemoteVideoDecode(this.store.sessionId,rr.FIRST_VIDEO_DECODE,ii.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:n,subscribeElapse:Yr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(p==null?void 0:p.subscribeEnd)||0,subscriberStart:(p==null?void 0:p.subscribeStart)||0,videoAddNotify:(p==null?void 0:p.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const s=r.get(t);if(!s)return!1;const l=await this.recvConnection.getRemoteSSRC(s);return l!==void 0&&l!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Re(H.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Re(H.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new Re(H.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new Re(H.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new Re(H.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new Re(H.NOT_SUPPORTED)}async preConnect(e){throw new Re(H.NOT_SUPPORTED)}getEstablishParams(){throw new Re(H.NOT_SUPPORTED)}async reSubscribe(e){throw new Re(H.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new Re(H.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===Le.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,mE.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},ut(si.prototype,"p2pConnect",[x6],Object.getOwnPropertyDescriptor(si.prototype,"p2pConnect"),si.prototype),ut(si.prototype,"unpublish",[M6],Object.getOwnPropertyDescriptor(si.prototype,"unpublish"),si.prototype),ut(si.prototype,"unpublishLowStream",[U6],Object.getOwnPropertyDescriptor(si.prototype,"unpublishLowStream"),si.prototype),ut(si.prototype,"subscribe",[j6],Object.getOwnPropertyDescriptor(si.prototype,"subscribe"),si.prototype),ut(si.prototype,"mockSubscribe",[V6],Object.getOwnPropertyDescriptor(si.prototype,"mockSubscribe"),si.prototype),ut(si.prototype,"unsubscribe",[F6],Object.getOwnPropertyDescriptor(si.prototype,"unsubscribe"),si.prototype),ut(si.prototype,"muteRemote",[B6],Object.getOwnPropertyDescriptor(si.prototype,"muteRemote"),si.prototype),ut(si.prototype,"unmuteRemote",[G6],Object.getOwnPropertyDescriptor(si.prototype,"unmuteRemote"),si.prototype),ut(si.prototype,"hasRemoteMediaWithLock",[H6],Object.getOwnPropertyDescriptor(si.prototype,"hasRemoteMediaWithLock"),si.prototype),ut(si.prototype,"disconnectForReconnect",[z6],Object.getOwnPropertyDescriptor(si.prototype,"disconnectForReconnect"),si.prototype),ut(si.prototype,"remoteMediaSsrcChanged",[W6],Object.getOwnPropertyDescriptor(si.prototype,"remoteMediaSsrcChanged"),si.prototype),si);function wl(e){return function(t,n,r){const s=t[n];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var l=arguments.length,h=new Array(l),p=0;p<l;p++)h[p]=arguments[p];switch(e){case Cl.SEND_ONLY:{const m=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,h)}finally{m()}}case Cl.RECEIVE_ONLY:{const m=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,h)}finally{m()}}default:{const m=await this.sendMutex.lock("From P2PChannel2.".concat(n)),g=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,h)}finally{m(),g()}}}},r}}class Gm extends ai{constructor(t,n){super(),V(this,"signal",void 0),V(this,"token",void 0),V(this,"tokenTimeout",void 0),V(this,"tokenInterval",void 0),V(this,"_sequence",0),V(this,"userMap",new Map),V(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const r=()=>{this.signal.connectionState===Wn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*Y("P2P_TOKEN_INTERVAL"))};r()}async send(t,n,r,s,l){var h;if(this.userMap.size===0)return;const p=Array.from(Fs(h=this.userMap).call(h))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),s=s??Bn(6,""),l=l??this._sequence++;const m={_id:s,_type:t,_seq:l,_message:n,token:"".concat(this.token,"_").concat(p)};Y("SHOW_P2P_LOG")&&D.debug("send message",m,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(m)).forEach(v=>{this.signal.request(Ct.DATA_STREAM,{payload:up(this.encoder.encode(v))})});const g=new Je((v,T)=>{const C=window.setTimeout(()=>{this.off("res-@".concat(s,"_ack"),I),this.off("res-@".concat(s),k),this.off(IE.ABORT,U),D.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(s)),this.userMap.size===0?T(new Re(H.INVALID_REMOTE_USER)):T(new Re(H.TIMEOUT))},Y("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),I=()=>{C&&window.clearTimeout(C),this.off(IE.ABORT,U),r&&v()},U=()=>{C&&window.clearTimeout(C),this.off("res-@".concat(s,"_ack"),I),this.off("res-@".concat(s),k),T(new Re(H.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(s)))};this.once(IE.ABORT,U),this.once("res-@".concat(s,"_ack"),I);const k=(F,B)=>{M=!0,C&&window.clearTimeout(C),this.off("res-@".concat(s,"_ack"),I),this.off(IE.ABORT,U),F==="success"?v(B):T(new Re(H.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(s)))};let M=!1;r||(this.once("res-@".concat(s),k),Tr(Y("SIGNAL_REQUEST_TIMEOUT")).then(()=>{M||D.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(s,", ").concat(m))}))});try{return await g}catch(v){if(v.code===H.TIMEOUT)return await this.send(t,n,r,s,l);throw v}}onMessage(t){var n;const{_uid:r}=t;let s,l=this.userMap.get(r);if(l)s=l.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Di.CHECK)return;const{token:g}=t;s=new Map,l={uid:r,isStart:!0,token:g,splitMessageMap:s,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,l),this.signal.emit(Yt.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var h;const{id:g,total:v}=t,T=(h=s.get(g))!==null&&h!==void 0?h:[];if(T.push(t),s.has(g)||s.set(g,T),T.length!==v)return;{const C=Pt(T).call(T,(I,U)=>I.index-U.index).map(I=>I.payload).join("");s.delete(g),(t=JSON.parse(C))._uid=r}}const{_type:p,token:m}=t;if(Ye(n=[Di.ACK,Di.CHECK]).call(n,p))return p===Di.CHECK&&this.handleCheckToken(l,m),void this.receiveMessage(t);m==="".concat(l.token,"_").concat(this.token)?this.handleReceivedMessage(t):D.debug('Receive unexpected message", '.concat(m,", cur_token: ").concat(l.token,"_").concat(this.token),t)}check(){const t={_id:Bn(6,""),token:this.token,_type:Di.CHECK};Y("SHOW_P2P_LOG")&&D.debug("send message",t),this.signal.request(Ct.DATA_STREAM,{payload:up(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:Di.ACK,token:this.token};Y("SHOW_P2P_LOG")&&D.debug("send message",n),this.signal.request(Ct.DATA_STREAM,{payload:up(this.encoder.encode(JSON.stringify(n)))})}response(t,n,r){this.send(Di.RESPONSE,JSON.stringify({success:!r,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(g=>{const{receivedMessagesMap:v,nextExpectedSequenceNumber:T}=g;for(;v.has(T);){const C=v.get(T);v.delete(T),this.receiveMessage(C),g.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:r,_seq:s}=t,l=this.userMap.get(r),{receivedMessagesMap:h,isStart:p,nextExpectedSequenceNumber:m}=l;if(s<m)return this.ack(t._id),void D.debug("[external-signal] receive old message, seq: ".concat(s,", ").concat(t._message));h.set(s,t),p&&s===m&&(this.receiveMessage(t),h.delete(m),l.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:r,_message:s,_uid:l}=t;if(Y("SHOW_P2P_LOG")&&D.debug("receive message",t),n){let h;switch(t._type!==Di.ACK&&(s&&(h=JSON.parse(s)),this.ack(t._id)),t._type){case Di.CANDIDATE:case Di.CONTROL:this.signal.emit(r,h,l);break;case Di.PUBLISH:case Di.UNPUBLISH:case Di.RESTART_ICE:case Di.CALL:h.uid=l,Lr(this.signal,r,h).then(p=>{this.response(t._id,p)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Di.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Di.RESPONSE:{const{success:p,message:m}=h;this.emit("res-@".concat(n),p?"success":"failed",m);break}}}}splitMessage(t){if(t.length<Gm.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:r}=JSON.parse(t),s=Bn(6,"");let l=0,h=800;const p=Math.ceil(t.length/h);for(;t.length>0;){l++;const m={id:s,index:l,total:p,payload:t.slice(0,h),token:"".concat(this.token,"_").concat(r)};JSON.stringify(m).length>Gm.MAX_MESSAGE_SIZE?h-=50:(n.push(m),t=t.slice(h))}return n.map(m=>JSON.stringify(m))}handleCheckToken(t,n){return t.token!==n?(D.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{D.debug("token timeout, ".concat(n)),this.reset(t.uid)},Y("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await Lr(this.signal,Di.CALL,void 0),n=await this.send(Di.CALL,t);this.signal.emit(At.P2P_CONNECTION,n,!0)}async reset(t,n){const r=this.userMap.get(t);r&&(this.emit(IE.ABORT),this.signal.emit(Yt.ON_USER_OFFLINE,{uid:r.uid,reason:HQ.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(D.debug("change local token from ".concat(n," to ").concat(n)),this.token=Bn(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(IE.ABORT)}}V(Gm,"MAX_SIZE",1),V(Gm,"MAX_MESSAGE_SIZE",1024);class Cee extends ai{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Wn.CONNECTED?this.emit(At.WS_CONNECTED):t===Wn.RECONNECTING?this.emit(At.WS_RECONNECTING,this._websocketReconnectReason):t===Wn.CLOSED&&this.emit(At.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),V(this,"_disconnectedReason",void 0),V(this,"_websocketReconnectReason",void 0),V(this,"_connectionState",Wn.CLOSED),V(this,"reconnectToken",void 0),V(this,"p2pToken",void 0),V(this,"websocket",void 0),V(this,"openConnectionTime",void 0),V(this,"clientId",void 0),V(this,"lastMsgTime",Date.now()),V(this,"uploadCache",[]),V(this,"uploadCacheInterval",void 0),V(this,"rttRolling",new RV(5)),V(this,"pingpongTimer",void 0),V(this,"pingpongTimeoutCount",0),V(this,"joinResponse",void 0),V(this,"multiIpOption",void 0),V(this,"initError",void 0),V(this,"spec",void 0),V(this,"store",void 0),V(this,"_external_signal",void 0),V(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(At.ON_BINARY_DATA,r.data);const s=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const l="res-@".concat(s._id);this.emit(l,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){switch(s._type){case Yt.ON_DATA_STREAM:return void this.handleDataStream(s._message);case Yt.MUTE_AUDIO:case Yt.MUTE_VIDEO:case Yt.ON_P2P_LOST:case Yt.ON_USER_ONLINE:return;case Yt.ON_USER_OFFLINE:const{uid:l}=s._message;return D.debug("[".concat(this.clientId,"] user-offline uid: ").concat(l)),void this._external_signal.reset(l)}if(this.emit(s._type,s._message),s._type===Yt.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===Yt.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(En.UID_BANNED);break;case 15:this.close(En.IP_BANNED);break;case 16:this.close(En.CHANNEL_BANNED)}if(s._type===Yt.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case vt.ERR_LICENSE_MISSING:this.close(En.LICENSE_MISSING);break;case vt.ERR_LICENSE_EXPIRED:this.close(En.LICENSE_EXPIRED);break;case vt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(En.LICENSE_MINUTES_EXCEEDED);break;case vt.ERR_LICENSE_PERIOD_INVALID:this.close(En.LICENSE_PERIOD_INVALID);break;case vt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(En.LICENSE_MULTIPLE_SDK_SERVICE);break;case vt.ERR_LICENSE_ILLEGAL:this.close(En.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new DP("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Y("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Y("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Wn.CONNECTED&&this.reconnect("retry",Pr.OFFLINE)}),this.p2pToken=Bn(6,""),this._external_signal=new Gm(this,this.p2pToken)}async request(t,n,r,s){const l=Bn(6,""),h={_id:l,_type:t,_message:n},p=this.websocket.connectionID,m=()=>new Je((U,k)=>{if(this.connectionState===Wn.CONNECTED)return U();const M=()=>{this.off(At.WS_CLOSED,F),U()},F=()=>{this.off(At.WS_CONNECTED,M),k(new Re(H.WS_ABORT))};this.once(At.WS_CONNECTED,M),this.once(At.WS_CLOSED,F)});if(this.connectionState!==Wn.CONNECTING&&this.connectionState!==Wn.RECONNECTING||t===Ct.JOIN||t===Ct.REJOIN||await m(),this.websocket.sendMessage(h,!0),s)return;const g=new Je((U,k)=>{let M=!1;const F=(ee,ue)=>{M=!0,U({isSuccess:ee==="success",message:ue||{}}),this.off(At.WS_CLOSED,B),this.off(At.WS_RECONNECTING,B),this.emit(At.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(l),F);const B=()=>{k(new Re(H.WS_ABORT,"type: ".concat(t))),this.off(At.WS_CLOSED,B),this.off(At.WS_RECONNECTING,B),this.off("res-@".concat(l),F)};this.once(At.WS_CLOSED,B),this.once(At.WS_RECONNECTING,B),Tr(Y("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||M||(D.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(At.REQUEST_TIMEOUT,t,n))})});let v=null;try{v=await g}catch(U){if(this.connectionState===Wn.CLOSED||t===Ct.LEAVE)throw new Re(H.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?U.throw():t===Ct.JOIN||t===Ct.REJOIN?null:(await m(),await this.request(t,n))}if(v.isSuccess)return v.message;const T=Number(v.message.error_code||v.message.code),C=rT(T),I=new Re(H.UNEXPECTED_RESPONSE,"".concat(C.desc,": ").concat(v.message.error_str),{code:T,data:v.message,desc:C.desc});return C.action==="success"?v.message:(D.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(T,", message: ").concat(C.desc,", action: ").concat(C.action)),T===vt.ERR_TOO_MANY_BROADCASTERS?((t===Ct.JOIN||t===Ct.REJOIN)&&(this.initError=I,this.close()),I.throw()):C.action==="failed"?I.throw():C.action==="quit"?(this.initError=I,this.close(),I.throw()):(T===vt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=v.message.option,D.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Pr.MULTI_IP)):this.reconnect(C.action,Pr.SERVER_ERROR),t===Ct.JOIN||t===Ct.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Je(r=>{const s=l=>{(!n||n(l))&&(this.off(t,s),r(l))};this.on(t,s)})}uploadWRTCStats(t){if(!this.store.sessionId)return void D.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(nT.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const l=Y("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Wn.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},Y("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}async sendExtensionMessage(t,n,r){return await this._external_signal.send(t,n,r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Je((n,r)=>{this.once(At.WS_CONNECTED,()=>n(this.joinResponse)),this.once(At.WS_CLOSED,()=>r(this.initError||new Re(H.WS_ABORT))),this.connectionState=Wn.CONNECTING,this.websocket.init(t).catch(r)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||En.LEAVE,this.connectionState=Wn.CLOSED,D.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Bn(6,""),this._external_signal.clear(),this._external_signal=new Gm(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(At.ABORT_P2P_EXECUTION);const t=await Lr(this,At.REQUEST_JOIN_INFO),n=await this.request(Ct.JOIN,t);if(!n)return this.emit(At.REPORT_JOIN_GATEWAY,H.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(At.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Wn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleDataStream(t){try{var n;const r=Sm(t.payload),s=new TextDecoder().decode(r),l=JSON.parse(s);"total"in l&&"id"in l||Ye(n=Object.values(Di)).call(n,l._type)?(l._uid=t.uid,this._external_signal.onMessage(l)):this.emit(Yt.ON_DATA_STREAM,t)}catch{this.emit(Yt.ON_DATA_STREAM,t)}}handleNotification(t){D.debug("[".concat(this.clientId,"] receive notification: "),t);const n=rT(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(En.UID_BANNED),void this.close()):void this.reconnect(n.action,Pr.SERVER_ERROR);D.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=Y("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(D.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>Y("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Pr.TIMEOUT):this.request(Ct.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),Y("REPORT_STATS")&&this.send(Ct.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(kt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(At.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(kt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(kt.CLOSED,()=>{this.connectionState=Wn.CLOSED}),this.websocket.on(kt.FAILED,()=>{this._disconnectedReason=En.NETWORK_ERROR,this.connectionState=Wn.CLOSED}),this.websocket.on(kt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Wn.CONNECTED?this.connectionState=Wn.RECONNECTING:this.connectionState=Wn.CONNECTING}),this.websocket.on(kt.WILL_RECONNECT,(t,n,r)=>{t!=="retry"?(D.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):D.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)}),this.websocket.on(kt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(At.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Re&&t.code===H.UNEXPECTED_RESPONSE&&t.data.code===vt.ERR_NO_AUTHORIZED)return D.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Pr.SERVER_ERROR);D.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Pr.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(kt.REQUEST_NEW_URLS,(t,n)=>{Lr(this,At.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const wee={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new bee(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new Cee(n,t)}};function K6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function Y6(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?K6(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Aee{constructor(t){V(this,"sessionDesc",void 0),V(this,"localCapabilities",void 0),V(this,"rtpCapabilities",void 0),V(this,"candidates",void 0),V(this,"_originCandidates",void 0),V(this,"iceParameters",void 0),V(this,"dtlsParameters",void 0),V(this,"setup",void 0),V(this,"currentMidIndex",void 0),V(this,"cname",void 0),t=oi(t);const{iceParameters:n,dtlsParameters:r,candidates:s,rtpCapabilities:l,setup:h,localCapabilities:p,sdkCodec:m,cname:g}=t,v=ca(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=l,this.candidates=s,this._originCandidates=oi(s),this.iceParameters=n,this.dtlsParameters=r,this.setup=h,this.localCapabilities=p,this.cname=g;for(let T=0;T<v.mediaDescriptions.length;T++){const C=v.mediaDescriptions[T];if(C.attributes.iceUfrag=n.iceUfrag,C.attributes.icePwd=n.icePwd,C.attributes.fingerprints=r.fingerprints,C.attributes.candidates=s,C.attributes.setup=h,C.media.mediaType==="video"){C.media.fmts=l.videoCodecs.map(U=>U.payloadType.toString(10));let I=l.videoCodecs.filter(U=>{var k,M;return(k=U.rtpMap)===null||k===void 0?void 0:Ye(M=k.encodingName.toLowerCase()).call(M,m)});I.length===0&&(I=l.videoCodecs),C.attributes.payloads=I,C.attributes.extmaps=l.videoExtensions}C.media.mediaType==="audio"&&(C.media.fmts=l.audioCodecs.map(I=>I.payloadType.toString(10)),C.attributes.payloads=l.audioCodecs,C.attributes.extmaps=l.audioExtensions),v.mediaDescriptions[T]=this.mungMediaDesc(C)}this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}toString(){return hp(this.sessionDesc)}send(t,n,r){const{ssrcs:s,ssrcGroups:l}=Dm(n,this.cname),h=this.sessionDesc.mediaDescriptions.find(g=>t===it.VIDEO?g.media.mediaType==="video":g.media.mediaType==="audio"),p=s[0].attributes.label,m=s[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(s),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(l),{id:p,mslabel:m}}batchSend(t){return t.map(n=>{let{kind:r,ssrcMsg:s}=n;return this.send(r,s,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const r=[],s=[],l=[];n.attributes.ssrcs.forEach(h=>{Ye(t).call(t,h.attributes.label||"")?l.push(h):r.push(h)}),n.attributes.ssrcGroups.forEach(h=>{var p;Ye(p=l.map(m=>m.ssrcId)).call(p,h.ssrcIds[0])||s.push(h)}),n.attributes.ssrcs=r,n.attributes.ssrcGroups=s})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,r){t.forEach((s,l)=>{const h=s._mediaStreamTrack,p=this.sessionDesc.mediaDescriptions.findIndex(g=>g.attributes.mid===h.kind),m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],s);this.sessionDesc.mediaDescriptions[p]=m})}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter(s=>s.transport==="udp"),r=[];if(n.forEach(s=>{r.push(Y6(Y6({},s),{},{foundation:"tcpcandidate",priority:Number(s.priority)-1+"",transport:"tcp",port:Number(s.port)+90+""}))}),n.length!==0){switch(t){case Kr.TCP_RELAY:this.candidates=r;break;case Kr.UDP_TCP_RELAY:case Kr.RELAY:this.candidates=[...n,...r];break;default:this.candidates=n}for(const s of this.sessionDesc.mediaDescriptions)s.attributes.candidates=this.candidates}}restartICE(t){t=oi(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}mungRecvMediaDsec(t,n){const r=oi(t);return DE(r,n),xP(r,n),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(r!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=s}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,r){const s=this.sessionDesc.mediaDescriptions.find(h=>t===it.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(s){const h=s.attributes.ssrcs.find(p=>p.attributes.label===n);var l;h&&(h.attributes.label=r,(l=h.attributes.msid)===null||l===void 0||l.replace(n,r))}}mungMediaDesc(t){const n=oi(t);return kP(n),function(r){const s=r.attributes.extmaps.find(l=>cA(l.extensionName));s&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(s),1),r.attributes.payloads.forEach(l=>{const h=l.rtcpFeedbacks.findIndex(p=>p.type==="transport-cc");h!==-1&&l.rtcpFeedbacks.splice(h,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const r of n.attributes.ssrcs)if(r.attributes.label===t)return[r]}}var Un;function X6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function qA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?X6(Object(n),!0).forEach(function(r){V(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Iee=(Un=class XT extends o3{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Ye(n=Object.keys(jw)).call(n,t)}))]}constructor(t,n){super(t,n),V(this,"store",void 0),V(this,"peerConnection",void 0),V(this,"remoteSDP",void 0),V(this,"initialOffer",void 0),V(this,"statsFilter",void 0),V(this,"useRTX",!1),V(this,"localCapabilities",void 0),V(this,"localCandidateCount",0),V(this,"allCandidatesReceived",!1),V(this,"establishPromise",void 0),V(this,"mutex",void 0),this.store=n,this.mutex=new Wr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(XT.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=KD(this.peerConnection,Y("STATS_UPDATE_INTERVAL"),void 0,_i()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=gp(t.sdp),r=oT(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:Y("FILTER_VIDEO_FEC"),filterAudioFec:Y("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,qA(qA({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new Re(H.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Aee(qA(qA({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new Re(H.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var r=this;return Po(function*(){const s=yield an(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=t.map(C=>r.peerConnection.addTrack(C._mediaStreamTrack)),h=yield an(r.peerConnection.createOffer()),p=ca(h.sdp),m=t.map(C=>{const I=C._mediaStreamTrack,U=p.mediaDescriptions.find(k=>k.attributes.mid===I.kind);if(!U)throw new Error("Cannot extract ssrc from mediaDescription.");return function(k,M,F){const B=k.attributes.ssrcs.filter(ue=>ue.attributes.label===M),ee=k.attributes.ssrcGroups;if(B.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ee&&B.length>1){const ue=ee.find(de=>de.ssrcIds.indexOf(B[0].ssrcId)!==-1);return ue?[{ssrcId:ue.ssrcIds[0],rtx:F?ue.ssrcIds[1]:void 0}]:[{ssrcId:B[0].ssrcId}]}return[{ssrcId:B[0].ssrcId}]}(U,I.id,r.useRTX)});let g;try{g=yield m}catch(C){throw l.forEach(I=>{Dr()&&I.replaceTrack(null),r.peerConnection.removeTrack(I)}),C}const v=r.mungSendOfferSDP(h.sdp,t);r.remoteSDP.receive(t,n,g);const T=r.remoteSDP.toString();return yield an(r.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield an(r.applySendEncodings(l,t)),yield an(r.peerConnection.setRemoteDescription({type:"answer",sdp:T})),t.map((C,I)=>{const U=C._mediaStreamTrack.id;return{localSSRC:m[I],id:U}})}catch(l){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{s()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(l=>{var h;return t.indexOf(((h=l.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(l=>{Dr()&&l.replaceTrack(null),this.peerConnection.removeTrack(l)});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:l,mslabel:h}=this.remoteSDP.send(t,n,s),p=new Je((v,T)=>{const C=setTimeout(()=>{T(new Error("Cannot receive track, id: ".concat(l)))},1e4),I=U=>{const k=on();if((k.name==="Safari"&&Number(k.version)===11||As())&&U.track.id!==l&&U.streams[0].id===h){var M;const F=U.streams[0].getTracks()[0];return(M=this.remoteSDP)===null||M===void 0||M.updateTrackLabel(t,l,U.track.id),this.peerConnection.removeEventListener("track",I),clearTimeout(C),void v(F)}if(U.track.id===l)return this.peerConnection.removeEventListener("track",I),clearTimeout(C),void v(U.track)};this.peerConnection.addEventListener("track",I)}),m=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});const g=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(g),{track:await p,id:l}}catch(l){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(r=>{var s;return t.indexOf(((s=r.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(r=>{if(Dr()&&r.track)r.track.enabled=!1;else{const s=r.getParameters();s.encodings.forEach(l=>l.active=!1),r.setParameters(s)}})}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(l=>{var h;return t.indexOf(((h=l.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async l=>{if(Dr()&&l.track)l.track.enabled=!0;else{const h=l.getParameters();h.encodings.forEach(p=>p.active=!0),await l.setParameters(h)}});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Po(function*(){const r=yield an(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const s=cn().supportPCSetConfiguration;if(t===Kr.RELAY&&!s)return;if(s){const g=n.peerConnection.getConfiguration(),v=t===Kr.RELAY?"relay":"all";g.iceTransportPolicy!==v&&(D.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(g.iceTransportPolicy,"] to [").concat(v,"]")),g.iceTransportPolicy=v,n.peerConnection.setConfiguration(g))}t!==Kr.RELAY&&n.remoteSDP.updateCandidates(t);const l=yield an(n.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=gp(l.sdp),{remoteIceParameters:p}=yield h.iceParameters;n.remoteSDP.restartICE(p);const m=n.remoteSDP.toString();yield an(n.peerConnection.setLocalDescription(l)),yield an(n.peerConnection.setRemoteDescription({type:"answer",sdp:m}))}catch(s){D.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),s)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new Re(H.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getSenders().filter(s=>{var l;return((l=s.track)===null||l===void 0?void 0:l.id)===t});r.length===1&&await this.applySendEncodings(r,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getSenders().find(s=>{var l;return((l=s.track)===null||l===void 0?void 0:l.id)===n});r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new Re(H.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new Re(H.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Y("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(KS(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...XT.turnServerConfigToIceServers(t.turnServer.servers)),Y("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...XT.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(g=>{var v;return((v=g.track)===null||v===void 0?void 0:v.id)===t._mediaStreamTrack.id})),!n)return D.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!cn().supportSetRtpSenderParameters)return D.warn("Browser not support set rtp-sender parameters");const s={},l={};if(t instanceof Xn)switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(Y("DSCP_TYPE")&&Mu()){var h;const g=Y("DSCP_TYPE");Ye(h=["very-low","low","medium","high"]).call(h,g)&&(l.networkPriority=g)}const p=n.getParameters(),m=(r=p.encodings)===null||r===void 0?void 0:r[0];m&&Object.assign(m,l),Object.assign(p,s),D.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await n.setParameters(p)}async applySendEncodings(t,n){try{if(!cn().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const s=t[r],l=n[r];s&&l&&await this.updateRtpSenderEncodings(l,s)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const r=ca(t);return n.forEach((s,l)=>{const h=s._mediaStreamTrack,p=r.mediaDescriptions.find(m=>m.attributes.mid===h.kind);p&&DE(p,s)}),hp(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((l,h)=>{let{id:p,mslabel:m}=l;const{kind:g}=t[h];return new Je((v,T)=>{const C=setTimeout(()=>{T(new Error("Cannot receive track, id: ".concat(p)))},1e4),I=U=>{const k=on();if(k.name==="Safari"&&Number(k.version)===11&&U.track.id!==p&&U.streams[0].id===m){var M;const F=U.streams[0].getTracks()[0];return(M=this.remoteSDP)===null||M===void 0||M.updateTrackLabel(g,p,U.track.id),this.peerConnection.removeEventListener("track",I),clearTimeout(C),void v({track:F,id:p})}if(U.track.id===p)return this.peerConnection.removeEventListener("track",I),clearTimeout(C),void v({track:U.track,id:p})};this.peerConnection.addEventListener("track",I)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),await Je.all(n)}catch(n){throw new Re(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(cn().supportPCSetConfiguration){const n=XT.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},ut(Un.prototype,"connect",[Vo],Object.getOwnPropertyDescriptor(Un.prototype,"connect"),Un.prototype),ut(Un.prototype,"stopSending",[Vo],Object.getOwnPropertyDescriptor(Un.prototype,"stopSending"),Un.prototype),ut(Un.prototype,"receive",[Vo],Object.getOwnPropertyDescriptor(Un.prototype,"receive"),Un.prototype),ut(Un.prototype,"stopReceiving",[Vo],Object.getOwnPropertyDescriptor(Un.prototype,"stopReceiving"),Un.prototype),ut(Un.prototype,"muteRemote",[Vo],Object.getOwnPropertyDescriptor(Un.prototype,"muteRemote"),Un.prototype),ut(Un.prototype,"unmuteRemote",[Vo],Object.getOwnPropertyDescriptor(Un.prototype,"unmuteRemote"),Un.prototype),ut(Un.prototype,"muteLocal",[Vo],Object.getOwnPropertyDescriptor(Un.prototype,"muteLocal"),Un.prototype),ut(Un.prototype,"unmuteLocal",[Vo],Object.getOwnPropertyDescriptor(Un.prototype,"unmuteLocal"),Un.prototype),ut(Un.prototype,"close",[Vo],Object.getOwnPropertyDescriptor(Un.prototype,"close"),Un.prototype),ut(Un.prototype,"updateEncoderConfig",[Vo],Object.getOwnPropertyDescriptor(Un.prototype,"updateEncoderConfig"),Un.prototype),ut(Un.prototype,"updateSendParameters",[Vo],Object.getOwnPropertyDescriptor(Un.prototype,"updateSendParameters"),Un.prototype),ut(Un.prototype,"replaceTrack",[Vo],Object.getOwnPropertyDescriptor(Un.prototype,"replaceTrack"),Un.prototype),ut(Un.prototype,"getRemoteSSRC",[Vo],Object.getOwnPropertyDescriptor(Un.prototype,"getRemoteSSRC"),Un.prototype),Un);function Vo(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,l=await s.lock("Locking from P2PConnection.".concat(t));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return await r.apply(this,p)}finally{l()}},n}const Nee={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new Iee(n,t)}},Oee={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!cn().supportWebRTCEncodedTransform)return void D.warning("browser not support audio encoded transform");if(qw.has(e)||!e.track)return;const n={track:e.track};if(xu()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(h){return void D.error("create audio-encoded-streams error",h&&h.message)}const l=new TransformStream({transform(h,p){n.controller||(n.controller=p),e.track&&e.track.id!==n.track.id&&(D.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const m=t.metadata&&t.metadata();m?function(g,v){const{chunk:T,controller:C}=v,I=Y("ENABLE_AUDIO_PTS_METADATA")?Vu.AUDIO_64_BIT_PTS:Vu.METADATA;T.data=function(U,k,M){const F=M.byteLength,B=F+gP+qB,ee=mP+_P+B,ue=new ArrayBuffer(U.byteLength+ee),de=new DataView(ue);de.setUint8(0,WB),de.setUint16(1,B),de.setUint8(3,k),de.setUint16(4,F);for(let Te=0;Te<F;Te++)de.setUint8(6+Te,M[Te]);const ae=new Uint8Array(de.buffer);return ae.set(new Uint8Array(U),ee),ae.buffer}(T.data,I,g),C.enqueue(T)}(m,{chunk:h,controller:p}):p.enqueue(h)}});s.readable.pipeThrough(l).pipeTo(s.writable)}else if(Dr()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const s=Ww(),l=new MessageChannel;await new Je(p=>s.onmessage=m=>{m.data==="registered"&&p(void 0)});const h=new RTCRtpScriptTransform(s,{name:"audio-metadata-tx",port:l.port2},[l.port2]);e.transform=h,await new Je(p=>s.onmessage=m=>{m.data==="started"&&p(void 0)}),l.port1.onmessage=p=>{var m;if(p.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id)D.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r);else if(p.data.getMetadata){const g=t.metadata&&t.metadata();g&&l.port1.postMessage({metadata:g})}},n.worker=s}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const s=qw.get(e);if(s){qw.delete(e);try{var l,h;(l=s.controller)===null||l===void 0||l.terminate(),(h=s.worker)===null||h===void 0||h.terminate()}catch(p){D.warning(p&&p.message)}}}qw.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!cn().supportWebRTCEncodedTransform)return void D.warning("browser not support audio encoded transform");if($w.has(e))return;const n={track:e.track,onMetadata:t.onMetadata};if(xu()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");ID(mn.CHROME,87,116)||(t.enableTopn=!1);let s=null;try{s=e.createEncodedStreams()}catch(h){return void D.error("create audio-encoded-streams error",h&&h.message)}const l=new TransformStream({transform(h,p){n.controller||(n.controller=p),e.track&&e.track.id!==n.track.id&&(D.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)),t.enableTopn?function(m,g,v){var T;const C=KB(new DataView(g.data));if(!C)return v.enqueue(g);const I=m.track.id;lQ.set(I,m.track);const U=(T=C.tlv.find(ue=>ue.tag===Vu.AUDIO_LEVEL))===null||T===void 0?void 0:T.value;let k=0;typeof U=="number"&&(k=127-U);const M=Math.round(Math.pow(10,k/60)-1),{selected:F,speaker:B}=function(ue,de){let ae=bE.get(ue);if(ae||(ae=function(Te){const Ae=new XB;return bE.set(Te,Ae),vl||(vl=new oQ(Y("TOPN_SILENCE_THRESHOLD")||500),vl.on("ActiveSpeakerChanged",We=>{We!=null&&(Xw=We)})),vl.addSpeakers([Ae]),Ae}(ue)),bE.size<=JB)return{selected:!0,speaker:ae};if(!vl)throw new Error("no active speaker detector");return vl.levelChanged(ae.id,de),Im=vl.loudest.map(Te=>Te.id),Xw&&!Ye(Im).call(Im,Xw)&&Im.length>=JB&&Im.pop(),{selected:Ye(Im).call(Im,ae.id)||ae.id===Xw,speaker:ae}}(m,M),ee=function(ue,de,ae){const Te=Sl.get(ue)||new cQ(ue,de);return Te.score=ae,Sl.set(ue,Te),function(Ae){if(Jw.set(Ae,!0),!Qw)return void(Qw=Date.now());const We=Date.now();We-Qw>1e3&&(Jw.get(Ae)?Jw.set(Ae,!1):(QB(Ae),Jw.delete(Ae)),Qw=We)}(ue),Te}(I,m.track,B.energyScore);ee.addSample(F),ee.active&&(g.data=C.frame.buffer,v.enqueue(g))}(e,h,p):t.enableMetadata?function(m,g,v){const T=KB(new DataView(m.data));if(!T)return g.enqueue(m);const C=T.tlv.find(I=>I.tag===Vu.METADATA||I.tag===Vu.AUDIO_64_BIT_PTS);C&&v&&C.value instanceof Uint8Array&&v(C.value),m.data=T.frame.buffer,g.enqueue(m)}(h,p,t.onMetadata):p.enqueue(h)}});s.readable.pipeThrough(l).pipeTo(s.writable)}else if(Dr()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const s=Ww(),l=new MessageChannel;await new Je(p=>s.onmessage=m=>{m.data==="registered"&&p(void 0)});const h=new RTCRtpScriptTransform(s,{name:"audio-metadata-rx",port:l.port2},[l.port2]);e.transform=h,await new Je(p=>s.onmessage=m=>{m.data==="started"&&p(void 0)}),l.port1.onmessage=p=>{var m;p.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id?(D.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):p.data.metadata&&n.onMetadata&&n.onMetadata(p.data.metadata)},n.worker=s}function r(){e.track.removeEventListener("ended",r),function(s){const l=$w.get(s);if(l){(function(m){const g=bE.get(m);g&&(bE.delete(m),vl&&(vl.removeSpeakers([g]),bE.size===0&&(vl.destroy(),vl=null)))})(s),QB(s.track.id),$w.delete(s);try{var h,p;(h=l.controller)===null||h===void 0||h.terminate(),(p=l.worker)===null||p===void 0||p.terminate()}catch(m){D.warning(m&&m.message)}}}(e)}$w.set(e,n),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!cn().supportWebRTCEncodedTransform)return void D.warning("browser not support video encoded transform");if(Zw.has(e)||!e.track)return;const n={track:e.track};if(xu()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(p){return void D.error("create video-encoded-streams error",p&&p.message)}const l=[];t.on("sei-to-send",p=>{l.push(p)});const h=new TransformStream({transform(p,m){n.controller||(n.controller=m),e.track&&e.track.id!==n.track.id&&(D.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const g=l.shift();g&&(p.data=function(v,T){const C=function(B){const ee=B.length;let ue=[],de=0;for(;de<ee;)de+2<ee&&B[de]===0&&B[de+1]===0&&(B[de+2]===0||B[de+2]===1||B[de+2]===2||B[de+2]===3)?(ue.push(B[de],B[de+1],3,B[de+2]),de+=3):(ue.push(B[de]),de++);return new Uint8Array(ue)}(T),I=C.length,U=Math.floor(I/255),k=I%255,M=new Uint8Array(6+U+1+I+v.byteLength);M[0]=0,M[1]=0,M[2]=0,M[3]=1,M[4]=6,M[5]=101;let F=0;for(;F<U;)M[6+F]=255,F++;return M[6+F]=k,F++,M.set(C,6+F),M.set(new Uint8Array(v),6+F+I),M.buffer}(p.data,g)),m.enqueue(p)}});s.readable.pipeThrough(h).pipeTo(s.writable)}else{if(!Dr())return;{if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const s=Ww(),l=new MessageChannel;await new Je(p=>s.onmessage=m=>{m.data==="registered"&&p(void 0)});const h=new RTCRtpScriptTransform(s,{name:"sei-tx",port:l.port2},[l.port2]);e.transform=h,await new Je(p=>s.onmessage=m=>{m.data==="started"&&p(void 0)}),t.on("sei-to-send",p=>{l.port1.postMessage({sei:p})}),l.port1.onmessage=p=>{var m;p.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id&&(D.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=s}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const s=Zw.get(e);if(s){Zw.delete(e);try{var l,h;(l=s.controller)===null||l===void 0||l.terminate(),(h=s.worker)===null||h===void 0||h.terminate()}catch(p){D.warning(p&&p.message)}}}Zw.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!cn().supportWebRTCEncodedTransform)return void D.warning("browser not support video encoded transform");if(!e.track)return;if(tT.has(e)){const s=tT.get(e);return void(s&&(s.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(xu()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(h){return void D.error("create video-encoded-streams error",h&&h.message)}const l=new TransformStream({transform(h,p){n.controller||(n.controller=p),e.track&&e.track.id!==n.track.id&&(D.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const m=function(g){const v=new DataView(g.data);let T=0;for(;T+4<g.data.byteLength;){if(v.getUint8(T+0)===0&&v.getUint8(T+1)===0&&v.getUint8(T+2)===0&&v.getUint8(T+3)===1&&v.getUint8(T+4)===6){let C=T+6,I=0,U=0;for(;(U=v.getUint8(C++))===255;)I+=255;I+=U;const k=dQ(g.data,C,I);return new Uint8Array(k)}T++}return null}(h);m&&n.onSei&&n.onSei(m),p.enqueue(h)}});s.readable.pipeThrough(l).pipeTo(s.writable)}else if(Dr()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const s=Ww(),l=new MessageChannel;await new Je(p=>s.onmessage=m=>{m.data==="registered"&&p(void 0)});const h=new RTCRtpScriptTransform(s,{name:"sei-rx",port:l.port2},[l.port2]);e.transform=h,await new Je(p=>s.onmessage=m=>{m.data==="started"&&p(void 0)}),l.port1.onmessage=p=>{var m;p.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id?(D.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):p.data.sei&&n.onSei&&n.onSei(p.data.sei)},n.worker=s}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}(function(s){const l=tT.get(s);if(l){tT.delete(s);try{var h,p;(h=l.controller)===null||h===void 0||h.terminate(),(p=l.worker)===null||p===void 0||p.terminate()}catch(m){D.warning(m&&m.message)}}})(e)}tT.set(e,n),e.track.addEventListener("ended",r)}},Dee={name:"InterceptFrame",create:()=>Oee};YD(),wn("PROCESS_ID","process-".concat(Bn(8,""),"-").concat(Bn(4,""),"-").concat(Bn(4,""),"-").concat(Bn(4,""),"-").concat(Bn(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void D.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();D.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(Zn,r)){const{value:s,expires:l}=t[r];if(l&&l<=n)return;yl[r]=s,Zn[r]=s}})}catch(t){D.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(yl.AREAS)&&yl.AREAS.length>0&&FP(yl.AREAS,!0);const J6=(e,t,n)=>{D.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),wn(e,t,n)};Ep(eee,!1),Ep(iee,!1),Ep(M$,!1),Ep(fee,!1),Ep(QZ,!1),Ep(wee,!1),Ep(Nee,!1),Ep(Dee,!1);const Hi=function(e){const t=new ai,n=e,r={getListeners:t.getListeners.bind(t),on:(s,l)=>(function(h,p){h===Cd.SECURITY_POLICY_VIOLATION&&O5(p,!0)}(s,l),t.on.bind(t)(s,l)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return N5(N5({},n),r)}({__TRACK_LIST__:fE,VERSION:Lo,BUILD:QD,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:J6,getParameter:Y,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(r){let s;return cn().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),s=(await r.createOffer()).sdp):s=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,s}(t);if(!n)return e;t.close(),t=null,e=function(r){const s={video:[],audio:[]};return r.match(/ VP8/i)&&s.video.push("VP8"),r.match(/ VP9/i)&&s.video.push("VP9"),r.match(/ AV1/i)&&s.video.push("AV1"),r.match(/ H264/i)&&s.video.push("H264"),r.match(/ H265/i)&&s.video.push("H265"),r.match(/ opus/i)&&s.audio.push("OPUS"),r.match(/ PCMU/i)&&s.audio.push("PCMU"),r.match(/ PCMA/i)&&s.audio.push("PCMA"),r.match(/ G722/i)&&s.audio.push("G722"),s}(n)}catch(t){throw new ye(H.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=ft.reportApiInvoke(null,{name:Mi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Ei.TRACER});let t=!1;try{const l=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,p=window.WebSocket;t=!!(l&&h&&p),t&&PD()&&$j(75)&&new l().close()}catch(l){return D.error("check system requirement failed: ",l),!1}let n=!1;const r=on();r.name===mn.CHROME&&Number(r.version)>=58&&(gl.engine.name!=="WebKit"||function(){const l=on();if(Nw()){if(l.os===ir.MAC_OS)return!0;if(l.os===ir.IOS){const h=gl.os.version&&gl.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(n=!0),(r.name===mn.FIREFOX&&Number(r.version)>=56||r.name===mn.OPERA&&Number(r.version)>=45||r.name===mn.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(As()||Rc())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||rV()||on().name===mn.QQ)&&(n=!0),D.debug("checkSystemRequirements, api:",t,"browser",n);const s=t&&n;return e.onSuccess(s),s},getDevices:function(e){return oo.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return oo.getRecordingDevices(e)},getCameras:function(e){return oo.getCamerasDevices(e)},getElectronScreenSources:$V,getPlaybackDevices:function(e){return oo.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Bn(5,"client-"),r=ft.reportApiInvoke(null,{id:n,name:Mi.CREATE_CLIENT,options:[t],tag:Ei.TRACER});try{(function(s){er(s.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),er(s.mode,"config.mode",["rtc","live","p2p"]),s.audioCodec!==void 0&&er(s.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),s.proxyServer!==void 0&&Sr(s.proxyServer,"config.proxyServer",1,1e4),s.turnServer!==void 0&&hV(s.turnServer),s.httpRetryConfig!==void 0&&uV(s.httpRetryConfig),s.websocketRetryConfig!==void 0&&uV(s.websocketRetryConfig)})(t)}catch(s){throw r.onError(s),s}return(eV(16,0)||tV(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",D.debug("browser not support vp9, force use vp8")),wn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new U$(Lc(Lc({forceWaitGatewayResponse:!0},t),{},{role:Ye(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Y("CAMERA_CAPTURE_CONFIG"),n=Bn(8,"track-cam-"),r=ft.reportApiInvoke(null,{id:n,tag:Ei.TRACER,name:Mi.CREATE_CAM_VIDEO_TRACK,options:[ri({},e),t]});t&&(e.encoderConfig=t);const s=zw(e);let l=null;D.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{l=(await ao({video:s},n)).getVideoTracks()[0]||null}catch(p){throw r.onError(p),p}if(!l){const p=new Re(H.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(p),p.throw(D)}if(e.optimizationMode&&fP(n,l,e,wc(e.encoderConfig)),Y("USE_STANDARD_BITRATE_DEFAULT")){const p=wc(e.encoderConfig);e.encoderConfig=p,delete p.bitrateMax,delete p.bitrateMin}const h=new pP(l,e,s,e.scalabiltyMode?Fw(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return r.onSuccess(h.getTrackId()),D.info("create camera video success, trackId:",n),h},createCustomVideoTrack:function(e){const t=Bn(8,"track-cus-"),n=ft.reportApiInvoke(null,{id:t,tag:Ei.TRACER,name:Mi.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});Y("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const r=new Xn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Fw(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[Dn.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),D.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(C){return cF(C)}(t):void 0;n&&(t="auto");const r=Bn(8,"track-scr-v-"),s=ft.reportApiInvoke(null,{id:r,tag:Ei.TRACER,name:Mi.CREATE_SCREEN_VIDEO_TRACK,options:[ri({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const l=function(C){const I={};C.screenSourceType&&(I.mediaSource=C.screenSourceType),C.extensionId&&xu()&&(I.extensionId=C.extensionId);const{displaySurface:U,selfBrowserSurface:k,surfaceSwitching:M,systemAudio:F,preferCurrentTab:B}=C;(HS(107)||ND(107)||OD(93))&&(U&&(er(U,"displaySurface",["browser","window","monitor"]),I.displaySurface=U),k?(er(k,"selfBrowserSurface",["exclude","include"]),I.selfBrowserSurface=k):I.selfBrowserSurface="include",M&&(er(M,"surfaceSwitching",["exclude","include"]),I.surfaceSwitching=M)),(HS(105)||ND(105)||OD(91))&&F&&(er(F,"systemAudio",["exclude","include"]),I.systemAudio=F),(HS(94)||ND(94)||OD(80))&&B&&(I.preferCurrentTab=!0),C.electronScreenSourceId&&(I.sourceId=C.electronScreenSourceId);const ee=C.encoderConfig?nP(C.encoderConfig):null;return I.mandatory={chromeMediaSource:"desktop",maxWidth:ee?ee.width:void 0,maxHeight:ee?ee.height:void 0},ee&&(ee.frameRate&&(typeof ee.frameRate=="number"?(I.mandatory.maxFrameRate=ee.frameRate,I.mandatory.minFrameRate=ee.frameRate):(I.mandatory.maxFrameRate=ee.frameRate.max||ee.frameRate.ideal||ee.frameRate.exact||void 0,I.mandatory.minFrameRate=ee.frameRate.min||ee.frameRate.ideal||ee.frameRate.exact||void 0),I.frameRate=ee.frameRate),ee.width&&(I.width=ee.width),ee.height&&(I.height=ee.height)),I}(e);let h=null,p=null;const m=cn();if(!m.supportShareAudio&&t==="enable"){const C=new Re(H.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return s.onError(C),C.throw(D)}D.info("start create screen video track with config",e,"withAudio",t,"trackId",r);const g=m.supportShareAudio&&t!=="disable";try{const C=await ao({screen:l,screenAudio:g?n||!0:void 0},r);h=C.getVideoTracks()[0]||null,p=C.getAudioTracks()[0]||null}catch(C){throw s.onError(C),C}if(!h){const C=new Re(H.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(C),C.throw(D)}if(!p&&t==="enable"){h&&h.stop();const C=new Re(H.SHARE_AUDIO_NOT_ALLOWED);return s.onError(C),C.throw(D)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(fP(r,h,e,e.encoderConfig&&nP(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const v=new Xn(h,e.encoderConfig?nP(e.encoderConfig):{},e.scalabiltyMode?Fw(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[Dn.SCREEN_TRACK]);if(!p)return s.onSuccess(v.getTrackId()),D.info("create screen video track success","video:",v.getTrackId()),v;const T=new Si(p,void 0,Bn(8,"track-scr-a-"),!1);return s.onSuccess([v.getTrackId(),T.getTrackId()]),D.info("create screen video track success","video:",v.getTrackId(),"audio:",T.getTrackId()),[v,T]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=Y("CAMERA_CAPTURE_CONFIG"),r=Bn(8,"track-mic-"),s=Bn(8,"track-cam-"),l=ft.reportApiInvoke(null,{id:"".concat(r,"-").concat(s),tag:Ei.TRACER,name:Mi.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const h=zw(t),p=lF(e);let m=null,g=null;D.info("start create camera video track(".concat(s,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const C=await ao({audio:p,video:h},"".concat(r,"-").concat(s));m=C.getAudioTracks()[0],g=C.getVideoTracks()[0]}catch(C){throw l.onError(C),C}if(!m||!g){const C=new Re(H.UNEXPECTED_ERROR,"can not find tracks in media stream");return l.onError(C),C.throw(D)}if(t.optimizationMode&&fP(s,g,t,wc(t.encoderConfig)),Y("USE_STANDARD_BITRATE_DEFAULT")){const C=wc(t.encoderConfig);t.encoderConfig=C,delete C.bitrateMax,delete C.bitrateMin}const v=new eT(m,e,p,r),T=new pP(g,t,h,t.scalabiltyMode?Fw(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return l.onSuccess([v.getTrackId(),T.getTrackId()]),D.info("create camera video track(".concat(s,") and microphone audio track(").concat(r,") success")),[v,T]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Bn(8,"track-mic-"),n=ft.reportApiInvoke(null,{id:t,tag:Ei.TRACER,name:Mi.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=lF(e);let s=null;D.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{s=(await ao({audio:r},t)).getAudioTracks()[0]||null}catch(h){throw n.onError(h),h}if(!s){const h=new Re(H.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(h),h.throw(D)}const l=new eT(s,e,r,t);return n.onSuccess(l.getTrackId()),D.info("create microphone audio track success, trackId:",t),l},createCustomAudioTrack:function(e){const t=Bn(8,"track-cus-"),n=ft.reportApiInvoke(null,{id:t,tag:Ei.TRACER,name:Mi.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new Si(e.mediaStreamTrack,e.encoderConfig?Bw(e.encoderConfig):{},t,!1);return D.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:s}=e;const l={source:s instanceof AudioBuffer?"AudioBuffer":s instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":s,cacheOnlineFile:n,encoderConfig:r},h=Bn(8,"track-buf-"),p=ft.reportApiInvoke(null,{id:h,tag:Ei.TRACER,name:Mi.CREATE_BUFFER_AUDIO_TRACK,options:[l]});if(Y("DISABLE_WEBAUDIO"))throw new Re(H.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");D.info("start create buffer source audio track with config",JSON.stringify(l),"trackId",h);const m=s;if(!(s instanceof AudioBuffer))try{s=await async function(T,C){let I=null;if(typeof T=="string"){const k=XF.get(T);if(k)return D.debug("use cached audio resource: ",T),k;try{I=(await El(()=>Bs.get(T,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(M){throw new Re(H.FETCH_AUDIO_FILE_FAILED,M.toString())}}else I=await new Je((M,F)=>{const B=new FileReader;B.onload=ee=>{ee.target?M(ee.target.result):F(new Re(H.READ_LOCAL_AUDIO_FILE_ERROR))},B.onerror=()=>{F(new Re(H.READ_LOCAL_AUDIO_FILE_ERROR))},B.readAsArrayBuffer(T)});const U=await function(k){const M=vE();return new Je((F,B)=>{M.decodeAudioData(k,ee=>{F(ee)},ee=>{B(new Re(H.DECODE_AUDIO_FILE_FAILED,ee.toString()))})})}(I);return typeof T=="string"&&C&&XF.set(T,U),U}(s,n)}catch(T){return p.onError(T),T.throw(D)}const g=new nQ(s),v=new tQ(m,g,r?Bw(r):{},h);return D.info("create buffer source audio track success, trackId:",h),p.onSuccess(v.getTrackId()),v},setAppType:function(e){if(D.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw D.debug("Invalid appType"),new ye(H.INVALID_PARAMS,"invalid app type",e);wn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){D.setLogLevel(e)},enableLogUpload:function(){Y("USE_NEW_LOG")?wn("UPLOAD_LOG",!0):D.enableLogUpload()},disableLogUpload:function(){Y("USE_NEW_LOG")?wn("UPLOAD_LOG",!1):D.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new J3},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=ft.reportApiInvoke(null,{tag:Ei.TRACER,name:Mi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Si||e instanceof RE)){const m=new ye(H.INVALID_TRACK,"the parameter is not a audio track");return n.onError(m),m.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Si?e.getTrackLabel():"remote_track",s=e.getVolumeLevel();let l=s,h=s;const p=Date.now();return new Je(m=>{const g=setInterval(()=>{const v=e.getVolumeLevel();l=v>l?v:l,h=v<h?v:h;const T=l-h>1e-4,C=Date.now()-p;if(T||C>t){clearInterval(g);const I=T,U={duration:C,deviceLabel:r,maxVolumeLevel:l,result:I};D.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(U))),n.onSuccess(U),m(I)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=ft.reportApiInvoke(null,{tag:Ei.TRACER,name:Mi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Xn||e instanceof TE)){const T=new ye(H.INVALID_TRACK,"the parameter is not a video track");return n.onError(T),T.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Xn?e.getTrackLabel():"remote_track",s=e.getMediaStreamTrack(!0),l=document.createElement("video");l.style.width="1px",l.style.height="1px",l.setAttribute("muted",""),l.muted=!0,l.setAttribute("playsinline",""),l.controls=!1,(Dr()||Nw())&&(l.style.opacity="0.01",l.style.position="fixed",l.style.left="0",l.style.top="0",document.body.appendChild(l)),l.srcObject=new MediaStream([s]),l.play();const h=document.createElement("canvas");h.width=160,h.height=120;let p=0,m=0;try{const T=Date.now();p=await function(C,I,U,k){let M,F=0,B=null;return new Je((ee,ue)=>{function de(){F>k&&M&&(M(),ee(F));const ae=U.getContext("2d");if(!ae){const We=new ye(H.UNEXPECTED_ERROR,"can not get canvas 2d context.");return D.error(We.toString()),void ue(We)}ae.drawImage(C,0,0,160,120);const Te=ae.getImageData(0,0,U.width,U.height),Ae=Math.floor(Te.data.length/3);if(B){for(let We=0;We<Ae;We+=3)if(Te.data[We]!==B[We])return F+=1,void(B=Te.data);B=Te.data}else B=Te.data}setTimeout(()=>{M&&(M(),ee(F))},I),M=oP(()=>{de()},30)})}(l,t,h,4),m=Date.now()-T}catch(T){throw n.onError(T),T}T$===mn.SAFARI&&(l.pause(),l.remove()),l.srcObject=null;const g=p>4,v={duration:m,changedPicNum:p,deviceLabel:r,result:g};return D.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(v))),n.onSuccess(v),g},setArea:FP,audioElementPlayCenter:Gs,resumeAudioContext:function(){Gs.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){V$.processExternalMediaAEC(e)},registerExtensions:function(e){const t=Y("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!Ye(t).call(t,n.name)&&t.push(n.name);const r=n;r.__registered__=!0,r.logger.hookLog=D.extLog,r.reporter.hookApiInvoke=ft.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(s=>{r.parameters[s]=Y(s)})}),J6("PLUGIN_INFO",t)},ChannelMediaRelayError:wE,ChannelMediaRelayEvent:Bu,ChannelMediaRelayState:la,RemoteStreamFallbackType:YJ,RemoteStreamType:KJ,ConnectionDisconnectedReason:En,AudienceLatencyLevelType:bJ,AREAS:_n,preload:async function(e,t,n,r){return S4(e,t,n,r)}});return Object.defineProperties(Hi,{onAudioAutoplayFailed:{get:()=>co.onAudioAutoplayFailed,set:e=>{co.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>co.onAutoplayFailed,set:e=>{co.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Hi._onSecurityPolicyViolation,set(e){Hi._onSecurityPolicyViolation=e,O5(e)}},__CLIENT_LIST__:{get:()=>Y("SHOW_GLOBAL_CLIENT_LIST")?Nm:[]}}),oo.on(Cm.CAMERA_DEVICE_CHANGED,e=>{D.info("camera device changed",JSON.stringify(e)),Hi.onCameraChanged&&Hi.onCameraChanged(e),Hi.safeEmit(Cd.CAMERA_CHANGED,e)}),oo.on(Cm.RECORDING_DEVICE_CHANGED,e=>{D.info("microphone device changed",JSON.stringify(e)),Hi.onMicrophoneChanged&&Hi.onMicrophoneChanged(e),Hi.safeEmit(Cd.MICROPHONE_CHANGED,e)}),oo.on(Cm.PLAYOUT_DEVICE_CHANGED,e=>{D.debug("playout device changed",JSON.stringify(e)),Hi.onPlaybackDeviceChanged&&Hi.onPlaybackDeviceChanged(e),Hi.safeEmit(Cd.PLAYBACK_DEVICE_CHANGED,e)}),Gs.onAutoplayFailed=()=>{D.info("detect audio element autoplay failed"),co.onAudioAutoplayFailed&&co.onAudioAutoplayFailed()},An.on("autoplay-failed",()=>{D.info("detect webaudio autoplay failed"),co.onAudioAutoplayFailed&&co.onAudioAutoplayFailed(),Hi.safeEmit(Cd.AUTOPLAY_FAILED)}),An.on(br.STATE_CHANGE,(e,t)=>{D.info("audio context state changed: ".concat(t," => ").concat(e)),Hi.onAudioContextStateChanged&&Hi.onAudioContextStateChanged(e,t),Hi.safeEmit(Cd.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Ui.on(cE.NETWORK_STATE_CHANGE,(e,t)=>{D.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Hi),Hi})}(K0)),K0.exports}var ype=Epe();const Ik=TR(ype),vpe=({isCameraOn:o,isMuted:i})=>{const a=$r(),{name:d}=a.state||{},f=d?d.charAt(0).toUpperCase():"";console.log(`Local user name: ${d}, Initial: ${f}`);const{channelDetails:y}=Zi(le=>le.appointments),R=(y==null?void 0:y.appId)||null,w=(y==null?void 0:y.token)||null,N=(y==null?void 0:y.channelName)||null,O=(y==null?void 0:y.uid)||0;console.log("Agora Config (from Redux):",{APP_ID:R,TOKEN:w,CHANNEL:N,UID:O});const x=K.useRef(null),G=K.useRef(null),W=K.useRef(null),ne=K.useRef(null),[Q,se]=K.useState({}),te=K.useCallback(le=>{const ce=`Remote User ${le}`,me=ce.charAt(0).toUpperCase();return{name:ce,initial:me}},[]);return K.useEffect(()=>(x.current||(console.log("Creating new AgoraRTC client instance."),x.current=Ik.createClient({mode:"rtc",codec:"vp8"})),(async()=>{if(!R||!N||!w){console.error("Agora Error: Missing APP_ID, CHANNEL, or TOKEN. Cannot join.");return}try{console.log(`Attempting to join channel: ${N} with UID: ${O}`),await x.current.join(R,N,w,O),console.log("Successfully joined Agora channel."),G.current=await Ik.createMicrophoneAudioTrack(),W.current=await Ik.createCameraVideoTrack(),console.log("Local audio and video tracks created."),ne.current?(W.current.play(ne.current),console.log("Local video track playing.")):console.warn("Local video ref is not available. Cannot play local video."),await x.current.publish([G.current,W.current]),console.log("Local audio and video tracks published."),x.current.on("user-published",async(ce,me)=>{var ze;console.log(`User ${ce.uid} published ${me} track.`),await x.current.subscribe(ce,me);const{name:Ce,initial:_e}=te(ce.uid);if(se(Z=>({...Z,[ce.uid]:{...ce,audioMuted:!ce.hasAudio,videoMuted:!ce.hasVideo,remoteDisplayName:Ce,remoteDisplayInitial:_e}})),me==="video"){const Z=`remote-player-${ce.uid}`;setTimeout(()=>{var J;if(document.getElementById(Z)){(J=ce.videoTrack)==null||J.play(Z),console.log(`Playing video for user ${ce.uid} in ${Z}`);const $=document.getElementById(Z).querySelector("video");$&&($.style.width="100%",$.style.height="100%",$.style.objectFit="cover")}else console.warn(`Video player container ${Z} not found for user ${ce.uid}.`)},300)}else me==="audio"&&((ze=ce.audioTrack)==null||ze.play(),console.log(`Playing audio for user ${ce.uid}.`))}),x.current.on("user-updated",(ce,me)=>{console.log(`User ${ce.uid} updated: ${me} (hasAudio: ${ce.hasAudio}, hasVideo: ${ce.hasVideo})`),se(Ce=>{const _e=Ce[ce.uid]||{},ze=_e.videoMuted&&ce.hasVideo,Z={..._e,...ce,audioMuted:!ce.hasAudio,videoMuted:!ce.hasVideo};if(me==="video"&&ce.hasVideo&&ce.videoTrack&&ze){const J=`remote-player-${ce.uid}`;setTimeout(()=>{if(document.getElementById(J)){ce.videoTrack.play(J),console.log(`Re-playing video for user ${ce.uid} due to video state change (off to on).`);const $=document.getElementById(J).querySelector("video");$&&($.style.width="100%",$.style.height="100%",$.style.objectFit="cover")}},300)}return{...Ce,[ce.uid]:Z}})}),x.current.on("user-unpublished",(ce,me)=>{console.log(`User ${ce.uid} unpublished ${me} track.`),me==="video"&&ce.videoTrack&&(ce.videoTrack.stop(),console.log(`Stopped video for user ${ce.uid}.`)),se(Ce=>{const _e={...Ce};return _e[ce.uid]&&(me==="audio"?_e[ce.uid].audioMuted=!0:me==="video"&&(_e[ce.uid].videoMuted=!0)),_e})}),x.current.on("user-left",async ce=>{console.log(`User ${ce.uid} left the channel.`),se(me=>{const Ce={...me};return delete Ce[ce.uid],Ce})})}catch(ce){console.error("Agora Operation Error:",ce)}})(),()=>{console.log("Running Agora cleanup."),(async()=>{G.current&&(G.current.close(),G.current=null,console.log("Local audio track closed.")),W.current&&(W.current.close(),W.current=null,console.log("Local video track closed.")),x.current&&x.current.connectionState==="CONNECTED"&&(await x.current.leave(),console.log("Left Agora channel.")),x.current=null,se({}),console.log("Agora resources cleaned up.")})()}),[R,N,w,O,te]),K.useEffect(()=>{W.current&&(console.log(`Setting local camera to: ${o?"On":"Off"}`),W.current.setEnabled(o))},[o]),K.useEffect(()=>{G.current&&(console.log(`Setting local microphone to: ${i?"Muted":"Unmuted"}`),G.current.setEnabled(!i))},[i]),E.jsxs("div",{style:{position:"relative",width:"100%",height:"700px",backgroundColor:"#000",display:"flex",flexDirection:"column",overflow:"hidden"},children:[E.jsx("div",{id:"remote-video-grid-container",style:{flexGrow:1,backgroundColor:"#0c0d0f",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"10px",padding:"10px",overflowY:"auto",justifyContent:"center",alignContent:"center"},children:Object.entries(Q).map(([le,ce])=>E.jsxs("div",{id:`remote-player-${ce.uid}`,style:{width:"100%",aspectRatio:"4/3",position:"relative",borderRadius:"8px",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"2em",fontWeight:"bold",textAlign:"center",boxShadow:"0 2px 8px rgba(0,0,0,0.4)",backgroundColor:"#0c0d0f"},children:[ce.videoMuted?E.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:3},children:[ce.remoteDisplayInitial?E.jsx("span",{style:{fontSize:"3em"},children:ce.remoteDisplayInitial}):E.jsx("span",{children:"Video Off"}),ce.remoteDisplayName&&ce.remoteDisplayInitial&&E.jsxs("span",{style:{fontSize:"0.8em",marginTop:"5px"},children:["(",ce.remoteDisplayName,")"]})]}):E.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"#0c0d0f"}}),ce.audioMuted&&E.jsx("div",{style:{position:"absolute",top:"10px",right:"10px",backgroundColor:"rgba(255, 0, 0, 0.7)",color:"#fff",padding:"4px 8px",borderRadius:"4px",fontSize:"0.8em",zIndex:4},children:"Mic Off"})]},le))}),E.jsx("div",{style:{position:"absolute",bottom:"140px",right:"20px",width:"180px",height:"240px",backgroundColor:"#0c0d0f",borderRadius:"8px",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"3em",fontWeight:"bold",zIndex:10,boxShadow:"0 4px 12px rgba(0,0,0,0.6)",border:"2px solid rgba(255,255,255,0.3)"},children:o?E.jsx("div",{ref:ne,style:{width:"100%",height:"100%",backgroundColor:"#222"}}):E.jsx("div",{style:{backgroundColor:"black",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"48px",fontWeight:"bold",zIndex:2}})})]})},Spe=()=>{const o=qo(),[i,a]=K.useState(!1),[d,f]=K.useState(!0);K.useRef(null);const y=$r(),{id:R,patientId:w}=y.state||{},N=K.useRef([]),O=Mr(),{patientProfileData:x}=Zi(yt=>yt.patientProfile);K.useEffect(()=>{w&&O(ry({patientId:w}))},[O,w]);const G=(x==null?void 0:x.basic_information)||{},{completeAssignedPrescription:W,loading:ne,error:Q,medicineSearch:se,user:te}=Zi(yt=>yt.user),[le,ce]=K.useState([]),[me,Ce]=K.useState(""),[_e,ze]=K.useState(""),[Z,J]=K.useState(""),[$,fe]=K.useState(!1),ve=yt=>Ce(yt.target.value),pe=yt=>ze(yt.target.value),[he,Fe]=K.useState({}),[st,we]=K.useState(null),[je,nt]=K.useState([]),[Et,ge]=K.useState([{medicineName:"",dosage:"",frequency:"",duration:"",suggestions:[],showSuggestion:!1,isValid:!1}]),[qe,Oe]=K.useState(0);K.useEffect(()=>{const yt=setInterval(()=>{Oe(Vt=>Vt+1)},1e3);return()=>clearInterval(yt)},[]);const Be=()=>{ge([...Et,{medicineName:"",dosage:"",frequency:"",duration:"",suggestions:[],showSuggestion:!1,isValid:!1}])},[rt,Nt]=K.useState({}),$e=(yt,Vt,gt)=>{const Zt=[...Et];if(Zt[yt][Vt]=gt,Zt[yt].isValid=!1,Vt==="medicineName"){if(we(yt),he[yt]&&clearTimeout(he[yt]),gt.trim().length>0){const kn=setTimeout(()=>{O(QT({query:gt}))},500);Fe(ui=>({...ui,[yt]:kn}))}else Zt[yt].suggestions=[];const rn=[...je];rn[yt]="",nt(rn)}ge(Zt)};K.useEffect(()=>{if(se&&st!==null){const yt=[...Et];yt[st].suggestions=se,ge(yt),Nt(Vt=>({...Vt,[st]:se}))}},[se]);const mt=(yt,Vt)=>{const gt=[...Et];gt[yt].medicineName=Vt,gt[yt].suggestions=[],gt[yt].isValid=!0,ge(gt),nt(Zt=>{const rn=[...Zt];return rn[yt]="",rn}),Nt(Zt=>({...Zt,[yt]:Zt[yt]?Zt[yt]:[]})),we(null)};K.useEffect(()=>{function yt(Vt){fe(!1);const gt=[...Et];let Zt=!1;Et.forEach((rn,kn)=>{const ui=N.current[kn];ui&&!ui.contains(Vt.target)&&rn.suggestions.length>0&&(gt[kn].suggestions=[],Zt=!0)}),Zt&&ge(gt)}return document.addEventListener("mousedown",yt),()=>{document.removeEventListener("mousedown",yt)}},[Et]);const bt=async()=>{if(!_e||Et.some(rn=>!rn.medicineName||!rn.dosage||!rn.frequency||!rn.duration)){It.error("All fields are required (marked with *)");return}const yt=[...je];let Vt=!1;if(Et.forEach((rn,kn)=>{if(rn.isValid)yt[kn]="";else if(!(rt[kn]||[]).some(_r=>_r.product_name===rn.medicineName))yt[kn]="Please select a valid medicine name from suggestions",Vt=!0;else{yt[kn]="";const _r=[...Et];_r[kn].isValid=!0,ge(_r)}}),nt(yt),Vt)return;const gt={appointment_id:R,diagnosis:_e,notes:me,medicines:Et.map(rn=>({name:rn.medicineName,dosage:rn.dosage,frequency:rn.frequency,duration:rn.duration}))};console.log(gt,"ffff");const Zt=await O(k0(gt));Zt.payload&&Zt.payload.status&&o("/doctor-home")},Bt=()=>a(yt=>!yt),fn=()=>{f(yt=>!yt)},vn=()=>o("/doctor-home"),qi=yt=>{const Vt=String(Math.floor(yt/3600)).padStart(2,"0"),gt=String(Math.floor(yt%3600/60)).padStart(2,"0"),Zt=String(yt%60).padStart(2,"0");return`${Vt}:${gt}:${Zt}`};return E.jsx("main",{className:"doctor-panel video-call-pg",children:E.jsxs("div",{className:"container-fluid",children:[E.jsxs("div",{className:"doc-panel-inr",children:[" ",E.jsx(Va,{})," "]}),E.jsx("div",{className:"video-call-screen",children:E.jsxs("div",{className:"vdo-call-scrn-row row",children:[E.jsx("div",{className:"vdo-call-scrn-left-wrp col-lg-6",children:E.jsx("div",{className:"vdoclscrn-left",children:E.jsxs("div",{className:"vdo-screen",children:[E.jsxs("div",{className:"vdo-screen-controls",children:[E.jsxs("div",{className:"vdoscrn-controls-head",children:[E.jsx("h1",{children:te.name}),E.jsxs("div",{className:"vdoscrn-status-time-wrp",children:[E.jsx("span",{className:"vdoscrn-status live",children:"LIVE"}),E.jsx("span",{className:"vdoscrnduration-time",children:qi(qe)})]})]}),E.jsx("div",{className:"vdoscrn-controls-body",children:E.jsxs("div",{className:"vdoscrn-volume-con",children:[E.jsx("img",{src:"./images/speaker-icon.svg",alt:"Icon"}),E.jsx("input",{type:"range"})]})}),E.jsxs("div",{className:"vdoscrn-controls-ftr",children:[E.jsxs("div",{className:"vdoscrn-action-controls",children:[E.jsx("button",{className:"vdo-toggle-btn",onClick:fn,children:E.jsx("img",{src:d?"./images/video-cam-icon.svg":"./images/video-camera-off-icon.svg",alt:"Camera Icon",style:{filter:d?"none":"invert(100%)"}})}),E.jsx("button",{className:"vdo-call-end-btn",onClick:vn,style:{borderRadius:"50%",padding:"10px"},children:E.jsx("img",{src:"./images/call-icon.svg",alt:"Call End Icon"})}),E.jsx("button",{className:"vdo-mute-toggle-btn",onClick:Bt,children:E.jsx("img",{src:i?"./images/mic-off.svg":"./images/mic-icon.svg",alt:"Mic Icon",style:{filter:i?"invert(100%)":"none"}})})]}),E.jsx("div",{className:"doc-vdo-scrn"})]})]}),E.jsx("div",{className:"patient-vdo-screen",children:E.jsx(vpe,{isCameraOn:d,isMuted:i})})]})})}),E.jsx("div",{className:"vdoclscrn-patient-details-wrp col-lg-6",children:E.jsx("form",{children:E.jsxs("div",{className:"vdoclscrn-patient-details-wrp-inr",children:[E.jsxs("div",{className:"vdoclscrn-patient-details",children:[E.jsxs("div",{className:"vdoclscrnpd-wrp",children:[E.jsx("h2",{children:"Patient Details:"}),E.jsx("div",{className:"vdoclscrnpd",children:[{label:"Patient Name",value:G.name||"N/A"},{label:"Age",value:G.age||"N/A"},{label:"Gender",value:G.gender?G.gender.charAt(0).toUpperCase()+G.gender.slice(1):"N/A"},{label:"Height",value:G.height||"N/A"},{label:"Weight",value:G.weight||"N/A"},{label:"Contact No.",value:G.phone_no||"N/A"}].map((yt,Vt)=>E.jsxs("div",{className:"vdoclscrnpd-grp",children:[E.jsx("span",{className:"vdoclscrnpd-label",children:yt.label}),E.jsx("span",{className:"vdoclscrnpd-val",children:yt.value})]},Vt))})]}),E.jsxs("div",{className:"vdoclscrnpd-wrp",children:[E.jsx("h2",{children:"Report:"}),Et.map((yt,Vt)=>E.jsxs("div",{className:"",ref:gt=>N.current[Vt]=gt,children:[E.jsxs("div",{className:"vdoclscrnpd",children:[E.jsxs("div",{className:"formfield search-bar",children:[E.jsxs("label",{children:["Medicine Name",E.jsx("span",{children:"*"})]}),E.jsxs("div",{className:"search-input",children:[E.jsx("input",{type:"text",placeholder:"Ibupro",value:yt.medicineName,onChange:gt=>$e(Vt,"medicineName",gt.target.value),autoComplete:"off"}),E.jsx("input",{type:"submit",value:"search"}),je[Vt]&&E.jsx("div",{style:{color:"red",fontSize:"12px"},children:je[Vt]}),st===Vt&&yt.medicineName&&!je[Vt]&&E.jsx("ul",{style:{position:"absolute",backgroundColor:"white",border:"1px solid #ccc",width:"100%",maxHeight:"150px",overflowY:"auto",zIndex:10,marginTop:-5,paddingLeft:"10px",listStyle:"none"},children:yt.suggestions.length>0?yt.suggestions.map((gt,Zt)=>E.jsx("li",{onClick:()=>mt(Vt,gt.product_name),style:{cursor:"pointer",padding:5},children:gt.product_name},Zt)):yt.medicineName.trim().length>0&&!je[Vt]&&E.jsx("li",{style:{padding:5,color:"#999"},children:"No data found"})})]})]}),E.jsxs("div",{className:"formfield",children:[E.jsxs("label",{children:["Dosage",E.jsx("span",{children:"*"})]}),E.jsx("input",{type:"text",placeholder:"Dosage",value:yt.dosage,onChange:gt=>$e(Vt,"dosage",gt.target.value),required:!0})]}),E.jsxs("div",{className:"formfield",children:[E.jsxs("label",{children:["Frequency",E.jsx("span",{children:"*"})]}),E.jsxs("select",{value:yt.frequency,onChange:gt=>$e(Vt,"frequency",gt.target.value),required:!0,style:{backgroundColor:"#F9F9F9",padding:"8px",width:"100%",borderRadius:"4px",fontSize:"16px"},children:[E.jsx("option",{value:"",children:"Select Frequency"}),E.jsx("option",{value:"1 time (in a day)",children:"1 time (in a day)"}),E.jsx("option",{value:"2 times (in a day)",children:"2 times (in a day)"}),E.jsx("option",{value:"3 times (in a day)",children:"3 times (in a day)"})]})]}),E.jsxs("div",{className:"formfield",children:[E.jsxs("label",{children:["Duration",E.jsx("span",{children:"*"})]}),E.jsx("input",{type:"text",placeholder:"Duration",value:yt.duration,onChange:gt=>$e(Vt,"duration",gt.target.value),required:!0})]})]}),E.jsx("hr",{style:{border:"none",height:"3px",backgroundColor:"#333",margin:"10px 0"}})]},`medicine-${Vt}`)),E.jsxs("button",{type:"button",className:"orange-btn",onClick:Be,style:{margin:"20px 0",padding:0,minWidth:"150px"},children:[E.jsx("img",{src:"./images/plus-icon-circle.svg",alt:"Icon"})," ","Add More"]})]}),E.jsx("div",{className:"add-notes-wrp vdoclscrnpd",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Notes:"}),E.jsx("input",{type:"text",placeholder:"Notes",value:me,onChange:ve})]})}),E.jsx("div",{className:"add-notes-wrp vdoclscrnpd",children:E.jsxs("div",{className:"formfield",children:[E.jsxs("label",{children:["Disease ",E.jsx("span",{children:"*"})]}),E.jsx("input",{type:"text",placeholder:"Parasitic disease",value:_e,onChange:pe})]})})]}),E.jsx("button",{type:"button",className:"orange-btn",onClick:bt,disabled:ne,children:ne?"Submitting...":"Submit"})]})})})]})})]})})};function Tpe(){const o=qo();return K.useEffect(()=>{localStorage.getItem("doctor-app")?(It.error("The URL you entered does not exist. Redirected to home."),o("/doctor-home",{replace:!0})):(It.error("Please login first"),o("/",{replace:!0}))},[o]),null}const Rpe=()=>{const i=Mr(),{pendingPrescription:a,completedPrescription:d,loading:f,error:y}=Zi(Z=>Z.user),[R,w]=K.useState("pending"),[N,O]=K.useState(null),[x,G]=K.useState(1),W=5;K.useEffect(()=>{i(R0()),i(b0())},[i]);const ne=Z=>{w(Z),G(1)},Q=Z=>{const J=R===Z;return{color:J||N===Z?"var(--white)":"var(--theme-clr-2)",backgroundColor:J?"var(--theme-clr-2)":"var(--white)",border:"1px solid var(--theme-clr-2)",fontWeight:"500",fontSize:"18px",padding:"5px 30px",transition:"color 0.3s ease-in-out, background-color 0.3s ease-in-out"}},se=R==="pending"?a||[]:d||[],te=Math.ceil(se.length/W),le=x*W,ce=le-W,me=se.slice(ce,le),Ce=Z=>{G(Z)},_e=()=>x<te&&G(x+1),ze=()=>x>1&&G(x-1);return E.jsx(E.Fragment,{children:E.jsx("main",{className:"doctor-panel",children:E.jsxs("div",{className:"container-fluid",children:[E.jsx("div",{className:"doc-panel-inr",children:E.jsx(Va,{})}),f?E.jsx("div",{className:"loader-main",children:E.jsx("span",{className:"loader"})}):E.jsxs("div",{className:"doc-panel-body",children:[E.jsx("div",{className:"docpnl-sec-head",children:E.jsx("h1",{className:"h2-title",children:"Pending Prescriptions"})}),E.jsx("div",{className:"pending-prescriptions-wrp",children:E.jsxs("div",{className:"my-appointments-inr",children:[E.jsx("div",{className:"my-appointments-tab-header",children:E.jsx("div",{className:"",children:E.jsxs("ul",{style:{display:"flex",gap:"10px",listStyle:"none",padding:0},children:[E.jsx("li",{className:"cmn-btn",onClick:()=>ne("pending"),style:Q("pending"),onMouseEnter:()=>O("pending"),onMouseLeave:()=>O(null),children:"Pending"}),E.jsx("li",{className:"cmn-btn",onClick:()=>ne("completed"),style:Q("completed"),onMouseEnter:()=>O("completed"),onMouseLeave:()=>O(null),children:"Completed"})]})})}),R==="pending"&&E.jsx("div",{className:"myapintmnt-content-tab pending",children:E.jsx("div",{className:"pending-presc-table",children:E.jsxs("table",{children:[E.jsx("thead",{children:E.jsxs("tr",{children:[E.jsx("th",{children:"S.no."}),E.jsx("th",{children:"Patient Name"}),E.jsx("th",{children:"Symptom Upload Date"}),E.jsx("th",{children:"View Details"})]})}),E.jsxs("tbody",{children:[me.length==0&&E.jsx("tr",{children:E.jsx("td",{colSpan:"8",style:{textAlign:"center"},children:f?"Loading...":"No data found"})}),me.map((Z,J)=>{var $,fe;return E.jsxs("tr",{children:[E.jsx("td",{children:(x-1)*W+J+1}),E.jsxs("td",{style:{textAlign:"left",paddingLeft:"45px",width:"200px"},children:[E.jsx(Wt,{to:"/patient-profile",state:{patientId:Z.patient_id},className:"no-underline-link",style:{display:"inline-block"},children:Z.patient_name}),(Z==null?void 0:Z.ds_code)&&E.jsxs("div",{className:"time",style:{color:"#199FD9"},children:["(DS Code: ",Z.ds_code,")"]})]}),E.jsxs("td",{children:[E.jsx("div",{className:"date",children:($=Z.symptom_upload_date)==null?void 0:$.split(" ")[0]}),E.jsx("div",{className:"time",children:(fe=Z.symptom_upload_date)==null?void 0:fe.split(" ").slice(1).join(" ")})]}),E.jsx("td",{children:E.jsx(Wt,{to:"/PendingAssignedPrescriptionDetails",state:{id:Z.id,patientId:Z.patient_id},children:"View"})})]},J)})]})]})})}),R==="completed"&&E.jsx("div",{className:"myapintmnt-content-tab completed",children:E.jsx("div",{className:"pending-presc-table",children:E.jsxs("table",{children:[E.jsx("thead",{children:E.jsxs("tr",{children:[E.jsx("th",{children:"S.no."}),E.jsx("th",{children:"Patient Name"}),E.jsx("th",{children:"Symptom Upload Date"}),E.jsx("th",{children:"Respond Date"}),E.jsx("th",{children:"Download Prescription"}),E.jsx("th",{children:"View Profile"})]})}),E.jsx("tbody",{children:me.map((Z,J)=>{var $,fe;return E.jsxs("tr",{children:[E.jsx("td",{children:ce+J+1}),E.jsxs("td",{style:{textAlign:"left",paddingLeft:"45px",width:"200px"},children:[E.jsx(Wt,{to:"/patient-profile",state:{patientId:Z.patient_id},className:"no-underline-link",style:{display:"inline-block"},children:Z.patient_name}),(Z==null?void 0:Z.ds_code)&&E.jsxs("div",{className:"time",style:{color:"#199FD9"},children:["(DS Code: ",Z.ds_code,")"]})]}),E.jsxs("td",{children:[E.jsx("div",{className:"date",children:Z.symptom_upload_date.split(" ")[0]}),E.jsx("div",{className:"time",children:Z.symptom_upload_date.split(" ").slice(1).join(" ")})]}),E.jsxs("td",{children:[E.jsx("div",{className:"date",children:($=Z.respond_date)==null?void 0:$.split(" ")[0]}),E.jsx("div",{className:"time",children:(fe=Z.respond_date)==null?void 0:fe.split(" ").slice(1).join(" ")})]}),E.jsx("td",{children:E.jsxs("div",{className:"dwnld-btn",children:[E.jsx("img",{src:"./images/dwnld-icon.svg",alt:"Download Icon"}),E.jsx("a",{href:"undefined/"+Z.prescription_link,download:!0,target:"_blank",children:"Download"})]})}),E.jsx("td",{children:E.jsx(Wt,{to:"/patient-profile",state:{patientId:Z.patient_id,hideSchedule:!0,source:"prescription"},children:"View"})})]},J)})})]})})}),se.length>0&&E.jsx(nR,{currentPage:x,totalPages:te,onPageChange:Ce,onPrevious:ze,onNext:_e})]})})]}),E.jsx(go,{})]})})})},bpe=()=>{var me,Ce,_e,ze,Z;const o=$r(),{id:i,patientId:a}=o.state||{},d=Mr(),{symptomUploadDetail:f,loading:y}=Zi(J=>J.user),R=void 0,[w,N]=K.useState({patient_name:"",dayDate:"",time:"",name:"",height:"",weight:"",age:"",gender:"",contactno:"",questions:"",files:[]}),[O,x]=K.useState(null),[G,W]=K.useState(!1),[ne,Q]=K.useState(null),[se,te]=K.useState(!1);K.useEffect(()=>{i&&d(C0({symptom_id:i}))},[d,i]),K.useEffect(()=>{f!=null&&f.basicInformation&&N({patient_name:f.patientData.patient_name||"",dayDate:f.patientData.dayDate||"",time:f.patientData.time||"",name:f.basicInformation.name||"",height:f.basicInformation.height||"",weight:f.basicInformation.weight||"",age:f.basicInformation.age||"",gender:f.basicInformation.gender||"",questions:f.symptomAnswers||"",files:f.symptomFiles||[]})},[f]);const le=(J,$)=>J.some(fe=>$.some(ve=>fe.file_type.toLowerCase().includes(ve))),ce=J=>{Q(J),te(!0)};return E.jsx("main",{className:"doctor-panel",children:E.jsxs("div",{className:"container-fluid",children:[E.jsx("div",{className:"doc-panel-inr",children:E.jsx(Va,{})}),y?E.jsx("div",{className:"loader-main",children:E.jsx("span",{className:"loader"})}):E.jsxs("div",{className:"doc-panel-body appoint-details-pg has-texture papd-pg",children:[E.jsx("div",{className:"texture only-img",children:E.jsx("img",{src:"./images/doctor-symbol.png",alt:"Image"})}),E.jsxs("div",{className:"appointments",children:[E.jsxs("div",{className:"start-appointment cmn-mb",children:[E.jsxs("div",{className:"docpnl-sec-head",children:[E.jsx("h1",{className:"h2-title",children:"Symptom Upload Details"}),E.jsx("div",{className:"back-btn",children:E.jsx(Wt,{to:"#",onClick:J=>{J.preventDefault(),window.history.back()},children:E.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),E.jsxs("div",{className:"apointment-detail-card",children:[E.jsx("div",{className:"apoint-dtl-img",children:E.jsx("img",{src:`${R}/${(me=f==null?void 0:f.patientData)==null?void 0:me.patient_profile}`,alt:"Client Image"})}),E.jsxs("div",{className:"appoint-dtl-content",children:[E.jsxs("div",{className:"appoint-dtl-left",children:[E.jsx("div",{className:"appoint-dtl-head",children:E.jsx("h2",{className:"h4-title",children:w.patient_name})}),E.jsx("div",{className:"date h3-title",children:w.dayDate}),E.jsx("div",{className:"time",children:w.time})]}),E.jsx(Wt,{to:"/patient-profile",state:{patientId:a,source:"prescription",hideSchedule:!0},className:"cmn-btn",children:"View profile"})]})]})]}),E.jsx("div",{className:"patient-details-wrp",children:E.jsx("form",{children:E.jsxs("div",{className:"patient-dtl-form",children:[E.jsxs("div",{className:"patient-basic-info cmn-mb2",children:[E.jsx("h2",{children:"Basic Information"}),E.jsxs("div",{className:"row",children:[E.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Full Name"}),E.jsx("input",{type:"text",placeholder:"Name",value:w.name,readOnly:!0})]})}),E.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Enter Your Height"}),E.jsx("input",{type:"text",placeholder:"175",value:w.height,readOnly:!0})]})}),E.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Enter Your Weight"}),E.jsx("input",{type:"text",placeholder:"70kg",value:w.weight,readOnly:!0})]})}),E.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Gender"}),E.jsx("input",{type:"text",placeholder:"Male",value:w.gender,readOnly:!0})]})}),E.jsx("div",{className:"col-lg-4 col-md-4 col-sm-6",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Enter Age"}),E.jsx("input",{type:"text",placeholder:"32",value:w.age,readOnly:!0})]})})]})]}),E.jsxs("div",{className:"scheduled-call-consultations cmn-mb2",children:[E.jsx("h2",{children:"Uploaded Symptoms"}),E.jsxs("div",{className:"row",children:[E.jsx("div",{className:"col-lg-12",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{style:{fontSize:"16px"},children:"1. How long are you suffering from this disease?"}),E.jsx("input",{type:"text",placeholder:"Answer",value:(Ce=w.questions)==null?void 0:Ce.answer1,readOnly:!0})]})}),E.jsx("div",{className:"col-lg-12",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{style:{fontSize:"16px"},children:"2. Any other problem which you would like to share related to your problem?"}),E.jsx("input",{type:"text",placeholder:"Answer",value:(_e=w.questions)==null?void 0:_e.answer2,readOnly:!0})]})}),E.jsx("div",{className:"col-lg-12",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{style:{fontSize:"16px"},children:"3. Do you have any history of this disease?"}),E.jsx("input",{type:"text",placeholder:"Answer",value:(ze=w.questions)==null?void 0:ze.answer3,readOnly:!0})]})}),E.jsx("div",{className:"col-lg-12",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{style:{fontSize:"16px"},children:"4. Are you taking any medicines? If yes, please share the name of medicine and since how long you are taking this medicine?"}),E.jsx("input",{type:"text",placeholder:"Answer",value:(Z=w.questions)==null?void 0:Z.answer4,readOnly:!0})]})})]})]}),le(w.files,["jpg","jpeg","png","gif"])&&E.jsxs("div",{className:"view-uploaded-images-wrp",children:[E.jsx("h2",{children:"View Uploaded Images"}),E.jsx("div",{className:"view-uploaded-img",children:w.files.filter(J=>["jpg","jpeg","png","gif"].some($=>J.file_type.toLowerCase().includes($))).map((J,$)=>E.jsx("div",{className:"img-wrp",children:E.jsx("a",{href:"#",onClick:fe=>{fe.preventDefault(),x(J),W(!0)},children:E.jsx("img",{src:`${R}/${J.file_path}`,alt:`Symptom Image ${$+1}`})})},$))}),G&&O&&E.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center"},children:[E.jsx("button",{onClick:()=>W(!1),style:{position:"fixed",right:"30px",top:"30px",zIndex:1060,background:"transparent",border:"none",cursor:"pointer",padding:0},"aria-label":"Close",children:E.jsx("img",{src:"/images/cross-blue.png",alt:"Close",style:{width:"24px",height:"24px",filter:"brightness(0) invert(1)"}})}),E.jsx("div",{style:{maxWidth:"90vw",maxHeight:"90vh",display:"flex",alignItems:"center",justifyContent:"center"},children:E.jsx("img",{src:`${R}/${O.file_path}`,alt:"Enlarged view",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})})]})]}),le(w.files,["mp4","webm","ogg"])&&E.jsxs("div",{className:"view-uploaded-images-wrp uploaded-vdo-wrp",children:[E.jsx("h2",{children:"View Uploaded Videos"}),E.jsx("div",{className:"view-uploaded-img",children:w.files.filter(J=>["mp4","webm","ogg"].some($=>J.file_type.toLowerCase().includes($))).map((J,$)=>E.jsx("div",{className:"img-wrp",children:E.jsx("a",{href:"#",onClick:fe=>{fe.preventDefault(),ce(J)},children:E.jsxs("video",{width:"100%",children:[E.jsx("source",{src:`${R}/${J.file_path}`,type:`video/${J.file_type.split(".").pop()}`}),"Your browser does not support the video tag."]})})},$))}),se&&ne&&E.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center"},children:[E.jsx("button",{onClick:()=>te(!1),style:{position:"fixed",right:"30px",top:"30px",zIndex:1060,background:"transparent",border:"none",cursor:"pointer",padding:0},"aria-label":"Close",children:E.jsx("img",{src:"/images/cross-blue.png",alt:"Close",style:{width:"24px",height:"24px",filter:"brightness(0) invert(1)"}})}),E.jsx("div",{style:{width:"80vw",maxWidth:"800px",maxHeight:"80vh",display:"flex",alignItems:"center",justifyContent:"center"},children:E.jsxs("video",{controls:!0,autoPlay:!0,style:{width:"100%",maxHeight:"100%",objectFit:"contain"},children:[E.jsx("source",{src:`${R}/${ne.file_path}`,type:`video/${ne.file_type.split(".").pop()}`}),"Your browser does not support the video tag."]})})]})]}),le(w.files,["pdf","doc","docx"])&&E.jsxs("div",{className:"view-uploaded-images-wrp upload-file-wrp",children:[E.jsx("h2",{children:"View Uploaded Files"}),E.jsx("div",{className:"view-uploaded-img",children:w.files.filter(J=>["pdf","doc","docx"].some($=>J.file_type.toLowerCase().includes($))).map((J,$)=>E.jsx("div",{className:"img-wrp",children:E.jsxs("a",{href:`${R}/${J.file_path}`,target:"_blank",rel:"noopener noreferrer",children:[E.jsx("img",{src:"./images/file-icon.svg",alt:"File Icon"}),E.jsx("span",{className:"file-size",children:"Click to view"})]})},$))})]}),E.jsx("div",{className:"btn-wrp",children:E.jsx(Wt,{to:"/CompletedAssignedPrescription",state:{id:i,patientId:a},children:E.jsx("button",{type:"button",className:"orange-btn",children:"Respond"})})})]})})})]})]}),E.jsx(go,{})]})})},Cpe=({show:o,handleClose:i})=>{const a=qo(),d=()=>{i(),a("/pendingprescription")};return E.jsxs(tr,{show:o,onHide:i,centered:!0,dialogClassName:"custom-modal",children:[E.jsx("style",{children:`
            .custom-modal .modal-content {
              border-radius: 15px !important;
              // border: 12px solid red;
                max-width: 400px; 
  margin: auto;
            }
          `}),E.jsxs(tr.Body,{className:"text-center p-4",children:[E.jsx("div",{style:{marginBottom:"20px"},children:E.jsx("img",{src:"/images/check-icon.png",alt:"Success"})}),E.jsx("h4",{style:{fontSize:"22px",fontWeight:"600",color:"#333",marginBottom:"8px"},children:"Successfully Submitted"}),E.jsx("p",{style:{fontSize:"16px",color:"#888",marginBottom:"25px"},children:"Prescription successfully submitted"}),E.jsx(vy,{variant:"primary",onClick:d,style:{backgroundColor:"#f37021",border:"none",padding:"12px 30px",fontSize:"16px",borderRadius:"8px",width:"100%",maxWidth:"200px"},children:"Ok"})]})]})},wpe=()=>{const o=$r(),{id:i,patientId:a}=o.state||{},d=K.useRef([]),f=Mr(),{patientProfileData:y}=Zi(Oe=>Oe.patientProfile);K.useEffect(()=>{window.scrollTo(0,0)},[]),K.useEffect(()=>{a&&f(ry({patientId:a}))},[f,a]);const R=(y==null?void 0:y.basic_information)||{},{loading:w,loading2:N,error:O,completeAssignedPrescription:x,medicineSearch:G}=Zi(Oe=>Oe.user),[W,ne]=K.useState(!1),[Q,se]=K.useState([]),[te,le]=K.useState(""),[ce,me]=K.useState(""),[Ce,_e]=K.useState(""),[ze,Z]=K.useState(!1),J=Oe=>le(Oe.target.value),$=Oe=>me(Oe.target.value),[fe,ve]=K.useState({}),[pe,he]=K.useState(null),[Fe,st]=K.useState([]),[we,je]=K.useState([{medicineName:"",dosage:"",frequency:"",duration:"",suggestions:[],showSuggestion:!1,isSelectedFromSuggestions:!1}]),nt=()=>{je([...we,{medicineName:"",dosage:"",frequency:"",duration:"",suggestions:[],showSuggestion:!1,isSelectedFromSuggestions:!1}])},Et=(Oe,Be,rt)=>{const Nt=[...we];if(Nt[Oe][Be]=rt,Be==="medicineName"){if(Nt[Oe].isSelectedFromSuggestions=!1,he(Oe),fe[Oe]&&clearTimeout(fe[Oe]),rt.trim().length>0){const mt=setTimeout(()=>{f(QT({query:rt}))},500);ve(bt=>({...bt,[Oe]:mt}))}else Nt[Oe].suggestions=[];const $e=[...Fe];$e[Oe]="",st($e)}je(Nt)};K.useEffect(()=>{if(G&&pe!==null){const Oe=[...we];Oe[pe].suggestions=G,je(Oe)}},[G]);const ge=(Oe,Be)=>{const rt=[...we];rt[Oe].medicineName=Be,rt[Oe].suggestions=[],rt[Oe].isSelectedFromSuggestions=!0,je(rt),st(Nt=>{const $e=[...Nt];return $e[Oe]=null,$e}),he(null)};K.useEffect(()=>{function Oe(Be){Z(!ze);const rt=[...we];let Nt=!1;we.forEach(($e,mt)=>{const bt=d.current[mt];bt&&!bt.contains(Be.target)&&$e.suggestions.length>0&&(rt[mt].suggestions=[],Nt=!0)}),Nt&&je(rt)}return document.addEventListener("mousedown",Oe),()=>{document.removeEventListener("mousedown",Oe)}},[we]);const qe=async()=>{var Nt,$e;if(!ce||we.some(mt=>!mt.medicineName||!mt.dosage||!mt.frequency||!mt.duration)){It.error("All fields are required (marked with *)",{toastId:"required-fields-toast",style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}});return}const Oe=[...Fe];let Be=!1;if(we.forEach((mt,bt)=>{mt.isSelectedFromSuggestions?Oe[bt]="":(Oe[bt]="Please select a valid medicine name from suggestions",Be=!0)}),st(Oe),Be)return;const rt={symptom_id:i,diagnosis:ce,notes:te,medicines:we.map(mt=>({name:mt.medicineName,dosage:mt.dosage,frequency:mt.frequency,duration:mt.duration}))};try{const mt=await f(w0(rt));((Nt=mt.payload)==null?void 0:Nt.status)===!0?ne(!0):It.error((($e=mt.payload)==null?void 0:$e.message)||"Failed to complete prescription")}catch(mt){It.error("An error occurred while submitting the prescription"),console.error("Submission error:",mt)}};return E.jsx("main",{className:"doctor-panel",children:E.jsxs("div",{className:"container-fluid",children:[E.jsx("div",{className:"doc-panel-inr",children:E.jsx(Va,{})}),w?E.jsx("div",{className:"loader-main",children:E.jsx("span",{className:"loader"})}):E.jsx("div",{className:"doc-panel-body cap-pg",children:E.jsx("div",{className:"vdoclscrn-patient-details-wrp",children:E.jsx("form",{onSubmit:Oe=>Oe.preventDefault(),children:E.jsx("div",{className:"vdoclscrn-patient-details-wrp-inr",children:E.jsxs("div",{className:"vdoclscrn-patient-details w-100",children:[E.jsxs("div",{className:"vdoclscrnpd-wrp",children:[E.jsx("h2",{children:"Patient Details:"}),E.jsx("div",{className:"vdoclscrnpd",children:[{label:"Patient Name",value:R.name||"N/A"},{label:"Age",value:R.age||"N/A"},{label:"Gender",value:R.gender||"N/A"},{label:"Height",value:R.height||"N/A"},{label:"Weight",value:R.weight||"N/A"},{label:"Contact No.",value:R.phone_no||"N/A"}].map((Oe,Be)=>E.jsxs("div",{className:"vdoclscrnpd-grp",children:[E.jsx("span",{className:"vdoclscrnpd-label",children:Oe.label}),E.jsx("span",{className:"vdoclscrnpd-val",children:Oe.value})]},Be))})]}),E.jsxs("div",{className:"vdoclscrnpd-wrp",children:[E.jsxs("div",{className:"vdoclscrnpd-wrp",children:[E.jsx("h2",{children:"Report:"}),we.map((Oe,Be)=>E.jsxs("div",{className:"",ref:rt=>d.current[Be]=rt,children:[E.jsxs("div",{className:"vdoclscrnpd",children:[E.jsxs("div",{className:"formfield search-bar",children:[E.jsxs("label",{children:["Medicine Name",E.jsx("span",{children:"*"})]}),E.jsxs("div",{className:"search-input",children:[E.jsx("input",{type:"text",placeholder:"Ibupro",value:Oe.medicineName,onChange:rt=>Et(Be,"medicineName",rt.target.value),autoComplete:"off"}),E.jsx("input",{type:"submit",value:"search"}),pe===Be&&Oe.medicineName&&!Fe[Be]&&E.jsx("ul",{style:{position:"absolute",backgroundColor:"white",border:"1px solid #ccc",width:"100%",maxHeight:"150px",overflowY:"auto",zIndex:10,marginTop:0,paddingLeft:"10px",listStyle:"none"},children:Oe.suggestions.length>0?Oe.suggestions.map((rt,Nt)=>E.jsx("li",{onClick:()=>ge(Be,rt.product_name),style:{cursor:"pointer",padding:5},children:rt.product_name},Nt)):Oe.medicineName.trim().length>0&&!Fe[Be]&&E.jsx("li",{style:{padding:5,color:"#999"},children:"No data found"})})]})]}),E.jsxs("div",{className:"formfield",children:[E.jsxs("label",{children:["Dosage",E.jsx("span",{children:"*"})]}),E.jsx("input",{type:"text",placeholder:"Dosage",value:Oe.dosage,onChange:rt=>Et(Be,"dosage",rt.target.value),required:!0})]}),E.jsxs("div",{className:"formfield",children:[E.jsxs("label",{children:["Frequency",E.jsx("span",{children:"*"})]}),E.jsxs("select",{value:Oe.frequency,onChange:rt=>Et(Be,"frequency",rt.target.value),required:!0,style:{backgroundColor:"#F9F9F9",padding:"8px",width:"100%",borderRadius:"4px",fontSize:"16px"},children:[E.jsx("option",{value:"",children:"Select Frequency"}),E.jsx("option",{value:"1 time (in a day)",children:"1 time (in a day)"}),E.jsx("option",{value:"2 times (in a day)",children:"2 times (in a day)"}),E.jsx("option",{value:"3 times (in a day)",children:"3 times (in a day)"})]})]}),E.jsxs("div",{className:"formfield",children:[E.jsxs("label",{children:["Duration",E.jsx("span",{children:"*"})]}),E.jsx("input",{type:"text",placeholder:"Duration",value:Oe.duration,onChange:rt=>Et(Be,"duration",rt.target.value),required:!0})]}),Fe[Be]&&E.jsx("div",{style:{color:"red",marginTop:"-5px",fontSize:"14px"},children:Fe[Be]})]}),E.jsx("hr",{style:{border:"none",height:"3px",backgroundColor:"#333",margin:"10px 0"}})]},`medicine-${Be}`)),E.jsxs("button",{type:"button",className:"orange-btn",onClick:nt,style:{margin:"20px 0",padding:0,minWidth:"150px"},children:[E.jsx("img",{src:"./images/plus-icon-circle.svg",alt:"Icon",style:{marginRight:"8px",verticalAlign:"middle"}}),"Add More"]})]}),E.jsx("div",{className:"add-notes-wrp vdoclscrnpd",children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Notes:"}),E.jsx("input",{type:"text",placeholder:"Notes",value:te,onChange:J})]})}),E.jsx("div",{className:"add-notes-wrp vdoclscrnpd",children:E.jsxs("div",{className:"formfield",children:[E.jsxs("label",{children:["Disease ",E.jsx("span",{children:"*"})]}),E.jsx("input",{type:"text",placeholder:"Parasitic disease",value:ce,onChange:$})]})})]}),E.jsx("button",{type:"button",className:"orange-btn",onClick:qe,disabled:w,children:"Submit"}),E.jsx(Cpe,{show:W,handleClose:()=>ne(!1)})]})})})})}),E.jsx(go,{})]})})},Ape=()=>E.jsx(E.Fragment,{children:E.jsx("main",{className:"doctor-panel",children:E.jsxs(G9,{fluid:!0,children:[E.jsx("div",{className:"doc-panel-inr",children:E.jsx(Va,{})}),E.jsxs("div",{className:"doc-panel-body appoint-details-pg has-texture papd-pg",children:[E.jsx("div",{className:"texture only-img",children:E.jsx("img",{src:"./images/doctor-symbol.png",alt:"Symbol"})}),E.jsxs("div",{className:"appointments",children:[E.jsxs("div",{className:"start-appointment cmn-mb",children:[E.jsxs("div",{className:"docpnl-sec-head",children:[E.jsx("h1",{className:"h2-title",children:"Symptom Upload Details"}),E.jsx("div",{className:"back-btn",children:E.jsx(Wt,{to:"#",onClick:o=>{o.preventDefault(),window.history.back()},children:E.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),E.jsxs("div",{className:"apointment-detail-card",children:[E.jsx("div",{className:"apoint-dtl-img",children:E.jsx("img",{src:"./images/client-img-5.png",alt:"Patient"})}),E.jsxs("div",{className:"appoint-dtl-content",children:[E.jsxs("div",{className:"appoint-dtl-left",children:[E.jsx("div",{className:"date h3-title",children:"21/12/2024"}),E.jsx("div",{className:"time",children:"10:40 PM"})]}),E.jsx(Wt,{to:"/patient-profile",className:"cmn-btn",children:"View profile"})]})]})]}),E.jsx("div",{className:"patient-details-wrp",children:E.jsx(XL,{children:E.jsxs("div",{className:"patient-dtl-form",children:[E.jsxs("div",{className:"patient-basic-info cmn-mb2",children:[E.jsx("h2",{children:"Basic Information"}),E.jsx(zk,{children:["Name","Height","Weight","Gender","Age"].map((o,i)=>E.jsx(J0,{lg:4,md:4,sm:6,children:E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:o}),E.jsx(XL.Control,{type:"text",placeholder:o==="Name"?"Name":"Answer"})]})},i))})]}),E.jsxs("div",{className:"scheduled-call-consultations cmn-mb2",children:[E.jsx("h2",{children:"Uploaded Symptoms"}),E.jsx(zk,{children:[1,2,3,4].map(o=>E.jsx(J0,{lg:12,children:E.jsxs("div",{className:"formfield",children:[E.jsxs("label",{children:[o,". Lorem ipsum dolor sit amet"]}),E.jsx(XL.Control,{type:"text",placeholder:"Answer"})]})},o))})]}),E.jsxs("div",{className:"view-uploaded-images-wrp",children:[E.jsx("h2",{children:"View Uploaded Images"}),E.jsx("div",{className:"view-uploaded-img",children:[...Array(3)].map((o,i)=>E.jsx("div",{className:"img-wrp",children:E.jsx("a",{href:"./images/symptom-img.png","data-fancybox":"symptoms",children:E.jsx("img",{src:"./images/symptom-img.png",alt:"Symptom"})})},i))})]}),E.jsxs("div",{className:"view-uploaded-images-wrp uploaded-vdo-wrp",children:[E.jsx("h2",{children:"View Uploaded Videos"}),E.jsx("div",{className:"view-uploaded-img",children:[...Array(3)].map((o,i)=>E.jsx("div",{className:"img-wrp",children:E.jsx("a",{href:"https://youtu.be/EngW7tLk6R8?si=m3prZmspIQt_MGXm","data-fancybox":"symptoms",children:E.jsx("img",{src:"./images/symptom-img.png",alt:"Video"})})},i))})]}),E.jsxs("div",{className:"view-uploaded-images-wrp upload-file-wrp",children:[E.jsx("h2",{children:"View Uploaded Files"}),E.jsx("div",{className:"view-uploaded-img",children:[...Array(3)].map((o,i)=>E.jsx("div",{className:"img-wrp",children:E.jsxs("a",{href:"./images/file-icon.svg","data-fancybox":"symptoms",children:[E.jsx("img",{src:"./images/file-icon.svg",alt:"File"}),E.jsx("span",{className:"file-size",children:"5.3mb"})]})},i))})]}),E.jsx("div",{className:"btn-wrp",children:E.jsx(Wt,{to:"/CompletedAssignedPrescription",children:E.jsx("button",{type:"button",className:"orange-btn",children:"Respond"})})})]})})})]})]}),E.jsx(go,{})]})})});var GW={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},E9=Hn.createContext&&Hn.createContext(GW),Ipe=["attr","size","title"];function Npe(o,i){if(o==null)return{};var a=Ope(o,i),d,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(o);for(f=0;f<y.length;f++)d=y[f],!(i.indexOf(d)>=0)&&Object.prototype.propertyIsEnumerable.call(o,d)&&(a[d]=o[d])}return a}function Ope(o,i){if(o==null)return{};var a={};for(var d in o)if(Object.prototype.hasOwnProperty.call(o,d)){if(i.indexOf(d)>=0)continue;a[d]=o[d]}return a}function SI(){return SI=Object.assign?Object.assign.bind():function(o){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(o[d]=a[d])}return o},SI.apply(this,arguments)}function y9(o,i){var a=Object.keys(o);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(o);i&&(d=d.filter(function(f){return Object.getOwnPropertyDescriptor(o,f).enumerable})),a.push.apply(a,d)}return a}function TI(o){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?arguments[i]:{};i%2?y9(Object(a),!0).forEach(function(d){Dpe(o,d,a[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(a)):y9(Object(a)).forEach(function(d){Object.defineProperty(o,d,Object.getOwnPropertyDescriptor(a,d))})}return o}function Dpe(o,i,a){return i=Ppe(i),i in o?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a,o}function Ppe(o){var i=Lpe(o,"string");return typeof i=="symbol"?i:i+""}function Lpe(o,i){if(typeof o!="object"||!o)return o;var a=o[Symbol.toPrimitive];if(a!==void 0){var d=a.call(o,i);if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(o)}function HW(o){return o&&o.map((i,a)=>Hn.createElement(i.tag,TI({key:a},i.attr),HW(i.child)))}function kpe(o){return i=>Hn.createElement(xpe,SI({attr:TI({},o.attr)},i),HW(o.child))}function xpe(o){var i=a=>{var{attr:d,size:f,title:y}=o,R=Npe(o,Ipe),w=f||a.size||"1em",N;return a.className&&(N=a.className),o.className&&(N=(N?N+" ":"")+o.className),Hn.createElement("svg",SI({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},a.attr,d,R,{className:N,style:TI(TI({color:o.color||a.color},a.style),o.style),height:w,width:w,xmlns:"http://www.w3.org/2000/svg"}),y&&Hn.createElement("title",null,y),o.children)};return E9!==void 0?Hn.createElement(E9.Consumer,null,a=>i(a)):i(GW)}function Mpe(o){return kpe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"},child:[]}]})(o)}const Upe=()=>{const o=Mr(),{user:i,loading:a}=Zi(ne=>ne.user),d=void 0;K.useEffect(()=>{o(Pp())},[o]);const[f,y]=K.useState(!1),[R,w]=K.useState({fullName:"",email:"",phone:"",experience:"",profilePic:""});K.useEffect(()=>{i&&w(ne=>({...ne,fullName:i.name||"",email:i.email||"",phone:i.contact_no||"",experience:i.experience||"",profilePic:d+"/"+i.profile_path||""}))},[i]);const N=ne=>{const{name:Q,value:se}=ne.target;w(te=>({...te,[Q]:se}))},O=async ne=>{const Q=ne.target.files[0];if(!Q)return;const se=URL.createObjectURL(Q);w(le=>({...le,profilePic:se}));const te=new FormData;te.append("profileImage",Q);try{const le=await o(S0(te));le.payload&&le.payload.status?await o(Pp()):w(ce=>({...ce,profilePic:i.profile_path||"/images/my-profile-img.png"}))}catch(le){console.error("Error uploading image:",le),w(ce=>({...ce,profilePic:i.profile_path||"/images/my-profile-img.png"}))}},x=async()=>{try{const ne=await o(T0());ne.payload&&ne.payload.status?await o(Pp()):console.log("failed to delete image")}catch(ne){console.log("Error deleting image",ne)}},G=async()=>{const ne=await o(v0({name:R.fullName,contact_no:R.phone,experience:R.experience}));console.log(ne),ne.payload&&ne.payload.status&&(await o(Pp()),y(!1))},W=()=>{y(!1)};return a?E.jsxs("div",{className:"loader-main",children:[" ",E.jsx("span",{class:"loader"})," "]}):E.jsxs("main",{className:"doctor-panel my-profile-pg",children:[E.jsxs("div",{className:"container-fluid",children:[E.jsx("div",{className:"doc-panel-inr",children:E.jsx(Va,{})}),E.jsxs("div",{className:"doc-panel-body",children:[E.jsx("div",{className:"docpnl-sec-head",children:E.jsx("h1",{className:"h2-title",children:"My Profile"})}),E.jsxs("div",{className:"my-profile-details",children:[E.jsxs("div",{className:"my-profile-img-wrp",children:[E.jsx("div",{className:"my-profile-img",children:R.profilePic&&E.jsx("img",{src:R.profilePic||"/images/my-profile-img.png",alt:"My Profile"})}),f&&E.jsxs(E.Fragment,{children:[E.jsxs("label",{className:"orange-btn",style:{marginTop:"10px"},children:[E.jsx(Mpe,{style:{marginRight:"6px"}}),"Upload New Picture",E.jsx("input",{type:"file",onChange:O,style:{display:"none"}})]}),E.jsx("button",{className:"cmn-btn",onClick:x,style:{marginTop:"10px"},children:"Remove"})]})]}),E.jsx("div",{className:"my-profile-details-inr",children:f?E.jsxs(E.Fragment,{children:[E.jsxs("div",{className:"my-profile-details-form",children:[E.jsxs("div",{className:"input-grp",children:[E.jsx("label",{children:"Full Name"}),E.jsx("input",{type:"text",name:"fullName",value:R.fullName,onChange:N,placeholder:"Enter full name"})]}),E.jsxs("div",{className:"input-grp",children:[E.jsx("label",{children:"Phone number"}),E.jsx("input",{type:"tel",name:"phone",value:R.phone,onChange:N,placeholder:"Enter phone number"})]}),E.jsxs("div",{className:"input-grp",children:[E.jsx("label",{children:"Experience"}),E.jsx("input",{type:"text",name:"experience",value:R.experience,onChange:N,placeholder:"Experience"})]})]}),E.jsxs("div",{className:"btn-wrp",style:{display:"flex",gap:"15px"},children:[E.jsx("button",{className:"orange-btn",onClick:G,children:"Save Changes"}),E.jsx("button",{className:"cmn-btn",onClick:W,children:"Cancel"})]})]}):E.jsxs(E.Fragment,{children:[E.jsx("form",{children:E.jsxs("div",{className:"my-profile-details-form",children:[E.jsxs("div",{className:"input-grp",children:[E.jsx("label",{children:"Full Name"}),E.jsx("input",{type:"text",value:R.fullName,readOnly:!0})]}),E.jsxs("div",{className:"input-grp",children:[E.jsx("label",{children:"Email ID"}),E.jsx("input",{type:"email",value:R.email,readOnly:!0})]}),E.jsxs("div",{className:"input-grp",children:[E.jsx("label",{children:"Phone number"}),E.jsx("input",{type:"tel",value:R.phone,readOnly:!0})]}),E.jsxs("div",{className:"input-grp",children:[E.jsx("label",{children:"Experience"}),E.jsx("input",{type:"text",value:R.experience,readOnly:!0})]})]})}),E.jsx("div",{className:"btn-wrp",children:E.jsxs("button",{className:"orange-btn",onClick:()=>y(!0),children:[E.jsx("img",{src:"./images/pencil-icon.svg",alt:"Edit"})," Edit profile"]})})]})})]})]}),E.jsx(go,{})]}),E.jsx("div",{className:"modal fade popup-wrp small-pop dash-pop",id:"logOut",tabIndex:"-1",role:"dialog","aria-hidden":"true",children:E.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:E.jsxs("div",{className:"modal-content",children:[E.jsx("div",{className:"modal-icon",children:E.jsx("img",{src:"./images/logout-icon.svg",alt:"Icon"})}),E.jsxs("div",{className:"modal-header",children:[E.jsx("h2",{children:"Logout"}),E.jsx("p",{children:"Are you sure you want to logout?"})]}),E.jsxs("div",{className:"modal-footer btn-wrp",children:[E.jsx("button",{type:"button",className:"cmn-btn","data-bs-dismiss":"modal",children:"Cancel"}),E.jsx("a",{href:"login.html",className:"cmn-btn orange-btn",children:"Logout"})]})]})})})]})},jpe=()=>{const{pastPatients:i,loading:a,error:d,patient_id:f}=Zi(pe=>pe.userdata),y=Mr(),R=4,[w,N]=K.useState([]),[O,x]=K.useState({name:"",age:"",disease:""}),[G,W]=K.useState(!1),[ne,Q]=K.useState(1),[se,te]=K.useState([]),[le,ce]=K.useState([]);K.useEffect(()=>{y(ny())},[y]),K.useEffect(()=>{N(i),ce(i);const pe=[...new Set(i.map(he=>he.latestDisease).filter(he=>he&&he.trim()!==""&&he.trim()!=="-"))];te(pe)},[i]);const me=pe=>{const{name:he,value:Fe}=pe.target;if(he==="name"){const st=Fe.replace(/[^A-Za-z\s]/g,"");x(we=>({...we,[he]:st}))}else he==="age"?(Fe===""||/^[0-9\b]+$/.test(Fe))&&(Fe===""||parseInt(Fe,10)>=0&&parseInt(Fe,10)<=99&&Fe.length<=2)&&x(st=>({...st,[he]:Fe})):x(st=>({...st,[he]:Fe}))},Ce=Math.ceil(w.length/R),_e=pe=>{pe>=1&&pe<=Ce&&Q(pe)},ze=()=>{ne>1&&Q(ne-1)},Z=()=>{ne<Ce&&Q(ne+1)},J=()=>{const pe=new FormData;O.name&&pe.append("patient_name",O.name),O.age&&pe.append("age",O.age),O.disease&&pe.append("disease",O.disease),y(ny(pe)),W(!1)},$=pe=>{pe.preventDefault(),x({name:"",age:"",disease:""});const he=new FormData;y(ny(he)),W(!1)},fe=()=>{W(pe=>(console.log("Toggling filter dropdown. Current value:",pe),!pe))},ve=({patient:pe})=>{var he,Fe;return E.jsx("div",{className:"col-lg-6 col-md-6",children:E.jsxs("div",{className:"past-patient-detail-card",children:[E.jsx("div",{className:"past-patient-cd-img",children:E.jsx("img",{src:`undefined/${pe.patient_profile}`,alt:"Client"})}),E.jsxs("div",{className:"p-patient-card-content",children:[E.jsxs("div",{className:"p-patient-cd-head",children:[E.jsx("h3",{children:pe==null?void 0:pe.patient_name}),pe.referred_by_patient_name&&E.jsxs("p",{children:["Referred by ",pe.referred_by_patient_name]})]}),E.jsxs("div",{className:"p-patient-cd-body",children:[E.jsxs("div",{className:"p-patient-dtl-wrp",children:[E.jsxs("strong",{className:"p-patient-dtl",children:["Age: ",pe.age]}),E.jsxs("strong",{className:"p-patient-dtl",children:["Gender: ",((he=pe.gender)==null?void 0:he.charAt(0).toUpperCase())+((Fe=pe.gender)==null?void 0:Fe.slice(1).toLowerCase())]})]}),E.jsx("div",{className:"p-patient-disease",children:E.jsxs("b",{children:["Latest Disease: ",pe.latestDisease]})}),E.jsx(Wt,{to:"/patient-profile",state:{patientId:pe.patient_id},className:"orange-btn",children:"View full details"})]})]})]})})};return E.jsx("main",{className:"doctor-panel",style:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:E.jsxs("div",{className:"container-fluid",style:{flex:1},children:[E.jsx("div",{className:"doc-panel-inr",children:E.jsx(Va,{})}),a?E.jsx("div",{className:"loader-main",children:E.jsx("span",{className:"loader"})}):E.jsxs("div",{className:"doc-panel-body pp-list-pg",children:[E.jsxs("div",{className:"docpnl-sec-head text-center",children:[E.jsx("h1",{className:"h2-title",children:"My Past Patients"}),E.jsx("div",{className:"back-btn",children:E.jsx(Wt,{to:"#",onClick:pe=>{pe.preventDefault(),window.history.back()},children:E.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})}),E.jsxs("div",{className:"past-patient-filter-wrp past-patient-pg",children:[E.jsxs("button",{type:"button",onClick:fe,children:["Filter ",E.jsx("img",{src:"./images/filter-icon.svg",alt:"Filter"})]}),E.jsx("div",{className:`filter-options-drpdn ${G?"active":""}`,children:E.jsxs("form",{children:[E.jsxs("div",{className:"filter-form",children:[E.jsxs("div",{className:"filter-grp",children:[E.jsx("label",{children:"Patient Name"}),E.jsx("input",{type:"text",name:"name",value:O.name,onChange:me,placeholder:"Patient Name",pattern:"[A-Za-z\\s]+",title:"Only letters and spaces allowed"})]}),E.jsxs("div",{className:"filter-grp",children:[E.jsx("label",{children:"Age"}),E.jsx("input",{type:"text",name:"age",value:O.age,onChange:me,placeholder:"Age",maxLength:2,pattern:"[0-9]*"})]}),E.jsxs("div",{className:"filter-grp",children:[E.jsx("label",{children:"Disease"}),E.jsxs("select",{name:"disease",value:O.disease,onChange:me,children:[E.jsx("option",{value:"",disabled:!0,children:"Disease"}),se.map((pe,he)=>E.jsx("option",{value:pe,children:pe},he))]})]})]}),E.jsxs("div",{className:"filter-form-btn-wrp",children:[E.jsx("button",{type:"button",className:"orange-btn",onClick:$,style:{borderRadius:0},children:"Clear Filter"}),E.jsx("button",{type:"button",className:"orange-btn",onClick:J,style:{borderRadius:0},children:"Apply Filter"})]})]})})]})]}),E.jsx("div",{className:"past-patients-list-wrp",children:E.jsx("div",{className:"row",children:w.length==0?E.jsx("div",{style:{textAlign:"center",padding:"25px 0",fontWeight:"bold"},children:"No data found"}):w.slice((ne-1)*R,ne*R).map(pe=>E.jsx(ve,{patient:pe},pe.id))})}),w.length>0&&E.jsx(nR,{currentPage:ne,totalPages:Ce,onPageChange:_e,onPrevious:ze,onNext:Z})]}),E.jsx(go,{})]})})},Vpe="/images/calendar-tick-success.svg",Fpe="/images/calendar-cancelled.svg",Bpe="/images/calendar-changes.svg",Gpe=()=>{var Q,se,te,le,ce,me,Ce,_e,ze;const o=Mr(),{doctorNotifications:i,loading:a,error:d}=Zi(Z=>Z.notification);K.useEffect(()=>{o(ty())},[o]);const[f,y]=K.useState([]),[R,w]=K.useState([]);K.useEffect(()=>{var fe,ve,pe;const Z=((fe=i==null?void 0:i.today)==null?void 0:fe.map(he=>he.id))??[],J=((ve=i==null?void 0:i.yesterday)==null?void 0:ve.map(he=>he.id))??[],$=((pe=i==null?void 0:i.older)==null?void 0:pe.map(he=>he.id))??[];w([...Z,...J,...$])},[i]);const N=()=>{f.length===R.length?y([]):(console.log(R,"fff"),y(R))};console.log("selectedIds.length",f.length);const O=()=>{if(console.log("hello..................."),console.log("selectedIds.length1111111111",f.length),console.log("finalNotification.length1111111111",R.length),f.length===0){It.error("Please select atleast one notification"),console.log("why notification toast is not coming");return}o(I0(f)).then(()=>{y([]),o(unreadCount()),o(ty())})},x=Z=>{y(J=>J.includes(Z)?J.filter($=>$!==Z):[...J,Z])},G=()=>{o(N0({notification_ids:R})),o(ty())},W=Z=>{const J=i[Z];return(J==null?void 0:J.length)==0?null:E.jsxs("div",{className:"notifications-group",children:[E.jsx("div",{className:"group-header",children:E.jsx("h2",{children:(Z==null?void 0:Z.charAt(0).toUpperCase())+(Z==null?void 0:Z.slice(1))})}),E.jsx("ul",{className:"notifications-list",children:J==null?void 0:J.map($=>{var fe,ve,pe,he;return E.jsxs("li",{className:"notification-item",onClick:()=>x($==null?void 0:$.id),style:{backgroundColor:f.includes($==null?void 0:$.id)?"#c0c0c0":$.is_read==="true"?"#f0f0f0":"#ffffff",borderLeft:f.includes($==null?void 0:$.id)?"3px solid #d0d0d0":"none",color:(f.includes($==null?void 0:$.id),"black"),cursor:"pointer"},children:[E.jsxs("div",{className:"notif-left",children:[E.jsx("div",{className:`notif-icon ${(fe=$==null?void 0:$.icon)!=null&&fe.includes("success")?"success":(ve=$==null?void 0:$.type)!=null&&ve.includes("appointment_cancelled")?"cancelled":"changed"}`,children:E.jsx("img",{src:(pe=$==null?void 0:$.type)!=null&&pe.includes("appointment_cancelled")?Fpe:(he=$==null?void 0:$.type)!=null&&he.includes("appointment_success")?Vpe:Bpe,alt:"Icon"})}),E.jsxs("div",{className:"notif-text",children:[E.jsx("h3",{style:{fontWeight:$.is_read==="true"?"normal":"bold"},children:$.title}),E.jsx("p",{children:$==null?void 0:$.message})]})]}),E.jsx("div",{className:"notif-time",children:ne($.created_at)})]},$.id)})})]})},ne=Z=>{const J=new Date,$=new Date(Z),fe=Math.floor((J-$)/1e3);if(fe<86400)return`${Math.floor(fe/3600)}h`;if(fe<172800)return"1d";{const ve=Math.floor(fe/86400);return ve<7?`${ve}d`:`${Math.floor(ve/7)}w`}};return E.jsx("main",{className:"doctor-panel",children:E.jsxs("div",{className:"container-fluid",children:[E.jsx("div",{className:"doc-panel-inr",children:E.jsx(Va,{})}),a?E.jsx("div",{className:"loader-main",children:E.jsx("span",{className:"loader"})}):E.jsx("div",{className:"doc-panel-body",children:E.jsxs("div",{className:"notifications-section",children:[E.jsxs("div",{className:"docpnl-sec-head text-center",children:[E.jsx("h1",{className:"h2-title px-5",children:"Notifications"}),E.jsx("div",{className:"back-btn",onClick:()=>window.history.back(),children:E.jsx("a",{href:"#",onClick:Z=>Z.preventDefault(),children:E.jsx("img",{src:"./images/left-arrow.svg",alt:"Back"})})})]}),(((Q=i==null?void 0:i.today)==null?void 0:Q.length)>0||((se=i==null?void 0:i.yesterday)==null?void 0:se.length)>0||((te=i==null?void 0:i.older)==null?void 0:te.length)>0)&&E.jsxs("div",{className:"bulk-actions",children:[E.jsxs("button",{className:"select-all-btn",onClick:N,children:[E.jsx("label",{htmlFor:"selectAll",children:"Select all"}),E.jsxs("div",{className:"radio-btn-wrp",children:[E.jsx("input",{type:"radio",name:"selectAction",id:"selectAll",checked:R.length>0&&f.length===R.length,readOnly:!0}),E.jsx("span",{})]})]}),E.jsxs("button",{className:"delete-all-btn",onClick:O,children:[E.jsx("label",{htmlFor:"deleteAll",children:"Delete"}),E.jsxs("div",{className:"radio-btn-wrp",children:[E.jsx("input",{type:"radio",name:"selectAction",id:"deleteAll",disabled:f.length===0}),E.jsx("span",{})]})]})]}),(((le=i==null?void 0:i.today)==null?void 0:le.length)>0||((ce=i==null?void 0:i.yesterday)==null?void 0:ce.length)>0||((me=i==null?void 0:i.older)==null?void 0:me.length)>0)&&E.jsx("div",{className:"group-header",style:{display:"flex",justifyContent:"flex-end"},children:E.jsx("button",{className:"mark-all-btn",onClick:G,children:"Mark all as read"})}),((Ce=i==null?void 0:i.today)==null?void 0:Ce.length)===0&&((_e=i==null?void 0:i.yesterday)==null?void 0:_e.length)===0&&((ze=i==null?void 0:i.older)==null?void 0:ze.length)===0?E.jsx("p",{style:{fontSize:"1.5rem",fontWeight:"500",color:"#6b7280",textAlign:"center",margin:"2rem 0",padding:"1.5rem",borderRadius:"0.5rem",width:"100%",maxWidth:"600px",marginLeft:"auto",marginRight:"auto"},children:a?"Loading...":"No Notifications found"}):E.jsxs(E.Fragment,{children:[W("today"),W("yesterday"),W("older")]})]})}),E.jsx(go,{})]})})},Hpe=()=>{const[o,i]=K.useState(""),[a,d]=K.useState(""),[f,y]=K.useState(!1),R=Mr(),w=$r(),{email:N}=w.state||{},O=async x=>{var W,ne;if(x.preventDefault(),!/^(?=.*[a-z])(?=.*[A-Z])(?=.*[\d\W]).{8,}$/.test(o)){toast.error("Password must be at least 8 characters long and include at least one uppercase letter, one lowercase letter, and one number or special character.");return}if(o!==a){toast.error("Passwords do not match");return}try{const Q=await R(y0({email:N,password:o,password_confirmation:a}));console.log(N),console.log(o),console.log(a),(W=Q.payload)!=null&&W.status?y(!0):toast.error(((ne=Q.payload)==null?void 0:ne.message)||"Password creation failed")}catch(Q){console.log("Password creation error:",Q),toast.error("An error occurred during password creation")}};return E.jsxs("div",{className:"sign-sec set-pass pt-0",children:[E.jsx("div",{className:"container",children:E.jsxs("div",{className:"sign-sec-inr",children:[E.jsx("div",{className:"docpnl-sec-head",children:E.jsx("div",{className:"back-btn",children:E.jsx(Wt,{to:"/login-password",children:E.jsx("img",{src:"/images/left-arrow.svg",alt:"Icon"})})})}),E.jsxs("div",{className:"sign-inr-row row",children:[E.jsx("div",{className:"sign-left-wrp col-lg-7",children:E.jsxs("div",{className:"sign-left has-texture",children:[E.jsx("div",{className:"texture",children:E.jsx("img",{src:"/images/doctor-symbol.png",alt:"Doctor Symbol"})}),E.jsx("div",{className:"sign-left-img",children:E.jsx("img",{src:"/images/new-pass-bnr.png",alt:"Login Left Image"})})]})}),E.jsx("div",{className:"sign-right-wrp col-lg-5",children:E.jsxs("div",{className:"sign-right",children:[E.jsx("div",{className:"logo-wrp",children:E.jsx("div",{className:"logo-inr-wrp",children:E.jsx("span",{children:E.jsx("img",{src:"/images/logo.png",alt:"Logo"})})})}),E.jsx("div",{className:"sign-form",children:E.jsx("form",{onSubmit:O,children:E.jsx("div",{className:"sign-form-steps-wrp",children:E.jsxs("div",{className:"sign-form-step",children:[E.jsxs("div",{className:"formfield",children:[E.jsx("label",{children:"Create Password"}),E.jsxs("div",{className:"input-pass-field",children:[E.jsx("input",{type:"password",placeholder:"Password",required:!0,value:o,onChange:x=>i(x.target.value)}),E.jsx("span",{className:"eye-btn eye-open",children:E.jsx("img",{src:"/images/eye-open.svg",alt:"Icon"})}),E.jsx("span",{className:"eye-btn eye-close",children:E.jsx("img",{src:"/images/eye-close.svg",alt:"Icon"})})]})]}),E.jsxs("div",{className:"formfield mb-0",children:[E.jsx("label",{children:"Confirm Password"}),E.jsxs("div",{className:"input-pass-field",children:[E.jsx("input",{type:"password",placeholder:"Password",required:!0,value:a,onChange:x=>d(x.target.value)}),E.jsx("span",{className:"eye-btn eye-open",children:E.jsx("img",{src:"/images/eye-open.svg",alt:"Icon"})}),E.jsx("span",{className:"eye-btn eye-close",children:E.jsx("img",{src:"/images/eye-close.svg",alt:"Icon"})})]})]}),E.jsx(vy,{type:"submit",className:"orange-btn",children:"Continue"})]})})})})]})})]})]})}),E.jsxs(tr,{show:f,onHide:()=>y(!1),centered:!0,className:"popup-wrp",id:"congratulations",dialogClassName:"custom-modal",children:[E.jsx("style",{children:`
                    .custom-modal .modal-content {
                        padding: 30px 0 50px 0;
                        margin: 0;
                    }
                `}),E.jsx("div",{className:"modal-icon text-center mt-4",children:E.jsx("img",{src:"/images/check-icon.png",alt:"Icon"})}),E.jsxs(tr.Header,{className:"border-0 flex-column text-center",children:[E.jsx(tr.Title,{className:"w-100",children:E.jsx("h2",{children:"Congratulations"})}),E.jsx("p",{children:"Your account is ready to use."})]}),E.jsx(tr.Footer,{className:"d-flex justify-content-center border-0",children:E.jsx(Wt,{to:"/doctor-home",className:"orange-btn",onClick:()=>y(!1),children:"Go to Dashboard"})})]})]})},zpe=()=>{const[o,i]=K.useState(!1),[a,d]=K.useState("");qo();const f=Mr(),{reminderPopupData:y,loading:R}=Zi(N=>N.notification);K.useEffect(()=>{f(L0())},[f]),K.useEffect(()=>{if(!(y!=null&&y.appointment_datetime))return;const N=new Date(y.appointment_datetime);if(isNaN(N)){console.error("Invalid appointment datetime:",y.appointment_datetime);return}const O=new Date,x=N.getTime()-O.getTime(),G=[{minutesBefore:15},{minutesBefore:5},{minutesBefore:2}],W=[];if(G.forEach(({minutesBefore:ne})=>{const Q=x-ne*60*1e3;if(Q>0){const se=setTimeout(()=>{const te=`Your Appointment Starts in ${ne} Minutes!`;d(te),i(!0)},Q);W.push(se)}}),x>0){const ne=setTimeout(()=>{console.log("Timer is completed: Appointment time reached.")},x);W.push(ne)}return()=>{W.forEach(clearTimeout)}},[y]);const w=N=>{const O=new Date(N),x={weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0};return O.toLocaleString("en-US",x)};return E.jsx(E.Fragment,{children:o&&E.jsx("div",{className:"modal fade show",tabIndex:"-1",style:{display:"block",backgroundColor:"rgba(0, 0, 0, 0.5)"},children:E.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:E.jsxs("div",{className:"modal-content text-center position-relative shadow",style:{width:"400px",minHeight:"280px",borderRadius:"20px",padding:"30px 20px"},children:[E.jsx("button",{type:"button",onClick:()=>i(!1),className:"position-absolute top-0 end-0 m-3 border-0 bg-transparent","aria-label":"Close",children:E.jsx("img",{src:"./images/cross-blue.png",alt:"Close Icon",style:{width:"24px",height:"24px"}})}),E.jsx("div",{className:"modal-icon mb-3",children:E.jsx("img",{src:"./images/bell-icon.svg",alt:"Reminder Icon",style:{width:"40px",height:"40px"}})}),E.jsxs("div",{className:"modal-header border-0 flex-column align-items-center p-0",children:[E.jsx("h2",{className:"fw-bold mb-2",style:{fontSize:"22px",color:"#333"},children:"Reminder:"}),E.jsx("p",{className:"m-0",style:{color:"#009CDE",fontWeight:"500"},children:a})]}),E.jsxs("div",{className:"modal-body p-0 mt-4",children:[E.jsxs("div",{className:"text-muted mb-2",children:["Patient's Name:"," ",E.jsx("span",{className:"fw-medium",style:{color:"#356598"},children:(y==null?void 0:y.patient_name)||"Sunil"})]}),E.jsxs("div",{className:"text-muted",children:["Date and Time:"," ",E.jsx("span",{className:"fw-medium",style:{color:"#356598"},children:w(y==null?void 0:y.appointment_datetime)})]})]})]})})})})},ho=({children:o})=>E.jsxs("div",{children:[E.jsx(zpe,{}),E.jsx("main",{children:o})]}),Ua=({children:o})=>{const i=$r(),a=localStorage.getItem("doctor-app"),[d,f]=K.useState(!1);return K.useEffect(()=>{a||(It.error("Please Login First"),f(!0))},[a]),d?E.jsx(Dte,{to:"/",state:{from:i},replace:!0}):a?o:null};function Wpe(){return E.jsx(E.Fragment,{children:E.jsxs(Lte,{children:[E.jsx(ar,{path:"/",element:E.jsx(Qoe,{})}),E.jsx(ar,{path:"/login-password",element:E.jsx($oe,{})}),E.jsx(ar,{path:"/forgot-password",element:E.jsx(Zoe,{})}),E.jsx(ar,{path:"/otp-verification",element:E.jsx(ece,{})}),E.jsx(ar,{path:"/set-password",element:E.jsx(tce,{})}),E.jsx(ar,{path:"/header",element:E.jsx(Va,{})}),E.jsx(ar,{path:"/footer",element:E.jsx(go,{})}),E.jsx(ar,{path:"/doctor-home",element:E.jsx(Ua,{children:E.jsx(ho,{children:E.jsx(ace,{})})})}),E.jsx(ar,{path:"/patient-details",element:E.jsx(Ua,{children:E.jsx(ho,{children:E.jsx(oce,{})})})}),E.jsx(ar,{path:"/patient-profile",element:E.jsx(Ua,{children:E.jsx(ho,{children:E.jsx(uce,{})})})}),E.jsx(ar,{path:"/my-appointments",element:E.jsx(Ua,{children:E.jsx(ho,{children:E.jsx(eH,{})})})}),E.jsx(ar,{path:"/schedule-appointment",element:E.jsx(Ua,{children:E.jsx(ho,{children:E.jsx(mce,{})})})}),E.jsx(ar,{path:"/completed-appointment-screen",element:E.jsx(Ua,{children:E.jsx(ho,{children:E.jsx(_pe,{})})})}),E.jsx(ar,{path:"/videocall",element:E.jsx(Ua,{children:E.jsx(Spe,{})})}),E.jsx(ar,{path:"/pendingprescription",element:E.jsx(Ua,{children:E.jsx(ho,{children:E.jsx(Rpe,{})})})}),E.jsx(ar,{path:"/PendingAssignedPrescriptionDetails",element:E.jsx(Ua,{children:E.jsx(ho,{children:E.jsx(bpe,{})})})}),E.jsx(ar,{path:"/CompletedAssignedPrescription",element:E.jsx(Ua,{children:E.jsx(ho,{children:E.jsx(wpe,{})})})}),E.jsx(ar,{path:"/pendingfull",element:E.jsx(Ua,{children:E.jsx(ho,{children:E.jsx(Ape,{})})})}),E.jsx(ar,{path:"/UserProfile",element:E.jsx(Ua,{children:E.jsx(ho,{children:E.jsx(Upe,{})})})}),E.jsx(ar,{path:"/pastpatient",element:E.jsx(Ua,{children:E.jsx(ho,{children:E.jsx(jpe,{})})})}),E.jsx(ar,{path:"/create-password",element:E.jsx(Hpe,{})}),E.jsx(ar,{path:"/notifications",element:E.jsx(Ua,{children:E.jsx(ho,{children:E.jsx(Gpe,{})})})}),E.jsx(ar,{path:"/myappointment",element:E.jsx(Ua,{children:E.jsx(ho,{children:E.jsx(eH,{})})})}),E.jsx(ar,{path:"*",element:E.jsx(Tpe,{})})]})})}function Op(){It.error("Token Expired"),localStorage.removeItem("nfc-admin"),setTimeout(()=>{window.location.href="/"},1e3)}const Nk=$t("faq/getAllContacts",async(o,{rejectWithValue:i})=>{var a;try{return(await(void 0)()).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),Ok=$t("faq/updateFeedback",async(o,{rejectWithValue:i})=>{var a;try{return(await(void 0)(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),Dk=$t("faq/deleteContact",async(o,{rejectWithValue:i})=>{var a;try{return(await(void 0)(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),Pk=$t("faq/getAllFaq",async(o,{rejectWithValue:i})=>{var a;try{return(await(void 0)()).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),Lk=$t("faq/createFaq",async(o,{rejectWithValue:i})=>{var a;try{return(await(void 0)(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),kk=$t("faq/editFaq",async(o,{rejectWithValue:i})=>{var a;try{return(await(void 0)(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),xk=$t("faq/deleteFaq",async(o,{rejectWithValue:i})=>{var a;try{return(await(void 0)(o)).data}catch(d){return i(((a=d.response)==null?void 0:a.data)||d.message)}}),qpe=l_({name:"faqSlice",initialState:{allContacts:[],contactLoading:!1,contactError:null,allFaq:[],loading:!1,error:null},reducers:{},extraReducers:o=>{o.addCase(Nk.pending,i=>{i.loading=!0,i.error=null}).addCase(Nk.fulfilled,(i,a)=>{var d;i.loading=!1,i.allContacts=(d=a.payload)==null?void 0:d.data}).addCase(Nk.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to fetch Contacts",a.payload.message=="Unauthenticated."&&Op()}).addCase(Ok.pending,i=>{i.loading=!0,i.error=null}).addCase(Ok.fulfilled,(i,a)=>{var d;i.loading=!1,i.allContacts=(d=a.payload)==null?void 0:d.data,It.success("Feedback updated successfully")}).addCase(Ok.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to update Contacts",It.error(a.payload.message||"Failed to update Feedback"),a.payload.message=="Unauthenticated."&&Op()}).addCase(Dk.pending,i=>{i.loading=!0,i.error=null}).addCase(Dk.fulfilled,(i,a)=>{i.loading=!1,i.allContacts=a.payload.data,It.success("Contact deleted successfully")}).addCase(Dk.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to delete Faq",It.error(a.payload.message||"Failed to delete Faq"),a.payload.message=="Unauthenticated."&&Op()}).addCase(Pk.pending,i=>{i.loading=!0,i.error=null}).addCase(Pk.fulfilled,(i,a)=>{var d;i.loading=!1,i.allFaq=(d=a.payload)==null?void 0:d.data}).addCase(Pk.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to fetch Faq's",a.payload.message=="Unauthenticated."&&Op()}).addCase(Lk.pending,i=>{i.loading=!0,i.error=null}).addCase(Lk.fulfilled,(i,a)=>{var d;i.loading=!1,i.allFaq=(d=a.payload)==null?void 0:d.data,It.success("Faq created successfully")}).addCase(Lk.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to fetch Faq's",It.error(a.payload.message||"Failed to create Faq"),a.payload.message=="Unauthenticated."&&Op()}).addCase(kk.pending,i=>{i.loading=!0,i.error=null}).addCase(kk.fulfilled,(i,a)=>{i.loading=!1,i.allFaq=a.payload.data,i.message="Faq updated successfully",It.success("Faq updated successfully")}).addCase(kk.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to update Faq",It.error(a.payload.message||"Failed to update Faq"),a.payload.message=="Unauthenticated."&&Op()}).addCase(xk.pending,i=>{i.loading=!0,i.error=null}).addCase(xk.fulfilled,(i,a)=>{i.loading=!1,i.allFaq=a.payload.data,i.message="Faq deleted successfully",It.success("Faq deleted successfully"),a.payload.message=="Unauthenticated."&&Op()}).addCase(xk.rejected,(i,a)=>{i.loading=!1,i.error=a.payload||"Failed to delete Faq",It.error(a.payload.message||"Failed to delete Faq"),a.payload.message=="Unauthenticated."&&Op()})}}),Kpe=qpe.reducer,Ype=Dre({reducer:{user:Yoe,faqs:Kpe,userdata:ice,appointments:sce,prescriptions:fce,patientProfile:dce,notification:Joe},devTools:!0}),Xpe=()=>E.jsx(E.Fragment,{children:E.jsx(nne,{children:E.jsx(Wpe,{})})});function Jpe(){return E.jsxs(tre,{store:Ype,children:[E.jsx(qoe,{}),E.jsx(Xpe,{})]})}Gee.createRoot(document.getElementById("root")).render(E.jsx(K.StrictMode,{children:E.jsx(Jpe,{})}));
